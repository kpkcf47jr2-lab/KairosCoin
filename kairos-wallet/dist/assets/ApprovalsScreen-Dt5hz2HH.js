import{d as n,j as e,e as $,S as E,b as L,T as v,ax as N,aj as T,m as z,p as P,w as I}from"./ui-Bym_0wSS.js";import{b as q,u as F,Y as K,C as M,Z as U}from"./index-BcInKdAV.js";import{P as B}from"./PasswordConfirm-Bp5Ldzud.js";import"./vendor-CCYniLZC.js";import"./crypto-1JBTrmrY.js";function D(){const{t:u}=q(),{activeAddress:f,activeChainId:o,navigate:y,showToast:l,getActiveAccount:w,balances:b}=F(),[j,c]=n.useState([]),[i,d]=n.useState(!0),[A,k]=n.useState(null),[S,x]=n.useState(!1),[t,m]=n.useState(null),p=M[o],h=n.useCallback(async()=>{d(!0);try{const s=(b.tokens||[]).filter(a=>a.address&&parseFloat(a.balance)>0).map(a=>a.address);if(s.length===0){c([]),d(!1);return}const r=await K(o,f,s);c(r)}catch(s){console.error("[Approvals] Fetch error:",s),l("Error cargando approvals","error")}finally{d(!1)}},[o,f,b]);n.useEffect(()=>{h()},[h]);const R=s=>{m(s),x(!0)},C=async s=>{if(x(!1),!!t){k(t.tokenAddress+t.spender);try{const r=w();if(!r?.privateKey)throw new Error("Account not found");await U(o,r.privateKey,t.tokenAddress,t.spender),l(`Revocado ${t.tokenSymbol}`,"success"),c(a=>a.filter(g=>!(g.tokenAddress===t.tokenAddress&&g.spender===t.spender)))}catch(r){l(r.message||"Error al revocar","error")}finally{k(null),m(null)}}};return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center gap-3 px-5 py-4",children:[e.jsx("button",{onClick:()=>y("settings"),className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx($,{size:20,className:"text-dark-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(E,{size:18,className:"text-kairos-400"}),u("approvals.title","Aprobaciones de Tokens")]}),e.jsx("p",{className:"text-dark-400 text-xs",children:p?.name})]}),e.jsx("button",{onClick:h,className:"p-2 rounded-xl hover:bg-white/5",disabled:i,children:e.jsx(L,{size:16,className:`text-dark-400 ${i?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-8",children:[e.jsxs("div",{className:"bg-orange-500/5 border border-orange-500/10 rounded-xl p-3 mb-4 flex items-start gap-2",children:[e.jsx(v,{size:14,className:"text-orange-400 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-[11px] text-dark-300 leading-relaxed",children:u("approvals.warning","Las aprobaciones permiten que contratos gasten tus tokens. Revoca las que ya no necesites para proteger tus fondos.")})]}),i&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(N,{className:"w-8 h-8 text-kairos-400 animate-spin mb-3"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Escaneando aprobaciones..."})]}),!i&&j.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(T,{className:"w-12 h-12 text-green-400 mb-3"}),e.jsx("p",{className:"text-white font-medium mb-1",children:"¡Todo limpio!"}),e.jsxs("p",{className:"text-dark-400 text-sm text-center",children:["No hay aprobaciones activas en ",p?.name]})]}),e.jsx("div",{className:"space-y-2",children:j.map((s,r)=>{const a=A===s.tokenAddress+s.spender;return e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},className:"bg-white/[0.03] rounded-xl p-4 border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium text-sm",children:s.tokenSymbol}),e.jsxs("span",{className:"text-dark-500 text-xs ml-2",children:["→ ",s.spenderLabel]})]}),e.jsxs("button",{onClick:()=>R(s),disabled:a,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 
                             text-xs font-medium hover:bg-red-500/20 transition-colors disabled:opacity-50`,children:[a?e.jsx(N,{size:12,className:"animate-spin"}):e.jsx(P,{size:12}),"Revocar"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-dark-400",children:s.isUnlimited?e.jsxs("span",{className:"text-orange-400 flex items-center gap-1",children:[e.jsx(v,{size:10})," Ilimitado"]}):`${s.allowance} ${s.tokenSymbol}`}),e.jsxs("a",{href:`${p?.blockExplorerUrl}/address/${s.spender}`,target:"_blank",rel:"noopener noreferrer",className:"text-dark-500 hover:text-dark-300 flex items-center gap-1",children:[s.spender.slice(0,6),"...",s.spender.slice(-4),e.jsx(I,{size:10})]})]})]},`${s.tokenAddress}-${s.spender}`)})})]}),e.jsx(B,{isOpen:S,onConfirm:C,onCancel:()=>{x(!1),m(null)},title:"Revocar Aprobación",subtitle:t?`Revocar ${t.tokenSymbol} → ${t.spenderLabel}`:"",confirmLabel:"Revocar"})]})}export{D as default};
