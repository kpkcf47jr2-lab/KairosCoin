import{d as i,j as e,e as Y,U as E,p as Z,P as ee,T as se,m as te,ag as ae,aj as B,X as re,t as ne}from"./ui-Bym_0wSS.js";import{u as de,C as oe,f as A,L as le,p as ie,a7 as ce,a8 as xe,y as me}from"./index-Cv82Q9rX.js";import{P as ue}from"./PasswordConfirm-CDK6JU-c.js";import"./vendor-CCYniLZC.js";import"./crypto-1JBTrmrY.js";function ke(){const{goBack:F,activeChainId:f,activeAddress:T,balances:z,showToast:c,getActiveAccount:P,addPendingTx:I}=de(),M=oe[f],L=P(),[a,b]=i.useState([{address:"",amount:""}]),[k,D]=i.useState("native"),[K,v]=i.useState(!1),[he,R]=i.useState(!1),[N,O]=i.useState([]),[m,u]=i.useState("form"),[$,y]=i.useState([]),[U,V]=i.useState(-1),w=L&&!L.privateKey,C=[{id:"native",symbol:M?.nativeCurrency?.symbol,balance:z?.native?.balance||"0",decimals:18},...(z?.tokens?.filter(s=>s.hasBalance)||[]).map(s=>({id:s.address,symbol:s.symbol,balance:s.balance||"0",decimals:s.decimals||18,address:s.address}))],n=C.find(s=>s.id===k)||C[0],q=()=>{if(a.length>=20){c("M√°ximo 20 destinatarios","error");return}b([...a,{address:"",amount:""}])},H=s=>{a.length<=1||b(a.filter((t,r)=>r!==s))},S=(s,t,r)=>{const g=[...a];if(g[s]={...g[s],[t]:r},b(g),t==="address"&&r.length>=2){const p=le().filter(j=>j.name.toLowerCase().includes(r.toLowerCase())||j.address.toLowerCase().includes(r.toLowerCase())).slice(0,3);y(p),V(s)}else y([])},W=(s,t)=>{S(t,"address",s.address),y([])},X=s=>{b(a.map(t=>({...t,amount:s})))},l=a.reduce((s,t)=>s+(parseFloat(t.amount)||0),0),h=parseFloat(n?.balance||"0"),_=()=>{for(let s=0;s<a.length;s++){if(!me(a[s].address))return c(`Direcci√≥n inv√°lida en fila ${s+1}`,"error"),!1;if(!a[s].amount||parseFloat(a[s].amount)<=0)return c(`Cantidad inv√°lida en fila ${s+1}`,"error"),!1}return l>h?(c("Balance insuficiente para el total","error"),!1):!0},G=()=>{_()&&u("confirm")},J=()=>{v(!0)},Q=async s=>{v(!1),R(!0),u("sending");const t=[];try{const r=await ie(s),p=[...r.accounts||[],...r.importedAccounts||[]].find(o=>o.address.toLowerCase()===T.toLowerCase());if(!p?.privateKey)throw new Error("No se encontr√≥ la clave privada");for(let o=0;o<a.length;o++){const d=a[o];try{let x;k==="native"?x=await ce(f,p.privateKey,d.address,d.amount,"standard"):x=await xe(f,p.privateKey,n.address,d.address,d.amount,n.decimals,"standard"),I({hash:x.hash,from:T,to:d.address,value:d.amount,type:"send",chainId:f,timestamp:Date.now(),status:"pending"}),t.push({index:o,address:d.address,amount:d.amount,hash:x.hash,status:"success"})}catch(x){t.push({index:o,address:d.address,amount:d.amount,error:x.message,status:"error"})}}O(t),u("done");const j=t.filter(o=>o.status==="success").length;c(`‚úÖ ${j}/${a.length} env√≠os completados`,"success")}catch(r){c(r.message||"Error ejecutando batch","error"),R(!1),u("confirm")}};return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-dark-800",children:[e.jsx("button",{onClick:F,className:"text-dark-300 hover:text-white",children:e.jsx(Y,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"text-kairos-400",size:20}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Multi-Send"})]}),e.jsxs("span",{className:"ml-auto text-dark-500 text-xs",children:[a.length," destinatario",a.length>1?"s":""]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m==="form"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400 text-xs mb-2",children:"Token a enviar"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:C.slice(0,6).map(s=>e.jsxs("button",{onClick:()=>D(s.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium border transition-all ${k===s.id?"bg-kairos-500/20 text-kairos-400 border-kairos-500/40":"bg-dark-800 text-dark-300 border-dark-700"}`,children:[s.symbol,e.jsx("span",{className:"text-dark-500 text-xs ml-1",children:parseFloat(s.balance).toFixed(4)})]},s.id))})]}),e.jsx("div",{className:"space-y-3",children:a.map((s,t)=>e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-3 border border-dark-700 relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-dark-500 text-xs font-bold w-5",children:["#",t+1]}),e.jsx("input",{type:"text",value:s.address,onChange:r=>S(t,"address",r.target.value),placeholder:"0x... direcci√≥n o nombre",className:"flex-1 bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white text-sm placeholder-dark-500 focus:border-kairos-500 focus:outline-none font-mono"}),a.length>1&&e.jsx("button",{onClick:()=>H(t),className:"text-red-400 hover:text-red-300",children:e.jsx(Z,{size:14})})]}),U===t&&$.length>0&&e.jsx("div",{className:"mb-2 space-y-1",children:$.map(r=>e.jsxs("button",{onClick:()=>W(r,t),className:"w-full text-left px-2 py-1 rounded bg-dark-700/50 text-xs text-dark-300 hover:bg-dark-600",children:[r.name," ‚Äî ",A(r.address,4)]},r.id))}),e.jsxs("div",{className:"flex items-center gap-2 pl-7",children:[e.jsx("input",{type:"number",value:s.amount,onChange:r=>S(t,"amount",r.target.value),placeholder:"Cantidad",className:"flex-1 bg-dark-700 border border-dark-600 rounded-lg px-3 py-2 text-white text-sm placeholder-dark-500 focus:border-kairos-500 focus:outline-none"}),e.jsx("span",{className:"text-dark-500 text-xs",children:n?.symbol})]})]},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:q,className:"flex-1 py-2.5 rounded-xl bg-dark-800 border border-dark-700 text-dark-300 text-sm font-medium flex items-center justify-center gap-1 hover:bg-dark-700",children:[e.jsx(ee,{size:14})," Agregar"]}),a.length>1&&e.jsx("button",{onClick:()=>{const s=(h/a.length*.98).toFixed(6);X(s)},className:"flex-1 py-2.5 rounded-xl bg-dark-800 border border-dark-700 text-dark-300 text-sm font-medium hover:bg-dark-700",children:"Dividir equitativo"})]}),e.jsxs("div",{className:"bg-dark-800/30 rounded-xl p-3 border border-dark-700/50",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-dark-400",children:"Total a enviar"}),e.jsxs("span",{className:`font-bold ${l>h?"text-red-400":"text-white"}`,children:[l.toFixed(6)," ",n?.symbol]})]}),e.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-dark-500",children:"Balance disponible"}),e.jsxs("span",{className:"text-dark-400",children:[parseFloat(n?.balance||0).toFixed(6)," ",n?.symbol]})]}),l>h&&e.jsxs("p",{className:"text-red-400 text-xs mt-1 flex items-center gap-1",children:[e.jsx(se,{size:10})," Balance insuficiente"]})]})]}),m==="confirm"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx(E,{className:"mx-auto text-kairos-400 mb-2",size:32}),e.jsx("h2",{className:"text-white font-bold text-lg",children:"Confirmar Multi-Send"}),e.jsxs("p",{className:"text-dark-400 text-sm mt-1",children:[a.length," env√≠o",a.length>1?"s":""," ¬∑ ",l.toFixed(6)," ",n?.symbol]})]}),a.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-800/50 rounded-lg p-3 border border-dark-700/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-mono",children:A(s.address,6)}),e.jsxs("p",{className:"text-dark-500 text-xs",children:["Destino #",t+1]})]}),e.jsxs("p",{className:"text-kairos-400 font-bold text-sm",children:[s.amount," ",n?.symbol]})]},t)),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>u("form"),className:"flex-1 py-3 rounded-xl bg-dark-800 border border-dark-700 text-dark-300 text-sm font-semibold",children:"Editar"}),e.jsx("button",{onClick:J,disabled:w,className:"flex-1 py-3 rounded-xl bg-gradient-to-r from-kairos-500 to-kairos-400 text-dark-950 text-sm font-bold disabled:opacity-40",children:w?"üîí Solo lectura":"üöÄ Enviar Todo"})]})]}),m==="sending"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"},children:e.jsx(ae,{className:"mx-auto text-kairos-400",size:48})}),e.jsx("p",{className:"text-white font-bold mt-4",children:"Enviando transacciones..."}),e.jsx("p",{className:"text-dark-400 text-sm mt-1",children:"Esto puede tomar un momento"})]}),m==="done"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx(B,{className:"mx-auto text-green-400 mb-2",size:40}),e.jsx("h2",{className:"text-white font-bold text-lg",children:"Multi-Send Completado"}),e.jsxs("p",{className:"text-dark-400 text-sm mt-1",children:[N.filter(s=>s.status==="success").length,"/",N.length," exitosos"]})]}),N.map((s,t)=>e.jsxs("div",{className:`flex items-center justify-between rounded-lg p-3 border ${s.status==="success"?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="success"?e.jsx(B,{className:"text-green-400",size:14}):e.jsx(re,{className:"text-red-400",size:14}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-xs font-mono",children:A(s.address,6)}),e.jsx("p",{className:"text-dark-500 text-[10px]",children:s.status==="success"?s.hash?.slice(0,16)+"...":s.error?.slice(0,40)})]})]}),e.jsxs("span",{className:"text-dark-300 text-xs",children:[s.amount," ",n?.symbol]})]},t)),e.jsx("button",{onClick:F,className:"w-full py-3 rounded-xl bg-kairos-500/20 text-kairos-400 text-sm font-bold mt-4",children:"Listo"})]})]}),m==="form"&&e.jsx("div",{className:"p-4 border-t border-dark-800",children:e.jsxs("button",{onClick:G,disabled:w||l<=0||l>h,className:"w-full py-3.5 rounded-xl font-bold text-sm bg-gradient-to-r from-kairos-500 to-kairos-400 text-dark-950 disabled:opacity-40 flex items-center justify-center gap-2",children:[e.jsx(ne,{size:14})," Revisar ",a.length," env√≠o",a.length>1?"s":""]})}),K&&e.jsx(ue,{title:"Confirmar Multi-Send",message:`Enviar ${l.toFixed(6)} ${n?.symbol} a ${a.length} destinatarios`,onConfirm:Q,onCancel:()=>v(!1)})]})}export{ke as default};
