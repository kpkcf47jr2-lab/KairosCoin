import{d as l,j as e,e as ie,S as I,b as V,m,C as F,h as W,w as q,T as M,W as ce,I as oe,aD as le,L as de,s as xe,U as X,P as me,ac as ue,i as he,ag as pe}from"./ui-Bym_0wSS.js";import{u as fe,f as be,p as ge}from"./index-CtS2HjSl.js";import{JsonRpcProvider as je,Wallet as we,Contract as Ne,AbiCoder as ye,ZeroAddress as S,getBytes as J,hexlify as ke}from"./crypto-1JBTrmrY.js";import"./vendor-CCYniLZC.js";const c="0xC84f261c7e7Cffdf3e9972faD88cE59400d5E5A8",C="0xCee44904A6aA94dEa28754373887E07D4B6f4968",ve=["https://bsc-dataseed1.binance.org","https://bsc-dataseed2.binance.org","https://bsc-rpc.publicnode.com","https://rpc.ankr.com/bsc"],Se="0x14D41707269c7D8b8DFa5095b38824a46dA05da3";async function Q(t,a){for(const n of ve)try{const o=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:t,params:a,id:1})})).json();if(o.result!==void 0)return o.result}catch{continue}return null}async function h(t,a){return Q("eth_call",[{to:t,data:a},"latest"])}function Ce(t){if(!t||t==="0x")return[];const a=t.slice(2),n=parseInt(a.slice(64,128),16),u=[];for(let o=0;o<n;o++){const d=128+o*64;u.push("0x"+a.slice(d+24,d+64))}return u}function H(t){return!t||t==="0x"?0:parseInt(t,16)}function Ae(t){if(!t||t==="0x")return"";const a=t.slice(2),n=parseInt(a.slice(0,64),16)*2,u=parseInt(a.slice(n,n+64),16),o=a.slice(n+64,n+64+u*2);let d="";for(let s=0;s<o.length;s+=2)d+=String.fromCharCode(parseInt(o.slice(s,s+2),16));return d}const p={getOwners:"0xa0e67e2b",getThreshold:"0xe75235b8",nonce:"0xaffed0e0",VERSION:"0xffa1ad74",isOwner:"0x2f54bf6e",balanceOf:"0x70a08231"};function Y(t){return"0x"+t.slice(2).toLowerCase().padStart(64,"0")}function Re(){const{navigate:t,activeAddress:a,showToast:n,getActiveAccount:u}=fe(),[o,d]=l.useState(!0),[s,Z]=l.useState(null),[ee,P]=l.useState(!1),[O,se]=l.useState(!1),[te,E]=l.useState(!1),[T,L]=l.useState(""),[R,_]=l.useState(!1),[$,f]=l.useState(""),[G,K]=l.useState(null),b=l.useCallback(async()=>{d(!0);try{const[r,g,i,j,w,x,N]=await Promise.all([h(c,p.getOwners),h(c,p.getThreshold),h(c,p.nonce),h(c,p.VERSION),Q("eth_getBalance",[c,"latest"]),h(Se,p.balanceOf+Y(c).slice(2)),a?h(c,p.isOwner+Y(a).slice(2)):Promise.resolve("0x0")]),y=Ce(r),z=H(g),B=H(i),k=Ae(j),D=w?parseInt(w,16)/1e18:0,v=x&&x!=="0x"&&x!=="0x0000000000000000000000000000000000000000000000000000000000000000"?Number(BigInt(x))/1e18:0,ne=N&&N!=="0x"?H(N)===1:!1;Z({owners:y,threshold:z,nonce:B,version:k,bnbBalance:D,kairosBalance:v}),se(ne)}catch(r){console.error("Failed to load Safe info:",r),n("Error cargando info del Safe","error")}d(!1)},[a,n]);l.useEffect(()=>{b()},[b]);const ae=()=>{navigator.clipboard?.writeText(c),P(!0),n("Direcci√≥n del Safe copiada","success"),setTimeout(()=>P(!1),2e3)},U=()=>{window.open(`https://bscscan.com/address/${c}`,"_blank")},re=async()=>{f(""),K(null);let r;try{r=await ge(T)}catch{f("Contrase√±a incorrecta");return}const g=r.accounts?.find(i=>i.address.toLowerCase()===a.toLowerCase())||r.importedAccounts?.find(i=>i.address.toLowerCase()===a.toLowerCase());if(!g?.privateKey){f("No se encontr√≥ la clave privada de esta wallet");return}_(!0);try{const i=new je("https://bsc-dataseed1.binance.org"),j=new we(g.privateKey,i),w=["function getTransactionHash(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, uint256 _nonce) view returns (bytes32)","function execTransaction(address to, uint256 value, bytes data, uint8 operation, uint256 safeTxGas, uint256 baseGas, uint256 gasPrice, address gasToken, address refundReceiver, bytes signatures) returns (bool)","function nonce() view returns (uint256)"],x=new Ne(c,w,j),y="0x0d582f13"+ye.defaultAbiCoder().encode(["address","uint256"],[C,1]).slice(2),z=await x.nonce(),B=await x.getTransactionHash(c,0,y,0,0,0,0,S,S,z),k=J(await j.signMessage(J(B)));k[64]+=4;const D=ke(k),v=await x.execTransaction(c,0,y,0,0,0,0,S,S,D,{gasLimit:2e5});K(v.hash),n("Transacci√≥n enviada...","success"),await v.wait(),n("Relayer agregado como owner","success"),E(!1),L(""),b()}catch(i){console.error("addOwner error:",i),f(i.reason||i.message||"Error desconocido")}_(!1)};return e.jsxs("div",{className:"h-full flex flex-col bg-dark-950",children:[e.jsxs("div",{className:"flex items-center gap-3 px-5 pt-6 pb-4",children:[e.jsx("button",{onClick:()=>t("dashboard"),className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 transition",children:e.jsx(ie,{size:18,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(I,{size:20,className:"text-kairos-400"}),"Gnosis Safe"]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Multisig Wallet ¬∑ BSC"})]}),e.jsx("button",{onClick:b,className:`p-2 rounded-xl bg-white/5 hover:bg-white/10 transition ${o?"animate-spin":""}`,children:e.jsx(V,{size:16,className:"text-dark-300"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-5 pb-8 space-y-4",children:o&&!s?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(V,{size:32,className:"text-kairos-400 animate-spin mb-4"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Cargando Safe..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-kairos-500/10 to-kairos-600/5 rounded-2xl p-4 border border-kairos-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs font-medium text-kairos-400 uppercase tracking-wider",children:"Safe Address"}),e.jsxs("span",{className:"text-[10px] bg-kairos-500/20 text-kairos-400 px-2 py-0.5 rounded-full",children:["v",s.version]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-mono text-white flex-1 break-all",children:c}),e.jsx("button",{onClick:ae,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 shrink-0",children:ee?e.jsx(F,{size:14,className:"text-green-400"}):e.jsx(W,{size:14,className:"text-dark-300"})}),e.jsx("button",{onClick:U,className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 shrink-0",children:e.jsx(q,{size:14,className:"text-dark-300"})})]})]}),e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05},className:`rounded-2xl p-4 border ${O?"bg-green-500/5 border-green-500/20":"bg-yellow-500/5 border-yellow-500/20"}`,children:e.jsx("div",{className:"flex items-center gap-3",children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center",children:e.jsx(F,{size:20,className:"text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-400",children:"Eres owner de este Safe"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Puedes aprobar y ejecutar transacciones"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-yellow-500/10 flex items-center justify-center",children:e.jsx(M,{size:20,className:"text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-400",children:"No eres owner"}),e.jsx("p",{className:"text-xs text-dark-400",children:"Tu wallet actual no es owner del Safe"})]})]})})}),e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white/[0.03] rounded-2xl p-4 border border-white/5",children:[e.jsxs("h3",{className:"text-xs font-medium text-dark-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:14}),"Balances del Safe"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-500/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-yellow-400",children:"BNB"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"BNB"}),e.jsx("p",{className:"text-[10px] text-dark-400",children:"Native"})]})]}),e.jsx("p",{className:"text-sm font-mono text-white",children:s.bnbBalance.toFixed(4)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-kairos-500/10 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-kairos-400",children:"K"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"KAIROS"}),e.jsxs("p",{className:"text-[10px] text-dark-400",children:["‚âà $",s.kairosBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),e.jsx("p",{className:"text-sm font-mono text-white",children:s.kairosBalance.toLocaleString()})]})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"bg-white/[0.03] rounded-2xl p-4 border border-white/5",children:[e.jsxs("h3",{className:"text-xs font-medium text-dark-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(oe,{size:14}),"Detalles"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{icon:le,label:"Nonce (TXs ejecutadas)",value:s.nonce.toString()}),e.jsx(A,{icon:de,label:"Threshold",value:`${s.threshold} de ${s.owners.length}`}),e.jsx(A,{icon:xe,label:"Red",value:"BNB Smart Chain"}),e.jsx(A,{icon:I,label:"Tipo",value:`Safe v${s.version}`})]})]}),e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white/[0.03] rounded-2xl p-4 border border-white/5",children:[e.jsxs("h3",{className:"text-xs font-medium text-dark-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(X,{size:14}),"Owners (",s.owners.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.owners.map((r,g)=>{const i=a&&r.toLowerCase()===a.toLowerCase();return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl ${i?"bg-kairos-500/10 border border-kairos-500/20":"bg-white/[0.02]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${i?"bg-kairos-500/20":"bg-white/5"}`,children:e.jsx(X,{size:14,className:i?"text-kairos-400":"text-dark-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-mono text-white truncate",children:r}),i&&e.jsx("p",{className:"text-[10px] text-kairos-400 font-medium",children:"T√∫"})]}),e.jsx("button",{onClick:()=>{navigator.clipboard?.writeText(r),n("Direcci√≥n copiada","success")},className:"p-1.5 rounded-lg bg-white/5 hover:bg-white/10 shrink-0",children:e.jsx(W,{size:12,className:"text-dark-400"})})]},r)})})]}),O&&s&&!s.owners.some(r=>r.toLowerCase()===C.toLowerCase())&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.22},children:te?e.jsxs("div",{className:"rounded-2xl bg-white/[0.03] border border-kairos-500/20 p-4 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-kairos-400"}),"Agregar Relayer como Owner #2"]}),e.jsxs("p",{className:"text-[10px] text-dark-400",children:["Esto agregar√° la wallet del backend (",be(C),") como segundo owner del Safe. El backend podr√° hacer mint/burn autom√°tico. T√∫ puedes quitarlo en cualquier momento."]}),e.jsx("input",{type:"password",placeholder:"Contrase√±a del wallet",value:T,onChange:r=>L(r.target.value),className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white placeholder-dark-500 focus:outline-none focus:border-kairos-500/50"}),$&&e.jsx("p",{className:"text-xs text-red-400",children:$}),G&&e.jsx("a",{href:`https://bscscan.com/tx/${G}`,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-kairos-400 underline block",children:"Ver TX en BscScan ‚Üí"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{E(!1),f(""),L("")},className:"flex-1 py-2.5 rounded-xl bg-white/5 text-dark-300 text-sm hover:bg-white/10 transition",disabled:R,children:"Cancelar"}),e.jsx("button",{onClick:re,disabled:!T||R,className:"flex-1 py-2.5 rounded-xl bg-kairos-500 text-dark-950 text-sm font-semibold hover:bg-kairos-400 transition disabled:opacity-50 flex items-center justify-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14,className:"animate-spin"}),"Firmando..."]}):"Confirmar"})]})]}):e.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center gap-3 p-4 rounded-2xl bg-kairos-500/10 border border-kairos-500/20 hover:bg-kairos-500/20 transition",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-kairos-500/20 flex items-center justify-center",children:e.jsx(me,{size:20,className:"text-kairos-400"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-kairos-400",children:"Agregar Relayer Autom√°tico"}),e.jsx("p",{className:"text-[10px] text-dark-400",children:"Permite mint/burn autom√°tico desde el backend"})]}),e.jsx(ue,{size:16,className:"text-kairos-400"})]})}),s&&s.owners.some(r=>r.toLowerCase()===C.toLowerCase())&&e.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.22},className:"rounded-2xl bg-green-500/5 border border-green-500/20 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/10 flex items-center justify-center",children:e.jsx(F,{size:20,className:"text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-400",children:"Relayer Activo"}),e.jsx("p",{className:"text-[10px] text-dark-400",children:"Mint/burn autom√°tico habilitado"})]})]})}),e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},className:"bg-blue-500/5 rounded-2xl p-4 border border-blue-500/10",children:[e.jsxs("h3",{className:"text-xs font-semibold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx(I,{size:14}),"¬øQu√© es un Safe?"]}),e.jsxs("p",{className:"text-xs text-dark-400 leading-relaxed",children:["Un Gnosis Safe es una billetera multifirma en la blockchain. Funciona como una caja fuerte digital: para mover fondos o ejecutar operaciones, se necesitan las firmas de los owners (actualmente ",s.threshold," de ",s.owners.length,"). Esto protege contra hackeos porque incluso si alguien consigue una clave privada, no puede actuar sin las firmas necesarias."]}),e.jsxs("div",{className:"mt-3 space-y-1.5",children:[e.jsx("p",{className:"text-[10px] text-dark-500",children:"üîí Tu Safe se controla SOLO desde tu wallet"}),e.jsx("p",{className:"text-[10px] text-dark-500",children:"üõ°Ô∏è Contratos auditados por la comunidad Safe"}),e.jsx("p",{className:"text-[10px] text-dark-500",children:"üì± Las claves se guardan en tu tel√©fono, no en servidores"})]})]}),e.jsxs("button",{onClick:U,className:"w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-white/[0.03] border border-white/5 hover:bg-white/[0.06] transition",children:[e.jsx(q,{size:14,className:"text-kairos-400"}),e.jsx("span",{className:"text-sm text-kairos-400",children:"Ver en BscScan"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(M,{size:32,className:"text-red-400 mb-4"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Error al cargar el Safe"}),e.jsx("button",{onClick:b,className:"mt-3 px-4 py-2 rounded-xl bg-kairos-500/10 text-kairos-400 text-sm",children:"Reintentar"})]})})]})}function A({icon:t,label:a,value:n}){return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{size:14,className:"text-dark-500"}),e.jsx("span",{className:"text-xs text-dark-400",children:a})]}),e.jsx("span",{className:"text-xs font-medium text-white",children:n})]})}export{Re as default};
