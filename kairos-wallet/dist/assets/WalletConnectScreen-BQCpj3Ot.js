import{d as a,j as e,e as H,T as V,a8 as I,Y as $,ag as w,G as W,an as Y,ao as J,S as M,A as U,m as h,aj as k,L as X}from"./ui-BteoE537.js";import{u as Z,R as ee,U as se,p as te}from"./index-rYYAUsyQ.js";import{setWCHandlers as ae,initWalletConnect as re,getActiveSessions as ne,pair as ie,approveSession as ce,rejectSession as le,handleSessionRequest as oe,rejectSessionRequest as de,disconnectSession as xe}from"./walletconnect-BUHWeTV7.js";import"./vendor-cxSnwWPt.js";import"./crypto-1JBTrmrY.js";import"./walletconnect-BHdiBbF1.js";function Ne(){const{activeAddress:y,activeChainId:me,goBack:q,showToast:r,navigate:pe}=Z(),[j,L]=a.useState([]),[l,b]=a.useState(""),[v,C]=a.useState(!1),[f,D]=a.useState(!1),[S,T]=a.useState(""),[_,R]=a.useState(!1),[n,g]=a.useState(null),[i,d]=a.useState(null),[c,x]=a.useState(""),[z,N]=a.useState(""),[m,p]=a.useState(!1);a.useEffect(()=>{(async()=>{try{ae({onProposal:t=>g(t),onRequest:t=>d(t),onDelete:()=>u()}),await re(),D(!0),u()}catch(t){T(t.message||"Error inicializando WalletConnect")}})()},[]);const u=async()=>{try{const s=await ne();L(s)}catch{}},A=async()=>{if(l.trim()){C(!0);try{await ie(l.trim()),b(""),r("Conectando con dApp...","info")}catch(s){r("Error: "+(s.message||"URI inválido"),"error")}C(!1)}},F=async()=>{if(n){p(!0);try{await ce(n,y,se),r("dApp conectada","success"),g(null),u()}catch(s){r("Error: "+s.message,"error")}p(!1)}},Q=async()=>{if(n){try{await le(n.id)}catch{}g(null)}},E=async()=>{if(!(!i||!c)){N(""),p(!0);try{const s=await te(c),o=[...s.accounts||[],...s.importedAccounts||[]].find(G=>G.address.toLowerCase()===y.toLowerCase());if(!o)throw new Error("Cuenta no encontrada");const P=await oe(i,o.privateKey);P.success?r("Solicitud aprobada","success"):r("Error: "+P.error,"error"),d(null),x("")}catch(s){s.message==="Contraseña incorrecta"?N("Contraseña incorrecta"):(r("Error: "+s.message,"error"),d(null),x(""))}p(!1)}},K=async()=>{if(i){try{await de(i.topic,i.id)}catch{}d(null),x("")}},O=async s=>{try{await xe(s),r("dApp desconectada","success"),u()}catch{r("Error desconectando","error")}},B=s=>{if(!s)return"";const t=s.params?.request?.method||"";return{personal_sign:"Firmar mensaje",eth_sign:"Firmar mensaje",eth_signTypedData:"Firmar datos tipados",eth_signTypedData_v4:"Firmar datos tipados (v4)",eth_sendTransaction:"Enviar transacción",eth_signTransaction:"Firmar transacción"}[t]||t};return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:q,className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(H,{size:20,className:"text-dark-300"})}),e.jsx("h1",{className:"font-bold text-white",children:"WalletConnect"}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-8",children:[S&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 px-3 py-2 rounded-xl bg-red-500/10 border border-red-500/20",children:[e.jsx(V,{size:14,className:"text-red-400 shrink-0"}),e.jsx("span",{className:"text-xs text-red-300",children:S})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(I,{size:16,className:"text-kairos-400"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"Conectar dApp"})]}),e.jsx("p",{className:"text-xs text-dark-400 mb-3",children:"Pega el URI de WalletConnect de cualquier dApp (OpenSea, Uniswap, Aave, etc.)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:s=>b(s.target.value),placeholder:"wc:...",className:"flex-1 bg-white/[0.04] rounded-xl px-4 py-3 text-sm text-white placeholder-dark-500 outline-none border border-white/5 focus:border-kairos-500/50 font-mono text-xs min-w-0",disabled:!f}),e.jsx("button",{onClick:()=>R(!0),className:"px-3 py-3 rounded-xl bg-white/[0.06] hover:bg-white/10 transition-colors shrink-0",children:e.jsx($,{size:16,className:"text-kairos-400"})}),e.jsx("button",{onClick:A,disabled:!l.trim()||v||!f,className:`px-4 py-3 rounded-xl font-bold text-sm shrink-0 transition-all ${l.trim()&&f?"bg-kairos-500 text-dark-950":"bg-white/[0.06] text-dark-500 cursor-not-allowed"}`,children:v?e.jsx(w,{size:16,className:"animate-spin"}):"Conectar"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(W,{size:16,className:"text-kairos-400"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:["Sesiones activas (",j.length,")"]})]}),j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4",children:e.jsx(Y,{size:24,className:"text-dark-400"})}),e.jsx("p",{className:"text-dark-400 text-sm mb-1",children:"Sin conexiones"}),e.jsx("p",{className:"text-dark-500 text-xs",children:"Conecta una dApp usando el URI de arriba"})]}):e.jsx("div",{className:"space-y-2",children:j.map(s=>{const t=s.peer?.metadata||{};return e.jsx("div",{className:"bg-white/[0.03] rounded-xl p-3 border border-white/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.icons?.[0]?e.jsx("img",{src:t.icons[0],alt:"",className:"w-10 h-10 rounded-xl bg-white/5",onError:o=>{o.target.style.display="none"}}):e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center",children:e.jsx(W,{size:20,className:"text-dark-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm text-white truncate",children:t.name||"dApp"}),e.jsx("p",{className:"text-[10px] text-dark-500 truncate",children:t.url||""})]}),e.jsx("button",{onClick:()=>O(s.topic),className:"p-2 rounded-lg hover:bg-red-500/10 transition-colors",title:"Desconectar",children:e.jsx(J,{size:16,className:"text-red-400"})})]})},s.topic)})})]}),e.jsxs("div",{className:"mt-6 flex items-start gap-2 px-3 py-2 rounded-xl bg-kairos-500/5 border border-kairos-500/10",children:[e.jsx(M,{size:14,className:"text-kairos-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-[10px] text-dark-400",children:"Siempre verifica la URL y nombre de la dApp antes de aprobar. Kairos Wallet te pedirá contraseña para cada firma."})]})]}),e.jsx(U,{children:n&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 bg-dark-950/95 backdrop-blur-xl flex items-center justify-center px-5",children:e.jsxs(h.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"w-full max-w-sm bg-dark-800 rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-kairos-500/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(I,{size:24,className:"text-kairos-400"})}),e.jsx("h3",{className:"font-bold text-white text-lg",children:"Solicitud de conexión"}),e.jsxs("p",{className:"text-xs text-dark-400 mt-1",children:[n.params?.proposer?.metadata?.name||"dApp"," quiere conectarse"]}),e.jsx("p",{className:"text-[10px] text-dark-500 mt-1",children:n.params?.proposer?.metadata?.url||""})]}),e.jsxs("div",{className:"mb-4 p-3 rounded-xl bg-white/[0.03] border border-white/5",children:[e.jsx("p",{className:"text-[10px] text-dark-400 mb-2",children:"Permisos solicitados:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{className:"text-xs text-dark-300 flex items-center gap-1",children:[e.jsx(k,{size:10,className:"text-green-400"})," Ver tu dirección"]}),e.jsxs("li",{className:"text-xs text-dark-300 flex items-center gap-1",children:[e.jsx(k,{size:10,className:"text-green-400"})," Solicitar firmas"]}),e.jsxs("li",{className:"text-xs text-dark-300 flex items-center gap-1",children:[e.jsx(k,{size:10,className:"text-green-400"})," Enviar transacciones"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Q,className:"flex-1 py-3 rounded-xl bg-white/[0.06] text-dark-300 font-medium text-sm",children:"Rechazar"}),e.jsx("button",{onClick:F,disabled:m,className:"flex-1 py-3 rounded-xl bg-kairos-500 text-dark-950 font-bold text-sm flex items-center justify-center",children:m?e.jsx(w,{size:16,className:"animate-spin"}):"Aprobar"})]})]})})}),e.jsx(U,{children:i&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 bg-dark-950/95 backdrop-blur-xl flex items-center justify-center px-5",children:e.jsxs(h.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"w-full max-w-sm bg-dark-800 rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-orange-500/10 flex items-center justify-center mx-auto mb-3",children:e.jsx(X,{size:24,className:"text-orange-400"})}),e.jsx("h3",{className:"font-bold text-white text-lg",children:B(i)}),e.jsx("p",{className:"text-xs text-dark-400 mt-1",children:"Confirma con tu contraseña para aprobar"})]}),e.jsx("input",{type:"password",value:c,onChange:s=>{x(s.target.value),N("")},onKeyDown:s=>s.key==="Enter"&&c&&E(),placeholder:"Contraseña de la wallet",className:"w-full bg-white/[0.04] rounded-xl px-4 py-3 text-sm text-white placeholder-dark-500 outline-none border border-white/5 focus:border-kairos-500/50 mb-2",autoFocus:!0}),z&&e.jsx("p",{className:"text-red-400 text-xs mb-2",children:z}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:K,className:"flex-1 py-3 rounded-xl bg-white/[0.06] text-dark-300 font-medium text-sm",children:"Rechazar"}),e.jsx("button",{onClick:E,disabled:!c||m,className:`flex-1 py-3 rounded-xl font-bold text-sm flex items-center justify-center ${c?"bg-kairos-500 text-dark-950":"bg-white/[0.06] text-dark-500 cursor-not-allowed"}`,children:m?e.jsx(w,{size:16,className:"animate-spin"}):"Aprobar"})]})]})})}),e.jsx(ee,{isOpen:_,onClose:()=>R(!1),onScan:s=>{s.startsWith("wc:")?(b(s),r("URI de WalletConnect escaneado","success"),setTimeout(()=>A(),300)):r("QR no es un URI de WalletConnect","error")},title:"Escanear WalletConnect QR"})]})}export{Ne as default};
