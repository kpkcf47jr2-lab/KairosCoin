import{d as n,j as e,e as G,G as w,P as $,C as S,ad as H,p as J,A as M,m as U,X,ax as E,ay as q,T as B}from"./ui-Bym_0wSS.js";import{b as K,u as W,C as x,X as R}from"./index-CtS2HjSl.js";import{JsonRpcProvider as Y}from"./crypto-1JBTrmrY.js";import"./vendor-CCYniLZC.js";const A="kairos_custom_chains";function Q(){try{return JSON.parse(localStorage.getItem(A)||"{}")}catch{return{}}}function z(p){localStorage.setItem(A,JSON.stringify(p))}function ae(){const{t:p}=K(),{activeChainId:u,setActiveChain:k,navigate:I,showToast:i}=W(),[c,g]=n.useState(Q()),[P,o]=n.useState(!1),[m,h]=n.useState(null),[t,l]=n.useState({name:"",chainId:"",rpcUrl:"",symbol:"",blockExplorer:""}),[f,b]=n.useState(!1),[N,d]=n.useState(null),[v,C]=n.useState(!1);Object.entries(c).forEach(([s,a])=>{});const j=()=>{l({name:"",chainId:"",rpcUrl:"",symbol:"",blockExplorer:""}),d(null),b(!1)},T=n.useCallback(async()=>{if(t.rpcUrl){b(!0),d(null);try{const s=new Y(t.rpcUrl),a=await Promise.race([s.getNetwork(),new Promise((r,_)=>setTimeout(()=>_(new Error("timeout")),5e3))]);t.chainId||l(r=>({...r,chainId:a.chainId.toString()})),d("ok")}catch{d("error")}finally{b(!1)}}},[t.rpcUrl,t.chainId]),L=async()=>{if(!t.name||!t.chainId||!t.rpcUrl||!t.symbol){i("Completa todos los campos requeridos","error");return}const s=parseInt(t.chainId);if(x[s]&&!m){i(`La red ${x[s].name} ya existe como red predeterminada`,"error");return}C(!0);try{const a={name:t.name,chainId:s,rpcUrls:[t.rpcUrl],blockExplorerUrl:t.blockExplorer||"",blockExplorerApiUrl:"",icon:"ðŸŒ",nativeCurrency:{name:t.symbol,symbol:t.symbol,decimals:18},isCustom:!0},r={...c,[s]:a};z(r),g(r),R(s),i(`Red ${t.name} guardada`,"success"),o(!1),h(null),j()}catch{i("Error al guardar red","error")}finally{C(!1)}},O=s=>{if(u===s){i("No puedes eliminar la red activa","error");return}const a={...c};delete a[s],z(a),g(a),R(s),i("Red eliminada","success")},D=s=>{const a=c[s];a&&(l({name:a.name,chainId:s.toString(),rpcUrl:a.rpcUrls?.[0]||"",symbol:a.nativeCurrency?.symbol||"",blockExplorer:a.blockExplorerUrl||""}),h(s),o(!0))},F=Object.keys(x).map(Number),y=Object.keys(c).map(Number);return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center gap-3 px-5 py-4",children:[e.jsx("button",{onClick:()=>I("settings"),className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(G,{size:20,className:"text-dark-300"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("h1",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(w,{size:18,className:"text-kairos-400"}),p("networks.title","Redes")]})}),e.jsx("button",{onClick:()=>{j(),h(null),o(!0)},className:"p-2 rounded-xl bg-kairos-500/10 hover:bg-kairos-500/20",children:e.jsx($,{size:16,className:"text-kairos-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-8",children:[e.jsx("p",{className:"text-dark-500 text-xs font-medium mb-2 uppercase tracking-wider",children:"Redes Predeterminadas"}),e.jsx("div",{className:"space-y-1 mb-6",children:F.map(s=>{const a=x[s],r=u===s;return e.jsxs("button",{onClick:()=>k(s),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-colors
                  ${r?"bg-kairos-500/10 border border-kairos-500/20":"hover:bg-white/[0.03]"}`,children:[e.jsx("span",{className:"text-xl",children:a.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-white text-sm font-medium",children:a.name}),e.jsxs("p",{className:"text-dark-500 text-[10px]",children:["Chain ID: ",s]})]}),r&&e.jsx(S,{size:16,className:"text-kairos-400"})]},s)})}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-dark-500 text-xs font-medium mb-2 uppercase tracking-wider",children:"Redes Personalizadas"}),e.jsx("div",{className:"space-y-1 mb-6",children:y.map(s=>{const a=c[s],r=u===s;return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl transition-colors
                      ${r?"bg-kairos-500/10 border border-kairos-500/20":"bg-white/[0.02]"}`,children:[e.jsxs("button",{onClick:()=>k(s),className:"flex-1 flex items-center gap-3 text-left",children:[e.jsx(w,{size:20,className:"text-dark-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:a.name}),e.jsxs("p",{className:"text-dark-500 text-[10px]",children:[a.nativeCurrency?.symbol," Â· Chain ID: ",s]})]})]}),e.jsx("button",{onClick:()=>D(s),className:"p-1.5 rounded-lg hover:bg-white/5",children:e.jsx(H,{size:14,className:"text-dark-400"})}),e.jsx("button",{onClick:()=>O(s),className:"p-1.5 rounded-lg hover:bg-red-500/10",children:e.jsx(J,{size:14,className:"text-red-400"})})]},s)})})]})]}),e.jsx(M,{children:P&&e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/70 flex items-end justify-center",onClick:()=>o(!1),children:e.jsxs(U.div,{initial:{y:400},animate:{y:0},exit:{y:400},onClick:s=>s.stopPropagation(),className:"w-full max-w-md bg-dark-900 rounded-t-3xl p-6 max-h-[85vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:m?"Editar Red":"Agregar Red"}),e.jsx("button",{onClick:()=>{o(!1),j()},className:"p-1",children:e.jsx(X,{size:20,className:"text-dark-400"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-dark-400 text-xs mb-1 block",children:"Nombre de la Red *"}),e.jsx("input",{value:t.name,onChange:s=>l(a=>({...a,name:s.target.value})),placeholder:"e.g. Sepolia Testnet",className:"input-dark w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-dark-400 text-xs mb-1 block",children:"RPC URL *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:t.rpcUrl,onChange:s=>{l(a=>({...a,rpcUrl:s.target.value})),d(null)},placeholder:"https://rpc.example.com",className:"input-dark flex-1"}),e.jsx("button",{onClick:T,disabled:!t.rpcUrl||f,className:"px-3 rounded-xl bg-dark-700 hover:bg-dark-600 text-xs text-dark-300 disabled:opacity-50",children:f?e.jsx(E,{size:14,className:"animate-spin"}):e.jsx(q,{size:14})})]}),N==="ok"&&e.jsxs("p",{className:"text-green-400 text-[10px] mt-1 flex items-center gap-1",children:[e.jsx(S,{size:10})," ConexiÃ³n exitosa"]}),N==="error"&&e.jsxs("p",{className:"text-red-400 text-[10px] mt-1 flex items-center gap-1",children:[e.jsx(B,{size:10})," No se pudo conectar"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-dark-400 text-xs mb-1 block",children:"Chain ID *"}),e.jsx("input",{value:t.chainId,onChange:s=>l(a=>({...a,chainId:s.target.value.replace(/\D/g,"")})),placeholder:"e.g. 11155111",className:"input-dark w-full",disabled:!!m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-dark-400 text-xs mb-1 block",children:"SÃ­mbolo de Moneda *"}),e.jsx("input",{value:t.symbol,onChange:s=>l(a=>({...a,symbol:s.target.value.toUpperCase()})),placeholder:"e.g. ETH",className:"input-dark w-full",maxLength:10})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-dark-400 text-xs mb-1 block",children:"Block Explorer URL (opcional)"}),e.jsx("input",{value:t.blockExplorer,onChange:s=>l(a=>({...a,blockExplorer:s.target.value})),placeholder:"https://sepolia.etherscan.io",className:"input-dark w-full"})]}),e.jsx("button",{onClick:L,disabled:v||!t.name||!t.chainId||!t.rpcUrl||!t.symbol,className:"btn-primary w-full py-3 mt-2 disabled:opacity-50",children:v?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(E,{size:16,className:"animate-spin"})," Guardando..."]}):m?"Guardar Cambios":"Agregar Red"})]})]})})})]})}export{ae as default};
