import{d as N,j as e,e as R,N as S,G as D,aG as B,m as P,ag as H,b as G,k as M,l as J}from"./ui-Bym_0wSS.js";import{U,G as V,a9 as K,C as g,E as _,D as W,F as Y,u as q,I as j,T as I,H as Q,W as F}from"./index-cz92uTWo.js";import{formatEther as X,Contract as Z,formatUnits as ee}from"./crypto-1JBTrmrY.js";import"./vendor-CCYniLZC.js";const T="kairos_crosschain_portfolio",se=6e4;async function te(r,a){try{const o=_(r),h=g[r],l=await o.getBalance(a);return{chainId:r,symbol:h.nativeCurrency.symbol,balance:X(l),isNative:!0}}catch{return{chainId:r,symbol:g[r]?.nativeCurrency?.symbol||"?",balance:"0",isNative:!0}}}async function ae(r,a){const o=W[r]||[],h=[],l=_(r);for(const n of o.slice(0,6))try{const c=await new Z(n.address,Y,l).balanceOf(a),m=ee(c,n.decimals);parseFloat(m)>1e-4&&h.push({chainId:r,address:n.address,symbol:n.symbol,balance:m,decimals:n.decimals,isNative:!1})}catch{}return h}async function E(r){try{const l=JSON.parse(localStorage.getItem(T)||"{}");if(l.address===r&&Date.now()-l.timestamp<se)return l}catch{}const a={chains:{},totalUSD:0,address:r,timestamp:Date.now()},o=U.map(async l=>{const n=g[l];try{const[f,c,m]=await Promise.all([te(l,r),ae(l,r),V(l)]),v=c.filter(u=>!u.isNative).map(u=>u.address);let x={};if(v.length>0)try{x=await K(l,v)}catch{}const p=parseFloat(f.balance)*m;let b=0;const k=c.map(u=>{const s=x[u.address?.toLowerCase()]?.usd||0,i=parseFloat(u.balance)*s;return b+=i,{...u,price:s,usd:i}}),y=p+b;return{chainId:l,chainName:n.name,shortName:n.shortName,color:n.color,native:{...f,price:m,usd:p},tokens:k,totalUSD:y}}catch(f){return{chainId:l,chainName:n.name,shortName:n.shortName,color:n.color,native:{balance:"0",usd:0},tokens:[],totalUSD:0,error:f.message}}}),h=await Promise.allSettled(o);for(const l of h)if(l.status==="fulfilled"&&l.value){const n=l.value;a.chains[n.chainId]=n,a.totalUSD+=n.totalUSD}try{localStorage.setItem(T,JSON.stringify(a))}catch{}return a}const A=["#D4AF37","#22d3ee","#a78bfa","#f472b6","#34d399","#fb923c","#60a5fa","#facc15","#f87171","#94a3b8"],O="kairos_pnl_history";function $(){try{return JSON.parse(localStorage.getItem(O)||"[]")}catch{return[]}}function le(r){const a=$(),o=Date.now();a.length>0&&o-a[a.length-1].t<36e5||(a.push({t:o,v:r}),a.length>720&&a.splice(0,a.length-720),localStorage.setItem(O,JSON.stringify(a)))}function L({slices:r,size:a=160,stroke:o=28}){const h=(a-o)/2,l=2*Math.PI*h,n=a/2,f=a/2;let c=0;return e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[r.map((m,v)=>{const x=l*m.pct,p=`${x} ${l-x}`,b=e.jsx("circle",{cx:n,cy:f,r:h,fill:"none",stroke:m.color,strokeWidth:o,strokeDasharray:p,strokeDashoffset:-c,strokeLinecap:"round",className:"transition-all duration-700"},v);return c+=x,b}),e.jsx("circle",{cx:n,cy:f,r:h-o/2+2,fill:"transparent"})]})}function ie(){const{activeChainId:r,activeAddress:a,balances:o,tokenPrices:h,nativePrice:l,goBack:n,getTotalPortfolioValue:f}=q(),c=f(),[m,v]=N.useState("allocation"),[x,p]=N.useState(null),[b,k]=N.useState(!1);N.useEffect(()=>{c>0&&le(c)},[c]),N.useEffect(()=>{m==="crosschain"&&!x&&a&&(k(!0),E(a).then(s=>p(s)).catch(()=>{}).finally(()=>k(!1)))},[m,a]);const y=N.useMemo(()=>{const s=[];if(o.native){const t=parseFloat(o.native.balance||0),d=t*l;d>.01&&s.push({symbol:o.native.symbol,balance:t,value:d,isNative:!0,token:o.native})}if(o.tokens)for(const t of o.tokens){if(!t.hasBalance)continue;const d=h[t.address.toLowerCase()]?.usd||0,w=parseFloat(t.balance||0),C=w*d;C>.01&&s.push({symbol:t.symbol,balance:w,value:C,price:d,change24h:h[t.address.toLowerCase()]?.change24h||0,isNative:!1,token:t})}s.sort((t,d)=>d.value-t.value);const i=s.reduce((t,d)=>t+d.value,0);return s.map((t,d)=>({...t,pct:i>0?t.value/i:0,color:A[d%A.length]}))},[o,h,l]),u=N.useMemo(()=>{const s=$();if(s.length===0)return{day:0,week:0,month:0};const i=Date.now(),t=d=>{const w=i-d;return(s.find(z=>z.t>=w)||s[0]).v};return{day:c-t(864e5),week:c-t(6048e5),month:c-t(2592e6)}},[c]);return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-dark-800",children:[e.jsx("button",{onClick:n,className:"text-dark-300 hover:text-white",children:e.jsx(R,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"text-kairos-400",size:20}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Portfolio"})]})]}),e.jsx("div",{className:"flex gap-1 p-1 mx-4 mt-4 rounded-xl bg-white/5",children:[{key:"allocation",label:"Tokens",icon:S},{key:"crosschain",label:"Multi-Chain",icon:D},{key:"pnl",label:"P&L",icon:B}].map(s=>e.jsxs("button",{onClick:()=>v(s.key),className:`flex-1 py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-1 ${m===s.key?"bg-kairos-500/15 text-kairos-400":"text-dark-400"}`,children:[e.jsx(s.icon,{size:12})," ",s.label]},s.key))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m==="allocation"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center py-4 relative",children:y.length>0?e.jsxs("div",{className:"relative",children:[e.jsx(L,{slices:y}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Total"}),e.jsx("p",{className:"text-white font-bold text-lg",children:j(c)})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"mx-auto text-dark-600",size:48}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Sin activos con valor"})]})}),e.jsx("div",{className:"space-y-2",children:y.map((s,i)=>e.jsxs(P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:i*.05},className:"flex items-center gap-3 bg-dark-800/50 rounded-xl p-3 border border-dark-700/50",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:s.color}}),e.jsx(I,{token:s.token,chainId:r,size:28}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-semibold",children:s.symbol}),e.jsx("p",{className:"text-dark-500 text-xs",children:Q(s.balance.toString())})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:j(s.value)}),e.jsxs("p",{className:"text-dark-400 text-xs",children:[(s.pct*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"w-12 h-1.5 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${s.pct*100}%`,backgroundColor:s.color}})})]},s.symbol))})]}),m==="crosschain"&&e.jsx(e.Fragment,{children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"},children:e.jsx(H,{className:"mx-auto text-kairos-400",size:32})}),e.jsx("p",{className:"text-dark-400 text-sm mt-3",children:"Escaneando 6 blockchains..."})]}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Portfolio Total (6 Chains)"}),e.jsx("p",{className:"text-white font-bold text-2xl mt-1",children:j(x.totalUSD)})]}),(()=>{const s=U.map(i=>({chainId:i,...x.chains[i],pct:x.totalUSD>0?(x.chains[i]?.totalUSD||0)/x.totalUSD:0,color:g[i]?.color||"#888"})).filter(i=>i.totalUSD>.01);return s.length>0?e.jsx("div",{className:"flex justify-center py-2 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{slices:s,size:140,stroke:24}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(D,{className:"text-dark-500",size:16}),e.jsx("p",{className:"text-dark-400 text-[10px]",children:"6 chains"})]})]})}):null})(),e.jsx("div",{className:"space-y-2",children:U.map((s,i)=>{const t=x.chains[s];return!t||t.totalUSD<.01?e.jsxs("div",{className:"flex items-center gap-3 bg-dark-800/30 rounded-xl p-3 border border-dark-700/30 opacity-50",children:[e.jsx(F,{chainId:s,size:24}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-dark-400 text-sm",children:g[s].shortName})}),e.jsx("p",{className:"text-dark-600 text-xs",children:"$0.00"})]},s):e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.05},className:"bg-dark-800/50 rounded-xl p-3 border border-dark-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{chainId:s,size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm font-semibold",children:t.chainName}),e.jsxs("p",{className:"text-dark-500 text-xs",children:[t.tokens?.length||0," token",(t.tokens?.length||0)!==1?"s":""," con balance"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:j(t.totalUSD)}),e.jsxs("p",{className:"text-dark-400 text-xs",children:[x.totalUSD>0?(t.totalUSD/x.totalUSD*100).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"ml-9 space-y-1",children:[t.native&&parseFloat(t.native.balance)>1e-4&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-dark-400",children:t.native.symbol}),e.jsxs("span",{className:"text-dark-300",children:[parseFloat(t.native.balance).toFixed(4)," ¬∑ ",j(t.native.usd)]})]}),(t.tokens||[]).map(d=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-dark-400",children:d.symbol}),e.jsxs("span",{className:"text-dark-300",children:[parseFloat(d.balance).toFixed(4)," ¬∑ ",j(d.usd)]})]},d.address))]})]},s)})}),e.jsxs("button",{onClick:()=>{p(null),k(!0),E(a).then(s=>p(s)).finally(()=>k(!1))},className:"w-full py-2.5 rounded-xl bg-dark-800/50 text-dark-400 text-xs flex items-center justify-center gap-1.5 border border-dark-700/30",children:[e.jsx(G,{size:12})," Actualizar portfolio multi-chain"]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"mx-auto text-dark-600",size:40}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Error cargando datos multi-chain"})]})}),m==="pnl"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Valor del Portfolio"}),e.jsx("p",{className:"text-white font-bold text-2xl mt-1",children:j(c)})]}),e.jsx("div",{className:"space-y-3",children:[{label:"√öltimas 24h",value:u.day,emoji:"üìÖ"},{label:"√öltimos 7 d√≠as",value:u.week,emoji:"üìÜ"},{label:"√öltimos 30 d√≠as",value:u.month,emoji:"üóìÔ∏è"}].map(s=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${s.value>=0?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:s.emoji}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:s.label}),e.jsx("p",{className:"text-dark-500 text-xs",children:"Ganancia/P√©rdida"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.value>=0?e.jsx(M,{size:14,className:"text-green-400"}):e.jsx(J,{size:14,className:"text-red-400"}),e.jsxs("span",{className:`font-bold text-sm ${s.value>=0?"text-green-400":"text-red-400"}`,children:[s.value>=0?"+":"",j(Math.abs(s.value))]})]}),c>0&&e.jsxs("p",{className:`text-xs ${s.value>=0?"text-green-500/60":"text-red-500/60"}`,children:[s.value>=0?"+":"",(s.value/c*100).toFixed(2),"%"]})]})]},s.label))}),e.jsx("div",{className:"bg-dark-800/30 rounded-xl p-3 border border-dark-700/30",children:e.jsx("p",{className:"text-dark-500 text-xs text-center",children:"üí° Los datos P&L se calculan desde snapshots de tu portfolio. Cuanto m√°s uses la wallet, m√°s preciso ser√°."})})]})]})]})}export{ie as default};
