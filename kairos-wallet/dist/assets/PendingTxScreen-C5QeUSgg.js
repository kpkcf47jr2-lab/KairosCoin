import{d as r,j as e,e as B,T as F,C as K,m as C,ax as k,az as T,Z as A,O as M,aA as O,u as R,A as Z,w as _}from"./ui-Bym_0wSS.js";import{u as V,f as m,C as q,E as G,p as J,_ as Q,$ as W,a0 as Y}from"./index-Cv82Q9rX.js";import{P as ee}from"./PasswordConfirm-CDK6JU-c.js";import"./vendor-CCYniLZC.js";import"./crypto-1JBTrmrY.js";function re(){const{activeChainId:t,pendingTransactions:d,goBack:S,showToast:h,getActiveAccount:P,resolvePendingTx:p,addPendingTx:N}=V(),y=q[t],i=P(),[z,E]=r.useState(null),[c,u]=r.useState(null),[l,f]=r.useState(null),[I,g]=r.useState(!1),[U,v]=r.useState(null),[b,H]=r.useState({});r.useEffect(()=>{if(d.length===0)return;const s=async()=>{for(const n of d)if(n.chainId===t)try{const o=await G(n.chainId).getTransactionReceipt(n.hash);o&&(H(L=>({...L,[n.hash]:o.status===1?"confirmed":"failed"})),p(n.hash,o.status===1?"confirmed":"failed"))}catch{}};s();const a=setInterval(s,1e4);return()=>clearInterval(a)},[d,t]);const j=d.filter(s=>s.chainId===t),w=(s,a)=>{f(s),u(a),g(!0)},$=async s=>{if(!(!l||!c||!i)){g(!1),v(l.hash);try{await J(s);let a;c==="speedup"?(a=await Q(t,i.privateKey,l),h("TX acelerada enviada","success"),N({...l,hash:a.hash,timestamp:Date.now(),status:"pending",isSpeedUp:!0,originalHash:l.hash})):(a=await W(t,i.privateKey,l.nonce),h("Cancelación enviada","success"),N({hash:a.hash,from:i.address,to:i.address,value:"0",chainId:t,timestamp:Date.now(),status:"cancelling",isCancellation:!0,originalHash:l.hash})),Y(t,a.hash).then(n=>{p(a.hash,n.status),p(l.hash,c==="cancel"?"cancelled":n.status)})}catch(a){h("Error: "+(a.reason||a.message),"error")}v(null),f(null),u(null)}},D=s=>{switch(b[s.hash]||s.status){case"confirmed":return e.jsx("span",{className:"text-[10px] bg-green-500/15 text-green-400 px-2 py-0.5 rounded-full",children:"Confirmada"});case"failed":return e.jsx("span",{className:"text-[10px] bg-red-500/15 text-red-400 px-2 py-0.5 rounded-full",children:"Fallida"});case"cancelling":return e.jsx("span",{className:"text-[10px] bg-orange-500/15 text-orange-400 px-2 py-0.5 rounded-full",children:"Cancelando..."});default:return e.jsxs("span",{className:"text-[10px] bg-yellow-500/15 text-yellow-400 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(k,{size:8,className:"animate-spin"})," Pendiente"]})}},X=s=>{const a=Date.now()-s;return a<6e4?"Hace segundos":a<36e5?`Hace ${Math.floor(a/6e4)} min`:`Hace ${Math.floor(a/36e5)}h`};return e.jsxs("div",{className:"screen-container px-6 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:S,className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center",children:e.jsx(B,{size:20})}),e.jsx("h2",{className:"text-lg font-bold flex-1",children:"Transacciones Pendientes"}),e.jsx("div",{className:"px-2 py-1 rounded-lg bg-yellow-500/15 text-yellow-400 text-xs font-bold",children:j.length})]}),e.jsxs("div",{className:"glass-card p-3 mb-4 flex items-start gap-2",children:[e.jsx(F,{size:16,className:"text-kairos-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-dark-200 font-medium",children:"Acciones reales en cadena"}),e.jsx("p",{className:"text-[10px] text-dark-400 mt-0.5",children:"Acelerar re-envía la TX con más gas. Cancelar envía 0 a tu propia dirección con el mismo nonce. Ambas cuestan gas real."})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:j.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{size:24,className:"text-green-400"})}),e.jsx("p",{className:"text-dark-300 text-sm",children:"No hay transacciones pendientes"}),e.jsx("p",{className:"text-dark-500 text-xs mt-1",children:"Todas las transacciones están confirmadas"})]}):j.map((s,a)=>{const n=z===s.hash,x=U===s.hash,o=!b[s.hash]&&s.status==="pending";return e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.05},className:"glass-card overflow-hidden",children:[e.jsxs("button",{onClick:()=>E(n?null:s.hash),className:"w-full flex items-center gap-3 p-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${s.isCancellation?"bg-red-500/10":s.isSpeedUp?"bg-yellow-500/10":"bg-blue-500/10"}`,children:x?e.jsx(k,{size:18,className:"text-kairos-400 animate-spin"}):s.isCancellation?e.jsx(T,{size:18,className:"text-red-400"}):s.isSpeedUp?e.jsx(A,{size:18,className:"text-yellow-400"}):e.jsx(M,{size:18,className:"text-blue-400"})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s.isCancellation?"Cancelación":s.isSpeedUp?"Acelerada":`Envío → ${m(s.to,4)}`}),D(s)]}),e.jsxs("span",{className:"text-dark-500 text-xs",children:[s.value," ",y.nativeCurrency.symbol," · ",X(s.timestamp)]})]}),n?e.jsx(O,{size:16,className:"text-dark-400"}):e.jsx(R,{size:16,className:"text-dark-400"})]}),e.jsx(Z,{children:n&&e.jsx(C.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-white/5",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Hash"}),e.jsxs("a",{href:`${y.blockExplorerUrl}/tx/${s.hash}`,target:"_blank",rel:"noopener noreferrer",className:"text-kairos-400 font-mono flex items-center gap-1",children:[m(s.hash,6),e.jsx(_,{size:10})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"De"}),e.jsx("span",{className:"font-mono text-dark-200",children:m(s.from,6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Para"}),e.jsx("span",{className:"font-mono text-dark-200",children:m(s.to,6)})]}),s.nonce!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Nonce"}),e.jsx("span",{className:"text-dark-200",children:s.nonce})]})]}),o&&!s.isCancellation&&!s.isSpeedUp&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs("button",{onClick:()=>w(s,"speedup"),disabled:x,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-yellow-500/10 border border-yellow-500/20 text-yellow-400 text-xs font-medium disabled:opacity-40",children:[e.jsx(A,{size:14}),"Acelerar (+30% gas)"]}),e.jsxs("button",{onClick:()=>w(s,"cancel"),disabled:x,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-xs font-medium disabled:opacity-40",children:[e.jsx(T,{size:14}),"Cancelar"]})]})]})})})]},s.hash)})}),e.jsx(ee,{isOpen:I,onConfirm:$,onCancel:()=>{g(!1),f(null),u(null)},title:c==="speedup"?"Acelerar Transacción":"Cancelar Transacción",message:c==="speedup"?"Esto re-enviará la transacción con 30% más gas. Cuesta gas real.":"Esto enviará una transacción vacía con el mismo nonce para reemplazarla. Cuesta gas real.",confirmText:c==="speedup"?"Acelerar":"Cancelar TX"})]})}export{re as default};
