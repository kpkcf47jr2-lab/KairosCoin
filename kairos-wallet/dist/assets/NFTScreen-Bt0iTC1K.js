import{d as h,j as e,e as E,b as D,ag as S,z as y,m as T,A as O,w as F,C as U,t as v,T as B}from"./ui-Bym_0wSS.js";import{C as $,E as j,u as I,f as M,V as H}from"./index-CtS2HjSl.js";import{Contract as k,Wallet as V,isAddress as K}from"./crypto-1JBTrmrY.js";import"./vendor-CCYniLZC.js";const z=["function tokenURI(uint256 tokenId) view returns (string)","function ownerOf(uint256 tokenId) view returns (address)","function name() view returns (string)","function symbol() view returns (string)","function balanceOf(address owner) view returns (uint256)","function safeTransferFrom(address from, address to, uint256 tokenId)","function transferFrom(address from, address to, uint256 tokenId)"],R=["function uri(uint256 id) view returns (string)","function balanceOf(address account, uint256 id) view returns (uint256)","function safeTransferFrom(address from, address to, uint256 id, uint256 amount, bytes data)"],w="CMXM58DR5E27T339UMDJAHPSZZA59S5Q1C",A={56:w,1:w,137:w,42161:w,8453:w},C={},W=120*1e3;async function P(s,r){const o=`${s}_${r.toLowerCase()}`,n=C[o];if(n&&Date.now()-n.timestamp<W)return n.data;const l=$[s];if(!l?.blockExplorerApiUrl)return[];const c=[];try{const d=`${l.blockExplorerApiUrl}?module=account&action=tokennfttx&address=${r}&startblock=0&endblock=99999999&sort=desc&apikey=${A[s]||""}`,m=await(await fetch(d)).json();if(m.status==="1"&&m.result){const x=new Map;for(const t of m.result){const i=`${t.contractAddress}_${t.tokenID}`;t.to.toLowerCase()===r.toLowerCase()?x.has(i)||x.set(i,{contractAddress:t.contractAddress,tokenId:t.tokenID,name:t.tokenName||"NFT",symbol:t.tokenSymbol||"NFT",blockNumber:parseInt(t.blockNumber)}):x.delete(i)}const p=Array.from(x.values()).slice(0,20);for(const t of p)try{const i=await q(s,t.contractAddress,t.tokenId);c.push({...t,image:i?.image||null,nftName:i?.name||`${t.name} #${t.tokenId}`,description:i?.description||"",attributes:i?.attributes||[]})}catch{c.push({...t,image:null,nftName:`${t.name} #${t.tokenId}`,description:"",attributes:[]})}}}catch(d){console.error("Error fetching NFTs:",d)}try{const d=`${l.blockExplorerApiUrl}?module=account&action=token1155tx&address=${r}&startblock=0&endblock=99999999&sort=desc&apikey=${A[s]||""}`,m=await(await fetch(d)).json();if(m.status==="1"&&m.result){const x=new Map;for(const t of m.result){const i=`${t.contractAddress}_${t.tokenID}`;t.to.toLowerCase()===r.toLowerCase()?x.has(i)||x.set(i,{contractAddress:t.contractAddress,tokenId:t.tokenID,name:t.tokenName||"ERC-1155",symbol:t.tokenSymbol||"ERC-1155",blockNumber:parseInt(t.blockNumber),tokenType:"ERC-1155",tokenValue:t.tokenValue||"1"}):x.delete(i)}const p=Array.from(x.values()).slice(0,15);for(const t of p)try{const i=j(s),b=await new k(t.contractAddress,R,i).balanceOf(r,t.tokenId);if(b===0n)continue;const N=await J(s,t.contractAddress,t.tokenId);c.push({...t,balance:b.toString(),image:N?.image||null,nftName:N?.name||`${t.name} #${t.tokenId}`,description:N?.description||"",attributes:N?.attributes||[]})}catch{c.push({...t,balance:t.tokenValue,image:null,nftName:`${t.name} #${t.tokenId}`,description:"",attributes:[]})}}}catch(d){console.error("Error fetching ERC-1155 NFTs:",d)}const u=c;return C[o]={data:u,timestamp:Date.now()},u}async function q(s,r,o){try{const n=j(s);let c=await new k(r,z,n).tokenURI(o);return await L(c)}catch{return null}}async function J(s,r,o){try{const n=j(s);let c=await new k(r,R,n).uri(o);return c=c.replace("{id}",BigInt(o).toString(16).padStart(64,"0")),await L(c)}catch{return null}}async function L(s){if(!s)return null;try{if(s.startsWith("ipfs://")&&(s=s.replace("ipfs://","https://ipfs.io/ipfs/")),s.startsWith("data:application/json;base64,")){const n=atob(s.split(",")[1]);return JSON.parse(n)}if(s.startsWith("data:application/json")){const n=s.split(",").slice(1).join(",");return JSON.parse(decodeURIComponent(n))}const o=await(await fetch(s,{signal:AbortSignal.timeout(1e4)})).json();return o.image?.startsWith("ipfs://")&&(o.image=o.image.replace("ipfs://","https://ipfs.io/ipfs/")),o}catch{return null}}async function Y(s,r,o,n,l){const c=j(s),u=new V(r,c),d=new k(o,z,u);try{return{hash:(await d["safeTransferFrom(address,address,uint256)"](u.address,l,n)).hash,status:"pending"}}catch{return{hash:(await d.transferFrom(u.address,l,n)).hash,status:"pending"}}}function Z(s,r){const o=`${s}_${r.toLowerCase()}`;delete C[o]}function se(){const{activeAddress:s,activeChainId:r,goBack:o}=I(),n=$[r],[l,c]=h.useState([]),[u,d]=h.useState(!0),[a,m]=h.useState(null),x=async()=>{d(!0);try{const t=await P(r,s);c(t)}catch{}d(!1)};h.useEffect(()=>{x()},[r,s]);const p=()=>{Z(r,s),x()};return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:o,className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(E,{size:20,className:"text-dark-300"})}),e.jsx("h1",{className:"font-bold text-white",children:"NFTs"}),e.jsx("button",{onClick:p,className:"p-2 -mr-2 rounded-xl hover:bg-white/5",children:e.jsx(D,{size:18,className:`text-dark-300 ${u?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-8",children:[u&&l.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(S,{size:32,className:"text-kairos-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Buscando tus NFTs..."}),e.jsx("p",{className:"text-dark-500 text-[10px] mt-1",children:"Esto puede tomar unos segundos"})]}),!u&&l.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{size:24,className:"text-dark-400"})}),e.jsx("p",{className:"text-dark-400 text-sm mb-1",children:"No se encontraron NFTs"}),e.jsxs("p",{className:"text-dark-500 text-xs",children:["Tus NFTs ERC-721 en ",n.shortName," aparecerán aquí"]})]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-dark-400 mb-3",children:[l.length," NFT",l.length!==1?"s":""," en ",n.shortName]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.map((t,i)=>e.jsxs(T.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:i*.05},onClick:()=>m(t),className:"bg-white/[0.03] rounded-2xl overflow-hidden border border-white/5 hover:border-kairos-500/30 transition-colors text-left",children:[e.jsxs("div",{className:"aspect-square bg-white/[0.02] relative overflow-hidden",children:[t.image?e.jsx("img",{src:t.image,alt:t.nftName,className:"w-full h-full object-cover",loading:"lazy",onError:f=>{f.target.style.display="none",f.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:`absolute inset-0 items-center justify-center bg-gradient-to-br from-kairos-500/10 to-purple-500/10 ${t.image?"hidden":"flex"}`,children:e.jsx(y,{size:32,className:"text-dark-500"})})]}),e.jsxs("div",{className:"p-2.5",children:[e.jsx("p",{className:"text-xs font-semibold text-white truncate",children:t.nftName}),e.jsx("p",{className:"text-[10px] text-dark-500 truncate",children:t.name})]})]},`${t.contractAddress}_${t.tokenId}`))})]})]}),e.jsx(O,{children:a&&e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 bg-dark-950/95 backdrop-blur-xl overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:()=>m(null),className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(E,{size:20,className:"text-dark-300"})}),e.jsx("h2",{className:"font-bold text-white text-sm truncate max-w-[200px]",children:a.nftName}),e.jsx("a",{href:`${n.blockExplorerUrl}/token/${a.contractAddress}?a=${a.tokenId}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 -mr-2 rounded-xl hover:bg-white/5",children:e.jsx(F,{size:18,className:"text-dark-400"})})]}),e.jsxs("div",{className:"px-5 pb-8",children:[e.jsx("div",{className:"rounded-2xl overflow-hidden bg-white/[0.02] mb-4 border border-white/5",children:a.image?e.jsx("img",{src:a.image,alt:a.nftName,className:"w-full object-contain max-h-80"}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-gradient-to-br from-kairos-500/10 to-purple-500/10",children:e.jsx(y,{size:64,className:"text-dark-500"})})}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:a.nftName}),e.jsxs("p",{className:"text-xs text-dark-400 mb-3",children:[a.name," (",a.symbol,")"]}),a.description&&e.jsx("p",{className:"text-xs text-dark-300 mb-4 leading-relaxed",children:a.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white/[0.03] rounded-xl p-3 border border-white/5",children:[e.jsx("span",{className:"text-xs text-dark-400",children:"Contrato"}),e.jsx("span",{className:"text-xs text-dark-200 font-mono",children:M(a.contractAddress,6)})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white/[0.03] rounded-xl p-3 border border-white/5",children:[e.jsx("span",{className:"text-xs text-dark-400",children:"Token ID"}),e.jsxs("span",{className:"text-xs text-dark-200",children:["#",a.tokenId]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white/[0.03] rounded-xl p-3 border border-white/5",children:[e.jsx("span",{className:"text-xs text-dark-400",children:"Red"}),e.jsxs("span",{className:"text-xs text-dark-200",children:[n.icon," ",n.name]})]})]}),a.attributes?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-xs text-dark-400 uppercase tracking-wider mb-2",children:"Atributos"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:a.attributes.map((t,i)=>e.jsxs("div",{className:"bg-white/[0.03] rounded-xl p-2.5 border border-white/5 text-center",children:[e.jsx("p",{className:"text-[10px] text-dark-500 uppercase",children:t.trait_type}),e.jsx("p",{className:"text-xs font-semibold text-white truncate",children:t.value})]},i))})]}),e.jsx(Q,{nft:a,chainId:r,chain:n,onSuccess:()=>{m(null),p()}})]})]})})]})}function Q({nft:s,chainId:r,chain:o,onSuccess:n}){const{vault:l,showToast:c}=I(),[u,d]=h.useState(!1),[a,m]=h.useState(""),[x,p]=h.useState(!1),[t,i]=h.useState(null),[f,b]=h.useState(""),N=h.useCallback(async()=>{if(b(""),!a||!K(a)){b("Dirección inválida");return}p(!0);try{const g=await H(l,r),_=await Y(r,g.privateKey,s.contractAddress,s.tokenId,a);i(_.hash),c("NFT enviado exitosamente","success")}catch(g){b(g.reason||g.message||"Error al enviar NFT"),c("Error al enviar NFT","error")}finally{p(!1)}},[a,l,r,s,c]);return t?e.jsxs("div",{className:"rounded-2xl bg-green-500/5 border border-green-500/10 p-4 text-center",children:[e.jsx(U,{size:28,className:"text-green-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-bold text-white mb-1",children:"¡NFT Enviado!"}),e.jsxs("a",{href:`${o.blockExplorerUrl}/tx/${t}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-kairos-400 hover:underline",children:["Ver en Explorer ",e.jsx(F,{size:10})]}),e.jsx("button",{onClick:n,className:"block w-full mt-3 py-2.5 rounded-xl text-sm font-bold text-white bg-kairos-500 hover:bg-kairos-600 transition-colors",children:"Cerrar"})]}):u?e.jsxs("div",{className:"rounded-2xl bg-white/[0.02] border border-white/5 p-4 space-y-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-white flex items-center gap-2",children:[e.jsx(v,{size:14,className:"text-kairos-400"}),"Enviar ",s.nftName]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-dark-400 uppercase tracking-wider mb-1 block",children:"Dirección destino"}),e.jsx("input",{type:"text",value:a,onChange:g=>m(g.target.value),placeholder:"0x...",className:"w-full px-3 py-2.5 rounded-xl text-sm font-mono bg-white/[0.04] border border-white/[0.08] outline-none focus:border-kairos-500/30 text-white placeholder:text-dark-500"})]}),f&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-red-500/5 border border-red-500/10",children:[e.jsx(B,{size:12,className:"text-red-400"}),e.jsx("span",{className:"text-xs text-red-400",children:f})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2.5 rounded-xl text-sm font-bold text-dark-400 bg-white/[0.04] hover:bg-white/[0.06] transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:N,disabled:x,className:"flex-1 py-2.5 rounded-xl text-sm font-bold text-white flex items-center justify-center gap-2 transition-all hover:opacity-90 disabled:opacity-50",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[x?e.jsx(S,{size:14,className:"animate-spin"}):e.jsx(v,{size:14}),x?"Enviando...":"Enviar"]})]})]}):e.jsxs("button",{onClick:()=>d(!0),className:"w-full py-3 rounded-xl text-sm font-bold text-white flex items-center justify-center gap-2 transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx(v,{size:16}),"Enviar NFT"]})}export{se as default};
