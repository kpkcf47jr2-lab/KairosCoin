import{d as i,j as s,e as E,X as H,a1 as b,D as F,b as k,m as v,a2 as A,a3 as M,a4 as R,w as q}from"./ui-Bym_0wSS.js";import{u as m,g as B,a as Q,f as V}from"./index-Cv82Q9rX.js";import{e as U}from"./export-DnzSrfGC.js";import"./vendor-CCYniLZC.js";import"./crypto-1JBTrmrY.js";function O(){const{activeAddress:c,activeChainId:o,goBack:S,navigate:T,showToast:C}=m(),I=m(e=>e.setTxDetailData),u=m(e=>e.recentTransactions),f=m(e=>e.pendingTransactions),[p,D]=i.useState([]),[d,L]=i.useState([]),[g,j]=i.useState(!0),[h,z]=i.useState("all"),[r,w]=i.useState(""),[x,$]=i.useState(!1);i.useEffect(()=>{y()},[c,o]);const y=async()=>{j(!0);try{const[e,a]=await Promise.all([B(o,c),Q(o,c)]);D(e),L(a)}catch(e){console.error("Failed to load history:",e)}j(!1)},l=i.useMemo(()=>{const e=new Set,a=[];for(const t of f)(t.chainId===o||!t.chainId)&&(e.has(t.hash)||(e.add(t.hash),a.push({...t,isPending:!0,timestamp:t.timestamp||Date.now()})));for(const t of p)e.has(t.hash)||(e.add(t.hash),a.push(t));for(const t of u)(t.chainId===o||!t.chainId)&&!e.has(t.hash)&&(e.add(t.hash),a.push(t));return a.sort((t,n)=>(n.timestamp||0)-(t.timestamp||0)),a},[p,u,f,o]),N=i.useMemo(()=>{const e=h==="tokens"?d:l;if(!r.trim())return e;const a=r.toLowerCase();return e.filter(t=>t.hash?.toLowerCase().includes(a)||t.from?.toLowerCase().includes(a)||t.to?.toLowerCase().includes(a)||t.tokenSymbol?.toLowerCase().includes(a)||t.value?.toString().includes(a))},[l,d,h,r]),P=e=>{if(!e)return"";const a=new Date(e),n=new Date-a;return n<6e4?"Ahora mismo":n<36e5?`Hace ${Math.floor(n/6e4)} min`:n<864e5?`Hace ${Math.floor(n/36e5)}h`:n<6048e5?`Hace ${Math.floor(n/864e5)}d`:a.toLocaleDateString("es-ES",{day:"numeric",month:"short"})};return s.jsxs("div",{className:"screen-container px-6 py-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("button",{onClick:S,className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center",children:s.jsx(E,{size:20})}),s.jsx("h2",{className:"text-lg font-bold flex-1",children:"Historial"}),s.jsx("button",{onClick:()=>{$(!x),w("")},className:"w-9 h-9 rounded-xl bg-white/5 flex items-center justify-center",children:x?s.jsx(H,{size:16,className:"text-dark-300"}):s.jsx(b,{size:16,className:"text-dark-300"})}),l.length>0&&s.jsx("button",{onClick:()=>{const e=[...l,...d],a=U(e,o,c);C(`${a} transacciones exportadas`,"success")},className:"w-9 h-9 rounded-xl bg-white/5 flex items-center justify-center",title:"Exportar CSV",children:s.jsx(F,{size:16,className:"text-dark-300"})}),s.jsx("button",{onClick:y,className:"w-9 h-9 rounded-xl bg-white/5 flex items-center justify-center",children:s.jsx(k,{size:16,className:`text-dark-300 ${g?"animate-spin":""}`})})]}),x&&s.jsx(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(b,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-dark-400 pointer-events-none"}),s.jsx("input",{type:"text",value:r,onChange:e=>w(e.target.value),placeholder:"Buscar por hash, dirección o token...",className:"glass-input pl-10 pr-4 text-sm",autoFocus:!0,style:{color:"#ffffff",WebkitTextFillColor:"#ffffff"}})]})}),s.jsx("div",{className:"flex gap-1 p-1 rounded-xl bg-white/5 mb-4",children:[{key:"all",label:`Todas (${l.length})`},{key:"tokens",label:`Tokens (${d.length})`}].map(e=>s.jsx("button",{onClick:()=>z(e.key),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${h===e.key?"bg-kairos-500/15 text-kairos-400":"text-dark-400"}`,children:e.label},e.key))}),s.jsx("div",{className:"flex-1 overflow-y-auto -mx-1",children:g?s.jsx("div",{className:"space-y-3 px-1",children:[1,2,3,4,5].map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 animate-pulse",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-white/5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-4 w-24 bg-white/5 rounded mb-1"}),s.jsx("div",{className:"h-3 w-32 bg-white/5 rounded"})]}),s.jsx("div",{className:"h-4 w-16 bg-white/5 rounded"})]},e))}):N.length===0?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-4",children:s.jsx(A,{size:24,className:"text-dark-400"})}),s.jsx("p",{className:"text-dark-400 text-sm",children:r?"Sin resultados para esta búsqueda":"No hay transacciones todavía"}),s.jsx("p",{className:"text-dark-500 text-xs mt-1",children:r?"Intenta con otro término":"Las transacciones aparecerán aquí"})]}):s.jsx("div",{className:"space-y-1 px-1",children:N.map((e,a)=>s.jsxs(v.button,{onClick:()=>{I(e),T("txdetail")},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.03},className:"flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-all w-full text-left",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${e.isPending?"bg-yellow-500/10":e.isIncoming?"bg-green-500/10":"bg-blue-500/10"}`,children:e.isPending?s.jsx(k,{size:18,className:"text-yellow-400 animate-spin"}):e.isIncoming?s.jsx(M,{size:18,className:"text-green-400"}):s.jsx(R,{size:18,className:"text-blue-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-medium text-sm",children:e.isPending?"Pendiente":e.isIncoming?"Recibido":"Enviado"}),e.tokenSymbol&&s.jsx("span",{className:"text-dark-400 text-xs",children:e.tokenSymbol}),e.isPending&&s.jsx("span",{className:"text-yellow-400 text-[10px] bg-yellow-500/10 px-1.5 py-0.5 rounded animate-pulse",children:"Pendiente"}),e.status==="failed"&&s.jsx("span",{className:"text-red-400 text-[10px] bg-red-500/10 px-1.5 py-0.5 rounded",children:"Fallida"})]}),s.jsxs("span",{className:"text-dark-400 text-xs",children:[e.isIncoming?"De: ":"Para: ",V(e.isIncoming?e.from:e.to,4)," · ",P(e.timestamp)]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("span",{className:`font-semibold text-sm ${e.isIncoming?"text-green-400":"text-white"}`,children:[e.isIncoming?"+":"-",parseFloat(e.value).toFixed(4)]}),s.jsx(q,{size:10,className:"text-dark-500 ml-1 inline"})]})]},e.hash+a))})})]})}export{O as default};
