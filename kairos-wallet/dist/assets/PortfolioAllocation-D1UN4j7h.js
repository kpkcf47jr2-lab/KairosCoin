import{d as j,j as e,e as B,N as P,G as A,aG as H,m as F,ag as G,b as M,k as J,l as V}from"./ui-BteoE537.js";import{U,G as I,a9 as W,aa as Y,C as g,E as R,D as q,F as Q,u as X,K as Z,I as f,T as ee,H as se,W as E}from"./index-1fU2ylg1.js";import{formatEther as te,Contract as ae,formatUnits as le}from"./crypto-1JBTrmrY.js";import"./vendor-cxSnwWPt.js";const C="0x14D41707269c7D8b8DFa5095b38824a46dA05da3".toLowerCase(),T="kairos_crosschain_portfolio",ne=6e4;async function re(r,a){try{const o=R(r),h=g[r],l=await o.getBalance(a);return{chainId:r,symbol:h.nativeCurrency.symbol,balance:te(l),isNative:!0}}catch{return{chainId:r,symbol:g[r]?.nativeCurrency?.symbol||"?",balance:"0",isNative:!0}}}async function oe(r,a){const o=q[r]||[],h=[],l=R(r);for(const n of o.slice(0,6))try{const c=await new ae(n.address,Q,l).balanceOf(a),m=le(c,n.decimals);parseFloat(m)>1e-4&&h.push({chainId:r,address:n.address,symbol:n.symbol,balance:m,decimals:n.decimals,isNative:!1})}catch{}return h}async function _(r){try{const l=JSON.parse(localStorage.getItem(T)||"{}");if(l.address===r&&Date.now()-l.timestamp<ne)return l}catch{}const a={chains:{},totalUSD:0,address:r,timestamp:Date.now()},o=U.map(async l=>{const n=g[l];try{const[u,c,m]=await Promise.all([re(l,r),oe(l,r),I(l)]),N=c.filter(s=>!s.isNative).map(s=>s.address);let d={};if(N.length>0)try{const s=N.filter(i=>i.toLowerCase()!==C);s.length>0&&(d=await W(l,s))}catch{}if(c.some(s=>s.address?.toLowerCase()===C))try{const s=await Y();d[C]={usd:s.usd,change24h:s.change24h||0}}catch{d[C]={usd:1,change24h:0}}const b=parseFloat(u.balance)*m;let p=0;const k=c.map(s=>{const i=d[s.address?.toLowerCase()]?.usd||0,t=parseFloat(s.balance)*i;return p+=t,{...s,price:i,usd:t}}),y=b+p;return{chainId:l,chainName:n.name,shortName:n.shortName,color:n.color,native:{...u,price:m,usd:b},tokens:k,totalUSD:y}}catch(u){return{chainId:l,chainName:n.name,shortName:n.shortName,color:n.color,native:{balance:"0",usd:0},tokens:[],totalUSD:0,error:u.message}}}),h=await Promise.allSettled(o);for(const l of h)if(l.status==="fulfilled"&&l.value){const n=l.value;a.chains[n.chainId]=n,a.totalUSD+=n.totalUSD}try{localStorage.setItem(T,JSON.stringify(a))}catch{}return a}const O=["#D4AF37","#22d3ee","#a78bfa","#f472b6","#34d399","#fb923c","#60a5fa","#facc15","#f87171","#94a3b8"],$="kairos_pnl_history";function z(){try{return JSON.parse(localStorage.getItem($)||"[]")}catch{return[]}}function ce(r){const a=z(),o=Date.now();a.length>0&&o-a[a.length-1].t<36e5||(a.push({t:o,v:r}),a.length>720&&a.splice(0,a.length-720),localStorage.setItem($,JSON.stringify(a)))}function K({slices:r,size:a=160,stroke:o=28}){const h=(a-o)/2,l=2*Math.PI*h,n=a/2,u=a/2;let c=0;return e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[r.map((m,N)=>{const d=l*m.pct,v=`${d} ${l-d}`,b=e.jsx("circle",{cx:n,cy:u,r:h,fill:"none",stroke:m.color,strokeWidth:o,strokeDasharray:v,strokeDashoffset:-c,strokeLinecap:"round",className:"transition-all duration-700"},N);return c+=d,b}),e.jsx("circle",{cx:n,cy:u,r:h-o/2+2,fill:"transparent"})]})}function he(){const{activeChainId:r,activeAddress:a,balances:o,tokenPrices:h,nativePrice:l,goBack:n,getTotalPortfolioValue:u}=X(),c=u(),[m,N]=j.useState("allocation"),[d,v]=j.useState(null),[b,p]=j.useState(!1);j.useEffect(()=>{c>0&&ce(c)},[c]),j.useEffect(()=>{m==="crosschain"&&!d&&a&&(p(!0),_(a).then(s=>v(s)).catch(()=>{}).finally(()=>p(!1)))},[m,a]);const k=j.useMemo(()=>{const s=[];if(o.native){const t=parseFloat(o.native.balance||0),x=t*l;x>.01&&s.push({symbol:o.native.symbol,balance:t,value:x,isNative:!0,token:o.native})}if(o.tokens)for(const t of o.tokens){if(!t.hasBalance)continue;const x=t.address.toLowerCase(),S=x===Z.address.toLowerCase()||t.symbol==="KAIROS",D=h[x]?.usd||(S?1:0),w=parseFloat(t.balance||0),L=w*D;L>.01&&s.push({symbol:t.symbol,balance:w,value:L,price:D,change24h:h[t.address.toLowerCase()]?.change24h||0,isNative:!1,token:t})}s.sort((t,x)=>x.value-t.value);const i=s.reduce((t,x)=>t+x.value,0);return s.map((t,x)=>({...t,pct:i>0?t.value/i:0,color:O[x%O.length]}))},[o,h,l]),y=j.useMemo(()=>{const s=z();if(s.length===0)return{day:0,week:0,month:0};const i=Date.now(),t=x=>{const S=i-x;return(s.find(w=>w.t>=S)||s[0]).v};return{day:c-t(864e5),week:c-t(6048e5),month:c-t(2592e6)}},[c]);return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-dark-800",children:[e.jsx("button",{onClick:n,className:"text-dark-300 hover:text-white",children:e.jsx(B,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"text-kairos-400",size:20}),e.jsx("h1",{className:"text-lg font-bold text-white",children:"Portfolio"})]})]}),e.jsx("div",{className:"flex gap-1 p-1 mx-4 mt-4 rounded-xl bg-white/5",children:[{key:"allocation",label:"Tokens",icon:P},{key:"crosschain",label:"Multi-Chain",icon:A},{key:"pnl",label:"P&L",icon:H}].map(s=>e.jsxs("button",{onClick:()=>N(s.key),className:`flex-1 py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-1 ${m===s.key?"bg-kairos-500/15 text-kairos-400":"text-dark-400"}`,children:[e.jsx(s.icon,{size:12})," ",s.label]},s.key))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m==="allocation"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center py-4 relative",children:k.length>0?e.jsxs("div",{className:"relative",children:[e.jsx(K,{slices:k}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Total"}),e.jsx("p",{className:"text-white font-bold text-lg",children:f(c)})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"mx-auto text-dark-600",size:48}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Sin activos con valor"})]})}),e.jsx("div",{className:"space-y-2",children:k.map((s,i)=>e.jsxs(F.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:i*.05},className:"flex items-center gap-3 bg-dark-800/50 rounded-xl p-3 border border-dark-700/50",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:s.color}}),e.jsx(ee,{token:s.token,chainId:r,size:28}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white text-sm font-semibold",children:s.symbol}),e.jsx("p",{className:"text-dark-500 text-xs",children:se(s.balance.toString())})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:f(s.value)}),e.jsxs("p",{className:"text-dark-400 text-xs",children:[(s.pct*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"w-12 h-1.5 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${s.pct*100}%`,backgroundColor:s.color}})})]},s.symbol))})]}),m==="crosschain"&&e.jsx(e.Fragment,{children:b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"},children:e.jsx(G,{className:"mx-auto text-kairos-400",size:32})}),e.jsx("p",{className:"text-dark-400 text-sm mt-3",children:"Escaneando 6 blockchains..."})]}):d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Portfolio Total (6 Chains)"}),e.jsx("p",{className:"text-white font-bold text-2xl mt-1",children:f(d.totalUSD)})]}),(()=>{const s=U.map(i=>({chainId:i,...d.chains[i],pct:d.totalUSD>0?(d.chains[i]?.totalUSD||0)/d.totalUSD:0,color:g[i]?.color||"#888"})).filter(i=>i.totalUSD>.01);return s.length>0?e.jsx("div",{className:"flex justify-center py-2 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{slices:s,size:140,stroke:24}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(A,{className:"text-dark-500",size:16}),e.jsx("p",{className:"text-dark-400 text-[10px]",children:"6 chains"})]})]})}):null})(),e.jsx("div",{className:"space-y-2",children:U.map((s,i)=>{const t=d.chains[s];return!t||t.totalUSD<.01?e.jsxs("div",{className:"flex items-center gap-3 bg-dark-800/30 rounded-xl p-3 border border-dark-700/30 opacity-50",children:[e.jsx(E,{chainId:s,size:24}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-dark-400 text-sm",children:g[s].shortName})}),e.jsx("p",{className:"text-dark-600 text-xs",children:"$0.00"})]},s):e.jsxs(F.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.05},className:"bg-dark-800/50 rounded-xl p-3 border border-dark-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(E,{chainId:s,size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm font-semibold",children:t.chainName}),e.jsxs("p",{className:"text-dark-500 text-xs",children:[t.tokens?.length||0," token",(t.tokens?.length||0)!==1?"s":""," con balance"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:f(t.totalUSD)}),e.jsxs("p",{className:"text-dark-400 text-xs",children:[d.totalUSD>0?(t.totalUSD/d.totalUSD*100).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"ml-9 space-y-1",children:[t.native&&parseFloat(t.native.balance)>1e-4&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-dark-400",children:t.native.symbol}),e.jsxs("span",{className:"text-dark-300",children:[parseFloat(t.native.balance).toFixed(4)," ¬∑ ",f(t.native.usd)]})]}),(t.tokens||[]).map(x=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-dark-400",children:x.symbol}),e.jsxs("span",{className:"text-dark-300",children:[parseFloat(x.balance).toFixed(4)," ¬∑ ",f(x.usd)]})]},x.address))]})]},s)})}),e.jsxs("button",{onClick:()=>{v(null),p(!0),_(a).then(s=>v(s)).finally(()=>p(!1))},className:"w-full py-2.5 rounded-xl bg-dark-800/50 text-dark-400 text-xs flex items-center justify-center gap-1.5 border border-dark-700/30",children:[e.jsx(M,{size:12})," Actualizar portfolio multi-chain"]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"mx-auto text-dark-600",size:40}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Error cargando datos multi-chain"})]})}),m==="pnl"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-dark-400 text-xs",children:"Valor del Portfolio"}),e.jsx("p",{className:"text-white font-bold text-2xl mt-1",children:f(c)})]}),e.jsx("div",{className:"space-y-3",children:[{label:"√öltimas 24h",value:y.day,emoji:"üìÖ"},{label:"√öltimos 7 d√≠as",value:y.week,emoji:"üìÜ"},{label:"√öltimos 30 d√≠as",value:y.month,emoji:"üóìÔ∏è"}].map(s=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-xl border ${s.value>=0?"bg-green-500/5 border-green-500/20":"bg-red-500/5 border-red-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:s.emoji}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:s.label}),e.jsx("p",{className:"text-dark-500 text-xs",children:"Ganancia/P√©rdida"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.value>=0?e.jsx(J,{size:14,className:"text-green-400"}):e.jsx(V,{size:14,className:"text-red-400"}),e.jsxs("span",{className:`font-bold text-sm ${s.value>=0?"text-green-400":"text-red-400"}`,children:[s.value>=0?"+":"",f(Math.abs(s.value))]})]}),c>0&&e.jsxs("p",{className:`text-xs ${s.value>=0?"text-green-500/60":"text-red-500/60"}`,children:[s.value>=0?"+":"",(s.value/c*100).toFixed(2),"%"]})]})]},s.label))}),e.jsx("div",{className:"bg-dark-800/30 rounded-xl p-3 border border-dark-700/30",children:e.jsx("p",{className:"text-dark-500 text-xs text-center",children:"üí° Los datos P&L se calculan desde snapshots de tu portfolio. Cuanto m√°s uses la wallet, m√°s preciso ser√°."})})]})]})]})}export{he as default};
