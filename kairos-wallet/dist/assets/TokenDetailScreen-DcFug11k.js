import{d as u,j as e,e as _,w as L,l as z,k as M,m as P,n as R,S as O,t as H,D as B,y as K}from"./ui-Bym_0wSS.js";import{u as U,K as F,T as A,C as G,I as N,H as Q,Q as V}from"./index-34RIBSjc.js";import"./vendor-CCYniLZC.js";import"./crypto-1JBTrmrY.js";const E="https://api.coingecko.com/api/v3",W={56:"binance-smart-chain",1:"ethereum",137:"polygon-pos",42161:"arbitrum-one",43114:"avalanche",8453:"base"},X={56:"binancecoin",1:"ethereum",137:"matic-network",42161:"ethereum",43114:"avalanche-2",8453:"ethereum"},y={},D=300*1e3;async function Z(s,c=7){const l=X[s];if(!l)return null;const a=`native_${s}_${c}`,o=y[a];if(o&&Date.now()-o.timestamp<D)return o.data;try{const n=await fetch(`${E}/coins/${l}/market_chart?vs_currency=usd&days=${c}`,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error("API error");const r=(await n.json()).prices||[],t=r.length>1?(r[r.length-1][1]-r[0][1])/r[0][1]*100:0,m={prices:r,change24h:t};return y[a]={data:m,timestamp:Date.now()},m}catch{return null}}async function q(s,c,l=7){const a=W[s];if(!a||!c)return null;const o=`${c.toLowerCase()}_${s}_${l}`,n=y[o];if(n&&Date.now()-n.timestamp<D)return n.data;try{const d=await fetch(`${E}/coins/${a}/contract/${c}/market_chart/?vs_currency=usd&days=${l}`,{headers:{Accept:"application/json"}});if(!d.ok)throw new Error("API error");const t=(await d.json()).prices||[],m=t.length>1?(t[t.length-1][1]-t[0][1])/t[0][1]*100:0,i={prices:t,change24h:m};return y[o]={data:i,timestamp:Date.now()},i}catch{return null}}function J(s,c=50){if(!s||s.length<2)return null;const l=Math.max(1,Math.floor(s.length/c)),a=[];for(let r=0;r<s.length;r+=l)a.push(s[r][1]);a[a.length-1]!==s[s.length-1][1]&&a.push(s[s.length-1][1]);const o=Math.min(...a),n=Math.max(...a),d=n-o||1;return{points:a.map(r=>(r-o)/d),min:o,max:n,current:a[a.length-1],values:a}}function Y({points:s,width:c=340,height:l=180,color:a,negative:o}){if(!s||s.length<2)return null;const n=o?"#ef4444":a,d=`chart_${Math.random().toString(36).slice(2,8)}`,r=c/(s.length-1),t=4,m=l-t*2,i=s.map((h,x)=>({x:x*r,y:t+m*(1-h)}));let f=`M ${i[0].x} ${i[0].y}`;for(let h=1;h<i.length;h++){const x=i[h-1],j=i[h],w=(x.x+j.x)/2;f+=` Q ${w} ${x.y} ${j.x} ${j.y}`}const v=f+` L ${i[i.length-1].x} ${l} L 0 ${l} Z`;return e.jsxs("svg",{width:"100%",viewBox:`0 0 ${c} ${l}`,preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:d,x1:"0",x2:"0",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:n,stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:n,stopOpacity:"0"})]})}),e.jsx("path",{d:v,fill:`url(#${d})`}),e.jsx("path",{d:f,fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}const ee=[{label:"24H",days:1},{label:"7D",days:7},{label:"30D",days:30},{label:"1A",days:365}];function ie(){const{activeChainId:s,navigate:c,goBack:l,nativePrice:a,tokenPrices:o,tokenDetailData:n,showToast:d}=U(),r=G[s],[t,m]=u.useState(n||null),[i,f]=u.useState(7),[v,h]=u.useState(null),[x,j]=u.useState(null),[w,$]=u.useState(!0);if(u.useEffect(()=>{n&&!t&&m(n)},[n]),u.useEffect(()=>{if(!t)return;(async()=>{$(!0);try{let b;if(t.isNative?b=await Z(s,i):b=await q(s,t.address,i),b){h(b);const T=J(b.prices,80);j(T)}}catch{}$(!1)})()},[t,i,s]),!t)return e.jsx("div",{className:"screen-container items-center justify-center",children:e.jsx("p",{className:"text-dark-400",children:"Cargando..."})});const g=t.isNative?a:o[t.address?.toLowerCase()]?.usd||0,S=parseFloat(t.balance||"0")*g,C=v?.change24h||0,k=C<0,I=t.address?.toLowerCase()===F.address.toLowerCase();return e.jsxs("div",{className:"screen-container",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",children:[e.jsx("button",{onClick:l,className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(_,{size:20,className:"text-dark-300"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{token:t,chainId:s,size:28}),e.jsx("span",{className:"font-bold text-white",children:t.symbol}),I&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[8px] font-bold bg-kairos-500/20 text-kairos-400",children:"STABLE"})]}),e.jsx("a",{href:t.isNative?r.blockExplorerUrl:`${r.blockExplorerUrl}/token/${t.address}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 -mr-2 rounded-xl hover:bg-white/5",children:e.jsx(L,{size:18,className:"text-dark-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"px-5 mb-2",children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:g>0?N(g):"â€”"}),C!==0&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${k?"text-red-400":"text-green-400"}`,children:[k?e.jsx(z,{size:14}):e.jsx(M,{size:14}),e.jsxs("span",{className:"text-sm font-medium",children:[k?"":"+",C.toFixed(2),"%"]}),e.jsxs("span",{className:"text-xs text-dark-500",children:["(",i===1?"24h":i===7?"7d":i===30?"30d":"1a",")"]})]})]}),e.jsx("div",{className:"px-5 mb-4",children:e.jsx("div",{className:"h-44 bg-white/[0.02] rounded-2xl overflow-hidden flex items-end border border-white/5",children:w?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(P.div,{animate:{opacity:[.3,1,.3]},transition:{duration:1.5,repeat:1/0},className:"text-dark-500 text-sm",children:"Cargando grÃ¡fica..."})}):x?e.jsx(Y,{points:x.points,color:"#d4a017",negative:k,height:176}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{className:"text-dark-500 text-xs",children:"Sin datos de precio"})})})}),e.jsx("div",{className:"px-5 mb-6",children:e.jsx("div",{className:"flex gap-2",children:ee.map(p=>e.jsx("button",{onClick:()=>f(p.days),className:`flex-1 py-2 rounded-xl text-xs font-medium transition-all ${i===p.days?"bg-kairos-500/20 text-kairos-400 border border-kairos-500/30":"bg-white/[0.04] text-dark-400 border border-transparent"}`,children:p.label},p.days))})}),e.jsxs("div",{className:"px-5 mb-6",children:[e.jsx("h3",{className:"text-xs text-dark-400 mb-2 uppercase tracking-wider",children:"Tu saldo"}),e.jsx("div",{className:"bg-white/[0.03] rounded-xl p-4 border border-white/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-white",children:[Q(t.balance||"0")," ",e.jsx("span",{className:"text-dark-400",children:t.symbol})]}),e.jsx("p",{className:"text-sm text-dark-400",children:S>0?N(S):"â€”"})]}),e.jsx(A,{token:t,chainId:s,size:48})]})})]}),x&&e.jsxs("div",{className:"px-5 mb-6",children:[e.jsx("h3",{className:"text-xs text-dark-400 mb-2 uppercase tracking-wider",children:"EstadÃ­sticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white/[0.03] rounded-xl p-3 border border-white/5",children:[e.jsx("p",{className:"text-[10px] text-dark-500 mb-1",children:"MÃ­nimo"}),e.jsx("p",{className:"text-sm font-semibold text-white",children:N(x.min)})]}),e.jsxs("div",{className:"bg-white/[0.03] rounded-xl p-3 border border-white/5",children:[e.jsx("p",{className:"text-[10px] text-dark-500 mb-1",children:"MÃ¡ximo"}),e.jsx("p",{className:"text-sm font-semibold text-white",children:N(x.max)})]})]})]}),e.jsx("div",{className:"px-5 mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{try{V({symbol:t.symbol,targetPrice:g,condition:"above",tokenAddress:t.address||null,chainId:s}),d(`ðŸ”” Alerta creada para ${t.symbol}`,"success")}catch(p){d(p.message||"Error creando alerta","error")}},className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-kairos-500/10 text-kairos-400 text-xs font-medium border border-kairos-500/20",children:[e.jsx(R,{size:14})," Crear Alerta"]}),!t.isNative&&e.jsxs("button",{onClick:()=>c("tokenaudit"),className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-red-500/10 text-red-400 text-xs font-medium border border-red-500/20",children:[e.jsx(O,{size:14})," Auditar Token"]})]})}),e.jsx("div",{className:"px-5 mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>c("send"),className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl bg-blue-500/10 text-blue-400 text-sm font-medium",children:[e.jsx(H,{size:16}),"Enviar"]}),e.jsxs("button",{onClick:()=>c("receive"),className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 text-green-400 text-sm font-medium",children:[e.jsx(B,{size:16}),"Recibir"]}),e.jsxs("button",{onClick:()=>c("swap"),className:"flex-1 flex items-center justify-center gap-2 py-3 rounded-xl bg-purple-500/10 text-purple-400 text-sm font-medium",children:[e.jsx(K,{size:16}),"Swap"]})]})})]})]})}export{ie as default};
