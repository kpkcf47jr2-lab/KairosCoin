import{a as N,j as e,a8 as U,o as Q,m as O,Z as Ne,a9 as E,G as ke,a0 as ce,aa as K,d as Pe,D as we,h as Se,P as Ce,ab as Fe,ac as $e,B as Be,ad as Ie,F as Ae,ae as Oe}from"./ui-CtxJry3a.js";import{f as X,u as W,P as Te,c as le,T as ne}from"./index-CvJM596s.js";import{t as B}from"./tradingEngine-OTlgqUEn.js";import{m as L}from"./marketData-K1zKCjjj.js";import{d as Me}from"./indicators-DJQYQkcq.js";import{b as Y}from"./broker-BUr9uyY7.js";import{S as Ee}from"./StrategyEditor-dk6vUXQA.js";import"./vendor-OqcJHxKq.js";import"./kairosScript-IPL7eaHX.js";class De{constructor(){this.activeBots=new Map}start(a){if(this.activeBots.has(a.id))return;const{pair:r,upperPrice:h,lowerPrice:v,gridLines:P,investment:b,onLog:x,onTrade:k}=a,c=(h-v)/(P-1),d=[];for(let f=0;f<P;f++)d.push(+(v+c*f).toFixed(2));const m=b/(P-1),g={id:a.id,pair:r,levels:d,priceStep:c,investmentPerGrid:m,activeOrders:new Map,filledBuys:[],totalProfit:0,trades:0,running:!0,lastPrice:null};this.activeBots.set(a.id,g),x==null||x(`ðŸ“Š Grid Bot started: ${P} levels from $${v} to $${h}`),x==null||x(`ðŸ’° Investment per grid: $${m.toFixed(2)}`),this._startMonitor(g,x,k)}async _startMonitor(a,r,h){const v=async()=>{if(a.running)try{const x=(await L.get24hrTicker(a.pair)).price,k=a.lastPrice;if(a.lastPrice=x,!k){r==null||r(`ðŸ“ˆ Current price: $${x.toFixed(2)}`);for(const d of a.levels)d<x?a.activeOrders.set(d,{side:"buy",price:d,status:"pending"}):d>x;const c=a.activeOrders.size;r==null||r(`ðŸŸ¢ ${c} buy orders placed below current price`);return}for(const c of a.levels){const d=a.activeOrders.get(c);if((d==null?void 0:d.side)==="buy"&&d.status==="pending"&&x<=c){const m=a.investmentPerGrid/c;X.applyVolumeFee(c,m),d.status="filled",a.filledBuys.push(c),a.trades++,h==null||h({symbol:a.pair,side:"buy",type:"grid",quantity:+m.toFixed(6),price:c,gridLevel:c}),r==null||r(`âœ… BUY filled at $${c} (qty: ${m.toFixed(6)})`);const g=c+a.priceStep;g<=a.levels[a.levels.length-1]&&(a.activeOrders.set(g,{side:"sell",price:g,status:"pending",buyLevel:c,quantity:m}),r==null||r(`ðŸ“¤ SELL order placed at $${g.toFixed(2)}`))}if((d==null?void 0:d.side)==="sell"&&d.status==="pending"&&x>=c){d.status="filled";const m=(c-d.buyLevel)*d.quantity,g=X.applyVolumeFee(c,d.quantity),f=m-g;a.totalProfit+=f,a.trades++,h==null||h({symbol:a.pair,side:"sell",type:"grid",quantity:+d.quantity.toFixed(6),price:c,profit:+f.toFixed(2),gridLevel:c}),r==null||r(`âœ… SELL filled at $${c.toFixed(2)} â€” Profit: +$${f.toFixed(2)}`);const w=c-a.priceStep;w>=a.levels[0]&&(a.activeOrders.set(w,{side:"buy",price:w,status:"pending"}),r==null||r(`ðŸ“¥ BUY order re-placed at $${w.toFixed(2)}`))}}}catch(b){r==null||r(`âŒ Error: ${b.message}`)}};await v();const P=setInterval(v,1e4);a._interval=P}stop(a){const r=this.activeBots.get(a);r&&(r.running=!1,r._interval&&clearInterval(r._interval),this.activeBots.delete(a))}getStats(a){const r=this.activeBots.get(a);return r?{levels:r.levels.length,activeOrders:[...r.activeOrders.values()].filter(h=>h.status==="pending").length,filledBuys:r.filledBuys.length,totalProfit:r.totalProfit,trades:r.trades,lastPrice:r.lastPrice}:null}isRunning(a){return this.activeBots.has(a)}}const H=new De;class Re{constructor(){this.activeBots=new Map}start(a){if(this.activeBots.has(a.id))return;const{pair:r,investmentPerOrder:h,intervalMinutes:v,maxOrders:P=100,useRsiFilter:b=!1,rsiPeriod:x=14,rsiThreshold:k=40,usePriceDipFilter:c=!1,dipPercent:d=3,onLog:m,onTrade:g}=a,f={id:a.id,pair:r,investmentPerOrder:h,intervalMinutes:v,maxOrders:P,useRsiFilter:b,rsiPeriod:x,rsiThreshold:k,usePriceDipFilter:c,dipPercent:d,executedOrders:0,totalInvested:0,totalQuantity:0,avgPrice:0,prices:[],running:!0,lastBuyPrice:null,startTime:Date.now()};this.activeBots.set(a.id,f),m==null||m(`ðŸ“Š DCA Bot started: $${h} every ${v}min on ${r}`),b&&(m==null||m(`ðŸ“‰ RSI filter enabled: buy when RSI < ${k}`)),c&&(m==null||m(`ðŸ“‰ Dip filter enabled: buy when price drops ${d}%`)),this._startMonitor(f,m,g)}async _startMonitor(a,r,h){const v=async()=>{if(a.running){if(a.executedOrders>=a.maxOrders){r==null||r(`ðŸ Max orders reached (${a.maxOrders}). DCA Bot stopped.`),this.stop(a.id);return}try{const x=(await L.get24hrTicker(a.pair)).price;if(a.useRsiFilter)try{const d=(await L.getCandles(a.pair,"1h",100)).map(f=>f.close),m=Me(d,a.rsiPeriod),g=m[m.length-1];if(g>a.rsiThreshold){r==null||r(`â¸ï¸ RSI ${g.toFixed(1)} > ${a.rsiThreshold} â€” skipping buy`);return}r==null||r(`ðŸ“‰ RSI ${g.toFixed(1)} < ${a.rsiThreshold} â€” proceeding with buy`)}catch(c){r==null||r(`âš ï¸ RSI check failed, proceeding anyway: ${c.message}`)}if(a.usePriceDipFilter&&a.lastBuyPrice){const c=(a.lastBuyPrice-x)/a.lastBuyPrice*100;if(c<a.dipPercent){r==null||r(`â¸ï¸ Price drop ${c.toFixed(2)}% < ${a.dipPercent}% â€” skipping buy`);return}r==null||r(`ðŸ“‰ Price dropped ${c.toFixed(2)}% â€” proceeding with buy`)}const k=a.investmentPerOrder/x;X.applyVolumeFee(x,k),a.executedOrders++,a.totalInvested+=a.investmentPerOrder,a.totalQuantity+=k,a.avgPrice=a.totalInvested/a.totalQuantity,a.lastBuyPrice=x,a.prices.push(x),h==null||h({symbol:a.pair,side:"buy",type:"dca",quantity:+k.toFixed(8),price:x,dcaOrder:a.executedOrders,avgPrice:+a.avgPrice.toFixed(2)}),r==null||r(`âœ… DCA Buy #${a.executedOrders}: ${k.toFixed(6)} ${a.pair.replace("USDT","").replace("KAIROS","")} @ $${x.toFixed(2)}`),r==null||r(`ðŸ“Š Avg price: $${a.avgPrice.toFixed(2)} | Total invested: $${a.totalInvested.toFixed(2)}`)}catch(b){r==null||r(`âŒ Error: ${b.message}`)}}};await v();const P=setInterval(v,a.intervalMinutes*60*1e3);a._interval=P}stop(a){const r=this.activeBots.get(a);r&&(r.running=!1,r._interval&&clearInterval(r._interval),this.activeBots.delete(a))}getStats(a){const r=this.activeBots.get(a);if(!r)return null;const v=r.totalQuantity*(r.lastBuyPrice||0)-r.totalInvested;return{executedOrders:r.executedOrders,maxOrders:r.maxOrders,totalInvested:r.totalInvested,totalQuantity:r.totalQuantity,avgPrice:r.avgPrice,currentPrice:r.lastBuyPrice,unrealizedPnl:v,unrealizedPnlPercent:r.totalInvested>0?v/r.totalInvested*100:0,runningTime:Date.now()-r.startTime}}isRunning(a){return this.activeBots.has(a)}}const Z=new Re,J=[{id:"signal",label:"Signal Bot",icon:Ne,desc:"Indicadores tÃ©cnicos predefinidos",color:"#3B82F6"},{id:"script",label:"Script Bot",icon:E,desc:"Estrategia personalizada con cÃ³digo",color:"#A855F7"},{id:"grid",label:"Grid Bot",icon:ke,desc:"Compra y vende en niveles de precio",color:"#00DC82"},{id:"dca",label:"DCA Bot",icon:ce,desc:"InversiÃ³n a intervalos regulares",color:"#22D3EE"}];function Ye(){const{bots:S,addBot:a,updateBot:r,removeBot:h,strategies:v,addStrategy:P,brokers:b,setPage:x,setSelectedPair:k}=W(),[c,d]=N.useState(!1),[m,g]=N.useState(!1),[f,w]=N.useState(null),[y,de]=N.useState("signal"),[D,I]=N.useState([]),[T,oe]=N.useState(!1),[ee,C]=N.useState(""),[xe,te]=N.useState({}),[pe,me]=N.useState({}),[s,o]=N.useState({name:"",pair:"BTCKAIROS",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10",leverage:"1",executionMode:"spot",trailingStop:!1,trailingStopPct:"1.5",trailingActivation:"0.5",upperPrice:"",lowerPrice:"",gridLines:"10",investmentPerOrder:"100",intervalMinutes:"60",maxOrders:"50",useRsiFilter:!1,rsiThreshold:"40",usePriceDipFilter:!1,dipPercent:"3",scriptCode:"",scriptStrategyId:""}),R=N.useCallback(async()=>{var t;for(const l of b.filter(n=>n.connected))try{(t=Y.connections)!=null&&t.has(l.id)||await Y.connect(l);const n=await Y.getBalances(l.id),i=Array.isArray(n)?n:(n==null?void 0:n.balances)||[];te(u=>({...u,[l.id]:{balances:i,loading:!1,error:!1}}))}catch(n){console.warn("Balance fetch failed for",l.id,n.message),te(i=>({...i,[l.id]:{balances:[],loading:!1,error:!0}}))}},[b]);N.useEffect(()=>{R();const t=setInterval(R,3e4);return()=>clearInterval(t)},[R]),N.useEffect(()=>{const t=setInterval(()=>{const l=S.filter(i=>i.status==="active");if(l.length===0)return;const n={};l.forEach(i=>{const u=B.getLiveData(i.id);u&&(n[i.id]=u)}),Object.keys(n).length>0&&me(i=>({...i,...n}))},1e3);return()=>clearInterval(t)},[S]),N.useEffect(()=>{const l=W.getState().bots.filter(i=>i.status==="active");for(const i of l)if(B.activeBots.has(i.id))B.setCallbacks(i.id,u=>$(i,u),u=>F(i,u));else{const u=i.botType||"signal";u==="signal"||u==="script"?B.startBot({...i,status:"active"},j=>$(i,j),j=>F(i,j)):u==="grid"?H.start({id:i.id,pair:i.pair,upperPrice:i.upperPrice,lowerPrice:i.lowerPrice,gridLines:i.gridLines,investment:i.balance,onLog:j=>F(i,j),onTrade:j=>$(i,j)}):u==="dca"&&Z.start({id:i.id,pair:i.pair,investmentPerOrder:i.investmentPerOrder,intervalMinutes:i.intervalMinutes,maxOrders:i.maxOrders,onLog:j=>F(i,j),onTrade:j=>$(i,j)})}const n=B.getAllLogs();n.length>0&&I(i=>i.length>0?i:n.map(u=>({type:"log",bot:u.botName,message:u.message,time:new Date(u.time).toLocaleTimeString()})))},[]);const ue=t=>b.find(l=>l.id===t.brokerId),ve=t=>xe[t]||null,se=t=>{k(t.pair),x("chart")},ge=()=>{C("");const t=s.name.trim()||`Bot ${new Date().toLocaleTimeString("es",{hour:"2-digit",minute:"2-digit"})}`;if(!s.pair){C("Selecciona un par de trading");return}const l={name:t,pair:s.pair,botType:y,brokerId:s.brokerId};if(y==="signal"){const n=v.find(i=>i.id===s.strategyId)||{name:"EMA Cross 9/21",entry:{condition:"EMA 9 cruza EMA 21",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},exit:{condition:"Cruce opuesto",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},stopLoss:"2",takeProfit:"4"};Object.assign(l,{timeframe:s.timeframe,strategy:n,balance:parseFloat(s.balance),riskPercent:parseFloat(s.riskPercent),maxTrades:parseInt(s.maxTrades),leverage:parseInt(s.leverage)||1,executionMode:s.executionMode,trailingStop:s.trailingStop,trailingStopPct:s.trailingStop?parseFloat(s.trailingStopPct):void 0,trailingActivation:s.trailingStop?parseFloat(s.trailingActivation):void 0})}else if(y==="script"){if(!s.scriptStrategyId){C("Selecciona una estrategia o crea una nueva");return}const n=v.find(i=>i.id===s.scriptStrategyId);if(!(n!=null&&n.code)){C("La estrategia seleccionada no tiene cÃ³digo. EdÃ­tala y guarda el cÃ³digo primero.");return}Object.assign(l,{timeframe:s.timeframe,strategy:{type:"custom_script",code:n.code,name:n.name},balance:parseFloat(s.balance),riskPercent:parseFloat(s.riskPercent),maxTrades:parseInt(s.maxTrades),leverage:parseInt(s.leverage)||1,executionMode:s.executionMode,scriptName:n.name,trailingStop:s.trailingStop,trailingStopPct:s.trailingStop?parseFloat(s.trailingStopPct):void 0,trailingActivation:s.trailingStop?parseFloat(s.trailingActivation):void 0})}else if(y==="grid"){if(!s.upperPrice||!s.lowerPrice){C("Ingresa el precio superior e inferior para el grid");return}Object.assign(l,{upperPrice:parseFloat(s.upperPrice),lowerPrice:parseFloat(s.lowerPrice),gridLines:parseInt(s.gridLines),balance:parseFloat(s.balance)})}else y==="dca"&&Object.assign(l,{investmentPerOrder:parseFloat(s.investmentPerOrder),intervalMinutes:parseInt(s.intervalMinutes),maxOrders:parseInt(s.maxOrders),useRsiFilter:s.useRsiFilter,rsiThreshold:parseInt(s.rsiThreshold),usePriceDipFilter:s.usePriceDipFilter,dipPercent:parseFloat(s.dipPercent),balance:parseFloat(s.investmentPerOrder)*parseInt(s.maxOrders)});a(l),d(!1),C("")},F=(t,l)=>{I(n=>[...n.slice(-100),{type:"log",bot:t.name,message:l,time:new Date().toLocaleTimeString()}])},$=(t,l)=>{if(l.status==="error"){I(i=>[...i.slice(-100),{type:"error",bot:t.name,message:`Error: ${l.error}`,time:new Date().toLocaleTimeString()}]);return}I(i=>[...i.slice(-100),{type:"trade",bot:t.name,...l,time:new Date().toLocaleTimeString()}]);const n=W.getState().bots.find(i=>i.id===t.id);if(n){const i=(n.trades||0)+1,u=parseFloat(l.profit)||0,j=(n.pnl||0)+u;let A=n.winRate||0;if(l.action==="close"&&u!==0){const p=(n._closedTrades||0)+1,M=(n._wins||0)+(u>0?1:0);A=p>0?M/p*100:0,r(t.id,{trades:i,pnl:j,winRate:A,_closedTrades:p,_wins:M})}else r(t.id,{trades:i,pnl:j})}},he=async t=>{r(t.id,{status:"active"});const l=t.botType||"signal";l==="signal"||l==="script"?B.startBot({...t,status:"active"},n=>$(t,n),n=>F(t,n)):l==="grid"?H.start({id:t.id,pair:t.pair,upperPrice:t.upperPrice,lowerPrice:t.lowerPrice,gridLines:t.gridLines,investment:t.balance,onLog:n=>F(t,n),onTrade:n=>$(t,n)}):l==="dca"&&Z.start({id:t.id,pair:t.pair,investmentPerOrder:t.investmentPerOrder,intervalMinutes:t.intervalMinutes,maxOrders:t.maxOrders,useRsiFilter:t.useRsiFilter,rsiThreshold:t.rsiThreshold,usePriceDipFilter:t.usePriceDipFilter,dipPercent:t.dipPercent,onLog:n=>F(t,n),onTrade:n=>$(t,n)})},z=t=>{const l=t.botType||"signal";l==="signal"||l==="script"?B.stopBot(t.id):l==="grid"?H.stop(t.id):l==="dca"&&Z.stop(t.id),r(t.id,{status:"stopped"})},fe=t=>{z(t),r(t.id,{status:"paused"})},be=t=>{z(t),h(t.id)},_=t=>{switch(t){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},je=t=>J.find(l=>l.id===t)||J[0];return e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-3 md:px-5 py-4 md:py-5 space-y-4 md:space-y-5 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[S.filter(t=>t.status==="active").length," activos de ",S.length," total"]})]}),e.jsxs("button",{onClick:()=>d(!c),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-xs font-semibold shrink-0",children:[e.jsx(U,{size:14})," Crear Bot"]})]}),e.jsx(Q,{children:c&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--text)]",children:"Nuevo Bot de Trading"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:J.map(t=>{const l=t.icon;return e.jsxs("button",{onClick:()=>de(t.id),className:`p-3 rounded-xl text-center transition-all flex flex-col items-center justify-center min-w-0 ${y===t.id?"ring-1":"hover:bg-[var(--surface-2)]"}`,style:{background:y===t.id?`${t.color}10`:"var(--surface-2)",borderColor:y===t.id?`${t.color}40`:"var(--border)",border:`1px solid ${y===t.id?t.color+"30":"var(--border)"}`},children:[e.jsx(l,{size:20,style:{color:t.color},className:"mb-1.5 shrink-0"}),e.jsx("p",{className:"text-xs font-bold truncate w-full",style:{color:y===t.id?t.color:"var(--text)"},children:t.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mt-0.5 truncate w-full",children:t.desc})]},t.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:s.name,onChange:t=>o({...s,name:t.target.value}),placeholder:"Mi Bot",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Par"}),e.jsx("select",{value:s.pair,onChange:t=>o({...s,pair:t.target.value}),className:"w-full",children:Te.map(t=>e.jsx("option",{value:t,children:le(t)},t))})]})]}),y==="signal"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:s.timeframe,onChange:t=>o({...s,timeframe:t.target.value}),className:"w-full",children:ne.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:s.balance,onChange:t=>o({...s,balance:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:s.riskPercent,onChange:t=>o({...s,riskPercent:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"âš¡ Modo de EjecuciÃ³n"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:s.executionMode==="leveraged"?"Apalancado (LONG/SHORT con margen)":"Spot (compra/venta directa)"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>o({...s,executionMode:"spot",leverage:"1"}),className:`px-3 py-1 rounded-lg text-[10px] font-bold transition-all ${s.executionMode==="spot"?"bg-[var(--gold)] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)]"}`,children:"Spot"}),e.jsx("button",{onClick:()=>o({...s,executionMode:"leveraged",leverage:"3"}),className:`px-3 py-1 rounded-lg text-[10px] font-bold transition-all ${s.executionMode==="leveraged"?"bg-[#F7931A] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)]"}`,children:"Apalancado"})]})]}),s.executionMode==="leveraged"&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Apalancamiento"}),e.jsx("div",{className:"flex gap-1.5",children:[2,3,5,10,20,50].map(t=>e.jsxs("button",{onClick:()=>o({...s,leverage:t.toString()}),className:`flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all ${parseInt(s.leverage)===t?"bg-[#F7931A] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)] hover:bg-[var(--surface-2)]/80"}`,children:[t,"x"]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx(K,{size:12,className:"text-[#F7931A] shrink-0"}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Colateral: ",e.jsxs("strong",{className:"text-[var(--gold)]",children:["$",s.balance]})," KAIROS â†’ PosiciÃ³n: ",e.jsxs("strong",{className:"text-[var(--gold)]",children:["$",(parseFloat(s.balance||0)*parseInt(s.leverage||1)).toLocaleString()]})," USD (",s.leverage,"x)"]})]}),parseInt(s.leverage)>=10&&e.jsxs("p",{className:"text-[10px] text-[var(--red)] flex items-center gap-1",children:[e.jsx(K,{size:10})," Leverage alto: mayor riesgo de liquidaciÃ³n"]})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"ðŸ“ Trailing Stop"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"SL que se mueve protegiendo ganancias"})]}),e.jsx("button",{onClick:()=>o({...s,trailingStop:!s.trailingStop}),className:`w-10 h-5 rounded-full transition-colors relative ${s.trailingStop?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full absolute top-0.5 transition-transform ${s.trailingStop?"left-5":"left-0.5"}`})})]}),s.trailingStop&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Trail Distance (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.trailingStopPct,onChange:t=>o({...s,trailingStopPct:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"ActivaciÃ³n (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.trailingActivation,onChange:t=>o({...s,trailingActivation:t.target.value}),className:"w-full"})]})]})]})]}),y==="script"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:s.timeframe,onChange:t=>o({...s,timeframe:t.target.value}),className:"w-full",children:ne.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:s.balance,onChange:t=>o({...s,balance:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:s.riskPercent,onChange:t=>o({...s,riskPercent:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"âš¡ Modo de EjecuciÃ³n"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:s.executionMode==="leveraged"?"Apalancado (LONG/SHORT con margen)":"Spot (compra/venta directa)"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>o({...s,executionMode:"spot",leverage:"1"}),className:`px-3 py-1 rounded-lg text-[10px] font-bold transition-all ${s.executionMode==="spot"?"bg-[var(--gold)] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)]"}`,children:"Spot"}),e.jsx("button",{onClick:()=>o({...s,executionMode:"leveraged",leverage:"3"}),className:`px-3 py-1 rounded-lg text-[10px] font-bold transition-all ${s.executionMode==="leveraged"?"bg-[#F7931A] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)]"}`,children:"Apalancado"})]})]}),s.executionMode==="leveraged"&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Apalancamiento"}),e.jsx("div",{className:"flex gap-1.5",children:[2,3,5,10,20,50].map(t=>e.jsxs("button",{onClick:()=>o({...s,leverage:t.toString()}),className:`flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all ${parseInt(s.leverage)===t?"bg-[#F7931A] text-black":"bg-[var(--surface-2)] text-[var(--text-dim)]"}`,children:[t,"x"]},t))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx(K,{size:12,className:"text-[#F7931A] shrink-0"}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Colateral: ",e.jsxs("strong",{className:"text-[var(--gold)]",children:["$",s.balance]})," â†’ PosiciÃ³n: ",e.jsxs("strong",{className:"text-[var(--gold)]",children:["$",(parseFloat(s.balance||0)*parseInt(s.leverage||1)).toLocaleString()]})," (",s.leverage,"x)"]})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"ðŸ“ Trailing Stop"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"SL que se mueve protegiendo ganancias"})]}),e.jsx("button",{onClick:()=>o({...s,trailingStop:!s.trailingStop}),className:`w-10 h-5 rounded-full transition-colors relative ${s.trailingStop?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full absolute top-0.5 transition-transform ${s.trailingStop?"left-5":"left-0.5"}`})})]}),s.trailingStop&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Trail Distance (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.trailingStopPct,onChange:t=>o({...s,trailingStopPct:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"ActivaciÃ³n (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.trailingActivation,onChange:t=>o({...s,trailingActivation:t.target.value}),className:"w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Estrategia"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.scriptStrategyId,onChange:t=>o({...s,scriptStrategyId:t.target.value}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Seleccionar estrategia..."}),v.filter(t=>t.type==="custom_script").map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shrink-0",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(E,{size:13})," ",v.filter(t=>t.type==="custom_script").length>0?"Crear Nueva":"Crear Estrategia"]})]})]})]}),y==="grid"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Superior ($)"}),e.jsx("input",{type:"number",value:s.upperPrice,onChange:t=>o({...s,upperPrice:t.target.value}),placeholder:"100000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Inferior ($)"}),e.jsx("input",{type:"number",value:s.lowerPrice,onChange:t=>o({...s,lowerPrice:t.target.value}),placeholder:"90000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Niveles de Grid"}),e.jsx("input",{type:"number",value:s.gridLines,onChange:t=>o({...s,gridLines:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"InversiÃ³n Total ($)"}),e.jsx("input",{type:"number",value:s.balance,onChange:t=>o({...s,balance:t.target.value}),className:"w-full"})]})]}),y==="dca"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"$ por Compra"}),e.jsx("input",{type:"number",value:s.investmentPerOrder,onChange:t=>o({...s,investmentPerOrder:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Intervalo (min)"}),e.jsx("input",{type:"number",value:s.intervalMinutes,onChange:t=>o({...s,intervalMinutes:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"MÃ¡x. Compras"}),e.jsx("input",{type:"number",value:s.maxOrders,onChange:t=>o({...s,maxOrders:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.useRsiFilter,onChange:t=>o({...s,useRsiFilter:t.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro RSI (comprar solo si RSI < ",s.rsiThreshold,")"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.usePriceDipFilter,onChange:t=>o({...s,usePriceDipFilter:t.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro de CaÃ­da (comprar cuando baje ",s.dipPercent,"%)"]})]})]}),b.filter(t=>t.connected).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Broker (ejecuciÃ³n real)"}),e.jsxs("select",{value:s.brokerId,onChange:t=>o({...s,brokerId:t.target.value}),className:"w-full",children:[e.jsx("option",{value:"",children:"Demo (sin broker)"}),b.filter(t=>t.connected).map(t=>e.jsxs("option",{value:t.id,children:["ðŸŸ¢ ",t.name||t.broker," â€” Real"]},t.id))]}),s.brokerId&&e.jsx("p",{className:"text-[10px] text-[var(--red)] mt-1 font-semibold",children:"âš ï¸ Este bot ejecutarÃ¡ Ã³rdenes REALES con dinero real"})]}),ee&&e.jsxs("p",{className:"text-xs text-[var(--red)] font-semibold px-1",children:["âš ï¸ ",ee]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ge,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm font-bold text-center justify-center",children:"Crear Bot"}),e.jsx("button",{onClick:()=>{d(!1),C("")},className:"px-4 py-2.5 bg-[var(--surface-2)] text-[var(--text-dim)] rounded-xl text-sm border border-[var(--border)] text-center shrink-0",children:"Cancelar"})]})]})})}),S.length===0?e.jsxs("div",{className:"rounded-2xl p-16 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(Pe,{size:56,className:"text-[var(--text-dim)]/20 mx-auto mb-5"}),e.jsx("p",{className:"text-lg text-[var(--text-dim)] font-semibold",children:"No hay bots creados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-2",children:"Crea tu primer bot para automatizar tu trading"}),e.jsxs("button",{onClick:()=>d(!0),className:"mt-5 px-6 py-3 btn-gold rounded-xl text-sm font-bold inline-flex items-center gap-2",children:[e.jsx(U,{size:16})," Crear Bot"]})]}):e.jsx("div",{className:"space-y-4",children:S.map(t=>{var A;const l=je(t.botType||"signal"),n=l.icon,i=ue(t),u=t.brokerId?ve(t.brokerId):null,j=t.scriptName||((A=t.strategy)==null?void 0:A.name)||"Default";return e.jsxs(O.div,{layout:!0,className:"rounded-2xl overflow-hidden min-w-0",style:{background:"var(--surface)",border:`1px solid ${t.status==="active"?"rgba(0,220,130,0.2)":"var(--border)"}`},children:[e.jsxs("div",{className:"p-5 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:()=>se(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:`${l.color}12`,border:`1px solid ${l.color}25`},children:e.jsx(n,{size:24,style:{color:l.color}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-wrap",children:[e.jsx("p",{className:"text-base font-bold truncate",children:t.name}),e.jsx("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-lg uppercase tracking-wider shrink-0",style:{background:`${l.color}15`,color:l.color},children:l.label})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-[var(--text-dim)] flex-wrap",children:[e.jsx("span",{className:"font-semibold text-[var(--text-secondary)]",children:le(t.pair)}),t.timeframe&&e.jsxs("span",{children:["â€¢ ",t.timeframe]}),e.jsxs("span",{children:["â€¢ ",j]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("span",{className:"px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap",style:{color:_(t.status),background:`${_(t.status)}15`,border:`1px solid ${_(t.status)}20`},children:t.status==="active"?"â— Activo":t.status==="paused"?"âšâš Pausado":"â–  Detenido"}),t.executionMode==="leveraged"&&t.leverage>1&&e.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap",style:{color:"#f59e0b",background:"rgba(245,158,11,0.1)",border:"1px solid rgba(245,158,11,0.2)"},children:["âš¡ ",t.leverage,"x"]}),e.jsx(we,{size:16,className:"text-[var(--text-dim)]"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[i?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Se,{size:13,className:"text-[var(--green)] shrink-0"}),e.jsx("span",{className:"font-semibold text-[var(--text)]",children:i.label||i.name||i.broker}),e.jsx("span",{className:"text-[var(--green)] font-bold",children:"â€¢ Conectado"})]}):e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsx("span",{className:"text-[var(--text-dim)]",children:"ðŸ“‹ Modo Demo"})}),u&&u.balances.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(ce,{size:13,className:"text-[var(--gold)] shrink-0"}),e.jsxs("span",{className:"font-semibold text-[var(--text)]",children:["Saldo: ",u.balances.slice(0,3).map(p=>`${parseFloat(p.free).toFixed(4)} ${p.asset}`).join(" â€¢ ")]})]})]})]}),(()=>{const p=pe[t.id],M=parseFloat(t.pnl)||0,ye=(p==null?void 0:p.unrealizedPnl)||0,q=M+ye,G=(p==null?void 0:p.pnlPercent)||0,V=parseFloat(t.balance)||0,re=V+q,ae=q>=0,ie=!!(p!=null&&p.position);return e.jsxs("div",{className:"grid grid-cols-2 gap-px",style:{background:"var(--border)",borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Trades"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:t.trades||0})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:ie?"ðŸ“Š P&L Vivo":"P&L"}),e.jsxs("p",{className:`text-base sm:text-lg font-bold ${ae?"text-[var(--green)]":"text-[var(--red)]"}`,children:[ae?"+":"","$",q.toFixed(2)]}),ie&&e.jsxs("p",{className:`text-[10px] font-bold ${G>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[G>=0?"+":"",G.toFixed(2),"%"]})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Win Rate"}),e.jsxs("p",{className:"text-base sm:text-lg font-bold text-[var(--gold)]",children:[(t.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Balance"}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-base sm:text-lg font-bold ${re>=V?"text-[var(--green)]":"text-[var(--red)]"}`,children:["$",re.toFixed(2)]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Inicio: $",V.toFixed(2)]})]})]})]})})(),e.jsxs("div",{className:"flex gap-2 sm:gap-3 p-3 sm:p-4 flex-wrap items-center",style:{borderTop:"1px solid var(--border)"},children:[t.status!=="active"?e.jsxs("button",{onClick:p=>{p.stopPropagation(),he(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--green)]/10 text-[var(--green)] rounded-xl text-sm font-bold hover:bg-[var(--green)]/20 transition-colors border border-[var(--green)]/20",children:[e.jsx(Ce,{size:15,className:"shrink-0"})," Iniciar"]}):e.jsxs("button",{onClick:p=>{p.stopPropagation(),fe(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--gold)]/10 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/20 transition-colors border border-[var(--gold)]/20",children:[e.jsx(Fe,{size:15,className:"shrink-0"})," Pausar"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),z(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--text-dim)] rounded-xl text-sm hover:text-[var(--text)] transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx($e,{size:15,className:"shrink-0"})," Detener"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),se(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--gold)] rounded-xl text-sm font-semibold hover:bg-[var(--gold)]/10 transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--gold)/20"},children:[e.jsx(Be,{size:15,className:"shrink-0"})," Ver GrÃ¡fico"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),be(t)},className:"ml-auto inline-flex items-center justify-center gap-1.5 px-4 py-2.5 text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/10 rounded-xl text-sm transition-colors",children:[e.jsx(Ie,{size:14,className:"shrink-0"})," Eliminar"]})]})]},t.id)})}),D.length>0&&e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("button",{onClick:()=>oe(t=>!t),className:"w-full flex items-center justify-between p-4 cursor-pointer hover:bg-[var(--gold)]/5 transition-colors",style:{borderBottom:T?"1px solid var(--border)":"none"},children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[var(--green)] animate-pulse"}),"Actividad en Vivo",e.jsxs("span",{className:"text-xs font-normal text-[var(--text-dim)] ml-1",children:["(",D.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T&&e.jsx("span",{onClick:t=>{t.stopPropagation(),I([])},className:"text-sm text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors px-3 py-1 rounded-lg hover:bg-[var(--gold)]/10",children:"Limpiar"}),e.jsx(Ae,{size:18,className:"text-[var(--text-dim)] transition-transform duration-300",style:{transform:T?"rotate(180deg)":"rotate(0deg)"}})]})]}),e.jsx(Q,{initial:!1,children:T&&e.jsx(O.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("div",{className:"max-h-56 overflow-y-auto p-4 space-y-1.5 font-mono text-xs",children:D.slice(-50).reverse().map((t,l)=>{var n;return e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:t.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0 font-semibold",children:["[",t.bot,"]"]}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:t.message||`${(n=t.side)==null?void 0:n.toUpperCase()} ${t.quantity} @ $${t.price}`})]},l)})})})})]}),v.filter(t=>t.type==="custom_script").length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("h2",{className:"text-base font-bold flex items-center gap-2.5 min-w-0",children:[e.jsx(E,{size:18,className:"text-[#A855F7] shrink-0"})," Mis Estrategias"]}),e.jsxs("button",{onClick:()=>g(!0),className:"text-sm text-[var(--text-dim)] hover:text-[#A855F7] transition-colors flex items-center gap-1.5 shrink-0 px-3 py-1.5 rounded-xl hover:bg-[#A855F7]/10",children:[e.jsx(U,{size:14})," Nueva"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:v.filter(t=>t.type==="custom_script").map(t=>{var l;return e.jsxs("div",{className:"rounded-xl p-4 transition-colors hover:bg-[var(--dark-3)] min-w-0",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-[var(--text)] flex items-center gap-2 min-w-0 truncate",children:[e.jsx(E,{size:14,className:"text-[#A855F7] shrink-0"})," ",e.jsx("span",{className:"truncate",children:t.name})]}),e.jsx("button",{onClick:()=>{w(t),g(!0)},className:"text-[var(--text-dim)] hover:text-[#A855F7] transition-colors shrink-0 p-1.5 rounded-lg hover:bg-[#A855F7]/10",children:e.jsx(Oe,{size:14})})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] truncate",children:[((l=t.code)==null?void 0:l.split(`
`).filter(n=>n.trim()&&!n.trim().startsWith("//")).length)||0," lÃ­neas de lÃ³gica"]}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 truncate",children:["Creada: ",new Date(t.createdAt).toLocaleDateString("es")]})]},t.id)})})]}),e.jsx(Q,{children:m&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{g(!1),w(null)},children:e.jsx(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsx(Ee,{initialCode:f==null?void 0:f.code,initialName:f==null?void 0:f.name,editMode:!!f,onClose:()=>{g(!1),w(null)},onSave:t=>{const l=P(t);o(n=>({...n,scriptStrategyId:l.id})),g(!1),w(null)}})})})})]})}export{Ye as default};
//# sourceMappingURL=BotManager-9WGpW-jX.js.map
