{"version":3,"file":"TradingChart-C1Ryw65p.js","sources":["../../src/components/Chart/TradingChart.jsx"],"sourcesContent":["// Kairos Trade — Professional Trading Chart (TradingView Lightweight Charts)\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { createChart, ColorType, CrosshairMode } from 'lightweight-charts';\nimport { TIMEFRAMES, POPULAR_PAIRS } from '../../constants';\nimport { calculateEMA, calculateRSI, calculateBollingerBands, calculateSMA } from '../../services/indicators';\nimport marketData from '../../services/marketData';\nimport { toApiPair, getBase, formatPair, QUOTE } from '../../utils/pairUtils';\nimport useStore from '../../store/useStore';\nimport { Search, TrendingUp } from 'lucide-react';\n\nexport default function TradingChart() {\n  const chartContainerRef = useRef(null);\n  const chartRef = useRef(null);\n  const candleSeriesRef = useRef(null);\n  const volumeSeriesRef = useRef(null);\n  const indicatorSeriesRef = useRef([]);\n  const wsCleanupRef = useRef(null);\n\n  const { selectedPair, selectedTimeframe, setSelectedPair, setSelectedTimeframe, setCurrentPrice, setPriceChange24h } = useStore();\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [searchOpen, setSearchOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [activeIndicators, setActiveIndicators] = useState(['ema20']);\n\n  // Initialize chart ONCE\n  useEffect(() => {\n    const container = chartContainerRef.current;\n    if (!container) return;\n\n    let disposed = false;\n    const timers = [];\n    let rafId = null;\n\n    // Ensure container has dimensions before creating chart\n    const rect = container.getBoundingClientRect();\n    const initWidth = rect.width || container.clientWidth || 800;\n    const initHeight = rect.height || container.clientHeight || 500;\n\n    const chart = createChart(container, {\n      width: initWidth,\n      height: initHeight,\n      layout: {\n        background: { type: ColorType.Solid, color: '#0B0E11' },\n        textColor: '#848E9C',\n        fontFamily: 'Inter, sans-serif',\n        fontSize: 11,\n      },\n      grid: {\n        vertLines: { color: '#1E222D' },\n        horzLines: { color: '#1E222D' },\n      },\n      crosshair: {\n        mode: CrosshairMode.Normal,\n        vertLine: { color: '#3B82F6', width: 1, style: 2, labelBackgroundColor: '#3B82F6' },\n        horzLine: { color: '#3B82F6', width: 1, style: 2, labelBackgroundColor: '#3B82F6' },\n      },\n      timeScale: {\n        borderColor: '#1E222D',\n        timeVisible: true,\n        secondsVisible: false,\n        rightOffset: 5,\n        barSpacing: 8,\n      },\n      rightPriceScale: {\n        borderColor: '#1E222D',\n        scaleMargins: { top: 0.05, bottom: 0.2 },\n      },\n      handleScroll: { mouseWheel: true, pressedMouseMove: true },\n      handleScale: { axisPressedMouseMove: true, mouseWheel: true, pinch: true },\n    });\n\n    const candleSeries = chart.addCandlestickSeries({\n      upColor: '#0ECB81',\n      downColor: '#F6465D',\n      borderUpColor: '#0ECB81',\n      borderDownColor: '#F6465D',\n      wickUpColor: '#0ECB81',\n      wickDownColor: '#F6465D',\n    });\n\n    const volumeSeries = chart.addHistogramSeries({\n      color: '#3B82F622',\n      priceFormat: { type: 'volume' },\n      priceScaleId: 'volume',\n    });\n\n    chart.priceScale('volume').applyOptions({\n      scaleMargins: { top: 0.8, bottom: 0 },\n    });\n\n    chartRef.current = chart;\n    candleSeriesRef.current = candleSeries;\n    volumeSeriesRef.current = volumeSeries;\n\n    // Force resize after layout settles (handles AnimatePresence transitions)\n    const resizeAfterLayout = () => {\n      if (disposed) return;\n      try {\n        const r = container.getBoundingClientRect();\n        if (r.width > 0 && r.height > 0) {\n          chart.applyOptions({ width: r.width, height: r.height });\n        }\n      } catch { /* chart may be disposed */ }\n    };\n    rafId = requestAnimationFrame(resizeAfterLayout);\n    timers.push(setTimeout(resizeAfterLayout, 100));\n    timers.push(setTimeout(resizeAfterLayout, 300));\n\n    // Responsive resize\n    const ro = new ResizeObserver(entries => {\n      if (disposed || !entries || !entries[0]) return;\n      const { width, height } = entries[0].contentRect;\n      if (width > 0 && height > 0) {\n        try { chart.applyOptions({ width, height }); } catch { /* chart may be disposed */ }\n      }\n    });\n    ro.observe(container);\n\n    return () => {\n      disposed = true;\n      timers.forEach(clearTimeout);\n      if (rafId) cancelAnimationFrame(rafId);\n      ro.disconnect();\n      try { chart.remove(); } catch { /* already disposed */ }\n      chartRef.current = null;\n      candleSeriesRef.current = null;\n      volumeSeriesRef.current = null;\n    };\n  }, []);\n\n  // Load candle data when pair/timeframe changes\n  useEffect(() => {\n    let cancelled = false;\n\n    const load = async () => {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const apiPair = toApiPair(selectedPair);\n        const [candles, ticker] = await Promise.all([\n          marketData.getCandles(apiPair, selectedTimeframe, 500),\n          marketData.get24hrTicker(apiPair),\n        ]);\n\n        if (cancelled) return;\n\n        if (!candles || candles.length === 0) {\n          setError('No se recibieron datos de Binance');\n          setLoading(false);\n          return;\n        }\n\n        // Filter out any candles with null/NaN values\n        const validCandles = candles.filter(c => \n          c && c.time && isFinite(c.open) && isFinite(c.high) && isFinite(c.low) && isFinite(c.close)\n        );\n\n        if (validCandles.length === 0) {\n          setError('Sin datos válidos');\n          setLoading(false);\n          return;\n        }\n\n        // Set candle data\n        if (candleSeriesRef.current) {\n          try { candleSeriesRef.current.setData(validCandles); } catch { /* disposed */ }\n        }\n\n        // Set volume data\n        if (volumeSeriesRef.current) {\n          try {\n          volumeSeriesRef.current.setData(validCandles.map(c => ({\n            time: c.time,\n            value: c.volume || 0,\n            color: c.close >= c.open ? 'rgba(14,203,129,0.2)' : 'rgba(246,70,93,0.2)',\n          })));\n          } catch { /* disposed */ }\n        }\n\n        // Update store\n        setCurrentPrice(ticker.price);\n        setPriceChange24h(ticker.changePercent);\n\n        // Apply indicators (safely)\n        try {\n          applyIndicators(validCandles);\n        } catch (indErr) {\n          console.warn('Indicator error (non-fatal):', indErr);\n        }\n\n        // Fit content\n        if (chartRef.current) {\n          try { chartRef.current.timeScale().fitContent(); } catch { /* disposed */ }\n        }\n      } catch (err) {\n        console.error('Chart data load error:', err);\n        if (!cancelled) setError(`Error cargando datos: ${err.message}`);\n      }\n\n      if (!cancelled) setLoading(false);\n    };\n\n    load();\n\n    // WebSocket real-time updates\n    if (wsCleanupRef.current) {\n      wsCleanupRef.current();\n    }\n\n    wsCleanupRef.current = marketData.connectStream(toApiPair(selectedPair), {\n      onTicker: (data) => {\n        setCurrentPrice(data.price);\n        setPriceChange24h(data.changePercent);\n      },\n      onCandle: (candle) => {\n        try {\n          if (candleSeriesRef.current) {\n            candleSeriesRef.current.update(candle);\n          }\n          if (volumeSeriesRef.current) {\n            volumeSeriesRef.current.update({\n              time: candle.time,\n              value: candle.volume || 0,\n              color: candle.close >= candle.open ? 'rgba(14,203,129,0.2)' : 'rgba(246,70,93,0.2)',\n            });\n          }\n        } catch (e) {\n          // Chart may be disposed during navigation — safe to ignore\n        }\n      },\n    });\n\n    return () => {\n      cancelled = true;\n      if (wsCleanupRef.current) {\n        wsCleanupRef.current();\n        wsCleanupRef.current = null;\n      }\n    };\n  }, [selectedPair, selectedTimeframe]);\n\n  // Apply technical indicators (safe)\n  const applyIndicators = (candles) => {\n    if (!chartRef.current) return;\n\n    // Remove old indicators\n    indicatorSeriesRef.current.forEach(s => {\n      try { chartRef.current?.removeSeries(s); } catch {}\n    });\n    indicatorSeriesRef.current = [];\n\n    const closes = candles.map(c => c.close);\n    const times = candles.map(c => c.time);\n\n    activeIndicators.forEach(ind => {\n      try {\n        if (ind === 'ema20') {\n          const ema = calculateEMA(closes, 20);\n          const validData = ema.map((v, i) => (v != null && isFinite(v)) ? { time: times[i], value: v } : null).filter(Boolean);\n          if (validData.length > 0) {\n            const series = chartRef.current.addLineSeries({ color: '#3B82F6', lineWidth: 1.5, title: 'EMA 20', lastValueVisible: false, priceLineVisible: false });\n            series.setData(validData);\n            indicatorSeriesRef.current.push(series);\n          }\n        }\n        if (ind === 'ema50') {\n          const ema = calculateEMA(closes, 50);\n          const validData = ema.map((v, i) => (v != null && isFinite(v)) ? { time: times[i], value: v } : null).filter(Boolean);\n          if (validData.length > 0) {\n            const series = chartRef.current.addLineSeries({ color: '#8B5CF6', lineWidth: 1.5, title: 'EMA 50', lastValueVisible: false, priceLineVisible: false });\n            series.setData(validData);\n            indicatorSeriesRef.current.push(series);\n          }\n        }\n        if (ind === 'sma200') {\n          const sma = calculateSMA(closes, 200);\n          const validData = sma.map((v, i) => (v != null && isFinite(v)) ? { time: times[i], value: v } : null).filter(Boolean);\n          if (validData.length > 0) {\n            const series = chartRef.current.addLineSeries({ color: '#FF6D00', lineWidth: 1, title: 'SMA 200', lastValueVisible: false, priceLineVisible: false });\n            series.setData(validData);\n            indicatorSeriesRef.current.push(series);\n          }\n        }\n        if (ind === 'bb') {\n          const bb = calculateBollingerBands(closes);\n          const upperData = bb.upper.map((v, i) => (v != null && isFinite(v)) ? { time: times[i], value: v } : null).filter(Boolean);\n          const lowerData = bb.lower.map((v, i) => (v != null && isFinite(v)) ? { time: times[i], value: v } : null).filter(Boolean);\n          if (upperData.length > 0) {\n            const upperS = chartRef.current.addLineSeries({ color: '#9C27B0', lineWidth: 1, lineStyle: 2, title: 'BB Upper', lastValueVisible: false, priceLineVisible: false });\n            const lowerS = chartRef.current.addLineSeries({ color: '#9C27B0', lineWidth: 1, lineStyle: 2, title: 'BB Lower', lastValueVisible: false, priceLineVisible: false });\n            upperS.setData(upperData);\n            lowerS.setData(lowerData);\n            indicatorSeriesRef.current.push(upperS, lowerS);\n          }\n        }\n      } catch (e) {\n        console.warn(`Indicator ${ind} error:`, e);\n      }\n    });\n  };\n\n  // Re-apply indicators when toggled\n  useEffect(() => {\n    if (!candleSeriesRef.current) return;\n    const load = async () => {\n      try {\n        const candles = await marketData.getCandles(toApiPair(selectedPair), selectedTimeframe, 500);\n        applyIndicators(candles);\n      } catch {}\n    };\n    load();\n  }, [activeIndicators]);\n\n  const toggleIndicator = (ind) => {\n    setActiveIndicators(prev =>\n      prev.includes(ind) ? prev.filter(i => i !== ind) : [...prev, ind]\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col w-full flex-1 min-h-0\">\n      {/* Chart toolbar */}\n      <div className=\"flex items-center gap-2 px-3 py-2 shrink-0 flex-wrap\" style={{ borderBottom: '1px solid var(--border)' }}>\n        {/* Pair selector */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setSearchOpen(!searchOpen)}\n            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors\"\n          >\n            <Search size={13} className=\"text-[var(--text-dim)]\" />\n            {formatPair(selectedPair)}\n          </button>\n          {searchOpen && (\n            <div className=\"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2\">\n              <input\n                type=\"text\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value.toUpperCase())}\n                placeholder=\"Buscar par...\"\n                className=\"w-full text-sm mb-2\"\n                autoFocus\n              />\n              <div className=\"max-h-48 overflow-y-auto space-y-0.5\">\n                {POPULAR_PAIRS\n                  .filter(p => p.includes(searchQuery))\n                  .map(pair => (\n                    <button\n                      key={pair}\n                      onClick={() => { setSelectedPair(pair); setSearchOpen(false); setSearchQuery(''); }}\n                      className={`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors\n                        ${pair === selectedPair ? 'bg-[var(--gold)]/15 text-[var(--gold)]' : 'text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]'}`}\n                    >\n                      {formatPair(pair)}\n                    </button>\n                  ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Timeframes */}\n        <div className=\"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5\">\n          {TIMEFRAMES.map(tf => (\n            <button\n              key={tf.value}\n              onClick={() => setSelectedTimeframe(tf.value)}\n              className={`px-2.5 py-1 text-xs rounded-md transition-colors\n                ${selectedTimeframe === tf.value ? 'bg-[var(--gold)] text-white font-bold' : 'text-[var(--text-dim)] hover:text-[var(--text)]'}`}\n            >\n              {tf.label}\n            </button>\n          ))}\n        </div>\n\n        {/* Indicators */}\n        <div className=\"flex items-center gap-1 ml-auto\">\n          <TrendingUp size={13} className=\"text-[var(--text-dim)]\" />\n          {[\n            { id: 'ema20', label: 'EMA 20', color: '#3B82F6' },\n            { id: 'ema50', label: 'EMA 50', color: '#8B5CF6' },\n            { id: 'sma200', label: 'SMA 200', color: '#FF6D00' },\n            { id: 'bb', label: 'BB', color: '#9C27B0' },\n          ].map(ind => (\n            <button\n              key={ind.id}\n              onClick={() => toggleIndicator(ind.id)}\n              className={`px-2 py-0.5 text-[11px] rounded transition-all\n                ${activeIndicators.includes(ind.id)\n                  ? 'font-semibold'\n                  : 'text-[var(--text-dim)] hover:text-[var(--text)]'\n                }`}\n              style={activeIndicators.includes(ind.id) ? { color: ind.color, background: `${ind.color}15` } : {}}\n            >\n              {ind.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Chart container — MUST have explicit height */}\n      <div\n        ref={chartContainerRef}\n        className=\"relative\"\n        style={{ flex: '1 1 0%', minHeight: 0, overflow: 'hidden' }}\n      >\n        {/* Loading overlay */}\n        {loading && (\n          <div className=\"absolute inset-0 flex items-center justify-center z-20\" style={{ background: 'rgba(11,14,17,0.85)' }}>\n            <div className=\"flex flex-col items-center gap-2\">\n              <div className=\"w-8 h-8 border-2 border-[var(--gold)] border-t-transparent rounded-full animate-spin\" />\n              <span className=\"text-xs text-[var(--text-dim)]\">Cargando {formatPair(selectedPair)}...</span>\n            </div>\n          </div>\n        )}\n\n        {/* Error message */}\n        {error && !loading && (\n          <div className=\"absolute inset-0 flex items-center justify-center z-20\" style={{ background: 'rgba(11,14,17,0.9)' }}>\n            <div className=\"text-center\">\n              <p className=\"text-sm text-[var(--red)] mb-2\">{typeof error === 'string' ? error : String(error)}</p>\n              <button\n                onClick={() => { setError(null); setLoading(true); }}\n                className=\"px-4 py-2 text-xs bg-[var(--gold)] text-white rounded-lg font-semibold\"\n              >\n                Reintentar\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":["TradingChart","chartContainerRef","useRef","chartRef","candleSeriesRef","volumeSeriesRef","indicatorSeriesRef","wsCleanupRef","selectedPair","selectedTimeframe","setSelectedPair","setSelectedTimeframe","setCurrentPrice","setPriceChange24h","useStore","loading","setLoading","useState","error","setError","searchOpen","setSearchOpen","searchQuery","setSearchQuery","activeIndicators","setActiveIndicators","useEffect","container","disposed","timers","rafId","rect","initWidth","initHeight","chart","createChart","ColorType","CrosshairMode","candleSeries","volumeSeries","resizeAfterLayout","r","ro","entries","width","height","cancelled","apiPair","toApiPair","candles","ticker","marketData","validCandles","c","applyIndicators","indErr","err","data","candle","_a","closes","times","ind","validData","calculateEMA","v","i","series","calculateSMA","bb","calculateBollingerBands","upperData","lowerData","upperS","lowerS","e","toggleIndicator","prev","jsxs","jsx","Search","formatPair","POPULAR_PAIRS","p","pair","TIMEFRAMES","tf","TrendingUp"],"mappings":"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"}