import{j as e,m as D,a3 as N,X as B,e as $,a8 as M,ai as L,I,P as T,aj as _,k as O,aa as U,ak as W,Z,n as G,s as V,B as H,al as K,a0 as X,Q as q}from"./ui-CebUoxKF.js";import{a as b}from"./vendor-CUCP814w.js";import{v as E,S as Q,b as J}from"./kairosScript-uRRN30t1.js";import{m as Y}from"./marketData-K1zKCjjj.js";function S(a){let d=a;const m=[...d.matchAll(/```(?:javascript|js|jsx)?\s*\n([\s\S]*?)```/g)];m.length>0&&(d=m.reduce((i,t)=>t[1].length>i.length?t[1]:i,""));const u=d.split(`
`),g=[];let o=!1;for(let i=0;i<u.length;i++){const t=u[i],r=t.trim();if(!o&&!r)continue;if(r===""||r.startsWith("//")||r.startsWith("/*")||r.startsWith("*")||r.startsWith("*/")||/^(config|const |let |var |if |else|for |while |function |return |buy|sell|log|alert|\{|\}|\(|\)|\/\/)/.test(r)||/^[a-zA-Z_$][a-zA-Z0-9_$]*\s*[\(=\.\[]/.test(r)||/^[a-zA-Z_$][a-zA-Z0-9_$]*\s*[+\-*/%<>&|!]/.test(r)||/^\}/.test(r))o=!0,g.push(t);else if(o&&!u.slice(i).some(p=>/^(\/\/|config|const |let |var |if |else|buy|sell|log)/.test(p.trim())))break}return g.join(`
`).trim()||d.trim()}function ee({code:a,onChange:d,error:m}){const u=b.useRef(null),g=t=>{if(t.key==="Tab"){t.preventDefault();const r=t.target.selectionStart,x=t.target.selectionEnd;d(a.substring(0,r)+"  "+a.substring(x)),setTimeout(()=>{t.target.selectionStart=t.target.selectionEnd=r+2},0)}},o=t=>{t.preventDefault();const r=t.clipboardData.getData("text"),x=S(r),c=t.target,l=c.selectionStart,p=c.selectionEnd,f=a.substring(0,l)+x+a.substring(p);d(f)},i=(a||"").split(`
`).length;return e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:`1px solid ${m?"#ef4444":"rgba(255,255,255,0.08)"}`},children:[m&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:"rgba(239,68,68,0.08)",borderBottom:"1px solid rgba(239,68,68,0.2)"},children:[e.jsx(V,{size:13,style:{color:"#ef4444"}}),e.jsx("span",{className:"text-xs",style:{color:"#ef4444"},children:m})]}),e.jsxs("div",{className:"flex",style:{background:"#0d1117"},children:[e.jsx("div",{className:"select-none text-right pr-3 pl-3 pt-4 pb-4 shrink-0 font-mono text-[11px] leading-6",style:{color:"#484f58",background:"#0d1117",borderRight:"1px solid rgba(255,255,255,0.06)",minWidth:44},children:Array.from({length:Math.max(i,12)},(t,r)=>e.jsx("div",{children:r+1},r))}),e.jsx("textarea",{ref:u,value:a,onChange:t=>d(t.target.value),onPaste:o,onKeyDown:g,spellCheck:!1,className:"flex-1 p-4 font-mono text-[12px] leading-6 resize-none outline-none",style:{background:"#0d1117",color:"#c9d1d9",caretColor:"#3B82F6",minHeight:260},placeholder:"// Pega o escribe tu cÃ³digo aquÃ­..."})]})]})}function se({results:a}){if(!a)return null;const{trades:d,finalBalance:m,totalTrades:u,wins:g,losses:o,winRate:i,totalPnl:t,maxDrawdown:r,profitFactor:x}=a,c=t>=0;return e.jsxs(D.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Balance",value:`$${m.toFixed(0)}`,icon:H,color:c?"#00DC82":"#ef4444"},{label:"Win Rate",value:`${i.toFixed(0)}%`,icon:K,color:i>=50?"#00DC82":"#ef4444"},{label:"Drawdown",value:`${r.toFixed(1)}%`,icon:X,color:r<10?"#00DC82":"#ef4444"},{label:"Profit F.",value:x===1/0?"âˆž":x.toFixed(2),icon:q,color:x>=1.5?"#00DC82":"#ef4444"}].map((l,p)=>e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(l.icon,{size:16,className:"mx-auto mb-1",style:{color:l.color}}),e.jsx("p",{className:"text-[10px]",style:{color:"#8b949e"},children:l.label}),e.jsx("p",{className:"text-base font-bold",style:{color:l.color},children:l.value})]},p))}),e.jsxs("div",{className:"flex items-center gap-4 text-xs px-4 py-2.5 rounded-xl",style:{background:"var(--surface-2)"},children:[e.jsxs("span",{style:{color:"#8b949e"},children:["Trades: ",e.jsx("b",{style:{color:"#c9d1d9"},children:u})]}),e.jsxs("span",{style:{color:"#00DC82"},children:["âœ“ ",g]}),e.jsxs("span",{style:{color:"#ef4444"},children:["âœ— ",o]}),e.jsxs("span",{className:"ml-auto font-bold text-sm",style:{color:c?"#00DC82":"#ef4444"},children:[c?"+":"","$",t.toFixed(2)]})]}),d.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto rounded-xl",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{color:"#8b949e",borderBottom:"1px solid var(--border)"},children:[e.jsx("th",{className:"text-left p-2.5 text-[10px]",children:"Tipo"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"Entrada"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"Salida"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"P&L"})]})}),e.jsx("tbody",{children:d.slice(-8).reverse().map((l,p)=>{var f,h,y;return e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{className:"p-2.5 font-bold",style:{color:l.side==="buy"?"#00DC82":"#ef4444"},children:l.side==="buy"?"LONG":"SHORT"}),e.jsxs("td",{className:"p-2.5 text-right",style:{color:"#c9d1d9"},children:["$",(f=l.entryPrice)==null?void 0:f.toFixed(2)]}),e.jsxs("td",{className:"p-2.5 text-right",style:{color:"#c9d1d9"},children:["$",(h=l.exitPrice)==null?void 0:h.toFixed(2)]}),e.jsxs("td",{className:"p-2.5 text-right font-bold",style:{color:l.pnl>=0?"#00DC82":"#ef4444"},children:[l.pnl>=0?"+":"","$",(y=l.pnl)==null?void 0:y.toFixed(2)]})]},p)})})]})})]})}function oe({onSave:a,onClose:d,initialCode:m,initialName:u,editMode:g=!1}){const[o,i]=b.useState(u||""),[t,r]=b.useState(m||""),[x,c]=b.useState(null),[l,p]=b.useState("editor"),[f,h]=b.useState(null),[y,j]=b.useState(!1),[k,P]=b.useState("BTCUSDT"),[C,F]=b.useState("1h"),[v,w]=b.useState(!1);b.useEffect(()=>{const s=setTimeout(()=>{if(t!=null&&t.trim()){const n=E(t);c(n.valid?null:n.error)}else c(null)},600);return()=>clearTimeout(s)},[t]);const z=async()=>{j(!0),h(null);try{const s=await Y.getCandles(k,C,500);if(!s||s.length<50){c("No hay suficientes datos"),j(!1);return}h(J(t,s,{initialBalance:1e3,riskPercent:2}))}catch(s){c(`Error: ${s.message}`)}j(!1)},A=()=>{if(!o.trim()){c("Escribe un nombre para tu estrategia");return}const s=E(t);if(!s.valid){c(s.error);return}a==null||a({name:o.trim(),code:t,type:"custom_script"}),w(!0),setTimeout(()=>w(!1),2500)},R=async()=>{var s;try{const n=await((s=navigator.clipboard)==null?void 0:s.readText());n&&(r(S(n)),h(null))}catch{}};return e.jsxs(D.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},className:"rounded-2xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",style:{borderBottom:"1px solid var(--border)",background:"rgba(59,130,246,0.03)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(59,130,246,0.12)",border:"1px solid rgba(59,130,246,0.25)"},children:e.jsx(N,{size:20,style:{color:"#3B82F6"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold",style:{color:"#c9d1d9"},children:g?"Editar Estrategia":"Crear Estrategia"}),e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Escribe cÃ³digo, elige un template o pega desde ChatGPT"})]})]}),d&&e.jsx("button",{onClick:d,className:"w-9 h-9 rounded-xl flex items-center justify-center transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsx(B,{size:16,style:{color:"#8b949e"}})})]}),e.jsx("div",{className:"flex px-5 pt-3 gap-1",children:[{id:"editor",label:"Editor",icon:N},{id:"templates",label:"Templates",icon:$},{id:"help",label:"Referencia",icon:M}].map(s=>{const n=l===s.id;return e.jsxs("button",{onClick:()=>p(s.id),className:"flex items-center gap-1.5 px-4 py-2 rounded-t-xl text-xs font-semibold transition-all",style:{background:n?"var(--surface-2)":"transparent",color:n?"#3B82F6":"#8b949e",borderBottom:n?"2px solid #3B82F6":"2px solid transparent"},children:[e.jsx(s.icon,{size:13}),s.label]},s.id)})}),e.jsxs("div",{className:"p-5 space-y-4",children:[l==="editor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold mb-1.5 block",style:{color:"#8b949e"},children:"NOMBRE DE LA ESTRATEGIA"}),e.jsx("input",{value:o,onChange:s=>i(s.target.value),placeholder:"Ej: Mi Bot Scalper",className:"w-full px-4 py-2.5 rounded-xl text-sm outline-none transition-all focus:ring-1 focus:ring-[#D4AF37]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"}})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:R,className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"rgba(0,220,130,0.08)",border:"1px solid rgba(0,220,130,0.2)",color:"#00DC82"},children:[e.jsx(L,{size:14})," Pegar CÃ³digo"]}),e.jsxs("button",{onClick:()=>{var s;return(s=navigator.clipboard)==null?void 0:s.writeText(t)},className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:[e.jsx(I,{size:14})," Copiar"]}),e.jsxs("button",{onClick:()=>{r(""),h(null)},className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#8b949e"},children:[e.jsx(B,{size:14})," Limpiar"]})]}),e.jsx(ee,{code:t,onChange:s=>{r(s),h(null)},error:x}),e.jsxs("div",{className:"rounded-xl p-3 space-y-3",style:{background:"rgba(0,220,130,0.03)",border:"1px solid rgba(0,220,130,0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(T,{size:13,style:{color:"#00DC82"}}),e.jsx("span",{className:"text-[11px] font-bold",style:{color:"#00DC82"},children:"Backtest"}),e.jsx("span",{className:"text-[10px]",style:{color:"#6b7280"},children:"â€” Prueba tu cÃ³digo con datos reales antes de activar el bot"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("select",{value:k,onChange:s=>P(s.target.value),className:"px-3 py-1.5 rounded-lg text-[11px] font-semibold outline-none",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("select",{value:C,onChange:s=>F(s.target.value),className:"px-3 py-1.5 rounded-lg text-[11px] font-semibold outline-none",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:["1m","5m","15m","1h","4h","1d"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs("button",{onClick:z,disabled:y||!!x||!(t!=null&&t.trim()),className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[11px] font-bold transition-all hover:brightness-110 disabled:opacity-40",style:{background:"rgba(0,220,130,0.12)",border:"1px solid rgba(0,220,130,0.25)",color:"#00DC82"},children:[y?e.jsx(_,{size:12,className:"animate-spin"}):e.jsx(T,{size:12}),y?"Probando...":"Ejecutar Test"]})]})]}),e.jsx(O,{children:f&&e.jsx(se,{results:f})}),e.jsx("button",{onClick:A,disabled:!!x||!(t!=null&&t.trim())||!(o!=null&&o.trim()),className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-bold transition-all hover:brightness-110 disabled:opacity-40",style:{background:v?"rgba(0,220,130,0.15)":"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",color:v?"#00DC82":"#fff",border:"none"},children:v?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:15})," Estrategia Guardada"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:15})," Guardar Estrategia"]})})]}),l==="templates"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Haz clic en un template para cargarlo en el editor. Puedes modificarlo despuÃ©s."}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:Q.map(s=>e.jsxs("button",{onClick:()=>{r(s.code),o||i(s.name),p("editor"),h(null)},className:"flex items-center gap-4 p-4 rounded-xl text-left transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)"},children:e.jsx(Z,{size:18,style:{color:"#3B82F6"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold",style:{color:"#c9d1d9"},children:s.name}),e.jsx("p",{className:"text-[11px] mt-0.5",style:{color:"#8b949e"},children:s.description})]}),e.jsx("span",{className:"text-[10px] px-2 py-1 rounded-lg font-bold shrink-0",style:{color:s.difficulty==="Principiante"?"#00DC82":s.difficulty==="Intermedio"?"#3B82F6":"#A855F7",background:s.difficulty==="Principiante"?"rgba(0,220,130,0.1)":s.difficulty==="Intermedio"?"rgba(59,130,246,0.1)":"rgba(168,85,247,0.1)"},children:s.difficulty}),e.jsx(G,{size:16,style:{color:"#484f58"}})]},s.id))})]}),l==="help"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Funciones disponibles en Kairos Script."}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(97,175,239,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#61AFEF"},children:"ðŸ“Š Indicadores"})}),[["ema(periodo)","Media MÃ³vil Exponencial"],["sma(periodo)","Media MÃ³vil Simple"],["rsi(periodo)","Fuerza Relativa (0-100)"],["macd(f, s, sig)",".line .signal .histogram"],["bb(periodo, std)",".upper .middle .lower"],["vwap()","Precio Promedio por Volumen"]].map(([s,n])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#61AFEF"},children:s}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:n})]},s))]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(224,108,117,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#E06C75"},children:"âš¡ Acciones"})}),[["buy()","SeÃ±al de COMPRA"],["sell()","SeÃ±al de VENTA"],["config({ stopLoss, takeProfit })","SL/TP en %"],['log("msg")',"Log del bot"]].map(([s,n])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#E06C75"},children:s}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:n})]},s))]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(0,220,130,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#00DC82"},children:"ðŸ” DetecciÃ³n"})}),[["crossover(a, b)","A cruza arriba de B"],["crossunder(a, b)","A cruza abajo de B"],["highest(ind, n)","MÃ¡ximo en N barras"],["lowest(ind, n)","MÃ­nimo en N barras"],["avg(ind, n)","Promedio en N barras"],["percentChange(ind, n)","Cambio % en N barras"]].map(([s,n])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#00DC82"},children:s}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:n})]},s))]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("span",{className:"text-xs font-bold",style:{color:"#56B6C2"},children:"ðŸ“ˆ Variables"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["close","open","high","low","volume","price","barIndex"].map(s=>e.jsx("code",{className:"text-[11px] px-2.5 py-1 rounded-lg font-bold",style:{background:"rgba(86,182,194,0.1)",color:"#56B6C2",border:"1px solid rgba(86,182,194,0.2)"},children:s},s))})]}),e.jsxs("button",{onClick:()=>p("editor"),className:"w-full py-2.5 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all hover:brightness-110",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)",color:"#3B82F6"},children:[e.jsx(N,{size:14})," Volver al Editor"]})]})]})]})}export{oe as S};
