var jp=Object.defineProperty;var zp=(t,e,r)=>e in t?jp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Y=(t,e,r)=>zp(t,typeof e!="symbol"?e+"":e,r);import{g as Vp,aT as bh,aU as Qr}from"./ui-CUucduZ3.js";var wi={exports:{}},mc;function Kp(){if(mc)return wi.exports;mc=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(v,_,A){return Function.prototype.apply.call(v,_,A)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:r=function(v){return Object.getOwnPropertyNames(v)};function n(w){console&&console.warn&&console.warn(w)}var i=Number.isNaN||function(v){return v!==v};function s(){s.init.call(this)}wi.exports=s,wi.exports.once=x,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(w){if(typeof w!="number"||w<0||i(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");o=w}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||i(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function c(w){return w._maxListeners===void 0?s.defaultMaxListeners:w._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(v){for(var _=[],A=1;A<arguments.length;A++)_.push(arguments[A]);var B=v==="error",$=this._events;if($!==void 0)B=B&&$.error===void 0;else if(!B)return!1;if(B){var N;if(_.length>0&&(N=_[0]),N instanceof Error)throw N;var U=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw U.context=N,U}var C=$[v];if(C===void 0)return!1;if(typeof C=="function")e(C,this,_);else for(var D=C.length,T=d(C,D),A=0;A<D;++A)e(T[A],this,_);return!0};function u(w,v,_,A){var B,$,N;if(a(_),$=w._events,$===void 0?($=w._events=Object.create(null),w._eventsCount=0):($.newListener!==void 0&&(w.emit("newListener",v,_.listener?_.listener:_),$=w._events),N=$[v]),N===void 0)N=$[v]=_,++w._eventsCount;else if(typeof N=="function"?N=$[v]=A?[_,N]:[N,_]:A?N.unshift(_):N.push(_),B=c(w),B>0&&N.length>B&&!N.warned){N.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=w,U.type=v,U.count=N.length,n(U)}return w}s.prototype.addListener=function(v,_){return u(this,v,_,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(v,_){return u(this,v,_,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(w,v,_){var A={fired:!1,wrapFn:void 0,target:w,type:v,listener:_},B=l.bind(A);return B.listener=_,A.wrapFn=B,B}s.prototype.once=function(v,_){return a(_),this.on(v,h(this,v,_)),this},s.prototype.prependOnceListener=function(v,_){return a(_),this.prependListener(v,h(this,v,_)),this},s.prototype.removeListener=function(v,_){var A,B,$,N,U;if(a(_),B=this._events,B===void 0)return this;if(A=B[v],A===void 0)return this;if(A===_||A.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete B[v],B.removeListener&&this.emit("removeListener",v,A.listener||_));else if(typeof A!="function"){for($=-1,N=A.length-1;N>=0;N--)if(A[N]===_||A[N].listener===_){U=A[N].listener,$=N;break}if($<0)return this;$===0?A.shift():g(A,$),A.length===1&&(B[v]=A[0]),B.removeListener!==void 0&&this.emit("removeListener",v,U||_)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(v){var _,A,B;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[v]),this;if(arguments.length===0){var $=Object.keys(A),N;for(B=0;B<$.length;++B)N=$[B],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=A[v],typeof _=="function")this.removeListener(v,_);else if(_!==void 0)for(B=_.length-1;B>=0;B--)this.removeListener(v,_[B]);return this};function f(w,v,_){var A=w._events;if(A===void 0)return[];var B=A[v];return B===void 0?[]:typeof B=="function"?_?[B.listener||B]:[B]:_?y(B):d(B,B.length)}s.prototype.listeners=function(v){return f(this,v,!0)},s.prototype.rawListeners=function(v){return f(this,v,!1)},s.listenerCount=function(w,v){return typeof w.listenerCount=="function"?w.listenerCount(v):p.call(w,v)},s.prototype.listenerCount=p;function p(w){var v=this._events;if(v!==void 0){var _=v[w];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function d(w,v){for(var _=new Array(v),A=0;A<v;++A)_[A]=w[A];return _}function g(w,v){for(;v+1<w.length;v++)w[v]=w[v+1];w.pop()}function y(w){for(var v=new Array(w.length),_=0;_<v.length;++_)v[_]=w[_].listener||w[_];return v}function x(w,v){return new Promise(function(_,A){function B(N){w.removeListener(v,$),A(N)}function $(){typeof w.removeListener=="function"&&w.removeListener("error",B),_([].slice.call(arguments))}b(w,v,$,{once:!0}),v!=="error"&&I(w,B,{once:!0})})}function I(w,v,_){typeof w.on=="function"&&b(w,"error",v,_)}function b(w,v,_,A){if(typeof w.on=="function")A.once?w.once(v,_):w.on(v,_);else if(typeof w.addEventListener=="function")w.addEventListener(v,function B($){A.once&&w.removeEventListener(v,B),_($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return wi.exports}var It=Kp();const mh=Vp(It);var Ts={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ro=function(t,e){return Ro=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Ro(t,e)};function Hp(t,e){Ro(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Co=function(){return Co=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Co.apply(this,arguments)};function Wp(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Gp(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Yp(t,e){return function(r,n){e(r,n,t)}}function Zp(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Jp(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function Xp(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Qp(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function eg(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function No(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function tg(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(vh(arguments[e]));return t}function rg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Wn(t){return this instanceof Wn?(this.v=t,this):new Wn(t)}function ng(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Wn?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function ig(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Wn(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function sg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof No=="function"?No(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function og(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function ag(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function cg(t){return t&&t.__esModule?t:{default:t}}function ug(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function lg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const hg=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Co},__asyncDelegator:ig,__asyncGenerator:ng,__asyncValues:sg,__await:Wn,__awaiter:Jp,__classPrivateFieldGet:ug,__classPrivateFieldSet:lg,__createBinding:Qp,__decorate:Gp,__exportStar:eg,__extends:Hp,__generator:Xp,__importDefault:cg,__importStar:ag,__makeTemplateObject:og,__metadata:Zp,__param:Yp,__read:vh,__rest:Wp,__spread:tg,__spreadArrays:rg,__values:No},Symbol.toStringTag,{value:"Module"})),ls=bh(hg);var Rs={},In={},vc;function fg(){if(vc)return In;vc=1,Object.defineProperty(In,"__esModule",{value:!0}),In.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return In.delay=t,In}var Br={},Cs={},Pr={},Ec;function dg(){return Ec||(Ec=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.ONE_THOUSAND=Pr.ONE_HUNDRED=void 0,Pr.ONE_HUNDRED=100,Pr.ONE_THOUSAND=1e3),Pr}var Ns={},xc;function pg(){return xc||(xc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(Ns)),Ns}var _c;function Eh(){return _c||(_c=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ls;e.__exportStar(dg(),t),e.__exportStar(pg(),t)})(Cs)),Cs}var Ic;function gg(){if(Ic)return Br;Ic=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.fromMiliseconds=Br.toMiliseconds=void 0;const t=Eh();function e(n){return n*t.ONE_THOUSAND}Br.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Br.fromMiliseconds=r,Br}var Sc;function yg(){return Sc||(Sc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ls;e.__exportStar(fg(),t),e.__exportStar(gg(),t)})(Rs)),Rs}var en={},Dc;function wg(){if(Dc)return en;Dc=1,Object.defineProperty(en,"__esModule",{value:!0}),en.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return en.Watch=t,en.default=t,en}var Us={},Sn={},Oc;function bg(){if(Oc)return Sn;Oc=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.IWatch=void 0;class t{}return Sn.IWatch=t,Sn}var Ac;function mg(){return Ac||(Ac=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ls.__exportStar(bg(),t)})(Us)),Us}var $c;function vg(){return $c||($c=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ls;e.__exportStar(yg(),t),e.__exportStar(wg(),t),e.__exportStar(mg(),t),e.__exportStar(Eh(),t)})(Ts)),Ts}var M=vg();class Gr{}let Eg=class extends Gr{constructor(e){super()}};const Bc=M.FIVE_SECONDS,Yr={pulse:"heartbeat_pulse"};let xg=class xh extends Eg{constructor(e){super(e),this.events=new It.EventEmitter,this.interval=Bc,this.interval=(e==null?void 0:e.interval)||Bc}static async init(e){const r=new xh(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(Yr.pulse)}};const _g=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ig=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Sg=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Dg(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Og(t);return}return e}function Og(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function bi(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Sg.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(_g.test(t)||Ig.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Dg)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function Ag(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ie(t,...e){try{return Ag(t(...e))}catch(r){return Promise.reject(r)}}function $g(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Bg(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ni(t){if($g(t))return String(t);if(Bg(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ni(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Uo="base64:";function Pg(t){return typeof t=="string"?t:Uo+Cg(t)}function Tg(t){return typeof t!="string"||!t.startsWith(Uo)?t:Rg(t.slice(Uo.length))}function Rg(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Cg(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function We(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Ng(...t){return We(t.join(":"))}function mi(t){return t=We(t),t?t+":":""}function Ug(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function kg(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Lg="memory",Fg=()=>{const t=new Map;return{name:Lg,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Mg(t={}){const e={mounts:{"":t.driver||Fg()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=We(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Pc(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of u){const g=typeof d=="string",y=We(g?d:d.key),x=g?void 0:d.value,I=g||!d.options?l:{...l,...d.options},b=r(y);p(b).items.push({key:y,value:x,relativeKey:b.relativeKey,options:I})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=We(u);const{relativeKey:h,driver:f}=r(u);return Ie(f.hasItem,h,l)},getItem(u,l={}){u=We(u);const{relativeKey:h,driver:f}=r(u);return Ie(f.getItem,h,l).then(p=>bi(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Ie(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:Ng(h.base,p.key),value:bi(p.value)}))):Promise.all(h.items.map(f=>Ie(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:bi(p)})))))},getItemRaw(u,l={}){u=We(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?Ie(f.getItemRaw,h,l):Ie(f.getItem,h,l).then(p=>Tg(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=We(u);const{relativeKey:f,driver:p}=r(u);p.setItem&&(await Ie(p.setItem,f,Ni(l),h),p.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Ie(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Ni(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>Ie(h.driver.setItem,f.relativeKey,Ni(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=We(u);const{relativeKey:f,driver:p}=r(u);if(p.setItemRaw)await Ie(p.setItemRaw,f,l,h);else if(p.setItem)await Ie(p.setItem,f,Pg(l),h);else return;p.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=We(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await Ie(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Ie(f.removeItem,h+"$",l),f.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=We(u);const{relativeKey:h,driver:f}=r(u),p=Object.create(null);if(f.getMeta&&Object.assign(p,await Ie(f.getMeta,h,l)),!l.nativeOnly){const d=await Ie(f.getItem,h+"$",l).then(g=>bi(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){var y;u=mi(u);const h=n(u,!0);let f=[];const p=[];let d=!0;for(const x of h){(y=x.driver.flags)!=null&&y.maxDepth||(d=!1);const I=await Ie(x.driver.getKeys,x.relativeBase,l);for(const b of I){const w=x.mountpoint+We(b);f.some(v=>w.startsWith(v))||p.push(w)}f=[x.mountpoint,...f.filter(b=>!b.startsWith(x.mountpoint))]}const g=l.maxDepth!==void 0&&!d;return p.filter(x=>(!g||Ug(x,l.maxDepth))&&kg(x,u))},async clear(u,l={}){u=mi(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return Ie(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Tc(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=mi(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Pc(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){var h,f;u=mi(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((f=(h=e.unwatch)[u])==null||f.call(h),delete e.unwatch[u]),l&&await Tc(e.mounts[u]),e.mountpoints=e.mountpoints.filter(p=>p!==u),delete e.mounts[u])},getMount(u=""){u=We(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=We(u),n(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Pc(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Tc(t){typeof t.dispose=="function"&&await Ie(t.dispose)}function Zr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function _h(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=Zr(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let ks;function ni(){return ks||(ks=_h("keyval-store","keyval")),ks}function Rc(t,e=ni()){return e("readonly",r=>Zr(r.get(t)))}function qg(t,e,r=ni()){return r("readwrite",n=>(n.put(e,t),Zr(n.transaction)))}function jg(t,e=ni()){return e("readwrite",r=>(r.delete(t),Zr(r.transaction)))}function zg(t=ni()){return t("readwrite",e=>(e.clear(),Zr(e.transaction)))}function Vg(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Zr(t.transaction)}function Kg(t=ni()){return t("readonly",e=>{if(e.getAllKeys)return Zr(e.getAllKeys());const r=[];return Vg(e,n=>r.push(n.key)).then(()=>r)})}const Hg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Wg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function gn(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Wg(t)}catch{return t}}function ii(t){return typeof t=="string"?t:Hg(t)||""}const Gg="idb-keyval";var Yg=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=_h(t.dbName,t.storeName)),{name:Gg,options:t,async hasItem(i){return!(typeof await Rc(r(i),n)>"u")},async getItem(i){return await Rc(r(i),n)??null},setItem(i,s){return qg(r(i),s,n)},removeItem(i){return jg(r(i),n)},getKeys(){return Kg(n)},clear(){return zg(n)}}};const Zg="WALLET_CONNECT_V2_INDEXED_DB",Jg="keyvaluestorage";let Xg=class{constructor(){this.indexedDb=Mg({driver:Yg({dbName:Zg,storeName:Jg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,ii(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ui={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ls<"u"&&Ls.localStorage?Ui.exports=Ls.localStorage:typeof window<"u"&&window.localStorage?Ui.exports=window.localStorage:Ui.exports=new e})();function Qg(t){var e;return[t[0],gn((e=t[1])!=null?e:"")]}let ey=class{constructor(){this.localStorage=Ui.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Qg)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return gn(r)}async setItem(e,r){this.localStorage.setItem(e,ii(r))}async removeItem(e){this.localStorage.removeItem(e)}};const ty="wc_storage_version",Cc=1,ry=async(t,e,r)=>{const n=ty,i=await e.getItem(n);if(i&&i>=Cc){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,Cc),r(e),ny(t,o)},ny=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let iy=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new ey;this.storage=e;try{const r=new Xg;ry(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Ct={exports:{}};function sy(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var oy=ay;function ay(t,e,r){var n=r&&r.stringify||sy,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Number(e[l]),h=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;h<p&&(u+=t.slice(h,p)),u+=Math.floor(Number(e[l])),h=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<p&&(u+=t.slice(h,p));var d=typeof e[l];if(d==="string"){u+="'"+e[l]+"'",h=p+2,p++;break}if(d==="function"){u+=e[l].name||"<anonymous>",h=p+2,p++;break}u+=n(e[l]),h=p+2,p++;break;case 115:if(l>=c)break;h<p&&(u+=t.slice(h,p)),u+=String(e[l]),h=p+2,p++;break;case 37:h<p&&(u+=t.slice(h,p)),u+="%",h=p+2,p++,l--;break}++l}++p}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}const Nc=oy;Ct.exports=Qt;const Gn=xy().console||{},cy={mapHttpRequest:vi,mapHttpResponse:vi,wrapRequestSerializer:Fs,wrapResponseSerializer:Fs,wrapErrorSerializer:Fs,req:vi,res:vi,err:kc,errWithCause:kc};function Er(t,e){return t==="silent"?1/0:e.levels.values[t]}const Aa=Symbol("pino.logFuncs"),ko=Symbol("pino.hierarchy"),uy={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Uc(t,e){const r={logger:e,parent:t[ko]};e[ko]=r}function ly(t,e,r){const n={};e.forEach(i=>{n[i]=r[i]?r[i]:Gn[i]||Gn[uy[i]||"log"]||hn}),t[Aa]=n}function hy(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Qt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Gn;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=hy(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(g){r[g]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",u=Object.create(r);u.log||(u.log=hn),ly(u,a,r),Uc({},u),Object.defineProperty(u,"levelVal",{get:h}),Object.defineProperty(u,"level",{get:f,set:p});const l={transmit:e,serialize:i,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:my(t),messageKey:t.messageKey||"msg",onChild:t.onChild||hn};u.levels=fy(t),u.level=c,u.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},u.setMaxListeners=u.getMaxListeners=u.emit=u.addListener=u.on=u.prependListener=u.once=u.prependOnceListener=u.removeListener=u.removeAllListeners=u.listeners=u.listenerCount=u.eventNames=u.write=u.flush=hn,u.serializers=n,u._serialize=i,u._stdErrSerialize=s,u.child=function(...g){return d.call(this,l,...g)},e&&(u._logEvent=Lo());function h(){return Er(this.level,this)}function f(){return this._level}function p(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,Tr(this,l,u,"error"),Tr(this,l,u,"fatal"),Tr(this,l,u,"warn"),Tr(this,l,u,"info"),Tr(this,l,u,"debug"),Tr(this,l,u,"trace"),o.forEach(y=>{Tr(this,l,u,y)})}function d(g,y,x){if(!y)throw new Error("missing bindings for child Pino");x=x||{},i&&y.serializers&&(x.serializers=y.serializers);const I=x.serializers;if(i&&I){var b=Object.assign({},n,I),w=t.browser.serialize===!0?Object.keys(b):i;delete y.serializers,$a([y],w,b,this._stdErrSerialize)}function v(A){this._childLevel=(A._childLevel|0)+1,this.bindings=y,b&&(this.serializers=b,this._serialize=w),e&&(this._logEvent=Lo([].concat(A._logEvent.bindings,y)))}v.prototype=this;const _=new v(this);return Uc(this,_),_.child=function(...A){return d.call(this,g,...A)},_.level=x.level||this.level,g.onChild(_),_}return u}function fy(t){const e=t.customLevels||{},r=Object.assign({},Qt.levels.values,e),n=Object.assign({},Qt.levels.labels,dy(e));return{values:r,labels:n}}function dy(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}Qt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Qt.stdSerializers=cy,Qt.stdTimeFunctions=Object.assign({},{nullTime:Ih,epochTime:Sh,unixTime:vy,isoTime:Ey});function py(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[ko];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Tr(t,e,r,n){if(Object.defineProperty(t,n,{value:Er(t.level,r)>Er(n,r)?hn:r[Aa][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===hn){if(!e.transmit)return;const s=e.transmit.level||t.level,o=Er(s,r);if(Er(n,r)<o)return}t[n]=yy(t,e,r,n);const i=py(t);i.length!==0&&(t[n]=gy(i,t[n]))}function gy(t,e){return function(){return e.apply(this,[...t,...arguments])}}function yy(t,e,r,n){return(function(i){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Gn?Gn:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var u=!1;if(e.serialize&&($a(o,this._serialize,this.serializers,this._stdErrSerialize),u=!0),e.asObject||e.formatters?i.call(a,...wy(this,n,o,s,e)):i.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=Er(l,r),f=Er(n,r);if(f<h)return;by(this,{ts:s,methodLevel:n,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Er(t._level,r)},o,u)}}})(t[Aa][n])}function wy(t,e,r,n,i){const{level:s,log:o=h=>h}=i.formatters||{},a=r.slice();let c=a[0];const u={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),n&&(u.time=n),s){const h=s(e,t.levels.values[e]);Object.assign(u,h)}else u.level=t.levels.values[e];if(i.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());return[o(u),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());c=a.length?Nc(a.shift(),a):void 0}else typeof c=="string"&&(c=Nc(a.shift(),a));return c!==void 0&&(u[i.messageKey]=c),[o(u)]}}function $a(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=Qt.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(const s in t[i])e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function by(t,e,r,n=!1){const i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,u=t._logEvent.bindings;n||$a(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(l){return u.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,c),t._logEvent=Lo(u)}function Lo(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function kc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function my(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ih:Sh}function vi(){return{}}function Fs(t){return t}function hn(){}function Ih(){return!1}function Sh(){return Date.now()}function vy(){return Math.round(Date.now()/1e3)}function Ey(){return new Date(Date.now()).toISOString()}function xy(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}Ct.exports.default=Qt;Ct.exports.pino=Qt;const _y={level:"info"},hs="custom_context",Ba=1e3*1024;var Iy=Object.defineProperty,Sy=(t,e,r)=>e in t?Iy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,br=(t,e,r)=>Sy(t,typeof e!="symbol"?e+"":e,r);let Dy=class{constructor(e){br(this,"nodeValue"),br(this,"sizeInBytes"),br(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Lc=class{constructor(e){br(this,"lengthInNodes"),br(this,"sizeInBytes"),br(this,"head"),br(this,"tail"),br(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Dy(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const Oy=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function Fc(t){return typeof t=="string"?t:Oy(t)||""}var Ay=Object.defineProperty,$y=(t,e,r)=>e in t?Ay(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ei=(t,e,r)=>$y(t,typeof e!="symbol"?e+"":e,r);let Dh=class{constructor(e,r=Ba){Ei(this,"logs"),Ei(this,"level"),Ei(this,"levelValue"),Ei(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=Ct.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Lc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Ct.exports.levels.values.error?console.error(e):r===Ct.exports.levels.values.warn?console.warn(e):r===Ct.exports.levels.values.debug?console.debug(e):r===Ct.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Fc({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Lc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Fc({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var By=Object.defineProperty,Py=(t,e,r)=>e in t?By(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ty=(t,e,r)=>Py(t,e+"",r);let Ry=class{constructor(e,r=Ba){Ty(this,"baseChunkLogger"),this.baseChunkLogger=new Dh(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}};var Cy=Object.defineProperty,Ny=(t,e,r)=>e in t?Cy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uy=(t,e,r)=>Ny(t,e+"",r);let ky=class{constructor(e,r=Ba){Uy(this,"baseChunkLogger"),this.baseChunkLogger=new Dh(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Ly=Object.defineProperty,Fy=Object.defineProperties,My=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,qy=Object.prototype.hasOwnProperty,jy=Object.prototype.propertyIsEnumerable,qc=(t,e,r)=>e in t?Ly(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_r=(t,e)=>{for(var r in e||(e={}))qy.call(e,r)&&qc(t,r,e[r]);if(Mc)for(var r of Mc(e))jy.call(e,r)&&qc(t,r,e[r]);return t},Ir=(t,e)=>Fy(t,My(e));function zy(t){return Ir(_r({},t),{level:(t==null?void 0:t.level)||_y.level})}function Vy(t,e,r=hs){return t[r]=e,t}function tt(t,e=hs){return t[e]||""}function Ky(t,e,r=hs){const n=tt(t,r);return n.trim()?`${n}/${e}`:e}function at(t,e,r=hs){const n=Ky(t,e,r),i=t.child({context:n});return Vy(i,n,r)}function Hy(t){var e,r;const n=new Ry((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Ct.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function Wy(t){var e,r;const n=new ky((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Ct.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})}),n),chunkLoggerController:n}}function Oh(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=Ir(_r({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?Hy(Ir(_r({},t),{opts:r})):Wy(Ir(_r({},t),{opts:r}))}var Gy=Object.defineProperty,Yy=(t,e,r)=>e in t?Gy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jc=(t,e,r)=>Yy(t,typeof e!="symbol"?e+"":e,r);let Zy=class extends Gr{constructor(e){super(),this.opts=e,jc(this,"protocol","wc"),jc(this,"version",2)}};var Jy=Object.defineProperty,Xy=(t,e,r)=>e in t?Jy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qy=(t,e,r)=>Xy(t,e+"",r);class e0 extends Gr{constructor(e,r){super(),this.core=e,this.logger=r,Qy(this,"records",new Map)}}class t0{constructor(e,r){this.logger=e,this.core=r}}class r0 extends Gr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let n0=class extends Gr{constructor(e){super()}},i0=class{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}},s0=class extends Gr{constructor(e,r){super(),this.relayer=e,this.logger=r}},o0=class extends Gr{constructor(e,r){super(),this.core=e,this.logger=r}},a0=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}};class c0{constructor(e,r){this.projectId=e,this.logger=r}}class u0{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}var l0=Object.defineProperty,h0=(t,e,r)=>e in t?l0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zc=(t,e,r)=>h0(t,typeof e!="symbol"?e+"":e,r);let f0=class{constructor(e){this.opts=e,zc(this,"protocol","wc"),zc(this,"version",2)}},d0=class{constructor(e){this.client=e}};function p0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ah(t,...e){if(!p0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Vc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function g0(t,e){Ah(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const tn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ms=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function y0(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function $h(t){return typeof t=="string"&&(t=y0(t)),Ah(t),t}let w0=class{clone(){return this._cloneInto()}};function b0(t){const e=n=>t().update($h(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Bh(t=32){if(tn&&typeof tn.getRandomValues=="function")return tn.getRandomValues(new Uint8Array(t));if(tn&&typeof tn.randomBytes=="function")return tn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function m0(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}let v0=class extends w0{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ms(this.buffer)}update(e){Vc(this);const{view:r,buffer:n,blockLen:i}=this;e=$h(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ms(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vc(this),g0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;m0(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Ms(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const xi=BigInt(2**32-1),Fo=BigInt(32);function Ph(t,e=!1){return e?{h:Number(t&xi),l:Number(t>>Fo&xi)}:{h:Number(t>>Fo&xi)|0,l:Number(t&xi)|0}}function E0(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Ph(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const x0=(t,e)=>BigInt(t>>>0)<<Fo|BigInt(e>>>0),_0=(t,e,r)=>t>>>r,I0=(t,e,r)=>t<<32-r|e>>>r,S0=(t,e,r)=>t>>>r|e<<32-r,D0=(t,e,r)=>t<<32-r|e>>>r,O0=(t,e,r)=>t<<64-r|e>>>r-32,A0=(t,e,r)=>t>>>r-32|e<<64-r,$0=(t,e)=>e,B0=(t,e)=>t,P0=(t,e,r)=>t<<r|e>>>32-r,T0=(t,e,r)=>e<<r|t>>>32-r,R0=(t,e,r)=>e<<r-32|t>>>64-r,C0=(t,e,r)=>t<<r-32|e>>>64-r;function N0(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const U0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),k0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,L0=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),F0=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,M0=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),q0=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Z={fromBig:Ph,split:E0,toBig:x0,shrSH:_0,shrSL:I0,rotrSH:S0,rotrSL:D0,rotrBH:O0,rotrBL:A0,rotr32H:$0,rotr32L:B0,rotlSH:P0,rotlSL:T0,rotlBH:R0,rotlBL:C0,add:N0,add3L:U0,add3H:k0,add4L:L0,add4H:F0,add5H:q0,add5L:M0},[j0,z0]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ir=new Uint32Array(80),sr=new Uint32Array(80);let V0=class extends v0{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,r){for(let b=0;b<16;b++,r+=4)ir[b]=e.getUint32(r),sr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const w=ir[b-15]|0,v=sr[b-15]|0,_=Z.rotrSH(w,v,1)^Z.rotrSH(w,v,8)^Z.shrSH(w,v,7),A=Z.rotrSL(w,v,1)^Z.rotrSL(w,v,8)^Z.shrSL(w,v,7),B=ir[b-2]|0,$=sr[b-2]|0,N=Z.rotrSH(B,$,19)^Z.rotrBH(B,$,61)^Z.shrSH(B,$,6),U=Z.rotrSL(B,$,19)^Z.rotrBL(B,$,61)^Z.shrSL(B,$,6),C=Z.add4L(A,U,sr[b-7],sr[b-16]),D=Z.add4H(C,_,N,ir[b-7],ir[b-16]);ir[b]=D|0,sr[b]=C|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:I}=this;for(let b=0;b<80;b++){const w=Z.rotrSH(h,f,14)^Z.rotrSH(h,f,18)^Z.rotrBH(h,f,41),v=Z.rotrSL(h,f,14)^Z.rotrSL(h,f,18)^Z.rotrBL(h,f,41),_=h&p^~h&g,A=f&d^~f&y,B=Z.add5L(I,v,A,z0[b],sr[b]),$=Z.add5H(B,x,w,_,j0[b],ir[b]),N=B|0,U=Z.rotrSH(n,i,28)^Z.rotrBH(n,i,34)^Z.rotrBH(n,i,39),C=Z.rotrSL(n,i,28)^Z.rotrBL(n,i,34)^Z.rotrBL(n,i,39),D=n&s^n&a^s&a,T=i&o^i&c^o&c;x=g|0,I=y|0,g=p|0,y=d|0,p=h|0,d=f|0,{h,l:f}=Z.add(u|0,l|0,$|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const E=Z.add3L(N,C,T);n=Z.add3H(E,$,U,D),i=E|0}({h:n,l:i}=Z.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Z.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Z.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Z.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=Z.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Z.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=Z.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:I}=Z.add(this.Hh|0,this.Hl|0,x|0,I|0),this.set(n,i,s,o,a,c,u,l,h,f,p,d,g,y,x,I)}roundClean(){ir.fill(0),sr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const K0=b0(()=>new V0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Pa=BigInt(0),Th=BigInt(1),H0=BigInt(2);function Ta(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ra(t){if(!Ta(t))throw new Error("Uint8Array expected")}function qs(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const W0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ca(t){Ra(t);let e="";for(let r=0;r<t.length;r++)e+=W0[t[r]];return e}function Rh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Pa:BigInt("0x"+t)}const Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kc(t){if(t>=Lt._0&&t<=Lt._9)return t-Lt._0;if(t>=Lt.A&&t<=Lt.F)return t-(Lt.A-10);if(t>=Lt.a&&t<=Lt.f)return t-(Lt.a-10)}function Ch(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Kc(t.charCodeAt(s)),a=Kc(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function G0(t){return Rh(Ca(t))}function ki(t){return Ra(t),Rh(Ca(Uint8Array.from(t).reverse()))}function Nh(t,e){return Ch(t.toString(16).padStart(e*2,"0"))}function Mo(t,e){return Nh(t,e).reverse()}function Ft(t,e,r){let n;if(typeof e=="string")try{n=Ch(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ta(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Hc(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Ra(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const js=t=>typeof t=="bigint"&&Pa<=t;function Y0(t,e,r){return js(t)&&js(e)&&js(r)&&e<=t&&t<r}function Dn(t,e,r,n){if(!Y0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Z0(t){let e;for(e=0;t>Pa;t>>=Th,e+=1);return e}const J0=t=>(H0<<BigInt(t-1))-Th,X0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ta(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Na(t,e,r={}){const n=(i,s,o)=>{const a=X0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Wc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Oe=BigInt(0),pe=BigInt(1),Ur=BigInt(2),Q0=BigInt(3),qo=BigInt(4),Gc=BigInt(5),Yc=BigInt(8);function ve(t,e){const r=t%e;return r>=Oe?r:e+r}function ew(t,e,r){if(e<Oe)throw new Error("invalid exponent, negatives unsupported");if(r<=Oe)throw new Error("invalid modulus");if(r===pe)return Oe;let n=pe;for(;e>Oe;)e&pe&&(n=n*t%r),t=t*t%r,e>>=pe;return n}function St(t,e,r){let n=t;for(;e-- >Oe;)n*=n,n%=r;return n}function Zc(t,e){if(t===Oe)throw new Error("invert: expected non-zero number");if(e<=Oe)throw new Error("invert: expected positive modulus, got "+e);let r=ve(t,e),n=e,i=Oe,s=pe;for(;r!==Oe;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==pe)throw new Error("invert: does not exist");return ve(i,e)}function tw(t){const e=(t-pe)/Ur;let r,n,i;for(r=t-pe,n=0;r%Ur===Oe;r/=Ur,n++);for(i=Ur;i<t&&ew(i,e,t)!==t-pe;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+pe)/qo;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+pe)/Ur;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(u,pe<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=f}return l}}function rw(t){if(t%qo===Q0){const e=(t+pe)/qo;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Yc===Gc){const e=(t-Gc)/Yc;return function(r,n){const i=r.mul(n,Ur),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Ur),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return tw(t)}const nw=(t,e)=>(ve(t,e)&pe)===pe,iw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=iw.reduce((n,i)=>(n[i]="function",n),e);return Na(t,r)}function ow(t,e,r){if(r<Oe)throw new Error("invalid exponent, negatives unsupported");if(r===Oe)return t.ONE;if(r===pe)return e;let n=t.ONE,i=e;for(;r>Oe;)r&pe&&(n=t.mul(n,i)),i=t.sqr(i),r>>=pe;return n}function aw(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Uh(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function kh(t,e,r=!1,n={}){if(t<=Oe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Uh(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:J0(i),ZERO:Oe,ONE:pe,create:c=>ve(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Oe<=c&&c<t},is0:c=>c===Oe,isOdd:c=>(c&pe)===pe,neg:c=>ve(-c,t),eql:(c,u)=>c===u,sqr:c=>ve(c*c,t),add:(c,u)=>ve(c+u,t),sub:(c,u)=>ve(c-u,t),mul:(c,u)=>ve(c*u,t),pow:(c,u)=>ow(a,c,u),div:(c,u)=>ve(c*Zc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Zc(c,t),sqrt:n.sqrt||(c=>(o||(o=rw(t)),o(a,c))),invertBatch:c=>aw(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Mo(c,s):Nh(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?ki(c):G0(c)}});return Object.freeze(a)}const Jc=BigInt(0),_i=BigInt(1);function zs(t,e){const r=e.negate();return t?r:e}function Lh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Vs(t,e){Lh(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function cw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function uw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Ks=new WeakMap,Fh=new WeakMap;function Hs(t){return Fh.get(t)||1}function lw(t,e){return{constTimeNegate:zs,hasPrecomputes(r){return Hs(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Jc;)n&_i&&(i=i.add(s)),s=s.double(),n>>=_i;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Vs(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Vs(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(i&u);i>>=h,d>o&&(d-=l,i+=_i);const g=p,y=p+Math.abs(d)-1,x=f%2!==0,I=d<0;d===0?c=c.add(zs(x,n[g])):a=a.add(zs(I,n[y]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Vs(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Jc)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=_i),p===0)continue;let d=n[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,n,i){let s=Ks.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Ks.set(n,i(s))),s},wNAFCached(r,n,i){const s=Hs(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Hs(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Lh(n,e),Fh.set(r,n),Ks.delete(r)}}}function hw(t,e,r,n){if(cw(r,t),uw(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Z0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const d=n[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[p])}let f=i;for(let p=c.length-1,d=i;p>0;p--)d=d.add(c[p]),f=f.add(d);if(l=l.add(f),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function fw(t){return sw(t.Fp),Na(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Uh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const wt=BigInt(0),Ke=BigInt(1),Ii=BigInt(2),dw=BigInt(8),pw={zip215:!0};function gw(t){const e=fw(t);return Na(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function yw(t){const e=gw(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Ii<<BigInt(a*8)-Ke,l=r.create,h=kh(e.n,e.nBitLength),f=e.uvRatio||((E,m)=>{try{return{isValid:!0,value:r.sqrt(E*r.inv(m))}}catch{return{isValid:!1,value:wt}}}),p=e.adjustScalarBytes||(E=>E),d=e.domain||((E,m,O)=>{if(qs("phflag",O),m.length||O)throw new Error("Contexts/pre-hash are not supported");return E});function g(E,m){Dn("coordinate "+E,m,wt,u)}function y(E){if(!(E instanceof b))throw new Error("ExtendedPoint expected")}const x=Wc((E,m)=>{const{ex:O,ey:R,ez:S}=E,P=E.is0();m==null&&(m=P?dw:r.inv(S));const k=l(O*m),L=l(R*m),K=l(S*m);if(P)return{x:wt,y:Ke};if(K!==Ke)throw new Error("invZ was invalid");return{x:k,y:L}}),I=Wc(E=>{const{a:m,d:O}=e;if(E.is0())throw new Error("bad point: ZERO");const{ex:R,ey:S,ez:P,et:k}=E,L=l(R*R),K=l(S*S),z=l(P*P),j=l(z*z),H=l(L*m),G=l(z*l(H+K)),J=l(j+l(O*l(L*K)));if(G!==J)throw new Error("bad point: equation left != right (1)");const W=l(R*S),X=l(P*k);if(W!==X)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(m,O,R,S){this.ex=m,this.ey=O,this.ez=R,this.et=S,g("x",m),g("y",O),g("z",R),g("t",S),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof b)throw new Error("extended point not allowed");const{x:O,y:R}=m||{};return g("x",O),g("y",R),new b(O,R,Ke,l(O*R))}static normalizeZ(m){const O=r.invertBatch(m.map(R=>R.ez));return m.map((R,S)=>R.toAffine(O[S])).map(b.fromAffine)}static msm(m,O){return hw(b,h,m,O)}_setWindowSize(m){_.setWindowSize(this,m)}assertValidity(){I(this)}equals(m){y(m);const{ex:O,ey:R,ez:S}=this,{ex:P,ey:k,ez:L}=m,K=l(O*L),z=l(P*S),j=l(R*L),H=l(k*S);return K===z&&j===H}is0(){return this.equals(b.ZERO)}negate(){return new b(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:m}=e,{ex:O,ey:R,ez:S}=this,P=l(O*O),k=l(R*R),L=l(Ii*l(S*S)),K=l(m*P),z=O+R,j=l(l(z*z)-P-k),H=K+k,G=H-L,J=K-k,W=l(j*G),X=l(H*J),he=l(j*J),we=l(G*H);return new b(W,X,we,he)}add(m){y(m);const{a:O,d:R}=e,{ex:S,ey:P,ez:k,et:L}=this,{ex:K,ey:z,ez:j,et:H}=m;if(O===BigInt(-1)){const fc=l((P-S)*(z+K)),dc=l((P+S)*(z-K)),Ps=l(dc-fc);if(Ps===wt)return this.double();const pc=l(k*Ii*H),gc=l(L*Ii*j),yc=gc+pc,wc=dc+fc,bc=gc-pc,Lp=l(yc*Ps),Fp=l(wc*bc),Mp=l(yc*bc),qp=l(Ps*wc);return new b(Lp,Fp,qp,Mp)}const G=l(S*K),J=l(P*z),W=l(L*R*H),X=l(k*j),he=l((S+P)*(K+z)-G-J),we=X-W,Ee=X+W,qe=l(J-O*G),kt=l(he*we),nr=l(Ee*qe),Up=l(he*qe),kp=l(we*Ee);return new b(kt,nr,kp,Up)}subtract(m){return this.add(m.negate())}wNAF(m){return _.wNAFCached(this,m,b.normalizeZ)}multiply(m){const O=m;Dn("scalar",O,Ke,n);const{p:R,f:S}=this.wNAF(O);return b.normalizeZ([R,S])[0]}multiplyUnsafe(m,O=b.ZERO){const R=m;return Dn("scalar",R,wt,n),R===wt?v:this.is0()||R===Ke?this:_.wNAFCachedUnsafe(this,R,b.normalizeZ,O)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,n).is0()}toAffine(m){return x(this,m)}clearCofactor(){const{h:m}=e;return m===Ke?this:this.multiplyUnsafe(m)}static fromHex(m,O=!1){const{d:R,a:S}=e,P=r.BYTES;m=Ft("pointHex",m,P),qs("zip215",O);const k=m.slice(),L=m[P-1];k[P-1]=L&-129;const K=ki(k),z=O?u:r.ORDER;Dn("pointHex.y",K,wt,z);const j=l(K*K),H=l(j-Ke),G=l(R*j-S);let{isValid:J,value:W}=f(H,G);if(!J)throw new Error("Point.fromHex: invalid y coordinate");const X=(W&Ke)===Ke,he=(L&128)!==0;if(!O&&W===wt&&he)throw new Error("Point.fromHex: x=0 and x_0=1");return he!==X&&(W=l(-W)),b.fromAffine({x:W,y:K})}static fromPrivateKey(m){return $(m).point}toRawBytes(){const{x:m,y:O}=this.toAffine(),R=Mo(O,r.BYTES);return R[R.length-1]|=m&Ke?128:0,R}toHex(){return Ca(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Ke,l(e.Gx*e.Gy)),b.ZERO=new b(wt,Ke,Ke,wt);const{BASE:w,ZERO:v}=b,_=lw(b,a*8);function A(E){return ve(E,n)}function B(E){return A(ki(E))}function $(E){const m=r.BYTES;E=Ft("private key",E,m);const O=Ft("hashed private key",s(E),2*m),R=p(O.slice(0,m)),S=O.slice(m,2*m),P=B(R),k=w.multiply(P),L=k.toRawBytes();return{head:R,prefix:S,scalar:P,point:k,pointBytes:L}}function N(E){return $(E).pointBytes}function U(E=new Uint8Array,...m){const O=Hc(...m);return B(s(d(O,Ft("context",E),!!i)))}function C(E,m,O={}){E=Ft("message",E),i&&(E=i(E));const{prefix:R,scalar:S,pointBytes:P}=$(m),k=U(O.context,R,E),L=w.multiply(k).toRawBytes(),K=U(O.context,L,P,E),z=A(k+K*S);Dn("signature.s",z,wt,n);const j=Hc(L,Mo(z,r.BYTES));return Ft("result",j,r.BYTES*2)}const D=pw;function T(E,m,O,R=D){const{context:S,zip215:P}=R,k=r.BYTES;E=Ft("signature",E,2*k),m=Ft("message",m),O=Ft("publicKey",O,k),P!==void 0&&qs("zip215",P),i&&(m=i(m));const L=ki(E.slice(k,2*k));let K,z,j;try{K=b.fromHex(O,P),z=b.fromHex(E.slice(0,k),P),j=w.multiplyUnsafe(L)}catch{return!1}if(!P&&K.isSmallOrder())return!1;const H=U(S,z.toRawBytes(),K.toRawBytes(),m);return z.add(K.multiplyUnsafe(H)).subtract(j).clearCofactor().equals(b.ZERO)}return w._setWindowSize(8),{CURVE:e,getPublicKey:N,sign:C,verify:T,ExtendedPoint:b,utils:{getExtendedPublicKey:$,randomPrivateKey:()=>o(r.BYTES),precompute(E=8,m=b.BASE){return m._setWindowSize(E),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const Ua=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Xc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const ww=BigInt(1),Qc=BigInt(2);BigInt(3);const bw=BigInt(5),mw=BigInt(8);function vw(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Ua,o=t*t%s*t%s,a=St(o,Qc,s)*o%s,c=St(a,ww,s)*t%s,u=St(c,bw,s)*c%s,l=St(u,e,s)*u%s,h=St(l,r,s)*l%s,f=St(h,n,s)*h%s,p=St(f,i,s)*f%s,d=St(p,i,s)*f%s,g=St(d,e,s)*u%s;return{pow_p_5_8:St(g,Qc,s)*t%s,b2:o}}function Ew(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function xw(t,e){const r=Ua,n=ve(e*e*e,r),i=ve(n*n*e,r),s=vw(t*i).pow_p_5_8;let o=ve(t*n*s,r);const a=ve(e*o*o,r),c=o,u=ve(o*Xc,r),l=a===t,h=a===ve(-t,r),f=a===ve(-t*Xc,r);return l&&(o=c),(h||f)&&(o=u),nw(o,r)&&(o=ve(-o,r)),{isValid:l||h,value:o}}const _w=kh(Ua,void 0,!0),Iw={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:_w,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:mw,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:K0,randomBytes:Bh,adjustScalarBytes:Ew,uvRatio:xw},Mh=yw(Iw),Sw="EdDSA",Dw="JWT",Vi=".",fs="base64url",qh="utf8",jh="utf8",Ow=":",Aw="did",$w="key",eu="base58btc",Bw="z",Pw="K36",Tw=32;function ka(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ka(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Vh(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=zh(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return ka(r)}function Rw(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var b=(I-x)*l+1>>>0,w=new Uint8Array(b);x!==I;){for(var v=d[x],_=0,A=b-1;(v!==0||_<y)&&A!==-1;A--,_++)v+=256*w[A]>>>0,w[A]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=b-y;B!==b&&w[B]===0;)B++;for(var $=c.repeat(g);B<b;++B)$+=t.charAt(w[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,b=new Uint8Array(I);d[g];){var w=r[d.charCodeAt(g)];if(w===255)return;for(var v=0,_=I-1;(w!==0||v<x)&&_!==-1;_--,v++)w+=a*b[_]>>>0,b[_]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");x=v,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&b[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=b[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var Cw=Rw,Nw=Cw;const Kh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Uw=t=>new TextEncoder().encode(t),kw=t=>new TextDecoder().decode(t);let Lw=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Fw=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hh(this,e)}},Mw=class{constructor(e){this.decoders=e}or(e){return Hh(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Hh=(t,e)=>new Mw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let qw=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Lw(e,r,n),this.decoder=new Fw(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ds=({name:t,prefix:e,encode:r,decode:n})=>new qw(t,e,r,n),si=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=Nw(r,e);return ds({prefix:t,name:e,encode:n,decode:s=>Kh(i(s))})},jw=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},zw=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Te=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>ds({prefix:e,name:t,encode(i){return zw(i,n,r)},decode(i){return jw(i,n,r,t)}}),Vw=ds({prefix:"\0",name:"identity",encode:t=>kw(t),decode:t=>Uw(t)});var Kw=Object.freeze({__proto__:null,identity:Vw});const Hw=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ww=Object.freeze({__proto__:null,base2:Hw});const Gw=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Yw=Object.freeze({__proto__:null,base8:Gw});const Zw=si({prefix:"9",name:"base10",alphabet:"0123456789"});var Jw=Object.freeze({__proto__:null,base10:Zw});const Xw=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qw=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var eb=Object.freeze({__proto__:null,base16:Xw,base16upper:Qw});const tb=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rb=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nb=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ib=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),sb=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ob=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ab=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cb=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ub=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var lb=Object.freeze({__proto__:null,base32:tb,base32upper:rb,base32pad:nb,base32padupper:ib,base32hex:sb,base32hexupper:ob,base32hexpad:ab,base32hexpadupper:cb,base32z:ub});const hb=si({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fb=si({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var db=Object.freeze({__proto__:null,base36:hb,base36upper:fb});const pb=si({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gb=si({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yb=Object.freeze({__proto__:null,base58btc:pb,base58flickr:gb});const wb=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bb=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mb=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vb=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Eb=Object.freeze({__proto__:null,base64:wb,base64pad:bb,base64url:mb,base64urlpad:vb});const Wh=Array.from(""),xb=Wh.reduce((t,e,r)=>(t[r]=e,t),[]),_b=Wh.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Ib(t){return t.reduce((e,r)=>(e+=xb[r],e),"")}function Sb(t){const e=[];for(const r of t){const n=_b[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Db=ds({prefix:"",name:"base256emoji",encode:Ib,decode:Sb});var Ob=Object.freeze({__proto__:null,base256emoji:Db}),Ab=Gh,tu=128,$b=-128,Bb=Math.pow(2,31);function Gh(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Bb;)e[r++]=t&255|tu,t/=128;for(;t&$b;)e[r++]=t&255|tu,t>>>=7;return e[r]=t|0,Gh.bytes=r-n+1,e}var Pb=jo,Tb=128,ru=127;function jo(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw jo.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&ru)<<i:(o&ru)*Math.pow(2,i),i+=7}while(o>=Tb);return jo.bytes=s-n,r}var Rb=Math.pow(2,7),Cb=Math.pow(2,14),Nb=Math.pow(2,21),Ub=Math.pow(2,28),kb=Math.pow(2,35),Lb=Math.pow(2,42),Fb=Math.pow(2,49),Mb=Math.pow(2,56),qb=Math.pow(2,63),jb=function(t){return t<Rb?1:t<Cb?2:t<Nb?3:t<Ub?4:t<kb?5:t<Lb?6:t<Fb?7:t<Mb?8:t<qb?9:10},zb={encode:Ab,decode:Pb,encodingLength:jb},Yh=zb;const nu=(t,e,r=0)=>(Yh.encode(t,e,r),e),iu=t=>Yh.encodingLength(t),zo=(t,e)=>{const r=e.byteLength,n=iu(t),i=n+iu(r),s=new Uint8Array(i+r);return nu(t,s,0),nu(r,s,n),s.set(e,i),new Vb(t,r,e,s)};let Vb=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const Zh=({name:t,code:e,encode:r})=>new Kb(t,e,r);let Kb=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?zo(this.code,r):r.then(n=>zo(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Jh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Hb=Zh({name:"sha2-256",code:18,encode:Jh("SHA-256")}),Wb=Zh({name:"sha2-512",code:19,encode:Jh("SHA-512")});var Gb=Object.freeze({__proto__:null,sha256:Hb,sha512:Wb});const Xh=0,Yb="identity",Qh=Kh,Zb=t=>zo(Xh,Qh(t)),Jb={code:Xh,name:Yb,encode:Qh,digest:Zb};var Xb=Object.freeze({__proto__:null,identity:Jb});new TextEncoder,new TextDecoder;const su={...Kw,...Ww,...Yw,...Jw,...eb,...lb,...db,...yb,...Eb,...Ob};({...Gb,...Xb});function ef(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const ou=ef("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ws=ef("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=zh(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),tf={utf8:ou,"utf-8":ou,hex:su.base16,latin1:Ws,ascii:Ws,binary:Ws,...su};function ps(t,e="utf8"){const r=tf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function En(t,e="utf8"){const r=tf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ka(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function au(t){return gn(ps(En(t,fs),qh))}function Ki(t){return ps(En(ii(t),qh),fs)}function rf(t){const e=En(Pw,eu),r=Bw+ps(Vh([e,t]),eu);return[Aw,$w,r].join(Ow)}function Qb(t){return ps(t,fs)}function em(t){return En(t,fs)}function tm(t){return En([Ki(t.header),Ki(t.payload)].join(Vi),jh)}function rm(t){return[Ki(t.header),Ki(t.payload),Qb(t.signature)].join(Vi)}function Vo(t){const e=t.split(Vi),r=au(e[0]),n=au(e[1]),i=em(e[2]),s=En(e.slice(0,2).join(Vi),jh);return{header:r,payload:n,signature:i,data:s}}function cu(t=Bh(Tw)){const e=Mh.getPublicKey(t);return{secretKey:Vh([t,e]),publicKey:e}}async function nm(t,e,r,n,i=M.fromMiliseconds(Date.now())){const s={alg:Sw,typ:Dw},o=rf(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=tm({header:s,payload:c}),l=Mh.sign(u,n.secretKey.slice(0,32));return rm({header:s,payload:c,signature:l})}var uu=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},im=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})(),sm=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),om=(function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t})(),am=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),cm=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),um=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,lm=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,lu=3,hm=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",um]],hu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function fm(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new cm:typeof navigator<"u"?pm(navigator.userAgent):ym()}function dm(t){return t!==""&&hm.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function pm(t){var e=dm(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new am;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<lu&&(i=uu(uu([],i,!0),wm(lu-i.length),!0)):i=[];var s=i.join("."),o=gm(t),a=lm.exec(t);return a&&a[1]?new om(r,s,o,a[1]):new im(r,s,o)}function gm(t){for(var e=0,r=hu.length;e<r;e++){var n=hu[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function ym(){var t=typeof process<"u"&&process.version;return t?new sm(process.version.slice(1)):null}function wm(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var oe={},fu;function nf(){if(fu)return oe;fu=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.getLocalStorage=oe.getLocalStorageOrThrow=oe.getCrypto=oe.getCryptoOrThrow=oe.getLocation=oe.getLocationOrThrow=oe.getNavigator=oe.getNavigatorOrThrow=oe.getDocument=oe.getDocumentOrThrow=oe.getFromWindowOrThrow=oe.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}oe.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}oe.getFromWindowOrThrow=e;function r(){return e("document")}oe.getDocumentOrThrow=r;function n(){return t("document")}oe.getDocument=n;function i(){return e("navigator")}oe.getNavigatorOrThrow=i;function s(){return t("navigator")}oe.getNavigator=s;function o(){return e("location")}oe.getLocationOrThrow=o;function a(){return t("location")}oe.getLocation=a;function c(){return e("crypto")}oe.getCryptoOrThrow=c;function u(){return t("crypto")}oe.getCrypto=u;function l(){return e("localStorage")}oe.getLocalStorageOrThrow=l;function h(){return t("localStorage")}return oe.getLocalStorage=h,oe}var tr=nf(),On={},du;function bm(){if(du)return On;du=1,Object.defineProperty(On,"__esModule",{value:!0}),On.getWindowMetadata=void 0;const t=nf();function e(){let r,n;try{r=t.getDocumentOrThrow(),n=t.getLocationOrThrow()}catch{return null}function i(){const p=r.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const y=p[g],x=y.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const I=y.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let b=n.protocol+"//"+n.host;if(I.indexOf("/")===0)b+=I;else{const w=n.pathname.split("/");w.pop();const v=w.join("/");b+=v+"/"+I}d.push(b)}else if(I.indexOf("//")===0){const b=n.protocol+I;d.push(b)}else d.push(I)}}return d}function s(...p){const d=r.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const y=d[g],x=["itemprop","property","name"].map(I=>y.getAttribute(I)).filter(I=>I?p.includes(I):!1);if(x.length&&x){const I=y.getAttribute("content");if(I)return I}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),u=a(),l=n.origin,h=i();return{description:u,url:l,icons:h,name:c}}return On.getWindowMetadata=e,On}var mm=bm();const vm="0.1.1";function Em(){return vm}class le extends Error{constructor(e,r={}){const n=(()=>{var c;if(r.cause instanceof le){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),i=r.cause instanceof le&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Em()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return sf(this,e)}}function sf(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?sf(t.cause,e):e?null:t}const rn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Yn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Kr(t,...e){if(!xm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function _m(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Yn(t.outputLen),Yn(t.blockLen)}function yn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function of(t,e){Kr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Im(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function wn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Gs(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Dt(t,e){return t<<32-e|t>>>e}const Sm=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Dm(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Om(t){for(let e=0;e<t.length;e++)t[e]=Dm(t[e]);return t}const pu=Sm?t=>t:Om;function Am(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function gs(t){return typeof t=="string"&&(t=Am(t)),Kr(t),t}function $m(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Kr(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class La{}function af(t){const e=n=>t().update(gs(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Bm(t=32){if(rn&&typeof rn.getRandomValues=="function")return rn.getRandomValues(new Uint8Array(t));if(rn&&typeof rn.randomBytes=="function")return Uint8Array.from(rn.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function Pm(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function Tm(t,e,r){return t&e^~t&r}function Rm(t,e,r){return t&e^t&r^e&r}class Cm extends La{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Gs(this.buffer)}update(e){yn(this),e=gs(e),Kr(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Gs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yn(this),of(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,wn(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;Pm(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Gs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const or=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Si=BigInt(2**32-1),gu=BigInt(32);function Nm(t,e=!1){return e?{h:Number(t&Si),l:Number(t>>gu&Si)}:{h:Number(t>>gu&Si)|0,l:Number(t&Si)|0}}function Um(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Nm(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const km=(t,e,r)=>t<<r|e>>>32-r,Lm=(t,e,r)=>e<<r|t>>>32-r,Fm=(t,e,r)=>e<<r-32|t>>>64-r,Mm=(t,e,r)=>t<<r-32|e>>>64-r,qm=BigInt(0),An=BigInt(1),jm=BigInt(2),zm=BigInt(7),Vm=BigInt(256),Km=BigInt(113),cf=[],uf=[],lf=[];for(let t=0,e=An,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],cf.push(2*(5*n+r)),uf.push((t+1)*(t+2)/2%64);let i=qm;for(let s=0;s<7;s++)e=(e<<An^(e>>zm)*Km)%Vm,e&jm&&(i^=An<<(An<<BigInt(s))-An);lf.push(i)}const hf=Um(lf,!0),Hm=hf[0],Wm=hf[1],yu=(t,e,r)=>r>32?Fm(t,e,r):km(t,e,r),wu=(t,e,r)=>r>32?Mm(t,e,r):Lm(t,e,r);function Gm(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=yu(u,l,1)^r[a],f=wu(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=uf[o],c=yu(i,s,a),u=wu(i,s,a),l=cf[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Hm[n],t[1]^=Wm[n]}wn(r)}class Fa extends La{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,Yn(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Im(this.state)}clone(){return this._cloneInto()}keccak(){pu(this.state32),Gm(this.state32,this.rounds),pu(this.state32),this.posOut=0,this.pos=0}update(e){yn(this),e=gs(e),Kr(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){yn(this,!1),Kr(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Yn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(of(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wn(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Fa(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Ym=(t,e,r)=>af(()=>new Fa(e,t,r)),Zm=Ym(1,136,256/8),Jm=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ar=new Uint32Array(64);class Xm extends Cm{constructor(e=32){super(64,e,8,!1),this.A=or[0]|0,this.B=or[1]|0,this.C=or[2]|0,this.D=or[3]|0,this.E=or[4]|0,this.F=or[5]|0,this.G=or[6]|0,this.H=or[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ar[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=ar[h-15],p=ar[h-2],d=Dt(f,7)^Dt(f,18)^f>>>3,g=Dt(p,17)^Dt(p,19)^p>>>10;ar[h]=g+ar[h-7]+d+ar[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=Dt(a,6)^Dt(a,11)^Dt(a,25),p=l+f+Tm(a,c,u)+Jm[h]+ar[h]|0,g=(Dt(n,2)^Dt(n,13)^Dt(n,22))+Rm(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){wn(ar)}destroy(){this.set(0,0,0,0,0,0,0,0),wn(this.buffer)}}const Qm=af(()=>new Xm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ma=BigInt(0),Ko=BigInt(1);function oi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qa(t){if(!oi(t))throw new Error("Uint8Array expected")}function Zn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Di(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ff(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ma:BigInt("0x"+t)}const df=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",e1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Jn(t){if(qa(t),df)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=e1[t[r]];return e}const Mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function bu(t){if(t>=Mt._0&&t<=Mt._9)return t-Mt._0;if(t>=Mt.A&&t<=Mt.F)return t-(Mt.A-10);if(t>=Mt.a&&t<=Mt.f)return t-(Mt.a-10)}function Hi(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(df)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=bu(t.charCodeAt(s)),a=bu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function zr(t){return ff(Jn(t))}function pf(t){return qa(t),ff(Jn(Uint8Array.from(t).reverse()))}function ai(t,e){return Hi(t.toString(16).padStart(e*2,"0"))}function gf(t,e){return ai(t,e).reverse()}function ft(t,e,r){let n;if(typeof e=="string")try{n=Hi(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(oi(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Wi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];qa(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const Ys=t=>typeof t=="bigint"&&Ma<=t;function ja(t,e,r){return Ys(t)&&Ys(e)&&Ys(r)&&e<=t&&t<r}function fn(t,e,r,n){if(!ja(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function t1(t){let e;for(e=0;t>Ma;t>>=Ko,e+=1);return e}const ys=t=>(Ko<<BigInt(t))-Ko,Zs=t=>new Uint8Array(t),mu=t=>Uint8Array.from(t);function r1(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Zs(t),i=Zs(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...h)=>r(i,n,...h),c=(h=Zs(0))=>{i=a(mu([0]),h),n=a(),h.length!==0&&(i=a(mu([1]),h),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const p=n.slice();f.push(p),h+=n.length}return Wi(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(u()));)c();return o(),p}}const n1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||oi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ws(t,e,r={}){const n=(i,s,o)=>{const a=n1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function vu(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}function i1(t,e){if(Iu(t)>e)throw new S1({givenSize:Iu(t),maxSize:e})}const qt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Eu(t){if(t>=qt.zero&&t<=qt.nine)return t-qt.zero;if(t>=qt.A&&t<=qt.F)return t-(qt.A-10);if(t>=qt.a&&t<=qt.f)return t-(qt.a-10)}function s1(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new D1({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function yf(t,e){if(Dr(t)>e)throw new g1({givenSize:Dr(t),maxSize:e})}function o1(t,e){if(typeof e=="number"&&e>0&&e>Dr(t)-1)throw new mf({offset:e,position:"start",size:Dr(t)})}function a1(t,e,r){if(typeof e=="number"&&typeof r=="number"&&Dr(t)!==r-e)throw new mf({offset:r,position:"end",size:Dr(t)})}function wf(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new y1({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const c1="#__bigint";function za(t,e,r){return JSON.stringify(t,(n,i)=>typeof i=="bigint"?i.toString()+c1:i,r)}const u1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function l1(t,e={}){const{strict:r=!1}=e;if(!t)throw new xu(t);if(typeof t!="string")throw new xu(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new _u(t);if(!t.startsWith("0x"))throw new _u(t)}function h1(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Va(t){return t instanceof Uint8Array?Gi(t):Array.isArray(t)?Gi(new Uint8Array(t)):t}function Gi(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=u1[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(yf(n,e.size),bf(n,e.size)):n}function Js(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new p1({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?f1(c,n):c}function f1(t,e){return wf(t,{dir:"left",size:e})}function bf(t,e){return wf(t,{dir:"right",size:e})}function Wt(t,e,r,n={}){const{strict:i}=n;o1(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return i&&a1(s,e,r),s}function Dr(t){return Math.ceil((t.length-2)/2)}function d1(t,e={}){const{strict:r=!1}=e;try{return l1(t,{strict:r}),!0}catch{return!1}}class p1 extends le{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class xu extends le{constructor(e){super(`Value \`${typeof e=="object"?za(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class _u extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let g1=class extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class mf extends le{constructor({offset:e,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let y1=class extends le{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const w1=new TextEncoder;function b1(t){if(!(t instanceof Uint8Array)){if(!t)throw new Oi(t);if(typeof t!="object")throw new Oi(t);if(!("BYTES_PER_ELEMENT"in t))throw new Oi(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Oi(t)}}function m1(t){return t instanceof Uint8Array?t:typeof t=="string"?E1(t):v1(t)}function v1(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function E1(t,e={}){const{size:r}=e;let n=t;r&&(yf(t,r),n=bf(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=Eu(i.charCodeAt(c++)),l=Eu(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new le(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function x1(t,e={}){const{size:r}=e,n=w1.encode(t);return typeof r=="number"?(i1(n,r),_1(n,r)):n}function _1(t,e){return s1(t,{dir:"right",size:e})}function Iu(t){return t.length}function I1(t){try{return b1(t),!0}catch{return!1}}class Oi extends le{constructor(e){super(`Value \`${typeof e=="object"?za(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class S1 extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class D1 extends le{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function vf(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=Zm(m1(t));return r==="Bytes"?n:Gi(n)}class O1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const A1={checksum:new O1(8192)},Xs=A1.checksum;function Ef(t,e={}){const{compressed:r}=e,{prefix:n,x:i,y:s}=t;if(r===!1||typeof i=="bigint"&&typeof s=="bigint"){if(n!==4)throw new Su({prefix:n,cause:new C1});return}if(r===!0||typeof i=="bigint"&&typeof s>"u"){if(n!==3&&n!==2)throw new Su({prefix:n,cause:new R1});return}throw new T1({publicKey:t})}function $1(t){const e=(()=>{if(d1(t))return xf(t);if(I1(t))return B1(t);const{prefix:r,x:n,y:i}=t;return typeof n=="bigint"&&typeof i=="bigint"?{prefix:r??4,x:n,y:i}:{prefix:r,x:n}})();return Ef(e),e}function B1(t){return xf(Gi(t))}function xf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new N1({publicKey:t});if(t.length===130){const n=BigInt(Wt(t,0,32)),i=BigInt(Wt(t,32,64));return{prefix:4,x:n,y:i}}if(t.length===132){const n=Number(Wt(t,0,1)),i=BigInt(Wt(t,1,33)),s=BigInt(Wt(t,33,65));return{prefix:n,x:i,y:s}}const e=Number(Wt(t,0,1)),r=BigInt(Wt(t,1,33));return{prefix:e,x:r}}function P1(t,e={}){Ef(t);const{prefix:r,x:n,y:i}=t,{includePrefix:s=!0}=e;return h1(s?Js(r,{size:1}):"0x",Js(n,{size:32}),typeof i=="bigint"?Js(i,{size:32}):"0x")}class T1 extends le{constructor({publicKey:e}){super(`Value \`${za(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Su extends le{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class R1 extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class C1 extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let N1=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Dr(Va(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const U1=/^0x[a-fA-F0-9]{40}$/;function _f(t,e={}){const{strict:r=!0}=e;if(!U1.test(t))throw new Du({address:t,cause:new F1});if(r){if(t.toLowerCase()===t)return;if(If(t)!==t)throw new Du({address:t,cause:new M1})}}function If(t){if(Xs.has(t))return Xs.get(t);_f(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=vf(x1(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return Xs.set(t,i),i}function k1(t,e={}){const{checksum:r=!1}=e;return _f(t),r?If(t):t}function L1(t,e={}){const r=vf(`0x${P1(t).slice(4)}`).substring(26);return k1(`0x${r}`,e)}class Du extends le{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class F1 extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class M1 extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class Sf extends La{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,_m(e);const n=gs(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),wn(s)}update(e){return yn(this),this.iHash.update(e),this}digestInto(e){yn(this),Kr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Df=(t,e,r)=>new Sf(t,e).update(r).digest();Df.create=(t,e)=>new Sf(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Xe=BigInt(0),je=BigInt(1),Lr=BigInt(2),q1=BigInt(3),Of=BigInt(4),Af=BigInt(5),$f=BigInt(8);function Ye(t,e){const r=t%e;return r>=Xe?r:e+r}function ct(t,e,r){let n=t;for(;e-- >Xe;)n*=n,n%=r;return n}function Ho(t,e){if(t===Xe)throw new Error("invert: expected non-zero number");if(e<=Xe)throw new Error("invert: expected positive modulus, got "+e);let r=Ye(t,e),n=e,i=Xe,s=je;for(;r!==Xe;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==je)throw new Error("invert: does not exist");return Ye(i,e)}function Bf(t,e){const r=(t.ORDER+je)/Of,n=t.pow(e,r);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function j1(t,e){const r=(t.ORDER-Af)/$f,n=t.mul(e,Lr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,Lr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function z1(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-je,r=0;for(;e%Lr===Xe;)e/=Lr,r++;let n=Lr;const i=Ka(t);for(;Ou(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Bf;let s=i.pow(n,e);const o=(e+je)/Lr;return function(c,u){if(c.is0(u))return u;if(Ou(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,s),f=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===l)throw new Error("Cannot find square root");const y=je<<BigInt(l-d-1),x=c.pow(h,y);l=d,h=c.sqr(x),f=c.mul(f,h),p=c.mul(p,x)}return p}}function V1(t){return t%Of===q1?Bf:t%$f===Af?j1:z1(t)}const K1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function H1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=K1.reduce((n,i)=>(n[i]="function",n),e);return ws(t,r)}function W1(t,e,r){if(r<Xe)throw new Error("invalid exponent, negatives unsupported");if(r===Xe)return t.ONE;if(r===je)return e;let n=t.ONE,i=e;for(;r>Xe;)r&je&&(n=t.mul(n,i)),i=t.sqr(i),r>>=je;return n}function Pf(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function Ou(t,e){const r=(t.ORDER-je)/Lr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Tf(t,e){e!==void 0&&Yn(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ka(t,e,r=!1,n={}){if(t<=Xe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Tf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:ys(i),ZERO:Xe,ONE:je,create:c=>Ye(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Xe<=c&&c<t},is0:c=>c===Xe,isOdd:c=>(c&je)===je,neg:c=>Ye(-c,t),eql:(c,u)=>c===u,sqr:c=>Ye(c*c,t),add:(c,u)=>Ye(c+u,t),sub:(c,u)=>Ye(c-u,t),mul:(c,u)=>Ye(c*u,t),pow:(c,u)=>W1(a,c,u),div:(c,u)=>Ye(c*Ho(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ho(c,t),sqrt:n.sqrt||(c=>(o||(o=V1(t)),o(a,c))),toBytes:c=>r?gf(c,s):ai(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?pf(c):zr(c)},invertBatch:c=>Pf(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Rf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Cf(t){const e=Rf(t);return e+Math.ceil(e/2)}function G1(t,e,r=!1){const n=t.length,i=Rf(e),s=Cf(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?pf(t):zr(t),a=Ye(o,e-je)+je;return r?gf(a,i):ai(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Au=BigInt(0),Wo=BigInt(1);function Qs(t,e){const r=e.negate();return t?r:e}function Nf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function eo(t,e){Nf(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=ys(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function $u(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=Wo);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function Y1(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Z1(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const to=new WeakMap,Uf=new WeakMap;function ro(t){return Uf.get(t)||1}function J1(t,e){return{constTimeNegate:Qs,hasPrecomputes(r){return ro(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Au;)n&Wo&&(i=i.add(s)),s=s.double(),n>>=Wo;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=eo(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){let s=t.ZERO,o=t.BASE;const a=eo(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:d}=$u(i,c,a);i=u,h?o=o.add(Qs(p,n[d])):s=s.add(Qs(f,n[l]))}return{p:s,f:o}},wNAFUnsafe(r,n,i,s=t.ZERO){const o=eo(r,e);for(let a=0;a<o.windows&&i!==Au;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=$u(i,a,o);if(i=c,!l){const f=n[u];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,n,i){let s=to.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&to.set(n,i(s))),s},wNAFCached(r,n,i){const s=ro(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ro(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Nf(n,e),Uf.set(r,n),to.delete(r)}}}function X1(t,e,r,n){Y1(r,t),Z1(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=t1(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=ys(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<s;g++){const y=n[g],x=Number(y>>BigInt(p)&u);l[x]=l[x].add(r[g])}let d=o;for(let g=l.length-1,y=o;g>0;g--)y=y.add(l[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function kf(t){return H1(t.Fp),ws(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Tf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bu(t){t.lowS!==void 0&&Zn("lowS",t.lowS),t.prehash!==void 0&&Zn("prehash",t.prehash)}function Q1(t){const e=kf(t);ws(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class ev extends Error{constructor(e=""){super(e)}}const Gt={Err:ev,_tlv:{encode:(t,e)=>{const{Err:r}=Gt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Di(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Di(i.length/2|128):"";return Di(t)+s+i+e},decode(t,e){const{Err:r}=Gt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Gt;if(t<Jt)throw new e("integer: negative integers are not allowed");let r=Di(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Gt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return zr(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Gt,i=ft("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Gt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}};function no(t,e){return Jn(ai(t,e))}const Jt=BigInt(0),Se=BigInt(1);BigInt(2);const io=BigInt(3),tv=BigInt(4);function rv(t){const e=Q1(t),{Fp:r}=e,n=Ka(e.n,e.nBitLength),i=e.toBytes||((b,w,v)=>{const _=w.toAffine();return Wi(Uint8Array.from([4]),r.toBytes(_.x),r.toBytes(_.y))}),s=e.fromBytes||(b=>{const w=b.subarray(1),v=r.fromBytes(w.subarray(0,r.BYTES)),_=r.fromBytes(w.subarray(r.BYTES,2*r.BYTES));return{x:v,y:_}});function o(b){const{a:w,b:v}=e,_=r.sqr(b),A=r.mul(_,b);return r.add(r.add(A,r.mul(b,w)),v)}function a(b,w){const v=r.sqr(w),_=o(b);return r.eql(v,_)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,io),tv),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(b){return ja(b,Se,e.n)}function h(b){const{allowedPrivateKeyLengths:w,nByteLength:v,wrapPrivateKey:_,n:A}=e;if(w&&typeof b!="bigint"){if(oi(b)&&(b=Jn(b)),typeof b!="string"||!w.includes(b.length))throw new Error("invalid private key");b=b.padStart(v*2,"0")}let B;try{B=typeof b=="bigint"?b:zr(ft("private key",b,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof b)}return _&&(B=Ye(B,A)),fn("private key",B,Se,A),B}function f(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const p=vu((b,w)=>{const{px:v,py:_,pz:A}=b;if(r.eql(A,r.ONE))return{x:v,y:_};const B=b.is0();w==null&&(w=B?r.ONE:r.inv(A));const $=r.mul(v,w),N=r.mul(_,w),U=r.mul(A,w);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(U,r.ONE))throw new Error("invZ was invalid");return{x:$,y:N}}),d=vu(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:w,y:v}=b.toAffine();if(!r.isValid(w)||!r.isValid(v))throw new Error("bad point: x or y not FE");if(!a(w,v))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(w,v,_){if(w==null||!r.isValid(w))throw new Error("x required");if(v==null||!r.isValid(v)||r.is0(v))throw new Error("y required");if(_==null||!r.isValid(_))throw new Error("z required");this.px=w,this.py=v,this.pz=_,Object.freeze(this)}static fromAffine(w){const{x:v,y:_}=w||{};if(!w||!r.isValid(v)||!r.isValid(_))throw new Error("invalid affine point");if(w instanceof g)throw new Error("projective point not allowed");const A=B=>r.eql(B,r.ZERO);return A(v)&&A(_)?g.ZERO:new g(v,_,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){const v=Pf(r,w.map(_=>_.pz));return w.map((_,A)=>_.toAffine(v[A])).map(g.fromAffine)}static fromHex(w){const v=g.fromAffine(s(ft("pointHex",w)));return v.assertValidity(),v}static fromPrivateKey(w){return g.BASE.multiply(h(w))}static msm(w,v){return X1(g,n,w,v)}_setWindowSize(w){I.setWindowSize(this,w)}assertValidity(){d(this)}hasEvenY(){const{y:w}=this.toAffine();if(r.isOdd)return!r.isOdd(w);throw new Error("Field doesn't support isOdd")}equals(w){f(w);const{px:v,py:_,pz:A}=this,{px:B,py:$,pz:N}=w,U=r.eql(r.mul(v,N),r.mul(B,A)),C=r.eql(r.mul(_,N),r.mul($,A));return U&&C}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:w,b:v}=e,_=r.mul(v,io),{px:A,py:B,pz:$}=this;let N=r.ZERO,U=r.ZERO,C=r.ZERO,D=r.mul(A,A),T=r.mul(B,B),E=r.mul($,$),m=r.mul(A,B);return m=r.add(m,m),C=r.mul(A,$),C=r.add(C,C),N=r.mul(w,C),U=r.mul(_,E),U=r.add(N,U),N=r.sub(T,U),U=r.add(T,U),U=r.mul(N,U),N=r.mul(m,N),C=r.mul(_,C),E=r.mul(w,E),m=r.sub(D,E),m=r.mul(w,m),m=r.add(m,C),C=r.add(D,D),D=r.add(C,D),D=r.add(D,E),D=r.mul(D,m),U=r.add(U,D),E=r.mul(B,$),E=r.add(E,E),D=r.mul(E,m),N=r.sub(N,D),C=r.mul(E,T),C=r.add(C,C),C=r.add(C,C),new g(N,U,C)}add(w){f(w);const{px:v,py:_,pz:A}=this,{px:B,py:$,pz:N}=w;let U=r.ZERO,C=r.ZERO,D=r.ZERO;const T=e.a,E=r.mul(e.b,io);let m=r.mul(v,B),O=r.mul(_,$),R=r.mul(A,N),S=r.add(v,_),P=r.add(B,$);S=r.mul(S,P),P=r.add(m,O),S=r.sub(S,P),P=r.add(v,A);let k=r.add(B,N);return P=r.mul(P,k),k=r.add(m,R),P=r.sub(P,k),k=r.add(_,A),U=r.add($,N),k=r.mul(k,U),U=r.add(O,R),k=r.sub(k,U),D=r.mul(T,P),U=r.mul(E,R),D=r.add(U,D),U=r.sub(O,D),D=r.add(O,D),C=r.mul(U,D),O=r.add(m,m),O=r.add(O,m),R=r.mul(T,R),P=r.mul(E,P),O=r.add(O,R),R=r.sub(m,R),R=r.mul(T,R),P=r.add(P,R),m=r.mul(O,P),C=r.add(C,m),m=r.mul(k,P),U=r.mul(S,U),U=r.sub(U,m),m=r.mul(S,O),D=r.mul(k,D),D=r.add(D,m),new g(U,C,D)}subtract(w){return this.add(w.negate())}is0(){return this.equals(g.ZERO)}wNAF(w){return I.wNAFCached(this,w,g.normalizeZ)}multiplyUnsafe(w){const{endo:v,n:_}=e;fn("scalar",w,Jt,_);const A=g.ZERO;if(w===Jt)return A;if(this.is0()||w===Se)return this;if(!v||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,w,g.normalizeZ);let{k1neg:B,k1:$,k2neg:N,k2:U}=v.splitScalar(w),C=A,D=A,T=this;for(;$>Jt||U>Jt;)$&Se&&(C=C.add(T)),U&Se&&(D=D.add(T)),T=T.double(),$>>=Se,U>>=Se;return B&&(C=C.negate()),N&&(D=D.negate()),D=new g(r.mul(D.px,v.beta),D.py,D.pz),C.add(D)}multiply(w){const{endo:v,n:_}=e;fn("scalar",w,Se,_);let A,B;if(v){const{k1neg:$,k1:N,k2neg:U,k2:C}=v.splitScalar(w);let{p:D,f:T}=this.wNAF(N),{p:E,f:m}=this.wNAF(C);D=I.constTimeNegate($,D),E=I.constTimeNegate(U,E),E=new g(r.mul(E.px,v.beta),E.py,E.pz),A=D.add(E),B=T.add(m)}else{const{p:$,f:N}=this.wNAF(w);A=$,B=N}return g.normalizeZ([A,B])[0]}multiplyAndAddUnsafe(w,v,_){const A=g.BASE,B=(N,U)=>U===Jt||U===Se||!N.equals(A)?N.multiplyUnsafe(U):N.multiply(U),$=B(this,v).add(B(w,_));return $.is0()?void 0:$}toAffine(w){return p(this,w)}isTorsionFree(){const{h:w,isTorsionFree:v}=e;if(w===Se)return!0;if(v)return v(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:w,clearCofactor:v}=e;return w===Se?this:v?v(g,this):this.multiplyUnsafe(e.h)}toRawBytes(w=!0){return Zn("isCompressed",w),this.assertValidity(),i(g,this,w)}toHex(w=!0){return Zn("isCompressed",w),Jn(this.toRawBytes(w))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:y,nBitLength:x}=e,I=J1(g,y?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function nv(t){const e=kf(t);return ws(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function iv(t){const e=nv(t),{Fp:r,n,nByteLength:i,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(E){return Ye(E,n)}function u(E){return Ho(E,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=rv({...e,toBytes(E,m,O){const R=m.toAffine(),S=r.toBytes(R.x),P=Wi;return Zn("isCompressed",O),O?P(Uint8Array.from([m.hasEvenY()?2:3]),S):P(Uint8Array.from([4]),S,r.toBytes(R.y))},fromBytes(E){const m=E.length,O=E[0],R=E.subarray(1);if(m===o&&(O===2||O===3)){const S=zr(R);if(!ja(S,Se,r.ORDER))throw new Error("Point is not on curve");const P=f(S);let k;try{k=r.sqrt(P)}catch(z){const j=z instanceof Error?": "+z.message:"";throw new Error("Point is not on curve"+j)}const L=(k&Se)===Se;return(O&1)===1!==L&&(k=r.neg(k)),{x:S,y:k}}else if(m===a&&O===4){const S=r.fromBytes(R.subarray(0,r.BYTES)),P=r.fromBytes(R.subarray(r.BYTES,2*r.BYTES));return{x:S,y:P}}else{const S=o,P=a;throw new Error("invalid Point, expected length of "+S+", or uncompressed "+P+", got "+m)}}});function d(E){const m=n>>Se;return E>m}function g(E){return d(E)?c(-E):E}const y=(E,m,O)=>zr(E.slice(m,O));class x{constructor(m,O,R){fn("r",m,Se,n),fn("s",O,Se,n),this.r=m,this.s=O,R!=null&&(this.recovery=R),Object.freeze(this)}static fromCompact(m){const O=i;return m=ft("compactSignature",m,O*2),new x(y(m,0,O),y(m,O,2*O))}static fromDER(m){const{r:O,s:R}=Gt.toSig(ft("DER",m));return new x(O,R)}assertValidity(){}addRecoveryBit(m){return new x(this.r,this.s,m)}recoverPublicKey(m){const{r:O,s:R,recovery:S}=this,P=A(ft("msgHash",m));if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");const k=S===2||S===3?O+e.n:O;if(k>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(S&1)===0?"02":"03",K=l.fromHex(L+no(k,r.BYTES)),z=u(k),j=c(-P*z),H=c(R*z),G=l.BASE.multiplyAndAddUnsafe(K,j,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new x(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Hi(this.toDERHex())}toDERHex(){return Gt.hexFromSig(this)}toCompactRawBytes(){return Hi(this.toCompactHex())}toCompactHex(){const m=i;return no(this.r,m)+no(this.s,m)}}const I={isValidPrivateKey(E){try{return h(E),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const E=Cf(e.n);return G1(e.randomBytes(E),e.n)},precompute(E=8,m=l.BASE){return m._setWindowSize(E),m.multiply(BigInt(3)),m}};function b(E,m=!0){return l.fromPrivateKey(E).toRawBytes(m)}function w(E){if(typeof E=="bigint")return!1;if(E instanceof l)return!0;const O=ft("key",E).length,R=r.BYTES,S=R+1,P=2*R+1;if(!(e.allowedPrivateKeyLengths||i===S))return O===S||O===P}function v(E,m,O=!0){if(w(E)===!0)throw new Error("first arg must be private key");if(w(m)===!1)throw new Error("second arg must be public key");return l.fromHex(m).multiply(h(E)).toRawBytes(O)}const _=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const m=zr(E),O=E.length*8-s;return O>0?m>>BigInt(O):m},A=e.bits2int_modN||function(E){return c(_(E))},B=ys(s);function $(E){return fn("num < 2^"+s,E,Jt,B),ai(E,i)}function N(E,m,O=U){if(["recovered","canonical"].some(W=>W in O))throw new Error("sign() legacy options not supported");const{hash:R,randomBytes:S}=e;let{lowS:P,prehash:k,extraEntropy:L}=O;P==null&&(P=!0),E=ft("msgHash",E),Bu(O),k&&(E=ft("prehashed msgHash",R(E)));const K=A(E),z=h(m),j=[$(z),$(K)];if(L!=null&&L!==!1){const W=L===!0?S(r.BYTES):L;j.push(ft("extraEntropy",W))}const H=Wi(...j),G=K;function J(W){const X=_(W);if(!p(X))return;const he=u(X),we=l.BASE.multiply(X).toAffine(),Ee=c(we.x);if(Ee===Jt)return;const qe=c(he*c(G+Ee*z));if(qe===Jt)return;let kt=(we.x===Ee?0:2)|Number(we.y&Se),nr=qe;return P&&d(qe)&&(nr=g(qe),kt^=1),new x(Ee,nr,kt)}return{seed:H,k2sig:J}}const U={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function D(E,m,O=U){const{seed:R,k2sig:S}=N(E,m,O),P=e;return r1(P.hash.outputLen,P.nByteLength,P.hmac)(R,S)}l.BASE._setWindowSize(8);function T(E,m,O,R=C){var kt;const S=E;m=ft("msgHash",m),O=ft("publicKey",O);const{lowS:P,prehash:k,format:L}=R;if(Bu(R),"strict"in R)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const K=typeof S=="string"||oi(S),z=!K&&!L&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!K&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let j,H;try{if(z&&(j=new x(S.r,S.s)),K){try{L!=="compact"&&(j=x.fromDER(S))}catch(nr){if(!(nr instanceof Gt.Err))throw nr}!j&&L!=="der"&&(j=x.fromCompact(S))}H=l.fromHex(O)}catch{return!1}if(!j||P&&j.hasHighS())return!1;k&&(m=e.hash(m));const{r:G,s:J}=j,W=A(m),X=u(J),he=c(W*X),we=c(G*X),Ee=(kt=l.BASE.multiplyAndAddUnsafe(H,he,we))==null?void 0:kt.toAffine();return Ee?c(Ee.x)===G:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:v,sign:D,verify:T,ProjectivePoint:l,Signature:x,utils:I}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function sv(t){return{hash:t,hmac:(e,...r)=>Df(t,e,$m(...r)),randomBytes:Bm}}function ov(t,e){const r=n=>iv({...t,...sv(n)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Pu=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),av=BigInt(0),cv=BigInt(1),Go=BigInt(2),Tu=(t,e)=>(t+e/Go)/e;function uv(t){const e=Lf,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=ct(l,r,e)*l%e,f=ct(h,r,e)*l%e,p=ct(f,Go,e)*u%e,d=ct(p,i,e)*p%e,g=ct(d,s,e)*d%e,y=ct(g,a,e)*g%e,x=ct(y,c,e)*y%e,I=ct(x,a,e)*g%e,b=ct(I,r,e)*l%e,w=ct(b,o,e)*d%e,v=ct(w,n,e)*u%e,_=ct(v,Go,e);if(!Yo.eql(Yo.sqr(_),t))throw new Error("Cannot find square root");return _}const Yo=Ka(Lf,void 0,void 0,{sqrt:uv}),lv=ov({a:av,b:BigInt(7),Fp:Yo,n:Pu,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Pu,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-cv*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Tu(s*t,e),c=Tu(-n*t,e);let u=Ye(t-a*r-c*i,e),l=Ye(-a*n-c*s,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},Qm);function hv(t){if(t.length!==130&&t.length!==132)throw new dv({signature:t});const e=BigInt(Wt(t,0,32)),r=BigInt(Wt(t,32,64)),n=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return fv(i)}catch{throw new pv({value:i})}})();return typeof n>"u"?{r:e,s:r}:{r:e,s:r,yParity:n}}function fv(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new gv({value:t})}class dv extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Dr(Va(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class pv extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class gv extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ff(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Yi(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function ci(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Zi(t){if(!Array.isArray(t))throw new Error("array expected")}function Ji(t,e){if(!Mf(!0,e))throw new Error(`${t}: array of strings expected`)}function qf(t,e){if(!Mf(!1,e))throw new Error(`${t}: array of numbers expected`)}function jf(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function zf(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Ji("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Zi(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(Zi(i),i.map(s=>{Yi("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Vf(t=""){return Yi("join",t),{encode:e=>(Ji("join.decode",e),e.join(t)),decode:e=>(Yi("join.decode",e),e.split(t))}}function yv(t,e="="){return ci(t),Yi("padding",e),{encode(r){for(Ji("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Ji("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function Ru(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(Zi(t),!t.length)return[];let n=0;const i=[],s=Array.from(t,a=>{if(ci(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=n;u<o;u++){const l=s[u],h=e*a,f=h+l;if(!Number.isSafeInteger(f)||h/e!==a||f-l!==h)throw new Error("convertRadix: carry overflow");const p=f/r;a=f%r;const d=Math.floor(p);if(s[u]=d,!Number.isSafeInteger(d)||d*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:n=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const Kf=(t,e)=>e===0?t:Kf(e,t%e),Xi=(t,e)=>t+(e-Kf(t,e)),so=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Cu(t,e,r,n){if(Zi(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Xi(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Xi(e,r)}`);let i=0,s=0;const o=so[e],a=so[r]-1,c=[];for(const u of t){if(ci(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const l=so[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function wv(t){ci(t);const e=2**8;return{encode:r=>{if(!Ff(r))throw new Error("radix.encode input should be Uint8Array");return Ru(Array.from(r),e,t)},decode:r=>(qf("radix.decode",r),Uint8Array.from(Ru(r,t,e)))}}function bv(t,e=!1){if(ci(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Xi(8,t)>32||Xi(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Ff(r))throw new Error("radix2.encode input should be Uint8Array");return Cu(Array.from(r),8,t,!e)},decode:r=>(qf("radix2.decode",r),Uint8Array.from(Cu(r,t,8,e)))}}const mv=jf(bv(5),zf("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),yv(5),Vf("")),vv=t=>jf(wv(58),zf(t),Vf("")),ui=vv("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function Ev(t){return L1(xv(t))}function xv(t){const{payload:e,signature:r}=t,{r:n,s:i,yParity:s}=r,a=new lv.Signature(BigInt(n),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Va(e).substring(2));return $1(a)}function _v(t){const e=t.length;let r=0,n=0;for(;n<e;){let i=t.charCodeAt(n++);if((i&4294967168)===0){r++;continue}else if((i&4294965248)===0)r+=2;else{if(i>=55296&&i<=56319&&n<e){const s=t.charCodeAt(n);(s&64512)===56320&&(++n,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?r+=3:r+=4}}return r}function Iv(t,e,r){const n=t.length;let i=r,s=0;for(;s<n;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<n){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Sv=new TextEncoder,Dv=50;function Ov(t,e,r){Sv.encodeInto(t,e.subarray(r))}function Av(t,e,r){t.length>Dv?Ov(t,e,r):Iv(t,e,r)}const $v=4096;function Hf(t,e,r){let n=e;const i=n+r,s=[];let o="";for(;n<i;){const a=t[n++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[n++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,u=t[n++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[n++]&63,u=t[n++]&63,l=t[n++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=$v&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const Bv=new TextDecoder,Pv=200;function Tv(t,e,r){const n=t.subarray(e,e+r);return Bv.decode(n)}function Rv(t,e,r){return r>Pv?Tv(t,e,r):Hf(t,e,r)}class Ai{constructor(e,r){Y(this,"type");Y(this,"data");this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const $n=4294967295;function Cv(t,e,r){const n=r/4294967296,i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Wf(t,e,r){const n=Math.floor(r/4294967296),i=r;t.setUint32(e,n),t.setUint32(e+4,i)}function Gf(t,e){const r=t.getInt32(e),n=t.getUint32(e+4);return r*4294967296+n}function Nv(t,e){const r=t.getUint32(e),n=t.getUint32(e+4);return r*4294967296+n}const Uv=-1,kv=4294967296-1,Lv=17179869184-1;function Fv({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Lv)if(e===0&&t<=kv){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,n=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,n),i}else{const r=new Uint8Array(12),n=new DataView(r.buffer);return n.setUint32(0,e),Wf(n,4,t),r}}function Mv(t){const e=t.getTime(),r=Math.floor(e/1e3),n=(e-r*1e3)*1e6,i=Math.floor(n/1e9);return{sec:r+i,nsec:n-i*1e9}}function qv(t){if(t instanceof Date){const e=Mv(t);return Fv(e)}else return null}function jv(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),n=e.getUint32(4),i=(r&3)*4294967296+n,s=r>>>2;return{sec:i,nsec:s}}case 12:{const r=Gf(e,4),n=e.getUint32(0);return{sec:r,nsec:n}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function zv(t){const e=jv(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Vv={type:Uv,encode:qv,decode:zv},us=class us{constructor(){Y(this,"__brand");Y(this,"builtInEncoders",[]);Y(this,"builtInDecoders",[]);Y(this,"encoders",[]);Y(this,"decoders",[]);this.register(Vv)}register({type:e,encode:r,decode:n}){if(e>=0)this.encoders[e]=r,this.decoders[e]=n;else{const i=-1-e;this.builtInEncoders[i]=r,this.builtInDecoders[i]=n}}tryToEncode(e,r){for(let n=0;n<this.builtInEncoders.length;n++){const i=this.builtInEncoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=-1-n;return new Ai(o,s)}}}for(let n=0;n<this.encoders.length;n++){const i=this.encoders[n];if(i!=null){const s=i(e,r);if(s!=null){const o=n;return new Ai(o,s)}}}return e instanceof Ai?e:null}decode(e,r,n){const i=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return i?i(e,r,n):new Ai(r,e)}};Y(us,"defaultCodec",new us);let Qi=us;function Kv(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Zo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Kv(t)?new Uint8Array(t):Uint8Array.from(t)}const Hv=100,Wv=2048;let Gv=class Yf{constructor(e){Y(this,"extensionCodec");Y(this,"context");Y(this,"useBigInt64");Y(this,"maxDepth");Y(this,"initialBufferSize");Y(this,"sortKeys");Y(this,"forceFloat32");Y(this,"ignoreUndefined");Y(this,"forceIntegerToFloat");Y(this,"pos");Y(this,"view");Y(this,"bytes");Y(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qi.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??Hv,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??Wv,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Yf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),n=new Uint8Array(r),i=new DataView(r);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=_v(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),Av(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,r){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const n=Zo(e);this.writeU8a(n)}encodeArray(e,r){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const i of e)this.doEncode(i,r+1)}countWithoutUndefined(e,r){let n=0;for(const i of r)e[i]!==void 0&&n++;return n}encodeMap(e,r){const n=Object.keys(e);this.sortKeys&&n.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of n){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),i=n.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(n);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Cv(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Wf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Yv(t,e){return new Gv(e).encodeSharedRef(t)}function oo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Zv=16,Jv=16;class Xv{constructor(e=Zv,r=Jv){Y(this,"hit",0);Y(this,"miss",0);Y(this,"caches");Y(this,"maxKeyLength");Y(this,"maxLengthPerKey");this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,n){const i=this.caches[n-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<n;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const n=this.caches[e.length-1],i={bytes:e,str:r};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,r,n){const i=this.find(e,r,n);if(i!=null)return this.hit++,i;this.miss++;const s=Hf(e,r,n),o=Uint8Array.prototype.slice.call(e,r,r+n);return this.store(o,s),s}}const Jo="array",qn="map_key",Zf="map_value",Qv=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class e2{constructor(){Y(this,"stack",[]);Y(this,"stackHeadPosition",-1)}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=Jo,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=qn,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Jo){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===qn||e.type===Zf){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Bn=-1,Ha=new DataView(new ArrayBuffer(0)),t2=new Uint8Array(Ha.buffer);try{Ha.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Nu=new RangeError("Insufficient data"),r2=new Xv;let n2=class Jf{constructor(e){Y(this,"extensionCodec");Y(this,"context");Y(this,"useBigInt64");Y(this,"rawStrings");Y(this,"maxStrLength");Y(this,"maxBinLength");Y(this,"maxArrayLength");Y(this,"maxMapLength");Y(this,"maxExtLength");Y(this,"keyDecoder");Y(this,"mapKeyConverter");Y(this,"totalPos",0);Y(this,"pos",0);Y(this,"view",Ha);Y(this,"bytes",t2);Y(this,"headByte",Bn);Y(this,"stack",new e2);Y(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qi.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??$n,this.maxBinLength=(e==null?void 0:e.maxBinLength)??$n,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??$n,this.maxMapLength=(e==null?void 0:e.maxMapLength)??$n,this.maxExtLength=(e==null?void 0:e.maxExtLength)??$n,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:r2,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Qv}clone(){return new Jf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Bn,this.stack.reset()}setBuffer(e){const r=Zo(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Bn&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),n=Zo(e),i=new Uint8Array(r.length+n.length);i.set(r),i.set(n,r.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:n}=this;return new RangeError(`Extra ${r.byteLength-n} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,n;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${oo(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let n=r,i=-1;for await(const s of e){if(r&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else{const i=e-160;r=this.decodeString(i,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const i=this.lookU8();r=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();r=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();r=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else r=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else r={}}else if(e===196){const i=this.lookU8();r=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();r=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();r=this.decodeBinary(i,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();r=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();r=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();r=this.decodeExtension(i,4)}else throw new it(`Unrecognized type byte: ${oo(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const i=n.top();if(i.type===Jo)if(i.array[i.position]=r,i.position++,i.position===i.size)r=i.array,n.release(i);else continue e;else if(i.type===qn){if(r==="__proto__")throw new it("The key __proto__ is not allowed");i.key=this.mapKeyConverter(r),i.type=Zf;continue e}else if(i.map[i.key]=r,i.readCount++,i.readCount===i.size)r=i.map,n.release(i);else{i.key=null,i.type=qn;continue e}}return r}}readHeadByte(){return this.headByte===Bn&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Bn}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${oo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var s;if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Nu;const n=this.pos+r;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,n,e):i=Rv(this.bytes,n,e),this.pos+=r+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===qn:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Nu;const n=this.pos+r,i=this.bytes.subarray(n,n+e);return this.pos+=r+e,i}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+r),i=this.decodeBinary(e,r+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Nv(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Gf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function i2(t,e){return new n2(e).decode(t)}function Wa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Xf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Wa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function jn(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Xf(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Wa(r)}function s2(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var b=(I-x)*l+1>>>0,w=new Uint8Array(b);x!==I;){for(var v=d[x],_=0,A=b-1;(v!==0||_<y)&&A!==-1;A--,_++)v+=256*w[A]>>>0,w[A]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=b-y;B!==b&&w[B]===0;)B++;for(var $=c.repeat(g);B<b;++B)$+=t.charAt(w[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,b=new Uint8Array(I);d[g];){var w=r[d.charCodeAt(g)];if(w===255)return;for(var v=0,_=I-1;(w!==0||v<x)&&_!==-1;_--,v++)w+=a*b[_]>>>0,b[_]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");x=v,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&b[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=b[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var o2=s2,a2=o2;const c2=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},u2=t=>new TextEncoder().encode(t),l2=t=>new TextDecoder().decode(t);class h2{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class f2{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Qf(this,e)}}class d2{constructor(e){this.decoders=e}or(e){return Qf(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Qf=(t,e)=>new d2({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class p2{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new h2(e,r,n),this.decoder=new f2(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const bs=({name:t,prefix:e,encode:r,decode:n})=>new p2(t,e,r,n),li=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=a2(r,e);return bs({prefix:t,name:e,encode:n,decode:s=>c2(i(s))})},g2=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},y2=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Re=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>bs({prefix:e,name:t,encode(i){return y2(i,n,r)},decode(i){return g2(i,n,r,t)}}),w2=bs({prefix:"\0",name:"identity",encode:t=>l2(t),decode:t=>u2(t)}),b2=Object.freeze(Object.defineProperty({__proto__:null,identity:w2},Symbol.toStringTag,{value:"Module"})),m2=Re({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),v2=Object.freeze(Object.defineProperty({__proto__:null,base2:m2},Symbol.toStringTag,{value:"Module"})),E2=Re({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),x2=Object.freeze(Object.defineProperty({__proto__:null,base8:E2},Symbol.toStringTag,{value:"Module"})),_2=li({prefix:"9",name:"base10",alphabet:"0123456789"}),I2=Object.freeze(Object.defineProperty({__proto__:null,base10:_2},Symbol.toStringTag,{value:"Module"})),S2=Re({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),D2=Re({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),O2=Object.freeze(Object.defineProperty({__proto__:null,base16:S2,base16upper:D2},Symbol.toStringTag,{value:"Module"})),A2=Re({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),$2=Re({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),B2=Re({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),P2=Re({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),T2=Re({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),R2=Re({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),C2=Re({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),N2=Re({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),U2=Re({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),k2=Object.freeze(Object.defineProperty({__proto__:null,base32:A2,base32hex:T2,base32hexpad:C2,base32hexpadupper:N2,base32hexupper:R2,base32pad:B2,base32padupper:P2,base32upper:$2,base32z:U2},Symbol.toStringTag,{value:"Module"})),L2=li({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),F2=li({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),M2=Object.freeze(Object.defineProperty({__proto__:null,base36:L2,base36upper:F2},Symbol.toStringTag,{value:"Module"})),q2=li({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),j2=li({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),z2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:q2,base58flickr:j2},Symbol.toStringTag,{value:"Module"})),V2=Re({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),K2=Re({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),H2=Re({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),W2=Re({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),G2=Object.freeze(Object.defineProperty({__proto__:null,base64:V2,base64pad:K2,base64url:H2,base64urlpad:W2},Symbol.toStringTag,{value:"Module"})),ed=Array.from(""),Y2=ed.reduce((t,e,r)=>(t[r]=e,t),[]),Z2=ed.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function J2(t){return t.reduce((e,r)=>(e+=Y2[r],e),"")}function X2(t){const e=[];for(const r of t){const n=Z2[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Q2=bs({prefix:"",name:"base256emoji",encode:J2,decode:X2}),eE=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Q2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Uu={...b2,...v2,...x2,...I2,...O2,...k2,...M2,...z2,...G2,...eE};function td(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const ku=td("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ao=td("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Xf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),rd={utf8:ku,"utf-8":ku,hex:Uu.base16,latin1:ao,ascii:ao,binary:ao,...Uu};function gt(t,e="utf8"){const r=rd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Wa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function et(t,e="utf8"){const r=rd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const tE={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var co,Lu;function nd(){if(Lu)return co;Lu=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function i(o,a,c){let u=`
`+o+" = ";for(let l=0;l<a.length;l+=2){if(c===32)u+=n(a[l]).toUpperCase(),u+=" ",u+=n(a[l+1]).toUpperCase();else if(c===64)u+=n(a[l+1]).toUpperCase(),u+=n(a[l]).toUpperCase();else throw new Error("Invalid size "+c);l%6===4?u+=`
`+new Array(o.length+4).join(" "):l<a.length-2&&(u+=" ")}console.log(u)}function s(o,a,c){let u=new Date().getTime();const l=new Uint8Array(a);for(let f=0;f<a;f++)l[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-u)+"ms"),u=h;for(let f=0;f<c;f++){const p=o(l),d=new Date().getTime(),g=d-u;u=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return co={normalizeInput:e,toHex:r,debugPrint:i,testSpeed:s},co}var uo,Fu;function rE(){if(Fu)return uo;Fu=1;const t=nd();function e(x,I,b){const w=x[I]+x[b];let v=x[I+1]+x[b+1];w>=4294967296&&v++,x[I]=w,x[I+1]=v}function r(x,I,b,w){let v=x[I]+b;b<0&&(v+=4294967296);let _=x[I+1]+w;v>=4294967296&&_++,x[I]=v,x[I+1]=_}function n(x,I){return x[I]^x[I+1]<<8^x[I+2]<<16^x[I+3]<<24}function i(x,I,b,w,v,_){const A=u[v],B=u[v+1],$=u[_],N=u[_+1];e(c,x,I),r(c,x,A,B);let U=c[w]^c[x],C=c[w+1]^c[x+1];c[w]=C,c[w+1]=U,e(c,b,w),U=c[I]^c[b],C=c[I+1]^c[b+1],c[I]=U>>>24^C<<8,c[I+1]=C>>>24^U<<8,e(c,x,I),r(c,x,$,N),U=c[w]^c[x],C=c[w+1]^c[x+1],c[w]=U>>>16^C<<16,c[w+1]=C>>>16^U<<16,e(c,b,w),U=c[I]^c[b],C=c[I+1]^c[b+1],c[I]=C>>>31^U<<1,c[I+1]=U>>>31^C<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(x){return x*2})),c=new Uint32Array(32),u=new Uint32Array(32);function l(x,I){let b=0;for(b=0;b<16;b++)c[b]=x.h[b],c[b+16]=s[b];for(c[24]=c[24]^x.t,c[25]=c[25]^x.t/4294967296,I&&(c[28]=~c[28],c[29]=~c[29]),b=0;b<32;b++)u[b]=n(x.b,4*b);for(b=0;b<12;b++)i(0,8,16,24,a[b*16+0],a[b*16+1]),i(2,10,18,26,a[b*16+2],a[b*16+3]),i(4,12,20,28,a[b*16+4],a[b*16+5]),i(6,14,22,30,a[b*16+6],a[b*16+7]),i(0,10,20,30,a[b*16+8],a[b*16+9]),i(2,12,22,24,a[b*16+10],a[b*16+11]),i(4,14,16,26,a[b*16+12],a[b*16+13]),i(6,8,18,28,a[b*16+14],a[b*16+15]);for(b=0;b<16;b++)x.h[b]=x.h[b]^c[b]^c[b+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(x,I,b,w){if(x===0||x>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(I&&I.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(b&&b.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(w&&w.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const v={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:x};h.fill(0),h[0]=x,I&&(h[1]=I.length),h[2]=1,h[3]=1,b&&h.set(b,32),w&&h.set(w,48);for(let _=0;_<16;_++)v.h[_]=s[_]^n(h,_*4);return I&&(p(v,I),v.c=128),v}function p(x,I){for(let b=0;b<I.length;b++)x.c===128&&(x.t+=x.c,l(x,!1),x.c=0),x.b[x.c++]=I[b]}function d(x){for(x.t+=x.c;x.c<128;)x.b[x.c++]=0;l(x,!0);const I=new Uint8Array(x.outlen);for(let b=0;b<x.outlen;b++)I[b]=x.h[b>>2]>>8*(b&3);return I}function g(x,I,b,w,v){b=b||64,x=t.normalizeInput(x),w&&(w=t.normalizeInput(w)),v&&(v=t.normalizeInput(v));const _=f(b,I,w,v);return p(_,x),d(_)}function y(x,I,b,w,v){const _=g(x,I,b,w,v);return t.toHex(_)}return uo={blake2b:g,blake2bHex:y,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},uo}var lo,Mu;function nE(){if(Mu)return lo;Mu=1;const t=nd();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function r(d,g,y,x,I,b){o[d]=o[d]+o[g]+I,o[x]=n(o[x]^o[d],16),o[y]=o[y]+o[x],o[g]=n(o[g]^o[y],12),o[d]=o[d]+o[g]+b,o[x]=n(o[x]^o[d],8),o[y]=o[y]+o[x],o[g]=n(o[g]^o[y],7)}function n(d,g){return d>>>g^d<<32-g}const i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let y=0;for(y=0;y<8;y++)o[y]=d.h[y],o[y+8]=i[y];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),y=0;y<16;y++)a[y]=e(d.b,4*y);for(y=0;y<10;y++)r(0,4,8,12,a[s[y*16+0]],a[s[y*16+1]]),r(1,5,9,13,a[s[y*16+2]],a[s[y*16+3]]),r(2,6,10,14,a[s[y*16+4]],a[s[y*16+5]]),r(3,7,11,15,a[s[y*16+6]],a[s[y*16+7]]),r(0,5,10,15,a[s[y*16+8]],a[s[y*16+9]]),r(1,6,11,12,a[s[y*16+10]],a[s[y*16+11]]),r(2,7,8,13,a[s[y*16+12]],a[s[y*16+13]]),r(3,4,9,14,a[s[y*16+14]],a[s[y*16+15]]);for(y=0;y<8;y++)d.h[y]^=o[y]^o[y+8]}function u(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const y=g?g.length:0;if(g&&!(y>0&&y<=32))throw new Error("Incorrect key length, should be in [1, 32]");const x={h:new Uint32Array(i),b:new Uint8Array(64),c:0,t:0,outlen:d};return x.h[0]^=16842752^y<<8^d,y>0&&(l(x,g),x.c=64),x}function l(d,g){for(let y=0;y<g.length;y++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[y]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let y=0;y<d.outlen;y++)g[y]=d.h[y>>2]>>8*(y&3)&255;return g}function f(d,g,y){y=y||32,d=t.normalizeInput(d);const x=u(y,g);return l(x,d),h(x)}function p(d,g,y){const x=f(d,g,y);return t.toHex(x)}return lo={blake2s:f,blake2sHex:p,blake2sInit:u,blake2sUpdate:l,blake2sFinal:h},lo}var ho,qu;function iE(){if(qu)return ho;qu=1;const t=rE(),e=nE();return ho={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},ho}var sE=iE(),oE={};const aE=":";function Li(t){const[e,r]=t.split(aE);return{namespace:e,reference:r}}function id(t,e){return t.includes(":")?[t]:e.chains||[]}var cE=Object.defineProperty,uE=Object.defineProperties,lE=Object.getOwnPropertyDescriptors,ju=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,Xo=(t,e,r)=>e in t?cE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zu=(t,e)=>{for(var r in e||(e={}))hE.call(e,r)&&Xo(t,r,e[r]);if(ju)for(var r of ju(e))fE.call(e,r)&&Xo(t,r,e[r]);return t},dE=(t,e)=>uE(t,lE(e)),Vu=(t,e,r)=>Xo(t,typeof e!="symbol"?e+"":e,r);const pE="ReactNative",ot={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},gE="js";function es(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ar(){return!tr.getDocument()&&!!tr.getNavigator()&&navigator.product===pE}function yE(){return Ar()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function wE(){return Ar()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function xn(){return!es()&&!!tr.getNavigator()&&!!tr.getDocument()}function hi(){return Ar()?ot.reactNative:es()?ot.node:xn()?ot.browser:ot.unknown}function Ku(){var t;try{return Ar()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function bE(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&r.set(n,String(i))}),r.toString()}function mE(t){var e,r;const n=sd();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),dE(zu(zu({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function sd(){return mm.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function vE(){if(hi()===ot.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=fm();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function EE(){var t;const e=hi();return e===ot.browser?[e,((t=tr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function od(t,e,r){const n=vE(),i=EE();return[[t,e].join("-"),[gE,r].join("-"),n,i].join("/")}function xE({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=od(t,e,n),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=bE(u[1]||"",h);return u[0]+"?"+f}function Fr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Qo(t){return Object.fromEntries(t.entries())}function ea(t){return new Map(Object.entries(t))}function Nr(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function Nt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function ad(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function _E(t){return ad("topic",t)}function IE(t){return ad("id",t)}function cd(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function me(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function pr(t){return Date.now()>=M.toMiliseconds(t)}function ie(t,e){return`${t}${e?`:${e}`:""}`}function Vr(t=[],e=[]){return[...new Set([...t,...e])]}async function SE({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=DE(s,t,e),a=hi();if(a===ot.browser){if(!((n=tr.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}OE(o)}else a===ot.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function DE(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${PE(n,!0)}`}else i=`${i}/wc?${n}`;return i}function OE(t){let e="_self";BE()?e="_top":($E()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function AE(t,e){let r="";try{if(xn()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function Hu(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function Wu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ga(){return typeof process<"u"&&oE.IS_VITEST==="true"}function $E(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function BE(){try{return window.self!==window.top}catch{return!1}}function PE(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function ud(t){return Buffer.from(t,"base64").toString("utf-8")}function TE(t){return new Promise(e=>setTimeout(e,t))}let RE=class{constructor({limit:e}){Vu(this,"limit"),Vu(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const $i=BigInt(2**32-1),Gu=BigInt(32);function ld(t,e=!1){return e?{h:Number(t&$i),l:Number(t>>Gu&$i)}:{h:Number(t>>Gu&$i)|0,l:Number(t&$i)|0}}function hd(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=ld(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const Yu=(t,e,r)=>t>>>r,Zu=(t,e,r)=>t<<32-r|e>>>r,gr=(t,e,r)=>t>>>r|e<<32-r,yr=(t,e,r)=>t<<32-r|e>>>r,Ln=(t,e,r)=>t<<64-r|e>>>r-32,Fn=(t,e,r)=>t>>>r-32|e<<64-r,CE=(t,e)=>e,NE=(t,e)=>t,UE=(t,e,r)=>t<<r|e>>>32-r,kE=(t,e,r)=>e<<r|t>>>32-r,LE=(t,e,r)=>e<<r-32|t>>>64-r,FE=(t,e,r)=>t<<r-32|e>>>64-r;function Et(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const Ya=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Za=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,ME=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),qE=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,jE=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),zE=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,nn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ms(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function _t(t,...e){if(!ms(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function vs(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");rr(t.outputLen),rr(t.blockLen)}function Or(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ja(t,e){_t(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Xn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function yt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function fo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Ot(t,e){return t<<32-e|t>>>e}const fd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function dd(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Kt=fd?t=>t:t=>dd(t);function VE(t){for(let e=0;e<t.length;e++)t[e]=dd(t[e]);return t}const wr=fd?t=>t:VE,pd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",KE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function dn(t){if(_t(t),pd)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=KE[t[r]];return e}const jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ju(t){if(t>=jt._0&&t<=jt._9)return t-jt._0;if(t>=jt.A&&t<=jt.F)return t-(jt.A-10);if(t>=jt.a&&t<=jt.f)return t-(jt.a-10)}function ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(pd)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Ju(t.charCodeAt(s)),a=Ju(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function gd(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xt(t){return typeof t=="string"&&(t=gd(t)),_t(t),t}function mr(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];_t(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let Es=class{};function fi(t){const e=n=>t().update(xt(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function HE(t){const e=(n,i)=>t(i).update(xt(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function Jr(t=32){if(nn&&typeof nn.getRandomValues=="function")return nn.getRandomValues(new Uint8Array(t));if(nn&&typeof nn.randomBytes=="function")return Uint8Array.from(nn.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const WE=BigInt(0),Pn=BigInt(1),GE=BigInt(2),YE=BigInt(7),ZE=BigInt(256),JE=BigInt(113),yd=[],wd=[],bd=[];for(let t=0,e=Pn,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],yd.push(2*(5*n+r)),wd.push((t+1)*(t+2)/2%64);let i=WE;for(let s=0;s<7;s++)e=(e<<Pn^(e>>YE)*JE)%ZE,e&GE&&(i^=Pn<<(Pn<<BigInt(s))-Pn);bd.push(i)}const md=hd(bd,!0),XE=md[0],QE=md[1],Xu=(t,e,r)=>r>32?LE(t,e,r):UE(t,e,r),Qu=(t,e,r)=>r>32?FE(t,e,r):kE(t,e,r);function ex(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=Xu(u,l,1)^r[a],f=Qu(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=wd[o],c=Xu(i,s,a),u=Qu(i,s,a),l=yd[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=XE[n],t[1]^=QE[n]}yt(r)}let tx=class vd extends Es{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,rr(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Xn(this.state)}clone(){return this._cloneInto()}keccak(){wr(this.state32),ex(this.state32,this.rounds),wr(this.state32),this.posOut=0,this.pos=0}update(e){Or(this),e=xt(e),_t(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Or(this,!1),_t(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return rr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ja(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,yt(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new vd(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const rx=(t,e,r)=>fi(()=>new tx(e,t,r)),nx=rx(1,136,256/8);function ix(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function sx(t,e,r){return t&e^~t&r}function ox(t,e,r){return t&e^t&r^e&r}let Ed=class extends Es{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=fo(this.buffer)}update(e){Or(this),e=xt(e),_t(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=fo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Or(this),Ja(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,yt(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;ix(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=fo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const cr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ne=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ue=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ax=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ur=new Uint32Array(64);class cx extends Ed{constructor(e=32){super(64,e,8,!1),this.A=cr[0]|0,this.B=cr[1]|0,this.C=cr[2]|0,this.D=cr[3]|0,this.E=cr[4]|0,this.F=cr[5]|0,this.G=cr[6]|0,this.H=cr[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ur[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=ur[h-15],p=ur[h-2],d=Ot(f,7)^Ot(f,18)^f>>>3,g=Ot(p,17)^Ot(p,19)^p>>>10;ur[h]=g+ur[h-7]+d+ur[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=Ot(a,6)^Ot(a,11)^Ot(a,25),p=l+f+sx(a,c,u)+ax[h]+ur[h]|0,d=(Ot(n,2)^Ot(n,13)^Ot(n,22))+ox(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+d|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){yt(ur)}destroy(){this.set(0,0,0,0,0,0,0,0),yt(this.buffer)}}const xd=hd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ux=xd[0],lx=xd[1],lr=new Uint32Array(80),hr=new Uint32Array(80);let Xa=class extends Ed{constructor(e=64){super(128,e,16,!1),this.Ah=Ue[0]|0,this.Al=Ue[1]|0,this.Bh=Ue[2]|0,this.Bl=Ue[3]|0,this.Ch=Ue[4]|0,this.Cl=Ue[5]|0,this.Dh=Ue[6]|0,this.Dl=Ue[7]|0,this.Eh=Ue[8]|0,this.El=Ue[9]|0,this.Fh=Ue[10]|0,this.Fl=Ue[11]|0,this.Gh=Ue[12]|0,this.Gl=Ue[13]|0,this.Hh=Ue[14]|0,this.Hl=Ue[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,r){for(let b=0;b<16;b++,r+=4)lr[b]=e.getUint32(r),hr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const w=lr[b-15]|0,v=hr[b-15]|0,_=gr(w,v,1)^gr(w,v,8)^Yu(w,v,7),A=yr(w,v,1)^yr(w,v,8)^Zu(w,v,7),B=lr[b-2]|0,$=hr[b-2]|0,N=gr(B,$,19)^Ln(B,$,61)^Yu(B,$,6),U=yr(B,$,19)^Fn(B,$,61)^Zu(B,$,6),C=ME(A,U,hr[b-7],hr[b-16]),D=qE(C,_,N,lr[b-7],lr[b-16]);lr[b]=D|0,hr[b]=C|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:x,Hl:I}=this;for(let b=0;b<80;b++){const w=gr(h,f,14)^gr(h,f,18)^Ln(h,f,41),v=yr(h,f,14)^yr(h,f,18)^Fn(h,f,41),_=h&p^~h&g,A=f&d^~f&y,B=jE(I,v,A,lx[b],hr[b]),$=zE(B,x,w,_,ux[b],lr[b]),N=B|0,U=gr(n,i,28)^Ln(n,i,34)^Ln(n,i,39),C=yr(n,i,28)^Fn(n,i,34)^Fn(n,i,39),D=n&s^n&a^s&a,T=i&o^i&c^o&c;x=g|0,I=y|0,g=p|0,y=d|0,p=h|0,d=f|0,{h,l:f}=Et(u|0,l|0,$|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const E=Ya(N,C,T);n=Za(E,$,U,D),i=E|0}({h:n,l:i}=Et(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Et(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Et(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Et(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=Et(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Et(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=Et(this.Gh|0,this.Gl|0,g|0,y|0),{h:x,l:I}=Et(this.Hh|0,this.Hl|0,x|0,I|0),this.set(n,i,s,o,a,c,u,l,h,f,p,d,g,y,x,I)}roundClean(){yt(lr,hr)}destroy(){yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class hx extends Xa{constructor(){super(48),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}}const ke=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class fx extends Xa{constructor(){super(32),this.Ah=ke[0]|0,this.Al=ke[1]|0,this.Bh=ke[2]|0,this.Bl=ke[3]|0,this.Ch=ke[4]|0,this.Cl=ke[5]|0,this.Dh=ke[6]|0,this.Dl=ke[7]|0,this.Eh=ke[8]|0,this.El=ke[9]|0,this.Fh=ke[10]|0,this.Fl=ke[11]|0,this.Gh=ke[12]|0,this.Gl=ke[13]|0,this.Hh=ke[14]|0,this.Hl=ke[15]|0}}const xs=fi(()=>new cx),dx=fi(()=>new Xa),px=fi(()=>new hx),gx=fi(()=>new fx),yx=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),be=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),V=new Uint32Array(32);function fr(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*n],g=V[2*n+1],y=Ya(c,l,o);u=Za(y,u,h,a),c=y|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:CE(g,d),Dl:NE(g)},{h:p,l:f}=Et(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:gr(h,l,24),Bl:yr(h,l,24)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*n]=d,V[2*n+1]=g}function dr(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=V[2*t],u=V[2*t+1],l=V[2*e],h=V[2*e+1],f=V[2*r],p=V[2*r+1],d=V[2*n],g=V[2*n+1],y=Ya(c,l,o);u=Za(y,u,h,a),c=y|0,{Dh:g,Dl:d}={Dh:g^u,Dl:d^c},{Dh:g,Dl:d}={Dh:gr(g,d,16),Dl:yr(g,d,16)},{h:p,l:f}=Et(p,f,g,d),{Bh:h,Bl:l}={Bh:h^p,Bl:l^f},{Bh:h,Bl:l}={Bh:Ln(h,l,63),Bl:Fn(h,l,63)},V[2*t]=c,V[2*t+1]=u,V[2*e]=l,V[2*e+1]=h,V[2*r]=f,V[2*r+1]=p,V[2*n]=d,V[2*n+1]=g}function wx(t,e={},r,n,i){if(rr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class bx extends Es{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,rr(e),rr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Xn(this.buffer)}update(e){Or(this),e=xt(e),_t(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(wr(i),this.compress(i,0,!1),wr(i),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));wr(h);for(let f=0;c+r<s;f+=i.length,c+=r)this.length+=r,this.compress(h,f,!1);wr(h);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Or(this),Ja(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,yt(this.buffer.subarray(r)),wr(n),this.compress(n,0,!0),wr(n);const i=Xn(e);this.get().forEach((s,o)=>i[o]=Kt(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class mx extends bx{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=be[0]|0,this.v0h=be[1]|0,this.v1l=be[2]|0,this.v1h=be[3]|0,this.v2l=be[4]|0,this.v2h=be[5]|0,this.v3l=be[6]|0,this.v3h=be[7]|0,this.v4l=be[8]|0,this.v4h=be[9]|0,this.v5l=be[10]|0,this.v5h=be[11]|0,this.v6l=be[12]|0,this.v6h=be[13]|0,this.v7l=be[14]|0,this.v7h=be[15]|0,wx(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=xt(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=xt(s);const a=Xn(s);this.v4l^=Kt(a[0]),this.v4h^=Kt(a[1]),this.v5l^=Kt(a[2]),this.v5h^=Kt(a[3])}if(i!==void 0){i=xt(i);const a=Xn(i);this.v6l^=Kt(a[0]),this.v6h^=Kt(a[1]),this.v7l^=Kt(a[2]),this.v7h^=Kt(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:y}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y]}set(e,r,n,i,s,o,a,c,u,l,h,f,p,d,g,y){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=y|0}compress(e,r,n){this.get().forEach((c,u)=>V[u]=c),V.set(be,16);let{h:i,l:s}=ld(BigInt(this.length));V[24]=be[8]^s,V[25]=be[9]^i,n&&(V[28]=~V[28],V[29]=~V[29]);let o=0;const a=yx;for(let c=0;c<12;c++)fr(0,4,8,12,e,r+2*a[o++]),dr(0,4,8,12,e,r+2*a[o++]),fr(1,5,9,13,e,r+2*a[o++]),dr(1,5,9,13,e,r+2*a[o++]),fr(2,6,10,14,e,r+2*a[o++]),dr(2,6,10,14,e,r+2*a[o++]),fr(3,7,11,15,e,r+2*a[o++]),dr(3,7,11,15,e,r+2*a[o++]),fr(0,5,10,15,e,r+2*a[o++]),dr(0,5,10,15,e,r+2*a[o++]),fr(1,6,11,12,e,r+2*a[o++]),dr(1,6,11,12,e,r+2*a[o++]),fr(2,7,8,13,e,r+2*a[o++]),dr(2,7,8,13,e,r+2*a[o++]),fr(3,4,9,14,e,r+2*a[o++]),dr(3,4,9,14,e,r+2*a[o++]);this.v0l^=V[0]^V[16],this.v0h^=V[1]^V[17],this.v1l^=V[2]^V[18],this.v1h^=V[3]^V[19],this.v2l^=V[4]^V[20],this.v2h^=V[5]^V[21],this.v3l^=V[6]^V[22],this.v3h^=V[7]^V[23],this.v4l^=V[8]^V[24],this.v4h^=V[9]^V[25],this.v5l^=V[10]^V[26],this.v5h^=V[11]^V[27],this.v6l^=V[12]^V[28],this.v6h^=V[13]^V[29],this.v7l^=V[14]^V[30],this.v7h^=V[15]^V[31],yt(V)}destroy(){this.destroyed=!0,yt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const vx=HE(t=>new mx(t)),Ex="https://rpc.walletconnect.org/v1";function _d(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(nx(r)).toString("hex")}async function xx(t,e,r,n,i,s){switch(r.t){case"eip191":return await _x(t,e,r.s);case"eip1271":return await Ix(t,e,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function _x(t,e,r){const n=hv(r);return Ev({payload:_d(e),signature:n}).toLowerCase()===t.toLowerCase()}async function Ix(t,e,r,n,i,s){const o=Li(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:_d(e)).substring(2),f=a+h+c+l+u,p=await fetch(`${s||Ex}/?chainId=${n}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Sx(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Sx(){return Date.now()+Math.floor(Math.random()*1e3)}function Dx(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(r.length<i)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return ui.encode(s)}function Ox(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),n=new Uint8Array(r.length+e.length);n.set(r),n.set(e,r.length);const i=vx(n,{dkLen:32});return ui.encode(i)}function el(t){const e=new Uint8Array(xs(Ax(t)));return ui.encode(e)}function Ax(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function tl(t){const e=Buffer.from(t,"base64"),r=i2(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const n=Yv(r),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(n)]),o=gx(s);return mv.encode(o).replace(/=+$/,"")}function po(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function $x(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(po(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(po(r.length)),i.push(r),i.push(Buffer.from([26])),i.push(po(n.length)),i.push(n);const s=Buffer.concat(i),o=xs(s);return Buffer.from(o).toString("hex").toUpperCase()}function Bx(t){var e,r;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const i=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;i&&n.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return n}var Px=Object.defineProperty,Tx=Object.defineProperties,Rx=Object.getOwnPropertyDescriptors,rl=Object.getOwnPropertySymbols,Cx=Object.prototype.hasOwnProperty,Nx=Object.prototype.propertyIsEnumerable,nl=(t,e,r)=>e in t?Px(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ux=(t,e)=>{for(var r in e||(e={}))Cx.call(e,r)&&nl(t,r,e[r]);if(rl)for(var r of rl(e))Nx.call(e,r)&&nl(t,r,e[r]);return t},kx=(t,e)=>Tx(t,Rx(e));const Id="did:pkh:",Lx={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},Fx=t=>t?Lx[t]||t:"",_s=t=>t==null?void 0:t.split(":"),Mx=t=>{const e=t&&_s(t);if(e)return t.includes(Id)?e[3]:e[1]},qx=t=>{const e=t&&_s(t);if(e)return t.includes(Id)?e[2]:e[0]},ta=t=>{const e=t&&_s(t);if(e)return e[2]+":"+e[3]},rs=t=>{const e=t&&_s(t);if(e)return e.pop()};async function il(t){const{cacao:e,projectId:r}=t,{s:n,p:i}=e,s=Sd(i,i.iss),o=rs(i.iss);return await xx(o,s,n,ta(i.iss),r)}const Sd=(t,e)=>{const r=qx(e);if(!r)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${Fx(r)} account:`,i=rs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${Mx(e)}`,u=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(y=>`
- ${y}`).join("")}`:void 0,g=Fi(t.resources);if(g){const y=Qn(g);s=Zx(s,y)}return[n,i,"",s,"",o,a,c,u,l,h,f,p,d].filter(y=>y!=null).join(`
`)};function jx(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function zx(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Hr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function Vx(t,e,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[t]:Kx(e,r,n)}}}function Kx(t,e,r={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const n=e.map(i=>({[`${t}/${i}`]:[r]}));return Object.assign({},...n)}function Dd(t){return Hr(t),`urn:recap:${jx(t).replace(/=/g,"")}`}function Qn(t){const e=zx(t.replace("urn:recap:",""));return Hr(e),e}function Hx(t,e,r){const n=Vx(t,e,r);return Dd(n)}function Wx(t){return t&&t.includes("urn:recap:")}function Gx(t,e){const r=Qn(t),n=Qn(e),i=Yx(r,n);return Dd(i)}function Yx(t,e){Hr(t),Hr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;n.att[i]=kx(Ux({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),n}function Zx(t="",e){Hr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(i++,`(${i}) '${h}': '${u[h].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function sl(t){var e;const r=Qn(t);Hr(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function ol(t){const e=Qn(t);Hr(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function Fi(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return Wx(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Od(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ra(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function go(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ze(t,...e){if(!Od(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function al(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Jx(t,e){Ze(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Sr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function bn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Xx(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Qx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function e3(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function na(t){if(typeof t=="string")t=e3(t);else if(Od(t))t=ia(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function t3(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function r3(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const n3=(t,e)=>{function r(n,...i){if(Ze(n),!Qx)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Ze(u):Ze(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Ze(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Ze(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ze(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Ze(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function cl(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!s3(e))throw new Error("invalid output, must be aligned");return e}function ul(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function i3(t,e,r){ra(r);const n=new Uint8Array(16),i=Xx(n);return ul(i,0,BigInt(e),r),ul(i,8,BigInt(t),r),n}function s3(t){return t.byteOffset%4===0}function ia(t){return Uint8Array.from(t)}const Ad=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),o3=Ad("expand 16-byte k"),a3=Ad("expand 32-byte k"),c3=Sr(o3),u3=Sr(a3);function re(t,e){return t<<e|t>>>32-e}function sa(t){return t.byteOffset%4===0}const Bi=64,l3=16,$d=2**32-1,ll=new Uint32Array;function h3(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(Bi),l=Sr(u),h=sa(i)&&sa(s),f=h?Sr(i):ll,p=h?Sr(s):ll;for(let d=0;d<c;o++){if(t(e,r,n,l,o,a),o>=$d)throw new Error("arx: counter overflow");const g=Math.min(Bi,c-d);if(h&&g===Bi){const y=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let x=0,I;x<l3;x++)I=y+x,p[I]=f[I]^l[x];d+=Bi;continue}for(let y=0,x;y<g;y++)x=d+y,s[x]=i[x]^u[y];d+=g}}function f3(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=t3({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return go(i),go(o),ra(s),ra(r),(a,c,u,l,h=0)=>{Ze(a),Ze(c),Ze(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),Ze(l),go(h),h<0||h>=$d)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,y;if(d===32)p.push(g=ia(a)),y=u3;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),y=c3,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);sa(c)||p.push(c=ia(c));const x=Sr(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(y,x,Sr(c.subarray(0,16)),x),c=c.subarray(16)}const I=16-i;if(I!==c.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const w=new Uint8Array(12);w.set(c,s?0:12-c.length),c=w,p.push(c)}const b=Sr(c);return h3(t,y,x,b,u,l,h,o),bn(...p),l}}const Ae=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class d3{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=na(e),Ze(e,32);const r=Ae(e,0),n=Ae(e,2),i=Ae(e,4),s=Ae(e,6),o=Ae(e,8),a=Ae(e,10),c=Ae(e,12),u=Ae(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Ae(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],y=o[9],x=Ae(e,r+0),I=Ae(e,r+2),b=Ae(e,r+4),w=Ae(e,r+6),v=Ae(e,r+8),_=Ae(e,r+10),A=Ae(e,r+12),B=Ae(e,r+14);let $=s[0]+(x&8191),N=s[1]+((x>>>13|I<<3)&8191),U=s[2]+((I>>>10|b<<6)&8191),C=s[3]+((b>>>7|w<<9)&8191),D=s[4]+((w>>>4|v<<12)&8191),T=s[5]+(v>>>1&8191),E=s[6]+((v>>>14|_<<2)&8191),m=s[7]+((_>>>11|A<<5)&8191),O=s[8]+((A>>>8|B<<8)&8191),R=s[9]+(B>>>5|i),S=0,P=S+$*a+N*(5*y)+U*(5*g)+C*(5*d)+D*(5*p);S=P>>>13,P&=8191,P+=T*(5*f)+E*(5*h)+m*(5*l)+O*(5*u)+R*(5*c),S+=P>>>13,P&=8191;let k=S+$*c+N*a+U*(5*y)+C*(5*g)+D*(5*d);S=k>>>13,k&=8191,k+=T*(5*p)+E*(5*f)+m*(5*h)+O*(5*l)+R*(5*u),S+=k>>>13,k&=8191;let L=S+$*u+N*c+U*a+C*(5*y)+D*(5*g);S=L>>>13,L&=8191,L+=T*(5*d)+E*(5*p)+m*(5*f)+O*(5*h)+R*(5*l),S+=L>>>13,L&=8191;let K=S+$*l+N*u+U*c+C*a+D*(5*y);S=K>>>13,K&=8191,K+=T*(5*g)+E*(5*d)+m*(5*p)+O*(5*f)+R*(5*h),S+=K>>>13,K&=8191;let z=S+$*h+N*l+U*u+C*c+D*a;S=z>>>13,z&=8191,z+=T*(5*y)+E*(5*g)+m*(5*d)+O*(5*p)+R*(5*f),S+=z>>>13,z&=8191;let j=S+$*f+N*h+U*l+C*u+D*c;S=j>>>13,j&=8191,j+=T*a+E*(5*y)+m*(5*g)+O*(5*d)+R*(5*p),S+=j>>>13,j&=8191;let H=S+$*p+N*f+U*h+C*l+D*u;S=H>>>13,H&=8191,H+=T*c+E*a+m*(5*y)+O*(5*g)+R*(5*d),S+=H>>>13,H&=8191;let G=S+$*d+N*p+U*f+C*h+D*l;S=G>>>13,G&=8191,G+=T*u+E*c+m*a+O*(5*y)+R*(5*g),S+=G>>>13,G&=8191;let J=S+$*g+N*d+U*p+C*f+D*h;S=J>>>13,J&=8191,J+=T*l+E*u+m*c+O*a+R*(5*y),S+=J>>>13,J&=8191;let W=S+$*y+N*g+U*d+C*p+D*f;S=W>>>13,W&=8191,W+=T*h+E*l+m*u+O*c+R*a,S+=W>>>13,W&=8191,S=(S<<2)+S|0,S=S+P|0,P=S&8191,S=S>>>13,k+=S,s[0]=P,s[1]=k,s[2]=L,s[3]=K,s[4]=z,s[5]=j,s[6]=H,s[7]=G,s[8]=J,s[9]=W}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;bn(n)}update(e){al(this),e=na(e),Ze(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){bn(this.h,this.r,this.buffer,this.pad)}digestInto(e){al(this),Jx(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function p3(t){const e=(n,i)=>t(i).update(na(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const g3=p3(t=>new d3(t));function y3(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],y=e[6],x=e[7],I=i,b=r[0],w=r[1],v=r[2],_=o,A=a,B=c,$=u,N=l,U=h,C=f,D=p,T=d,E=g,m=y,O=x,R=I,S=b,P=w,k=v;for(let K=0;K<s;K+=2)_=_+N|0,R=re(R^_,16),T=T+R|0,N=re(N^T,12),_=_+N|0,R=re(R^_,8),T=T+R|0,N=re(N^T,7),A=A+U|0,S=re(S^A,16),E=E+S|0,U=re(U^E,12),A=A+U|0,S=re(S^A,8),E=E+S|0,U=re(U^E,7),B=B+C|0,P=re(P^B,16),m=m+P|0,C=re(C^m,12),B=B+C|0,P=re(P^B,8),m=m+P|0,C=re(C^m,7),$=$+D|0,k=re(k^$,16),O=O+k|0,D=re(D^O,12),$=$+D|0,k=re(k^$,8),O=O+k|0,D=re(D^O,7),_=_+U|0,k=re(k^_,16),m=m+k|0,U=re(U^m,12),_=_+U|0,k=re(k^_,8),m=m+k|0,U=re(U^m,7),A=A+C|0,R=re(R^A,16),O=O+R|0,C=re(C^O,12),A=A+C|0,R=re(R^A,8),O=O+R|0,C=re(C^O,7),B=B+D|0,S=re(S^B,16),T=T+S|0,D=re(D^T,12),B=B+D|0,S=re(S^B,8),T=T+S|0,D=re(D^T,7),$=$+N|0,P=re(P^$,16),E=E+P|0,N=re(N^E,12),$=$+N|0,P=re(P^$,8),E=E+P|0,N=re(N^E,7);let L=0;n[L++]=o+_|0,n[L++]=a+A|0,n[L++]=c+B|0,n[L++]=u+$|0,n[L++]=l+N|0,n[L++]=h+U|0,n[L++]=f+C|0,n[L++]=p+D|0,n[L++]=d+T|0,n[L++]=g+E|0,n[L++]=y+m|0,n[L++]=x+O|0,n[L++]=I+R|0,n[L++]=b+S|0,n[L++]=w+P|0,n[L++]=v+k|0}const w3=f3(y3,{counterRight:!1,counterLength:4,allowShortKeys:!1}),b3=new Uint8Array(16),hl=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(b3.subarray(r))},m3=new Uint8Array(32);function fl(t,e,r,n,i){const s=t(e,r,m3),o=g3.create(s);i&&hl(o,i),hl(o,n);const a=i3(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return bn(s,a),c}const v3=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=cl(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=fl(t,e,r,a,n);return s.set(c,o),bn(c),s},decrypt(i,s){s=cl(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=fl(t,e,r,o,n);if(!r3(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),bn(c),s}}),Bd=n3({blockSize:64,nonceLength:12,tagLength:16},v3(w3));let Pd=class extends Es{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,vs(e);const n=xt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),yt(s)}update(e){return Or(this),this.iHash.update(e),this}digestInto(e){Or(this),_t(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Is=(t,e,r)=>new Pd(t,e).update(r).digest();Is.create=(t,e)=>new Pd(t,e);function E3(t,e,r){return vs(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Is(t,xt(r),xt(e))}const yo=Uint8Array.from([0]),dl=Uint8Array.of();function x3(t,e,r,n=32){vs(t),rr(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=dl);const o=new Uint8Array(s*i),a=Is.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)yo[0]=l+1,c.update(l===0?dl:u).update(r).update(yo).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),yt(u,yo),o.slice(0,n)}const _3=(t,e,r,n,i)=>x3(t,E3(t,e,r),n,i),Ss=xs,Qa=BigInt(0),oa=BigInt(1);function ns(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Mr(t,e,r=""){const n=ms(t),i=t==null?void 0:t.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Pi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Td(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Qa:BigInt("0x"+t)}function Ds(t){return Td(dn(t))}function is(t){return _t(t),Td(dn(Uint8Array.from(t).reverse()))}function ec(t,e){return ts(t.toString(16).padStart(e*2,"0"))}function tc(t,e){return ec(t,e).reverse()}function Fe(t,e,r){let n;if(typeof e=="string")try{n=ts(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ms(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const wo=t=>typeof t=="bigint"&&Qa<=t;function I3(t,e,r){return wo(t)&&wo(e)&&wo(r)&&e<=t&&t<r}function aa(t,e,r,n){if(!I3(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Rd(t){let e;for(e=0;t>Qa;t>>=oa,e+=1);return e}const di=t=>(oa<<BigInt(t))-oa;function S3(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>r(o,s,...f),l=(f=n(0))=>{o=u(i(0),f),s=u(),f.length!==0&&(o=u(i(1),f),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=u();const d=s.slice();p.push(d),f+=s.length}return mr(...p)};return(f,p)=>{c(),l(f);let d;for(;!(d=p(h()));)l();return c(),d}}function Os(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function pl(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Qe=BigInt(0),ze=BigInt(1),qr=BigInt(2),Cd=BigInt(3),Nd=BigInt(4),Ud=BigInt(5),D3=BigInt(7),kd=BigInt(8),O3=BigInt(9),Ld=BigInt(16);function st(t,e){const r=t%e;return r>=Qe?r:e+r}function vt(t,e,r){let n=t;for(;e-- >Qe;)n*=n,n%=r;return n}function gl(t,e){if(t===Qe)throw new Error("invert: expected non-zero number");if(e<=Qe)throw new Error("invert: expected positive modulus, got "+e);let r=st(t,e),n=e,i=Qe,s=ze;for(;r!==Qe;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==ze)throw new Error("invert: does not exist");return st(i,e)}function rc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Fd(t,e){const r=(t.ORDER+ze)/Nd,n=t.pow(e,r);return rc(t,n,e),n}function A3(t,e){const r=(t.ORDER-Ud)/kd,n=t.mul(e,qr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,qr),i),a=t.mul(s,t.sub(o,t.ONE));return rc(t,a,e),a}function $3(t){const e=$r(t),r=Md(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+D3)/Ld;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n);const h=a.mul(u,i),f=a.mul(u,s),p=a.eql(a.sqr(l),c),d=a.eql(a.sqr(h),c);u=a.cmov(u,l,p),l=a.cmov(f,h,d);const g=a.eql(a.sqr(l),c),y=a.cmov(u,l,g);return rc(a,y,c),y}}function Md(t){if(t<Cd)throw new Error("sqrt is not defined for small field");let e=t-ze,r=0;for(;e%qr===Qe;)e/=qr,r++;let n=qr;const i=$r(t);for(;yl(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Fd;let s=i.pow(n,e);const o=(e+ze)/qr;return function(a,c){if(a.is0(c))return c;if(yl(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===u)throw new Error("Cannot find square root");const g=ze<<BigInt(u-p-1),y=a.pow(l,g);u=p,l=a.sqr(y),h=a.mul(h,l),f=a.mul(f,y)}return f}}function B3(t){return t%Nd===Cd?Fd:t%kd===Ud?A3:t%Ld===O3?$3(t):Md(t)}const P3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function T3(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=P3.reduce((n,i)=>(n[i]="function",n),e);return Os(t,r),t}function R3(t,e,r){if(r<Qe)throw new Error("invalid exponent, negatives unsupported");if(r===Qe)return t.ONE;if(r===ze)return e;let n=t.ONE,i=e;for(;r>Qe;)r&ze&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ze;return n}function qd(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function yl(t,e){const r=(t.ORDER-ze)/qr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function jd(t,e){e!==void 0&&rr(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function $r(t,e,r=!1,n={}){if(t<=Qe)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(i=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=jd(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:di(c),ZERO:Qe,ONE:ze,allowedLengths:a,create:f=>st(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Qe<=f&&f<t},is0:f=>f===Qe,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&ze)===ze,neg:f=>st(-f,t),eql:(f,p)=>f===p,sqr:f=>st(f*f,t),add:(f,p)=>st(f+p,t),sub:(f,p)=>st(f-p,t),mul:(f,p)=>st(f*p,t),pow:(f,p)=>R3(h,f,p),div:(f,p)=>st(f*gl(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>gl(f,t),sqrt:s||(f=>(l||(l=B3(t)),l(h,f))),toBytes:f=>r?tc(f,u):ec(f,u),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(u);g.set(f,r?0:g.length-f.length),f=g}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let d=r?is(f):Ds(f);if(o&&(d=st(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>qd(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function zd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Vd(t){const e=zd(t);return e+Math.ceil(e/2)}function C3(t,e,r=!1){const n=t.length,i=zd(e),s=Vd(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?is(t):Ds(t),a=st(o,e-ze)+ze;return r?tc(a,i):ec(a,i)}const mn=BigInt(0),jr=BigInt(1);function ss(t,e){const r=e.negate();return t?r:e}function bo(t,e){const r=qd(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function Kd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function mo(t,e){Kd(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=di(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function wl(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=jr);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:p,offsetF:u}}function N3(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function U3(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const vo=new WeakMap,Hd=new WeakMap;function Eo(t){return Hd.get(t)||1}function bl(t){if(t!==mn)throw new Error("invalid wNAF")}class k3{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>mn;)r&jr&&(n=n.add(i)),i=i.double(),r>>=jr;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=mo(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=mo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:p}=wl(n,a,o);n=c,l?s=s.add(ss(f,r[p])):i=i.add(ss(h,r[u]))}return bl(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=mo(e,this.bits);for(let o=0;o<s.windows&&n!==mn;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=wl(n,o,s);if(n=a,!u){const h=r[c];i=i.add(l?h.negate():h)}}return bl(n),i}getPrecomputes(e,r,n){let i=vo.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),vo.set(r,i))),i}cached(e,r,n){const i=Eo(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Eo(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){Kd(r,this.bits),Hd.set(e,r),vo.delete(e)}hasCache(e){return Eo(e)!==1}}function L3(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>mn||n>mn;)r&jr&&(s=s.add(i)),n&jr&&(o=o.add(i)),i=i.double(),r>>=jr,n>>=jr;return{p1:s,p2:o}}function F3(t,e,r,n){N3(r,t),U3(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Rd(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=di(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<s;g++){const y=n[g],x=Number(y>>BigInt(p)&u);l[x]=l[x].add(r[g])}let d=o;for(let g=l.length-1,y=o;g>0;g--)y=y.add(l[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function ml(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return T3(e),e}else return $r(t,{isLE:r})}function M3(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>mn))throw new Error(`CURVE.${a} must be positive bigint`)}const i=ml(e.p,r.Fp,n),s=ml(e.n,r.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),gd("HashToScalar-");const Tn=BigInt(0),sn=BigInt(1),Ti=BigInt(2);function q3(t){return Os(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function j3(t){const e=q3(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Jr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?Ti**BigInt(254):Ti**BigInt(447),d=a?BigInt(8)*Ti**BigInt(251)-sn:BigInt(4)*Ti**BigInt(445)-sn,g=p+d+sn,y=C=>st(C,r),x=I(h);function I(C){return tc(y(C),l)}function b(C){const D=Fe("u coordinate",C,l);return a&&(D[31]&=127),y(is(D))}function w(C){return is(i(Fe("scalar",C,l)))}function v(C,D){const T=B(b(D),w(C));if(T===Tn)throw new Error("invalid private or public key received");return I(T)}function _(C){return v(C,x)}function A(C,D,T){const E=y(C*(D-T));return D=y(D-E),T=y(T+E),{x_2:D,x_3:T}}function B(C,D){aa("u",C,Tn,r),aa("scalar",D,p,g);const T=D,E=C;let m=sn,O=Tn,R=C,S=sn,P=Tn;for(let L=BigInt(u-1);L>=Tn;L--){const K=T>>L&sn;P^=K,{x_2:m,x_3:R}=A(P,m,R),{x_2:O,x_3:S}=A(P,O,S),P=K;const z=m+O,j=y(z*z),H=m-O,G=y(H*H),J=j-G,W=R+S,X=R-S,he=y(X*z),we=y(W*H),Ee=he+we,qe=he-we;R=y(Ee*Ee),S=y(E*y(qe*qe)),m=y(j*G),O=y(J*(j+y(f*J)))}({x_2:m,x_3:R}=A(P,m,R)),{x_2:O,x_3:S}=A(P,O,S);const k=s(O);return y(m*k)}const $={secretKey:l,publicKey:l,seed:l},N=(C=c(l))=>(_t(C,$.seed),C);function U(C){const D=N(C);return{secretKey:D,publicKey:_(D)}}return{keygen:U,getSharedSecret:(C,D)=>v(C,D),getPublicKey:C=>_(C),scalarMult:v,scalarMultBase:_,utils:{randomSecretKey:N,randomPrivateKey:N},GuBytes:x.slice(),lengths:$}}const z3=BigInt(1),vl=BigInt(2),V3=BigInt(3),K3=BigInt(5);BigInt(8);const Wd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),H3={p:Wd,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function W3(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Wd,o=t*t%s*t%s,a=vt(o,vl,s)*o%s,c=vt(a,z3,s)*t%s,u=vt(c,K3,s)*c%s,l=vt(u,e,s)*u%s,h=vt(l,r,s)*l%s,f=vt(h,n,s)*h%s,p=vt(f,i,s)*f%s,d=vt(p,i,s)*f%s,g=vt(d,e,s)*u%s;return{pow_p_5_8:vt(g,vl,s)*t%s,b2:o}}function G3(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Y3=$r(H3.p,{isLE:!0}),ca=(()=>{const t=Y3.ORDER;return j3({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=W3(e);return st(vt(r,V3,t)*n,t)},adjustScalarBytes:G3})})(),El=(t,e)=>(t+(t>=0?e:-e)/Gd)/e;function Z3(t,e,r){const[[n,i],[s,o]]=e,a=El(o*t,r),c=El(-i*t,r);let u=t-a*n-c*s,l=-a*i-c*o;const h=u<Xt,f=l<Xt;h&&(u=-u),f&&(l=-l);const p=di(Math.ceil(Rd(r)/2))+pn;if(u<Xt||u>=p||l<Xt||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function ua(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function xo(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return ns(r.lowS,"lowS"),ns(r.prehash,"prehash"),r.format!==void 0&&ua(r.format),r}class J3 extends Error{constructor(e=""){super(e)}}const Yt={Err:J3,_tlv:{encode:(t,e)=>{const{Err:r}=Yt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Pi(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Pi(i.length/2|128):"";return Pi(t)+s+i+e},decode(t,e){const{Err:r}=Yt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Yt;if(t<Xt)throw new e("integer: negative integers are not allowed");let r=Pi(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Yt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ds(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Yt,i=Fe("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Yt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Xt=BigInt(0),pn=BigInt(1),Gd=BigInt(2),Ri=BigInt(3),X3=BigInt(4);function un(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=Fe("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Q3(t,e={}){const r=M3("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Os(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Zd(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(C,D,T){const{x:E,y:m}=D.toAffine(),O=n.toBytes(E);if(ns(T,"isCompressed"),T){l();const R=!n.isOdd(m);return mr(Yd(R),O)}else return mr(Uint8Array.of(4),O,n.toBytes(m))}function f(C){Mr(C,void 0,"Point");const{publicKey:D,publicKeyUncompressed:T}=u,E=C.length,m=C[0],O=C.subarray(1);if(E===D&&(m===2||m===3)){const R=n.fromBytes(O);if(!n.isValid(R))throw new Error("bad point: is not on curve, wrong x");const S=g(R);let P;try{P=n.sqrt(S)}catch(L){const K=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}l();const k=n.isOdd(P);return(m&1)===1!==k&&(P=n.neg(P)),{x:R,y:P}}else if(E===T&&m===4){const R=n.BYTES,S=n.fromBytes(O.subarray(0,R)),P=n.fromBytes(O.subarray(R,R*2));if(!y(S,P))throw new Error("bad point: is not on curve");return{x:S,y:P}}else throw new Error(`bad point: got length ${E}, expected compressed=${D} or uncompressed=${T}`)}const p=e.toBytes||h,d=e.fromBytes||f;function g(C){const D=n.sqr(C),T=n.mul(D,C);return n.add(n.add(T,n.mul(C,s.a)),s.b)}function y(C,D){const T=n.sqr(D),E=g(C);return n.eql(T,E)}if(!y(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const x=n.mul(n.pow(s.a,Ri),X3),I=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(x,I)))throw new Error("bad curve params: a or b");function b(C,D,T=!1){if(!n.isValid(D)||T&&n.is0(D))throw new Error(`bad point coordinate ${C}`);return D}function w(C){if(!(C instanceof $))throw new Error("ProjectivePoint expected")}function v(C){if(!c||!c.basises)throw new Error("no endo");return Z3(C,c.basises,i.ORDER)}const _=pl((C,D)=>{const{X:T,Y:E,Z:m}=C;if(n.eql(m,n.ONE))return{x:T,y:E};const O=C.is0();D==null&&(D=O?n.ONE:n.inv(m));const R=n.mul(T,D),S=n.mul(E,D),P=n.mul(m,D);if(O)return{x:n.ZERO,y:n.ZERO};if(!n.eql(P,n.ONE))throw new Error("invZ was invalid");return{x:R,y:S}}),A=pl(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}const{x:D,y:T}=C.toAffine();if(!n.isValid(D)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!y(D,T))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function B(C,D,T,E,m){return T=new $(n.mul(T.X,C),T.Y,T.Z),D=ss(E,D),T=ss(m,T),D.add(T)}class ${constructor(D,T,E){this.X=b("x",D),this.Y=b("y",T,!0),this.Z=b("z",E),Object.freeze(this)}static CURVE(){return s}static fromAffine(D){const{x:T,y:E}=D||{};if(!D||!n.isValid(T)||!n.isValid(E))throw new Error("invalid affine point");if(D instanceof $)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(E)?$.ZERO:new $(T,E,n.ONE)}static fromBytes(D){const T=$.fromAffine(d(Mr(D,void 0,"point")));return T.assertValidity(),T}static fromHex(D){return $.fromBytes(Fe("pointHex",D))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,T=!0){return U.createCache(this,D),T||this.multiply(Ri),this}assertValidity(){A(this)}hasEvenY(){const{y:D}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(D)}equals(D){w(D);const{X:T,Y:E,Z:m}=this,{X:O,Y:R,Z:S}=D,P=n.eql(n.mul(T,S),n.mul(O,m)),k=n.eql(n.mul(E,S),n.mul(R,m));return P&&k}negate(){return new $(this.X,n.neg(this.Y),this.Z)}double(){const{a:D,b:T}=s,E=n.mul(T,Ri),{X:m,Y:O,Z:R}=this;let S=n.ZERO,P=n.ZERO,k=n.ZERO,L=n.mul(m,m),K=n.mul(O,O),z=n.mul(R,R),j=n.mul(m,O);return j=n.add(j,j),k=n.mul(m,R),k=n.add(k,k),S=n.mul(D,k),P=n.mul(E,z),P=n.add(S,P),S=n.sub(K,P),P=n.add(K,P),P=n.mul(S,P),S=n.mul(j,S),k=n.mul(E,k),z=n.mul(D,z),j=n.sub(L,z),j=n.mul(D,j),j=n.add(j,k),k=n.add(L,L),L=n.add(k,L),L=n.add(L,z),L=n.mul(L,j),P=n.add(P,L),z=n.mul(O,R),z=n.add(z,z),L=n.mul(z,j),S=n.sub(S,L),k=n.mul(z,K),k=n.add(k,k),k=n.add(k,k),new $(S,P,k)}add(D){w(D);const{X:T,Y:E,Z:m}=this,{X:O,Y:R,Z:S}=D;let P=n.ZERO,k=n.ZERO,L=n.ZERO;const K=s.a,z=n.mul(s.b,Ri);let j=n.mul(T,O),H=n.mul(E,R),G=n.mul(m,S),J=n.add(T,E),W=n.add(O,R);J=n.mul(J,W),W=n.add(j,H),J=n.sub(J,W),W=n.add(T,m);let X=n.add(O,S);return W=n.mul(W,X),X=n.add(j,G),W=n.sub(W,X),X=n.add(E,m),P=n.add(R,S),X=n.mul(X,P),P=n.add(H,G),X=n.sub(X,P),L=n.mul(K,W),P=n.mul(z,G),L=n.add(P,L),P=n.sub(H,L),L=n.add(H,L),k=n.mul(P,L),H=n.add(j,j),H=n.add(H,j),G=n.mul(K,G),W=n.mul(z,W),H=n.add(H,G),G=n.sub(j,G),G=n.mul(K,G),W=n.add(W,G),j=n.mul(H,W),k=n.add(k,j),j=n.mul(X,W),P=n.mul(J,P),P=n.sub(P,j),j=n.mul(J,H),L=n.mul(X,L),L=n.add(L,j),new $(P,k,L)}subtract(D){return this.add(D.negate())}is0(){return this.equals($.ZERO)}multiply(D){const{endo:T}=e;if(!i.isValidNot0(D))throw new Error("invalid scalar: out of range");let E,m;const O=R=>U.cached(this,R,S=>bo($,S));if(T){const{k1neg:R,k1:S,k2neg:P,k2:k}=v(D),{p:L,f:K}=O(S),{p:z,f:j}=O(k);m=K.add(j),E=B(T.beta,L,z,R,P)}else{const{p:R,f:S}=O(D);E=R,m=S}return bo($,[E,m])[0]}multiplyUnsafe(D){const{endo:T}=e,E=this;if(!i.isValid(D))throw new Error("invalid scalar: out of range");if(D===Xt||E.is0())return $.ZERO;if(D===pn)return E;if(U.hasCache(this))return this.multiply(D);if(T){const{k1neg:m,k1:O,k2neg:R,k2:S}=v(D),{p1:P,p2:k}=L3($,E,O,S);return B(T.beta,P,k,m,R)}else return U.unsafe(E,D)}multiplyAndAddUnsafe(D,T,E){const m=this.multiplyUnsafe(T).add(D.multiplyUnsafe(E));return m.is0()?void 0:m}toAffine(D){return _(this,D)}isTorsionFree(){const{isTorsionFree:D}=e;return o===pn?!0:D?D($,this):U.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:D}=e;return o===pn?this:D?D($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(D=!0){return ns(D,"isCompressed"),this.assertValidity(),p($,this,D)}toHex(D=!0){return dn(this.toBytes(D))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(D=!0){return this.toBytes(D)}_setWindowSize(D){this.precompute(D)}static normalizeZ(D){return bo($,D)}static msm(D,T){return F3($,i,D,T)}static fromPrivateKey(D){return $.BASE.multiply(un(i,D))}}$.BASE=new $(s.Gx,s.Gy,n.ONE),$.ZERO=new $(n.ZERO,n.ONE,n.ZERO),$.Fp=n,$.Fn=i;const N=i.BITS,U=new k3($,e.endo?Math.ceil(N/2):N);return $.BASE.precompute(8),$}function Yd(t){return Uint8Array.of(t?2:3)}function Zd(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function e_(t,e={}){const{Fn:r}=t,n=e.randomBytes||Jr,i=Object.assign(Zd(t.Fp,r),{seed:Vd(r.ORDER)});function s(f){try{return!!un(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:g}=i;try{const y=f.length;return p===!0&&y!==d||p===!1&&y!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=n(i.seed)){return C3(Mr(f,i.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(un(r,f)).toBytes(p)}function u(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=i;if(r.allowedLengths||p===d)return;const y=Fe("key",f).length;return y===d||y===g}function h(f,p,d=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");const g=un(r,f);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>un(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:i})}function t_(t,e,r={}){vs(e),Os(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||Jr,i=r.hmac||((T,...E)=>Is(e,T,mr(...E))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:p}=e_(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function y(T){const E=a>>pn;return T>E}function x(T,E){if(!o.isValidNot0(E))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return E}function I(T,E){ua(E);const m=p.signature,O=E==="compact"?m:E==="recovered"?m+1:void 0;return Mr(T,O,`${E} signature`)}class b{constructor(E,m,O){this.r=x("r",E),this.s=x("s",m),O!=null&&(this.recovery=O),Object.freeze(this)}static fromBytes(E,m=g){I(E,m);let O;if(m==="der"){const{r:k,s:L}=Yt.toSig(Mr(E));return new b(k,L)}m==="recovered"&&(O=E[0],m="compact",E=E.subarray(1));const R=o.BYTES,S=E.subarray(0,R),P=E.subarray(R,R*2);return new b(o.fromBytes(S),o.fromBytes(P),O)}static fromHex(E,m){return this.fromBytes(ts(E),m)}addRecoveryBit(E){return new b(this.r,this.s,E)}recoverPublicKey(E){const m=s.ORDER,{r:O,s:R,recovery:S}=this;if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");if(a*Gd<m&&S>1)throw new Error("recovery id is ambiguous for h>1 curve");const P=S===2||S===3?O+a:O;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");const k=s.toBytes(P),L=t.fromBytes(mr(Yd((S&1)===0),k)),K=o.inv(P),z=v(Fe("msgHash",E)),j=o.create(-z*K),H=o.create(R*K),G=t.BASE.multiplyUnsafe(j).add(L.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return y(this.s)}toBytes(E=g){if(ua(E),E==="der")return ts(Yt.hexFromSig(this));const m=o.toBytes(this.r),O=o.toBytes(this.s);if(E==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return mr(Uint8Array.of(this.recovery),m,O)}return mr(m,O)}toHex(E){return dn(this.toBytes(E))}assertValidity(){}static fromCompact(E){return b.fromBytes(Fe("sig",E),"compact")}static fromDER(E){return b.fromBytes(Fe("sig",E),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return dn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return dn(this.toBytes("compact"))}}const w=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const E=Ds(T),m=T.length*8-c;return m>0?E>>BigInt(m):E},v=r.bits2int_modN||function(T){return o.create(w(T))},_=di(c);function A(T){return aa("num < 2^"+c,T,Xt,_),o.toBytes(T)}function B(T,E){return Mr(T,void 0,"message"),E?Mr(e(T),void 0,"prehashed message"):T}function $(T,E,m){if(["recovered","canonical"].some(H=>H in m))throw new Error("sign() legacy options not supported");const{lowS:O,prehash:R,extraEntropy:S}=xo(m,d);T=B(T,R);const P=v(T),k=un(o,E),L=[A(k),A(P)];if(S!=null&&S!==!1){const H=S===!0?n(p.secretKey):S;L.push(Fe("extraEntropy",H))}const K=mr(...L),z=P;function j(H){const G=w(H);if(!o.isValidNot0(G))return;const J=o.inv(G),W=t.BASE.multiply(G).toAffine(),X=o.create(W.x);if(X===Xt)return;const he=o.create(J*o.create(z+X*k));if(he===Xt)return;let we=(W.x===X?0:2)|Number(W.y&pn),Ee=he;return O&&y(he)&&(Ee=o.neg(he),we^=1),new b(X,Ee,we)}return{seed:K,k2sig:j}}function N(T,E,m={}){T=Fe("message",T);const{seed:O,k2sig:R}=$(T,E,m);return S3(e.outputLen,o.BYTES,i)(O,R)}function U(T){let E;const m=typeof T=="string"||ms(T),O=!m&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!m&&!O)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(O)E=new b(T.r,T.s);else if(m){try{E=b.fromBytes(Fe("sig",T),"der")}catch(R){if(!(R instanceof Yt.Err))throw R}if(!E)try{E=b.fromBytes(Fe("sig",T),"compact")}catch{return!1}}return E||!1}function C(T,E,m,O={}){const{lowS:R,prehash:S,format:P}=xo(O,d);if(m=Fe("publicKey",m),E=B(Fe("message",E),S),"strict"in O)throw new Error("options.strict was renamed to lowS");const k=P===void 0?U(T):b.fromBytes(Fe("sig",T),P);if(k===!1)return!1;try{const L=t.fromBytes(m);if(R&&k.hasHighS())return!1;const{r:K,s:z}=k,j=v(E),H=o.inv(z),G=o.create(j*H),J=o.create(K*H),W=t.BASE.multiplyUnsafe(G).add(L.multiplyUnsafe(J));return W.is0()?!1:o.create(W.x)===K}catch{return!1}}function D(T,E,m={}){const{prehash:O}=xo(m,d);return E=B(E,O),b.fromBytes(T,"recovered").recoverPublicKey(E).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:N,verify:C,recoverPublicKey:D,Signature:b,hash:e})}function r_(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=$r(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function n_(t){const{CURVE:e,curveOpts:r}=r_(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function i_(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,jd(r.Fn.ORDER,r.Fn.BITS))})}function s_(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=n_(t),s=Q3(e,r),o=t_(s,n,i);return i_(t,o)}function la(t,e){const r=n=>s_({...t,hash:n});return{...r(e),create:r}}const Jd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Xd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Qd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},o_=$r(Jd.p),a_=$r(Xd.p),c_=$r(Qd.p),u_=la({...Jd,Fp:o_,lowS:!1},xs);la({...Xd,Fp:a_,lowS:!1},px),la({...Qd,Fp:c_,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},dx);const l_=u_,ep="base10",Ve="base16",Je="base64pad",vr="base64url",pi="utf8",tp=0,er=1,gi=2,h_=0,xl=1,zn=12,nc=32;function f_(){const t=ca.utils.randomPrivateKey(),e=ca.getPublicKey(t);return{privateKey:et(t,Ve),publicKey:et(e,Ve)}}function ha(){const t=Jr(nc);return et(t,Ve)}function d_(t,e){const r=ca.getSharedSecret(gt(t,Ve),gt(e,Ve)),n=_3(Ss,r,void 0,void 0,nc);return et(n,Ve)}function Mi(t){const e=Ss(gt(t,Ve));return et(e,Ve)}function dt(t){const e=Ss(gt(t,pi));return et(e,Ve)}function rp(t){return gt(`${t}`,ep)}function Wr(t){return Number(et(t,ep))}function np(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ip(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function p_(t){const e=rp(typeof t.type<"u"?t.type:tp);if(Wr(e)===er&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?gt(t.senderPublicKey,Ve):void 0,n=typeof t.iv<"u"?gt(t.iv,Ve):Jr(zn),i=gt(t.symKey,Ve),s=Bd(i,n).encrypt(gt(t.message,pi)),o=sp({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===vr?np(o):o}function g_(t){const e=gt(t.symKey,Ve),{sealed:r,iv:n}=ei({encoded:t.encoded,encoding:t.encoding}),i=Bd(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return et(i,pi)}function y_(t,e){const r=rp(gi),n=Jr(zn),i=gt(t,pi),s=sp({type:r,sealed:i,iv:n});return e===vr?np(s):s}function w_(t,e){const{sealed:r}=ei({encoded:t,encoding:e});return et(r,pi)}function sp(t){if(Wr(t.type)===gi)return et(jn([t.type,t.sealed]),Je);if(Wr(t.type)===er){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return et(jn([t.type,t.senderPublicKey,t.iv,t.sealed]),Je)}return et(jn([t.type,t.iv,t.sealed]),Je)}function ei(t){const e=(t.encoding||Je)===vr?ip(t.encoded):t.encoded,r=gt(e,Je),n=r.slice(h_,xl),i=xl;if(Wr(n)===er){const c=i+nc,u=c+zn,l=r.slice(i,c),h=r.slice(c,u),f=r.slice(u);return{type:n,sealed:f,iv:h,senderPublicKey:l}}if(Wr(n)===gi){const c=r.slice(i),u=Jr(zn);return{type:n,sealed:c,iv:u}}const s=i+zn,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function b_(t,e){const r=ei({encoded:t,encoding:e==null?void 0:e.encoding});return op({type:Wr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?et(r.senderPublicKey,Ve):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function op(t){const e=(t==null?void 0:t.type)||tp;if(e===er){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function _l(t){return t.type===er&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Il(t){return t.type===gi}function m_(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return jn([new Uint8Array([4]),e,r])}function v_(t,e){const[r,n,i]=t.split("."),s=Buffer.from(ip(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=Ss(c),l=m_(e);if(!l_.verify(jn([o,a]),u,l))throw new Error("Invalid signature");return Vo(t).payload}const E_="irn";function os(t){return(t==null?void 0:t.relay)||{protocol:E_}}function ln(t){const e=tE[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var x_=Object.defineProperty,__=Object.defineProperties,I_=Object.getOwnPropertyDescriptors,Sl=Object.getOwnPropertySymbols,S_=Object.prototype.hasOwnProperty,D_=Object.prototype.propertyIsEnumerable,Dl=(t,e,r)=>e in t?x_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_o=(t,e)=>{for(var r in e||(e={}))S_.call(e,r)&&Dl(t,r,e[r]);if(Sl)for(var r of Sl(e))D_.call(e,r)&&Dl(t,r,e[r]);return t},O_=(t,e)=>__(t,I_(e));function A_(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function Ol(t){if(!t.includes("wc:")){const u=ud(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:$_(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:A_(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function $_(t){return t.startsWith("//")?t.substring(2):t}function B_(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Al(t){const e=new URLSearchParams,r=_o(_o(O_(_o({},B_(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Ci(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var P_=Object.defineProperty,T_=Object.defineProperties,R_=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,C_=Object.prototype.hasOwnProperty,N_=Object.prototype.propertyIsEnumerable,Bl=(t,e,r)=>e in t?P_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,U_=(t,e)=>{for(var r in e||(e={}))C_.call(e,r)&&Bl(t,r,e[r]);if($l)for(var r of $l(e))N_.call(e,r)&&Bl(t,r,e[r]);return t},k_=(t,e)=>T_(t,R_(e));function _n(t){const e=[];return t.forEach(r=>{const[n,i]=r.split(":");e.push(`${n}:${i}`)}),e}function ap(t){const e=[];return Object.values(t).forEach(r=>{e.push(..._n(r.accounts))}),[...new Set(e)]}function L_(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function F_(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function M_(t,e){const r=[];return Object.values(t).forEach(n=>{_n(n.accounts).includes(e)&&r.push(...n.methods)}),r}function q_(t,e){const r=[];return Object.values(t).forEach(n=>{_n(n.accounts).includes(e)&&r.push(...n.events)}),r}function cp(t){return t.includes(":")}function j_(t){return cp(t)?t.split(":")[0]:t}function Pl(t){var e,r,n;const i={};if(!ti(t))return i;for(const[s,o]of Object.entries(t)){const a=cp(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=j_(s);i[l]=k_(U_({},i[l]),{chains:Vr(a,(e=i[l])==null?void 0:e.chains),methods:Vr(c,(r=i[l])==null?void 0:r.methods),events:Vr(u,(n=i[l])==null?void 0:n.events)})}return i}function z_(t){const e={};return t==null||t.forEach(r=>{var n;const[i,s]=r.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(r),(n=e[i].chains)==null||n.push(`${i}:${s}`)}),e}function Tl(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=z_(e);for(const[n,i]of Object.entries(r))i.methods?i.methods=Vr(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return r}function V_(t,e){var r,n,i,s,o,a;const c=Pl(t),u=Pl(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const f of h)l[f]={chains:Vr((r=c[f])==null?void 0:r.chains,(n=u[f])==null?void 0:n.chains),methods:Vr((i=c[f])==null?void 0:i.methods,(s=u[f])==null?void 0:s.methods),events:Vr((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return l}const K_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},H_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(t,e){const{message:r,code:n}=H_[t];return{message:e?`${r} ${e}`:r,code:n}}function fe(t,e){const{message:r,code:n}=K_[t];return{message:e?`${r} ${e}`:r,code:n}}function vn(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function ti(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function De(t){return typeof t>"u"}function ye(t,e){return e&&De(t)?!0:typeof t=="string"&&!!t.trim().length}function ic(t,e){return typeof t=="number"&&!isNaN(t)}function W_(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),i=Object.keys(r);let s=!0;return Fr(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=_n(a),h=r[o];(!Fr(id(o,h),l)||!Fr(h.methods,c)||!Fr(h.events,u))&&(s=!1)}),s):!1}function as(t){return ye(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function G_(t){if(ye(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&as(r)}}return!1}function Y_(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ye(t,!1)){if(e(t))return!0;const r=ud(t);return e(r)}}catch{}return!1}function Z_(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function J_(t){return t==null?void 0:t.topic}function X_(t,e){let r=null;return ye(t==null?void 0:t.publicKey,!1)||(r=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Rl(t){let e=!0;return vn(t)?t.length&&(e=t.every(r=>ye(r,!1))):e=!1,e}function Q_(t,e,r){let n=null;return vn(e)&&e.length?e.forEach(i=>{n||as(i)||(n=fe("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):as(t)||(n=fe("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function e8(t,e,r){let n=null;return Object.entries(t).forEach(([i,s])=>{if(n)return;const o=Q_(i,id(i,s),`${e} ${r}`);o&&(n=o)}),n}function t8(t,e){let r=null;return vn(t)?t.forEach(n=>{r||G_(n)||(r=fe("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=fe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function r8(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=t8(n==null?void 0:n.accounts,`${e} namespace`);i&&(r=i)}),r}function n8(t,e){let r=null;return Rl(t==null?void 0:t.methods)?Rl(t==null?void 0:t.events)||(r=fe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=fe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function up(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=n8(n,`${e}, namespace`);i&&(r=i)}),r}function i8(t,e,r){let n=null;if(t&&ti(t)){const i=up(t,e);i&&(n=i);const s=e8(t,e,r);s&&(n=s)}else n=q("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Io(t,e){let r=null;if(t&&ti(t)){const n=up(t,e);n&&(r=n);const i=r8(t,e);i&&(r=i)}else r=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function lp(t){return ye(t.protocol,!0)}function s8(t,e){let r=!1;return t?t&&vn(t)&&t.length&&t.forEach(n=>{r=lp(n)}):r=!0,r}function o8(t){return typeof t=="number"}function Ge(t){return typeof t<"u"&&typeof t!==null}function a8(t){return!(!t||typeof t!="object"||!t.code||!ic(t.code)||!t.message||!ye(t.message,!1))}function c8(t){return!(De(t)||!ye(t.method,!1))}function u8(t){return!(De(t)||De(t.result)&&De(t.error)||!ic(t.id)||!ye(t.jsonrpc,!1))}function l8(t){return!(De(t)||!ye(t.name,!1))}function Cl(t,e){return!(!as(e)||!ap(t).includes(e))}function h8(t,e,r){return ye(r,!1)?M_(t,e).includes(r):!1}function f8(t,e,r){return ye(r,!1)?q_(t,e).includes(r):!1}function Nl(t,e,r){let n=null;const i=d8(t),s=p8(e),o=Object.keys(i),a=Object.keys(s),c=Ul(Object.keys(t)),u=Ul(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(n=q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Fr(o,a)||(n=q("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const f=_n(e[h].accounts);f.includes(h)||(n=q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{n||(Fr(i[h].methods,s[h].methods)?Fr(i[h].events,s[h].events)||(n=q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function d8(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(i=>{e[i]={methods:t[r].methods,events:t[r].events}})}),e}function Ul(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function p8(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const n=_n(t[r].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[r].accounts.filter(s=>s.includes(`${i}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function g8(t,e){return ic(t)&&t<=e.max&&t>=e.min}function kl(){const t=hi();return new Promise(e=>{switch(t){case ot.browser:e(y8());break;case ot.reactNative:e(w8());break;case ot.node:e(b8());break;default:e(!0)}})}function y8(){return xn()&&(navigator==null?void 0:navigator.onLine)}async function w8(){if(Ar()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function b8(){return!0}function m8(t){switch(hi()){case ot.browser:v8(t);break;case ot.reactNative:E8(t);break}}function v8(t){!Ar()&&xn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function E8(t){Ar()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function x8(){var t;return xn()&&tr.getDocument()?((t=tr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const So={};class Rn{static get(e){return So[e]}static set(e,r){So[e]=r}static delete(e){delete So[e]}}function _8(t){const e=ui.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function I8({publicKey:t,signature:e,payload:r}){var n;const i=fa(r.method),s=128|parseInt(((n=r.version)==null?void 0:n.toString())||"4"),o=O8(r.address),a=r.era==="00"?new Uint8Array([0]):fa(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${D8(r.tip)}`),h=$8(l),f=new Uint8Array([0,...t,o,...e,...a,...u,...h,...i]),p=A8(f.length+1);return new Uint8Array([...p,s,...f])}function S8(t){const e=fa(t),r=sE.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function fa(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function D8(t){return t.startsWith("0x")?t.slice(2):t}function O8(t){const e=ui.decode(t)[0];return e===42?0:e===60?2:1}function A8(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function $8(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function B8(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=_8(t.transaction.address),n=I8({publicKey:r,signature:e,payload:t.transaction}),i=Buffer.from(n).toString("hex");return S8(i)}function hp({logger:t,name:e}){const r=typeof t=="string"?Oh({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}const P8="PARSE_ERROR",T8="INVALID_REQUEST",R8="METHOD_NOT_FOUND",C8="INVALID_PARAMS",fp="INTERNAL_ERROR",sc="SERVER_ERROR",N8=[-32700,-32600,-32601,-32602,-32603],Vn={[P8]:{code:-32700,message:"Parse error"},[T8]:{code:-32600,message:"Invalid Request"},[R8]:{code:-32601,message:"Method not found"},[C8]:{code:-32602,message:"Invalid params"},[fp]:{code:-32603,message:"Internal error"},[sc]:{code:-32e3,message:"Server error"}},dp=sc;function U8(t){return N8.includes(t)}function Ll(t){return Object.keys(Vn).includes(t)?Vn[t]:Vn[dp]}function k8(t){const e=Object.values(Vn).find(r=>r.code===t);return e||Vn[dp]}function L8(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Do={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var da=function(t,e){return da=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},da(t,e)};function F8(t,e){da(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var pa=function(){return pa=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},pa.apply(this,arguments)};function M8(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function q8(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function j8(t,e){return function(r,n){e(r,n,t)}}function z8(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function V8(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function K8(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function H8(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function W8(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ga(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function pp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function G8(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(pp(arguments[e]));return t}function Y8(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function ri(t){return this instanceof ri?(this.v=t,this):new ri(t)}function Z8(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(n[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof ri?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function J8(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:ri(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function X8(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ga=="function"?ga(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Q8(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function eI(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function tI(t){return t&&t.__esModule?t:{default:t}}function rI(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function nI(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const iI=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return pa},__asyncDelegator:J8,__asyncGenerator:Z8,__asyncValues:X8,__await:ri,__awaiter:V8,__classPrivateFieldGet:rI,__classPrivateFieldSet:nI,__createBinding:H8,__decorate:q8,__exportStar:W8,__extends:F8,__generator:K8,__importDefault:tI,__importStar:eI,__makeTemplateObject:Q8,__metadata:z8,__param:j8,__read:pp,__rest:M8,__spread:G8,__spreadArrays:Y8,__values:ga},Symbol.toStringTag,{value:"Module"})),sI=bh(iI);var zt={},Fl;function oI(){if(Fl)return zt;Fl=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.isBrowserCryptoAvailable=zt.getSubtleCrypto=zt.getBrowerCrypto=void 0;function t(){return(Qr===null||Qr===void 0?void 0:Qr.crypto)||(Qr===null||Qr===void 0?void 0:Qr.msCrypto)||{}}zt.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}zt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return zt.isBrowserCryptoAvailable=r,zt}var Vt={},Ml;function aI(){if(Ml)return Vt;Ml=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.isBrowser=Vt.isNode=Vt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Vt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Vt.isNode=e;function r(){return!t()&&!e()}return Vt.isBrowser=r,Vt}var ql;function cI(){return ql||(ql=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=sI;e.__exportStar(oI(),t),e.__exportStar(aI(),t)})(Do)),Do}var uI=cI();function Pt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function xr(t=6){return BigInt(Pt(t))}function Zt(t,e,r){return{id:r||Pt(),jsonrpc:"2.0",method:t,params:e}}function cs(t,e){return{id:t,jsonrpc:"2.0",result:e}}function oc(t,e,r){return{id:t,jsonrpc:"2.0",error:lI(e)}}function lI(t,e){return typeof t>"u"?Ll(fp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Ll(sc)),{message:t})),U8(t.code)&&(t=k8(t.code)),t)}class hI{}class fI extends hI{constructor(){super()}}class dI extends fI{constructor(e){super()}}const pI="^wss?:";function gI(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function yI(t,e){const r=gI(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function jl(t){return yI(t,pI)}function wI(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function gp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ac(t){return gp(t)&&"method"in t}function As(t){return gp(t)&&(Tt(t)||pt(t))}function Tt(t){return"result"in t}function pt(t){return"error"in t}class bI extends dI{constructor(e){super(e),this.events=new It.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Zt(e.method,e.params||[],e.id||xr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{pt(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),As(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const mI=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),vI=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",zl=t=>t.split("?")[0],Vl=10,EI=mI();let xI=class{constructor(e){if(this.url=e,this.events=new It.EventEmitter,this.registering=!1,!jl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ii(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!jl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=uI.isReactNative()?void 0:{rejectUnauthorized:!wI(e)},s=new EI(e,[],i);vI()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?gn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=oc(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return L8(e,zl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Vl&&this.events.setMaxListeners(Vl)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${zl(this.url)}`));return this.events.emit("register_error",r),r}};var _I={};const yp="wc",wp=2,ya="core",Ut=`${yp}@2:${ya}:`,II={logger:"error"},SI={database:":memory:"},DI="crypto",Kl="client_ed25519_seed",OI=M.ONE_DAY,AI="keychain",$I="0.3",BI="messages",PI="0.3",TI=M.SIX_HOURS,RI="publisher",bp="irn",CI="error",mp="wss://relay.walletconnect.org",NI="relayer",de={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},UI="_subscription",ut={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},kI=.1,wa="2.23.6",ue={link_mode:"link_mode",relay:"relay"},qi={inbound:"inbound",outbound:"outbound"},LI="0.3",FI="WALLETCONNECT_CLIENT_ID",Hl="WALLETCONNECT_LINK_MODE_APPS",nt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},MI="subscription",qI="0.3",jI="pairing",zI="0.3",Cn={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},kr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},VI="history",KI="0.3",HI="expirer",ht={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},WI="0.3",GI="verify-api",YI="https://verify.walletconnect.com",vp="https://verify.walletconnect.org",Kn=vp,ZI=`${Kn}/v3`,JI=[YI,vp],XI="echo",QI="https://echo.walletconnect.com",Bt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Ht={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},mt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Rr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Cr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Nn={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},eS=.1,tS="event-client",rS=86400,nS="https://pulse.walletconnect.org/batch";function iS(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,x=0,I=d.length;x!==I&&d[x]===0;)x++,g++;for(var b=(I-x)*l+1>>>0,w=new Uint8Array(b);x!==I;){for(var v=d[x],_=0,A=b-1;(v!==0||_<y)&&A!==-1;A--,_++)v+=256*w[A]>>>0,w[A]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");y=_,x++}for(var B=b-y;B!==b&&w[B]===0;)B++;for(var $=c.repeat(g);B<b;++B)$+=t.charAt(w[B]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,x=0;d[g]===c;)y++,g++;for(var I=(d.length-g)*u+1>>>0,b=new Uint8Array(I);d[g];){var w=r[d.charCodeAt(g)];if(w===255)return;for(var v=0,_=I-1;(w!==0||v<x)&&_!==-1;_--,v++)w+=a*b[_]>>>0,b[_]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");x=v,g++}if(d[g]!==" "){for(var A=I-x;A!==I&&b[A]===0;)A++;for(var B=new Uint8Array(y+(I-A)),$=y;A!==I;)B[$++]=b[A++];return B}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var sS=iS,oS=sS;const Ep=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},aS=t=>new TextEncoder().encode(t),cS=t=>new TextDecoder().decode(t);class uS{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lS{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xp(this,e)}}class hS{constructor(e){this.decoders=e}or(e){return xp(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const xp=(t,e)=>new hS({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class fS{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new uS(e,r,n),this.decoder=new lS(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $s=({name:t,prefix:e,encode:r,decode:n})=>new fS(t,e,r,n),yi=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=oS(r,e);return $s({prefix:t,name:e,encode:n,decode:s=>Ep(i(s))})},dS=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pS=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Ce=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>$s({prefix:e,name:t,encode(i){return pS(i,n,r)},decode(i){return dS(i,n,r,t)}}),gS=$s({prefix:"\0",name:"identity",encode:t=>cS(t),decode:t=>aS(t)});var yS=Object.freeze({__proto__:null,identity:gS});const wS=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var bS=Object.freeze({__proto__:null,base2:wS});const mS=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var vS=Object.freeze({__proto__:null,base8:mS});const ES=yi({prefix:"9",name:"base10",alphabet:"0123456789"});var xS=Object.freeze({__proto__:null,base10:ES});const _S=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),IS=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var SS=Object.freeze({__proto__:null,base16:_S,base16upper:IS});const DS=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),OS=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),AS=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$S=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),BS=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),PS=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),TS=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),RS=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),CS=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var NS=Object.freeze({__proto__:null,base32:DS,base32upper:OS,base32pad:AS,base32padupper:$S,base32hex:BS,base32hexupper:PS,base32hexpad:TS,base32hexpadupper:RS,base32z:CS});const US=yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),kS=yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var LS=Object.freeze({__proto__:null,base36:US,base36upper:kS});const FS=yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),MS=yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var qS=Object.freeze({__proto__:null,base58btc:FS,base58flickr:MS});const jS=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),zS=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),VS=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),KS=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var HS=Object.freeze({__proto__:null,base64:jS,base64pad:zS,base64url:VS,base64urlpad:KS});const _p=Array.from(""),WS=_p.reduce((t,e,r)=>(t[r]=e,t),[]),GS=_p.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function YS(t){return t.reduce((e,r)=>(e+=WS[r],e),"")}function ZS(t){const e=[];for(const r of t){const n=GS[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const JS=$s({prefix:"",name:"base256emoji",encode:YS,decode:ZS});var XS=Object.freeze({__proto__:null,base256emoji:JS}),QS=Ip,Wl=128,eD=-128,tD=Math.pow(2,31);function Ip(t,e,r){e=e||[],r=r||0;for(var n=r;t>=tD;)e[r++]=t&255|Wl,t/=128;for(;t&eD;)e[r++]=t&255|Wl,t>>>=7;return e[r]=t|0,Ip.bytes=r-n+1,e}var rD=ba,nD=128,Gl=127;function ba(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw ba.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Gl)<<i:(o&Gl)*Math.pow(2,i),i+=7}while(o>=nD);return ba.bytes=s-n,r}var iD=Math.pow(2,7),sD=Math.pow(2,14),oD=Math.pow(2,21),aD=Math.pow(2,28),cD=Math.pow(2,35),uD=Math.pow(2,42),lD=Math.pow(2,49),hD=Math.pow(2,56),fD=Math.pow(2,63),dD=function(t){return t<iD?1:t<sD?2:t<oD?3:t<aD?4:t<cD?5:t<uD?6:t<lD?7:t<hD?8:t<fD?9:10},pD={encode:QS,decode:rD,encodingLength:dD},Sp=pD;const Yl=(t,e,r=0)=>(Sp.encode(t,e,r),e),Zl=t=>Sp.encodingLength(t),ma=(t,e)=>{const r=e.byteLength,n=Zl(t),i=n+Zl(r),s=new Uint8Array(i+r);return Yl(t,s,0),Yl(r,s,n),s.set(e,i),new gD(t,r,e,s)};class gD{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const Dp=({name:t,code:e,encode:r})=>new yD(t,e,r);class yD{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ma(this.code,r):r.then(n=>ma(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Op=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),wD=Dp({name:"sha2-256",code:18,encode:Op("SHA-256")}),bD=Dp({name:"sha2-512",code:19,encode:Op("SHA-512")});var mD=Object.freeze({__proto__:null,sha256:wD,sha512:bD});const Ap=0,vD="identity",$p=Ep,ED=t=>ma(Ap,$p(t)),xD={code:Ap,name:vD,encode:$p,digest:ED};var _D=Object.freeze({__proto__:null,identity:xD});new TextEncoder,new TextDecoder;const Jl={...yS,...bS,...vS,...xS,...SS,...NS,...LS,...qS,...HS,...XS};({...mD,..._D});function Bp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ID(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Bp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Pp(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Xl=Pp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Oo=Pp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ID(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),SD={utf8:Xl,"utf-8":Xl,hex:Jl.base16,latin1:Oo,ascii:Oo,binary:Oo,...Jl};function DD(t,e="utf8"){const r=SD[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Bp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var OD=Object.defineProperty,AD=(t,e,r)=>e in t?OD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,At=(t,e,r)=>AD(t,typeof e!="symbol"?e+"":e,r);class $D{constructor(e,r){this.core=e,this.logger=r,At(this,"keychain",new Map),At(this,"name",AI),At(this,"version",$I),At(this,"initialized",!1),At(this,"storagePrefix",Ut),At(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),At(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),At(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),At(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=q("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),At(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=at(r,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Qo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ea(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var BD=Object.defineProperty,PD=(t,e,r)=>e in t?BD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xe=(t,e,r)=>PD(t,typeof e!="symbol"?e+"":e,r);class TD{constructor(e,r,n){this.core=e,this.logger=r,xe(this,"name",DI),xe(this,"keychain"),xe(this,"randomSessionIdentifier",ha()),xe(this,"initialized",!1),xe(this,"clientId"),xe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),xe(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),xe(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=cu(i),o=rf(s.publicKey);return this.clientId=o,o}),xe(this,"generateKeyPair",()=>{this.isInitialized();const i=f_();return this.setPrivateKey(i.publicKey,i.privateKey)}),xe(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=cu(s),a=this.randomSessionIdentifier;return await nm(a,i,OI,o)}),xe(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=d_(a,s);return this.setSymKey(c,o)}),xe(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||Mi(i);return await this.keychain.set(o,i),o}),xe(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),xe(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),xe(this,"encode",async(i,s,o)=>{this.isInitialized();const a=op(o),c=ii(s);if(Il(a))return y_(c,o==null?void 0:o.encoding);if(_l(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(f,p)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return p_({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),xe(this,"decode",async(i,s,o)=>{this.isInitialized();const a=b_(s,o);if(Il(a)){const c=w_(s,o==null?void 0:o.encoding);return gn(c)}if(_l(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=g_({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return gn(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),xe(this,"getPayloadType",(i,s=Je)=>{const o=ei({encoded:i,encoding:s});return Wr(o.type)}),xe(this,"getPayloadSenderPublicKey",(i,s=Je)=>{const o=ei({encoded:i,encoding:s});return o.senderPublicKey?et(o.senderPublicKey,Ve):void 0}),this.core=e,this.logger=at(r,this.name),this.keychain=n||new $D(this.core,this.logger)}get context(){return tt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Kl)}catch{e=ha(),await this.keychain.set(Kl,e)}return DD(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var RD=Object.defineProperty,CD=Object.defineProperties,ND=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,UD=Object.prototype.hasOwnProperty,kD=Object.prototype.propertyIsEnumerable,va=(t,e,r)=>e in t?RD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,LD=(t,e)=>{for(var r in e||(e={}))UD.call(e,r)&&va(t,r,e[r]);if(Ql)for(var r of Ql(e))kD.call(e,r)&&va(t,r,e[r]);return t},FD=(t,e)=>CD(t,ND(e)),rt=(t,e,r)=>va(t,typeof e!="symbol"?e+"":e,r);class MD extends t0{constructor(e,r){super(e,r),this.logger=e,this.core=r,rt(this,"messages",new Map),rt(this,"messagesWithoutClientAck",new Map),rt(this,"name",BI),rt(this,"version",PI),rt(this,"initialized",!1),rt(this,"storagePrefix",Ut),rt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),rt(this,"set",async(n,i,s)=>{this.isInitialized();const o=dt(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===qi.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,FD(LD({},c),{[o]:i}))}return await this.persist(),o}),rt(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),rt(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),rt(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=dt(i);return typeof s[o]<"u"}),rt(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=dt(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),rt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=at(e,this.name),this.core=r}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Qo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Qo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ea(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ea(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var qD=Object.defineProperty,jD=Object.defineProperties,zD=Object.getOwnPropertyDescriptors,eh=Object.getOwnPropertySymbols,VD=Object.prototype.hasOwnProperty,KD=Object.prototype.propertyIsEnumerable,Ea=(t,e,r)=>e in t?qD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,on=(t,e)=>{for(var r in e||(e={}))VD.call(e,r)&&Ea(t,r,e[r]);if(eh)for(var r of eh(e))KD.call(e,r)&&Ea(t,r,e[r]);return t},th=(t,e)=>jD(t,zD(e)),lt=(t,e,r)=>Ea(t,typeof e!="symbol"?e+"":e,r);class HD extends r0{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,lt(this,"events",new It.EventEmitter),lt(this,"name",RI),lt(this,"queue",new Map),lt(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),lt(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),lt(this,"needsTransportRestart",!1),lt(this,"publish",async(n,i,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const h=(s==null?void 0:s.ttl)||TI,f=(s==null?void 0:s.prompt)||!1,p=(s==null?void 0:s.tag)||0,d=(s==null?void 0:s.id)||xr().toString(),g=ln(os().protocol),y={id:d,method:(s==null?void 0:s.publishMethod)||g.publish,params:on({topic:n,message:i,ttl:h,prompt:f,tag:p,attestation:s==null?void 0:s.attestation},s==null?void 0:s.tvf)},x=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{De((o=y.params)==null?void 0:o.prompt)&&((a=y.params)==null||delete a.prompt),De((c=y.params)==null?void 0:c.tag)&&((u=y.params)==null||delete u.tag);const I=new Promise(async b=>{const w=({id:_})=>{var A;((A=y.id)==null?void 0:A.toString())===_.toString()&&(this.removeRequestFromQueue(_),this.relayer.events.removeListener(de.publish,w),b())};this.relayer.events.on(de.publish,w);const v=Nt(new Promise((_,A)=>{this.rpcPublish(y,s).then(_).catch(B=>{this.logger.warn(B,B==null?void 0:B.message),A(B)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await v,this.events.removeListener(de.publish,w)}catch(_){this.queue.set(d,{request:y,opts:s,attempt:1}),this.logger.warn(_,_==null?void 0:_.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:n,message:i,opts:s}}),await Nt(I,this.publishTimeout,x)}catch(I){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(I),(l=s==null?void 0:s.internal)!=null&&l.throwOnFailedPublish)throw I}finally{this.queue.delete(d)}}),lt(this,"publishCustom",async n=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:u,opts:l={}}=n,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:y=M.FIVE_MINUTES}=l,x=l.id||xr().toString(),I=ln(os().protocol),b=p||I.publish,w={id:x,method:b,params:on(th(on({},u),{ttl:y,prompt:d,tag:g,attestation:h}),f)},v=`Failed to publish custom payload, please try again. id:${x} tag:${g}`;try{De((i=w.params)==null?void 0:i.prompt)&&((s=w.params)==null||delete s.prompt),De((o=w.params)==null?void 0:o.tag)&&((a=w.params)==null||delete a.tag);const _=new Promise(async A=>{const B=({id:N})=>{var U;((U=w.id)==null?void 0:U.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(de.publish,B),A())};this.relayer.events.on(de.publish,B);const $=Nt(new Promise((N,U)=>{this.rpcPublish(w,l).then(N).catch(C=>{this.logger.warn(C,C==null?void 0:C.message),U(C)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${x} tag:${g}`);try{await $,this.events.removeListener(de.publish,B)}catch(N){this.queue.set(x,{request:w,opts:l,attempt:1}),this.logger.warn(N,N==null?void 0:N.message)}});this.logger.trace({type:"method",method:"publish",params:{id:x,payload:u,opts:l}}),await Nt(_,this.publishTimeout,v)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(c=l==null?void 0:l.internal)!=null&&c.throwOnFailedPublish)throw _}finally{this.queue.delete(x)}}),lt(this,"on",(n,i)=>{this.events.on(n,i)}),lt(this,"once",(n,i)=>{this.events.once(n,i)}),lt(this,"off",(n,i)=>{this.events.off(n,i)}),lt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=at(r,this.name),this.registerEventListeners()}get context(){return tt(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(de.publish,on(on({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const i=e.attempt+1;this.queue.set(r,th(on({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Yr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(de.connection_stalled);return}this.checkQueue()}),this.relayer.on(de.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var WD=Object.defineProperty,GD=(t,e,r)=>e in t?WD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,an=(t,e,r)=>GD(t,typeof e!="symbol"?e+"":e,r);class YD{constructor(){an(this,"map",new Map),an(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),an(this,"get",e=>this.map.get(e)||[]),an(this,"exists",(e,r)=>this.get(e).includes(r)),an(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),an(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var ZD=Object.defineProperty,JD=Object.defineProperties,XD=Object.getOwnPropertyDescriptors,rh=Object.getOwnPropertySymbols,QD=Object.prototype.hasOwnProperty,e6=Object.prototype.propertyIsEnumerable,xa=(t,e,r)=>e in t?ZD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Un=(t,e)=>{for(var r in e||(e={}))QD.call(e,r)&&xa(t,r,e[r]);if(rh)for(var r of rh(e))e6.call(e,r)&&xa(t,r,e[r]);return t},Ao=(t,e)=>JD(t,XD(e)),ae=(t,e,r)=>xa(t,typeof e!="symbol"?e+"":e,r);class t6 extends s0{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ae(this,"subscriptions",new Map),ae(this,"topicMap",new YD),ae(this,"events",new It.EventEmitter),ae(this,"name",MI),ae(this,"version",qI),ae(this,"pending",new Map),ae(this,"cached",[]),ae(this,"initialized",!1),ae(this,"storagePrefix",Ut),ae(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),ae(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ae(this,"clientId"),ae(this,"batchSubscribeTopicsLimit",500),ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ae(this,"subscribe",async(n,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=os(i),a={topic:n,relay:o,transportType:i==null?void 0:i.transportType};(s=i==null?void 0:i.internal)!=null&&s.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ae(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),ae(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),ae(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),ae(this,"on",(n,i)=>{this.events.on(n,i)}),ae(this,"once",(n,i)=>{this.events.once(n,i)}),ae(this,"off",(n,i)=>{this.events.off(n,i)}),ae(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),ae(this,"start",async()=>{await this.onConnect()}),ae(this,"stop",async()=>{await this.onDisconnect()}),ae(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ae(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),ae(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Yr.pulse,async()=>{await this.checkPending()}),this.events.on(nt.created,async n=>{const i=nt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(nt.deleted,async n=>{const i=nt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=at(r,this.name),this.clientId=""}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=os(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i,s;const o=await this.getSubscriptionId(e);if((i=n==null?void 0:n.internal)!=null&&i.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===ue.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ln(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=n==null?void 0:n.internal)==null?void 0:s.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===ue.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},M.toMiliseconds(M.ONE_SECOND)),o;const u=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(nt.created,f),h(p.id))};this.events.on(nt.created,f);try{const p=await Nt(new Promise((d,g)=>{this.relayer.request(a).catch(y=>{this.logger.warn(y,y==null?void 0:y.message),g(y)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(nt.created,f),h(p)}catch{}}),l=await Nt(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(de.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return!0;const r=e[0].relay,n={method:ln(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await Nt(new Promise((i,s)=>{this.relayer.request(n).then(i).catch(o=>{this.logger.warn(o),s(o)})}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again"),!0}catch{return this.relayer.events.emit(de.connection_stalled),!1}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:ln(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await Nt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(de.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:ln(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,Ao(Un({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Un({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Un({},r)),this.topicMap.set(r.topic,e),this.events.emit(nt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(nt.deleted,Ao(Un({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(nt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(nt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(e.length){if(!await this.rpcBatchSubscribe(e)){this.logger.warn(`Batch subscribe failed for ${e.length} topics, adding to pending for retry`),e.forEach(r=>{this.pending.set(r.topic,r)});return}this.onBatchSubscribe(await Promise.all(e.map(async r=>Ao(Un({},r),{id:await this.getSubscriptionId(r.topic)}))))}}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await TE(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return dt(e+await this.getClientId())}}var r6=Object.defineProperty,nh=Object.getOwnPropertySymbols,n6=Object.prototype.hasOwnProperty,i6=Object.prototype.propertyIsEnumerable,_a=(t,e,r)=>e in t?r6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ih=(t,e)=>{for(var r in e||(e={}))n6.call(e,r)&&_a(t,r,e[r]);if(nh)for(var r of nh(e))i6.call(e,r)&&_a(t,r,e[r]);return t},Q=(t,e,r)=>_a(t,typeof e!="symbol"?e+"":e,r);class s6 extends n0{constructor(e){var r;super(e),Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new It.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name",NI),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),Q(this,"stalledRestartInProgress",!1),Q(this,"stalledRestartTimeout"),Q(this,"stalledRestartBackoff",0),Q(this,"stalledRestartBaseInterval",M.toMiliseconds(M.ONE_SECOND*2)),Q(this,"stalledRestartMaxInterval",M.toMiliseconds(M.THIRTY_SECONDS)),Q(this,"request",async n=>{var i,s;this.logger.debug("Publishing Request Payload");const o=n.id||xr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(i=n.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=n.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),Q(this,"resetPingTimeout",()=>{es()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(de.connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(de.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(i=>this.logger.warn(i))}),Q(this,"registerProviderListeners",()=>{this.provider.on(ut.payload,this.onPayloadHandler),this.provider.on(ut.connect,this.onConnectHandler),this.provider.on(ut.disconnect,this.onDisconnectHandler),this.provider.on(ut.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=hp({logger:(r=e.logger)!=null?r:CI,name:this.name}),this.messages=new MD(this.logger,e.core),this.subscriber=new t6(this,this.logger),this.publisher=new HD(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||mp,yE()?this.packageName=Ku():wE()&&(this.bundleId=Ku()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return tt(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ue.relay},qi.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(nt.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(nt.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,ih({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Nt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.stalledRestartTimeout),this.stalledRestartInProgress=!1,this.stalledRestartBackoff=0,await this.resetTransport()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.resetTransport(),await this.transportOpen())}async resetTransport(){this.reconnectInProgress=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,await this.transportDisconnect(),await this.subscriber.stop(),this.reconnectInProgress=!1}async confirmOnlineStateOrThrow(){if(!await kl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=me(M.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(de.message,e),await this.recordMessageEvent(e,qi.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(ut.disconnect,s),await Nt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(ut.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ut.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ut.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(es())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new bI(new xI(xE({sdkVersion:wa,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ac(e)){if(!e.method.endsWith(UI))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:ue.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ih({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else As(e)&&this.events.emit(de.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,qi.inbound),this.events.emit(de.message,e))}async acknowledgePayload(e){const r=cs(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ut.payload,this.onPayloadHandler),this.provider.off(ut.connect,this.onConnectHandler),this.provider.off(ut.disconnect,this.onDisconnectHandler),this.provider.off(ut.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await kl();m8(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Yr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&x8())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}}),this.events.on(de.connection_stalled,()=>{if(this.transportExplicitlyClosed||this.stalledRestartInProgress)return;this.stalledRestartInProgress=!0;const r=this.stalledRestartBackoff===0?0:Math.min(Math.pow(2,this.stalledRestartBackoff-1)*this.stalledRestartBaseInterval,this.stalledRestartMaxInterval);this.stalledRestartBackoff++,this.logger.warn(`Connection stalled, restarting transport${r?` in ${r}ms`:""}...`),this.stalledRestartTimeout=setTimeout(async()=>{try{if(this.transportExplicitlyClosed)return;await this.restartTransport()}catch(n){this.logger.error(n,n==null?void 0:n.message)}finally{this.stalledRestartInProgress=!1}},r)})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(de.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(kI)))))}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function o6(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function sh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function oh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const a6="[object RegExp]",c6="[object String]",u6="[object Number]",l6="[object Boolean]",ah="[object Arguments]",h6="[object Symbol]",f6="[object Date]",d6="[object Map]",p6="[object Set]",g6="[object Array]",y6="[object Function]",w6="[object ArrayBuffer]",$o="[object Object]",b6="[object Error]",m6="[object DataView]",v6="[object Uint8Array]",E6="[object Uint8ClampedArray]",x6="[object Uint16Array]",_6="[object Uint32Array]",I6="[object BigUint64Array]",S6="[object Int8Array]",D6="[object Int16Array]",O6="[object Int32Array]",A6="[object BigInt64Array]",$6="[object Float32Array]",B6="[object Float64Array]";function ch(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function P6(t,e,r){return Mn(t,e,void 0,void 0,void 0,void 0,r)}function Mn(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Hn(t,e,s,o)}return Hn(t,e,s,o)}function Hn(t,e,r,n){if(Object.is(t,e))return!0;let i=oh(t),s=oh(e);if(i===ah&&(i=$o),s===ah&&(s=$o),i!==s)return!1;switch(i){case c6:return t.toString()===e.toString();case u6:{const c=t.valueOf(),u=e.valueOf();return o6(c,u)}case l6:case f6:case h6:return Object.is(t.valueOf(),e.valueOf());case a6:return t.source===e.source&&t.flags===e.flags;case y6:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case d6:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Mn(u,e.get(c),c,t,e,r,n))return!1;return!0}case p6:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(p=>Mn(h,p,void 0,t,e,r,n));if(f===-1)return!1;u.splice(f,1)}return!0}case g6:case v6:case E6:case x6:case _6:case I6:case S6:case D6:case O6:case A6:case $6:case B6:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Mn(t[c],e[c],c,t,e,r,n))return!1;return!0}case w6:return t.byteLength!==e.byteLength?!1:Hn(new Uint8Array(t),new Uint8Array(e),r,n);case m6:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Hn(new Uint8Array(t),new Uint8Array(e),r,n);case b6:return t.name===e.name&&t.message===e.message;case $o:{if(!(Hn(t.constructor,e.constructor,r,n)||ch(t)&&ch(e)))return!1;const c=[...Object.keys(t),...sh(t)],u=[...Object.keys(e),...sh(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Mn(f,p,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function T6(){}function R6(t,e){return P6(t,e,T6)}var C6=Object.defineProperty,uh=Object.getOwnPropertySymbols,N6=Object.prototype.hasOwnProperty,U6=Object.prototype.propertyIsEnumerable,Ia=(t,e,r)=>e in t?C6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lh=(t,e)=>{for(var r in e||(e={}))N6.call(e,r)&&Ia(t,r,e[r]);if(uh)for(var r of uh(e))U6.call(e,r)&&Ia(t,r,e[r]);return t},He=(t,e,r)=>Ia(t,typeof e!="symbol"?e+"":e,r);class Xr extends i0{constructor(e,r,n,i=Ut,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,He(this,"map",new Map),He(this,"version",LI),He(this,"cached",[]),He(this,"initialized",!1),He(this,"getKey"),He(this,"storagePrefix",Ut),He(this,"recentlyDeleted",[]),He(this,"recentlyDeletedLimit",200),He(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!De(o)?this.map.set(this.getKey(o),o):Z_(o)?this.map.set(o.id,o):J_(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),He(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),He(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),He(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>R6(a[c],o[c]))):this.values)),He(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=lh(lh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),He(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=at(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=q("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var k6=Object.defineProperty,L6=(t,e,r)=>e in t?k6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ee=(t,e,r)=>L6(t,typeof e!="symbol"?e+"":e,r);class F6{constructor(e,r){this.core=e,this.logger=r,ee(this,"name",jI),ee(this,"version",zI),ee(this,"events",new mh),ee(this,"pairings"),ee(this,"initialized",!1),ee(this,"storagePrefix",Ut),ee(this,"ignoredPayloadTypes",[er]),ee(this,"registeredMethods",[]),ee(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ee(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),ee(this,"create",async n=>{this.isInitialized();const i=ha(),s=await this.core.crypto.setSymKey(i),o=me(M.FIVE_MINUTES),a={protocol:bp},c={topic:s,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},u=Al({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(kr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:s,uri:u}}),ee(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[Bt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Ol(n.uri);i.props.properties.topic=s,i.addTrace(Bt.pairing_uri_validation_success),i.addTrace(Bt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(Bt.existing_pairing),l.active)throw i.setError(Ht.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Bt.pairing_not_expired)}const h=c||me(M.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(Bt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(kr.create,f),i.addTrace(Bt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Bt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Ht.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError(Ht.subscribe_pairing_topic_failure),p}return i.addTrace(Bt.subscribe_pairing_topic_success),f}),ee(this,"activate",async({topic:n})=>{this.isInitialized();const i=me(M.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),ee(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Nr();this.events.once(ie("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),ee(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),ee(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),ee(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ee(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",fe("USER_DISCONNECTED")),await this.deletePairing(i))}),ee(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Al({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),ee(this,"sendRequest",async(n,i,s)=>{const o=Zt(i,s),a=await this.core.crypto.encode(n,o),c=Cn[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),ee(this,"sendResult",async(n,i,s)=>{const o=cs(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=Cn[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),ee(this,"sendError",async(n,i,s)=>{const o=oc(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=Cn[c]?Cn[c].res:Cn.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),ee(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),ee(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>pr(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),ee(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),ee(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),ee(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(kr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),ee(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{Tt(i)?this.events.emit(ie("pairing_ping",s),{}):pt(i)&&this.events.emit(ie("pairing_ping",s),{error:i.error})},500)}),ee(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(kr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),ee(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=fe("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),ee(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(fe("WC_METHOD_UNSUPPORTED",n))}),ee(this,"isValidPair",(n,i)=>{var s;if(!Ge(n)){const{message:a}=q("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(Ht.malformed_pairing_uri),new Error(a)}if(!Y_(n.uri)){const{message:a}=q("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(Ht.malformed_pairing_uri),new Error(a)}const o=Ol(n==null?void 0:n.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Ht.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Ht.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(Ht.pairing_expired);const{message:a}=q("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ee(this,"isValidPing",async n=>{if(!Ge(n)){const{message:s}=q("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ee(this,"isValidDisconnect",async n=>{if(!Ge(n)){const{message:s}=q("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ee(this,"isValidPairingTopic",async n=>{if(!ye(n,!1)){const{message:i}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(pr(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=q("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=at(r,this.name),this.pairings=new Xr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return tt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(de.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==ue.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);ac(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):As(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(ht.expired,async e=>{const{topic:r}=cd(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(kr.expire,{topic:r}))})}}var M6=Object.defineProperty,q6=(t,e,r)=>e in t?M6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e,r)=>q6(t,typeof e!="symbol"?e+"":e,r);class j6 extends e0{constructor(e,r){super(e,r),this.core=e,this.logger=r,$e(this,"records",new Map),$e(this,"events",new It.EventEmitter),$e(this,"name",VI),$e(this,"version",KI),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"storagePrefix",Ut),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),$e(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:me(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(bt.created,o)}),$e(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=pt(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(bt.updated,i))}),$e(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),$e(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(bt.deleted,s)}}),this.persist()}),$e(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),$e(this,"on",(n,i)=>{this.events.on(n,i)}),$e(this,"once",(n,i)=>{this.events.once(n,i)}),$e(this,"off",(n,i)=>{this.events.off(n,i)}),$e(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=at(r,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Zt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Yr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(bt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var z6=Object.defineProperty,V6=(t,e,r)=>e in t?z6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Le=(t,e,r)=>V6(t,typeof e!="symbol"?e+"":e,r);class K6 extends o0{constructor(e,r){super(e,r),this.core=e,this.logger=r,Le(this,"expirations",new Map),Le(this,"events",new It.EventEmitter),Le(this,"name",HI),Le(this,"version",WI),Le(this,"cached",[]),Le(this,"initialized",!1),Le(this,"storagePrefix",Ut),Le(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Le(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Le(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(ht.created,{target:s,expiration:o})}),Le(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),Le(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(ht.deleted,{target:i,expiration:s})}}),Le(this,"on",(n,i)=>{this.events.on(n,i)}),Le(this,"once",(n,i)=>{this.events.once(n,i)}),Le(this,"off",(n,i)=>{this.events.off(n,i)}),Le(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=at(r,this.name)}get context(){return tt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _E(e);if(typeof e=="number")return IE(e);const{message:r}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ht.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;M.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ht.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Yr.pulse,()=>this.checkExpirations()),this.events.on(ht.created,e=>{const r=ht.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.expired,e=>{const r=ht.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.deleted,e=>{const r=ht.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var H6=Object.defineProperty,W6=(t,e,r)=>e in t?H6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ge=(t,e,r)=>W6(t,typeof e!="symbol"?e+"":e,r);class G6 extends a0{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,ge(this,"name",GI),ge(this,"abortController"),ge(this,"isDevEnv"),ge(this,"verifyUrlV3",ZI),ge(this,"storagePrefix",Ut),ge(this,"version",wp),ge(this,"publicKey"),ge(this,"fetchPromise"),ge(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ge(this,"register",async i=>{if(!xn()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=tr.getDocument(),l=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",y),u.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const y=x=>{if(x.data&&typeof x.data=="string")try{const I=JSON.parse(x.data);if(I.type==="verify_attestation"){if(Vo(I.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",y),f(I.attestation===null?"":I.attestation)}}catch(I){this.logger.warn(I)}};u.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(u){this.logger.warn(u)}return""}),ge(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Vo(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),ge(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ge(this,"getVerifyUrl",i=>{let s=i||Kn;return JI.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Kn}`),s=Kn),s}),ge(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(M.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),ge(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),ge(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ge(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ge(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ge(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),ge(this,"validateAttestation",(i,s)=>{const o=v_(i,s.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=at(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ga(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return tt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var Y6=Object.defineProperty,Z6=(t,e,r)=>e in t?Y6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hh=(t,e,r)=>Z6(t,typeof e!="symbol"?e+"":e,r);class J6 extends c0{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,hh(this,"context",XI),hh(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${QI}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=at(r,this.context)}}var X6=Object.defineProperty,fh=Object.getOwnPropertySymbols,Q6=Object.prototype.hasOwnProperty,eO=Object.prototype.propertyIsEnumerable,Sa=(t,e,r)=>e in t?X6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kn=(t,e)=>{for(var r in e||(e={}))Q6.call(e,r)&&Sa(t,r,e[r]);if(fh)for(var r of fh(e))eO.call(e,r)&&Sa(t,r,e[r]);return t},_e=(t,e,r)=>Sa(t,typeof e!="symbol"?e+"":e,r);class tO extends u0{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,_e(this,"context",tS),_e(this,"storagePrefix",Ut),_e(this,"storageVersion",eS),_e(this,"events",new Map),_e(this,"shouldPersist",!1),_e(this,"init",async()=>{if(!Ga())try{const i={eventId:Wu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:od(this.core.relayer.protocol,this.core.relayer.version,wa)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),_e(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=Wu(),l=this.core.projectId||"",h=Date.now(),f=kn({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),_e(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return kn(kn({},a),this.setMethods(a.eventId))}),_e(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),_e(this,"setEventListeners",()=>{this.core.heartbeat.on(Yr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(i.timestamp)>rS&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),_e(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),_e(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),_e(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),_e(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),_e(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,kn(kn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),_e(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),_e(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${nS}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${wa}${s}`,{method:"POST",body:JSON.stringify(i)})}),_e(this,"getAppDomain",()=>sd().url),this.logger=at(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var rO=Object.defineProperty,dh=Object.getOwnPropertySymbols,nO=Object.prototype.hasOwnProperty,iO=Object.prototype.propertyIsEnumerable,Da=(t,e,r)=>e in t?rO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ph=(t,e)=>{for(var r in e||(e={}))nO.call(e,r)&&Da(t,r,e[r]);if(dh)for(var r of dh(e))iO.call(e,r)&&Da(t,r,e[r]);return t},ce=(t,e,r)=>Da(t,typeof e!="symbol"?e+"":e,r);class cc extends Zy{constructor(e){var r;super(e),ce(this,"protocol",yp),ce(this,"version",wp),ce(this,"name",ya),ce(this,"relayUrl"),ce(this,"projectId"),ce(this,"customStoragePrefix"),ce(this,"events",new It.EventEmitter),ce(this,"logger"),ce(this,"heartbeat"),ce(this,"relayer"),ce(this,"crypto"),ce(this,"storage"),ce(this,"history"),ce(this,"expirer"),ce(this,"pairing"),ce(this,"verify"),ce(this,"echoClient"),ce(this,"linkModeSupportedApps"),ce(this,"eventClient"),ce(this,"initialized",!1),ce(this,"logChunkController"),ce(this,"on",(a,c)=>this.events.on(a,c)),ce(this,"once",(a,c)=>this.events.once(a,c)),ce(this,"off",(a,c)=>this.events.off(a,c)),ce(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ce(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ue.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||mp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=zy({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:II.logger,name:ya}),{logger:s,chunkLoggerController:o}=Oh({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=at(s,this.name),this.heartbeat=new xg,this.crypto=new TD(this,this.logger,e==null?void 0:e.keychain),this.history=new j6(this,this.logger),this.expirer=new K6(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new iy(ph(ph({},SI),e==null?void 0:e.storageOptions)),this.relayer=new s6({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new F6(this,this.logger),this.verify=new G6(this,this.logger,this.storage),this.echoClient=new J6(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new tO(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new cc(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(FI,n),r}get context(){return tt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Hl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Hl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&_I.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const sO=cc,Tp="wc",Rp=2,Cp="client",uc=`${Tp}@${Rp}:${Cp}:`,Bo={name:Cp,logger:"error"},gh="WALLETCONNECT_DEEPLINK_CHOICE",oO="proposal",yh="Proposal expired",aO="session",cn=M.SEVEN_DAYS,cO="engine",Be={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},Po={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},$t={idle:"IDLE",active:"ACTIVE"},uO={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},lO="request",hO=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],fO="wc",dO="auth",pO="authKeys",gO="pairingTopics",yO="requests",Bs=`${fO}@${1.5}:${dO}:`,ji=`${Bs}:PUB_KEY`;var wO=Object.defineProperty,bO=Object.defineProperties,mO=Object.getOwnPropertyDescriptors,wh=Object.getOwnPropertySymbols,vO=Object.prototype.hasOwnProperty,EO=Object.prototype.propertyIsEnumerable,Oa=(t,e,r)=>e in t?wO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ne=(t,e)=>{for(var r in e||(e={}))vO.call(e,r)&&Oa(t,r,e[r]);if(wh)for(var r of wh(e))EO.call(e,r)&&Oa(t,r,e[r]);return t},Pe=(t,e)=>bO(t,mO(e)),F=(t,e,r)=>Oa(t,typeof e!="symbol"?e+"":e,r);class xO extends d0{constructor(e){super(e),F(this,"name",cO),F(this,"events",new mh),F(this,"initialized",!1),F(this,"requestQueue",{state:$t.idle,queue:[]}),F(this,"sessionRequestQueue",{state:$t.idle,queue:[]}),F(this,"emittedSessionRequests",new RE({limit:500})),F(this,"requestQueueDelay",M.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Be)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Pe(ne({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=V_(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:u,relays:l,authentication:h,walletPay:f}=i,p=((n=h==null?void 0:h[0])==null?void 0:n.ttl)||Be.wc_sessionPropose.req.ttl||M.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,g,y=!1;try{if(d){const $=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),y=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),$}if(!d||!y){const{topic:$,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=$,g=N}if(!d){const{message:$}=q("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error($)}const x=await this.client.core.crypto.generateKeyPair(),I=me(p),b=ne(Pe(ne(ne({requiredNamespaces:o,optionalNamespaces:a,relays:l??[{protocol:bp}],proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:I,pairingTopic:d},c&&{sessionProperties:c}),u&&{scopedProperties:u}),{id:Pt()}),(h||f)&&{requests:{authentication:h==null?void 0:h.map($=>{const{domain:N,chains:U,nonce:C,uri:D,exp:T,nbf:E,type:m,statement:O,requestId:R,resources:S,signatureTypes:P}=$;return{domain:N,chains:U,nonce:C,type:m??"caip122",aud:D,version:"1",iat:new Date().toISOString(),exp:T,nbf:E,statement:O,requestId:R,resources:S,signatureTypes:P}}),walletPay:f}}),w=ie("session_connect",b.id),{reject:v,resolve:_,done:A}=Nr(p,yh),B=({id:$})=>{$===b.id&&(this.client.events.off("proposal_expire",B),this.pendingSessions.delete(b.id),this.events.emit(w,{error:{message:yh,code:0}}))};return this.client.events.on("proposal_expire",B),this.events.once(w,({error:$,session:N})=>{this.client.events.off("proposal_expire",B),$?v($):N&&_(N)}),await this.setProposal(b.id,b),await this.sendProposeSession({proposal:b,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:b.id}}}).catch($=>{throw this.deleteProposal(b.id),$}),{uri:g,approval:A}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),F(this,"approve",async r=>{var n,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r==null?void 0:r.id)==null?void 0:n.toString(),trace:[mt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw o.setError(Rr.no_internet_connection),N}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Rr.proposal_not_found),N}try{await this.isValidApprove(r)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Rr.session_approve_namespace_validation_failure),N}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:y,requiredNamespaces:x,optionalNamespaces:I}=d;let b=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});b||(b=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:mt.session_approve_started,properties:{topic:g,trace:[mt.session_approve_started,mt.session_namespaces_validation_success]}}));const w=await this.client.core.crypto.generateKeyPair(),v=y.publicKey,_=await this.client.core.crypto.generateSharedKey(w,v),A=Pe(ne(ne(ne({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:w,metadata:this.client.metadata},expiry:me(cn)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),B=ue.relay;b.addTrace(mt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(_,{transportType:B,internal:{skipSubscribe:!0}})}catch(N){throw b.setError(Rr.subscribe_session_topic_failure),N}b.addTrace(mt.subscribe_session_topic_success);const $=Pe(ne({},A),{topic:_,requiredNamespaces:x,optionalNamespaces:I,pairingTopic:g,acknowledged:!1,self:A.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:w,transportType:ue.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(_,$),b.addTrace(mt.store_session);try{await this.sendApproveSession({sessionTopic:_,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:w},sessionSettleRequest:A,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ne({correlationId:a},this.getTVFApproveParams($))}}),b.addTrace(mt.session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(_,fe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(_),N}return this.client.core.eventClient.deleteEvent({eventId:b.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:y.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(_,me(cn)),{topic:_,acknowledged:()=>Promise.resolve(this.client.session.get(_))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&await this.sendError({id:n,topic:s,error:i,rpcOpts:Be.wc_sessionPropose.reject}),await this.deleteProposal(n)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=Nr(M.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Pt(),u=xr().toString(),l=this.client.session.get(n).namespaces;return this.events.once(ie("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:l}),a(h)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=Pt(),{done:s,resolve:o,reject:a}=Nr(M.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ie("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,me(cn)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(y){throw this.client.logger.error("request() -> isValidRequest() failed"),y}const{chainId:n,request:i,topic:s,expiry:o=Be.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);(a==null?void 0:a.transportType)===ue.relay&&await this.confirmOnlineStateOrThrow();const c=Pt(),u=xr().toString(),{done:l,resolve:h,reject:f}=Nr(o,"Request expired. Please try again.");this.events.once(ie("session_request",c),({error:y,result:x})=>{y?f(y):h(x)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:Pe(ne({},i),{expiryTimestamp:me(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(y=>f(y)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),await l();const g={request:Pe(ne({},i),{expiryTimestamp:me(o)}),chainId:n};return await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(x=>f(x)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),y()}),new Promise(async y=>{var x;if(!((x=a.sessionConfig)!=null&&x.disableDeepLink)){const I=await AE(this.client.core.storage,gh);await SE({id:c,topic:s,wcDeepLink:I})}y()}),l()]).then(y=>y[2])}),F(this,"respond",async r=>{var n,i;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:(r==null?void 0:r.topic)||((i=(n=r==null?void 0:r.response)==null?void 0:n.id)==null?void 0:i.toString()),trace:[mt.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw s.addTrace(h==null?void 0:h.message),s.setError(Rr.session_request_response_validation_failure),h}s.addTrace(mt.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,u=this.client.session.get(o);u.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{s.addTrace(mt.session_request_response_publish_started),Tt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):pt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(h){throw s.addTrace(h==null?void 0:h.message),s.setError(Rr.session_request_response_publish_failure),h}}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=Pt(),s=xr().toString(),{done:o,resolve:a,reject:c}=Nr(M.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ie("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=xr().toString(),a=Pt();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:fe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=q("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>W_(n,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(r);const s=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?ue.link_mode:ue.relay;o===ue.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:y}=r,x=[...r.resources||[]],{topic:I,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:I,uri:b}});const w=await this.client.core.crypto.generateKeyPair(),v=Mi(w);if(await Promise.all([this.client.auth.authKeys.set(ji,{responseTopic:v,publicKey:w}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:I})]),await this.client.core.relayer.subscribe(v,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${I}`),g.length>0){const{namespace:S}=Li(a[0]);let P=Hx(S,"request",g);Fi(x)&&(P=Gx(P,x.pop())),x.push(P)}const _=y&&y>Be.wc_sessionAuthenticate.req.ttl?y:Be.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:x},requester:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:me(_)},B={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},$={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:I,proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:me(Be.wc_sessionPropose.req.ttl),id:Pt()},{done:N,resolve:U,reject:C}=Nr(_,"Request expired"),D=Pt(),T=ie("session_connect",$.id),E=ie("session_request",D),m=async({error:S,session:P})=>{this.events.off(E,O),S?C(S):P&&U({session:P})},O=async S=>{var P,k,L;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),S.error){const W=fe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===W.code?void 0:(this.events.off(T,m),C(S.error.message))}await this.deleteProposal($.id),this.events.off(T,m);const{cacaos:K,responder:z}=S.result,j=[],H=[];for(const W of K){await il({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),C(fe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:X}=W,he=Fi(X.resources),we=[ta(X.iss)],Ee=rs(X.iss);if(he){const qe=sl(he),kt=ol(he);j.push(...qe),we.push(...kt)}for(const qe of we)H.push(`${qe}:${Ee}`)}const G=await this.client.core.crypto.generateSharedKey(w,z.publicKey);let J;j.length>0&&(J={topic:G,acknowledged:!0,self:{publicKey:w,metadata:this.client.metadata},peer:z,controller:z.publicKey,expiry:me(cn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:I,namespaces:Tl([...new Set(j)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,J),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:z.metadata}),J=this.client.session.get(G)),(P=this.client.metadata.redirect)!=null&&P.linkMode&&(k=z.metadata.redirect)!=null&&k.linkMode&&(L=z.metadata.redirect)!=null&&L.universal&&n&&(this.client.core.addLinkModeSupportedApp(z.metadata.redirect.universal),this.client.session.update(G,{transportType:ue.link_mode})),U({auths:K,session:J})};this.events.once(T,m),this.events.once(E,O);let R;try{if(s){const S=Zt("wc_sessionAuthenticate",A,D);this.client.core.history.set(I,S);const P=await this.client.core.crypto.encode("",S,{type:gi,encoding:vr});R=Ci(n,I,P)}else await Promise.all([this.sendRequest({topic:I,method:"wc_sessionAuthenticate",params:A,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:I,method:"wc_sessionPropose",params:$,expiry:Be.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:$.id})])}catch(S){throw this.events.off(T,m),this.events.off(E,O),S}return await this.setProposal($.id,$),await this.setAuthRequest(D,{request:Pe(ne({},A),{verifyContext:{}}),pairingTopic:I,transportType:o}),{uri:R??b,response:N}}),F(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:i}=r,s=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[Cr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw s.setError(Nn.no_internet_connection),y}const o=this.getPendingAuthRequest(n);if(!o)throw s.setError(Nn.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||ue.relay;a===ue.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=Mi(c),h={type:er,receiverPublicKey:c,senderPublicKey:u},f=[],p=[];for(const y of i){if(!await il({cacao:y,projectId:this.client.core.projectId})){s.setError(Nn.invalid_cacao);const v=fe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:l,error:v,encodeOpts:h}),new Error(v.message)}s.addTrace(Cr.cacaos_verified);const{p:x}=y,I=Fi(x.resources),b=[ta(x.iss)],w=rs(x.iss);if(I){const v=sl(I),_=ol(I);f.push(...v),b.push(..._)}for(const v of b)p.push(`${v}:${w}`)}const d=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Cr.create_authenticated_session_topic);let g;if((f==null?void 0:f.length)>0){g={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:me(cn),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Tl([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(Cr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(y){throw s.setError(Nn.subscribe_authenticated_session_topic_failure),y}s.addTrace(Cr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),s.addTrace(Cr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Cr.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:n,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw s.setError(Nn.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);s.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Mi(o),u={type:er,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:u,rpcOpts:Be.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:i}=r;return Sd(n,i)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),F(this,"deleteSession",async r=>{var n;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,fe("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(gh).catch(u=>this.client.logger.warn(u)),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=$t.idle),await Promise.all(this.getPendingSessionRequests().filter(u=>u.topic===i).map(u=>this.deletePendingSessionRequest(u.id,fe("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),F(this,"deleteProposal",async(r,n)=>{if(n)try{const i=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(Rr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,fe("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=$t.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),F(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,me(Be.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),F(this,"setAuthRequest",async(r,n)=>{const{request:i,pairingTopic:s,transportType:o=ue.relay}=n;this.client.core.expirer.set(r,i.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:r,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||me(Be.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:f={}}=r,p=Zt(i,s,c);let d;const g=!!l;try{const I=g?vr:Je;d=await this.client.core.crypto.encode(n,p,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),I}let y;if(hO.includes(i)){const I=dt(JSON.stringify(p)),b=dt(d);y=await this.client.core.verify.register({id:b,decryptedId:I})}const x=ne(ne({},Be[i].req),f);if(x.attestation=y,o&&(x.ttl=o),a&&(x.id=a),this.client.core.history.set(n,p),g){const I=Ci(l,n,d);await global.Linking.openURL(I,this.client.name)}else x.tvf=Pe(ne({},h),{correlationId:p.id}),u?(x.internal=Pe(ne({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,d,x)):this.client.core.relayer.publish(n,d,x).catch(I=>this.client.logger.error(I));return p.id}),F(this,"sendProposeSession",async r=>{const{proposal:n,publishOpts:i}=r,s=Zt("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,s);const o=await this.client.core.crypto.encode(n.pairingTopic,s,{encoding:Je}),a=dt(JSON.stringify(s)),c=dt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Pe(ne({},i),{publishMethod:"wc_proposeSession",attestation:u})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:n,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=cs(s.id,i),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:Je}),l=Zt("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(n,l,{encoding:Je});this.client.core.history.set(n,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:Pe(ne({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=cs(n,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?vr:Je;l=await this.client.core.crypto.encode(i,u,Pe(ne({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),d}let f,p;try{f=await this.client.core.history.get(i,n);const d=f.request;try{p=this.getTVFParams(n,d.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),d}if(h){const d=Ci(c,i,l);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Be[d].res;g.tvf=Pe(ne({},p),{correlationId:n}),o?(g.internal=Pe(ne({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,g)):this.client.core.relayer.publish(i,l,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(u)}),F(this,"sendError",async r=>{const{id:n,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=oc(n,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?vr:Je;l=await this.client.core.crypto.encode(i,u,Pe(ne({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let f;try{f=await this.client.core.history.get(i,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),p}if(h){const p=Ci(c,i,l);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Be[p].res;this.client.core.relayer.publish(i,l,d)}await this.client.core.history.resolve(u)}),F(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;pr(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{pr(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===$t.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=$t.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=$t.idle}),F(this,"processRequest",async r=>{const{topic:n,payload:i,attestation:s,transportType:o,encryptedId:a}=r,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:n,payload:i,transportType:s}=r,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:i}=q("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:i,attestation:s,encryptedId:o}=r,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError(Ht.proposal_listener_not_found)),this.isValidConnect(ne({},i.params));const l=a.expiryTimestamp||me(Be.wc_sessionPropose.req.ttl),h=ne({id:c,pairingTopic:n,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:dt(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});u==null||u.addTrace(Bt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(u){await this.sendError({id:c,topic:n,error:u,rpcOpts:Be.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),F(this,"onSessionProposeResponse",async(r,n,i)=>{const{id:s}=n;if(Tt(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(pt(n)){await this.deleteProposal(s);const o=ie("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),F(this,"onSessionSettleRequest",async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=n.params,d=[...this.pendingSessions.values()].find(x=>x.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(d.proposalId),y=Pe(ne(ne(ne({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ue.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(y.topic,y),await this.setExpiry(y.topic,y.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:y.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(y),await this.sendResult({id:n.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:y}),this.events.emit(ie("session_connect",d.proposalId),{session:y})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,n)=>{const{id:i}=n;Tt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ie("session_approve",i),{})):pt(n)&&(await this.client.session.delete(r,fe("USER_DISCONNECTED")),this.events.emit(ie("session_approve",i),{error:n.error}))}),F(this,"onSessionUpdateRequest",async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=Rn.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:fe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ne({topic:r},i));try{Rn.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw Rn.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,n)=>{const{id:i}=n,s=ie("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Tt(n)?this.events.emit(ie("session_update",i),{}):pt(n)&&this.events.emit(ie("session_update",i),{error:n.error})}),F(this,"onSessionExtendRequest",async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,me(cn)),await this.sendResult({id:i,topic:r,result:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,n)=>{const{id:i}=n,s=ie("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Tt(n)?this.events.emit(ie("session_extend",i),{}):pt(n)&&this.events.emit(ie("session_extend",i),{error:n.error})}),F(this,"onSessionPingRequest",async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,n)=>{const{id:i}=n,s=ie("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Tt(n)?this.events.emit(ie("session_ping",i),{}):pt(n)&&this.events.emit(ie("session_ping",i),{error:n.error})},500)}),F(this,"onSessionDeleteRequest",async(r,n)=>{const{id:i}=n;try{await this.isValidDisconnect({topic:r,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:fe("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:i})}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var n,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:f}=a;try{await this.isValidRequest(ne({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:dt(JSON.stringify(Zt("wc_sessionRequest",f,h))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),l===ue.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,n)=>{const{id:i}=n,s=ie("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Tt(n)?this.events.emit(ie("session_request",i),{result:n.result}):pt(n)&&this.events.emit(ie("session_request",i),{error:n.error})}),F(this,"onSessionEventRequest",async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=Rn.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(ne({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),Rn.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),Tt(n)?this.events.emit(ie("session_request",i),{result:n.result}):pt(n)&&this.events.emit(ie("session_request",i),{error:n.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:dt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:i,transportType:c}),c===ue.link_mode&&(n=u.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:f})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:er,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:p,rpcOpts:Be.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=$t.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(ie("session_request",s.request.id),{error:n})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===$t.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=$t.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:Zt("wc_sessionPropose",Pe(ne({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Ge(r)){const{message:u}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(De(n)||await this.isValidPairingTopic(n),!s8(c)){const{message:u}=q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(i&&!De(i)&&ti(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!De(s)&&ti(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!De(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!De(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),F(this,"validateNamespaces",(r,n)=>{const i=i8(r,"connect()",n);if(i)throw new Error(i.message)}),F(this,"isValidApprove",async r=>{if(!Ge(r))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),u=Io(i,"approve()");if(u)throw new Error(u.message);const l=Nl(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!ye(s,!0)){const{message:h}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!De(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!De(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Ge(r)){const{message:s}=q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!a8(i)){const{message:s}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Ge(r)){const{message:u}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!lp(n)){const{message:u}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=X_(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Io(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(pr(o)){const{message:u}=q("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),F(this,"isValidUpdate",async r=>{if(!Ge(r)){const{message:c}=q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=Io(i,"update()");if(o)throw new Error(o.message);const a=Nl(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Ge(r)){const{message:i}=q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),F(this,"isValidRequest",async r=>{if(!Ge(r)){const{message:c}=q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Cl(a,s)){const{message:c}=q("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!c8(i)){const{message:c}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!h8(a,s,i.method)){const{message:c}=q("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async r=>{var n;if(!Ge(r)){const{message:a}=q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(a){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),a}if(!u8(s)){const{message:a}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==i){const{message:a}=q("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),F(this,"isValidPing",async r=>{if(!Ge(r)){const{message:i}=q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidEmit",async r=>{if(!Ge(r)){const{message:a}=q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Cl(o,s)){const{message:a}=q("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!l8(i)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!f8(o,s,i.name)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Ge(r)){const{message:i}=q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidAuthenticate",r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!ye(i,!1))throw new Error("uri is required parameter");if(!ye(s,!1))throw new Error("domain is required parameter");if(!ye(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Li(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Li(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:n,hash:i,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Kn,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ue.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((i,s)=>{if(i==null){const{message:o}=q("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),F(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=q("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}),F(this,"isLinkModeEnabled",(r,n)=>{var i,s,o,a,c,u,l,h,f;return!r||n!==ue.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,n)=>{var i;return this.isLinkModeEnabled(r,n)?(i=r==null?void 0:r.redirect)==null?void 0:i.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=Hu(r,"topic")||"",i=decodeURIComponent(Hu(r,"wc_ev")||""),s=this.client.session.keys.includes(n);s&&this.client.session.update(n,{transportType:ue.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Ga()||Ar()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),F(this,"getTVFApproveParams",r=>{try{const n=ap(r.namespaces),i=L_(r.namespaces),s=F_(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:n,approvedMethods:i,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(r,n,i)=>{var s,o,a;if(!((s=n.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[n.request.method],chainId:n.chainId};try{const u=this.extractTxHashesFromResult(n.request,i);c.txHashes=u,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),F(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const i=(r==null?void 0:r.data)||((n=r==null?void 0:r[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,n)=>{var i;try{if(!n)return[];const s=r.method,o=uO[s];if(s==="sui_signTransaction")return[Ox(n.transactionBytes)];if(s==="near_signTransaction")return[el(n)];if(s==="near_signTransactions")return n.map(c=>el(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=n.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[B8({transaction:r.params.transactionPayload,signature:n.signature})];if(s==="algo_signTxn")return vn(n)?n.map(c=>tl(c)):[tl(n)];if(s==="cosmos_signDirect")return[$x(n)];if(s==="wallet_sendCalls")return Bx(n);if(typeof n=="string")return[n];const a=n[o.key];if(vn(a))return s==="solana_signAllTransactions"?a.map(c=>Dx(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(r))for(const s of i)try{await this.onProviderMessageEvent({topic:n,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(de.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(ji)?this.client.auth.authKeys.get(ji):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:s===ue.link_mode?vr:Je});ac(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:i,transportType:s,encryptedId:dt(n)})):As(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ht.expired,async e=>{const{topic:r,id:n}=cd(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,q("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(kr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(kr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ye(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(pr(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ye(e,!1)){const{message:r}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(pr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=q("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=q("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ye(e,!1)){const{message:r}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!o8(e)){const{message:r}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(pr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!g8(e,Po)){const{message:r}=q("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Po.min} and ${Po.max}`);throw new Error(r)}}}class _O extends Xr{constructor(e,r){super(e,r,oO,uc),this.core=e,this.logger=r}}class IO extends Xr{constructor(e,r){super(e,r,aO,uc),this.core=e,this.logger=r}}class SO extends Xr{constructor(e,r){super(e,r,lO,uc,n=>n.id),this.core=e,this.logger=r}}class DO extends Xr{constructor(e,r){super(e,r,pO,Bs,()=>ji),this.core=e,this.logger=r}}class OO extends Xr{constructor(e,r){super(e,r,gO,Bs),this.core=e,this.logger=r}}class AO extends Xr{constructor(e,r){super(e,r,yO,Bs,n=>n.id),this.core=e,this.logger=r}}var $O=Object.defineProperty,BO=(t,e,r)=>e in t?$O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,To=(t,e,r)=>BO(t,typeof e!="symbol"?e+"":e,r);class PO{constructor(e,r){this.core=e,this.logger=r,To(this,"authKeys"),To(this,"pairingTopics"),To(this,"requests"),this.authKeys=new DO(this.core,this.logger),this.pairingTopics=new OO(this.core,this.logger),this.requests=new AO(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var TO=Object.defineProperty,RO=(t,e,r)=>e in t?TO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e,r)=>RO(t,typeof e!="symbol"?e+"":e,r);class lc extends f0{constructor(e){super(e),te(this,"protocol",Tp),te(this,"version",Rp),te(this,"name",Bo.name),te(this,"metadata"),te(this,"core"),te(this,"logger"),te(this,"events",new It.EventEmitter),te(this,"engine"),te(this,"session"),te(this,"proposal"),te(this,"pendingRequest"),te(this,"auth"),te(this,"signConfig"),te(this,"on",(n,i)=>this.events.on(n,i)),te(this,"once",(n,i)=>this.events.once(n,i)),te(this,"off",(n,i)=>this.events.off(n,i)),te(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),te(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),te(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),te(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(s){throw this.logger.error(s.message),s}}),te(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),te(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Bo.name,this.metadata=mE(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=hp({logger:(e==null?void 0:e.logger)||Bo.logger,name:this.name});this.logger=r,this.core=(e==null?void 0:e.core)||new sO(e),this.session=new IO(this.core,this.logger),this.proposal=new _O(this.core,this.logger),this.pendingRequest=new SO(this.core,this.logger),this.engine=new xO(this),this.auth=new PO(this.core,this.logger)}static async init(e){const r=new lc(e);return await r.initialize(),r}get context(){return tt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const CO="2b0ddf4a2e6e6a53f52d2bcb9a0c2e0f",NO={name:"Kairos 777",description:"AI-Powered Trading Platform  Trade crypto with bots, charts & on-chain execution",url:"https://kairos-trade.netlify.app",icons:["https://kairos-trade.netlify.app/icons/icon-192.png"]},UO=["eip155:56","eip155:1","eip155:137","eip155:42161","eip155:43114","eip155:8453"],kO=["eth_sendTransaction","personal_sign","eth_signTypedData_v4"],LO=["chainChanged","accountsChanged"];let Me=null,se=null,Rt={};const hc="kairos_wc_session";function Np(t){try{localStorage.setItem(hc,JSON.stringify({topic:t.topic,namespaces:t.namespaces,peer:t.peer,expiry:t.expiry}))}catch{}}function FO(){try{const t=localStorage.getItem(hc);return t?JSON.parse(t):null}catch{return null}}function zi(){localStorage.removeItem(hc)}async function MO(){if(Me)return Me;Me=await lc.init({projectId:CO,metadata:NO}),Me.on("session_event",({topic:e,params:r})=>{const{event:n}=r;Rt.onSessionEvent&&Rt.onSessionEvent(n)}),Me.on("session_update",({topic:e,params:r})=>{const{namespaces:n}=r;se&&se.topic===e&&(se={...se,namespaces:n},Np(se),Rt.onSessionUpdate&&Rt.onSessionUpdate(se))}),Me.on("session_delete",({topic:e})=>{se&&se.topic===e&&(se=null,zi(),Rt.onDisconnect&&Rt.onDisconnect())});const t=FO();if(t!=null&&t.topic)try{const r=Me.session.getAll().find(n=>n.topic===t.topic);r?(se=r,Rt.onReconnect&&Rt.onReconnect(r)):zi()}catch{zi()}return Me}function IA(t){Rt={...Rt,...t}}async function SA(){const t=await MO(),{uri:e,approval:r}=await t.connect({requiredNamespaces:{eip155:{chains:UO,methods:kO,events:LO}}});return{uri:e,waitForApproval:async()=>{const n=await r();return se=n,Np(n),n}}}async function DA(){if(!(!Me||!se)){try{await Me.disconnect({topic:se.topic,reason:{code:6e3,message:"User disconnected"}})}catch{}se=null,zi()}}function OA(){var s,o,a,c,u,l,h;if(!se)return null;const t=(s=se.namespaces)==null?void 0:s.eip155;if(!((o=t==null?void 0:t.accounts)!=null&&o.length))return null;const[e,r,n]=t.accounts[0].split(":"),i=[...new Set(t.accounts.map(f=>parseInt(f.split(":")[1])))];return{address:n,chainId:parseInt(r),chains:i,peerName:((c=(a=se.peer)==null?void 0:a.metadata)==null?void 0:c.name)||"External Wallet",peerIcon:((h=(l=(u=se.peer)==null?void 0:u.metadata)==null?void 0:l.icons)==null?void 0:h[0])||null}}function AA(){return!!se}function $A(){return se}async function BA(t,e){if(!Me||!se)throw new Error("Wallet not connected");return await Me.request({topic:se.topic,chainId:`eip155:${t}`,request:{method:"eth_sendTransaction",params:[e]}})}async function PA(t,e){var o,a;if(!Me||!se)throw new Error("Wallet not connected");const r=(o=se.namespaces)==null?void 0:o.eip155,n=(a=r==null?void 0:r.accounts)==null?void 0:a.find(c=>c.toLowerCase().includes(t.toLowerCase())),i=n?n.split(":")[1]:"56";return await Me.request({topic:se.topic,chainId:`eip155:${i}`,request:{method:"personal_sign",params:[e,t]}})}async function TA(t,e){var o,a;if(!Me||!se)throw new Error("Wallet not connected");const r=(o=se.namespaces)==null?void 0:o.eip155,n=(a=r==null?void 0:r.accounts)==null?void 0:a.find(c=>c.toLowerCase().includes(t.toLowerCase())),i=n?n.split(":")[1]:"56";return await Me.request({topic:se.topic,chainId:`eip155:${i}`,request:{method:"eth_signTypedData_v4",params:[t,typeof e=="string"?e:JSON.stringify(e)]}})}function RA(t){return t?`${t.slice(0,6)}${t.slice(-4)}`:""}export{SA as connect,DA as disconnect,RA as formatAddress,OA as getConnectedAccount,$A as getSession,MO as initWCClient,AA as isConnected,BA as sendTransaction,IA as setCallbacks,PA as signMessage,TA as signTypedData};
//# sourceMappingURL=walletConnectDApp-DdyjF_hI.js.map
