{"version":3,"file":"RiskDashboard-C3AzEtWC.js","sources":["../../src/components/Risk/RiskDashboard.jsx"],"sourcesContent":["// Kairos Trade — Risk Dashboard (Elite Feature)\n// Real-time exposure tracking, risk metrics, and portfolio heat map\nimport { useState, useMemo, useEffect } from 'react';\nimport {\n  Shield, AlertTriangle, BarChart3, TrendingDown, TrendingUp,\n  Activity, DollarSign, Percent, PieChart, Eye, Lock, Unlock\n} from 'lucide-react';\nimport useStore from '../../store/useStore';\nimport { tradingEngine } from '../../services/tradingEngine';\n\n// ─── Donut chart (SVG) ───\nfunction DonutChart({ segments, size = 120, strokeWidth = 14 }) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = 2 * Math.PI * radius;\n  let offset = 0;\n\n  return (\n    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className=\"transform -rotate-90\">\n      {segments.map((seg, i) => {\n        const dashLength = (seg.value / 100) * circumference;\n        const dashOffset = -offset;\n        offset += dashLength;\n        return (\n          <circle\n            key={i}\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke={seg.color}\n            strokeWidth={strokeWidth}\n            strokeDasharray={`${dashLength} ${circumference - dashLength}`}\n            strokeDashoffset={dashOffset}\n            strokeLinecap=\"round\"\n          />\n        );\n      })}\n    </svg>\n  );\n}\n\n// ─── Risk meter ───\nfunction RiskMeter({ value, max = 100, label }) {\n  const pct = Math.min((value / max) * 100, 100);\n  const color = pct < 30 ? '#10B981' : pct < 60 ? '#F59E0B' : '#EF4444';\n  return (\n    <div className=\"space-y-1\">\n      <div className=\"flex justify-between text-[10px]\">\n        <span className=\"text-[var(--text-dim)]\">{label}</span>\n        <span style={{ color }} className=\"font-bold\">{value.toFixed(1)}%</span>\n      </div>\n      <div className=\"h-1.5 bg-[var(--dark-4)] rounded-full overflow-hidden\">\n        <div\n          className=\"h-full rounded-full transition-all duration-500\"\n          style={{ width: `${pct}%`, background: color }}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default function RiskDashboard() {\n  const { bots, brokers, positions, tradeHistory, settings } = useStore();\n  const [refreshKey, setRefreshKey] = useState(0);\n\n  // Auto-refresh every 10 seconds\n  useEffect(() => {\n    const interval = setInterval(() => setRefreshKey(k => k + 1), 10000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // Compute risk metrics\n  const riskData = useMemo(() => {\n    const activeBots = bots.filter(b => b.status === 'active');\n    const connectedBrokers = brokers.filter(b => b.connected);\n    const openPositions = positions || [];\n    const trades = tradeHistory || [];\n\n    // Total exposure (sum of all open positions' USD value)\n    let totalExposure = 0;\n    const exposureByPair = {};\n    const exposureByBroker = {};\n\n    openPositions.forEach(pos => {\n      const value = (pos.quantity || 0) * (pos.currentPrice || pos.entryPrice || 0);\n      totalExposure += value;\n      const pair = pos.pair || 'Unknown';\n      exposureByPair[pair] = (exposureByPair[pair] || 0) + value;\n      const broker = pos.botName || 'Manual';\n      exposureByBroker[broker] = (exposureByBroker[broker] || 0) + value;\n    });\n\n    // Add active bot positions from engine\n    activeBots.forEach(bot => {\n      const liveData = tradingEngine.getLiveData(bot.id);\n      if (liveData?.position) {\n        const value = (liveData.position.quantity || 0) * (liveData.price || liveData.position.entryPrice || 0);\n        if (!openPositions.some(p => p.botId === bot.id)) {\n          totalExposure += value;\n          const pair = bot.pair || 'Unknown';\n          exposureByPair[pair] = (exposureByPair[pair] || 0) + value;\n        }\n      }\n    });\n\n    // Estimated total balance\n    const totalBalance = bots.reduce((s, b) => s + (b.balance || 0), 0) || 1000;\n\n    // Current unrealized P&L\n    let unrealizedPnl = 0;\n    activeBots.forEach(bot => {\n      const ld = tradingEngine.getLiveData(bot.id);\n      if (ld?.unrealizedPnl) unrealizedPnl += ld.unrealizedPnl;\n    });\n\n    // Risk metrics from trade history\n    const recentTrades = trades.slice(-100);\n    const wins = recentTrades.filter(t => (t.pnl || 0) > 0).length;\n    const losses = recentTrades.filter(t => (t.pnl || 0) < 0).length;\n    const winRate = recentTrades.length > 0 ? (wins / recentTrades.length) * 100 : 0;\n\n    // Max drawdown (from trade history)\n    let peak = 0, maxDD = 0, equity = 0;\n    trades.forEach(t => {\n      equity += (t.pnl || 0);\n      peak = Math.max(peak, equity);\n      const dd = peak > 0 ? ((peak - equity) / peak) * 100 : 0;\n      maxDD = Math.max(maxDD, dd);\n    });\n\n    // Daily VaR (Value at Risk) — simplified historical method\n    const dailyReturns = [];\n    const dailyPnl = {};\n    trades.forEach(t => {\n      const d = new Date(t.closedAt || t.time).toLocaleDateString();\n      dailyPnl[d] = (dailyPnl[d] || 0) + (t.pnl || 0);\n    });\n    Object.values(dailyPnl).forEach(pnl => {\n      dailyReturns.push(pnl / Math.max(totalBalance, 1));\n    });\n    dailyReturns.sort((a, b) => a - b);\n    const var95idx = Math.floor(dailyReturns.length * 0.05);\n    const var95 = dailyReturns.length > 5 ? Math.abs(dailyReturns[var95idx] || 0) * 100 : 0;\n\n    // Concentration risk\n    const pairEntries = Object.entries(exposureByPair);\n    const maxPairExposure = pairEntries.length > 0\n      ? Math.max(...pairEntries.map(([, v]) => v)) / Math.max(totalExposure, 1) * 100\n      : 0;\n\n    // Leverage used\n    const leverageUsed = totalBalance > 0 ? (totalExposure / totalBalance) : 0;\n\n    // Risk score (0-100)\n    let riskScore = 0;\n    riskScore += Math.min(maxDD, 40); // Max drawdown contribution\n    riskScore += Math.min(leverageUsed * 20, 30); // Leverage contribution\n    riskScore += Math.min(maxPairExposure * 0.3, 20); // Concentration contribution\n    riskScore += (100 - winRate) * 0.1; // Win rate contribution\n    riskScore = Math.min(Math.max(riskScore, 0), 100);\n\n    return {\n      totalExposure,\n      totalBalance,\n      unrealizedPnl,\n      winRate,\n      maxDrawdown: maxDD,\n      var95,\n      maxPairExposure,\n      leverageUsed,\n      riskScore,\n      activeBots: activeBots.length,\n      openPositions: openPositions.length,\n      exposureByPair,\n      exposureByBroker,\n      recentTrades: recentTrades.length,\n    };\n  }, [bots, brokers, positions, tradeHistory, refreshKey]);\n\n  const riskLevel = riskData.riskScore < 30 ? 'Bajo' : riskData.riskScore < 60 ? 'Moderado' : 'Alto';\n  const riskColor = riskData.riskScore < 30 ? '#10B981' : riskData.riskScore < 60 ? '#F59E0B' : '#EF4444';\n\n  // Donut segments\n  const pairSegments = (() => {\n    const entries = Object.entries(riskData.exposureByPair);\n    const total = entries.reduce((s, [, v]) => s + v, 0) || 1;\n    const colors = ['#D4AF37', '#3B82F6', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899'];\n    return entries.map(([pair, value], i) => ({\n      label: pair,\n      value: (value / total) * 100,\n      color: colors[i % colors.length],\n    }));\n  })();\n\n  return (\n    <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-xl font-bold flex items-center gap-2\">\n            <Shield size={22} className=\"text-[var(--gold)]\" /> Risk Dashboard\n          </h1>\n          <p className=\"text-sm text-[var(--text-dim)]\">Gestión de riesgo en tiempo real</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className={`px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5`}\n            style={{ background: `${riskColor}20`, color: riskColor }}>\n            <Shield size={12} />\n            Riesgo {riskLevel} ({riskData.riskScore.toFixed(0)}/100)\n          </div>\n        </div>\n      </div>\n\n      {/* Main Risk Score */}\n      <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-6\">\n        <div className=\"flex items-center gap-8\">\n          {/* Risk gauge */}\n          <div className=\"relative\">\n            <svg width=\"140\" height=\"80\" viewBox=\"0 0 140 80\">\n              <path d=\"M 10 75 A 60 60 0 0 1 130 75\" fill=\"none\" stroke=\"var(--dark-4)\" strokeWidth=\"8\" strokeLinecap=\"round\" />\n              <path\n                d=\"M 10 75 A 60 60 0 0 1 130 75\"\n                fill=\"none\"\n                stroke={riskColor}\n                strokeWidth=\"8\"\n                strokeLinecap=\"round\"\n                strokeDasharray={`${(riskData.riskScore / 100) * 188} 188`}\n              />\n            </svg>\n            <div className=\"absolute bottom-0 left-1/2 -translate-x-1/2 text-center\">\n              <p className=\"text-2xl font-black\" style={{ color: riskColor }}>{riskData.riskScore.toFixed(0)}</p>\n              <p className=\"text-[10px] text-[var(--text-dim)]\">Risk Score</p>\n            </div>\n          </div>\n\n          {/* Risk breakdown */}\n          <div className=\"flex-1 space-y-2\">\n            <RiskMeter label=\"Max Drawdown\" value={riskData.maxDrawdown} max={50} />\n            <RiskMeter label=\"Apalancamiento\" value={riskData.leverageUsed * 100} max={300} />\n            <RiskMeter label=\"Concentración\" value={riskData.maxPairExposure} max={100} />\n            <RiskMeter label=\"VaR (95%)\" value={riskData.var95} max={20} />\n          </div>\n        </div>\n      </div>\n\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n        {[\n          { icon: DollarSign, label: 'Exposición Total', value: `$${riskData.totalExposure.toFixed(2)}`, color: 'var(--gold)' },\n          { icon: Activity, label: 'P&L No Realizado', value: `${riskData.unrealizedPnl >= 0 ? '+' : ''}$${riskData.unrealizedPnl.toFixed(2)}`, color: riskData.unrealizedPnl >= 0 ? '#10B981' : '#EF4444' },\n          { icon: Eye, label: 'Posiciones Abiertas', value: `${riskData.openPositions}`, color: '#3B82F6' },\n          { icon: TrendingDown, label: 'Max Drawdown', value: `${riskData.maxDrawdown.toFixed(1)}%`, color: riskData.maxDrawdown < 10 ? '#10B981' : '#EF4444' },\n        ].map((item, i) => {\n          const Icon = item.icon;\n          return (\n            <div key={i} className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3\">\n              <div className=\"flex items-center gap-2 text-[var(--text-dim)] mb-1\">\n                <Icon size={14} style={{ color: item.color }} />\n                <span className=\"text-[10px]\">{item.label}</span>\n              </div>\n              <p className=\"text-base font-bold\" style={{ color: item.color }}>{item.value}</p>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Exposure by Pair */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4\">\n          <h3 className=\"text-sm font-bold flex items-center gap-2 mb-4\">\n            <PieChart size={14} className=\"text-[var(--gold)]\" /> Exposición por Par\n          </h3>\n          {pairSegments.length > 0 ? (\n            <div className=\"flex items-center gap-4\">\n              <DonutChart segments={pairSegments} />\n              <div className=\"space-y-2 flex-1\">\n                {pairSegments.map((seg, i) => (\n                  <div key={i} className=\"flex items-center gap-2\">\n                    <div className=\"w-2.5 h-2.5 rounded-full\" style={{ background: seg.color }} />\n                    <span className=\"text-xs flex-1\">{seg.label}</span>\n                    <span className=\"text-xs font-bold\" style={{ color: seg.color }}>{seg.value.toFixed(1)}%</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          ) : (\n            <p className=\"text-xs text-[var(--text-dim)] text-center py-6\">Sin posiciones abiertas</p>\n          )}\n        </div>\n\n        {/* Active Bots Risk */}\n        <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4\">\n          <h3 className=\"text-sm font-bold flex items-center gap-2 mb-4\">\n            <AlertTriangle size={14} className=\"text-[var(--gold)]\" /> Bots Activos — Riesgo\n          </h3>\n          {bots.filter(b => b.status === 'active').length > 0 ? (\n            <div className=\"space-y-2\">\n              {bots.filter(b => b.status === 'active').map(bot => {\n                const ld = tradingEngine.getLiveData(bot.id);\n                const hasPosition = !!ld?.position;\n                const pnl = ld?.unrealizedPnl || 0;\n                const riskPct = bot.riskPercent || settings.maxRiskPerTrade || 2;\n                return (\n                  <div key={bot.id} className=\"flex items-center gap-2 p-2 rounded-lg bg-[var(--dark)]\">\n                    <div className={`w-2 h-2 rounded-full ${hasPosition ? 'bg-[var(--gold)]' : 'bg-emerald-500'} animate-pulse`} />\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-xs font-bold truncate\">{bot.name}</p>\n                      <p className=\"text-[10px] text-[var(--text-dim)]\">{bot.pair} • {riskPct}% riesgo</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className={`text-xs font-bold ${pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>\n                        {hasPosition ? `${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}` : 'Esperando'}\n                      </p>\n                      <p className=\"text-[10px] text-[var(--text-dim)]\">\n                        {hasPosition ? `${ld.position.side.toUpperCase()} @ $${ld.position.entryPrice.toFixed(2)}` : '—'}\n                      </p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <p className=\"text-xs text-[var(--text-dim)] text-center py-6\">No hay bots activos</p>\n          )}\n        </div>\n      </div>\n\n      {/* Risk Rules */}\n      <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4\">\n        <h3 className=\"text-sm font-bold flex items-center gap-2 mb-3\">\n          <Lock size={14} className=\"text-[var(--gold)]\" /> Reglas de Riesgo\n        </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n          {[\n            { label: 'Riesgo Máx por Trade', value: `${settings.maxRiskPerTrade || 2}%`, status: true },\n            { label: 'Apalancamiento Máx', value: `${settings.defaultLeverage || 1}x`, status: true },\n            { label: 'Max Drawdown Permitido', value: '25%', status: riskData.maxDrawdown < 25 },\n            { label: 'Máx Posiciones Simultáneas', value: `${bots.filter(b => b.status === 'active').length}`, status: true },\n            { label: 'Trailing Stop', value: bots.some(b => b.trailingStop) ? 'Activo' : 'Inactivo', status: bots.some(b => b.trailingStop) },\n            { label: 'Notificaciones', value: settings.notifications ? 'Activas' : 'Inactivas', status: settings.notifications },\n          ].map((rule, i) => (\n            <div key={i} className=\"flex items-center gap-2 p-2 rounded-lg bg-[var(--dark)]\">\n              {rule.status\n                ? <Lock size={12} className=\"text-emerald-400 shrink-0\" />\n                : <Unlock size={12} className=\"text-red-400 shrink-0\" />\n              }\n              <div className=\"flex-1\">\n                <p className=\"text-[10px] text-[var(--text-dim)]\">{rule.label}</p>\n                <p className=\"text-xs font-bold\">{rule.value}</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["DonutChart","segments","size","strokeWidth","radius","circumference","offset","seg","i","dashLength","dashOffset","jsx","RiskMeter","value","max","label","pct","color","jsxs","RiskDashboard","bots","brokers","positions","tradeHistory","settings","useStore","refreshKey","setRefreshKey","useState","useEffect","interval","k","riskData","useMemo","activeBots","b","openPositions","trades","totalExposure","exposureByPair","exposureByBroker","pos","pair","broker","bot","liveData","tradingEngine","p","totalBalance","s","unrealizedPnl","ld","recentTrades","wins","t","winRate","peak","maxDD","equity","dd","dailyReturns","dailyPnl","d","pnl","var95idx","var95","pairEntries","maxPairExposure","v","leverageUsed","riskScore","riskLevel","riskColor","pairSegments","entries","total","colors","Shield","DollarSign","Activity","Eye","TrendingDown","item","Icon","PieChart","AlertTriangle","hasPosition","riskPct","Lock","rule","Unlock"],"mappings":"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"}