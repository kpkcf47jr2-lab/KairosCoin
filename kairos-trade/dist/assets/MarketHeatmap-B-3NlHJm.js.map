{"version":3,"file":"MarketHeatmap-B-3NlHJm.js","sources":["../../src/components/Dashboard/MarketHeatmap.jsx"],"sourcesContent":["// Kairos Trade — Market Heatmap (Color-coded crypto performance grid)\nimport { useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { Grid3x3, RefreshCw, ArrowUpRight, ArrowDownRight, Clock } from 'lucide-react';\nimport useStore from '../../store/useStore';\nimport marketData from '../../services/marketData';\nimport { toDisplayPair, getBase } from '../../utils/pairUtils';\n\nconst PAIRS = [\n  'BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 'ADAUSDT',\n  'DOGEUSDT', 'AVAXUSDT', 'DOTUSDT', 'MATICUSDT', 'LINKUSDT', 'UNIUSDT',\n  'LTCUSDT', 'ATOMUSDT', 'ARBUSDT', 'OPUSDT', 'NEARUSDT', 'FTMUSDT',\n  'APTUSDT', 'INJUSDT', 'SUIUSDT', 'SEIUSDT', 'TIAUSDT', 'JUPUSDT',\n];\n\nexport default function MarketHeatmap() {\n  const { setPage, setSelectedPair } = useStore();\n  const [data, setData] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [lastUpdate, setLastUpdate] = useState(null);\n  const [sortBy, setSortBy] = useState('change'); // change | volume | name\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      const results = await Promise.all(\n        PAIRS.map(async (pair) => {\n          try {\n            const t = await marketData.get24hrTicker(pair);\n            return t;\n          } catch { return null; }\n        })\n      );\n      setData(results.filter(Boolean));\n      setLastUpdate(new Date());\n    } catch (err) {\n      console.error('Heatmap load error:', err);\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    loadData();\n    const iv = setInterval(loadData, 60000);\n    return () => clearInterval(iv);\n  }, []);\n\n  const sortedData = [...data].sort((a, b) => {\n    if (sortBy === 'change') return Math.abs(b.changePercent) - Math.abs(a.changePercent);\n    if (sortBy === 'volume') return (b.volume || 0) - (a.volume || 0);\n    return getBase(a.symbol).localeCompare(getBase(b.symbol));\n  });\n\n  const maxAbsChange = Math.max(...data.map(d => Math.abs(d.changePercent || 0)), 1);\n\n  const getColor = (change) => {\n    const intensity = Math.min(Math.abs(change) / Math.max(maxAbsChange * 0.7, 1), 1);\n    if (change >= 0) return `rgba(16, 185, 129, ${0.08 + intensity * 0.45})`;\n    return `rgba(239, 68, 68, ${0.08 + intensity * 0.45})`;\n  };\n\n  const getBorderColor = (change) => {\n    const intensity = Math.min(Math.abs(change) / Math.max(maxAbsChange * 0.7, 1), 1);\n    if (change >= 0) return `rgba(16, 185, 129, ${0.15 + intensity * 0.3})`;\n    return `rgba(239, 68, 68, ${0.15 + intensity * 0.3})`;\n  };\n\n  const handleClick = (symbol) => {\n    setSelectedPair(toDisplayPair(symbol));\n    setPage('chart');\n  };\n\n  return (\n    <div className=\"flex-1 overflow-y-auto px-5 py-5 space-y-5\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between gap-3\">\n        <div className=\"min-w-0\">\n          <h1 className=\"text-lg font-bold flex items-center gap-2\">\n            <Grid3x3 size={20} className=\"text-[var(--gold)]\" />\n            Market Heatmap\n          </h1>\n          <p className=\"text-xs text-[var(--text-dim)]\">\n            Rendimiento 24h de las principales criptomonedas\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          {lastUpdate && (\n            <span className=\"text-[10px] text-[var(--text-dim)] flex items-center gap-1\">\n              <Clock size={10} />\n              {lastUpdate.toLocaleTimeString()}\n            </span>\n          )}\n          <button\n            onClick={loadData}\n            disabled={loading}\n            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--gold)] transition-all border border-[var(--border)]\"\n          >\n            <RefreshCw size={12} className={loading ? 'animate-spin' : ''} />\n            Actualizar\n          </button>\n        </div>\n      </div>\n\n      {/* Sort controls */}\n      <div className=\"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit\">\n        {[\n          { id: 'change', label: 'Por Cambio' },\n          { id: 'volume', label: 'Por Volumen' },\n          { id: 'name', label: 'Alfabético' },\n        ].map(s => (\n          <button\n            key={s.id}\n            onClick={() => setSortBy(s.id)}\n            className={`px-3 py-1.5 text-xs rounded-md transition-colors ${\n              sortBy === s.id ? 'bg-[var(--gold)] text-white font-bold' : 'text-[var(--text-dim)] hover:text-[var(--text)]'\n            }`}\n          >\n            {s.label}\n          </button>\n        ))}\n      </div>\n\n      {/* Summary bar */}\n      {data.length > 0 && (\n        <div className=\"flex gap-4 text-xs\">\n          <span className=\"text-emerald-400 font-semibold\">\n            ↑ {data.filter(d => d.changePercent >= 0).length} subiendo\n          </span>\n          <span className=\"text-red-400 font-semibold\">\n            ↓ {data.filter(d => d.changePercent < 0).length} bajando\n          </span>\n          <span className=\"text-[var(--text-dim)]\">\n            Avg: {(data.reduce((s, d) => s + d.changePercent, 0) / data.length).toFixed(2)}%\n          </span>\n        </div>\n      )}\n\n      {/* Heatmap grid */}\n      {loading && data.length === 0 ? (\n        <div className=\"flex items-center justify-center py-20\">\n          <RefreshCw size={24} className=\"animate-spin text-[var(--text-dim)]\" />\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2.5\">\n          {sortedData.map((ticker, i) => {\n            const base = getBase(ticker.symbol);\n            const change = ticker.changePercent || 0;\n            const isUp = change >= 0;\n            return (\n              <motion.button\n                key={ticker.symbol}\n                initial={{ opacity: 0, scale: 0.95 }}\n                animate={{ opacity: 1, scale: 1 }}\n                transition={{ delay: i * 0.02 }}\n                onClick={() => handleClick(ticker.symbol)}\n                className=\"rounded-xl p-3 text-center transition-all hover:scale-[1.04] group relative\"\n                style={{\n                  background: getColor(change),\n                  border: `1px solid ${getBorderColor(change)}`,\n                }}\n              >\n                {/* Coin symbol */}\n                <p className=\"text-base font-bold mb-1\">{base}</p>\n\n                {/* Price */}\n                <p className=\"text-[11px] font-mono text-[var(--text)] mb-1\">\n                  ${ticker.price?.toLocaleString(undefined, { maximumFractionDigits: ticker.price > 100 ? 0 : 2 })}\n                </p>\n\n                {/* Change */}\n                <div className={`flex items-center justify-center gap-0.5 text-sm font-bold ${isUp ? 'text-emerald-400' : 'text-red-400'}`}>\n                  {isUp ? <ArrowUpRight size={12} /> : <ArrowDownRight size={12} />}\n                  {isUp ? '+' : ''}{change.toFixed(2)}%\n                </div>\n\n                {/* Hover indicator */}\n                <div className=\"absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none\"\n                  style={{ boxShadow: `0 0 20px ${isUp ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.15)'}` }} />\n              </motion.button>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Legend */}\n      <div className=\"flex items-center justify-center gap-6 pt-4 text-[10px] text-[var(--text-dim)]\">\n        <div className=\"flex items-center gap-1.5\">\n          <div className=\"w-4 h-4 rounded\" style={{ background: 'rgba(239,68,68,0.4)' }} />\n          <span>Gran caída</span>\n        </div>\n        <div className=\"flex items-center gap-1.5\">\n          <div className=\"w-4 h-4 rounded\" style={{ background: 'rgba(239,68,68,0.15)' }} />\n          <span>Leve caída</span>\n        </div>\n        <div className=\"flex items-center gap-1.5\">\n          <div className=\"w-4 h-4 rounded\" style={{ background: 'rgba(16,185,129,0.15)' }} />\n          <span>Leve subida</span>\n        </div>\n        <div className=\"flex items-center gap-1.5\">\n          <div className=\"w-4 h-4 rounded\" style={{ background: 'rgba(16,185,129,0.4)' }} />\n          <span>Gran subida</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["PAIRS","MarketHeatmap","setPage","setSelectedPair","useStore","data","setData","useState","loading","setLoading","lastUpdate","setLastUpdate","sortBy","setSortBy","loadData","results","pair","marketData","err","useEffect","iv","sortedData","a","b","getBase","maxAbsChange","d","getColor","change","intensity","getBorderColor","handleClick","symbol","toDisplayPair","jsxs","jsx","Grid3x3","Clock","RefreshCw","s","ticker","i","base","isUp","motion","_a","ArrowUpRight","ArrowDownRight"],"mappings":"yNAQA,MAAMA,EAAQ,CACZ,UAAW,UAAW,UAAW,UAAW,UAAW,UACvD,WAAY,WAAY,UAAW,YAAa,WAAY,UAC5D,UAAW,WAAY,UAAW,SAAU,WAAY,UACxD,UAAW,UAAW,UAAW,UAAW,UAAW,SACzD,EAEA,SAAwBC,GAAgB,CACtC,KAAM,CAAE,QAAAC,EAAS,gBAAAC,CAAA,EAAoBC,EAAA,EAC/B,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,CAAA,CAAE,EAC7B,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAYC,CAAa,EAAIJ,EAAAA,SAAS,IAAI,EAC3C,CAACK,EAAQC,CAAS,EAAIN,EAAAA,SAAS,QAAQ,EAEvCO,EAAW,SAAY,CAC3BL,EAAW,EAAI,EACf,GAAI,CACF,MAAMM,EAAU,MAAM,QAAQ,IAC5Bf,EAAM,IAAI,MAAOgB,GAAS,CACxB,GAAI,CAEF,OADU,MAAMC,EAAW,cAAcD,CAAI,CAE/C,MAAQ,CAAE,OAAO,IAAM,CACzB,CAAC,CAAA,EAEHV,EAAQS,EAAQ,OAAO,OAAO,CAAC,EAC/BJ,EAAc,IAAI,IAAM,CAC1B,OAASO,EAAK,CACZ,QAAQ,MAAM,sBAAuBA,CAAG,CAC1C,CACAT,EAAW,EAAK,CAClB,EAEAU,EAAAA,UAAU,IAAM,CACdL,EAAA,EACA,MAAMM,EAAK,YAAYN,EAAU,GAAK,EACtC,MAAO,IAAM,cAAcM,CAAE,CAC/B,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAa,CAAC,GAAGhB,CAAI,EAAE,KAAK,CAACiB,EAAGC,IAChCX,IAAW,SAAiB,KAAK,IAAIW,EAAE,aAAa,EAAI,KAAK,IAAID,EAAE,aAAa,EAChFV,IAAW,UAAkBW,EAAE,QAAU,IAAMD,EAAE,QAAU,GACxDE,EAAQF,EAAE,MAAM,EAAE,cAAcE,EAAQD,EAAE,MAAM,CAAC,CACzD,EAEKE,EAAe,KAAK,IAAI,GAAGpB,EAAK,IAAIqB,GAAK,KAAK,IAAIA,EAAE,eAAiB,CAAC,CAAC,EAAG,CAAC,EAE3EC,EAAYC,GAAW,CAC3B,MAAMC,EAAY,KAAK,IAAI,KAAK,IAAID,CAAM,EAAI,KAAK,IAAIH,EAAe,GAAK,CAAC,EAAG,CAAC,EAChF,OAAIG,GAAU,EAAU,sBAAsB,IAAOC,EAAY,GAAI,IAC9D,qBAAqB,IAAOA,EAAY,GAAI,GACrD,EAEMC,EAAkBF,GAAW,CACjC,MAAMC,EAAY,KAAK,IAAI,KAAK,IAAID,CAAM,EAAI,KAAK,IAAIH,EAAe,GAAK,CAAC,EAAG,CAAC,EAChF,OAAIG,GAAU,EAAU,sBAAsB,IAAOC,EAAY,EAAG,IAC7D,qBAAqB,IAAOA,EAAY,EAAG,GACpD,EAEME,EAAeC,GAAW,CAC9B7B,EAAgB8B,EAAcD,CAAM,CAAC,EACrC9B,EAAQ,OAAO,CACjB,EAEA,OACEgC,EAAAA,KAAC,MAAA,CAAI,UAAU,6CAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0CACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,UACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,4CACZ,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAQ,KAAM,GAAI,UAAU,qBAAqB,EAAE,gBAAA,EAEtD,EACAD,EAAAA,IAAC,IAAA,CAAE,UAAU,iCAAiC,SAAA,kDAAA,CAE9C,CAAA,EACF,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAAxB,GACCwB,EAAAA,KAAC,OAAA,CAAK,UAAU,6DACd,SAAA,CAAAC,EAAAA,IAACE,EAAA,CAAM,KAAM,EAAA,CAAI,EAChB3B,EAAW,mBAAA,CAAmB,EACjC,EAEFwB,EAAAA,KAAC,SAAA,CACC,QAASpB,EACT,SAAUN,EACV,UAAU,2KAEV,SAAA,CAAA2B,MAACG,GAAU,KAAM,GAAI,UAAW9B,EAAU,eAAiB,GAAI,EAAE,YAAA,CAAA,CAAA,CAEnE,CAAA,CACF,CAAA,EACF,EAGA2B,EAAAA,IAAC,MAAA,CAAI,UAAU,qDACZ,SAAA,CACC,CAAE,GAAI,SAAU,MAAO,YAAA,EACvB,CAAE,GAAI,SAAU,MAAO,aAAA,EACvB,CAAE,GAAI,OAAQ,MAAO,YAAA,CAAa,EAClC,IAAII,GACJJ,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMtB,EAAU0B,EAAE,EAAE,EAC7B,UAAW,oDACT3B,IAAW2B,EAAE,GAAK,wCAA0C,iDAC9D,GAEC,SAAAA,EAAE,KAAA,EANEA,EAAE,EAAA,CAQV,EACH,EAGClC,EAAK,OAAS,GACb6B,EAAAA,KAAC,MAAA,CAAI,UAAU,qBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,iCAAiC,SAAA,CAAA,KAC5C7B,EAAK,OAAOqB,GAAKA,EAAE,eAAiB,CAAC,EAAE,OAAO,WAAA,EACnD,EACAQ,EAAAA,KAAC,OAAA,CAAK,UAAU,6BAA6B,SAAA,CAAA,KACxC7B,EAAK,OAAOqB,GAAKA,EAAE,cAAgB,CAAC,EAAE,OAAO,UAAA,EAClD,EACAQ,EAAAA,KAAC,OAAA,CAAK,UAAU,yBAAyB,SAAA,CAAA,SAChC7B,EAAK,OAAO,CAACkC,EAAGb,IAAMa,EAAIb,EAAE,cAAe,CAAC,EAAIrB,EAAK,QAAQ,QAAQ,CAAC,EAAE,GAAA,CAAA,CACjF,CAAA,EACF,EAIDG,GAAWH,EAAK,SAAW,EAC1B8B,EAAAA,IAAC,OAAI,UAAU,yCACb,SAAAA,EAAAA,IAACG,EAAA,CAAU,KAAM,GAAI,UAAU,qCAAA,CAAsC,CAAA,CACvE,EAEAH,EAAAA,IAAC,MAAA,CAAI,UAAU,yDACZ,SAAAd,EAAW,IAAI,CAACmB,EAAQC,IAAM,OAC7B,MAAMC,EAAOlB,EAAQgB,EAAO,MAAM,EAC5BZ,EAASY,EAAO,eAAiB,EACjCG,EAAOf,GAAU,EACvB,OACEM,EAAAA,KAACU,EAAO,OAAP,CAEC,QAAS,CAAE,QAAS,EAAG,MAAO,GAAA,EAC9B,QAAS,CAAE,QAAS,EAAG,MAAO,CAAA,EAC9B,WAAY,CAAE,MAAOH,EAAI,GAAA,EACzB,QAAS,IAAMV,EAAYS,EAAO,MAAM,EACxC,UAAU,8EACV,MAAO,CACL,WAAYb,EAASC,CAAM,EAC3B,OAAQ,aAAaE,EAAeF,CAAM,CAAC,EAAA,EAI7C,SAAA,CAAAO,EAAAA,IAAC,IAAA,CAAE,UAAU,2BAA4B,SAAAO,EAAK,EAG9CR,EAAAA,KAAC,IAAA,CAAE,UAAU,gDAAgD,SAAA,CAAA,KACzDW,EAAAL,EAAO,QAAP,YAAAK,EAAc,eAAe,OAAW,CAAE,sBAAuBL,EAAO,MAAQ,IAAM,EAAI,CAAA,EAAG,EACjG,SAGC,MAAA,CAAI,UAAW,8DAA8DG,EAAO,mBAAqB,cAAc,GACrH,SAAA,CAAAA,EAAOR,EAAAA,IAACW,GAAa,KAAM,EAAA,CAAI,EAAKX,EAAAA,IAACY,EAAA,CAAe,KAAM,EAAA,CAAI,EAC9DJ,EAAO,IAAM,GAAIf,EAAO,QAAQ,CAAC,EAAE,GAAA,EACtC,EAGAO,EAAAA,IAAC,MAAA,CAAI,UAAU,uGACb,MAAO,CAAE,UAAW,YAAYQ,EAAO,wBAA0B,sBAAsB,EAAA,CAAG,CAAA,CAAG,CAAA,EA3B1FH,EAAO,MAAA,CA8BlB,CAAC,CAAA,CACH,EAIFN,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,MAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,WAAY,uBAAyB,EAC/EA,EAAAA,IAAC,QAAK,SAAA,YAAA,CAAU,CAAA,EAClB,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,MAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,WAAY,wBAA0B,EAChFA,EAAAA,IAAC,QAAK,SAAA,YAAA,CAAU,CAAA,EAClB,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,MAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,WAAY,yBAA2B,EACjFA,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,EACnB,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAC,MAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,WAAY,wBAA0B,EAChFA,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,CAAA,CACnB,CAAA,CAAA,CACF,CAAA,EACF,CAEJ"}