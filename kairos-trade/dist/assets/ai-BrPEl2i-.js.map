{"version":3,"file":"ai-BrPEl2i-.js","sources":["../../src/services/ai.js"],"sourcesContent":["// Kairos Trade ‚Äî AI Trading Expert v2.0\n// Full market analysis engine with Kairos Script generation, chart control, and technical expertise\n// Works 100% locally ‚Äî no API key needed\n\nimport marketData from './marketData';\nimport { calculateEMA, calculateSMA, calculateRSI, calculateMACD, calculateBollingerBands, calculateVWAP, detectCrossover, detectDivergence } from './indicators';\nimport { CHATGPT_PROMPT } from './kairosScript';\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// KNOWLEDGE BASE ‚Äî Trading Education & Terminology\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nconst KB = {\n  ema: 'La **EMA (Media M√≥vil Exponencial)** da m√°s peso a los precios recientes. EMA 20 corto plazo, EMA 50 mediano, EMA 200 largo. Cuando EMA r√°pida cruza encima de la lenta = se√±al de compra (Golden Cross). Cuando cruza debajo = se√±al de venta (Death Cross).',\n  sma: 'La **SMA (Media M√≥vil Simple)** es el promedio aritm√©tico de los √∫ltimos N precios. SMA 200 es la referencia institucional de tendencia a largo plazo.',\n  rsi: 'El **RSI (√çndice de Fuerza Relativa)** mide momentum en escala 0-100. RSI > 70 = sobrecompra (posible ca√≠da), RSI < 30 = sobreventa (posible rebote). Divergencias RSI son se√±ales muy poderosas.',\n  macd: 'El **MACD** mide momentum con: l√≠nea MACD (EMA12 ‚àí EMA26), l√≠nea de se√±al (EMA9 del MACD), e histograma. Cruce alcista = compra. Histograma creciente = momentum positivo.',\n  bollinger: 'Las **Bandas de Bollinger** forman un canal de volatilidad (SMA ¬± 2œÉ). Precio toca banda superior = posible sobrecompra. Compresi√≥n (Squeeze) = explosi√≥n de volatilidad inminente.',\n  vwap: 'El **VWAP** es el precio promedio ponderado por volumen del d√≠a. Price > VWAP = sesgo alcista. Es la principal referencia institucional intraday.',\n  fibonacci: 'Los retrocesos de **Fibonacci** (23.6%, 38.2%, 50%, 61.8%) identifican soporte/resistencia. El 61.8% (golden ratio) es el nivel m√°s respetado.',\n  soporte: '**Soporte** es donde la demanda frena la ca√≠da. **Resistencia** donde la oferta frena la subida. Cuando un soporte se rompe, se convierte en resistencia y viceversa.',\n  tendencia: '**Tendencia alcista** = m√°ximos y m√≠nimos m√°s altos. **Bajista** = m√°ximos y m√≠nimos m√°s bajos. **Nunca operes contra la tendencia principal.**',\n  scalping: '**Scalping** busca ganancias r√°pidas (0.1-0.5%) en timeframes 1-5 min. Requiere spread bajo, ejecuci√≥n r√°pida, y disciplina.',\n  swing: '**Swing trading** captura movimientos de 2-10% en d√≠as o semanas. Timeframes 4h y 1D. Mejor ratio riesgo/recompensa que scalping.',\n  day_trading: '**Day trading** abre y cierra en el mismo d√≠a. Timeframes 5m-1h. No hay riesgo overnight.',\n  riesgo: '**Regla del 1-2%**: Nunca arriesgues m√°s del 1-2% por trade. Si tienes $10,000, p√©rdida m√°xima por operaci√≥n = $100-200.',\n  stop_loss: 'El **Stop Loss** es obligatorio. M√©todos: porcentaje fijo (1-3%), debajo de soporte, ATR multiplier, o swing low/high.',\n  take_profit: '**Take Profit** debe ser al menos 2x tu Stop Loss (ratio 1:2 m√≠nimo). Usa trailing stops para movimientos grandes.',\n  position: '**Position sizing**: Capital √ó Riesgo% √∑ (Entrada ‚àí StopLoss) = Cantidad. Esto controla tu riesgo sin importar el resultado.',\n  doji: '**Doji** = apertura ‚âà cierre. Indica indecisi√≥n. Despu√©s de tendencia fuerte = posible reversal.',\n  engulfing: '**Engulfing bullish** = vela roja + verde que la envuelve. Se√±al alcista fuerte en soporte.',\n  hammer: '**Hammer** = mecha inferior larga en fondo bajista. Indica rechazo de precios bajos = posible reversal alcista.',\n  doble_techo: '**Doble techo** = dos m√°ximos iguales. Reversal bajista. Confirmar con ruptura del neckline.',\n  hch: '**Cabeza y hombros** = tres m√°ximos, central m√°s alto. El patr√≥n de reversal m√°s confiable.',\n  liquidez: '**Liquidez** se concentra en m√°ximos/m√≠nimos iguales, n√∫meros redondos y zonas de alto volumen. Market Makers buscan liquidez antes de moverse.',\n  order_block: '**Order Block** = zona de √≥rdenes institucionales. √öltima vela antes de movimiento impulsivo. Precio regresa a estas zonas.',\n  funding: '**Funding rate** en futuros indica consenso. Funding muy positivo = exceso de longs, posible ca√≠da. Negativo = exceso de shorts, posible subida.',\n  bitcoin: '**Bitcoin (BTC)** es la referencia. ~70% de altcoins siguen a BTC. Siempre analiza BTC primero.',\n  altseason: '**Altseason** = altcoins superan a Bitcoin (BTC dominance baja). Se identifica cuando ETH/BTC sube.',\n  halving: '**Halving** reduce emisi√≥n BTC a la mitad cada ~4 a√±os. Hist√≥ricamente precede bull runs de 12-18 meses.',\n  apalancamiento: '**Apalancamiento** multiplica tu exposici√≥n. 10x = ganas/pierdes 10 veces m√°s r√°pido. Para principiantes: m√°ximo 3x. Profesionales: 5-10x con SL estricto.',\n  volumen: '**Volumen** confirma movimientos. Ruptura con volumen alto = real. Ruptura sin volumen = probable fake out. Volumen creciente en tendencia = saludable.',\n};\n\n// Keyword ‚Üí KB key mapping\nconst KB_MAP = {\n  ema: ['ema', 'media movil exponencial', 'exponential moving', 'golden cross', 'death cross'],\n  sma: ['sma', 'media movil simple', 'simple moving'],\n  rsi: ['rsi', 'fuerza relativa', 'relative strength', 'sobrecompra', 'sobreventa', 'overbought', 'oversold'],\n  macd: ['macd', 'convergencia divergencia', 'histograma'],\n  bollinger: ['bollinger', 'bandas de bollinger', 'bollinger bands', 'squeeze', 'bb '],\n  vwap: ['vwap', 'precio ponderado', 'volume weighted'],\n  fibonacci: ['fibonacci', 'fibo', 'retroceso', 'golden ratio', '61.8'],\n  soporte: ['soporte', 'resistencia', 'support', 'resistance', 'nivel clave'],\n  tendencia: ['tendencia', 'trend', 'alcista', 'bajista', 'lateral', 'rango'],\n  scalping: ['scalping', 'scalp', 'escalpeo'],\n  swing: ['swing trading', 'swing trade'],\n  day_trading: ['day trading', 'intradia', 'intraday'],\n  riesgo: ['riesgo', 'risk management', 'money management', 'gestion de riesgo'],\n  stop_loss: ['stop loss', 'stoploss', 'parar perdida'],\n  take_profit: ['take profit', 'tomar ganancia', 'objetivo de ganancia'],\n  position: ['position sizing', 'tamano de posicion', 'cuanto invertir', 'cuanto comprar', 'cuanto arriesgar'],\n  doji: ['doji', 'vela de indecision'],\n  engulfing: ['engulfing', 'envolvente', 'patron de vela'],\n  hammer: ['hammer', 'martillo', 'pin bar'],\n  doble_techo: ['doble techo', 'double top', 'doble suelo', 'double bottom'],\n  hch: ['cabeza y hombros', 'head and shoulders', 'hch'],\n  liquidez: ['liquidez', 'liquidity', 'market maker'],\n  order_block: ['order block', 'bloque de orden', 'smc', 'smart money'],\n  funding: ['funding', 'funding rate'],\n  bitcoin: ['dominancia', 'btc dominance'],\n  altseason: ['altseason', 'alt season', 'altcoins'],\n  halving: ['halving', 'halvening'],\n  apalancamiento: ['apalancamiento', 'leverage', 'margen', 'margin'],\n  volumen: ['volumen', 'volume', 'vol '],\n};\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// AI SERVICE\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nclass AIService {\n  constructor() {\n    this.apiKey = null;\n    this.model = 'gpt-4o-mini';\n    this.conversationHistory = [];\n    this._cache = new Map();\n    this._cacheTTL = 30000;\n  }\n\n  setApiKey(key) { this.apiKey = key; }\n\n  // ‚îÄ‚îÄ‚îÄ Main entry ‚îÄ‚îÄ‚îÄ\n  async chat(message, marketContext = null) {\n    this.conversationHistory.push({ role: 'user', content: message });\n    try {\n      const intent = this._parseIntent(message);\n      if (this.apiKey) return await this._openAI(message, marketContext, intent);\n      return await this._engine(message, marketContext, intent);\n    } catch (err) {\n      console.error('Kairos AI error:', err);\n      const fb = { text: `‚ö†Ô∏è Error: ${err.message}. Intenta de nuevo.`, strategy: null, kairosScript: null, action: null };\n      this.conversationHistory.push({ role: 'assistant', content: fb.text });\n      return fb;\n    }\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // INTENT PARSER\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  _parseIntent(message) {\n    const msg = message.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n    // Detect pair mentions\n    const pm = message.match(/\\b([A-Z]{2,10})(USDT|USD|BTC|ETH|BNB|BUSD)\\b/i) ||\n      message.match(/\\b(BTC|ETH|SOL|BNB|XRP|ADA|DOGE|AVAX|DOT|MATIC|LINK|UNI|ATOM|NEAR|APT|ARB|OP|SUI|TIA|JUP|WIF|PEPE|SHIB|LTC|BCH|EOS|TRX|FIL|AAVE|MKR|COMP|SNX|CRV|INJ|SEI|MANTA|STRK|PYTH)\\b/i);\n    const detectedPair = pm ? (pm[0].toUpperCase().endsWith('USDT') ? pm[0].toUpperCase() : pm[0].toUpperCase() + 'USDT') : null;\n\n    return {\n      changePair: !!(msg.match(/\\b(cambi|muestra|ponme|pon |abre|ver |quiero ver|busca|grafico de)\\b/)),\n      analyze: !!(msg.match(/\\b(analiz|analisis|como ves|como esta|que ves|revis|resumen|overview)\\b/)),\n      strategy: !!(msg.match(/\\b(estrategia|estratergia|strategy)\\b/)),\n      kairosScript: !!(msg.match(/\\b(script|codigo|code|kairos script)\\b/) || (msg.includes('bot') && msg.match(/\\b(crea|genera|haz|dame)\\b/))),\n      education: !!(msg.match(/\\b(que es|explica|como funciona|ensen|aprend|como se|que significa|diferencia|que son)\\b/)),\n      risk: !!(msg.match(/\\b(riesgo|stop loss|position siz|gestion|cuanto debo|cuanto arriesg)\\b/)),\n      predict: !!(msg.match(/\\b(subir|bajar|precio|target|objetivo|va a|prediccion|pronostico|proyeccion)\\b/)),\n      greeting: !!(msg.match(/^(hola|hey|buenas|saludos|hi|hello|que tal|buenos dias|buenas noches|buenas tardes)\\b/)),\n      help: !!(msg.match(/\\b(ayuda|help|puedes|que sabes|funciones|que haces|capacidades)\\b/)),\n      detectedPair,\n    };\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // LOCAL ENGINE ‚Äî Full analysis without API key\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  async _engine(message, ctx, intent) {\n    const msg = message.toLowerCase();\n\n    if (intent.greeting) {\n      return this._reply(`üëã ¬°Hola! Soy **Kairos AI**, tu experto de trading.\\n\\n` +\n        `Puedo:\\n‚Ä¢ üìä **Analizar cualquier par** ‚Äî \"Analiza ETHUSDT\"\\n‚Ä¢ üéØ **Generar estrategias** ‚Äî \"Dame una estrategia para SOL\"\\n` +\n        `‚Ä¢ üíª **Crear Kairos Script** ‚Äî \"Crea un script para BTC\"\\n‚Ä¢ üîÑ **Cambiar el gr√°fico** ‚Äî \"Mu√©strame SOLUSDT\"\\n` +\n        `‚Ä¢ üìö **Ense√±arte trading** ‚Äî \"¬øQu√© es el RSI?\"\\n\\n¬øEn qu√© te ayudo?`);\n    }\n\n    if (intent.help) {\n      return this._reply(`ü§ñ **Kairos AI ‚Äî Capacidades**\\n\\n` +\n        `üìä **An√°lisis T√©cnico** ‚Äî Calculo EMA, SMA, RSI, MACD, BB, VWAP en tiempo real. Detecto cruces, divergencias, y se√±ales.\\n\\n` +\n        `üéØ **Estrategias** ‚Äî Genero estrategias basadas en el estado actual del mercado con SL/TP calculados.\\n\\n` +\n        `üíª **Kairos Script** ‚Äî Creo c√≥digo que puedes copiar ‚Üí paste en un Script Bot ‚Üí el bot lo ejecuta autom√°ticamente.\\n\\n` +\n        `üîÑ **Control del Gr√°fico** ‚Äî \"Mu√©strame SOL\" y cambio el par en pantalla.\\n\\n` +\n        `üìö **Educaci√≥n** ‚Äî Preg√∫ntame sobre cualquier indicador, patr√≥n o concepto.\\n\\n` +\n        `Prueba: **\"Analiza BTC y crea un script ganador\"**`);\n    }\n\n    // Change pair\n    if (intent.changePair && intent.detectedPair) {\n      const pair = intent.detectedPair;\n      try {\n        const a = await this._analyze(pair);\n        return this._reply(`üîÑ **Cambiando a ${pair}**\\n\\n${this._quickSummary(pair, a)}\\n\\n¬øQuieres un an√°lisis completo o un script para ${pair}?`, null, null, { type: 'changePair', pair });\n      } catch {\n        return this._reply(`üîÑ **Cambiando a ${pair}**\\nCargando datos...`, null, null, { type: 'changePair', pair });\n      }\n    }\n\n    // Kairos Script\n    if (intent.kairosScript || (intent.strategy && (msg.includes('script') || msg.includes('codigo') || msg.includes('bot')))) {\n      const pair = intent.detectedPair || ctx?.symbol || 'BTCUSDT';\n      return await this._genScript(pair, ctx);\n    }\n\n    // Strategy\n    if (intent.strategy) {\n      const pair = intent.detectedPair || ctx?.symbol || 'BTCUSDT';\n      return await this._genStrategy(pair, ctx);\n    }\n\n    // Analyze / predict\n    if (intent.analyze || intent.predict) {\n      const pair = intent.detectedPair || ctx?.symbol || 'BTCUSDT';\n      return await this._fullAnalysis(pair, ctx);\n    }\n\n    // Education\n    if (intent.education || intent.risk) return this._educate(message);\n\n    // Pair mentioned without clear intent ‚Üí analyze + change\n    if (intent.detectedPair) {\n      const pair = intent.detectedPair;\n      return await this._fullAnalysis(pair, ctx, { type: 'changePair', pair });\n    }\n\n    // Try knowledge base\n    const kb = this._matchKB(msg);\n    if (kb) return this._reply(kb);\n\n    // Fallback\n    return this._reply(`ü§ñ Entiendo: \"${message}\"\\n\\nPuedo:\\n‚Ä¢ üìä **\"Analiza BTCUSDT\"** ‚Äî An√°lisis t√©cnico\\n‚Ä¢ üíª **\"Crea un script para ETH\"** ‚Äî C√≥digo para bot\\n‚Ä¢ üîÑ **\"Mu√©strame SOLUSDT\"** ‚Äî Cambiar gr√°fico\\n‚Ä¢ üìö **\"¬øQu√© es el MACD?\"** ‚Äî Educaci√≥n\\n\\n¬øQu√© necesitas?`);\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // MARKET ANALYSIS ENGINE\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  async _analyze(pair, tf = '1h', limit = 200) {\n    const key = `${pair}_${tf}`;\n    const c = this._cache.get(key);\n    if (c && Date.now() - c.ts < this._cacheTTL) return c.data;\n\n    const [candles, ticker] = await Promise.all([\n      marketData.getCandles(pair, tf, limit),\n      marketData.get24hrTicker(pair),\n    ]);\n\n    if (!candles || candles.length < 50) throw new Error(`Datos insuficientes para ${pair}`);\n\n    const closes = candles.map(c => c.close);\n    const highs = candles.map(c => c.high);\n    const lows = candles.map(c => c.low);\n    const volumes = candles.map(c => c.volume);\n    const len = closes.length;\n\n    const ema20 = calculateEMA(closes, 20);\n    const ema50 = calculateEMA(closes, 50);\n    const sma200 = calculateSMA(closes, 200);\n    const rsi = calculateRSI(closes, 14);\n    const macd = calculateMACD(closes, 12, 26, 9);\n    const bb = calculateBollingerBands(closes, 20, 2);\n    const vwap = calculateVWAP(candles);\n\n    const price = closes[len - 1];\n    const e20 = ema20[len - 1], e50 = ema50[len - 1], s200 = sma200[len - 1];\n    const rsiV = rsi[len - 1];\n    const mLine = macd.macd[len - 1], mSig = macd.signal[len - 1], mHist = macd.histogram[len - 1];\n    const bbU = bb.upper[len - 1], bbL = bb.lower[len - 1], bbM = bb.middle[len - 1];\n    const vwapV = vwap[len - 1];\n\n    const shortT = price > e20 ? 'alcista' : 'bajista';\n    const midT = price > e50 ? 'alcista' : 'bajista';\n    const longT = s200 ? (price > s200 ? 'alcista' : 'bajista') : 'indefinida';\n    const aligned = e20 > e50 && (s200 ? e50 > s200 : true);\n\n    const emaCross = detectCrossover(ema20, ema50, len - 1);\n    const macdCross = detectCrossover(macd.macd, macd.signal, len - 1);\n    const rsiDiv = detectDivergence(closes, rsi, 14);\n\n    const bbWidth = bbU && bbL ? (bbU - bbL) / bbM * 100 : 0;\n    const prevBBW = [];\n    for (let i = Math.max(0, len - 20); i < len; i++) {\n      if (bb.upper[i] && bb.lower[i] && bb.middle[i]) prevBBW.push((bb.upper[i] - bb.lower[i]) / bb.middle[i] * 100);\n    }\n    const avgBBW = prevBBW.length > 0 ? prevBBW.reduce((a, b) => a + b, 0) / prevBBW.length : bbWidth;\n    const squeeze = bbWidth < avgBBW * 0.75;\n\n    const avgVol = volumes.slice(-20).reduce((a, b) => a + b, 0) / 20;\n    const volRatio = volumes[len - 1] / avgVol;\n\n    const resistance = Math.max(...highs.slice(-20));\n    const support = Math.min(...lows.slice(-20));\n\n    // Bull score 0-100\n    let score = 50;\n    if (shortT === 'alcista') score += 8;\n    if (midT === 'alcista') score += 8;\n    if (longT === 'alcista') score += 8;\n    if (aligned) score += 6;\n    if (rsiV > 50 && rsiV < 70) score += 5;\n    if (rsiV < 30) score += 10;\n    if (rsiV > 70) score -= 10;\n    if (mHist > 0) score += 5;\n    if (macdCross === 'bullish_cross') score += 10;\n    if (macdCross === 'bearish_cross') score -= 10;\n    if (emaCross === 'bullish_cross') score += 10;\n    if (emaCross === 'bearish_cross') score -= 10;\n    if (price > vwapV) score += 5;\n    if (rsiDiv === 'bullish_divergence') score += 8;\n    if (rsiDiv === 'bearish_divergence') score -= 8;\n    if (volRatio > 1.5) score += (shortT === 'alcista' ? 5 : -5);\n    score = Math.max(0, Math.min(100, score));\n\n    const data = {\n      pair, price, ticker,\n      ind: { ema20: e20, ema50: e50, sma200: s200, rsi: rsiV, macdLine: mLine, macdSig: mSig, macdHist: mHist, bbU, bbL, bbM, bbWidth, squeeze, vwap: vwapV },\n      trend: { short: shortT, mid: midT, long: longT, aligned, emaCross },\n      signals: { rsiDiv, macdCross, volRatio, avgVol },\n      levels: { support, resistance },\n      score, candles,\n    };\n\n    this._cache.set(key, { data, ts: Date.now() });\n    return data;\n  }\n\n  // ‚îÄ‚îÄ‚îÄ Full analysis response ‚îÄ‚îÄ‚îÄ\n  async _fullAnalysis(pair, ctx, action = null) {\n    try {\n      const a = await this._analyze(pair);\n      const { price, ind, trend, signals, levels, score, ticker } = a;\n\n      let bias, emoji;\n      if (score >= 70) { bias = 'FUERTEMENTE ALCISTA'; emoji = 'üü¢üü¢'; }\n      else if (score >= 55) { bias = 'MODERADAMENTE ALCISTA'; emoji = 'üü¢'; }\n      else if (score >= 45) { bias = 'NEUTRAL / LATERAL'; emoji = 'üü°'; }\n      else if (score >= 30) { bias = 'MODERADAMENTE BAJISTA'; emoji = 'üî¥'; }\n      else { bias = 'FUERTEMENTE BAJISTA'; emoji = 'üî¥üî¥'; }\n\n      const sigs = [];\n      if (trend.emaCross === 'bullish_cross') sigs.push('‚úÖ **Golden Cross** ‚Äî EMA20 cruz√≥ encima de EMA50');\n      if (trend.emaCross === 'bearish_cross') sigs.push('‚ùå **Death Cross** ‚Äî EMA20 cruz√≥ debajo de EMA50');\n      if (signals.macdCross === 'bullish_cross') sigs.push('‚úÖ **MACD Bullish Cross**');\n      if (signals.macdCross === 'bearish_cross') sigs.push('‚ùå **MACD Bearish Cross**');\n      if (ind.rsi < 30) sigs.push('‚ö° **RSI Sobreventa** ‚Äî Posible rebote');\n      if (ind.rsi > 70) sigs.push('‚ö†Ô∏è **RSI Sobrecompra** ‚Äî Posible correcci√≥n');\n      if (signals.rsiDiv === 'bullish_divergence') sigs.push('üî• **Divergencia RSI Alcista** ‚Äî Reversal probable');\n      if (signals.rsiDiv === 'bearish_divergence') sigs.push('‚ö†Ô∏è **Divergencia RSI Bajista**');\n      if (ind.squeeze) sigs.push('üí• **BB Squeeze** ‚Äî Explosi√≥n inminente');\n      if (signals.volRatio > 2) sigs.push(`üìä **Volumen ${signals.volRatio.toFixed(1)}x** sobre promedio`);\n      if (trend.aligned) sigs.push('üìà **EMAs Alineadas** ‚Äî Tendencia fuerte');\n\n      let rec;\n      if (score >= 65) rec = `üü¢ **BUSCAR COMPRAS** en pullback a EMA20 ($${ind.ema20.toFixed(2)}). SL debajo EMA50. TP: $${levels.resistance.toFixed(2)}.`;\n      else if (score >= 45) rec = `üü° **ESPERAR** ‚Äî Operar rango $${levels.support.toFixed(2)} - $${levels.resistance.toFixed(2)}.`;\n      else rec = `üî¥ **PRECAUCI√ìN** ‚Äî Evitar longs. Short target: $${levels.support.toFixed(2)}.`;\n\n      const cp = ticker?.changePercent || 0;\n      const text = `üìä **AN√ÅLISIS ‚Äî ${pair}**\\n\\n` +\n        `**Precio:** $${price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\\n` +\n        `**24h:** ${cp >= 0 ? '+' : ''}${cp.toFixed(2)}% | **Vol:** $${((ticker?.quoteVolume || 0) / 1e6).toFixed(1)}M\\n\\n` +\n        `‚îÅ‚îÅ **INDICADORES** ‚îÅ‚îÅ\\n` +\n        `‚Ä¢ EMA 20: $${ind.ema20.toFixed(2)} ${price > ind.ema20 ? '‚úÖ' : '‚ùå'}\\n` +\n        `‚Ä¢ EMA 50: $${ind.ema50.toFixed(2)} ${price > ind.ema50 ? '‚úÖ' : '‚ùå'}\\n` +\n        (ind.sma200 ? `‚Ä¢ SMA 200: $${ind.sma200.toFixed(2)} ${price > ind.sma200 ? '‚úÖ' : '‚ùå'}\\n` : '') +\n        `‚Ä¢ RSI: ${ind.rsi?.toFixed(1)} ${ind.rsi > 70 ? '‚ö†Ô∏è' : ind.rsi < 30 ? '‚ö°' : 'üü¢'}\\n` +\n        `‚Ä¢ MACD: ${ind.macdHist > 0 ? 'üü¢' : 'üî¥'} ${ind.macdHist?.toFixed(4)}\\n` +\n        `‚Ä¢ BB: ${ind.bbWidth.toFixed(2)}% ${ind.squeeze ? 'üí• SQUEEZE' : ''}\\n` +\n        `‚Ä¢ VWAP: $${ind.vwap.toFixed(2)} ${price > ind.vwap ? '‚úÖ' : '‚ùå'}\\n\\n` +\n        `‚îÅ‚îÅ **TENDENCIA** ‚îÅ‚îÅ\\n` +\n        `Corto: **${trend.short}** | Medio: **${trend.mid}** | Largo: **${trend.long}**\\n` +\n        `EMAs alineadas: ${trend.aligned ? '‚úÖ' : '‚ùå'}\\n\\n` +\n        `‚îÅ‚îÅ **NIVELES** ‚îÅ‚îÅ\\n` +\n        `Soporte: $${levels.support.toFixed(2)} | Resistencia: $${levels.resistance.toFixed(2)}\\n\\n` +\n        (sigs.length > 0 ? `‚îÅ‚îÅ **SE√ëALES** ‚îÅ‚îÅ\\n${sigs.join('\\n')}\\n\\n` : '') +\n        `‚îÅ‚îÅ **VEREDICTO** ‚îÅ‚îÅ\\n` +\n        `${emoji} **${bias}** (Score: ${score}/100)\\n\\n` +\n        `${rec}\\n\\n` +\n        `üí° _Di \"crea un script para ${pair}\" para generar c√≥digo autom√°tico._`;\n\n      return this._reply(text, null, null, action);\n    } catch (err) {\n      if (ctx) return this._basicAnalysis(ctx);\n      throw err;\n    }\n  }\n\n  _quickSummary(pair, a) {\n    const { price, ind, trend, score } = a;\n    const e = score >= 60 ? 'üü¢' : score >= 40 ? 'üü°' : 'üî¥';\n    return `${e} **${pair}** ‚Äî $${price.toLocaleString(undefined, { minimumFractionDigits: 2 })}\\nRSI: ${ind.rsi?.toFixed(1)} | MACD: ${ind.macdHist > 0 ? 'üü¢' : 'üî¥'} | Tendencia: ${trend.short}\\nScore: **${score}/100**`;\n  }\n\n  _basicAnalysis(ctx) {\n    const t = ctx.changePercent > 0 ? 'alcista' : 'bajista';\n    return this._reply(`üìà **${ctx.symbol}** ‚Äî $${ctx.price?.toLocaleString()}\\nCambio 24h: ${ctx.changePercent > 0 ? '+' : ''}${ctx.changePercent?.toFixed(2)}%\\nTendencia: ${t}\\n\\n‚ö†Ô∏è Para an√°lisis completo con indicadores, carga el gr√°fico primero.`);\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // STRATEGY GENERATOR\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  async _genStrategy(pair, ctx) {\n    try {\n      const a = await this._analyze(pair);\n      const { ind, trend, score, levels, signals, price } = a;\n\n      let type, name, entry, exit, sl, tp, tf, reason;\n\n      if (score >= 65 && trend.aligned) {\n        type = 'ema_cross'; name = `Tendencia Alcista ‚Äî ${pair}`;\n        entry = `EMA 20 > EMA 50 + RSI > 40`; exit = `RSI > 75 o precio < EMA 50`;\n        sl = Math.max(1.5, ((price - levels.support) / price * 100)).toFixed(1);\n        tp = Math.max(parseFloat(sl) * 2, ((levels.resistance - price) / price * 100)).toFixed(1);\n        tf = '1h'; reason = `EMAs alineadas, Score ${score}/100.`;\n      } else if (ind.rsi < 35 && signals.rsiDiv === 'bullish_divergence') {\n        type = 'ema_cross_rsi'; name = `RSI Reversal ‚Äî ${pair}`;\n        entry = `RSI < 30 + Divergencia alcista`; exit = `RSI > 65`;\n        sl = '2'; tp = '5'; tf = '4h'; reason = `RSI ${ind.rsi.toFixed(1)} con divergencia alcista.`;\n      } else if (ind.squeeze) {\n        type = 'ema_cross'; name = `BB Breakout ‚Äî ${pair}`;\n        entry = `Precio rompe BB superior + volumen alto`; exit = `Precio vuelve dentro de BB`;\n        sl = (ind.bbWidth / 2).toFixed(1); tp = (ind.bbWidth * 1.5).toFixed(1); tf = '1h';\n        reason = `BB Squeeze (${ind.bbWidth.toFixed(2)}%). Explosi√≥n inminente.`;\n      } else if (score <= 35) {\n        type = 'rsi'; name = `Short Bajista ‚Äî ${pair}`;\n        entry = `Rechazo en EMA 20 + RSI < 50`; exit = `RSI < 25 o soporte`;\n        sl = '2'; tp = '4'; tf = '1h'; reason = `Score bajista ${score}/100.`;\n      } else {\n        type = 'ema_cross_rsi'; name = `Range Trading ‚Äî ${pair}`;\n        entry = `Compra en soporte $${levels.support.toFixed(2)} + RSI < 40`; exit = `RSI > 65 o resistencia`;\n        sl = ((price - levels.support) / price * 100 + 0.5).toFixed(1);\n        tp = ((levels.resistance - price) / price * 100).toFixed(1); tf = '1h';\n        reason = `Lateral, Score ${score}/100.`;\n      }\n\n      const rr = (parseFloat(tp) / parseFloat(sl)).toFixed(1);\n      const strategy = {\n        name, pair, timeframe: tf,\n        entry: { condition: entry, indicator: type, params: type === 'ema_cross' ? { fast: 20, slow: 50 } : { fastEma: 20, slowEma: 50, rsiPeriod: 14, rsiOversold: 30, rsiOverbought: 70 } },\n        exit: { condition: exit, indicator: 'rsi_overbought', params: { rsiOverbought: 70 } },\n        stopLoss: `${sl}%`, takeProfit: `${tp}%`, riskReward: `1:${rr}`,\n      };\n\n      const text = `üéØ **ESTRATEGIA ‚Äî ${pair}**\\n\\n**${name}**\\n\\n` +\n        `üìä **Raz√≥n:** ${reason}\\n\\n` +\n        `**Entrada:** ${entry}\\n**Salida:** ${exit}\\n` +\n        `**SL:** ${sl}% | **TP:** ${tp}% | **R:R:** 1:${rr}\\n**TF:** ${tf}\\n\\n` +\n        `Activa con el bot√≥n de abajo, o di **\"crea un script\"** para c√≥digo de bot.`;\n\n      return this._reply(text, strategy);\n    } catch {\n      const strategy = {\n        name: `Auto ‚Äî ${pair}`, pair, timeframe: '1h',\n        entry: { condition: 'EMA Cross + RSI', indicator: 'ema_cross_rsi', params: { fastEma: 20, slowEma: 50, rsiPeriod: 14, rsiOversold: 35 } },\n        exit: { condition: 'RSI > 70', indicator: 'rsi_overbought', params: { rsiOverbought: 70 } },\n        stopLoss: '2%', takeProfit: '4%', riskReward: '1:2',\n      };\n      return this._reply(`üéØ **Estrategia para ${pair}**\\n\\nEMA Cross + RSI\\nSL: 2% | TP: 4% | R:R: 1:2\\n\\nActiva con el bot√≥n.`, strategy);\n    }\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // KAIROS SCRIPT GENERATOR\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  async _genScript(pair, ctx) {\n    try {\n      const a = await this._analyze(pair);\n      const { ind, trend, score, levels } = a;\n\n      let script, desc;\n\n      if (score >= 65 && trend.aligned) {\n        desc = `Tendencia alcista, Score ${score}/100. EMAs alineadas.`;\n        script = `// Tendencia Alcista ‚Äî ${pair}\n// Generado por Kairos AI | Score: ${score}/100\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// EMA20: $${ind.ema20.toFixed(2)} | EMA50: $${ind.ema50.toFixed(2)} | RSI: ${ind.rsi.toFixed(1)}\n\nconst fast = ema(20);\nconst slow = ema(50);\nconst momentum = rsi(14);\nconst m = macd(12, 26, 9);\nconst v = vwap();\n\n// Compra: Pullback en tendencia alcista\nif (close > slow && momentum > 40 && momentum < 70) {\n  if (crossover(fast, slow) || (close > fast && m.histogram > 0)) {\n    buy();\n    log(\"Compra: Tendencia alcista + momentum positivo\");\n  }\n}\n\n// Rebote en VWAP\nif (close > v && crossover(close, fast) && momentum < 60) {\n  buy();\n  log(\"Compra: Rebote VWAP\");\n}\n\n// Venta: Sobrecompra o p√©rdida de tendencia\nif (momentum > 75 || crossunder(fast, slow)) {\n  sell();\n  log(\"Venta: \" + (momentum > 75 ? \"RSI alto\" : \"Death cross\"));\n}\n\nconfig({ stopLoss: ${Math.max(1.5, ((ind.ema20 - levels.support) / ind.ema20 * 100)).toFixed(1)}, takeProfit: ${Math.max(3, ((levels.resistance - ind.ema20) / ind.ema20 * 100)).toFixed(1)} });`;\n      } else if (score <= 35) {\n        desc = `Tendencia bajista, Score ${score}/100.`;\n        script = `// Tendencia Bajista ‚Äî ${pair}\n// Generado por Kairos AI | Score: ${score}/100\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst fast = ema(20);\nconst slow = ema(50);\nconst momentum = rsi(14);\nconst m = macd(12, 26, 9);\n\n// Short: rechazo de EMA en bajista\nif (close < slow && momentum < 55) {\n  if (crossunder(fast, slow) || (close < fast && m.histogram < 0)) {\n    sell();\n    log(\"Short: Rechazo EMA bajista\");\n  }\n}\n\n// Cubrir: RSI sobreventa extrema\nif (momentum < 25) {\n  buy();\n  log(\"Cubrir: RSI extremo\");\n}\n\nconfig({ stopLoss: 2, takeProfit: 4 });`;\n      } else if (ind.squeeze) {\n        desc = `BB Squeeze detectado. Volatility breakout.`;\n        script = `// BB Breakout ‚Äî ${pair}\n// Generado por Kairos AI | BB Width: ${ind.bbWidth.toFixed(2)}%\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst bands = bb(20, 2);\nconst momentum = rsi(14);\nconst m = macd(12, 26, 9);\n\n// Breakout alcista\nif (close > bands.upper && momentum > 50 && momentum < 80 && m.histogram > 0) {\n  buy();\n  log(\"Breakout alcista BB\");\n}\n\n// Breakout bajista\nif (close < bands.lower && momentum < 50 && momentum > 20 && m.histogram < 0) {\n  sell();\n  log(\"Breakout bajista BB\");\n}\n\n// Salida\nif (close < bands.middle && change(close, 3) < 0) {\n  sell();\n  log(\"Salida: momentum perdido\");\n}\n\nconfig({ stopLoss: ${(ind.bbWidth / 2).toFixed(1)}, takeProfit: ${(ind.bbWidth * 1.5).toFixed(1)} });`;\n      } else if (ind.rsi < 35 || ind.rsi > 65) {\n        const os = ind.rsi < 35;\n        desc = `RSI ${ind.rsi.toFixed(1)} ‚Äî ${os ? 'Sobreventa' : 'Sobrecompra'}.`;\n        script = `// RSI Reversal ‚Äî ${pair}\n// Generado por Kairos AI | RSI: ${ind.rsi.toFixed(1)}\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst momentum = rsi(14);\nconst fast = ema(20);\nconst slow = ema(50);\nconst m = macd(12, 26, 9);\n\n${os ? `// Compra en sobreventa\nif (momentum < 30 && m.histogram > m.signal) {\n  buy();\n  log(\"Compra: RSI sobreventa + MACD girando\");\n}\nif (momentum < 35 && crossover(fast, slow)) {\n  buy();\n  log(\"Compra: RSI bajo + Golden Cross\");\n}\nif (momentum > 65) {\n  sell();\n  log(\"Venta: tomar ganancia\");\n}` : `// Venta en sobrecompra\nif (momentum > 70 && m.histogram < m.signal) {\n  sell();\n  log(\"Venta: RSI sobrecompra\");\n}\nif (momentum < 40) {\n  buy();\n  log(\"Cubrir: RSI normalizado\");\n}`}\n\nconfig({ stopLoss: 2, takeProfit: 4.5 });`;\n      } else {\n        desc = `Mercado lateral. Rango $${levels.support.toFixed(2)} ‚Äî $${levels.resistance.toFixed(2)}.`;\n        script = `// Rango ‚Äî ${pair}\n// Generado por Kairos AI | Score: ${score}/100\n// Soporte: $${levels.support.toFixed(2)} | Resistencia: $${levels.resistance.toFixed(2)}\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst bands = bb(20, 2);\nconst momentum = rsi(14);\nconst v = vwap();\n\n// Compra en soporte\nif (close < bands.lower && momentum < 35) {\n  buy();\n  log(\"Compra: soporte BB + RSI bajo\");\n}\nif (crossover(close, v) && momentum < 50) {\n  buy();\n  log(\"Compra: rebote VWAP\");\n}\n\n// Venta en resistencia\nif (close > bands.upper && momentum > 65) {\n  sell();\n  log(\"Venta: resistencia BB + RSI alto\");\n}\nif (momentum > 75) {\n  sell();\n  log(\"Venta: RSI sobrecompra\");\n}\n\nconfig({ stopLoss: ${Math.max(1.5, ((levels.resistance - levels.support) / levels.support * 100 / 3)).toFixed(1)}, takeProfit: ${Math.max(2.5, ((levels.resistance - levels.support) / levels.support * 100 * 0.6)).toFixed(1)} });`;\n      }\n\n      const text = `üíª **KAIROS SCRIPT ‚Äî ${pair}**\\n\\nüìä ${desc}\\n\\n` +\n        `**C√≥mo usar:**\\n1. Copia el c√≥digo\\n2. Ve a **Bots** ‚Üí Script Bot\\n3. Pega ‚Üí Backtest ‚Üí Activar\\n\\n` +\n        `_Basado en an√°lisis real ‚Äî Score: ${score}/100_`;\n\n      return this._reply(text, null, script);\n    } catch {\n      const script = this._genericScript(pair);\n      return this._reply(`üíª **KAIROS SCRIPT ‚Äî ${pair}**\\n\\nScript multi-indicador profesional.\\n\\n**C√≥mo usar:** Copia ‚Üí Bots ‚Üí Script Bot ‚Üí Backtest ‚Üí Activar`, null, script);\n    }\n  }\n\n  _genericScript(pair) {\n    return `// Multi-Indicador ‚Äî ${pair}\n// Generado por Kairos AI\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst fast = ema(20);\nconst slow = ema(50);\nconst momentum = rsi(14);\nconst m = macd(12, 26, 9);\nconst bands = bb(20, 2);\nconst v = vwap();\n\n// COMPRA\nif (crossover(fast, slow) && momentum > 40 && momentum < 65) {\n  buy();\n  log(\"Compra: Golden Cross + RSI ok\");\n}\nif (close < bands.lower && momentum < 30) {\n  buy();\n  log(\"Compra: Sobreventa + soporte BB\");\n}\nif (crossover(close, v) && close > fast && momentum > 45) {\n  buy();\n  log(\"Compra: VWAP breakout\");\n}\n\n// VENTA\nif (crossunder(fast, slow) && momentum < 55) {\n  sell();\n  log(\"Venta: Death Cross\");\n}\nif (momentum > 75 && close > bands.upper) {\n  sell();\n  log(\"Venta: Sobrecompra + resistencia BB\");\n}\nif (crossunder(m.line, m.signal) && momentum > 60) {\n  sell();\n  log(\"Venta: MACD bearish cross\");\n}\n\nconfig({ stopLoss: 2, takeProfit: 4.5 });`;\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // EDUCATION ENGINE\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  _educate(message) {\n    const kb = this._matchKB(message.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''));\n    if (kb) return this._reply(kb);\n    return this._reply(`üìö Puedo ense√±arte sobre:\\n\\n` +\n      `**Indicadores:** RSI, EMA, SMA, MACD, Bollinger, VWAP, Fibonacci\\n` +\n      `**Conceptos:** Scalping, Swing, Day Trading, Tendencia, Soporte/Resistencia\\n` +\n      `**Riesgo:** Stop Loss, Take Profit, Position Sizing, Apalancamiento\\n` +\n      `**Patrones:** Doji, Engulfing, Hammer, Doble Techo, Cabeza y Hombros\\n` +\n      `**Avanzado:** Liquidez, Order Blocks, Smart Money, Volumen\\n\\nPregunta lo que quieras.`);\n  }\n\n  _matchKB(msg) {\n    const hits = [];\n    for (const [key, keywords] of Object.entries(KB_MAP)) {\n      if (keywords.some(kw => msg.includes(kw))) hits.push(KB[key]);\n    }\n    if (hits.length === 0) return null;\n    return `üìö **Kairos Academy**\\n\\n${hits.join('\\n\\n')}\\n\\nüí° _¬øQuieres que analice un par usando esto? Di \"Analiza\" + par._`;\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // OPENAI (Enhanced)\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  async _openAI(message, ctx, intent) {\n    let extra = '';\n    if ((intent.analyze || intent.strategy || intent.kairosScript) && (intent.detectedPair || ctx?.symbol)) {\n      try {\n        const a = await this._analyze(intent.detectedPair || ctx.symbol);\n        extra = `\\n\\n[DATOS REAL-TIME ‚Äî ${a.pair}]\\nPrecio: $${a.price}\\nEMA20: $${a.ind.ema20.toFixed(2)}\\nEMA50: $${a.ind.ema50.toFixed(2)}\\n` +\n          `RSI: ${a.ind.rsi.toFixed(1)}\\nMACD: ${a.ind.macdHist.toFixed(6)}\\nBB Width: ${a.ind.bbWidth.toFixed(2)}%\\n` +\n          `Tendencia: ${a.trend.short}/${a.trend.mid}\\nScore: ${a.score}/100\\nSoporte: $${a.levels.support.toFixed(2)}\\nResistencia: $${a.levels.resistance.toFixed(2)}`;\n      } catch {}\n    }\n\n    const sys = `Eres Kairos AI, experto de trading de Kairos Trade (Kairos 777 Inc). Responde en espa√±ol. S√© directo y profesional. Usa datos reales proporcionados. Nunca des consejos financieros personales. Incluye siempre SL/TP en estrategias.` +\n      (intent.kairosScript ? `\\n\\nPara Kairos Script:\\n${CHATGPT_PROMPT}` : '');\n\n    try {\n      const res = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${this.apiKey}` },\n        body: JSON.stringify({\n          model: this.model,\n          messages: [\n            { role: 'system', content: sys },\n            ...this.conversationHistory.slice(-20).map(m => ({ role: m.role, content: m.content + (m.role === 'user' ? extra : '') })),\n          ],\n          temperature: 0.7,\n          max_tokens: 2000,\n        }),\n      });\n      if (!res.ok) throw new Error('API error');\n      const data = await res.json();\n      const reply = data.choices[0].message.content;\n\n      let action = null;\n      if (intent.changePair && intent.detectedPair) action = { type: 'changePair', pair: intent.detectedPair };\n\n      const scriptMatch = reply.match(/```(?:javascript|kairos|js)?\\n([\\s\\S]*?)```/);\n      const kairosScript = scriptMatch ? scriptMatch[1].trim() : null;\n\n      this.conversationHistory.push({ role: 'assistant', content: reply });\n      return {\n        text: reply.replace(/```(?:javascript|kairos|js)?\\n[\\s\\S]*?```/g, '').trim(),\n        strategy: this._extractStrategy(reply),\n        kairosScript,\n        action,\n      };\n    } catch {\n      return await this._engine(message, ctx, intent);\n    }\n  }\n\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // UTILITIES\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n  _reply(text, strategy = null, kairosScript = null, action = null) {\n    this.conversationHistory.push({ role: 'assistant', content: text });\n    return { text, strategy, kairosScript, action };\n  }\n\n  _extractStrategy(text) {\n    const m = text.match(/```strategy\\n([\\s\\S]*?)```/);\n    if (m) { try { return JSON.parse(m[1]); } catch {} }\n    return null;\n  }\n\n  clearHistory() {\n    this.conversationHistory = [];\n    this._cache.clear();\n  }\n}\n\nexport const aiService = new AIService();\nexport default aiService;\n"],"names":["KB","KB_MAP","AIService","key","message","marketContext","intent","err","fb","msg","pm","detectedPair","ctx","pair","a","kb","tf","limit","c","candles","ticker","marketData","closes","highs","lows","volumes","len","ema20","calculateEMA","ema50","sma200","calculateSMA","rsi","calculateRSI","macd","calculateMACD","bb","calculateBollingerBands","vwap","calculateVWAP","price","e20","e50","s200","rsiV","mLine","mSig","mHist","bbU","bbL","bbM","vwapV","shortT","midT","longT","aligned","emaCross","detectCrossover","macdCross","rsiDiv","detectDivergence","bbWidth","prevBBW","i","avgBBW","b","squeeze","avgVol","volRatio","resistance","support","score","data","action","ind","trend","signals","levels","bias","emoji","sigs","rec","cp","text","_a","_b","t","type","name","entry","exit","sl","tp","reason","rr","strategy","script","desc","os","hits","keywords","kw","extra","sys","CHATGPT_PROMPT","res","m","reply","scriptMatch","kairosScript","aiService"],"mappings":"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"}