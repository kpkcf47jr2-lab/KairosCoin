import{aw as y,ax as F,G as $,j as t,R as B}from"./ui-CNhabBHP.js";import{a as n}from"./vendor-CUCP814w.js";import{V as A,a as M,I as T}from"./charts-UjLl1g-4.js";import{u as I,T as L,b as O,c as V}from"./index-P-WH05qf.js";import{c as P}from"./indicators-DJQYQkcq.js";import{m as z}from"./marketData-K1zKCjjj.js";function G({pair:m,timeframe:i,height:u=300,onPriceUpdate:x}){const f=n.useRef(null),j=n.useRef(null),g=n.useRef(null),p=n.useRef(null),h=n.useRef(null);return n.useEffect(()=>{const c=f.current;if(!c)return;const v=c.getBoundingClientRect(),e=A(c,{width:v.width||400,height:u-30,layout:{background:{type:T.Solid,color:"#0B0E11"},textColor:"#848E9C",fontFamily:"Inter, sans-serif",fontSize:10},grid:{vertLines:{color:"#1E222D"},horzLines:{color:"#1E222D"}},crosshair:{mode:M.Normal},timeScale:{borderColor:"#1E222D",timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:"#1E222D"}}),r=e.addCandlestickSeries({upColor:"#0ECB81",downColor:"#F6465D",borderDownColor:"#F6465D",borderUpColor:"#0ECB81",wickDownColor:"#F6465D",wickUpColor:"#0ECB81"}),s=e.addLineSeries({color:"#D4AF37",lineWidth:1,priceLineVisible:!1,lastValueVisible:!1});j.current=e,g.current=r,p.current=s;const d=O(m);z.getCandles(d,i,200).then(o=>{if(o&&o.length>0){const l=o.map(a=>({time:Math.floor(a.time/1e3),open:a.open,high:a.high,low:a.low,close:a.close}));r.setData(l);const b=o.map(a=>a.close),D=P(b,20).map((a,E)=>{var k;return a?{time:(k=l[E])==null?void 0:k.time,value:a}:null}).filter(Boolean);s.setData(D),e.timeScale().fitContent();const S=o[o.length-1];S&&x&&x(S.close)}}).catch(()=>{});const w=d.toLowerCase(),C=new WebSocket(`wss://stream.binance.com:9443/ws/${w}@kline_${i}`);C.onmessage=o=>{try{const l=JSON.parse(o.data);if(l.k){const b={time:Math.floor(l.k.t/1e3),open:parseFloat(l.k.o),high:parseFloat(l.k.h),low:parseFloat(l.k.l),close:parseFloat(l.k.c)};r.update(b),x&&x(b.close)}}catch{}},h.current=C;const R=new ResizeObserver(()=>{const o=c.getBoundingClientRect();o.width>0&&o.height>0&&e.applyOptions({width:o.width,height:o.height-30})});return R.observe(c),()=>{R.disconnect(),C.close(),e.remove()}},[m,i,u]),t.jsxs("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col bg-[var(--dark)] border border-[var(--border)] rounded-lg overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between px-2 py-1 bg-[var(--dark-2)] border-b border-[var(--border)]",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:V(m)}),t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-white/5 text-[var(--text-dim)] font-mono",children:i})]})}),t.jsx("div",{ref:f,className:"flex-1 min-h-0"})]})}const N={"2x2":{cols:2,rows:2,label:"2×2",icon:$},"1x2":{cols:2,rows:1,label:"1×2",icon:y},"2x1":{cols:1,rows:2,label:"2×1",icon:F},"1x3":{cols:3,rows:1,label:"1×3",icon:y}};function H(){const{selectedPair:m}=I(),[i,u]=n.useState("2x2"),[x,f]=n.useState(()=>{const e=m||"BTCKAIROS";return[{pair:e,timeframe:"1m"},{pair:e,timeframe:"5m"},{pair:e,timeframe:"15m"},{pair:e,timeframe:"1h"}]}),[j,g]=n.useState({}),p=N[i],h=x.slice(0,p.cols*p.rows),c=(e,r)=>{f(s=>s.map((d,w)=>w===e?{...d,timeframe:r}:d))},v=()=>{const e=m||"BTCKAIROS";f(r=>r.map(s=>({...s,pair:e})))};return t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-[var(--dark-2)] border-b border-[var(--border)] shrink-0",children:[t.jsx("span",{className:"text-xs font-bold text-[var(--gold)] mr-2",children:"Multi-Chart"}),t.jsx("div",{className:"flex gap-1 bg-[var(--dark)] rounded-lg p-0.5",children:Object.entries(N).map(([e,r])=>{const s=r.icon;return t.jsxs("button",{onClick:()=>u(e),className:`px-2 py-1 text-[10px] font-bold rounded-md flex items-center gap-1 transition-colors
                  ${i===e?"bg-[var(--gold)]/20 text-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:[t.jsx(s,{size:12})," ",r.label]},e)})}),t.jsx("div",{className:"flex-1"}),t.jsxs("button",{onClick:v,className:"flex items-center gap-1 px-2 py-1 text-[10px] font-bold rounded-lg bg-[var(--gold)]/10 text-[var(--gold)] hover:bg-[var(--gold)]/20 transition-colors",children:[t.jsx(B,{size:11})," Sync Par"]}),h.map((e,r)=>t.jsx("select",{value:e.timeframe,onChange:s=>c(r,s.target.value),className:"text-[10px] bg-[var(--dark)] border border-[var(--border)] rounded px-1 py-0.5 text-[var(--text-dim)]",title:`Chart ${r+1}`,children:L.map(s=>t.jsx("option",{value:s.value,children:s.label},s.value))},r))]}),t.jsx("div",{className:"flex-1 min-h-0 p-1 gap-1",style:{display:"grid",gridTemplateColumns:`repeat(${p.cols}, 1fr)`,gridTemplateRows:`repeat(${p.rows}, 1fr)`},children:h.map((e,r)=>t.jsx(G,{pair:e.pair,timeframe:e.timeframe,onPriceUpdate:s=>g(d=>({...d,[r]:s}))},`${e.pair}-${e.timeframe}-${r}-${i}`))})]})}export{H as default};
