{"version":3,"file":"broker-C2BN0UWn.js","sources":["../../src/services/broker.js"],"sourcesContent":["// Kairos Trade — Broker Service (Elite v4)\n// Real execution on Binance (HMAC-SHA256) + Coinbase CDP (JWT/EC)\n// Uses Web Crypto API (no external dependencies)\nimport { BROKERS } from '../constants';\n\nclass BrokerService {\n  constructor() {\n    this.connections = new Map();\n  }\n\n  // Decrypt stored credentials (base64)\n  _decrypt(broker) {\n    return {\n      ...broker,\n      apiKey: atob(broker.apiKey),\n      apiSecret: atob(broker.apiSecret),\n      passphrase: broker.passphrase ? atob(broker.passphrase) : undefined,\n    };\n  }\n\n  // ─── Coinbase CDP: Build JWT from EC Private Key ───\n  async _coinbaseJWT(creds, method, path) {\n    const keyName = creds.apiKey;\n    const privateKeyPem = creds.apiSecret;\n\n    // JWT Header\n    const header = { alg: 'ES256', kid: keyName, nonce: crypto.randomUUID(), typ: 'JWT' };\n\n    // JWT Payload — Coinbase CDP requires 'uri' field: \"METHOD host/path\"\n    const now = Math.floor(Date.now() / 1000);\n    const uri = `${method} api.coinbase.com${path}`;\n    const payload = {\n      sub: keyName,\n      iss: 'coinbase-cloud',\n      aud: ['cdp_service'],\n      nbf: now,\n      exp: now + 120,\n      uri,\n    };\n\n    const toB64url = (str) => btoa(str).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    const objToB64url = (obj) => toB64url(JSON.stringify(obj));\n    const bufToB64url = (buf) => toB64url(String.fromCharCode(...new Uint8Array(buf)));\n    const headerB64 = objToB64url(header);\n    const payloadB64 = objToB64url(payload);\n    const signingInput = `${headerB64}.${payloadB64}`;\n\n    // Import EC key and sign\n    const key = await this._importECKey(privateKeyPem);\n\n    const sig = await crypto.subtle.sign(\n      { name: 'ECDSA', hash: 'SHA-256' },\n      key,\n      new TextEncoder().encode(signingInput)\n    );\n\n    return `${signingInput}.${bufToB64url(sig)}`;\n  }\n\n  // Parse SEC1 PEM (BEGIN EC PRIVATE KEY) → extract d, x, y → import as JWK\n  async _importECKey(pem) {\n    // Clean PEM: remove headers and all literal \\n\n    const pemClean = pem\n      .replace(/-----BEGIN (?:EC )?PRIVATE KEY-----/g, '')\n      .replace(/-----END (?:EC )?PRIVATE KEY-----/g, '')\n      .replace(/\\\\n/g, '')\n      .replace(/\\n/g, '')\n      .replace(/\\r/g, '')\n      .replace(/\\s/g, '');\n\n    const der = Uint8Array.from(atob(pemClean), c => c.charCodeAt(0));\n\n    // If it's PKCS8 format (BEGIN PRIVATE KEY), import directly\n    if (pem.includes('BEGIN PRIVATE KEY') && !pem.includes('EC PRIVATE KEY')) {\n      return crypto.subtle.importKey(\n        'pkcs8', der.buffer,\n        { name: 'ECDSA', namedCurve: 'P-256' },\n        false, ['sign']\n      );\n    }\n\n    // SEC1 EC format: parse ASN.1 to extract raw key material\n    // Structure: SEQUENCE { version(1), d(32 bytes), [0]curveOid, [1]publicKey(65 bytes) }\n    const d = this._extractEC_d(der);\n    const pubPoint = this._extractEC_pub(der);\n\n    if (!d || d.length !== 32) {\n      throw new Error(`Clave EC inválida: se esperaban 32 bytes para d, se encontraron ${d?.length || 0}`);\n    }\n\n    const bytesToB64url = (bytes) =>\n      btoa(String.fromCharCode(...bytes)).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n\n    const jwk = {\n      kty: 'EC',\n      crv: 'P-256',\n      d: bytesToB64url(d),\n    };\n\n    // If public key present (65 bytes: 04 || x(32) || y(32))\n    if (pubPoint && pubPoint.length === 65 && pubPoint[0] === 0x04) {\n      jwk.x = bytesToB64url(pubPoint.slice(1, 33));\n      jwk.y = bytesToB64url(pubPoint.slice(33, 65));\n    } else {\n      // Without public key, Web Crypto can't import. Derive it.\n      // Try PKCS8 wrapping as fallback\n      return this._importECKeyPkcs8Wrap(der);\n    }\n\n    return crypto.subtle.importKey(\n      'jwk', jwk,\n      { name: 'ECDSA', namedCurve: 'P-256' },\n      false, ['sign']\n    );\n  }\n\n  // Extract 32-byte private key 'd' from SEC1 DER\n  _extractEC_d(der) {\n    // Find OCTET STRING (tag 0x04) after version INTEGER (02 01 01)\n    // Typical: 30 77 02 01 01 04 20 <32 bytes d>\n    for (let i = 0; i < der.length - 34; i++) {\n      if (der[i] === 0x02 && der[i + 1] === 0x01 && der[i + 2] === 0x01 &&\n          der[i + 3] === 0x04 && der[i + 4] === 0x20) {\n        return der.slice(i + 5, i + 5 + 32);\n      }\n    }\n    return null;\n  }\n\n  // Extract public key point from SEC1 DER\n  _extractEC_pub(der) {\n    // Look for context tag [1] (0xA1) followed by BIT STRING (0x03)\n    for (let i = 0; i < der.length - 67; i++) {\n      if (der[i] === 0xA1 && der[i + 2] === 0x03 && der[i + 3] === 0x42 && der[i + 4] === 0x00) {\n        return der.slice(i + 5, i + 5 + 65);\n      }\n    }\n    return null;\n  }\n\n  // Fallback: wrap SEC1 DER in PKCS8 envelope\n  async _importECKeyPkcs8Wrap(sec1Der) {\n    // PKCS8 = SEQUENCE { version(0), AlgorithmIdentifier(EC P-256), OCTET STRING(SEC1) }\n    const octetLen = sec1Der.length;\n    const algoId = new Uint8Array([\n      0x30, 0x13,\n      0x06, 0x07, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02, 0x01,\n      0x06, 0x08, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x03, 0x01, 0x07,\n    ]);\n    const ver = new Uint8Array([0x02, 0x01, 0x00]);\n    const octetHeader = this._asn1Len(0x04, octetLen);\n    const totalInner = ver.length + algoId.length + octetHeader.length + octetLen;\n    const seqHeader = this._asn1Len(0x30, totalInner);\n\n    const pkcs8 = new Uint8Array(seqHeader.length + totalInner);\n    let off = 0;\n    pkcs8.set(seqHeader, off); off += seqHeader.length;\n    pkcs8.set(ver, off); off += ver.length;\n    pkcs8.set(algoId, off); off += algoId.length;\n    pkcs8.set(octetHeader, off); off += octetHeader.length;\n    pkcs8.set(sec1Der, off);\n\n    return crypto.subtle.importKey(\n      'pkcs8', pkcs8.buffer,\n      { name: 'ECDSA', namedCurve: 'P-256' },\n      false, ['sign']\n    );\n  }\n\n  // ASN.1 tag + length header\n  _asn1Len(tag, len) {\n    if (len < 128) return new Uint8Array([tag, len]);\n    if (len < 256) return new Uint8Array([tag, 0x81, len]);\n    return new Uint8Array([tag, 0x82, (len >> 8) & 0xff, len & 0xff]);\n  }\n\n  // ─── Coinbase CDP Signed Request (via Netlify proxy to bypass CORS) ───\n  async _coinbaseRequest(creds, method, path, body = null) {\n    const jwt = await this._coinbaseJWT(creds, method, path);\n\n    // Use serverless proxy to bypass CORS — JWT signed client-side, keys never leave browser\n    const proxyUrl = '/api/coinbase-proxy';\n    try {\n      const res = await fetch(proxyUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ jwt, method, path, body }),\n      });\n\n      let data;\n      const text = await res.text();\n      try { data = JSON.parse(text); } catch { data = { error: text }; }\n\n      if (!res.ok) {\n        throw new Error(data.error || data.message || `Coinbase HTTP ${res.status}`);\n      }\n      return data;\n    } catch (err) {\n      if (err.message === 'Failed to fetch' || err.name === 'TypeError') {\n        throw new Error('Error de red al conectar con el proxy. Reintenta en unos segundos.');\n      }\n      throw err;\n    }\n  }\n\n  // ─── HMAC-SHA256 Signing (Web Crypto API) ───\n  async _hmacSign(secret, message) {\n    const encoder = new TextEncoder();\n    const key = await crypto.subtle.importKey(\n      'raw', encoder.encode(secret),\n      { name: 'HMAC', hash: 'SHA-256' },\n      false, ['sign']\n    );\n    const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(message));\n    return Array.from(new Uint8Array(signature))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n  }\n\n  // ─── HMAC-SHA256 → Base64 (for Kraken, OKX, KuCoin) ───\n  async _hmacSignB64(secret, message, isB64Secret = false) {\n    const encoder = new TextEncoder();\n    let keyData;\n    if (isB64Secret) {\n      const bin = atob(secret);\n      keyData = new Uint8Array(bin.length);\n      for (let i = 0; i < bin.length; i++) keyData[i] = bin.charCodeAt(i);\n    } else {\n      keyData = encoder.encode(secret);\n    }\n    const key = await crypto.subtle.importKey(\n      'raw', keyData,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false, ['sign']\n    );\n    const sig = await crypto.subtle.sign('HMAC', key, encoder.encode(message));\n    return btoa(String.fromCharCode(...new Uint8Array(sig)));\n  }\n\n  // ─── HMAC-SHA512 → Base64 (for Kraken) ───\n  async _hmacSignSHA512B64(secretB64, message) {\n    const bin = atob(secretB64);\n    const keyData = new Uint8Array(bin.length);\n    for (let i = 0; i < bin.length; i++) keyData[i] = bin.charCodeAt(i);\n    const key = await crypto.subtle.importKey(\n      'raw', keyData,\n      { name: 'HMAC', hash: 'SHA-512' },\n      false, ['sign']\n    );\n    // Kraken expects: HMAC-SHA512( base64decode(secret), path + SHA256(nonce + postData) )\n    const msgData = typeof message === 'string' ? new TextEncoder().encode(message) : message;\n    const sig = await crypto.subtle.sign('HMAC', key, msgData);\n    return btoa(String.fromCharCode(...new Uint8Array(sig)));\n  }\n\n  // ─── SHA-256 digest (for Kraken nonce signing) ───\n  async _sha256(message) {\n    const data = new TextEncoder().encode(message);\n    const hash = await crypto.subtle.digest('SHA-256', data);\n    return new Uint8Array(hash);\n  }\n\n  // ─── Universal Proxy Request (for non-Binance/Coinbase brokers) ───\n  async _proxyRequest(url, method, headers = {}, body = null) {\n    const res = await fetch('/api/broker-proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ url, method, headers, body }),\n    });\n    const text = await res.text();\n    let data;\n    try { data = JSON.parse(text); } catch { data = { error: text }; }\n    if (!res.ok) throw new Error(data.error || data.message || data.msg || `HTTP ${res.status}`);\n    return data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── BYBIT v5 (HMAC-SHA256) ───\n  // ════════════════════════════════════════════════════════\n  async _bybitRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now().toString();\n    const recvWindow = '5000';\n    let queryString = '';\n    let bodyStr = '';\n\n    if (method === 'GET') {\n      queryString = Object.entries(params)\n        .filter(([, v]) => v !== undefined && v !== null)\n        .map(([k, v]) => `${k}=${v}`)\n        .join('&');\n    } else {\n      bodyStr = JSON.stringify(params);\n    }\n\n    const preSign = `${timestamp}${creds.apiKey}${recvWindow}${method === 'GET' ? queryString : bodyStr}`;\n    const signature = await this._hmacSign(creds.apiSecret, preSign);\n\n    const url = `${BROKERS.bybit.baseUrl}${endpoint}${queryString ? '?' + queryString : ''}`;\n    const headers = {\n      'X-BAPI-API-KEY': creds.apiKey,\n      'X-BAPI-SIGN': signature,\n      'X-BAPI-SIGN-TYPE': '2',\n      'X-BAPI-TIMESTAMP': timestamp,\n      'X-BAPI-RECV-WINDOW': recvWindow,\n      'Content-Type': 'application/json',\n    };\n\n    const data = await this._proxyRequest(url, method, headers, method !== 'GET' ? params : null);\n    if (data.retCode !== 0 && data.retCode !== undefined) {\n      throw new Error(`Bybit: ${data.retMsg || 'Unknown error'} (${data.retCode})`);\n    }\n    return data.result || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── KRAKEN (HMAC-SHA512 with nonce) ───\n  // ════════════════════════════════════════════════════════\n  async _krakenRequest(creds, endpoint, params = {}) {\n    const nonce = Date.now().toString();\n    const postData = new URLSearchParams({ ...params, nonce }).toString();\n\n    // Kraken signature: HMAC-SHA512( base64decode(secret), path + SHA256(nonce + postData) )\n    const sha256Hash = await this._sha256(nonce + postData);\n    const pathBytes = new TextEncoder().encode(endpoint);\n    const sigInput = new Uint8Array(pathBytes.length + sha256Hash.length);\n    sigInput.set(pathBytes, 0);\n    sigInput.set(sha256Hash, pathBytes.length);\n    const signature = await this._hmacSignSHA512B64(creds.apiSecret, sigInput);\n\n    const url = `${BROKERS.kraken.baseUrl}${endpoint}`;\n    const headers = {\n      'API-Key': creds.apiKey,\n      'API-Sign': signature,\n      'Content-Type': 'application/x-www-form-urlencoded',\n    };\n\n    const data = await this._proxyRequest(url, 'POST', headers, postData);\n    if (data.error && data.error.length > 0) {\n      throw new Error(`Kraken: ${data.error.join(', ')}`);\n    }\n    return data.result || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── KUCOIN (HMAC-SHA256 + passphrase) ───\n  // ════════════════════════════════════════════════════════\n  async _kucoinRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now().toString();\n    let bodyStr = '';\n    let queryString = '';\n\n    if (method === 'GET' || method === 'DELETE') {\n      queryString = Object.entries(params)\n        .filter(([, v]) => v !== undefined && v !== null)\n        .map(([k, v]) => `${k}=${v}`)\n        .join('&');\n      if (queryString) endpoint = `${endpoint}?${queryString}`;\n    } else {\n      bodyStr = JSON.stringify(params);\n    }\n\n    const preSign = `${timestamp}${method}${endpoint}${bodyStr}`;\n    const signature = await this._hmacSignB64(creds.apiSecret, preSign);\n    const passphrase = await this._hmacSignB64(creds.apiSecret, creds.passphrase || '');\n\n    const url = `${BROKERS.kucoin.baseUrl}${endpoint}`;\n    const headers = {\n      'KC-API-KEY': creds.apiKey,\n      'KC-API-SIGN': signature,\n      'KC-API-TIMESTAMP': timestamp,\n      'KC-API-PASSPHRASE': passphrase,\n      'KC-API-KEY-VERSION': '2',\n      'Content-Type': 'application/json',\n    };\n\n    const data = await this._proxyRequest(url, method, headers, method !== 'GET' && method !== 'DELETE' ? params : null);\n    if (data.code && data.code !== '200000') {\n      throw new Error(`KuCoin: ${data.msg || 'Unknown error'} (${data.code})`);\n    }\n    return data.data || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── OKX (HMAC-SHA256 + passphrase, ISO timestamp) ───\n  // ════════════════════════════════════════════════════════\n  async _okxRequest(creds, method, endpoint, params = {}) {\n    const timestamp = new Date().toISOString();\n    let bodyStr = '';\n    let queryString = '';\n\n    if (method === 'GET') {\n      queryString = Object.entries(params)\n        .filter(([, v]) => v !== undefined && v !== null)\n        .map(([k, v]) => `${k}=${v}`)\n        .join('&');\n      if (queryString) endpoint = `${endpoint}?${queryString}`;\n    } else {\n      bodyStr = JSON.stringify(params);\n    }\n\n    const preSign = `${timestamp}${method}${endpoint}${bodyStr}`;\n    const signature = await this._hmacSignB64(creds.apiSecret, preSign);\n\n    const url = `${BROKERS.okx.baseUrl}${endpoint}`;\n    const headers = {\n      'OK-ACCESS-KEY': creds.apiKey,\n      'OK-ACCESS-SIGN': signature,\n      'OK-ACCESS-TIMESTAMP': timestamp,\n      'OK-ACCESS-PASSPHRASE': creds.passphrase || '',\n      'Content-Type': 'application/json',\n    };\n\n    const data = await this._proxyRequest(url, method, headers, method !== 'GET' ? params : null);\n    if (data.code && data.code !== '0') {\n      throw new Error(`OKX: ${data.msg || 'Unknown error'} (${data.code})`);\n    }\n    return data.data || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── BINGX (HMAC-SHA256, query string signing) ───\n  // ════════════════════════════════════════════════════════\n  async _bingxRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now().toString();\n    const allParams = { ...params, timestamp };\n    const queryString = Object.entries(allParams)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .filter(([, v]) => v !== undefined && v !== null)\n      .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n      .join('&');\n\n    const signature = await this._hmacSign(creds.apiSecret, queryString);\n    const signedQuery = `${queryString}&signature=${signature}`;\n\n    const url = `${BROKERS.bingx.baseUrl}${endpoint}?${signedQuery}`;\n    const headers = {\n      'X-BX-APIKEY': creds.apiKey,\n      'Content-Type': 'application/json',\n    };\n\n    const data = await this._proxyRequest(url, method, headers, method !== 'GET' ? params : null);\n    if (data.code && data.code !== 0) {\n      throw new Error(`BingX: ${data.msg || 'Unknown error'} (${data.code})`);\n    }\n    return data.data || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── BITGET (HMAC-SHA256 + passphrase, like OKX) ───\n  // ════════════════════════════════════════════════════════\n  async _bitgetRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now().toString();\n    let bodyStr = '';\n    let queryString = '';\n\n    if (method === 'GET') {\n      queryString = Object.entries(params)\n        .filter(([, v]) => v !== undefined && v !== null)\n        .map(([k, v]) => `${k}=${v}`)\n        .join('&');\n      if (queryString) endpoint = `${endpoint}?${queryString}`;\n    } else {\n      bodyStr = JSON.stringify(params);\n    }\n\n    const preSign = `${timestamp}${method}${endpoint}${bodyStr}`;\n    const signature = await this._hmacSignB64(creds.apiSecret, preSign);\n\n    const url = `${BROKERS.bitget.baseUrl}${endpoint}`;\n    const headers = {\n      'ACCESS-KEY': creds.apiKey,\n      'ACCESS-SIGN': signature,\n      'ACCESS-TIMESTAMP': timestamp,\n      'ACCESS-PASSPHRASE': creds.passphrase || '',\n      'Content-Type': 'application/json',\n      'locale': 'en-US',\n    };\n\n    const data = await this._proxyRequest(url, method, headers, method !== 'GET' ? params : null);\n    if (data.code && data.code !== '00000') {\n      throw new Error(`Bitget: ${data.msg || 'Unknown error'} (${data.code})`);\n    }\n    return data.data || data;\n  }\n\n  // ════════════════════════════════════════════════════════\n  // ─── MEXC (HMAC-SHA256, Binance-style query signing) ───\n  // ════════════════════════════════════════════════════════\n  async _mexcRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now();\n    const allParams = { ...params, timestamp, recvWindow: 5000 };\n    const queryString = Object.entries(allParams)\n      .filter(([, v]) => v !== undefined && v !== null)\n      .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n      .join('&');\n\n    const signature = await this._hmacSign(creds.apiSecret, queryString);\n    const signedQuery = `${queryString}&signature=${signature}`;\n\n    const url = method === 'GET'\n      ? `${BROKERS.mexc.baseUrl}${endpoint}?${signedQuery}`\n      : `${BROKERS.mexc.baseUrl}${endpoint}`;\n\n    const headers = {\n      'X-MEXC-APIKEY': creds.apiKey,\n      'Content-Type': 'application/json',\n    };\n\n    const body = method !== 'GET' ? signedQuery : null;\n    const data = await this._proxyRequest(url, method, headers, body);\n    if (data.code && data.code !== 0 && data.code !== 200) {\n      throw new Error(`MEXC: ${data.msg || 'Unknown error'} (${data.code})`);\n    }\n    return data;\n  }\n\n  // ─── Binance Signed Request ───\n  async _binanceSignedRequest(creds, method, endpoint, params = {}) {\n    const timestamp = Date.now();\n    const allParams = { ...params, timestamp, recvWindow: 5000 };\n    const queryString = Object.entries(allParams)\n      .filter(([, v]) => v !== undefined && v !== null)\n      .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n      .join('&');\n\n    const signature = await this._hmacSign(creds.apiSecret, queryString);\n    const signedQuery = `${queryString}&signature=${signature}`;\n\n    const url = method === 'GET'\n      ? `${BROKERS.binance.baseUrl}${endpoint}?${signedQuery}`\n      : `${BROKERS.binance.baseUrl}${endpoint}`;\n\n    const options = {\n      method,\n      headers: {\n        'X-MBX-APIKEY': creds.apiKey,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n    };\n\n    if (method === 'POST' || method === 'DELETE') {\n      options.body = signedQuery;\n    }\n\n    const res = await fetch(url, options);\n    const data = await res.json();\n    if (!res.ok) {\n      throw new Error(`Binance ${endpoint}: ${data.msg || res.statusText} (${data.code || res.status})`);\n    }\n    return data;\n  }\n\n  // ─── Binance Public Request ───\n  async _binancePublicRequest(endpoint, params = {}) {\n    const queryString = Object.entries(params)\n      .filter(([, v]) => v !== undefined)\n      .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n      .join('&');\n    const url = `${BROKERS.binance.baseUrl}${endpoint}${queryString ? '?' + queryString : ''}`;\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(`Binance API error: ${res.status}`);\n    return res.json();\n  }\n\n  // ─── Connect to broker ───\n  async connect(broker) {\n    const creds = this._decrypt(broker);\n    const config = BROKERS[broker.brokerId];\n    if (!config) throw new Error(`Unsupported broker: ${broker.brokerId}`);\n\n    try {\n      switch (broker.brokerId) {\n        case 'binance': {\n          // Real test: Ping + account info to verify API key\n          await this._binancePublicRequest('/api/v3/ping');\n          const account = await this._binanceSignedRequest(creds, 'GET', '/api/v3/account');\n          this.connections.set(broker.id, {\n            creds, config, connected: true,\n            permissions: account.permissions || [],\n            accountType: account.accountType,\n          });\n          return {\n            success: true,\n            message: `Connected to Binance (${account.accountType})`,\n            permissions: account.permissions,\n          };\n        }\n        case 'coinbase': {\n          const accounts = await this._coinbaseRequest(creds, 'GET', '/api/v3/brokerage/accounts?limit=250');\n          this.connections.set(broker.id, {\n            creds, config, connected: true,\n            permissions: ['read', 'trade'],\n            accounts: accounts.accounts || [],\n          });\n          return {\n            success: true,\n            message: `Connected to Coinbase (${(accounts.accounts || []).length} accounts)`,\n            permissions: ['read', 'trade'],\n          };\n        }\n        case 'bybit': {\n          const wallet = await this._bybitRequest(creds, 'GET', '/v5/account/wallet-balance', { accountType: 'UNIFIED' });\n          const coins = wallet?.list?.[0]?.coin?.length || 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to Bybit (${coins} assets)`, permissions: ['read', 'trade'] };\n        }\n        case 'kraken': {\n          const balance = await this._krakenRequest(creds, '/0/private/Balance');\n          const assets = Object.keys(balance || {}).length;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to Kraken (${assets} assets)`, permissions: ['read', 'trade'] };\n        }\n        case 'kucoin': {\n          const accounts = await this._kucoinRequest(creds, 'GET', '/api/v1/accounts');\n          const count = Array.isArray(accounts) ? accounts.length : 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to KuCoin (${count} accounts)`, permissions: ['read', 'trade'] };\n        }\n        case 'okx': {\n          const bal = await this._okxRequest(creds, 'GET', '/api/v5/account/balance');\n          const assets = Array.isArray(bal) && bal[0]?.details ? bal[0].details.length : 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to OKX (${assets} assets)`, permissions: ['read', 'trade'] };\n        }\n        case 'bingx': {\n          const bal = await this._bingxRequest(creds, 'GET', '/openApi/spot/v1/account/balance');\n          const assets = Array.isArray(bal?.balances) ? bal.balances.filter(b => parseFloat(b.free) > 0).length : 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to BingX (${assets} assets)`, permissions: ['read', 'trade'] };\n        }\n        case 'bitget': {\n          const acct = await this._bitgetRequest(creds, 'GET', '/api/v2/spot/account/assets');\n          const assets = Array.isArray(acct) ? acct.filter(a => parseFloat(a.available) > 0).length : 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to Bitget (${assets} assets)`, permissions: ['read', 'trade'] };\n        }\n        case 'mexc': {\n          const acct = await this._mexcRequest(creds, 'GET', '/api/v3/account');\n          const assets = Array.isArray(acct?.balances) ? acct.balances.filter(b => parseFloat(b.free) > 0).length : 0;\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: ['read', 'trade'] });\n          return { success: true, message: `Connected to MEXC (${assets} assets)`, permissions: ['read', 'trade'] };\n        }\n        default: {\n          await fetch(config.baseUrl);\n          this.connections.set(broker.id, { creds, config, connected: true, permissions: [] });\n          return { success: true, message: `Connected to ${config.name}` };\n        }\n      }\n    } catch (err) {\n      return { success: false, message: err.message };\n    }\n  }\n\n  // ─── Get REAL balances from Binance ───\n  async getBalances(brokerId) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    if (conn.config.id === 'binance') {\n      try {\n        const account = await this._binanceSignedRequest(conn.creds, 'GET', '/api/v3/account');\n        return account.balances\n          .filter(b => parseFloat(b.free) > 0 || parseFloat(b.locked) > 0)\n          .map(b => ({\n            asset: b.asset,\n            free: b.free,\n            locked: b.locked,\n            total: (parseFloat(b.free) + parseFloat(b.locked)).toString(),\n          }));\n      } catch (err) {\n        console.error('Binance getBalances error:', err);\n        throw err;\n      }\n    }\n\n    if (conn.config.id === 'coinbase') {\n      try {\n        const data = await this._coinbaseRequest(conn.creds, 'GET', '/api/v3/brokerage/accounts?limit=250');\n        // Debug removed for production\n        const allAccounts = (data.accounts || []).map(a => ({\n          asset: a.currency,\n          free: a.available_balance?.value || '0',\n          locked: a.hold?.value || '0',\n          total: (parseFloat(a.available_balance?.value || 0) + parseFloat(a.hold?.value || 0)).toString(),\n          name: a.name,\n        }));\n\n        const filtered = allAccounts.filter(a => parseFloat(a.free) > 0 || parseFloat(a.locked) > 0);\n\n        return filtered;\n      } catch (err) { console.error('Coinbase getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'bybit') {\n      try {\n        const wallet = await this._bybitRequest(conn.creds, 'GET', '/v5/account/wallet-balance', { accountType: 'UNIFIED' });\n        const coins = wallet?.list?.[0]?.coin || [];\n        return coins\n          .filter(c => parseFloat(c.walletBalance) > 0)\n          .map(c => ({\n            asset: c.coin,\n            free: c.availableToWithdraw || c.walletBalance || '0',\n            locked: (parseFloat(c.walletBalance || 0) - parseFloat(c.availableToWithdraw || 0)).toString(),\n            total: c.walletBalance || '0',\n          }));\n      } catch (err) { console.error('Bybit getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'kraken') {\n      try {\n        const balance = await this._krakenRequest(conn.creds, '/0/private/Balance');\n        // Kraken uses prefixes: XXBT for BTC, ZUSD for USD, etc.\n        const krakenMap = { XXBT: 'BTC', XETH: 'ETH', ZUSD: 'USD', XXRP: 'XRP', XLTC: 'LTC', XXLM: 'XLM', XDOGE: 'DOGE' };\n        return Object.entries(balance || {})\n          .filter(([, v]) => parseFloat(v) > 0)\n          .map(([k, v]) => ({\n            asset: krakenMap[k] || k.replace(/^[XZ]/, ''),\n            free: v,\n            locked: '0',\n            total: v,\n          }));\n      } catch (err) { console.error('Kraken getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'kucoin') {\n      try {\n        const accounts = await this._kucoinRequest(conn.creds, 'GET', '/api/v1/accounts', { type: 'trade' });\n        return (Array.isArray(accounts) ? accounts : [])\n          .filter(a => parseFloat(a.balance) > 0)\n          .map(a => ({\n            asset: a.currency,\n            free: a.available || '0',\n            locked: a.holds || '0',\n            total: a.balance || '0',\n          }));\n      } catch (err) { console.error('KuCoin getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'okx') {\n      try {\n        const bal = await this._okxRequest(conn.creds, 'GET', '/api/v5/account/balance');\n        const details = Array.isArray(bal) && bal[0]?.details ? bal[0].details : [];\n        return details\n          .filter(d => parseFloat(d.cashBal) > 0)\n          .map(d => ({\n            asset: d.ccy,\n            free: d.availBal || d.cashBal || '0',\n            locked: d.frozenBal || '0',\n            total: d.cashBal || '0',\n          }));\n      } catch (err) { console.error('OKX getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'bingx') {\n      try {\n        const data = await this._bingxRequest(conn.creds, 'GET', '/openApi/spot/v1/account/balance');\n        const balances = data?.balances || (Array.isArray(data) ? data : []);\n        return balances\n          .filter(b => parseFloat(b.free || b.available || 0) > 0)\n          .map(b => ({\n            asset: b.asset || b.currency,\n            free: b.free || b.available || '0',\n            locked: b.locked || b.freeze || '0',\n            total: (parseFloat(b.free || b.available || 0) + parseFloat(b.locked || b.freeze || 0)).toString(),\n          }));\n      } catch (err) { console.error('BingX getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'bitget') {\n      try {\n        const data = await this._bitgetRequest(conn.creds, 'GET', '/api/v2/spot/account/assets');\n        const assets = Array.isArray(data) ? data : [];\n        return assets\n          .filter(a => parseFloat(a.available || 0) > 0)\n          .map(a => ({\n            asset: a.coin || a.coinName,\n            free: a.available || '0',\n            locked: a.frozen || a.lock || '0',\n            total: (parseFloat(a.available || 0) + parseFloat(a.frozen || a.lock || 0)).toString(),\n          }));\n      } catch (err) { console.error('Bitget getBalances:', err); throw err; }\n    }\n\n    if (conn.config.id === 'mexc') {\n      try {\n        const acct = await this._mexcRequest(conn.creds, 'GET', '/api/v3/account');\n        const balances = Array.isArray(acct?.balances) ? acct.balances : [];\n        return balances\n          .filter(b => parseFloat(b.free || 0) > 0)\n          .map(b => ({\n            asset: b.asset,\n            free: b.free || '0',\n            locked: b.locked || '0',\n            total: (parseFloat(b.free || 0) + parseFloat(b.locked || 0)).toString(),\n          }));\n      } catch (err) { console.error('MEXC getBalances:', err); throw err; }\n    }\n\n    // Fallback for unsupported brokers\n    return [];\n  }\n\n  // ─── Place REAL order on Binance ───\n  async placeOrder(brokerId, order) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    const { symbol, side, type, quantity, price, stopLoss, takeProfit } = order;\n    if (!symbol || !side || !type || !quantity) {\n      throw new Error('Missing required order fields');\n    }\n\n    if (conn.config.id === 'binance') {\n      try {\n        // Map order type to Binance format\n        const binanceType = {\n          market: 'MARKET',\n          limit: 'LIMIT',\n          stop_loss: 'STOP_LOSS_LIMIT',\n        }[type] || 'MARKET';\n\n        const params = {\n          symbol: symbol,\n          side: side.toUpperCase(),\n          type: binanceType,\n          quantity: quantity.toString(),\n        };\n\n        if (binanceType === 'LIMIT' || binanceType === 'STOP_LOSS_LIMIT') {\n          params.timeInForce = 'GTC';\n          params.price = parseFloat(price).toFixed(2);\n        }\n        if (binanceType === 'STOP_LOSS_LIMIT') {\n          params.stopPrice = parseFloat(stopLoss || price).toFixed(2);\n        }\n\n        const result = await this._binanceSignedRequest(conn.creds, 'POST', '/api/v3/order', params);\n\n        return {\n          id: result.orderId?.toString(),\n          clientOrderId: result.clientOrderId,\n          symbol: result.symbol,\n          side: result.side?.toLowerCase(),\n          type: result.type?.toLowerCase(),\n          quantity: parseFloat(result.origQty || quantity),\n          price: parseFloat(result.price || price || 0),\n          filledPrice: parseFloat(result.fills?.[0]?.price || result.price || 0),\n          filledQty: parseFloat(result.executedQty || 0),\n          status: result.status?.toLowerCase(),\n          timestamp: new Date(result.transactTime || Date.now()).toISOString(),\n          broker: 'Binance',\n          real: true,\n          raw: result,\n        };\n      } catch (err) {\n        console.error('Binance placeOrder error:', err);\n        throw err;\n      }\n    }\n\n    if (conn.config.id === 'coinbase') {\n      try {\n        // Coinbase Advanced Trade API — Create Order\n        // https://docs.cdp.coinbase.com/advanced-trade/reference/retailbrokerageapi_postorder\n        // Convert symbol: BTCUSDT → BTC-USDT (Coinbase format)\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD|BTC|ETH)$/i, '$1-$2').toUpperCase();\n\n        const orderConfig = {};\n        if (type === 'market') {\n          if (side.toLowerCase() === 'buy') {\n            // Market buy: specify quote_size (USD amount)\n            orderConfig.market_market_ioc = {\n              quote_size: (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2),\n            };\n          } else {\n            // Market sell: specify base_size (crypto amount)\n            orderConfig.market_market_ioc = {\n              base_size: parseFloat(quantity).toString(),\n            };\n          }\n        } else if (type === 'limit') {\n          orderConfig.limit_limit_gtc = {\n            base_size: parseFloat(quantity).toString(),\n            limit_price: parseFloat(price).toFixed(2),\n          };\n        }\n\n        const orderBody = {\n          client_order_id: crypto.randomUUID(),\n          product_id: productId,\n          side: side.toUpperCase(),\n          order_configuration: orderConfig,\n        };\n\n\n        const result = await this._coinbaseRequest(conn.creds, 'POST', '/api/v3/brokerage/orders', orderBody);\n\n\n        // Coinbase returns { success: true/false, success_response: {...}, error_response: {...} }\n        if (!result.success) {\n          const errMsg = result.error_response?.error || result.failure_response?.error \n            || result.error_response?.message || result.error || 'Unknown error';\n          const errDetail = result.error_response?.error_details || result.failure_response?.message || '';\n          console.error('[COINBASE ORDER] FAILED:', errMsg, errDetail);\n          throw new Error(`Coinbase order failed: ${errMsg}${errDetail ? ' — ' + errDetail : ''}`);\n        }\n\n        const orderResult = result.success_response || result;\n        const orderId = orderResult.order_id || orderResult.id;\n        if (!orderId) {\n          console.error('[COINBASE ORDER] No order_id in response:', result);\n          throw new Error('Coinbase: no order_id returned');\n        }\n\n\n        // Wait briefly for market order to fill, then fetch details\n        let filledPrice = 0;\n        let filledQty = 0;\n        let orderStatus = 'unknown';\n\n        // Retry up to 3 times to get fill details (market orders fill within ms)\n        for (let attempt = 0; attempt < 3; attempt++) {\n          try {\n            if (attempt > 0) await new Promise(r => setTimeout(r, 500));\n            const details = await this._coinbaseRequest(conn.creds, 'GET', `/api/v3/brokerage/orders/historical/${orderId}`);\n\n            const ord = details.order || details;\n            orderStatus = (ord.status || '').toUpperCase();\n            filledPrice = parseFloat(ord.average_filled_price || 0);\n            filledQty = parseFloat(ord.filled_size || 0);\n            if (orderStatus === 'FILLED' || orderStatus === 'CANCELLED' || filledQty > 0) break;\n          } catch (detailErr) {\n            console.warn(`[COINBASE ORDER] Detail fetch attempt ${attempt + 1} failed:`, detailErr.message);\n          }\n        }\n\n        // If we still couldn't confirm fill, mark as unconfirmed\n        if (filledQty === 0 && filledPrice === 0) {\n          console.warn('[COINBASE ORDER] Could not confirm fill for', orderId, '- status:', orderStatus);\n          // Use local price as estimate but flag it\n          filledPrice = parseFloat(price || 0);\n          filledQty = parseFloat(quantity);\n          orderStatus = 'UNCONFIRMED';\n        }\n\n\n\n        return {\n          id: orderId,\n          clientOrderId: orderBody.client_order_id,\n          symbol: productId,\n          side: side.toLowerCase(),\n          type,\n          quantity: filledQty,\n          price: filledPrice,\n          filledPrice,\n          filledQty,\n          status: orderStatus.toLowerCase(),\n          confirmed: orderStatus !== 'UNCONFIRMED',\n          timestamp: new Date().toISOString(),\n          broker: 'Coinbase',\n          real: true,\n        };\n      } catch (err) {\n        console.error('[COINBASE ORDER] placeOrder error:', err.message);\n        throw err;\n      }\n    }\n\n    // ─── BYBIT v5 ───\n    if (conn.config.id === 'bybit') {\n      try {\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const orderParams = {\n          category: 'spot',\n          symbol: productId,\n          side: side.charAt(0).toUpperCase() + side.slice(1).toLowerCase(),\n          orderType: type === 'market' ? 'Market' : 'Limit',\n          qty: quantity.toString(),\n        };\n        if (type === 'market' && side.toLowerCase() === 'buy') {\n          // Bybit spot market buy: use quote qty\n          orderParams.marketUnit = 'quoteCoin';\n          orderParams.qty = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n        }\n        if (type === 'limit') {\n          orderParams.price = parseFloat(price).toFixed(2);\n          orderParams.timeInForce = 'GTC';\n        }\n        const result = await this._bybitRequest(conn.creds, 'POST', '/v5/order/create', orderParams);\n        const orderId = result.orderId || Date.now().toString(36);\n        // Get fill details\n        let filledPrice = parseFloat(price || 0);\n        let filledQty = parseFloat(quantity);\n        try {\n          await new Promise(r => setTimeout(r, 500)); // Wait for fill\n          const detail = await this._bybitRequest(conn.creds, 'GET', '/v5/order/realtime', { category: 'spot', orderId });\n          const o = detail?.list?.[0];\n          if (o) {\n            filledPrice = parseFloat(o.avgPrice || o.price || price || 0);\n            filledQty = parseFloat(o.cumExecQty || quantity);\n          }\n        } catch {}\n        return {\n          id: orderId, symbol: productId, side: side.toLowerCase(), type,\n          quantity: filledQty, price: filledPrice, filledPrice, filledQty,\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'Bybit', real: true,\n        };\n      } catch (err) { console.error('Bybit placeOrder:', err); throw err; }\n    }\n\n    // ─── KRAKEN ───\n    if (conn.config.id === 'kraken') {\n      try {\n        // Kraken pair format: XBTUSDT, ETHUSDT\n        const krakenPair = symbol.replace('BTC', 'XBT');\n        const params = {\n          pair: krakenPair,\n          type: side.toLowerCase(),\n          ordertype: type === 'market' ? 'market' : 'limit',\n          volume: quantity.toString(),\n        };\n        if (type === 'limit') params.price = parseFloat(price).toFixed(2);\n        const result = await this._krakenRequest(conn.creds, '/0/private/AddOrder', params);\n        const txid = result?.txid?.[0] || Date.now().toString(36);\n        return {\n          id: txid, symbol: krakenPair, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(price || 0), filledQty: parseFloat(quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'Kraken', real: true,\n        };\n      } catch (err) { console.error('Kraken placeOrder:', err); throw err; }\n    }\n\n    // ─── KUCOIN ───\n    if (conn.config.id === 'kucoin') {\n      try {\n        // KuCoin pair: BTC-USDT\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const params = {\n          clientOid: crypto.randomUUID(),\n          symbol: productId,\n          side: side.toLowerCase(),\n          type: type === 'market' ? 'market' : 'limit',\n        };\n        if (type === 'market') {\n          if (side.toLowerCase() === 'buy') {\n            params.funds = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n          } else {\n            params.size = quantity.toString();\n          }\n        } else {\n          params.price = parseFloat(price).toFixed(2);\n          params.size = quantity.toString();\n        }\n        const result = await this._kucoinRequest(conn.creds, 'POST', '/api/v1/orders', params);\n        const orderId = result?.orderId || Date.now().toString(36);\n        return {\n          id: orderId, symbol: productId, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(price || 0), filledQty: parseFloat(quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'KuCoin', real: true,\n        };\n      } catch (err) { console.error('KuCoin placeOrder:', err); throw err; }\n    }\n\n    // ─── OKX ───\n    if (conn.config.id === 'okx') {\n      try {\n        // OKX pair: BTC-USDT\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const params = {\n          instId: productId,\n          tdMode: 'cash', // spot\n          side: side.toLowerCase(),\n          ordType: type === 'market' ? 'market' : 'limit',\n          sz: quantity.toString(),\n        };\n        if (type === 'market' && side.toLowerCase() === 'buy') {\n          params.tgtCcy = 'quote_ccy';\n          params.sz = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n        }\n        if (type === 'limit') params.px = parseFloat(price).toFixed(2);\n        const result = await this._okxRequest(conn.creds, 'POST', '/api/v5/trade/order', params);\n        const orderId = Array.isArray(result) ? result[0]?.ordId : result?.ordId || Date.now().toString(36);\n        if (Array.isArray(result) && result[0]?.sCode !== '0') {\n          throw new Error(`OKX order failed: ${result[0]?.sMsg}`);\n        }\n        return {\n          id: orderId, symbol: productId, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(price || 0), filledQty: parseFloat(quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'OKX', real: true,\n        };\n      } catch (err) { console.error('OKX placeOrder:', err); throw err; }\n    }\n\n    // ─── BINGX ───\n    if (conn.config.id === 'bingx') {\n      try {\n        // BingX pair: BTC-USDT\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const params = {\n          symbol: productId,\n          side: side.toUpperCase(),\n          type: type === 'market' ? 'MARKET' : 'LIMIT',\n        };\n        if (type === 'market') {\n          if (side.toLowerCase() === 'buy') {\n            params.quoteOrderQty = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n          } else {\n            params.quantity = parseFloat(quantity).toString();\n          }\n        } else {\n          params.price = parseFloat(price).toFixed(2);\n          params.quantity = parseFloat(quantity).toString();\n        }\n        const result = await this._bingxRequest(conn.creds, 'POST', '/openApi/spot/v1/trade/order', params);\n        const orderId = result?.orderId || result?.data?.orderId || Date.now().toString(36);\n        return {\n          id: orderId?.toString(), symbol: productId, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(result?.price || price || 0),\n          filledQty: parseFloat(result?.executedQty || quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'BingX', real: true,\n        };\n      } catch (err) { console.error('BingX placeOrder:', err); throw err; }\n    }\n\n    // ─── BITGET ───\n    if (conn.config.id === 'bitget') {\n      try {\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const params = {\n          symbol: productId,\n          side: side.toLowerCase(),\n          orderType: type === 'market' ? 'market' : 'limit',\n          force: 'gtc',\n          size: quantity.toString(),\n        };\n        if (type === 'market' && side.toLowerCase() === 'buy') {\n          params.size = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n        }\n        if (type === 'limit') params.price = parseFloat(price).toFixed(2);\n        const result = await this._bitgetRequest(conn.creds, 'POST', '/api/v2/spot/trade/place-order', params);\n        const orderId = result?.orderId || Date.now().toString(36);\n        return {\n          id: orderId?.toString(), symbol: productId, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(price || 0), filledQty: parseFloat(quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'Bitget', real: true,\n        };\n      } catch (err) { console.error('Bitget placeOrder:', err); throw err; }\n    }\n\n    // ─── MEXC ───\n    if (conn.config.id === 'mexc') {\n      try {\n        // MEXC uses Binance-style symbols: BTCUSDT\n        const productId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const params = {\n          symbol: productId,\n          side: side.toUpperCase(),\n          type: type === 'market' ? 'MARKET' : 'LIMIT',\n        };\n        if (type === 'market') {\n          if (side.toLowerCase() === 'buy') {\n            params.quoteOrderQty = (parseFloat(quantity) * parseFloat(price || 0)).toFixed(2);\n          } else {\n            params.quantity = parseFloat(quantity).toString();\n          }\n        } else {\n          params.price = parseFloat(price).toFixed(2);\n          params.quantity = parseFloat(quantity).toString();\n          params.timeInForce = 'GTC';\n        }\n        const result = await this._mexcRequest(conn.creds, 'POST', '/api/v3/order', params);\n        const orderId = result?.orderId || Date.now().toString(36);\n        return {\n          id: orderId?.toString(), symbol: productId, side: side.toLowerCase(), type,\n          quantity: parseFloat(quantity), price: parseFloat(price || 0),\n          filledPrice: parseFloat(result?.price || price || 0),\n          filledQty: parseFloat(result?.executedQty || quantity),\n          status: 'filled', timestamp: new Date().toISOString(), broker: 'MEXC', real: true,\n        };\n      } catch (err) { console.error('MEXC placeOrder:', err); throw err; }\n    }\n\n    // ─── WALLET / DEX ───\n    if (conn.config.id === 'wallet') {\n      try {\n        const chainId = conn.chainId || 56;\n        const privateKey = conn.creds.apiSecret;\n        const result = await walletBroker.placeOrder(privateKey, chainId, {\n          symbol, side, type: 'market', quantity, price\n        });\n        if (!result.success) throw new Error(result.error || 'DEX swap failed');\n        return {\n          id: result.txHash || Date.now().toString(36),\n          symbol: result.symbol || symbol,\n          side: side.toLowerCase(),\n          type: 'market',\n          quantity: parseFloat(result.amountIn || quantity),\n          price: parseFloat(result.effectivePrice || price || 0),\n          filledPrice: parseFloat(result.effectivePrice || price || 0),\n          filledQty: parseFloat(result.amountOut || quantity),\n          status: 'filled',\n          timestamp: new Date().toISOString(),\n          broker: 'Kairos Wallet',\n          real: true,\n          txHash: result.txHash,\n          chain: result.chain,\n        };\n      } catch (err) { console.error('Wallet DEX placeOrder:', err); throw err; }\n    }\n\n    // Simulated execution for any remaining unsupported brokers\n    return {\n      id: Date.now().toString(36),\n      symbol, side, type,\n      quantity: parseFloat(quantity),\n      price: price ? parseFloat(price) : null,\n      status: type === 'market' ? 'filled' : 'new',\n      filledPrice: type === 'market' ? parseFloat(price || 0) : null,\n      timestamp: new Date().toISOString(),\n      broker: conn.config.name,\n      simulated: true,\n    };\n  }\n\n  // ─── Cancel order ───\n  async cancelOrder(brokerId, orderId, symbol) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    if (conn.config.id === 'binance') {\n      try {\n        const result = await this._binanceSignedRequest(conn.creds, 'DELETE', '/api/v3/order', { symbol, orderId });\n        return { success: true, orderId: result.orderId, status: result.status };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'coinbase') {\n      try {\n        await this._coinbaseRequest(conn.creds, 'POST', '/api/v3/brokerage/orders/batch_cancel', { order_ids: [orderId] });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'bybit') {\n      try {\n        await this._bybitRequest(conn.creds, 'POST', '/v5/order/cancel', { category: 'spot', symbol, orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'kraken') {\n      try {\n        await this._krakenRequest(conn.creds, '/0/private/CancelOrder', { txid: orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'kucoin') {\n      try {\n        await this._kucoinRequest(conn.creds, 'DELETE', `/api/v1/orders/${orderId}`);\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'okx') {\n      try {\n        await this._okxRequest(conn.creds, 'POST', '/api/v5/trade/cancel-order', { instId: symbol, ordId: orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'bingx') {\n      try {\n        await this._bingxRequest(conn.creds, 'POST', '/openApi/spot/v1/trade/cancel', { symbol, orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'bitget') {\n      try {\n        await this._bitgetRequest(conn.creds, 'POST', '/api/v2/spot/trade/cancel-order', { symbol, orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'mexc') {\n      try {\n        await this._mexcRequest(conn.creds, 'DELETE', '/api/v3/order', { symbol, orderId });\n        return { success: true, orderId };\n      } catch (err) { return { success: false, message: err.message }; }\n    }\n    if (conn.config.id === 'wallet') {\n      return { success: false, message: 'DEX orders are instant swaps and cannot be cancelled' };\n    }\n\n    return { success: true, orderId, simulated: true };\n  }\n\n  // ─── Get open orders (real) ───\n  async getOpenOrders(brokerId, symbol) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    if (conn.config.id === 'binance') {\n      try {\n        const params = symbol ? { symbol } : {};\n        const orders = await this._binanceSignedRequest(conn.creds, 'GET', '/api/v3/openOrders', params);\n        return orders.map(o => ({\n          id: o.orderId?.toString(),\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.type?.toLowerCase(),\n          quantity: parseFloat(o.origQty),\n          price: parseFloat(o.price),\n          filledQty: parseFloat(o.executedQty),\n          status: o.status?.toLowerCase(),\n          time: new Date(o.time).toISOString(),\n        }));\n      } catch (err) {\n        return [];\n      }\n    }\n\n    if (conn.config.id === 'coinbase') {\n      try {\n        const productId = symbol\n          ? symbol.replace(/([A-Z]+)(USDT|USDC|USD|BTC|ETH)$/i, '$1-$2').toUpperCase()\n          : undefined;\n        let url = '/api/v3/brokerage/orders/historical/batch?order_status=OPEN';\n        if (productId) url += `&product_id=${productId}`;\n        const data = await this._coinbaseRequest(conn.creds, 'GET', url);\n        return (data.orders || []).map(o => ({\n          id: o.order_id,\n          symbol: o.product_id,\n          side: o.side?.toLowerCase(),\n          type: o.order_type?.toLowerCase(),\n          quantity: parseFloat(o.order_configuration?.limit_limit_gtc?.base_size || 0),\n          price: parseFloat(o.order_configuration?.limit_limit_gtc?.limit_price || o.average_filled_price || 0),\n          filledQty: parseFloat(o.filled_size || 0),\n          status: o.status?.toLowerCase(),\n          time: o.created_time,\n        }));\n      } catch (err) {\n        console.error('[COINBASE] getOpenOrders error:', err.message);\n        return [];\n      }\n    }\n\n    // ─── BYBIT v5 ───\n    if (conn.config.id === 'bybit') {\n      try {\n        const params = { category: 'spot' };\n        if (symbol) params.symbol = symbol;\n        const data = await this._bybitRequest(conn.creds, 'GET', '/v5/order/realtime', params);\n        return (data?.list || []).map(o => ({\n          id: o.orderId,\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.orderType?.toLowerCase(),\n          quantity: parseFloat(o.qty || 0),\n          price: parseFloat(o.price || 0),\n          filledQty: parseFloat(o.cumExecQty || 0),\n          status: o.orderStatus?.toLowerCase(),\n          time: o.createdTime ? new Date(parseInt(o.createdTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('Bybit getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── KRAKEN ───\n    if (conn.config.id === 'kraken') {\n      try {\n        const data = await this._krakenRequest(conn.creds, '/0/private/OpenOrders');\n        const orders = data?.open || {};\n        return Object.entries(orders).map(([txid, o]) => ({\n          id: txid,\n          symbol: o.descr?.pair || '',\n          side: o.descr?.type?.toLowerCase(),\n          type: o.descr?.ordertype?.toLowerCase(),\n          quantity: parseFloat(o.vol || 0),\n          price: parseFloat(o.descr?.price || 0),\n          filledQty: parseFloat(o.vol_exec || 0),\n          status: o.status?.toLowerCase() || 'open',\n          time: o.opentm ? new Date(o.opentm * 1000).toISOString() : null,\n        }));\n      } catch (err) { console.error('Kraken getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── KUCOIN ───\n    if (conn.config.id === 'kucoin') {\n      try {\n        const params = { status: 'active' };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._kucoinRequest(conn.creds, 'GET', '/api/v1/orders', params);\n        const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : []);\n        return items.map(o => ({\n          id: o.id,\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.type?.toLowerCase(),\n          quantity: parseFloat(o.size || 0),\n          price: parseFloat(o.price || 0),\n          filledQty: parseFloat(o.dealSize || 0),\n          status: o.isActive ? 'open' : 'done',\n          time: o.createdAt ? new Date(parseInt(o.createdAt)).toISOString() : null,\n        }));\n      } catch (err) { console.error('KuCoin getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── OKX ───\n    if (conn.config.id === 'okx') {\n      try {\n        const params = { instType: 'SPOT' };\n        if (symbol) params.instId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._okxRequest(conn.creds, 'GET', '/api/v5/trade/orders-pending', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.map(o => ({\n          id: o.ordId,\n          symbol: o.instId,\n          side: o.side?.toLowerCase(),\n          type: o.ordType?.toLowerCase(),\n          quantity: parseFloat(o.sz || 0),\n          price: parseFloat(o.px || 0),\n          filledQty: parseFloat(o.accFillSz || 0),\n          status: o.state?.toLowerCase() || 'open',\n          time: o.cTime ? new Date(parseInt(o.cTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('OKX getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── BINGX ───\n    if (conn.config.id === 'bingx') {\n      try {\n        const params = {};\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._bingxRequest(conn.creds, 'GET', '/openApi/spot/v1/trade/openOrders', params);\n        const orders = data?.orders || (Array.isArray(data) ? data : []);\n        return orders.map(o => ({\n          id: o.orderId?.toString(),\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.type?.toLowerCase(),\n          quantity: parseFloat(o.origQty || 0),\n          price: parseFloat(o.price || 0),\n          filledQty: parseFloat(o.executedQty || 0),\n          status: o.status?.toLowerCase() || 'open',\n          time: o.time ? new Date(parseInt(o.time)).toISOString() : null,\n        }));\n      } catch (err) { console.error('BingX getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── BITGET ───\n    if (conn.config.id === 'bitget') {\n      try {\n        const params = {};\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const data = await this._bitgetRequest(conn.creds, 'GET', '/api/v2/spot/trade/unfilled-orders', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.map(o => ({\n          id: o.orderId,\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.orderType?.toLowerCase(),\n          quantity: parseFloat(o.size || 0),\n          price: parseFloat(o.price || 0),\n          filledQty: parseFloat(o.baseVolume || 0),\n          status: o.status?.toLowerCase() || 'open',\n          time: o.cTime ? new Date(parseInt(o.cTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('Bitget getOpenOrders:', err.message); return []; }\n    }\n\n    // ─── MEXC ───\n    if (conn.config.id === 'mexc') {\n      try {\n        const params = {};\n        if (symbol) params.symbol = symbol;\n        const data = await this._mexcRequest(conn.creds, 'GET', '/api/v3/openOrders', params);\n        const orders = Array.isArray(data) ? data : [];\n        return orders.map(o => ({\n          id: o.orderId?.toString(),\n          symbol: o.symbol,\n          side: o.side?.toLowerCase(),\n          type: o.type?.toLowerCase(),\n          quantity: parseFloat(o.origQty || 0),\n          price: parseFloat(o.price || 0),\n          filledQty: parseFloat(o.executedQty || 0),\n          status: o.status?.toLowerCase() || 'open',\n          time: o.time ? new Date(o.time).toISOString() : null,\n        }));\n      } catch (err) { console.error('MEXC getOpenOrders:', err.message); return []; }\n    }\n\n    return [];\n  }\n\n  // ─── Get closed/completed orders (filled, cancelled, expired) ───\n  async getClosedOrders(brokerId, symbol, limit = 50) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    const normalize = (o, fields) => ({\n      id: o[fields.id]?.toString() || '',\n      symbol: o[fields.symbol] || '',\n      side: (o[fields.side] || '').toLowerCase(),\n      type: (o[fields.type] || '').toLowerCase(),\n      quantity: parseFloat(o[fields.qty] || 0),\n      price: parseFloat(o[fields.price] || 0),\n      filledQty: parseFloat(o[fields.filledQty] || 0),\n      avgPrice: parseFloat(o[fields.avgPrice] || o[fields.price] || 0),\n      status: (o[fields.status] || 'closed').toLowerCase(),\n      time: fields.timeFn ? fields.timeFn(o) : null,\n    });\n\n    // ─── BINANCE ───\n    if (conn.config.id === 'binance') {\n      try {\n        const params = { limit };\n        if (symbol) params.symbol = symbol;\n        const data = await this._binanceSignedRequest(conn.creds, 'GET', '/api/v3/allOrders', params);\n        const orders = Array.isArray(data) ? data : [];\n        return orders.filter(o => o.status !== 'NEW' && o.status !== 'PARTIALLY_FILLED').map(o => normalize(o, {\n          id: 'orderId', symbol: 'symbol', side: 'side', type: 'type',\n          qty: 'origQty', price: 'price', filledQty: 'executedQty', avgPrice: 'price',\n          status: 'status', timeFn: (o) => o.time ? new Date(o.time).toISOString() : null,\n        }));\n      } catch (err) { console.error('Binance getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── COINBASE ───\n    if (conn.config.id === 'coinbase') {\n      try {\n        const params = { order_status: ['FILLED', 'CANCELLED', 'EXPIRED'], limit };\n        if (symbol) params.product_id = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._coinbaseRequest(conn.creds, 'GET', '/api/v3/brokerage/orders/historical/batch', params);\n        return (data?.orders || []).map(o => normalize(o, {\n          id: 'order_id', symbol: 'product_id', side: 'side', type: 'order_type',\n          qty: 'base_size', price: 'average_filled_price', filledQty: 'filled_size', avgPrice: 'average_filled_price',\n          status: 'status', timeFn: (o) => o.created_time || null,\n        }));\n      } catch (err) { console.error('Coinbase getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── BYBIT v5 ───\n    if (conn.config.id === 'bybit') {\n      try {\n        const params = { category: 'spot', limit: limit.toString() };\n        if (symbol) params.symbol = symbol;\n        const data = await this._bybitRequest(conn.creds, 'GET', '/v5/order/history', params);\n        return (data?.list || []).map(o => normalize(o, {\n          id: 'orderId', symbol: 'symbol', side: 'side', type: 'orderType',\n          qty: 'qty', price: 'price', filledQty: 'cumExecQty', avgPrice: 'avgPrice',\n          status: 'orderStatus', timeFn: (o) => o.createdTime ? new Date(parseInt(o.createdTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('Bybit getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── KRAKEN ───\n    if (conn.config.id === 'kraken') {\n      try {\n        const data = await this._krakenRequest(conn.creds, '/0/private/ClosedOrders');\n        const orders = data?.closed || {};\n        return Object.entries(orders).slice(0, limit).map(([txid, o]) => ({\n          id: txid,\n          symbol: o.descr?.pair || '',\n          side: (o.descr?.type || '').toLowerCase(),\n          type: (o.descr?.ordertype || '').toLowerCase(),\n          quantity: parseFloat(o.vol || 0),\n          price: parseFloat(o.descr?.price || 0),\n          filledQty: parseFloat(o.vol_exec || 0),\n          avgPrice: parseFloat(o.price || o.descr?.price || 0),\n          status: (o.status || 'closed').toLowerCase(),\n          time: o.closetm ? new Date(o.closetm * 1000).toISOString() : null,\n        }));\n      } catch (err) { console.error('Kraken getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── KUCOIN ───\n    if (conn.config.id === 'kucoin') {\n      try {\n        const params = { status: 'done' };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._kucoinRequest(conn.creds, 'GET', '/api/v1/orders', params);\n        const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : []);\n        return items.slice(0, limit).map(o => normalize(o, {\n          id: 'id', symbol: 'symbol', side: 'side', type: 'type',\n          qty: 'size', price: 'price', filledQty: 'dealSize', avgPrice: 'dealFunds',\n          status: 'status', timeFn: (o) => o.createdAt ? new Date(parseInt(o.createdAt)).toISOString() : null,\n        }));\n      } catch (err) { console.error('KuCoin getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── OKX ───\n    if (conn.config.id === 'okx') {\n      try {\n        const params = { instType: 'SPOT' };\n        if (symbol) params.instId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._okxRequest(conn.creds, 'GET', '/api/v5/trade/orders-history-archive', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.slice(0, limit).map(o => normalize(o, {\n          id: 'ordId', symbol: 'instId', side: 'side', type: 'ordType',\n          qty: 'sz', price: 'px', filledQty: 'accFillSz', avgPrice: 'avgPx',\n          status: 'state', timeFn: (o) => o.cTime ? new Date(parseInt(o.cTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('OKX getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── BINGX ───\n    if (conn.config.id === 'bingx') {\n      try {\n        const params = { limit: limit.toString() };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._bingxRequest(conn.creds, 'GET', '/openApi/spot/v1/trade/historyOrders', params);\n        const orders = data?.orders || (Array.isArray(data) ? data : []);\n        return orders.map(o => normalize(o, {\n          id: 'orderId', symbol: 'symbol', side: 'side', type: 'type',\n          qty: 'origQty', price: 'price', filledQty: 'executedQty', avgPrice: 'avgPrice',\n          status: 'status', timeFn: (o) => o.time ? new Date(parseInt(o.time)).toISOString() : null,\n        }));\n      } catch (err) { console.error('BingX getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── BITGET ───\n    if (conn.config.id === 'bitget') {\n      try {\n        const params = { limit: limit.toString() };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const data = await this._bitgetRequest(conn.creds, 'GET', '/api/v2/spot/trade/history-orders', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.map(o => normalize(o, {\n          id: 'orderId', symbol: 'symbol', side: 'side', type: 'orderType',\n          qty: 'size', price: 'price', filledQty: 'baseVolume', avgPrice: 'priceAvg',\n          status: 'status', timeFn: (o) => o.cTime ? new Date(parseInt(o.cTime)).toISOString() : null,\n        }));\n      } catch (err) { console.error('Bitget getClosedOrders:', err.message); return []; }\n    }\n\n    // ─── MEXC ───\n    if (conn.config.id === 'mexc') {\n      try {\n        const params = { limit };\n        if (symbol) params.symbol = symbol;\n        const data = await this._mexcRequest(conn.creds, 'GET', '/api/v3/allOrders', params);\n        const orders = Array.isArray(data) ? data : [];\n        return orders.filter(o => o.status !== 'NEW').map(o => normalize(o, {\n          id: 'orderId', symbol: 'symbol', side: 'side', type: 'type',\n          qty: 'origQty', price: 'price', filledQty: 'executedQty', avgPrice: 'price',\n          status: 'status', timeFn: (o) => o.time ? new Date(o.time).toISOString() : null,\n        }));\n      } catch (err) { console.error('MEXC getClosedOrders:', err.message); return []; }\n    }\n\n    return [];\n  }\n\n  // ─── Get trade history (real) ───\n  async getTradeHistory(brokerId, symbol, limit = 50) {\n    const conn = this.connections.get(brokerId);\n    if (!conn) throw new Error('Broker not connected');\n\n    if (conn.config.id === 'binance') {\n      try {\n        const trades = await this._binanceSignedRequest(conn.creds, 'GET', '/api/v3/myTrades', { symbol, limit });\n        return trades.map(t => ({\n          id: t.id?.toString(),\n          orderId: t.orderId?.toString(),\n          symbol: t.symbol,\n          side: t.isBuyer ? 'buy' : 'sell',\n          price: parseFloat(t.price),\n          quantity: parseFloat(t.qty),\n          commission: parseFloat(t.commission),\n          commissionAsset: t.commissionAsset,\n          time: new Date(t.time).toISOString(),\n          isMaker: t.isMaker,\n        }));\n      } catch (err) {\n        return [];\n      }\n    }\n\n    if (conn.config.id === 'coinbase') {\n      try {\n        const productId = symbol\n          ? symbol.replace(/([A-Z]+)(USDT|USDC|USD|BTC|ETH)$/i, '$1-$2').toUpperCase()\n          : undefined;\n        let url = `/api/v3/brokerage/orders/historical/fills?limit=${limit}`;\n        if (productId) url += `&product_id=${productId}`;\n        const data = await this._coinbaseRequest(conn.creds, 'GET', url);\n\n        return (data.fills || []).map(f => ({\n          id: f.trade_id || f.entry_id,\n          orderId: f.order_id,\n          symbol: f.product_id,\n          side: f.side?.toLowerCase(),\n          price: parseFloat(f.price || 0),\n          quantity: parseFloat(f.size || f.size_in_quote || 0),\n          commission: parseFloat(f.commission || 0),\n          commissionAsset: f.product_id?.split('-')?.[1] || 'USD',\n          time: f.trade_time,\n          isMaker: false,\n        }));\n      } catch (err) {\n        console.error('[COINBASE] getTradeHistory error:', err.message);\n        return [];\n      }\n    }\n\n    // ─── BYBIT v5 ───\n    if (conn.config.id === 'bybit') {\n      try {\n        const params = { category: 'spot', limit: limit.toString() };\n        if (symbol) params.symbol = symbol;\n        const data = await this._bybitRequest(conn.creds, 'GET', '/v5/execution/list', params);\n        return (data?.list || []).map(t => ({\n          id: t.execId,\n          orderId: t.orderId,\n          symbol: t.symbol,\n          side: t.side?.toLowerCase(),\n          price: parseFloat(t.execPrice || 0),\n          quantity: parseFloat(t.execQty || 0),\n          commission: parseFloat(t.execFee || 0),\n          commissionAsset: t.feeCurrency || '',\n          time: t.execTime ? new Date(parseInt(t.execTime)).toISOString() : null,\n          isMaker: t.isMaker === 'true' || t.isMaker === true,\n        }));\n      } catch (err) { console.error('Bybit getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── KRAKEN ───\n    if (conn.config.id === 'kraken') {\n      try {\n        const data = await this._krakenRequest(conn.creds, '/0/private/TradesHistory');\n        const trades = data?.trades || {};\n        return Object.entries(trades).slice(0, limit).map(([txid, t]) => ({\n          id: txid,\n          orderId: t.ordertxid,\n          symbol: t.pair,\n          side: t.type?.toLowerCase(),\n          price: parseFloat(t.price || 0),\n          quantity: parseFloat(t.vol || 0),\n          commission: parseFloat(t.fee || 0),\n          commissionAsset: '',\n          time: t.time ? new Date(t.time * 1000).toISOString() : null,\n          isMaker: t.maker === true,\n        }));\n      } catch (err) { console.error('Kraken getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── KUCOIN ───\n    if (conn.config.id === 'kucoin') {\n      try {\n        const params = {};\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._kucoinRequest(conn.creds, 'GET', '/api/v1/fills', params);\n        const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : []);\n        return items.slice(0, limit).map(t => ({\n          id: t.tradeId || t.id,\n          orderId: t.orderId,\n          symbol: t.symbol,\n          side: t.side?.toLowerCase(),\n          price: parseFloat(t.price || 0),\n          quantity: parseFloat(t.size || 0),\n          commission: parseFloat(t.fee || 0),\n          commissionAsset: t.feeCurrency || '',\n          time: t.createdAt ? new Date(parseInt(t.createdAt)).toISOString() : null,\n          isMaker: t.liquidity === 'maker',\n        }));\n      } catch (err) { console.error('KuCoin getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── OKX ───\n    if (conn.config.id === 'okx') {\n      try {\n        const params = { instType: 'SPOT' };\n        if (symbol) params.instId = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._okxRequest(conn.creds, 'GET', '/api/v5/trade/fills-history', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.slice(0, limit).map(t => ({\n          id: t.tradeId || t.billId,\n          orderId: t.ordId,\n          symbol: t.instId,\n          side: t.side?.toLowerCase(),\n          price: parseFloat(t.fillPx || 0),\n          quantity: parseFloat(t.fillSz || 0),\n          commission: Math.abs(parseFloat(t.fee || 0)),\n          commissionAsset: t.feeCcy || '',\n          time: t.ts ? new Date(parseInt(t.ts)).toISOString() : null,\n          isMaker: t.execType === 'M',\n        }));\n      } catch (err) { console.error('OKX getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── BINGX ───\n    if (conn.config.id === 'bingx') {\n      try {\n        const params = { limit: limit.toString() };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1-$2').toUpperCase();\n        const data = await this._bingxRequest(conn.creds, 'GET', '/openApi/spot/v1/trade/historyOrders', params);\n        const orders = data?.orders || (Array.isArray(data) ? data : []);\n        return orders.map(t => ({\n          id: t.orderId?.toString(),\n          orderId: t.orderId?.toString(),\n          symbol: t.symbol,\n          side: t.side?.toLowerCase(),\n          price: parseFloat(t.price || t.avgPrice || 0),\n          quantity: parseFloat(t.executedQty || t.origQty || 0),\n          commission: parseFloat(t.commission || 0),\n          commissionAsset: t.commissionAsset || '',\n          time: t.time ? new Date(parseInt(t.time)).toISOString() : null,\n          isMaker: false,\n        }));\n      } catch (err) { console.error('BingX getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── BITGET ───\n    if (conn.config.id === 'bitget') {\n      try {\n        const params = { limit: limit.toString() };\n        if (symbol) params.symbol = symbol.replace(/([A-Z]+)(USDT|USDC|USD)$/i, '$1$2').toUpperCase();\n        const data = await this._bitgetRequest(conn.creds, 'GET', '/api/v2/spot/trade/fills', params);\n        const items = Array.isArray(data) ? data : [];\n        return items.map(t => ({\n          id: t.tradeId || t.fillId,\n          orderId: t.orderId,\n          symbol: t.symbol,\n          side: t.side?.toLowerCase(),\n          price: parseFloat(t.priceAvg || t.price || 0),\n          quantity: parseFloat(t.size || 0),\n          commission: parseFloat(t.fees || t.fee || 0),\n          commissionAsset: t.feeCcy || '',\n          time: t.cTime ? new Date(parseInt(t.cTime)).toISOString() : null,\n          isMaker: t.tradeScope === 'maker',\n        }));\n      } catch (err) { console.error('Bitget getTradeHistory:', err.message); return []; }\n    }\n\n    // ─── MEXC ───\n    if (conn.config.id === 'mexc') {\n      try {\n        const params = { limit };\n        if (symbol) params.symbol = symbol;\n        const data = await this._mexcRequest(conn.creds, 'GET', '/api/v3/myTrades', params);\n        const trades = Array.isArray(data) ? data : [];\n        return trades.map(t => ({\n          id: t.id?.toString(),\n          orderId: t.orderId?.toString(),\n          symbol: t.symbol,\n          side: t.isBuyer ? 'buy' : 'sell',\n          price: parseFloat(t.price || 0),\n          quantity: parseFloat(t.qty || 0),\n          commission: parseFloat(t.commission || 0),\n          commissionAsset: t.commissionAsset || '',\n          time: t.time ? new Date(t.time).toISOString() : null,\n          isMaker: t.isMaker === true,\n        }));\n      } catch (err) { console.error('MEXC getTradeHistory:', err.message); return []; }\n    }\n\n    return [];\n  }\n\n  // ─── Get exchange info (filters, min qty, etc.) ───\n  async getExchangeInfo(symbol) {\n    try {\n      const info = await this._binancePublicRequest('/api/v3/exchangeInfo', { symbol });\n      const symbolInfo = info.symbols?.[0];\n      if (!symbolInfo) return null;\n\n      const lotSize = symbolInfo.filters?.find(f => f.filterType === 'LOT_SIZE');\n      const priceFilter = symbolInfo.filters?.find(f => f.filterType === 'PRICE_FILTER');\n      const minNotional = symbolInfo.filters?.find(f => f.filterType === 'NOTIONAL' || f.filterType === 'MIN_NOTIONAL');\n\n      return {\n        symbol: symbolInfo.symbol,\n        status: symbolInfo.status,\n        baseAsset: symbolInfo.baseAsset,\n        quoteAsset: symbolInfo.quoteAsset,\n        minQty: lotSize ? parseFloat(lotSize.minQty) : 0,\n        maxQty: lotSize ? parseFloat(lotSize.maxQty) : Infinity,\n        stepSize: lotSize ? parseFloat(lotSize.stepSize) : 0,\n        minPrice: priceFilter ? parseFloat(priceFilter.minPrice) : 0,\n        tickSize: priceFilter ? parseFloat(priceFilter.tickSize) : 0,\n        minNotional: minNotional ? parseFloat(minNotional.minNotional || minNotional.notional) : 0,\n      };\n    } catch {\n      return null;\n    }\n  }\n\n  // ─── Is connected? ───\n  isConnected(brokerId) {\n    return this.connections.has(brokerId);\n  }\n\n  // ─── Get connection info ───\n  getConnection(brokerId) {\n    return this.connections.get(brokerId);\n  }\n\n  // ─── Disconnect ───\n  disconnect(brokerId) {\n    this.connections.delete(brokerId);\n  }\n}\n\nexport const brokerService = new BrokerService();\nexport default brokerService;\n"],"names":["BrokerService","broker","creds","method","path","keyName","privateKeyPem","header","now","uri","payload","toB64url","str","objToB64url","obj","bufToB64url","buf","headerB64","payloadB64","signingInput","key","sig","pem","pemClean","der","c","d","pubPoint","bytesToB64url","bytes","jwk","i","sec1Der","octetLen","algoId","ver","octetHeader","totalInner","seqHeader","pkcs8","off","tag","len","body","jwt","proxyUrl","res","data","text","err","secret","message","encoder","signature","b","isB64Secret","keyData","bin","secretB64","msgData","hash","url","headers","endpoint","params","timestamp","recvWindow","queryString","bodyStr","v","k","preSign","BROKERS","nonce","postData","sha256Hash","pathBytes","sigInput","passphrase","allParams","a","signedQuery","options","config","account","accounts","wallet","coins","_c","_b","_a","balance","assets","count","bal","_d","acct","brokerId","conn","krakenMap","order","symbol","side","type","quantity","price","stopLoss","takeProfit","binanceType","result","_e","_f","productId","orderConfig","orderBody","errMsg","_g","_h","_i","errDetail","_j","_k","orderResult","orderId","filledPrice","filledQty","orderStatus","attempt","r","details","ord","detailErr","orderParams","detail","o","_l","krakenPair","_m","_n","_o","_p","_q","chainId","privateKey","orders","txid","limit","normalize","fields","t","f","trades","symbolInfo","lotSize","priceFilter","minNotional","brokerService"],"mappings":"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"}