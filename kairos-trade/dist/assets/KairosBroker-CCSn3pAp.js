import{j as e,W as he,a0 as pe,a1 as ue,Z as Oe,y as ge,h as Ie,au as be,x as fe,k as je,m as Z,af as $,t as Ee,S as Fe,R as Me,Q as Ke,A as Ne,T as we,o as Ge,a3 as He,aE as _e,H as ve,D as Be,B as We,X as Ve}from"./ui-CNhabBHP.js";import{a as t}from"./vendor-CUCP814w.js";import{V as Xe,a as qe,I as Je}from"./charts-UjLl1g-4.js";import{u as Qe,W as Ze}from"./index-P-WH05qf.js";const ye="https://kairos-api-u6k5.onrender.com",Ye=`${ye}/api/margin`,es=`${ye}/api/perps`,ss=3e3,ts=5e3,as=[2,3,5,10],ns=[2,3,5,10,20,50],B={"BTC/USDT":"â‚¿","ETH/USDT":"Îž","BNB/USDT":"â—†","SOL/USDT":"â—Ž","XRP/USDT":"âœ•","DOGE/USDT":"Ã","ADA/USDT":"â‚³","AVAX/USDT":"A","DOT/USDT":"â—","LINK/USDT":"â¬¡","UNI/USDT":"ðŸ¦„","LTC/USDT":"Å","ATOM/USDT":"âš›","NEAR/USDT":"N","APT/USDT":"A","ARB/USDT":"â—‡","SUI/USDT":"ðŸ’§","SEI/USDT":"S","AAVE/USDT":"ðŸ‘»","OP/USDT":"ðŸ”´","FIL/USDT":"F","ALGO/USDT":"A","ICP/USDT":"âˆž","XLM/USDT":"âœ¦","ETC/USDT":"Îžc","HBAR/USDT":"â„","TIA/USDT":"T","PEPE/USDT":"ðŸ¸","SHIB/USDT":"ðŸ•","BONK/USDT":"ðŸ¶","RENDER/USDT":"R","ENA/USDT":"E","KAIROS/USDT":"K"};function rs(a){return async function(h,n={}){var f;const r=`${a}${h}`,i=await fetch(r,{headers:{"Content-Type":"application/json",...n.headers},...n}),o=await i.json();if(!i.ok||o.error)throw new Error(o.error||((f=o.details)==null?void 0:f.join(", "))||`API error ${i.status}`);return o}}function us(){var xe,me;const{showToast:a,user:p,login:h}=Qe(),n=(p==null?void 0:p.walletAddress)||"",r=!!n,[i,o]=t.useState("dex"),f=i==="dex"?es:Ye,u=t.useMemo(()=>rs(f),[f]),U=i==="dex"?ns:as,[d,k]=t.useState(null),[D,x]=t.useState([]),[z,T]=t.useState([]),[g,b]=t.useState([]),[m,P]=t.useState({}),[c,Se]=t.useState({}),[j,ze]=t.useState("BTC/USDT"),[S,Y]=t.useState("LONG"),[N,Te]=t.useState(2),[ee,W]=t.useState(""),[O,se]=t.useState(""),[I,te]=t.useState(""),[V,Ce]=t.useState(!1),[E,ae]=t.useState(""),[F,ne]=t.useState(""),[X,De]=t.useState(!1),[M,Ae]=t.useState("prices"),[L,R]=t.useState(!1),[Pe,re]=t.useState(!1),[Le,ie]=t.useState(null),le=t.useRef(null),ce=t.useRef(null),C=parseFloat(ee)||0,v=((xe=m[j.replace("/","")])==null?void 0:xe.price)||0,q=C*N,J=t.useCallback(async()=>{try{const s=await u("/prices");P(s.data||{})}catch{}},[]),oe=t.useCallback(async()=>{var s,l;try{const y=await u("/pairs");b(((s=y.data)==null?void 0:s.pairs)||[]),(l=y.data)!=null&&l.leverageTiers&&Se(y.data.leverageTiers)}catch{}},[]),w=t.useCallback(async()=>{if(n)try{const s=await u(`/account?wallet=${n}`);k(s.data)}catch{}},[n]),A=t.useCallback(async()=>{if(n)try{const s=await u(`/positions?wallet=${n}`);x(s.data||[])}catch{}},[n]),K=t.useCallback(async()=>{if(n)try{const s=await u(`/history?wallet=${n}&limit=30`);T(s.data||[])}catch{}},[n]);t.useEffect(()=>(J(),oe(),le.current=setInterval(J,ss),()=>clearInterval(le.current)),[J,oe]),t.useEffect(()=>{if(n)return re(!0),Promise.all([w(),A(),K()]).finally(()=>re(!1)),ce.current=setInterval(()=>{w(),A()},ts),()=>clearInterval(ce.current)},[n,w,A,K]);const $e=t.useCallback(async()=>{const s=parseFloat(E);if(!s||s<=0){a("Ingresa una cantidad vÃ¡lida","error");return}R(!0);try{await u("/deposit",{method:"POST",body:JSON.stringify({wallet:n,amount:s})}),a(`${s} KAIROS depositados como colateral`,"success"),ae(""),w()}catch(l){a("Error: "+l.message,"error")}finally{R(!1)}},[E,n,a,w]),Re=t.useCallback(async()=>{const s=parseFloat(F);if(!s||s<=0){a("Ingresa una cantidad vÃ¡lida","error");return}R(!0);try{await u("/withdraw",{method:"POST",body:JSON.stringify({wallet:n,amount:s})}),a(`${s} KAIROS retirados del colateral`,"success"),ne(""),w()}catch(l){a("Error: "+l.message,"error")}finally{R(!1)}},[F,n,a,w]),Ue=t.useCallback(async()=>{if(!C||C<=0){a("Ingresa colateral","error");return}if(!v){a("Esperando precios...","error");return}R(!0);try{const s={wallet:n,pair:j,side:S,leverage:N,collateral:C,orderType:"MARKET",stopLoss:O?parseFloat(O):null,takeProfit:I?parseFloat(I):null},l=await u("/open",{method:"POST",body:JSON.stringify(s)});a(`${S} ${j} abierta â€” ${N}x â€” $${q.toLocaleString()} posiciÃ³n`,"success"),W(""),se(""),te(""),w(),A()}catch(s){a("Error abriendo posiciÃ³n: "+s.message,"error")}finally{R(!1)}},[n,j,S,N,C,v,O,I,q,a,w,A]),ke=t.useCallback(async s=>{var l,y;ie(s);try{const H=await u("/close",{method:"POST",body:JSON.stringify({wallet:n,positionId:s})}),Q=((l=H.data)==null?void 0:l.realizedPnl)||((y=H.data)==null?void 0:y.pnl)||0;a(`PosiciÃ³n cerrada â€” P&L: ${Q>=0?"+":""}$${parseFloat(Q).toFixed(2)}`,Q>=0?"success":"error"),w(),A(),K()}catch(H){a("Error cerrando posiciÃ³n: "+H.message,"error")}finally{ie(null)}},[n,a,w,A,K]),G=t.useMemo(()=>D.reduce((s,l)=>s+(parseFloat(l.unrealizedPnl)||0),0),[D]),de=t.useMemo(()=>{var l;if(!C||!v)return null;const s=(((l=c[N])==null?void 0:l.maintenanceMarginPct)||25)/100;return S==="LONG"?v*(1-1/N+s/N):v*(1+1/N-s/N)},[C,v,N,S,c]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-900/40 to-blue-800/20 border border-blue-500/30 rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:"/kairos-logo.png",alt:"Kairos",className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:["Kairos Broker",i==="dex"?e.jsxs("span",{className:"text-xs bg-green-600 text-white px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-300 rounded-full animate-pulse"})," GMX V2"]}):e.jsx("span",{className:"text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full",children:"INTERNO"})]}),e.jsx("p",{className:"text-sm text-blue-300",children:i==="dex"?"Perpetuales DEX â€” Ã“rdenes en GMX V2 (Arbitrum)":"Leverage Trading con Reserva Kairos 777"})]})]}),r&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-zinc-800 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>o("dex"),className:`px-3 py-1 rounded-md text-xs font-medium transition-all ${i==="dex"?"bg-green-600 text-white shadow-sm":"text-zinc-400 hover:text-white"}`,children:"ðŸŒ DEX"}),e.jsx("button",{onClick:()=>o("internal"),className:`px-3 py-1 rounded-md text-xs font-medium transition-all ${i==="internal"?"bg-blue-600 text-white shadow-sm":"text-zinc-400 hover:text-white"}`,children:"ðŸ›ï¸ Interno"})]}),e.jsxs("div",{className:"bg-green-900/30 border border-green-500/30 rounded-lg px-3 py-1.5 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-xs text-green-300 font-mono",children:[n.slice(0,6),"...",n.slice(-4)]})]})]})]})}),!r&&e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-12 text-center",children:[e.jsx(he,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-medium text-white mb-2",children:"Wallet no detectada"}),e.jsx("p",{className:"text-zinc-400 text-sm mb-6 max-w-md mx-auto",children:"Tu cuenta necesita una wallet Kairos. Haz clic abajo para generar una automÃ¡ticamente."}),e.jsx("button",{onClick:async()=>{try{const s=Ze.createRandom(),l=btoa(s.privateKey),y={...p,walletAddress:s.address,encryptedKey:l};h(y),localStorage.setItem("kairos_trade_wallet",JSON.stringify({walletAddress:s.address,encryptedKey:l})),sessionStorage.setItem("kairos_pk",s.privateKey),a("Wallet generada: "+s.address.slice(0,6)+"..."+s.address.slice(-4),"success")}catch(s){a("Error generando wallet: "+s.message,"error")}},className:"px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl transition-colors",children:"Generar Mi Kairos Wallet"})]}),r&&e.jsxs("div",{className:"flex flex-col gap-3",children:[i==="dex"&&e.jsxs("div",{className:"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/20 rounded-lg px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-green-400 text-sm",children:"ðŸ”—"}),e.jsx("span",{className:"text-green-300 text-xs font-medium",children:"DEX Mode â€” Ã“rdenes ejecutadas en GMX V2 (Arbitrum)"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-green-400/60",children:[e.jsx("span",{children:"Contrato: KairosPerps"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Colateral: KAIROS"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Liq: On-chain"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsx(cs,{pair:j,height:520})}),e.jsxs("div",{className:"lg:col-span-5 flex flex-col gap-3 overflow-y-auto",style:{maxHeight:"540px",scrollbarWidth:"thin",scrollbarColor:"#3f3f46 transparent"},children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:B[j]||"â€¢"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold",children:j}),e.jsx("span",{className:"text-xs text-zinc-500",children:"Mercado"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xl font-bold text-white font-mono",children:["$",v?v.toLocaleString(void 0,{maximumFractionDigits:2}):"â€”"]}),((me=m[j.replace("/","")])==null?void 0:me.change24h)!=null&&e.jsxs("span",{className:`text-xs font-mono ${m[j.replace("/","")].change24h>=0?"text-green-400":"text-red-400"}`,children:[m[j.replace("/","")].change24h>=0?"+":"",m[j.replace("/","")].change24h.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>Y("LONG"),className:`py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-all ${S==="LONG"?"bg-green-600 text-white shadow-lg shadow-green-600/20":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:[e.jsx(pe,{className:"w-4 h-4"})," LONG"]}),e.jsxs("button",{onClick:()=>Y("SHORT"),className:`py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-all ${S==="SHORT"?"bg-red-600 text-white shadow-lg shadow-red-600/20":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:[e.jsx(ue,{className:"w-4 h-4"})," SHORT"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-xs text-zinc-500 mb-1.5 block flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"})," Apalancamiento"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:U.map(s=>e.jsxs("button",{onClick:()=>Te(s),className:`py-2 rounded-lg text-sm font-bold transition-all ${N===s?"bg-blue-600 text-white shadow-lg shadow-blue-600/20":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"}`,children:[s,"x"]},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-xs text-zinc-500 mb-1.5 block flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"})," Colateral (KAIROS)"]}),d&&e.jsxs("button",{onClick:()=>W(String(Math.floor(d.freeMargin||0))),className:"text-blue-400 hover:text-blue-300 text-[10px]",children:["Max: ",(d.freeMargin||0).toFixed(0)]})]}),e.jsx("input",{type:"number",value:ee,onChange:s=>W(s.target.value),placeholder:"Ej: 100",min:"1",step:"1",className:"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2.5 text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none text-sm"}),C>0&&v>0&&e.jsxs("div",{className:"mt-2 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"TamaÃ±o posiciÃ³n"}),e.jsxs("span",{className:"text-white font-mono",children:["$",q.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"Precio entrada"}),e.jsxs("span",{className:"text-white font-mono",children:["$",v.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),de&&e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"Precio liquidaciÃ³n (est.)"}),e.jsxs("span",{className:"text-red-400 font-mono",children:["$",de.toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>Ce(!V),className:"flex items-center gap-1 text-xs text-zinc-500 hover:text-zinc-300 transition-colors",children:[e.jsx(Ie,{className:"w-3 h-3"})," Avanzado",V?e.jsx(be,{className:"w-3 h-3"}):e.jsx(fe,{className:"w-3 h-3"})]}),e.jsx(je,{children:V&&e.jsx(Z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-zinc-500 block mb-1",children:"Stop Loss ($)"}),e.jsx("input",{type:"number",value:O,onChange:s=>se(s.target.value),placeholder:"Precio SL",className:"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-2 text-xs text-white placeholder-zinc-600 focus:border-red-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-zinc-500 block mb-1",children:"Take Profit ($)"}),e.jsx("input",{type:"number",value:I,onChange:s=>te(s.target.value),placeholder:"Precio TP",className:"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-2 text-xs text-white placeholder-zinc-600 focus:border-green-500 focus:outline-none"})]})]})})})]}),e.jsxs("button",{onClick:Ue,disabled:L||!C||!v,className:`w-full py-3 rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all disabled:opacity-40 ${S==="LONG"?"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/20":"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/20"}`,children:[L?e.jsx($,{className:"w-4 h-4 animate-spin"}):S==="LONG"?e.jsx(pe,{className:"w-4 h-4"}):e.jsx(ue,{className:"w-4 h-4"}),L?"Abriendo...":`Abrir ${S} ${N}x`]}),e.jsxs("div",{className:"mt-3 bg-yellow-900/10 border border-yellow-500/20 rounded-lg px-3 py-2 text-[10px] text-yellow-500/80 flex items-start gap-1.5",children:[e.jsx(Ee,{className:"w-3 h-3 mt-0.5 shrink-0"}),e.jsx("span",{children:"Trading apalancado = riesgo de pÃ©rdida total. LiquidaciÃ³n automÃ¡tica."})]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-medium text-zinc-300 flex items-center gap-1.5",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-blue-400"})," Cuenta Margin"]}),e.jsx("button",{onClick:()=>{w(),A()},className:"text-zinc-500 hover:text-blue-400 transition-colors",children:e.jsx(Me,{className:"w-3 h-3"})})]}),Pe&&!d?e.jsx("div",{className:"flex items-center justify-center py-3 text-zinc-500",children:e.jsx($,{className:"w-4 h-4 animate-spin"})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{label:"Colateral",value:`${((d==null?void 0:d.totalCollateral)||0).toFixed(2)} KAIROS`,icon:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(_,{label:"Equity",value:`$${((d==null?void 0:d.equity)||0).toFixed(2)}`,icon:e.jsx(Ke,{className:"w-3 h-3"})}),e.jsx(_,{label:"Margen libre",value:`$${((d==null?void 0:d.freeMargin)||0).toFixed(2)}`,icon:e.jsx(Ne,{className:"w-3 h-3"}),color:((d==null?void 0:d.freeMargin)||0)>0?"text-green-400":"text-zinc-400"}),e.jsx(_,{label:"P&L no realizado",value:`${G>=0?"+":""}$${G.toFixed(2)}`,icon:G>=0?e.jsx(we,{className:"w-3 h-3"}):e.jsx(Ge,{className:"w-3 h-3"}),color:G>=0?"text-green-400":"text-red-400"})]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-3",children:[e.jsxs("button",{onClick:()=>De(!X),className:"w-full flex items-center justify-between text-xs font-medium text-zinc-300",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(he,{className:"w-3.5 h-3.5 text-blue-400"})," Depositar / Retirar"]}),X?e.jsx(be,{className:"w-3.5 h-3.5"}):e.jsx(fe,{className:"w-3.5 h-3.5"})]}),e.jsx(je,{children:X&&e.jsx(Z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-2 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:E,onChange:s=>ae(s.target.value),placeholder:"Depositar KAIROS",min:"1",step:"1",className:"flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-1.5 text-xs text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none"}),e.jsxs("button",{onClick:$e,disabled:L||!E,className:"bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white px-2.5 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1 transition-colors",children:[L?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(He,{className:"w-3 h-3"})," Dep"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:F,onChange:s=>ne(s.target.value),placeholder:"Retirar KAIROS",min:"1",step:"1",className:"flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-1.5 text-xs text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none"}),e.jsxs("button",{onClick:Re,disabled:L||!F,className:"bg-red-600/80 hover:bg-red-700 disabled:opacity-50 text-white px-2.5 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1 transition-colors",children:[L?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(_e,{className:"w-3 h-3"})," Ret"]})]})]})})})]})]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"flex border-b border-zinc-800",children:[{id:"prices",label:"Precios en Vivo",icon:Ne},{id:"trade",label:"Posiciones",icon:we,count:D.length},{id:"history",label:"Historial",icon:ve}].map(s=>e.jsxs("button",{onClick:()=>Ae(s.id),className:`flex-1 py-2.5 text-xs font-medium flex items-center justify-center gap-1.5 transition-colors border-b-2 ${M===s.id?"border-blue-500 text-blue-400":"border-transparent text-zinc-500 hover:text-zinc-300"}`,children:[e.jsx(s.icon,{className:"w-3.5 h-3.5"}),s.label,s.count>0&&e.jsx("span",{className:"bg-blue-500/20 text-blue-400 text-[10px] px-1.5 py-0.5 rounded-full",children:s.count})]},s.id))}),e.jsxs("div",{className:"overflow-y-auto p-3",style:{maxHeight:"280px",scrollbarWidth:"thin",scrollbarColor:"#3f3f46 transparent"},children:[M==="prices"&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2",children:[Object.entries(m).map(([s,l])=>{var y;return e.jsxs("button",{onClick:()=>ze(s.replace("USDT","/USDT")),className:`flex flex-col items-center gap-1 px-2 py-2.5 rounded-lg text-xs transition-colors ${j===s.replace("USDT","/USDT")?"bg-blue-900/30 border border-blue-500/30":"bg-zinc-800/50 hover:bg-zinc-800 border border-transparent"}`,children:[e.jsx("span",{className:"text-lg",children:B[s.replace("USDT","/USDT")]||"â€¢"}),e.jsx("span",{className:"text-zinc-300 font-medium truncate w-full text-center",children:s.replace("USDT","/USDT")}),e.jsxs("span",{className:"text-white font-mono text-[11px]",children:["$",(y=l.price)==null?void 0:y.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsxs("span",{className:`text-[10px] font-mono ${(l.change24h||0)>=0?"text-green-400":"text-red-400"}`,children:[(l.change24h||0)>=0?"+":"",(l.change24h||0).toFixed(2),"%"]})]},s)}),Object.keys(m).length===0&&e.jsxs("div",{className:"col-span-full text-center py-6 text-zinc-500 text-xs flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-3.5 h-3.5 animate-spin"})," Cargando precios..."]})]}),M==="trade"&&e.jsx("div",{children:D.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"w-8 h-8 text-zinc-600 mx-auto mb-2"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Sin posiciones abiertas"}),e.jsx("p",{className:"text-zinc-600 text-xs mt-1",children:"Deposita colateral y abre tu primera operaciÃ³n"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2",children:D.map(s=>e.jsx(os,{position:s,onClose:ke,isClosing:Le===s.id,prices:m},s.id))})}),M==="history"&&e.jsx("div",{children:z.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-8 h-8 text-zinc-600 mx-auto mb-2"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Sin historial"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2",children:z.map(s=>e.jsx(ds,{trade:s},s.id))})})]})]})]})]})}const is=["1m","5m","15m","1h","4h","1d"],ls=["https://api.binance.us/api/v3/klines","https://api.binance.com/api/v3/klines"];function cs({pair:a,height:p=280}){const h=t.useRef(null),n=t.useRef(null),r=t.useRef(null),i=t.useRef(null),o=t.useRef(null),[f,u]=t.useState("15m"),[U,d]=t.useState(!0),k=a.replace("/",""),D=t.useCallback(async(x,z)=>{for(const T of ls)try{const g=new AbortController,b=setTimeout(()=>g.abort(),8e3),m=await fetch(`${T}?symbol=${x}&interval=${z}&limit=300`,{signal:g.signal});if(clearTimeout(b),!m.ok)continue;const P=await m.json();if(!Array.isArray(P))continue;return P.map(c=>({time:Math.floor(c[0]/1e3),open:+c[1],high:+c[2],low:+c[3],close:+c[4],volume:+c[5]}))}catch{continue}return[]},[]);return t.useEffect(()=>{if(!h.current)return;const x=Xe(h.current,{width:h.current.clientWidth,height:p,layout:{background:{type:Je.Solid,color:"#09090b"},textColor:"#71717a",fontFamily:"Inter, monospace",fontSize:10},grid:{vertLines:{color:"#18181b"},horzLines:{color:"#18181b"}},crosshair:{mode:qe.Normal,vertLine:{color:"#3b82f6",width:1,style:2},horzLine:{color:"#3b82f6",width:1,style:2}},timeScale:{borderColor:"#27272a",timeVisible:!0,secondsVisible:!1,rightOffset:3,barSpacing:6},rightPriceScale:{borderColor:"#27272a",scaleMargins:{top:.1,bottom:.25}}}),z=x.addCandlestickSeries({upColor:"#22c55e",downColor:"#ef4444",borderUpColor:"#22c55e",borderDownColor:"#ef4444",wickUpColor:"#22c55e80",wickDownColor:"#ef444480"}),T=x.addHistogramSeries({color:"#3b82f650",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});n.current=x,r.current=z,i.current=T;const g=new ResizeObserver(([b])=>{x.applyOptions({width:b.contentRect.width})});return g.observe(h.current),()=>{g.disconnect(),x.remove(),n.current=null}},[]),t.useEffect(()=>{let x=!1;d(!0),(async()=>{var b;const g=await D(k,f);x||!r.current||(r.current.setData(g),i.current.setData(g.map(m=>({time:m.time,value:m.volume,color:m.close>=m.open?"#22c55e30":"#ef444430"}))),(b=n.current)==null||b.timeScale().fitContent(),d(!1))})(),o.current&&(o.current.close(),o.current=null);const z=["wss://stream.binance.us:9443/ws","wss://stream.binance.com:9443/ws"];function T(g){if(!(g>=z.length||x))try{const b=new WebSocket(`${z[g]}/${k.toLowerCase()}@kline_${f}`);b.onopen=()=>{o.current=b},b.onmessage=m=>{var P;try{const{k:c}=JSON.parse(m.data);if(!c||!r.current)return;r.current.update({time:Math.floor(c.t/1e3),open:+c.o,high:+c.h,low:+c.l,close:+c.c}),(P=i.current)==null||P.update({time:Math.floor(c.t/1e3),value:+c.v,color:+c.c>=+c.o?"#22c55e30":"#ef444430"})}catch{}},b.onerror=()=>{b.close(),T(g+1)}}catch{T(g+1)}}return T(0),()=>{x=!0,o.current&&(o.current.close(),o.current=null)}},[k,f,D]),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-zinc-800",children:[e.jsxs("span",{className:"text-xs font-bold text-white flex items-center gap-1.5",children:[e.jsx(We,{className:"w-3.5 h-3.5 text-blue-400"})," ",a]}),e.jsx("div",{className:"flex gap-1",children:is.map(x=>e.jsx("button",{onClick:()=>u(x),className:`px-2 py-0.5 rounded text-[10px] font-bold transition-colors ${f===x?"bg-blue-600 text-white":"text-zinc-500 hover:text-zinc-300"}`,children:x},x))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:h,style:{width:"100%",height:p}}),U&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-zinc-900/80",children:e.jsx($,{className:"w-5 h-5 text-blue-400 animate-spin"})})]})]})}function _({label:a,value:p,icon:h,color:n="text-white"}){return e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("span",{className:"text-xs text-zinc-500 flex items-center gap-1.5",children:[h," ",a]}),e.jsx("span",{className:`text-xs font-mono font-medium ${n}`,children:p})]})}function os({position:a,onClose:p,isClosing:h,prices:n}){const r=a,i=parseFloat(r.unrealizedPnl)||0,o=parseFloat(r.pnlPercent)||(r.collateral?i/parseFloat(r.collateral)*100:0),f=(r.side||r.direction||"").toUpperCase()==="LONG",u=r.pair||r.symbol||"",U=n[u.replace("/","")]||{};return e.jsxs(Z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-zinc-900 border border-zinc-800 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:B[u]||"â€¢"}),e.jsx("span",{className:"text-sm font-bold text-white",children:u}),e.jsxs("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${f?"bg-green-900/50 text-green-400":"bg-red-900/50 text-red-400"}`,children:[f?"LONG":"SHORT"," ",r.leverage,"x"]})]}),e.jsxs("button",{onClick:()=>p(r.id),disabled:h,className:"text-xs bg-zinc-800 hover:bg-red-600/80 text-zinc-400 hover:text-white px-2.5 py-1 rounded-lg transition-all disabled:opacity-50 flex items-center gap-1",children:[h?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(Ve,{className:"w-3 h-3"}),"Cerrar"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"Entrada"}),e.jsxs("span",{className:"text-white font-mono",children:["$",parseFloat(r.entryPrice||0).toLocaleString(void 0,{maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"Actual"}),e.jsxs("span",{className:"text-white font-mono",children:["$",(U.price||parseFloat(r.currentPrice||0)).toLocaleString(void 0,{maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"Colateral"}),e.jsxs("span",{className:"text-white font-mono",children:[parseFloat(r.collateral||0).toFixed(2)," K"]})]}),e.jsxs("div",{className:"flex justify-between text-zinc-400",children:[e.jsx("span",{children:"TamaÃ±o"}),e.jsxs("span",{className:"text-white font-mono",children:["$",parseFloat(r.positionSizeUsd||0).toLocaleString()]})]})]}),e.jsxs("div",{className:`mt-2 px-2.5 py-1.5 rounded-lg flex items-center justify-between ${i>=0?"bg-green-900/20 border border-green-500/20":"bg-red-900/20 border border-red-500/20"}`,children:[e.jsx("span",{className:"text-[10px] text-zinc-400",children:"P&L"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-xs font-bold font-mono ${i>=0?"text-green-400":"text-red-400"}`,children:[i>=0?"+":"","$",i.toFixed(2)]}),e.jsxs("span",{className:`text-[10px] font-mono ${o>=0?"text-green-400/70":"text-red-400/70"}`,children:["(",o>=0?"+":"",o.toFixed(2),"%)"]})]})]}),(r.stopLoss||r.takeProfit)&&e.jsxs("div",{className:"flex gap-2 mt-1.5 text-[10px]",children:[r.stopLoss&&e.jsxs("span",{className:"text-red-400/60",children:["SL: $",parseFloat(r.stopLoss).toLocaleString(void 0,{maximumFractionDigits:2})]}),r.takeProfit&&e.jsxs("span",{className:"text-green-400/60",children:["TP: $",parseFloat(r.takeProfit).toLocaleString(void 0,{maximumFractionDigits:2})]})]})]})}function ds({trade:a}){const p=parseFloat(a.realizedPnl||a.pnl||0),h=(a.side||a.direction||"").toUpperCase()==="LONG",n=a.pair||a.symbol||"",i=(a.status||a.closeReason||"").toUpperCase().includes("LIQUIDAT");return e.jsxs("div",{className:`bg-zinc-900 border rounded-xl p-3 ${i?"border-red-500/30":"border-zinc-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:B[n]||"â€¢"}),e.jsx("span",{className:"text-sm font-medium text-white",children:n}),e.jsxs("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${h?"bg-green-900/30 text-green-400/70":"bg-red-900/30 text-red-400/70"}`,children:[h?"LONG":"SHORT"," ",a.leverage,"x"]}),i&&e.jsx("span",{className:"text-[10px] bg-red-900/50 text-red-400 px-1.5 py-0.5 rounded font-bold",children:"LIQUIDADO"})]}),e.jsxs("span",{className:`text-xs font-bold font-mono ${p>=0?"text-green-400":"text-red-400"}`,children:[p>=0?"+":"","$",p.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-4 text-[10px] text-zinc-500",children:[e.jsxs("span",{children:["Entrada: $",parseFloat(a.entryPrice||0).toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsxs("span",{children:["Salida: $",parseFloat(a.exitPrice||a.closePrice||0).toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsxs("span",{children:["Colateral: ",parseFloat(a.collateral||0).toFixed(2)]})]}),a.closedAt&&e.jsx("div",{className:"text-[10px] text-zinc-600 mt-1",children:new Date(a.closedAt||a.closed_at).toLocaleString()})]})}export{us as default};
