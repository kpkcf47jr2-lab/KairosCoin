import{j as e,m as _,U as Tt,C as pt,L as $t,B as oe,P as le,a as ue,Z as ee,S as he,b as ut,H as It,c as ye,W as $e,d as Et,e as Ft,A as Q,f as Le,g as je,T as ie,h as Ne,i as Bt,k as Rt,l as fe,n as ce,E as ht,o as gt,p as bt,q as qe,D as we,r as Dt,s as vt,t as Mt,u as Se,v as ae,X as ft,w as yt,x as _t,y as Ie,M as Ot,R as jt,z as pe,F as zt,G as Lt,I as Nt,J as qt,K as Ke,N as Kt,O as Ut,Q as Vt,V as ge,Y as wt,_ as Xe,$ as Ue,a0 as Je,a1 as Wt,a2 as Me,a3 as Ht,a4 as Gt,a5 as Ze,a6 as et,a7 as Qt,a8 as Yt,a9 as Xt,aa as Jt,ab as Zt,ac as es,ad as ts,ae as ss}from"./ui-AjUANl4N.js";import{b as as,g as rs,c as is,a as S,R as ns,B as os}from"./vendor-CUCP814w.js";import{V as ls,a as cs,I as ds}from"./charts-UjLl1g-4.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var Ce={},tt;function xs(){if(tt)return Ce;tt=1;var d=as();return Ce.createRoot=d.createRoot,Ce.hydrateRoot=d.hydrateRoot,Ce}var ms=xs();const ps=rs(ms),Ae={binance:{id:"binance",name:"Binance",logo:"üü°",baseUrl:"https://api.binance.com",wsUrl:"wss://stream.binance.com:9443/ws",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},bybit:{id:"bybit",name:"Bybit",logo:"üü†",baseUrl:"https://api.bybit.com",wsUrl:"wss://stream.bybit.com/v5/public/spot",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret"]},kraken:{id:"kraken",name:"Kraken",logo:"üü£",baseUrl:"https://api.kraken.com",wsUrl:"wss://ws.kraken.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},coinbase:{id:"coinbase",name:"Coinbase",logo:"üîµ",baseUrl:"https://api.coinbase.com",wsUrl:"wss://ws-feed.exchange.coinbase.com",supportedMarkets:["spot"],requiredFields:["apiKey","apiSecret","passphrase"]},kucoin:{id:"kucoin",name:"KuCoin",logo:"üü¢",baseUrl:"https://api.kucoin.com",wsUrl:"wss://ws-api.kucoin.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret","passphrase"]},okx:{id:"okx",name:"OKX",logo:"‚ö´",baseUrl:"https://www.okx.com",wsUrl:"wss://ws.okx.com:8443/ws/v5/public",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret","passphrase"]}},St=["BTCKAIROS","ETHKAIROS","BNBKAIROS","SOLKAIROS","XRPKAIROS","ADAKAIROS","DOGEKAIROS","AVAXKAIROS","DOTKAIROS","MATICKAIROS","LINKKAIROS","ATOMKAIROS","LTCKAIROS","UNIKAIROS","AAVEKAIROS"],Ve=[{label:"1m",value:"1m",seconds:60},{label:"5m",value:"5m",seconds:300},{label:"15m",value:"15m",seconds:900},{label:"1H",value:"1h",seconds:3600},{label:"4H",value:"4h",seconds:14400},{label:"1D",value:"1d",seconds:86400},{label:"1W",value:"1w",seconds:604800}],K={AUTH:"kairos_trade_auth",BROKERS:"kairos_trade_brokers",BOTS:"kairos_trade_bots",SETTINGS:"kairos_trade_settings",STRATEGIES:"kairos_trade_strategies",POSITIONS:"kairos_trade_positions",ORDERS:"kairos_trade_orders",TRADE_HISTORY:"kairos_trade_history"},re=(d,t)=>{try{return JSON.parse(localStorage.getItem(d))||t}catch{return t}},X=(d,t)=>localStorage.setItem(d,JSON.stringify(t)),H=is((d,t)=>({user:re(K.AUTH,null),isAuthenticated:!!re(K.AUTH,null),login:s=>{X(K.AUTH,s),d({user:s,isAuthenticated:!0})},logout:()=>{localStorage.removeItem(K.AUTH),d({user:null,isAuthenticated:!1})},currentPage:"dashboard",setPage:s=>d({currentPage:s}),brokers:re(K.BROKERS,[]),activeBroker:null,addBroker:s=>{const a={...s,id:Date.now().toString(36),apiKey:btoa(s.apiKey),apiSecret:btoa(s.apiSecret),passphrase:s.passphrase?btoa(s.passphrase):void 0,connected:!1,addedAt:new Date().toISOString()},r=[...t().brokers,a];return X(K.BROKERS,r),d({brokers:r}),a},removeBroker:s=>{var r;const a=t().brokers.filter(l=>l.id!==s);X(K.BROKERS,a),d({brokers:a,activeBroker:((r=t().activeBroker)==null?void 0:r.id)===s?null:t().activeBroker})},setActiveBroker:s=>d({activeBroker:s}),updateBrokerStatus:(s,a)=>{const r=t().brokers.map(l=>l.id===s?{...l,connected:a}:l);X(K.BROKERS,r),d({brokers:r})},bots:re(K.BOTS,[]),addBot:s=>{const a={...s,id:Date.now().toString(36),status:"stopped",trades:0,pnl:0,winRate:0,createdAt:new Date().toISOString()},r=[...t().bots,a];return X(K.BOTS,r),d({bots:r}),a},updateBot:(s,a)=>{const r=t().bots.map(l=>l.id===s?{...l,...a}:l);X(K.BOTS,r),d({bots:r})},removeBot:s=>{const a=t().bots.filter(r=>r.id!==s);X(K.BOTS,a),d({bots:a})},selectedPair:"BTCKAIROS",selectedTimeframe:"1h",currentPrice:null,priceChange24h:null,orderBook:{bids:[],asks:[]},positions:re(K.POSITIONS,[]),orders:re(K.ORDERS,[]),tradeHistory:re(K.TRADE_HISTORY,[]),setSelectedPair:s=>d({selectedPair:s}),setSelectedTimeframe:s=>d({selectedTimeframe:s}),setCurrentPrice:s=>d({currentPrice:s}),setPriceChange24h:s=>d({priceChange24h:s}),setOrderBook:s=>d({orderBook:s}),addPosition:s=>{const a=[...t().positions,{...s,id:Date.now().toString(36)}];X(K.POSITIONS,a),d({positions:a})},closePosition:s=>{const a=t().positions.find(r=>r.id===s);if(a){const r=t().currentPrice||a.entryPrice,l=a.side==="buy"?(r-a.entryPrice)*a.quantity:(a.entryPrice-r)*a.quantity,i={...a,closedAt:new Date().toISOString(),exitPrice:r,pnl:l},o=t().positions.filter(x=>x.id!==s),m=[...t().tradeHistory,i];X(K.POSITIONS,o),X(K.TRADE_HISTORY,m),d({positions:o,tradeHistory:m})}},addOrder:s=>{const a=[...t().orders,{...s,id:Date.now().toString(36)}];X(K.ORDERS,a),d({orders:a})},cancelOrder:s=>{const a=t().orders.filter(r=>r.id!==s);X(K.ORDERS,a),d({orders:a})},strategies:re(K.STRATEGIES,[]),addStrategy:s=>{const a={...s,id:Date.now().toString(36),createdAt:new Date().toISOString()},r=[...t().strategies,a];return X(K.STRATEGIES,r),d({strategies:r}),a},removeStrategy:s=>{const a=t().strategies.filter(r=>r.id!==s);X(K.STRATEGIES,a),d({strategies:a})},aiMessages:[],aiLoading:!1,addAiMessage:s=>d({aiMessages:[...t().aiMessages,s]}),setAiLoading:s=>d({aiLoading:s}),clearAiMessages:()=>d({aiMessages:[]}),settings:re(K.SETTINGS,{theme:"dark",language:"es",notifications:!0,soundAlerts:!0,maxRiskPerTrade:2,defaultLeverage:1}),updateSettings:s=>{const a={...t().settings,...s};X(K.SETTINGS,a),d({settings:a})},sidebarOpen:!0,aiPanelOpen:!1,modalOpen:null,toggleSidebar:()=>d({sidebarOpen:!t().sidebarOpen}),toggleAiPanel:()=>d({aiPanelOpen:!t().aiPanelOpen}),setModal:s=>d({modalOpen:s})})),us=[{label:"Principal",items:[{id:"dashboard",icon:$t,label:"Dashboard",desc:"Panel de control"},{id:"chart",icon:oe,label:"Trading",desc:"Gr√°ficos en vivo"},{id:"simulator",icon:le,label:"Simulador",desc:"Paper trading"}]},{label:"Automatizaci√≥n",items:[{id:"bots",icon:ue,label:"Bots",desc:"Trading autom√°tico"},{id:"strategies",icon:ee,label:"Estrategias",desc:"Crear y gestionar"},{id:"ai",icon:he,label:"Kairos AI",desc:"Asistente IA",accent:!0}]},{label:"Gesti√≥n",items:[{id:"brokers",icon:ut,label:"Brokers",desc:"Conexiones API"},{id:"history",icon:It,label:"Historial",desc:"Trades y reportes"},{id:"alerts",icon:ye,label:"Alertas",desc:"Notificaciones"}]}],hs=[{id:"wallet",icon:$e,label:"Wallet"},{id:"settings",icon:Et,label:"Ajustes"}];function gs(){const{currentPage:d,setPage:t,sidebarOpen:s,toggleSidebar:a,bots:r,brokers:l,logout:i,user:o}=H(),[m,x]=S.useState(null),g=r.filter(f=>f.status==="active").length,u=l.filter(f=>f.connected).length,n=f=>f==="bots"?g:f==="brokers"?u:0,b=({item:f,compact:y=!1})=>{const h=f.icon,j=d===f.id,C=n(f.id),k=m===f.id;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>t(f.id),onMouseEnter:()=>x(f.id),onMouseLeave:()=>x(null),title:s?void 0:f.label,className:`w-full flex items-center rounded-xl transition-all duration-200 relative group
            ${s?"px-3 py-3 gap-3":"px-0 py-3 justify-center"}
            ${j?"text-white":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:[j&&e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{background:f.accent?"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(96,165,250,0.06))":"linear-gradient(135deg, rgba(59,130,246,0.08), rgba(59,130,246,0.02))",border:"1px solid rgba(59,130,246,0.1)"}}),j&&e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-6 rounded-r-full",style:{background:"linear-gradient(180deg, #60A5FA, #3B82F6)"}}),e.jsxs("div",{className:`relative z-10 flex items-center justify-center shrink-0 rounded-lg transition-all duration-200
            ${s?"w-8 h-8":"w-9 h-9"}
            ${j?f.accent?"bg-[var(--gold)]/20":"bg-white/[0.06]":"bg-transparent group-hover:bg-white/[0.04]"}`,children:[e.jsx(h,{size:s?18:20,strokeWidth:j?2:1.5,className:`transition-colors ${j&&f.accent?"text-[var(--gold-light)]":""}`}),C>0&&!s&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-[14px] h-[14px] bg-[var(--gold)] rounded-full text-[8px] font-bold text-white flex items-center justify-center",children:C})]}),s&&e.jsxs("div",{className:"relative z-10 flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[13px] truncate leading-tight ${j?"font-semibold":"font-medium"}`,children:f.label}),f.accent&&e.jsx("span",{className:"text-[8px] font-bold bg-[var(--gold)]/20 text-[var(--gold-light)] px-1.5 py-0.5 rounded-full uppercase tracking-wider",children:"Pro"}),C>0&&e.jsx("span",{className:"ml-auto text-[10px] font-semibold bg-[var(--gold)]/12 text-[var(--gold)] rounded-full px-2 py-0.5 min-w-[22px] text-center",children:C})]}),!y&&f.desc&&e.jsx("span",{className:`text-[10px] leading-tight truncate block mt-0.5 transition-colors
                  ${j?"text-[var(--text-dim)]":"text-[var(--text-dim)]/50"}`,children:f.desc})]})]}),e.jsx(Q,{children:!s&&k&&e.jsx(_.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] whitespace-nowrap",children:f.label}),f.desc&&e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] whitespace-nowrap",children:f.desc})]})})})]})},c=({label:f})=>s?e.jsxs("div",{className:"flex items-center gap-2 px-3 mb-2 mt-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--text-dim)]/40 uppercase tracking-[0.12em]",children:f}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]/50"})]}):e.jsx("div",{className:"mx-auto w-6 h-px bg-[var(--border)]/60 my-3"});return e.jsxs(_.aside,{animate:{width:s?260:72},transition:{duration:.25,ease:[.4,0,.2,1]},className:"h-full flex flex-col relative shrink-0",style:{borderRight:"1px solid var(--border)",background:"linear-gradient(180deg, #0E1015 0%, #08090C 100%)"},children:[e.jsxs("div",{className:`flex items-center shrink-0 ${s?"px-5 gap-3 h-[60px]":"justify-center h-[60px]"}`,style:{borderBottom:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center shrink-0 relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx("span",{className:"text-white font-extrabold text-sm",children:"K"}),e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{boxShadow:"0 0 20px rgba(59,130,246,0.2)"}})]}),s&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1,duration:.2},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-[15px] font-bold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-widest",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium tracking-wider",children:"BY KAIROS 777"})]})})]}),s&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-3 mt-4 mb-2 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.04), rgba(26,29,38,0.5))",border:"1px solid rgba(59,130,246,0.06)"},children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--dark-4)] flex items-center justify-center",children:e.jsx(Tt,{size:14,className:"text-[var(--text-dim)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] truncate",children:(o==null?void 0:o.name)||"Trader"}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(pt,{size:9,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] uppercase tracking-wider",children:"Free Plan"})]})]})]})}),e.jsx("nav",{className:`flex-1 overflow-y-auto py-2 ${s?"px-3":"px-2"}`,style:{scrollbarWidth:"none"},children:us.map((f,y)=>e.jsxs("div",{className:y>0?"mt-5":"mt-1",children:[e.jsx(c,{label:f.label}),e.jsx("div",{className:"space-y-0.5",children:f.items.map(h=>e.jsx(b,{item:h},h.id))})]},f.label))}),e.jsxs("div",{className:`py-3 ${s?"px-3":"px-2"}`,style:{borderTop:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"space-y-0.5",children:hs.map(f=>e.jsx(b,{item:f,compact:!0},f.id))}),e.jsxs("button",{onClick:i,onMouseEnter:()=>x("logout"),onMouseLeave:()=>x(null),title:s?void 0:"Salir",className:`w-full flex items-center rounded-xl text-[var(--text-dim)] hover:text-[var(--red)] transition-all duration-200 mt-1 relative
            ${s?"px-3 py-2.5 gap-3":"px-0 py-2.5 justify-center"}
            hover:bg-[var(--red)]/[0.06]`,children:[e.jsx("div",{className:`flex items-center justify-center shrink-0 rounded-lg ${s?"w-8 h-8":"w-9 h-9"}`,children:e.jsx(Ft,{size:s?16:18,strokeWidth:1.5})}),s&&e.jsx("span",{className:"text-[13px] font-medium",children:"Cerrar Sesi√≥n"}),e.jsx(Q,{children:!s&&m==="logout"&&e.jsx(_.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsx("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:e.jsx("p",{className:"text-xs font-semibold text-[var(--red)] whitespace-nowrap",children:"Cerrar Sesi√≥n"})})})})]})]}),e.jsx("button",{onClick:a,className:"absolute -right-3 top-7 w-6 h-6 bg-[var(--dark-3)] border border-[var(--border)] rounded-full flex items-center justify-center text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 hover:bg-[var(--dark-4)] transition-all z-10 shadow-lg",children:s?e.jsx(Le,{size:11}):e.jsx(je,{size:11})})]})}const Ee="KAIROS",We="USDT";function Te(d){return d?d.endsWith(Ee)?d.replace(Ee,We):d:"BTCUSDT"}function kt(d){return d?d.endsWith(Ee)?d.replace(Ee,""):d.endsWith(We)?d.replace(We,""):d.slice(0,3):"BTC"}function bs(){const{selectedPair:d,currentPrice:t,priceChange24h:s,toggleAiPanel:a,aiPanelOpen:r,brokers:l}=H(),i=l.some(x=>x.connected),[o,m]=S.useState(!1);return e.jsxs("header",{className:"h-[56px] shrink-0 flex items-center justify-between px-5",style:{borderBottom:"1px solid rgba(26,29,38,0.6)",background:"linear-gradient(180deg, rgba(14,16,21,0.95) 0%, rgba(8,9,12,0.95) 100%)",backdropFilter:"blur(16px)"},children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.04))",border:"1px solid rgba(59,130,246,0.1)"},children:e.jsx("span",{className:"text-[var(--gold)]",children:kt(d).slice(0,3)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[14px] font-bold text-[var(--text)] tracking-wide leading-none",children:d}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium",children:"Perpetual"})]})]}),e.jsx("div",{className:"w-px h-7 bg-[var(--border)]/50"}),t&&e.jsx("div",{children:e.jsxs("span",{className:"text-[16px] font-mono font-bold text-[var(--text)] leading-none",children:["$",t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),s!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-mono font-semibold px-2.5 py-1 rounded-lg
              ${s>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,style:{border:`1px solid ${s>=0?"rgba(14,203,129,0.12)":"rgba(246,70,93,0.12)"}`},children:[s>=0?e.jsx(ie,{size:12}):e.jsx(Ne,{size:12}),s>=0?"+":"",s==null?void 0:s.toFixed(2),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]/40 font-medium",children:"24h"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1.5 text-[11px] px-3 py-1.5 rounded-lg transition-all
          ${i?"text-[var(--green)] bg-[var(--green)]/[0.06] border border-[var(--green)]/10":"text-[var(--text-dim)] bg-white/[0.02] border border-[var(--border)]/50"}`,children:[i?e.jsx(Bt,{size:12}):e.jsx(Rt,{size:12}),e.jsx("span",{className:"font-semibold",children:i?"Live":"Demo"})]}),e.jsxs("button",{onClick:a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all border
            ${r?"bg-[var(--gold)]/10 text-[var(--gold)] border-[var(--gold)]/15":"text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border-[var(--border)]/50 hover:border-[var(--gold)]/20"}`,title:"Kairos AI",children:[e.jsx(fe,{size:13}),e.jsx("span",{children:"AI"}),r&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gold)] animate-pulse"})]}),e.jsxs("button",{className:"p-2 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border border-[var(--border)]/50 hover:border-[var(--border)] transition-all relative",children:[e.jsx(ye,{size:15}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-[var(--gold)] rounded-full shadow-[0_0_6px_rgba(59,130,246,0.4)]"})]})]})]})}const st=[{icon:ie,label:"Trading Profesional",desc:"Gr√°ficos TradingView con datos en tiempo real de Binance"},{icon:ue,label:"Bots Automatizados",desc:"Grid, DCA y bots de se√±ales ejecutan trades 24/7"},{icon:he,label:"Kairos AI",desc:"Asistente con IA que analiza mercados y genera estrategias"},{icon:ce,label:"Simulador Pro",desc:"Paper trading con $10,000 virtuales y datos reales"}],vs=[{value:"50+",label:"Pares de Trading"},{value:"6",label:"Exchanges"},{value:"24/7",label:"Automatizaci√≥n"},{value:"<1ms",label:"Latencia"}];function fs(){const{login:d}=H(),[t,s]=S.useState(!0),[a,r]=S.useState({email:"",password:"",name:""}),[l,i]=S.useState(""),[o,m]=S.useState(!1),[x,g]=S.useState(!1),[u,n]=S.useState(0);S.useEffect(()=>{const c=setInterval(()=>{n(f=>(f+1)%st.length)},3e3);return()=>clearInterval(c)},[]);const b=async c=>{if(c.preventDefault(),i(""),!a.email||!a.password){i("Completa todos los campos");return}if(!t&&!a.name){i("Ingresa tu nombre");return}if(a.password.length<6){i("La contrase√±a debe tener al menos 6 caracteres");return}m(!0),setTimeout(()=>{d({id:Date.now().toString(36),email:a.email,name:a.name||a.email.split("@")[0],plan:"free",createdAt:new Date().toISOString()}),m(!1)},800)};return e.jsxs("div",{className:"min-h-screen bg-[var(--dark)] flex relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[700px] h-[700px] rounded-full opacity-[0.03]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute bottom-[-20%] left-[-10%] w-[600px] h-[600px] rounded-full opacity-[0.02]",style:{background:"radial-gradient(circle, #60A5FA 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[900px] h-[900px] rounded-full opacity-[0.015]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 50%)"}}),e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:"linear-gradient(rgba(59,130,246,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.3) 1px, transparent 1px)",backgroundSize:"60px 60px"}})]}),e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col justify-between p-12 relative",children:[e.jsx(_.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25), inset 0 1px 0 rgba(255,255,255,0.15)"},children:e.jsx("span",{className:"text-white font-extrabold text-lg",children:"K"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[17px] font-extrabold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[11px] font-bold text-gradient-gold tracking-[0.2em]",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)] font-medium tracking-[0.15em] uppercase",children:"by Kairos 777 Inc"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7,delay:.2},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-r from-transparent to-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-[0.2em] uppercase",children:"Professional Trading Platform"}),e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-l from-transparent to-[var(--gold)]"})]}),e.jsxs("h2",{className:"text-4xl font-extrabold text-[var(--text)] leading-[1.15] mb-4 tracking-tight",children:["Automatiza tu Trading",e.jsx("br",{}),e.jsx("span",{className:"text-gradient-gold",children:"con Inteligencia."})]}),e.jsx("p",{className:"text-[15px] text-[var(--text-secondary)] leading-relaxed mb-10 max-w-md",children:"Conecta tu exchange favorito y deja que nuestros bots inteligentes operen por ti. Datos en tiempo real, ejecuci√≥n autom√°tica, resultados profesionales."})]}),e.jsx("div",{className:"space-y-3 mb-10",children:st.map((c,f)=>{const y=c.icon,h=f===u;return e.jsxs(_.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+f*.1},className:`flex items-start gap-4 p-3.5 rounded-xl transition-all duration-500 cursor-default ${h?"glass-gold":"bg-transparent"}`,onMouseEnter:()=>n(f),children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all duration-500
                    ${h?"bg-gradient-to-br from-[var(--gold)] to-[var(--gold-dark)] shadow-[0_0_20px_rgba(59,130,246,0.2)]":"bg-[var(--surface-2)] border border-[var(--border)]"}`,children:e.jsx(y,{size:18,className:`transition-colors duration-500 ${h?"text-white":"text-[var(--text-dim)]"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-[13px] font-bold transition-colors duration-500 ${h?"text-[var(--text)]":"text-[var(--text-secondary)]"}`,children:c.label}),e.jsx("p",{className:`text-[11px] mt-0.5 transition-colors duration-500 ${h?"text-[var(--text-secondary)]":"text-[var(--text-dim)]"}`,children:c.desc})]})]},c.label)})}),e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"flex gap-6",children:vs.map(c=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-extrabold text-gradient-gold",children:c.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] font-medium mt-0.5",children:c.label})]},c.label))})]}),e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"relative z-10 flex items-center justify-between",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/40",children:"¬© 2026 Kairos 777 Inc. Todos los derechos reservados."}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("span",{className:"text-[10px] text-[var(--green)] font-semibold",children:"Sistemas operacionales"})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 lg:max-w-[480px] relative z-10",children:e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-[380px]",children:[e.jsxs("div",{className:"text-center mb-8 lg:hidden",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-white font-extrabold text-xl mx-auto mb-3",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25)"},children:"K"}),e.jsxs("h1",{className:"text-xl font-extrabold tracking-tight",children:[e.jsx("span",{className:"text-gradient-gold",children:"KAIROS"})," ",e.jsx("span",{className:"text-[var(--text)]",children:"TRADE"})]})]}),e.jsxs("div",{className:"mb-7",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-[var(--text)] tracking-tight",children:t?"Bienvenido.":"Empieza a operar."}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1.5",children:t?"Accede a tu plataforma de trading":"Crea tu cuenta en 30 segundos"})]}),e.jsxs("div",{className:"flex mb-7 rounded-xl p-1 glass",children:[e.jsx("button",{onClick:()=>{s(!0),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${t?"text-white font-bold shadow-lg":"text-[var(--text-dim)] font-medium hover:text-[var(--text)]"}`,style:t?{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"}:{},children:"Iniciar Sesi√≥n"}),e.jsx("button",{onClick:()=>{s(!1),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${t?"text-[var(--text-dim)] font-medium hover:text-[var(--text)]":"text-white font-bold shadow-lg"}`,style:t?{}:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"},children:"Registrarse"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx(Q,{mode:"wait",children:!t&&e.jsxs(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{type:"text",value:a.name,onChange:c=>r({...a,name:c.target.value}),placeholder:"Tu nombre completo",className:"w-full",autoComplete:"name"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:c=>r({...a,email:c.target.value}),placeholder:"tu@email.com",className:"w-full",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Contrase√±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:x?"text":"password",value:a.password,onChange:c=>r({...a,password:c.target.value}),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",className:"w-full pr-10",autoComplete:t?"current-password":"new-password"}),e.jsx("button",{type:"button",onClick:()=>g(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:x?e.jsx(ht,{size:15}):e.jsx(gt,{size:15})})]})]}),e.jsx(Q,{children:l&&e.jsx(_.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},className:"text-xs text-[var(--red)] bg-[var(--red)]/[0.06] border border-[var(--red)]/10 px-3.5 py-2.5 rounded-xl",children:l})}),e.jsx("button",{type:"submit",disabled:o,className:"w-full py-3.5 rounded-xl transition-all duration-300 disabled:opacity-50 flex items-center justify-center gap-2 text-sm btn-gold",children:o?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[t?"Acceder a la Plataforma":"Crear Cuenta",e.jsx(bt,{size:16})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-medium",children:"ECOSISTEMA"}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"})]}),e.jsxs("a",{href:"https://kairos-777.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--gold)] transition-all border border-[var(--border)] hover:border-[var(--gold)]/20",children:[e.jsx(pt,{size:14,className:"text-[var(--gold)]"}),"Conoce el ecosistema Kairos 777"]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]/30 text-center mt-5",children:["Parte del ecosistema ",e.jsx("span",{className:"text-[var(--gold)] font-semibold",children:"Kairos 777"})]})]})})]})}const at=["https://api.binance.us/api/v3","https://api.binance.com/api/v3"],me=["wss://stream.binance.us:9443/ws","wss://stream.binance.com:9443/ws"];class ys{constructor(){this.ws=null,this.subscribers=new Map,this.reconnectAttempts=0,this.maxReconnect=5,this.candleCache=new Map,this._apiBase=null,this._wsBase=null}async _getAPI(){if(this._apiBase)return this._apiBase;for(const t of at)try{const s=new AbortController,a=setTimeout(()=>s.abort(),5e3),r=await fetch(`${t}/ping`,{signal:s.signal});if(clearTimeout(a),r.ok)return this._apiBase=t,this._wsBase=t.includes("binance.us")?me[0]:me[1],console.log("Kairos MarketData: using",t),t}catch{}return this._apiBase=at[0],this._wsBase=me[0],this._apiBase}connectStream(t,s={}){const a=t.toLowerCase(),r=this._wsBase||me[0],l=`${r}/${a}@ticker/${a}@kline_1m`;return this.ws&&this.ws.close(),this.ws=new WebSocket(l),this.ws.onopen=()=>{var i;this.reconnectAttempts=0,(i=s.onConnect)==null||i.call(s)},this.ws.onmessage=i=>{var o,m;try{const x=JSON.parse(i.data);if(x.e==="24hrTicker"&&((o=s.onTicker)==null||o.call(s,{symbol:x.s,price:parseFloat(x.c),change:parseFloat(x.p),changePercent:parseFloat(x.P),high:parseFloat(x.h),low:parseFloat(x.l),volume:parseFloat(x.v),quoteVolume:parseFloat(x.q)})),x.e==="kline"){const g=x.k;(m=s.onCandle)==null||m.call(s,{time:Math.floor(g.t/1e3),open:parseFloat(g.o),high:parseFloat(g.h),low:parseFloat(g.l),close:parseFloat(g.c),volume:parseFloat(g.v),closed:g.x})}}catch(x){console.error("WS parse error:",x)}},this.ws.onerror=i=>{var o;if(console.error("WS error:",i),r===me[1]&&this.reconnectAttempts===0){this._wsBase=me[0],this.connectStream(t,s);return}(o=s.onError)==null||o.call(s,i)},this.ws.onclose=()=>{var i;this.reconnectAttempts<this.maxReconnect&&(this.reconnectAttempts++,setTimeout(()=>this.connectStream(t,s),2e3*this.reconnectAttempts)),(i=s.onDisconnect)==null||i.call(s)},()=>this.disconnect()}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}async getCandles(t,s="1h",a=500){const r=`${t}_${s}`,l=await this._getAPI();try{const i=new AbortController,o=setTimeout(()=>i.abort(),1e4),m=`${l}/klines?symbol=${t}&interval=${s}&limit=${a}`,x=await fetch(m,{signal:i.signal});if(clearTimeout(o),!x.ok)throw new Error(`HTTP ${x.status}`);const u=(await x.json()).map(n=>({time:Math.floor(n[0]/1e3),open:parseFloat(n[1]),high:parseFloat(n[2]),low:parseFloat(n[3]),close:parseFloat(n[4]),volume:parseFloat(n[5])}));return this.candleCache.set(r,{data:u,ts:Date.now()}),u}catch(i){if(console.error("getCandles error:",i.message),this._apiBase){this._apiBase=null;const m=await this._getAPI();if(m)try{const x=await fetch(`${m}/klines?symbol=${t}&interval=${s}&limit=${a}`);if(x.ok){const u=(await x.json()).map(n=>({time:Math.floor(n[0]/1e3),open:parseFloat(n[1]),high:parseFloat(n[2]),low:parseFloat(n[3]),close:parseFloat(n[4]),volume:parseFloat(n[5])}));return this.candleCache.set(r,{data:u,ts:Date.now()}),u}}catch{}}const o=this.candleCache.get(r);if(o)return o.data;throw i}}async getPrice(t){const s=await this._getAPI(),r=await(await fetch(`${s}/ticker/price?symbol=${t}`)).json();return parseFloat(r.price)}async get24hrTicker(t){const s=await this._getAPI(),r=await(await fetch(`${s}/ticker/24hr?symbol=${t}`)).json();return{symbol:r.symbol,price:parseFloat(r.lastPrice),change:parseFloat(r.priceChange),changePercent:parseFloat(r.priceChangePercent),high:parseFloat(r.highPrice),low:parseFloat(r.lowPrice),volume:parseFloat(r.volume),quoteVolume:parseFloat(r.quoteVolume)}}async getOrderBook(t,s=20){const a=await this._getAPI(),l=await(await fetch(`${a}/depth?symbol=${t}&limit=${s}`)).json();return{bids:l.bids.map(([i,o])=>({price:parseFloat(i),quantity:parseFloat(o)})),asks:l.asks.map(([i,o])=>({price:parseFloat(i),quantity:parseFloat(o)}))}}async searchSymbols(t){const s=await this._getAPI(),r=await(await fetch(`${s}/exchangeInfo`)).json(),l=t.toUpperCase();return r.symbols.filter(i=>i.status==="TRADING"&&(i.symbol.includes(l)||i.baseAsset.includes(l))).slice(0,20).map(i=>({symbol:i.symbol,base:i.baseAsset,quote:i.quoteAsset}))}}const W=new ys;function rt(){const{setPage:d,bots:t,brokers:s,tradeHistory:a,positions:r,user:l}=H(),[i,o]=S.useState([]),[m,x]=S.useState(!0);S.useEffect(()=>{g();const y=setInterval(g,3e4);return()=>clearInterval(y)},[]);const g=async()=>{try{const y=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"],h=await Promise.all(y.map(async j=>{try{return await W.get24hrTicker(j)}catch{return null}}));o(h.filter(Boolean))}catch(y){console.error("Dashboard load error:",y)}x(!1)},u=t.filter(y=>y.status==="active"),n=a.reduce((y,h)=>y+(h.pnl||0),0),b=s.filter(y=>y.connected),c=[{label:"Bots Activos",value:u.length,icon:ue,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.02))",border:"rgba(59,130,246,0.1)",action:"bots"},{label:"Brokers",value:`${b.length}/${s.length}`,icon:ut,color:"#A855F7",gradient:"linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.02))",border:"rgba(168,85,247,0.1)",action:"brokers"},{label:"Posiciones",value:r.length,icon:qe,color:"#00DC82",gradient:"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))",border:"rgba(0,220,130,0.1)",action:"history"},{label:"P&L Total",value:`${n>=0?"+":""}$${n.toFixed(2)}`,icon:we,color:n>=0?"#00DC82":"#FF4757",gradient:n>=0?"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))":"linear-gradient(135deg, rgba(255,71,87,0.1), rgba(255,71,87,0.02))",border:n>=0?"rgba(0,220,130,0.1)":"rgba(255,71,87,0.1)",action:"history"}],f=[{label:"Trading",icon:oe,page:"chart",desc:"Gr√°ficos profesionales",color:"#3B82F6"},{label:"Simulador",icon:le,page:"simulator",desc:"Paper trading sin riesgo",color:"#00DC82"},{label:"Kairos AI",icon:he,page:"ai",desc:"Asistente inteligente",color:"#A855F7"},{label:"Crear Bot",icon:ue,page:"bots",desc:"Automatiza tu trading",color:"#60A5FA"},{label:"Estrategias",icon:ee,page:"strategies",desc:"Crea y gestiona",color:"#EC4899"},{label:"Brokers",icon:ce,page:"brokers",desc:"Conecta tu cuenta",color:"#22D3EE"}];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(_.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight",children:["Bienvenido, ",e.jsx("span",{className:"text-[var(--gold)]",children:(l==null?void 0:l.name)||"Trader"})]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:"Tu centro de control de trading automatizado"})]}),e.jsxs("button",{onClick:()=>d("chart"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all hover:opacity-90 btn-gold",children:[e.jsx(oe,{size:16}),"Abrir Trading"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:c.map((y,h)=>{const j=y.icon;return e.jsxs(_.button,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:h*.06},onClick:()=>d(y.action),className:"rounded-xl p-4 text-left transition-all duration-200 hover:scale-[1.02] group",style:{background:y.gradient,border:`1px solid ${y.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:`${y.color}15`},children:e.jsx(j,{size:18,style:{color:y.color}})}),e.jsx(je,{size:14,className:"text-[var(--text-dim)]/30 group-hover:text-[var(--text-dim)] transition-colors"})]}),e.jsx("p",{className:"text-[22px] font-bold leading-none",style:{color:y.color},children:y.value}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 font-medium",children:y.label})]},y.label)})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold text-[var(--text)] mb-3 flex items-center gap-2",children:[e.jsx(ee,{size:14,className:"text-[var(--gold)]"}),"Acceso R√°pido"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map((y,h)=>{const j=y.icon;return e.jsxs(_.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2+h*.05},onClick:()=>d(y.page),className:"rounded-xl p-4 text-left transition-all duration-200 group hover:scale-[1.01]",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},onMouseEnter:C=>C.currentTarget.style.borderColor=`${y.color}30`,onMouseLeave:C=>C.currentTarget.style.borderColor="rgba(30,34,45,0.5)",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center mb-3 transition-transform group-hover:scale-110",style:{background:`${y.color}12`},children:e.jsx(j,{size:20,style:{color:y.color}})}),e.jsx("p",{className:"text-[13px] font-bold text-[var(--text)]",children:y.label}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-0.5",children:y.desc})]},y.label)})})]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{size:14,className:"text-[var(--gold)]"}),e.jsx("h2",{className:"text-sm font-bold",children:"Mercado en Tiempo Real"})]}),e.jsxs("button",{onClick:()=>d("chart"),className:"text-[11px] text-[var(--gold)] hover:text-[var(--gold-light)] font-semibold flex items-center gap-1 transition-colors",children:["Ver gr√°fico ",e.jsx(je,{size:12})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-2 text-[10px] font-bold text-[var(--text-dim)]/50 uppercase tracking-wider",children:[e.jsx("span",{children:"Par"}),e.jsx("span",{className:"text-right",children:"Precio"}),e.jsx("span",{className:"text-right",children:"Cambio 24h"}),e.jsx("span",{className:"text-right",children:"Acci√≥n"})]}),e.jsx("div",{className:"divide-y divide-[var(--border)]/30",children:m?e.jsx("div",{className:"p-8 text-center text-sm text-[var(--text-dim)] animate-pulse",children:"Cargando mercado..."}):i.map((y,h)=>e.jsxs(_.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:h*.05},onClick:()=>{H.getState().setSelectedPair(y.symbol),d("chart")},className:"group w-full grid grid-cols-4 gap-4 items-center px-4 py-3 hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:y.changePercent>=0?"rgba(14,203,129,0.08)":"rgba(246,70,93,0.08)"},children:e.jsx("span",{className:y.changePercent>=0?"text-[var(--green)]":"text-[var(--red)]",children:y.symbol.replace("USDT","").slice(0,3)})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[13px] font-bold leading-none",children:y.symbol.replace("USDT","")}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/50 mt-0.5",children:"USDT"})]})]}),e.jsxs("p",{className:"text-[13px] font-mono font-semibold text-right",children:["$",y.price.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsx("div",{className:"flex items-center gap-1 justify-end",children:e.jsxs("span",{className:`flex items-center gap-0.5 text-xs font-mono font-semibold px-2 py-0.5 rounded-md
                  ${y.changePercent>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:[y.changePercent>=0?e.jsx(Dt,{size:10}):e.jsx(vt,{size:10}),y.changePercent>=0?"+":"",y.changePercent.toFixed(2),"%"]})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] font-semibold text-[var(--gold)] opacity-0 group-hover:opacity-100 transition-opacity bg-[var(--gold)]/10 px-2 py-1 rounded-md",children:"Trading ‚Üí"})})]},y.symbol))})]})]})}function Z(d,t){const s=2/(t+1),a=[d[0]];for(let r=1;r<d.length;r++)a.push(d[r]*s+a[r-1]*(1-s));return a}function Fe(d,t){const s=[];for(let a=0;a<d.length;a++){if(a<t-1){s.push(null);continue}const r=d.slice(a-t+1,a+1);s.push(r.reduce((l,i)=>l+i,0)/t)}return s}function de(d,t=14){const s=new Array(t).fill(null);let a=0,r=0;for(let l=1;l<=t;l++){const i=d[l]-d[l-1];i>0?a+=i:r+=Math.abs(i)}a/=t,r/=t,s.push(r===0?100:100-100/(1+a/r));for(let l=t+1;l<d.length;l++){const i=d[l]-d[l-1];a=(a*(t-1)+(i>0?i:0))/t,r=(r*(t-1)+(i<0?Math.abs(i):0))/t,s.push(r===0?100:100-100/(1+a/r))}return s}function Be(d,t=12,s=26,a=9){const r=Z(d,t),l=Z(d,s),i=r.map((x,g)=>x-l[g]),o=Z(i,a),m=i.map((x,g)=>x-o[g]);return{macd:i,signal:o,histogram:m}}function Qe(d,t=20,s=2){const a=Fe(d,t),r=[],l=[];for(let i=0;i<d.length;i++){if(i<t-1){r.push(null),l.push(null);continue}const o=d.slice(i-t+1,i+1),m=a[i],x=o.reduce((u,n)=>u+Math.pow(n-m,2),0)/t,g=Math.sqrt(x)*s;r.push(m+g),l.push(m-g)}return{upper:r,middle:a,lower:l}}function Pt(d){let t=0,s=0;return d.map(a=>{const r=(a.high+a.low+a.close)/3;return s+=r*a.volume,t+=a.volume,t>0?s/t:r})}function be(d,t,s){if(s<1)return null;const a=d[s-1],r=d[s],l=t[s-1],i=t[s];return a<=l&&r>i?"bullish_cross":a>=l&&r<i?"bearish_cross":null}function js(d,t,s=14){if(d.length<s*2)return null;const a=d.length,r=Math.max(...d.slice(a-s)),l=Math.max(...d.slice(a-s*2,a-s)),i=Math.max(...t.slice(a-s).filter(m=>m!==null)),o=Math.max(...t.slice(a-s*2,a-s).filter(m=>m!==null));return r>l&&i<o?"bearish_divergence":r<l&&i>o?"bullish_divergence":null}function Ns(){const d=S.useRef(null),t=S.useRef(null),s=S.useRef(null),a=S.useRef(null),r=S.useRef([]),l=S.useRef(null),{selectedPair:i,selectedTimeframe:o,setSelectedPair:m,setSelectedTimeframe:x,setCurrentPrice:g,setPriceChange24h:u}=H(),[n,b]=S.useState(!0),[c,f]=S.useState(null),[y,h]=S.useState(!1),[j,C]=S.useState(""),[k,N]=S.useState(["ema20"]);S.useEffect(()=>{const P=d.current;if(!P)return;const A=P.getBoundingClientRect(),M=A.width||P.clientWidth||800,z=A.height||P.clientHeight||500,p=ls(P,{width:M,height:z,layout:{background:{type:ds.Solid,color:"#0B0E11"},textColor:"#848E9C",fontFamily:"Inter, sans-serif",fontSize:11},grid:{vertLines:{color:"#1E222D"},horzLines:{color:"#1E222D"}},crosshair:{mode:cs.Normal,vertLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"},horzLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"}},timeScale:{borderColor:"#1E222D",timeVisible:!0,secondsVisible:!1,rightOffset:5,barSpacing:8},rightPriceScale:{borderColor:"#1E222D",scaleMargins:{top:.05,bottom:.2}},handleScroll:{mouseWheel:!0,pressedMouseMove:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}}),T=p.addCandlestickSeries({upColor:"#0ECB81",downColor:"#F6465D",borderUpColor:"#0ECB81",borderDownColor:"#F6465D",wickUpColor:"#0ECB81",wickDownColor:"#F6465D"}),I=p.addHistogramSeries({color:"#3B82F622",priceFormat:{type:"volume"},priceScaleId:"volume"});p.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0}}),t.current=p,s.current=T,a.current=I;const R=()=>{const $=P.getBoundingClientRect();$.width>0&&$.height>0&&p.applyOptions({width:$.width,height:$.height})};requestAnimationFrame(R),setTimeout(R,100),setTimeout(R,300);const v=new ResizeObserver($=>{if(!$||!$[0])return;const{width:q,height:Y}=$[0].contentRect;q>0&&Y>0&&p.applyOptions({width:q,height:Y})});return v.observe(P),()=>{v.disconnect(),p.remove(),t.current=null,s.current=null,a.current=null}},[]),S.useEffect(()=>{let P=!1;return(async()=>{b(!0),f(null);try{const M=Te(i),[z,p]=await Promise.all([W.getCandles(M,o,500),W.get24hrTicker(M)]);if(P)return;if(!z||z.length===0){f("No se recibieron datos de Binance"),b(!1);return}s.current&&s.current.setData(z),a.current&&a.current.setData(z.map(T=>({time:T.time,value:T.volume||0,color:T.close>=T.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"}))),g(p.price),u(p.changePercent);try{w(z)}catch(T){console.warn("Indicator error (non-fatal):",T)}t.current&&t.current.timeScale().fitContent()}catch(M){console.error("Chart data load error:",M),P||f(`Error cargando datos: ${M.message}`)}P||b(!1)})(),l.current&&l.current(),l.current=W.connectStream(Te(i),{onTicker:M=>{g(M.price),u(M.changePercent)},onCandle:M=>{s.current&&s.current.update(M),a.current&&a.current.update({time:M.time,value:M.volume||0,color:M.close>=M.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"})}}),()=>{P=!0,l.current&&(l.current(),l.current=null)}},[i,o]);const w=P=>{if(!t.current)return;r.current.forEach(z=>{var p;try{(p=t.current)==null||p.removeSeries(z)}catch{}}),r.current=[];const A=P.map(z=>z.close),M=P.map(z=>z.time);k.forEach(z=>{try{if(z==="ema20"){const T=Z(A,20).map((I,R)=>I!=null&&isFinite(I)?{time:M[R],value:I}:null).filter(Boolean);if(T.length>0){const I=t.current.addLineSeries({color:"#3B82F6",lineWidth:1.5,title:"EMA 20",lastValueVisible:!1,priceLineVisible:!1});I.setData(T),r.current.push(I)}}if(z==="ema50"){const T=Z(A,50).map((I,R)=>I!=null&&isFinite(I)?{time:M[R],value:I}:null).filter(Boolean);if(T.length>0){const I=t.current.addLineSeries({color:"#8B5CF6",lineWidth:1.5,title:"EMA 50",lastValueVisible:!1,priceLineVisible:!1});I.setData(T),r.current.push(I)}}if(z==="sma200"){const T=Fe(A,200).map((I,R)=>I!=null&&isFinite(I)?{time:M[R],value:I}:null).filter(Boolean);if(T.length>0){const I=t.current.addLineSeries({color:"#FF6D00",lineWidth:1,title:"SMA 200",lastValueVisible:!1,priceLineVisible:!1});I.setData(T),r.current.push(I)}}if(z==="bb"){const p=Qe(A),T=p.upper.map((R,v)=>R!=null&&isFinite(R)?{time:M[v],value:R}:null).filter(Boolean),I=p.lower.map((R,v)=>R!=null&&isFinite(R)?{time:M[v],value:R}:null).filter(Boolean);if(T.length>0){const R=t.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Upper",lastValueVisible:!1,priceLineVisible:!1}),v=t.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Lower",lastValueVisible:!1,priceLineVisible:!1});R.setData(T),v.setData(I),r.current.push(R,v)}}}catch(p){console.warn(`Indicator ${z} error:`,p)}})};S.useEffect(()=>{if(!s.current)return;(async()=>{try{const A=await W.getCandles(Te(i),o,500);w(A)}catch{}})()},[k]);const B=P=>{N(A=>A.includes(P)?A.filter(M=>M!==P):[...A,P])};return e.jsxs("div",{className:"flex flex-col w-full flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 shrink-0 flex-wrap",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>h(!y),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Mt,{size:13,className:"text-[var(--text-dim)]"}),i]}),y&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2",children:[e.jsx("input",{type:"text",value:j,onChange:P=>C(P.target.value.toUpperCase()),placeholder:"Buscar par...",className:"w-full text-sm mb-2",autoFocus:!0}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:St.filter(P=>P.includes(j)).map(P=>e.jsx("button",{onClick:()=>{m(P),h(!1),C("")},className:`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors
                        ${P===i?"bg-[var(--gold)]/15 text-[var(--gold)]":"text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]"}`,children:P},P))})]})]}),e.jsx("div",{className:"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5",children:Ve.map(P=>e.jsx("button",{onClick:()=>x(P.value),className:`px-2.5 py-1 text-xs rounded-md transition-colors
                ${o===P.value?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:P.label},P.value))}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(ie,{size:13,className:"text-[var(--text-dim)]"}),[{id:"ema20",label:"EMA 20",color:"#3B82F6"},{id:"ema50",label:"EMA 50",color:"#8B5CF6"},{id:"sma200",label:"SMA 200",color:"#FF6D00"},{id:"bb",label:"BB",color:"#9C27B0"}].map(P=>e.jsx("button",{onClick:()=>B(P.id),className:`px-2 py-0.5 text-[11px] rounded transition-all
                ${k.includes(P.id)?"font-semibold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:k.includes(P.id)?{color:P.color,background:`${P.color}15`}:{},children:P.label},P.id))]})]}),e.jsxs("div",{ref:d,className:"relative",style:{flex:"1 1 0%",minHeight:0,overflow:"hidden"},children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.85)"},children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-[var(--gold)] border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-xs text-[var(--text-dim)]",children:["Cargando ",i,"..."]})]})}),c&&!n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.9)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-[var(--red)] mb-2",children:c}),e.jsx("button",{onClick:()=>{f(null),b(!0)},className:"px-4 py-2 text-xs bg-[var(--gold)] text-white rounded-lg font-semibold",children:"Reintentar"})]})})]})]})}const ws="https://api.binance.com/api/v3/depth";function Ss({pair:d="BTCUSDT",height:t=260}){const s=S.useRef(null),[a,r]=S.useState(null),[l,i]=S.useState(null),o=S.useRef(null),m=S.useCallback(async()=>{try{const u=await fetch(`${ws}?symbol=${d}&limit=100`);if(!u.ok)return;const n=await u.json();r(n)}catch{}},[d]);S.useEffect(()=>{m();const u=setInterval(m,3e3);return()=>clearInterval(u)},[m]);const x=S.useCallback(()=>{var F,O;const u=s.current;if(!u||!a)return;const n=u.getContext("2d"),b=window.devicePixelRatio||1,c=u.clientWidth,f=u.clientHeight;u.width=c*b,u.height=f*b,n.scale(b,b),n.clearRect(0,0,c,f);const y=a.bids.map(([E,D])=>[parseFloat(E),parseFloat(D)]),h=a.asks.map(([E,D])=>[parseFloat(E),parseFloat(D)]);if(!y.length||!h.length)return;const j=[];let C=0;for(const[E,D]of y)C+=D,j.push([E,C]);const k=[];let N=0;for(const[E,D]of h)N+=D,k.push([E,N]);const w=(y[0][0]+h[0][0])/2,B=Math.max(((F=j[j.length-1])==null?void 0:F[1])||0,((O=k[k.length-1])==null?void 0:O[1])||0),P=[...j.map(E=>E[0]),...k.map(E=>E[0])],A=Math.min(...P),M=Math.max(...P),z=M-A||1,p={top:10,bottom:25,left:0,right:0},T=c-p.left-p.right,I=f-p.top-p.bottom,R=E=>p.left+(E-A)/z*T,v=E=>p.top+I-E/B*I;n.beginPath(),n.moveTo(R(j[0][0]),v(0));for(const[E,D]of j)n.lineTo(R(E),v(D));n.lineTo(R(j[j.length-1][0]),v(0)),n.closePath();const $=n.createLinearGradient(0,0,0,f);$.addColorStop(0,"rgba(0,220,130,0.25)"),$.addColorStop(1,"rgba(0,220,130,0.02)"),n.fillStyle=$,n.fill(),n.beginPath();for(let E=0;E<j.length;E++){const[D,L]=j[E];E===0?n.moveTo(R(D),v(L)):n.lineTo(R(D),v(L))}n.strokeStyle="#00DC82",n.lineWidth=1.5,n.stroke(),n.beginPath(),n.moveTo(R(k[0][0]),v(0));for(const[E,D]of k)n.lineTo(R(E),v(D));n.lineTo(R(k[k.length-1][0]),v(0)),n.closePath();const q=n.createLinearGradient(0,0,0,f);q.addColorStop(0,"rgba(255,59,48,0.25)"),q.addColorStop(1,"rgba(255,59,48,0.02)"),n.fillStyle=q,n.fill(),n.beginPath();for(let E=0;E<k.length;E++){const[D,L]=k[E];E===0?n.moveTo(R(D),v(L)):n.lineTo(R(D),v(L))}n.strokeStyle="#FF3B30",n.lineWidth=1.5,n.stroke();const Y=R(w);if(n.beginPath(),n.setLineDash([4,4]),n.moveTo(Y,p.top),n.lineTo(Y,f-p.bottom),n.strokeStyle="#3B82F680",n.lineWidth=1,n.stroke(),n.setLineDash([]),n.fillStyle="#3B82F6",n.font="600 10px Inter, sans-serif",n.textAlign="center",n.fillText(`$${w.toFixed(2)}`,Y,f-p.bottom+14),n.fillStyle="#555",n.font="9px Inter, sans-serif",n.textAlign="left",n.fillText(`$${A.toFixed(0)}`,p.left+4,f-p.bottom+14),n.textAlign="right",n.fillText(`$${M.toFixed(0)}`,c-p.right-4,f-p.bottom+14),l&&l.x>=0&&l.x<=c){const E=A+l.x/c*z,D=E<w,L=D?j:k;let xe=0;for(const[Pe,Re]of L)(D?Pe>=E:Pe<=E)&&(xe=Re);n.beginPath(),n.setLineDash([2,2]),n.moveTo(l.x,p.top),n.lineTo(l.x,f-p.bottom),n.strokeStyle="rgba(255,255,255,0.15)",n.lineWidth=1,n.stroke(),n.setLineDash([]);const ke=`$${E.toFixed(2)} ‚Äî Vol: ${xe.toFixed(4)}`,ne=n.measureText(ke).width+16,ve=Math.min(l.x-ne/2,c-ne-4);n.fillStyle="#1A1B1E",n.strokeStyle="rgba(59,130,246,0.3)",n.lineWidth=1,n.beginPath(),n.roundRect(Math.max(ve,4),p.top,ne,22,4),n.fill(),n.stroke(),n.fillStyle="#fff",n.font="10px Inter, sans-serif",n.textAlign="center",n.fillText(ke,Math.max(ve,4)+ne/2,p.top+15)}},[a,l]);S.useEffect(()=>(o.current=requestAnimationFrame(x),()=>cancelAnimationFrame(o.current)),[x]);const g=u=>{var b;const n=(b=s.current)==null?void 0:b.getBoundingClientRect();n&&i({x:u.clientX-n.left,y:u.clientY-n.top})};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-xl overflow-hidden relative",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(oe,{size:14,className:"text-[var(--gold)]"})," Depth Chart"]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00DC82]"})," Bids"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#FF3B30]"})," Asks"]})]})]}),a?e.jsx("canvas",{ref:s,style:{width:"100%",height:t},onMouseMove:g,onMouseLeave:()=>i(null),className:"cursor-crosshair"}):e.jsx("div",{className:"flex items-center justify-center",style:{height:t},children:e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Cargando profundidad‚Ä¶"})})]})}function ks(){const{selectedPair:d,currentPrice:t,positions:s,orders:a,addPosition:r,addOrder:l,closePosition:i,cancelOrder:o}=H(),[m,x]=S.useState("buy"),[g,u]=S.useState("market"),[n,b]=S.useState({quantity:"",price:"",stopLoss:"",takeProfit:""}),[c,f]=S.useState({bids:[],asks:[]}),[y,h]=S.useState("order");S.useEffect(()=>{j();const N=setInterval(j,5e3);return()=>clearInterval(N)},[d]);const j=async()=>{try{const N=await W.getOrderBook(Te(d),10);f(N)}catch{}},C=()=>{if(!n.quantity)return;const N=g==="market"?t:parseFloat(n.price);N&&(g==="market"?r({symbol:d,side:m,quantity:parseFloat(n.quantity),entryPrice:N,stopLoss:n.stopLoss?parseFloat(n.stopLoss):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit):null,openedAt:new Date().toISOString()}):l({symbol:d,side:m,type:g,quantity:parseFloat(n.quantity),price:N,stopLoss:n.stopLoss?parseFloat(n.stopLoss):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit):null,status:"open",createdAt:new Date().toISOString()}),b({quantity:"",price:"",stopLoss:"",takeProfit:""}))},k=parseFloat(n.quantity||0)*(g==="market"?t||0:parseFloat(n.price||0));return e.jsxs("div",{className:"flex flex-col h-full",style:{width:320,borderLeft:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"flex shrink-0 px-2 pt-2 gap-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:["order","positions","orders"].map(N=>e.jsx("button",{onClick:()=>h(N),className:`flex-1 py-2.5 text-[11px] font-bold rounded-t-lg transition-all
              ${y===N?"text-[var(--gold)] bg-[var(--gold)]/[0.06]":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:y===N?{borderBottom:"2px solid var(--gold)"}:{borderBottom:"2px solid transparent"},children:N==="order"?"Orden":N==="positions"?`Pos (${s.length})`:`√ìrd (${a.length})`},N))}),y==="order"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("button",{onClick:()=>x("buy"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${m==="buy"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:m==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 12px rgba(14,203,129,0.25)"}:{},children:"Comprar"}),e.jsx("button",{onClick:()=>x("sell"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${m==="sell"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:m==="sell"?{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 12px rgba(246,70,93,0.25)"}:{},children:"Vender"})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-lg bg-[var(--dark-3)]",children:["market","limit","stop_loss"].map(N=>e.jsx("button",{onClick:()=>u(N),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all
                  ${g===N?"bg-[var(--dark-4)] text-[var(--text)] shadow-sm":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:N==="market"?"Market":N==="limit"?"L√≠mite":"Stop"},N))}),g!=="market"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio"}),e.jsx("input",{type:"number",value:n.price,onChange:N=>b({...n,price:N.target.value}),placeholder:t==null?void 0:t.toString(),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Cantidad"}),e.jsx("input",{type:"number",value:n.quantity,onChange:N=>b({...n,quantity:N.target.value}),placeholder:"0.001",className:"w-full text-sm"}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:[25,50,75,100].map(N=>e.jsxs("button",{onClick:()=>{const w=g==="market"?t:parseFloat(n.price)||t;if(w){const P=1e4*(N/100)/w;b({...n,quantity:P.toFixed(6)})}},className:"flex-1 py-1.5 text-[10px] font-semibold rounded-md text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all",style:{background:"rgba(14,16,21,0.6)",border:"1px solid var(--border)"},children:[N,"%"]},N))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(ce,{size:9,className:"text-[var(--red)]"})," SL"]}),e.jsx("input",{type:"number",value:n.stopLoss,onChange:N=>b({...n,stopLoss:N.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(Se,{size:9,className:"text-[var(--green)]"})," TP"]}),e.jsx("input",{type:"number",value:n.takeProfit,onChange:N=>b({...n,takeProfit:N.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg p-3 flex items-center justify-between",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-semibold uppercase tracking-wider",children:"Total"}),e.jsxs("span",{className:"text-sm font-mono font-bold",children:["$",k.toFixed(2)]})]}),e.jsxs("button",{onClick:C,disabled:!n.quantity,className:"w-full py-3.5 font-bold rounded-xl text-sm transition-all duration-200 disabled:opacity-40 text-white",style:m==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 15px rgba(14,203,129,0.25)"}:{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 15px rgba(246,70,93,0.25)"},children:[m==="buy"?"Comprar":"Vender"," ",kt(d)]}),e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 font-bold uppercase tracking-wider",children:"Order Book"}),e.jsxs("div",{className:"space-y-[2px] text-[10px] font-mono",children:[c.asks.slice(0,5).reverse().map((N,w)=>e.jsxs("div",{className:"flex justify-between text-[var(--red)] py-0.5 px-1 rounded hover:bg-[var(--red)]/[0.04]",children:[e.jsxs("span",{children:["$",N.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:N.quantity.toFixed(4)})]},`a${w}`)),e.jsxs("div",{className:"text-center py-1.5 text-[15px] font-bold text-[var(--gold)] my-1",style:{background:"rgba(59,130,246,0.04)",borderRadius:"6px"},children:["$",(t==null?void 0:t.toLocaleString(void 0,{minimumFractionDigits:2}))||"---"]}),c.bids.slice(0,5).map((N,w)=>e.jsxs("div",{className:"flex justify-between text-[var(--green)] py-0.5 px-1 rounded hover:bg-[var(--green)]/[0.04]",children:[e.jsxs("span",{children:["$",N.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:N.quantity.toFixed(4)})]},`b${w}`))]})]})]}),y==="positions"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin posiciones abiertas"})]}):s.map(N=>{const w=N.side==="buy"?(t-N.entryPrice)*N.quantity:(N.entryPrice-t)*N.quantity;return e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:`1px solid ${w>=0?"rgba(14,203,129,0.1)":"rgba(246,70,93,0.1)"}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold",children:N.symbol}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-md ${N.side==="buy"?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:N.side.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-[var(--text-dim)] mb-2",children:[e.jsxs("span",{children:["Entrada: $",N.entryPrice]}),e.jsxs("span",{className:`font-bold ${w>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:["P&L: ",w>=0?"+":"","$",w.toFixed(2)]})]}),e.jsx("button",{onClick:()=>i(N.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cerrar Posici√≥n"})]},N.id)})}),y==="orders"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin √≥rdenes pendientes"})]}):a.map(N=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:N.symbol}),e.jsxs("span",{className:`text-[10px] font-bold ${N.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:[N.side.toUpperCase()," ",N.type]})]}),e.jsxs("div",{className:"text-[10px] text-[var(--text-dim)] mb-2",children:["Precio: $",N.price," | Cantidad: ",N.quantity]}),e.jsx("button",{onClick:()=>o(N.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cancelar"})]},N.id))})]})}class Ps{constructor(){this.connections=new Map}_decrypt(t){return{...t,apiKey:atob(t.apiKey),apiSecret:atob(t.apiSecret),passphrase:t.passphrase?atob(t.passphrase):void 0}}async _hmacSign(t,s){const a=new TextEncoder,r=await crypto.subtle.importKey("raw",a.encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",r,a.encode(s));return Array.from(new Uint8Array(l)).map(i=>i.toString(16).padStart(2,"0")).join("")}async _binanceSignedRequest(t,s,a,r={}){const l=Date.now(),i={...r,timestamp:l,recvWindow:5e3},o=Object.entries(i).filter(([,c])=>c!=null).map(([c,f])=>`${c}=${encodeURIComponent(f)}`).join("&"),m=await this._hmacSign(t.apiSecret,o),x=`${o}&signature=${m}`,g=s==="GET"?`${Ae.binance.baseUrl}${a}?${x}`:`${Ae.binance.baseUrl}${a}`,u={method:s,headers:{"X-MBX-APIKEY":t.apiKey,"Content-Type":"application/x-www-form-urlencoded"}};(s==="POST"||s==="DELETE")&&(u.body=x);const n=await fetch(g,u),b=await n.json();if(!n.ok)throw new Error(`Binance ${a}: ${b.msg||n.statusText} (${b.code||n.status})`);return b}async _binancePublicRequest(t,s={}){const a=Object.entries(s).filter(([,i])=>i!==void 0).map(([i,o])=>`${i}=${encodeURIComponent(o)}`).join("&"),r=`${Ae.binance.baseUrl}${t}${a?"?"+a:""}`,l=await fetch(r);if(!l.ok)throw new Error(`Binance API error: ${l.status}`);return l.json()}async connect(t){const s=this._decrypt(t),a=Ae[t.brokerId];if(!a)throw new Error(`Unsupported broker: ${t.brokerId}`);try{switch(t.brokerId){case"binance":{await this._binancePublicRequest("/api/v3/ping");const r=await this._binanceSignedRequest(s,"GET","/api/v3/account");return this.connections.set(t.id,{creds:s,config:a,connected:!0,permissions:r.permissions||[],accountType:r.accountType}),{success:!0,message:`Connected to Binance (${r.accountType})`,permissions:r.permissions}}default:return await fetch(a.baseUrl),this.connections.set(t.id,{creds:s,config:a,connected:!0,permissions:[]}),{success:!0,message:`Connected to ${a.name} (simulated)`}}}catch(r){return{success:!1,message:r.message}}}async getBalances(t){const s=this.connections.get(t);if(!s)throw new Error("Broker not connected");if(s.config.id==="binance")try{return(await this._binanceSignedRequest(s.creds,"GET","/api/v3/account")).balances.filter(r=>parseFloat(r.free)>0||parseFloat(r.locked)>0).map(r=>({asset:r.asset,free:r.free,locked:r.locked,total:(parseFloat(r.free)+parseFloat(r.locked)).toString()}))}catch(a){throw console.error("Binance getBalances error:",a),a}return[]}async placeOrder(t,s){var u,n,b,c,f,y;const a=this.connections.get(t);if(!a)throw new Error("Broker not connected");const{symbol:r,side:l,type:i,quantity:o,price:m,stopLoss:x,takeProfit:g}=s;if(!r||!l||!i||!o)throw new Error("Missing required order fields");if(a.config.id==="binance")try{const h={market:"MARKET",limit:"LIMIT",stop_loss:"STOP_LOSS_LIMIT"}[i]||"MARKET",j={symbol:r,side:l.toUpperCase(),type:h,quantity:o.toString()};(h==="LIMIT"||h==="STOP_LOSS_LIMIT")&&(j.timeInForce="GTC",j.price=parseFloat(m).toFixed(2)),h==="STOP_LOSS_LIMIT"&&(j.stopPrice=parseFloat(x||m).toFixed(2));const C=await this._binanceSignedRequest(a.creds,"POST","/api/v3/order",j);return{id:(u=C.orderId)==null?void 0:u.toString(),clientOrderId:C.clientOrderId,symbol:C.symbol,side:(n=C.side)==null?void 0:n.toLowerCase(),type:(b=C.type)==null?void 0:b.toLowerCase(),quantity:parseFloat(C.origQty||o),price:parseFloat(C.price||m||0),filledPrice:parseFloat(((f=(c=C.fills)==null?void 0:c[0])==null?void 0:f.price)||C.price||0),filledQty:parseFloat(C.executedQty||0),status:(y=C.status)==null?void 0:y.toLowerCase(),timestamp:new Date(C.transactTime||Date.now()).toISOString(),broker:"Binance",raw:C}}catch(h){throw console.error("Binance placeOrder error:",h),h}return{id:Date.now().toString(36),symbol:r,side:l,type:i,quantity:parseFloat(o),price:m?parseFloat(m):null,status:i==="market"?"filled":"new",filledPrice:i==="market"?parseFloat(m||0):null,timestamp:new Date().toISOString(),broker:a.config.name,simulated:!0}}async cancelOrder(t,s,a){const r=this.connections.get(t);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{const l=await this._binanceSignedRequest(r.creds,"DELETE","/api/v3/order",{symbol:a,orderId:s});return{success:!0,orderId:l.orderId,status:l.status}}catch(l){return{success:!1,message:l.message}}return{success:!0,orderId:s,simulated:!0}}async getOpenOrders(t,s){const a=this.connections.get(t);if(!a)throw new Error("Broker not connected");if(a.config.id==="binance")try{const r=s?{symbol:s}:{};return(await this._binanceSignedRequest(a.creds,"GET","/api/v3/openOrders",r)).map(i=>{var o,m,x,g;return{id:(o=i.orderId)==null?void 0:o.toString(),symbol:i.symbol,side:(m=i.side)==null?void 0:m.toLowerCase(),type:(x=i.type)==null?void 0:x.toLowerCase(),quantity:parseFloat(i.origQty),price:parseFloat(i.price),filledQty:parseFloat(i.executedQty),status:(g=i.status)==null?void 0:g.toLowerCase(),time:new Date(i.time).toISOString()}})}catch{return[]}return[]}async getTradeHistory(t,s,a=50){const r=this.connections.get(t);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{return(await this._binanceSignedRequest(r.creds,"GET","/api/v3/myTrades",{symbol:s,limit:a})).map(i=>{var o,m;return{id:(o=i.id)==null?void 0:o.toString(),orderId:(m=i.orderId)==null?void 0:m.toString(),symbol:i.symbol,side:i.isBuyer?"buy":"sell",price:parseFloat(i.price),quantity:parseFloat(i.qty),commission:parseFloat(i.commission),commissionAsset:i.commissionAsset,time:new Date(i.time).toISOString(),isMaker:i.isMaker}})}catch{return[]}return[]}async getExchangeInfo(t){var s,a,r,l;try{const o=(s=(await this._binancePublicRequest("/api/v3/exchangeInfo",{symbol:t})).symbols)==null?void 0:s[0];if(!o)return null;const m=(a=o.filters)==null?void 0:a.find(u=>u.filterType==="LOT_SIZE"),x=(r=o.filters)==null?void 0:r.find(u=>u.filterType==="PRICE_FILTER"),g=(l=o.filters)==null?void 0:l.find(u=>u.filterType==="NOTIONAL"||u.filterType==="MIN_NOTIONAL");return{symbol:o.symbol,status:o.status,baseAsset:o.baseAsset,quoteAsset:o.quoteAsset,minQty:m?parseFloat(m.minQty):0,maxQty:m?parseFloat(m.maxQty):1/0,stepSize:m?parseFloat(m.stepSize):0,minPrice:x?parseFloat(x.minPrice):0,tickSize:x?parseFloat(x.tickSize):0,minNotional:g?parseFloat(g.minNotional||g.notional):0}}catch{return null}}isConnected(t){return this.connections.has(t)}getConnection(t){return this.connections.get(t)}disconnect(t){this.connections.delete(t)}}const _e=new Ps;class U{constructor(t){this._series=t.map(s=>s??0),this._value=this._series[this._series.length-1]||0}valueOf(){return this._value}toString(){return String(this._value)}get value(){return this._value}get series(){return this._series}prev(t=1){return this._series[this._series.length-1-t]||0}toFixed(t){return this._value.toFixed(t)}}function Cs(d){const t=d.map(F=>F.close),s=d.map(F=>F.open),a=d.map(F=>F.high),r=d.map(F=>F.low),l=d.map(F=>F.volume),i=t.length;let o=null,m={stopLoss:2,takeProfit:4};const x=[],g=(F=20)=>new U(Z(t,F)),u=(F=20)=>new U(Fe(t,F)),n=(F=14)=>new U(de(t,F)),b=(F=12,O=26,E=9)=>{const D=Be(t,F,O,E);return{line:new U(D.macd),signal:new U(D.signal),histogram:new U(D.histogram),valueOf(){return D.histogram[i-1]||0}}},c=(F=20,O=2)=>{const E=Qe(t,F,O);return{upper:new U(E.upper),middle:new U(E.middle),lower:new U(E.lower)}},f=()=>new U(Pt(d)),y=(F,O)=>{const E=F instanceof U?F.series:typeof F=="number"?[F,F]:[],D=O instanceof U?O.series:typeof O=="number"?[O,O]:[];if(E.length<2||D.length<2)return!1;const L=Math.min(E.length,D.length)-1;return E[L-1]<=D[L-1]&&E[L]>D[L]},h=(F,O)=>{const E=F instanceof U?F.series:typeof F=="number"?[F,F]:[],D=O instanceof U?O.series:typeof O=="number"?[O,O]:[];if(E.length<2||D.length<2)return!1;const L=Math.min(E.length,D.length)-1;return E[L-1]>=D[L-1]&&E[L]<D[L]},j=(F={})=>{o={type:"buy",...F}},C=(F={})=>{o={type:"sell",...F}},k=(F={})=>{Object.assign(m,F)},N=F=>{x.push(String(F))},w=F=>{x.push(`‚ö†Ô∏è ${String(F)}`)},B=new U(t),P=new U(s),A=new U(a),M=new U(r),z=new U(l),p=t[i-1]||0,T=i-1;return{sandbox:{ema:g,sma:u,rsi:n,macd:b,bb:c,vwap:f,close:B,open:P,high:A,low:M,volume:z,price:p,barIndex:T,crossover:y,crossunder:h,buy:j,sell:C,config:k,log:N,alert:w,highest:(F,O)=>{const D=(F instanceof U?F.series:t).slice(-O);return Math.max(...D.filter(L=>L!=null))},lowest:(F,O)=>{const D=(F instanceof U?F.series:t).slice(-O);return Math.min(...D.filter(L=>L!=null))},avg:(F,O)=>{const D=(F instanceof U?F.series:t).slice(-O).filter(L=>L!=null);return D.reduce((L,xe)=>L+xe,0)/(D.length||1)},change:(F,O=1)=>{const E=F instanceof U?F.series:t,D=E[E.length-1]||0,L=E[E.length-1-O]||0;return D-L},percentChange:(F,O=1)=>{const E=F instanceof U?F.series:t,D=E[E.length-1]||0,L=E[E.length-1-O]||0;return L!==0?(D-L)/L*100:0},Math,Number,parseInt,parseFloat,isNaN,isFinite},getSignal:()=>o,getConfig:()=>m,getLogs:()=>x}}function Ct(d,t){if(!d||!t||t.length<2)return{signal:null,config:{stopLoss:2,takeProfit:4},logs:["No hay datos suficientes"]};const{sandbox:s,getSignal:a,getConfig:r,getLogs:l}=Cs(t);try{const i=["window","document","globalThis","self","fetch","XMLHttpRequest","WebSocket","eval","Function","setTimeout","setInterval","importScripts","localStorage","sessionStorage","indexedDB","crypto","navigator","location","history","process","require","module","exports","__dirname","__filename"],o=[...Object.keys(s),...i],m=[...Object.values(s),...i.map(()=>{})],x=`"use strict";
${d}`;return new Function(...o,x)(...m),{signal:a(),config:r(),logs:l(),error:null}}catch(i){return{signal:null,config:r(),logs:[...l(),`‚ùå Error: ${i.message}`],error:i.message}}}function it(d){if(!d||!d.trim())return{valid:!1,error:"El script est√° vac√≠o"};try{const t=[/\beval\s*\(/,/\bFunction\s*\(/,/\bimport\s*\(/,/\brequire\s*\(/,/\bfetch\s*\(/,/\bXMLHttpRequest\b/,/\bWebSocket\b/,/\bwindow\b/,/\bdocument\b/,/\bprocess\b/,/\b__proto__\b/,/\bconstructor\s*\[/,/\bprototype\b/];for(const s of t)if(s.test(d))return{valid:!1,error:`C√≥digo no permitido: ${s.source}`};return new Function(d),{valid:!0,error:null}}catch(t){return{valid:!1,error:`Error de sintaxis: ${t.message}`}}}function As(d,t,s={}){var f,y;const{initialBalance:a=1e3,riskPercent:r=2}=s;let l=a,i=null;const o=[],m=[a],x=[],g=50;if(t.length<g)return{trades:[],equityCurve:[a],finalBalance:a,logs:["Se necesitan al menos 50 velas"]};for(let h=g;h<t.length;h++){const j=t.slice(0,h+1),C=j[j.length-1].close,k=Ct(d,j);if(k.error){x.push(`Bar ${h}: ${k.error}`);continue}const N=((f=k.config)==null?void 0:f.stopLoss)||2,w=((y=k.config)==null?void 0:y.takeProfit)||4;if(i){const P=i.side==="buy"?(C-i.entryPrice)/i.entryPrice*100:(i.entryPrice-C)/i.entryPrice*100;if(P<=-N||P>=w){const A=i.quantity*(C-i.entryPrice)*(i.side==="buy"?1:-1);l+=A,o.push({...i,exitPrice:C,exitBar:h,pnl:A,pnlPercent:P,reason:P>=w?"Take Profit":"Stop Loss"}),i=null}}if(k.signal){if(k.signal.type==="buy"&&!i){const P=l*(r/100)/C;i={side:"buy",entryPrice:C,quantity:P,entryBar:h}}else if(k.signal.type==="sell"&&(i==null?void 0:i.side)==="buy"){const P=i.quantity*(C-i.entryPrice);l+=P;const A=(C-i.entryPrice)/i.entryPrice*100;o.push({...i,exitPrice:C,exitBar:h,pnl:P,pnlPercent:A,reason:"Signal"}),i=null}else if(k.signal.type==="sell"&&!i){const P=l*(r/100)/C;i={side:"sell",entryPrice:C,quantity:P,entryBar:h}}else if(k.signal.type==="buy"&&(i==null?void 0:i.side)==="sell"){const P=i.quantity*(i.entryPrice-C);l+=P;const A=(i.entryPrice-C)/i.entryPrice*100;o.push({...i,exitPrice:C,exitBar:h,pnl:P,pnlPercent:A,reason:"Signal"}),i=null}}const B=i?i.quantity*(i.side==="buy"?C-i.entryPrice:i.entryPrice-C):0;m.push(l+B)}if(i){const h=t[t.length-1].close,j=i.quantity*(i.side==="buy"?h-i.entryPrice:i.entryPrice-h);l+=j,o.push({...i,exitPrice:h,exitBar:t.length-1,pnl:j,pnlPercent:j/i.entryPrice/i.quantity*100,reason:"End of Data"})}const u=o.filter(h=>h.pnl>0).length,n=o.filter(h=>h.pnl<=0).length,b=o.reduce((h,j)=>h+j.pnl,0),c=Ts(m);return{trades:o,equityCurve:m,finalBalance:l,totalTrades:o.length,wins:u,losses:n,winRate:o.length>0?u/o.length*100:0,totalPnl:b,maxDrawdown:c,profitFactor:n>0?o.filter(h=>h.pnl>0).reduce((h,j)=>h+j.pnl,0)/Math.abs(o.filter(h=>h.pnl<=0).reduce((h,j)=>h+j.pnl,0)||1):u>0?1/0:0,logs:x}}function Ts(d){let t=d[0],s=0;for(const a of d){a>t&&(t=a);const r=(t-a)/t*100;r>s&&(s=r)}return s}const Oe=[{id:"ema_cross",name:"EMA Crossover",description:"Compra cuando EMA r√°pida cruza arriba de EMA lenta, vende al cruce inverso",difficulty:"Principiante",code:`// EMA Crossover Strategy
// Se√±al de compra: EMA r√°pida cruza arriba de EMA lenta
// Se√±al de venta: EMA r√°pida cruza abajo de EMA lenta

const fast = ema(12);
const slow = ema(26);

if (crossover(fast, slow)) {
  buy();
}

if (crossunder(fast, slow)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 4 });`},{id:"rsi_reversal",name:"RSI Reversal",description:"Compra en sobreventa (RSI < 30), vende en sobrecompra (RSI > 70)",difficulty:"Principiante",code:`// RSI Reversal Strategy
// Compra cuando RSI est√° sobrevendido
// Vende cuando RSI est√° sobrecomprado

const rsiVal = rsi(14);

if (rsiVal < 30) {
  buy();
}

if (rsiVal > 70) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"macd_momentum",name:"MACD Momentum",description:"Opera el cruce de la l√≠nea MACD con su se√±al",difficulty:"Intermedio",code:`// MACD Momentum Strategy
// Se√±al de compra: l√≠nea MACD cruza arriba de se√±al
// Se√±al de venta: l√≠nea MACD cruza abajo de se√±al

const m = macd(12, 26, 9);

if (crossover(m.line, m.signal)) {
  buy();
}

if (crossunder(m.line, m.signal)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 5 });`},{id:"bb_squeeze",name:"Bollinger Bands Squeeze",description:"Compra cuando el precio toca la banda inferior, vende en la superior",difficulty:"Intermedio",code:`// Bollinger Bands Bounce Strategy
// Compra en banda inferior, vende en banda superior

const bands = bb(20, 2);
const rsiVal = rsi(14);

// Comprar cerca de banda inferior con RSI sobrevendido
if (close < bands.lower && rsiVal < 35) {
  buy();
}

// Vender cerca de banda superior con RSI sobrecomprado
if (close > bands.upper && rsiVal > 65) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"triple_confirmation",name:"Triple Confirmaci√≥n",description:"EMA + RSI + MACD confirman la se√±al de entrada ‚Äî alta probabilidad",difficulty:"Avanzado",code:`// Triple Confirmation Strategy
// Requiere 3 indicadores para confirmar entrada
// Alta probabilidad, menos trades pero m√°s precisos

const ema20 = ema(20);
const ema50 = ema(50);
const rsiVal = rsi(14);
const m = macd(12, 26, 9);

// COMPRA: EMA cruce alcista + RSI < 45 + MACD positivo
if (crossover(ema20, ema50) && rsiVal < 45 && m.histogram > 0) {
  buy();
  log("Triple confirmaci√≥n alcista");
}

// VENTA: EMA cruce bajista + RSI > 55 + MACD negativo
if (crossunder(ema20, ema50) && rsiVal > 55 && m.histogram < 0) {
  sell();
  log("Triple confirmaci√≥n bajista");
}

config({ stopLoss: 2.5, takeProfit: 6 });`},{id:"vwap_scalper",name:"VWAP Scalper",description:"Scalping basado en VWAP con EMA como filtro de tendencia",difficulty:"Avanzado",code:`// VWAP Scalper Strategy
// Compra cuando precio cruza arriba de VWAP con tendencia alcista
// Scalping r√°pido con stops ajustados

const v = vwap();
const trend = ema(50);
const momentum = rsi(10);

// Tendencia alcista + precio cruza VWAP hacia arriba
if (crossover(close, v) && close > trend && momentum > 50) {
  buy();
  log("Long VWAP bounce en tendencia alcista");
}

// Tendencia bajista + precio cruza VWAP hacia abajo
if (crossunder(close, v) && close < trend && momentum < 50) {
  sell();
  log("Short VWAP rejection en tendencia bajista");
}

config({ stopLoss: 0.8, takeProfit: 1.5 });`},{id:"custom_blank",name:"Script Vac√≠o",description:"Empieza desde cero ‚Äî escribe tu propia estrategia",difficulty:"Cualquiera",code:`// Mi Estrategia Personalizada
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Funciones disponibles:
//   ema(periodo), sma(periodo), rsi(periodo)
//   macd(fast, slow, signal), bb(periodo, stdDev), vwap()
//   crossover(a, b), crossunder(a, b)
//   highest(indicador, periodo), lowest(indicador, periodo)
//   avg(indicador, periodo), change(indicador, periodos)
//   percentChange(indicador, periodos)
//
// Variables: close, open, high, low, volume, price
// Acciones: buy(), sell(), config({ stopLoss, takeProfit })
//           log("mensaje"), alert("alerta")
//
// Tip: P√≠dele a ChatGPT que te genere una estrategia
//      usando estas funciones!

// Escribe tu estrategia aqu√≠:


config({ stopLoss: 2, takeProfit: 4 });`}],He=`Eres un experto creando estrategias de trading para Kairos Script. Genera c√≥digo usando SOLO estas funciones:

INDICADORES (retornan valores num√©ricos):
- ema(periodo) ‚Äî Media M√≥vil Exponencial
- sma(periodo) ‚Äî Media M√≥vil Simple
- rsi(periodo) ‚Äî √çndice de Fuerza Relativa (0-100)
- macd(fast, slow, signal) ‚Äî retorna { line, signal, histogram }
- bb(periodo, stdDev) ‚Äî retorna { upper, middle, lower }
- vwap() ‚Äî Volume Weighted Average Price

DATOS:
- close, open, high, low, volume ‚Äî valores actuales
- price ‚Äî precio actual (n√∫mero)

DETECCI√ìN DE CRUCES:
- crossover(a, b) ‚Äî true si A cruza arriba de B
- crossunder(a, b) ‚Äî true si A cruza abajo de B

UTILIDADES:
- highest(indicador, periodo) ‚Äî valor m√°s alto en N per√≠odos
- lowest(indicador, periodo) ‚Äî valor m√°s bajo en N per√≠odos
- avg(indicador, periodo) ‚Äî promedio en N per√≠odos
- change(indicador, periodos) ‚Äî cambio absoluto
- percentChange(indicador, periodos) ‚Äî cambio porcentual

ACCIONES:
- buy() ‚Äî se√±al de compra
- sell() ‚Äî se√±al de venta
- config({ stopLoss: %, takeProfit: % }) ‚Äî configurar SL/TP
- log("mensaje") ‚Äî registrar mensaje

REGLAS:
1. NO uses window, document, fetch, eval, require, import
2. Solo JavaScript simple (if/else, const/let, operadores)
3. El c√≥digo se ejecuta en cada vela nueva
4. Siempre incluye config() con stopLoss y takeProfit
5. Las comparaciones con indicadores funcionan directamente (ej: rsi(14) < 30)

Genera SOLO el c√≥digo, sin explicaciones fuera del c√≥digo. Usa comentarios en espa√±ol.`;class $s{constructor(){this.activeBots=new Map,this.intervals=new Map}async startBot(t,s,a){if(this.activeBots.has(t.id))return;a==null||a(`ü§ñ Bot "${t.name}" iniciado en ${t.pair}`),this.activeBots.set(t.id,{bot:t,running:!0});const r=this._getCheckInterval(t.timeframe),l=async()=>{var o;if((o=this.activeBots.get(t.id))!=null&&o.running)try{const m=await W.getCandles(t.pair,t.timeframe,100),x=m.map(n=>n.close),g=x[x.length-1],u=this._evaluateStrategy(t.strategy,m,x);if(u){a==null||a(`üìä Se√±al detectada: ${u.type.toUpperCase()} a $${g}`);const n=this._calculatePositionSize(t,g),b={symbol:t.pair,side:u.type,type:"market",quantity:n,price:g,stopLoss:u.type==="buy"?g*(1-parseFloat(t.strategy.stopLoss)/100):g*(1+parseFloat(t.strategy.stopLoss)/100),takeProfit:u.type==="buy"?g*(1+parseFloat(t.strategy.takeProfit)/100):g*(1-parseFloat(t.strategy.takeProfit)/100)};s==null||s(b),a==null||a(`‚úÖ Orden ejecutada: ${u.type.toUpperCase()} ${n} ${t.pair} @ $${g}`)}}catch(m){a==null||a(`‚ùå Error: ${m.message}`)}};await l();const i=setInterval(l,r);this.intervals.set(t.id,i)}stopBot(t){const s=this.activeBots.get(t);s&&(s.running=!1,this.activeBots.delete(t));const a=this.intervals.get(t);a&&(clearInterval(a),this.intervals.delete(t))}_evaluateStrategy(t,s,a){var i,o,m,x,g,u,n,b,c,f,y,h;if((t==null?void 0:t.type)==="custom_script"&&(t!=null&&t.code)){const j=Ct(t.code,s);return j.error?(console.warn("[KairosScript] Error:",j.error),null):j.signal}if(!((i=t==null?void 0:t.entry)!=null&&i.indicator))return null;const r=a.length,l=t.entry.indicator;switch(l){case"ema_cross":case"ema_cross_rsi":{const j=((o=t.entry.params)==null?void 0:o.fastEma)||((m=t.entry.params)==null?void 0:m.fast)||20,C=((x=t.entry.params)==null?void 0:x.slowEma)||((g=t.entry.params)==null?void 0:g.slow)||50,k=Z(a,j),N=Z(a,C),w=be(k,N,r-1);if(l==="ema_cross_rsi"){const B=((u=t.entry.params)==null?void 0:u.rsiPeriod)||14,A=de(a,B)[r-1],M=((n=t.entry.params)==null?void 0:n.rsiOversold)||30,z=((c=(b=t.exit)==null?void 0:b.params)==null?void 0:c.rsiOverbought)||70;if(w==="bullish_cross"&&A<M)return{type:"buy"};if(w==="bearish_cross"&&A>z)return{type:"sell"};if(A>z)return{type:"sell"};if(A<M)return{type:"buy"}}else{if(w==="bullish_cross")return{type:"buy"};if(w==="bearish_cross")return{type:"sell"}}break}case"rsi":{const j=((f=t.entry.params)==null?void 0:f.period)||14,k=de(a,j)[r-1];if(k<(((y=t.entry.params)==null?void 0:y.oversold)||30))return{type:"buy"};if(k>(((h=t.entry.params)==null?void 0:h.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:j,signal:C}=Be(a),k=be(j,C,r-1);if(k==="bullish_cross")return{type:"buy"};if(k==="bearish_cross")return{type:"sell"};break}default:return null}return null}_calculatePositionSize(t,s){const a=t.balance||1e3,r=parseFloat(t.riskPercent||2)/100,l=a*r/s;return Math.round(l*1e8)/1e8}_getCheckInterval(t){return{"1m":6e4,"5m":3e5,"15m":9e5,"1h":3e5,"4h":9e5,"1d":36e5}[t]||3e5}getActiveBotCount(){return this.activeBots.size}}const nt=new $s;class Is{constructor(){this.activeBots=new Map}start(t){if(this.activeBots.has(t.id))return;const{pair:s,upperPrice:a,lowerPrice:r,gridLines:l,investment:i,onLog:o,onTrade:m}=t,x=(a-r)/(l-1),g=[];for(let b=0;b<l;b++)g.push(+(r+x*b).toFixed(2));const u=i/(l-1),n={id:t.id,pair:s,levels:g,priceStep:x,investmentPerGrid:u,activeOrders:new Map,filledBuys:[],totalProfit:0,trades:0,running:!0,lastPrice:null};this.activeBots.set(t.id,n),o==null||o(`üìä Grid Bot started: ${l} levels from $${r} to $${a}`),o==null||o(`üí∞ Investment per grid: $${u.toFixed(2)}`),this._startMonitor(n,o,m)}async _startMonitor(t,s,a){const r=async()=>{if(t.running)try{const o=(await W.get24hrTicker(t.pair)).price,m=t.lastPrice;if(t.lastPrice=o,!m){s==null||s(`üìà Current price: $${o.toFixed(2)}`);for(const g of t.levels)g<o?t.activeOrders.set(g,{side:"buy",price:g,status:"pending"}):g>o;const x=t.activeOrders.size;s==null||s(`üü¢ ${x} buy orders placed below current price`);return}for(const x of t.levels){const g=t.activeOrders.get(x);if((g==null?void 0:g.side)==="buy"&&g.status==="pending"&&o<=x){const u=t.investmentPerGrid/x;g.status="filled",t.filledBuys.push(x),t.trades++,a==null||a({symbol:t.pair,side:"buy",type:"grid",quantity:+u.toFixed(6),price:x,gridLevel:x}),s==null||s(`‚úÖ BUY filled at $${x} (qty: ${u.toFixed(6)})`);const n=x+t.priceStep;n<=t.levels[t.levels.length-1]&&(t.activeOrders.set(n,{side:"sell",price:n,status:"pending",buyLevel:x,quantity:u}),s==null||s(`üì§ SELL order placed at $${n.toFixed(2)}`))}if((g==null?void 0:g.side)==="sell"&&g.status==="pending"&&o>=x){g.status="filled";const u=(x-g.buyLevel)*g.quantity;t.totalProfit+=u,t.trades++,a==null||a({symbol:t.pair,side:"sell",type:"grid",quantity:+g.quantity.toFixed(6),price:x,profit:+u.toFixed(2),gridLevel:x}),s==null||s(`‚úÖ SELL filled at $${x.toFixed(2)} ‚Äî Profit: +$${u.toFixed(2)}`);const n=x-t.priceStep;n>=t.levels[0]&&(t.activeOrders.set(n,{side:"buy",price:n,status:"pending"}),s==null||s(`üì• BUY order re-placed at $${n.toFixed(2)}`))}}}catch(i){s==null||s(`‚ùå Error: ${i.message}`)}};await r();const l=setInterval(r,1e4);t._interval=l}stop(t){const s=this.activeBots.get(t);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(t))}getStats(t){const s=this.activeBots.get(t);return s?{levels:s.levels.length,activeOrders:[...s.activeOrders.values()].filter(a=>a.status==="pending").length,filledBuys:s.filledBuys.length,totalProfit:s.totalProfit,trades:s.trades,lastPrice:s.lastPrice}:null}isRunning(t){return this.activeBots.has(t)}}const ot=new Is;class Es{constructor(){this.activeBots=new Map}start(t){if(this.activeBots.has(t.id))return;const{pair:s,investmentPerOrder:a,intervalMinutes:r,maxOrders:l=100,useRsiFilter:i=!1,rsiPeriod:o=14,rsiThreshold:m=40,usePriceDipFilter:x=!1,dipPercent:g=3,onLog:u,onTrade:n}=t,b={id:t.id,pair:s,investmentPerOrder:a,intervalMinutes:r,maxOrders:l,useRsiFilter:i,rsiPeriod:o,rsiThreshold:m,usePriceDipFilter:x,dipPercent:g,executedOrders:0,totalInvested:0,totalQuantity:0,avgPrice:0,prices:[],running:!0,lastBuyPrice:null,startTime:Date.now()};this.activeBots.set(t.id,b),u==null||u(`üìä DCA Bot started: $${a} every ${r}min on ${s}`),i&&(u==null||u(`üìâ RSI filter enabled: buy when RSI < ${m}`)),x&&(u==null||u(`üìâ Dip filter enabled: buy when price drops ${g}%`)),this._startMonitor(b,u,n)}async _startMonitor(t,s,a){const r=async()=>{if(t.running){if(t.executedOrders>=t.maxOrders){s==null||s(`üèÅ Max orders reached (${t.maxOrders}). DCA Bot stopped.`),this.stop(t.id);return}try{const o=(await W.get24hrTicker(t.pair)).price;if(t.useRsiFilter)try{const g=(await W.getCandles(t.pair,"1h",100)).map(b=>b.close),u=de(g,t.rsiPeriod),n=u[u.length-1];if(n>t.rsiThreshold){s==null||s(`‚è∏Ô∏è RSI ${n.toFixed(1)} > ${t.rsiThreshold} ‚Äî skipping buy`);return}s==null||s(`üìâ RSI ${n.toFixed(1)} < ${t.rsiThreshold} ‚Äî proceeding with buy`)}catch(x){s==null||s(`‚ö†Ô∏è RSI check failed, proceeding anyway: ${x.message}`)}if(t.usePriceDipFilter&&t.lastBuyPrice){const x=(t.lastBuyPrice-o)/t.lastBuyPrice*100;if(x<t.dipPercent){s==null||s(`‚è∏Ô∏è Price drop ${x.toFixed(2)}% < ${t.dipPercent}% ‚Äî skipping buy`);return}s==null||s(`üìâ Price dropped ${x.toFixed(2)}% ‚Äî proceeding with buy`)}const m=t.investmentPerOrder/o;t.executedOrders++,t.totalInvested+=t.investmentPerOrder,t.totalQuantity+=m,t.avgPrice=t.totalInvested/t.totalQuantity,t.lastBuyPrice=o,t.prices.push(o),a==null||a({symbol:t.pair,side:"buy",type:"dca",quantity:+m.toFixed(8),price:o,dcaOrder:t.executedOrders,avgPrice:+t.avgPrice.toFixed(2)}),s==null||s(`‚úÖ DCA Buy #${t.executedOrders}: ${m.toFixed(6)} ${t.pair.replace("USDT","")} @ $${o.toFixed(2)}`),s==null||s(`üìä Avg price: $${t.avgPrice.toFixed(2)} | Total invested: $${t.totalInvested.toFixed(2)}`)}catch(i){s==null||s(`‚ùå Error: ${i.message}`)}}};await r();const l=setInterval(r,t.intervalMinutes*60*1e3);t._interval=l}stop(t){const s=this.activeBots.get(t);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(t))}getStats(t){const s=this.activeBots.get(t);if(!s)return null;const r=s.totalQuantity*(s.lastBuyPrice||0)-s.totalInvested;return{executedOrders:s.executedOrders,maxOrders:s.maxOrders,totalInvested:s.totalInvested,totalQuantity:s.totalQuantity,avgPrice:s.avgPrice,currentPrice:s.lastBuyPrice,unrealizedPnl:r,unrealizedPnlPercent:s.totalInvested>0?r/s.totalInvested*100:0,runningTime:Date.now()-s.startTime}}isRunning(t){return this.activeBots.has(t)}}const lt=new Es;function Fs(d){if(!d)return"";let t=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t=t.replace(/(\/\/.*$)/gm,'<span class="ks-comment">$1</span>'),t=t.replace(/("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'|`(?:[^`\\]|\\.)*`)/g,'<span class="ks-string">$1</span>'),t=t.replace(/\b(\d+\.?\d*)\b/g,'<span class="ks-number">$1</span>'),t=t.replace(/\b(const|let|var|if|else|return|true|false|null|undefined)\b/g,'<span class="ks-keyword">$1</span>'),t=t.replace(/\b(ema|sma|rsi|macd|bb|vwap|crossover|crossunder|highest|lowest|avg|change|percentChange)\b/g,'<span class="ks-function">$1</span>'),t=t.replace(/\b(buy|sell|config|log|alert)\b/g,'<span class="ks-action">$1</span>'),t=t.replace(/\b(close|open|high|low|volume|price|barIndex)\b/g,'<span class="ks-data">$1</span>'),t=t.replace(/\.(line|signal|histogram|upper|middle|lower|stopLoss|takeProfit)\b/g,'.<span class="ks-property">$1</span>'),t}function Bs({code:d,onChange:t,error:s,readOnly:a=!1}){const r=S.useRef(null),l=S.useRef(null),i=S.useRef(null),m=(d||"").split(`
`).length,x=S.useCallback(()=>{r.current&&l.current&&i.current&&(l.current.scrollTop=r.current.scrollTop,l.current.scrollLeft=r.current.scrollLeft,i.current.scrollTop=r.current.scrollTop)},[]),g=u=>{if(a)return;if(u.key==="Tab"){u.preventDefault();const b=u.target.selectionStart,c=u.target.selectionEnd,f=d.substring(0,b)+"  "+d.substring(c);t(f),setTimeout(()=>{u.target.selectionStart=u.target.selectionEnd=b+2},0)}const n={"(":")","[":"]","{":"}",'"':'"',"'":"'"};if(n[u.key]){u.preventDefault();const b=u.target.selectionStart,c=u.target.selectionEnd,f=d.substring(b,c),y=d.substring(0,b)+u.key+f+n[u.key]+d.substring(c);t(y),setTimeout(()=>{u.target.selectionStart=b+1,u.target.selectionEnd=b+1+f.length},0)}};return e.jsxs("div",{className:"relative rounded-xl overflow-hidden border",style:{background:"#0a0c10",borderColor:s?"var(--red)":"var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-[10px] font-bold tracking-wider uppercase",style:{background:"rgba(59,130,246,0.05)",borderBottom:"1px solid var(--border)",color:"var(--text-dim)"},children:[e.jsx(Lt,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{children:"Kairos Script"}),s&&e.jsxs("span",{className:"ml-auto text-[var(--red)] normal-case tracking-normal flex items-center gap-1",children:[e.jsx(Nt,{size:10})," ",s]})]}),e.jsxs("div",{className:"flex",style:{height:320},children:[e.jsx("div",{ref:i,className:"select-none text-right pr-3 pl-3 pt-3 overflow-hidden shrink-0 font-mono text-xs leading-[1.65]",style:{color:"var(--text-dim)",background:"rgba(255,255,255,0.02)",width:48},children:Array.from({length:m},(u,n)=>e.jsx("div",{children:n+1},n))}),e.jsxs("div",{className:"relative flex-1 overflow-hidden",children:[e.jsx("pre",{ref:l,className:"absolute inset-0 p-3 font-mono text-xs leading-[1.65] overflow-auto pointer-events-none whitespace-pre-wrap break-words",style:{color:"var(--text)"},dangerouslySetInnerHTML:{__html:Fs(d)}}),e.jsx("textarea",{ref:r,value:d,onChange:u=>t(u.target.value),onScroll:x,onKeyDown:g,readOnly:a,spellCheck:!1,className:"absolute inset-0 w-full h-full p-3 font-mono text-xs leading-[1.65] resize-none outline-none bg-transparent caret-[var(--gold)]",style:{color:"transparent",caretColor:"var(--gold)",WebkitTextFillColor:"transparent"},placeholder:"// Escribe o pega tu estrategia aqu√≠..."})]})]})]})}function Rs({results:d,onClose:t}){if(!d)return null;const{trades:s,equityCurve:a,finalBalance:r,totalTrades:l,wins:i,losses:o,winRate:m,totalPnl:x,maxDrawdown:g,profitFactor:u}=d,n=x>=0;return e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Balance Final",value:`$${r.toFixed(2)}`,icon:oe,color:n?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${m.toFixed(1)}%`,icon:qt,color:m>=50?"var(--green)":"var(--red)"},{label:"Max Drawdown",value:`${g.toFixed(1)}%`,icon:vt,color:g<10?"var(--green)":"var(--red)"},{label:"Profit Factor",value:u===1/0?"‚àû":u.toFixed(2),icon:Se,color:u>=1.5?"var(--green)":"var(--red)"}].map((b,c)=>e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(b.icon,{size:14,className:"mx-auto mb-1",style:{color:b.color}}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:b.label}),e.jsx("p",{className:"text-sm font-bold",style:{color:b.color},children:b.value})]},c))}),e.jsxs("div",{className:"flex items-center gap-4 text-xs px-3 py-2 rounded-lg",style:{background:"var(--surface-2)"},children:[e.jsxs("span",{className:"text-[var(--text-dim)]",children:["Total trades: ",e.jsx("b",{className:"text-[var(--text)]",children:l})]}),e.jsxs("span",{className:"text-[var(--green)]",children:["Ganados: ",e.jsx("b",{children:i})]}),e.jsxs("span",{className:"text-[var(--red)]",children:["Perdidos: ",e.jsx("b",{children:o})]}),e.jsxs("span",{className:"ml-auto font-bold",style:{color:n?"var(--green)":"var(--red)"},children:[n?"+":"","$",x.toFixed(2)]})]}),e.jsx(Ds,{data:a}),s.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto rounded-lg",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px]",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("th",{className:"text-left p-2",children:"Tipo"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"}),e.jsx("th",{className:"text-right p-2",children:"Raz√≥n"})]})}),e.jsx("tbody",{children:s.slice(-10).reverse().map((b,c)=>{var f,y,h;return e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{className:`p-2 font-bold ${b.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:b.side==="buy"?"LONG":"SHORT"}),e.jsxs("td",{className:"p-2 text-right text-[var(--text)]",children:["$",(f=b.entryPrice)==null?void 0:f.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right text-[var(--text)]",children:["$",(y=b.exitPrice)==null?void 0:y.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-bold ${b.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[b.pnl>=0?"+":"","$",(h=b.pnl)==null?void 0:h.toFixed(2)]}),e.jsx("td",{className:"p-2 text-right text-[var(--text-dim)]",children:b.reason})]},c)})})]})})]})}function Ds({data:d}){const t=S.useRef(null);return S.useEffect(()=>{const s=t.current;if(!s||!d||d.length<2)return;const a=s.getContext("2d");s.width=s.offsetWidth*2,s.height=s.offsetHeight*2,a.scale(2,2);const r=s.offsetWidth,l=s.offsetHeight;a.clearRect(0,0,r,l);const i=Math.min(...d),m=Math.max(...d)-i||1,x=a.createLinearGradient(0,0,0,l),g=d[d.length-1]>=d[0];x.addColorStop(0,g?"rgba(0,220,130,0.2)":"rgba(255,71,87,0.2)"),x.addColorStop(1,"transparent"),a.beginPath(),d.forEach((u,n)=>{const b=n/(d.length-1)*r,c=l-(u-i)/m*(l-8)-4;n===0?a.moveTo(b,c):a.lineTo(b,c)}),a.strokeStyle=g?"#00DC82":"#FF4757",a.lineWidth=1.5,a.stroke(),a.lineTo(r,l),a.lineTo(0,l),a.closePath(),a.fillStyle=x,a.fill()},[d]),e.jsxs("div",{className:"rounded-lg overflow-hidden",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"px-3 py-1.5 flex items-center justify-between",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-bold uppercase tracking-wider",children:"Equity Curve"}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[(d==null?void 0:d.length)||0," bars"]})]}),e.jsx("canvas",{ref:t,className:"w-full",style:{height:80}})]})}function At({onSave:d,onClose:t,initialCode:s,initialName:a,editMode:r=!1}){const[l,i]=S.useState(a||""),[o,m]=S.useState(s||Oe[Oe.length-1].code),[x,g]=S.useState(null),[u,n]=S.useState(!1),[b,c]=S.useState(!1),[f,y]=S.useState(!1),[h,j]=S.useState(null),[C,k]=S.useState(!1),[N,w]=S.useState("BTCUSDT"),[B,P]=S.useState("1h"),[A,M]=S.useState(!1);S.useEffect(()=>{const v=setTimeout(()=>{if(o!=null&&o.trim()){const $=it(o);g($.valid?null:$.error)}else g(null)},500);return()=>clearTimeout(v)},[o]);const z=async()=>{k(!0),j(null);try{const v=await W.getCandles(N,B,500);if(!v||v.length<50){g("No hay suficientes datos para el backtest"),k(!1);return}const $=As(o,v,{initialBalance:1e3,riskPercent:2});j($)}catch(v){g(`Error en backtest: ${v.message}`)}k(!1)},p=()=>{if(!l.trim()){g("Dale un nombre a tu estrategia");return}const v=it(o);if(!v.valid){g(v.error);return}d==null||d({name:l.trim(),code:o,type:"custom_script"}),M(!0),setTimeout(()=>M(!1),2e3)},T=v=>{m(v.code),l||i(v.name),n(!1),j(null)},I=()=>{var v;(v=navigator.clipboard)==null||v.writeText(He),y(!1)},R=async()=>{var v;try{const $=await((v=navigator.clipboard)==null?void 0:v.readText());$&&(m($),j(null))}catch{}};return e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)"},children:e.jsx(ae,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold",children:r?"Editar Estrategia":"Nueva Estrategia Custom"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Escribe c√≥digo o pega desde ChatGPT"})]})]}),t&&e.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-[var(--surface-2)] transition-colors",children:e.jsx(ft,{size:16,className:"text-[var(--text-dim)]"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:l,onChange:v=>i(v.target.value),placeholder:"Mi Estrategia EMA Cross",className:"w-full px-3 py-2 rounded-lg text-sm",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"}})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>n(!u),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(yt,{size:13})," Templates"]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(_t,{size:13})," Pegar"]}),e.jsxs("button",{onClick:()=>{var v;return(v=navigator.clipboard)==null?void 0:v.writeText(o)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(Ie,{size:13})," Copiar"]}),e.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)",color:"var(--gold)"},children:[e.jsx(he,{size:13})," Prompt ChatGPT"]}),e.jsxs("button",{onClick:()=>c(!b),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text-dim)"},children:[e.jsx(Ot,{size:13})," Ayuda"]})]}),e.jsx(Q,{children:u&&e.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 rounded-xl",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:Oe.map(v=>e.jsxs("button",{onClick:()=>T(v),className:"text-left p-3 rounded-lg transition-colors hover:bg-[var(--dark-3)]",style:{border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ee,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--text)]",children:v.name})]}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:v.description}),e.jsx("span",{className:"text-[9px] mt-1.5 inline-block px-1.5 py-0.5 rounded-md font-bold uppercase",style:{color:v.difficulty==="Principiante"?"var(--green)":v.difficulty==="Intermedio"?"var(--gold)":"#A855F7",background:v.difficulty==="Principiante"?"rgba(0,220,130,0.1)":v.difficulty==="Intermedio"?"rgba(59,130,246,0.1)":"rgba(168,85,247,0.1)"},children:v.difficulty})]},v.id))})})}),e.jsx(Q,{children:f&&e.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 rounded-xl space-y-3",style:{background:"rgba(59,130,246,0.05)",border:"1px solid rgba(59,130,246,0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Genera estrategias con ChatGPT"})]}),e.jsx("p",{className:"text-[11px] text-[var(--text-secondary)] leading-relaxed",children:"1. Copia este prompt ‚Üí 2. P√©galo en ChatGPT ‚Üí 3. Dile qu√© estrategia quieres ‚Üí 4. Copia el c√≥digo que te d√© ‚Üí 5. P√©galo aqu√≠"}),e.jsxs("div",{className:"p-2 rounded-lg font-mono text-[10px] max-h-24 overflow-y-auto",style:{background:"var(--surface-2)",color:"var(--text-dim)",border:"1px solid var(--border)"},children:[He.slice(0,200),"..."]}),e.jsxs("button",{onClick:I,className:"w-full py-2 btn-gold rounded-lg text-xs font-bold flex items-center justify-center gap-2",children:[e.jsx(Ie,{size:12})," Copiar Prompt Completo"]})]})})}),e.jsx(Q,{children:b&&e.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 rounded-xl space-y-3 max-h-48 overflow-y-auto",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("h4",{className:"text-xs font-bold text-[var(--gold)]",children:"Funciones Disponibles"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-[10px] font-mono",children:[["ema(periodo)","Media M√≥vil Exponencial"],["sma(periodo)","Media M√≥vil Simple"],["rsi(periodo)","Fuerza Relativa (0-100)"],["macd(f, s, sig)","MACD ‚Üí .line .signal .histogram"],["bb(periodo, std)","Bollinger ‚Üí .upper .middle .lower"],["vwap()","Precio Promedio por Volumen"],["crossover(a, b)","A cruza arriba de B"],["crossunder(a, b)","A cruza abajo de B"],["highest(ind, n)","M√°ximo en N per√≠odos"],["lowest(ind, n)","M√≠nimo en N per√≠odos"],["buy()","Se√±al de compra"],["sell()","Se√±al de venta"],["config({...})","stopLoss, takeProfit (%)"],['log("msg")',"Registrar mensaje"]].map(([v,$])=>e.jsxs("div",{className:"flex items-baseline gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--gold)] shrink-0",children:v}),e.jsx("span",{className:"text-[var(--text-dim)]",children:$})]},v))}),e.jsx("h4",{className:"text-xs font-bold text-[var(--gold)] pt-2",children:"Variables"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] font-mono",children:"close, open, high, low, volume, price, barIndex"})]})})}),e.jsx(Bs,{code:o,onChange:v=>{m(v),j(null)},error:x}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:N,onChange:v=>w(v.target.value),className:"px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","ADAUSDT","DOGEUSDT","XRPUSDT"].map(v=>e.jsx("option",{value:v,children:v},v))}),e.jsx("select",{value:B,onChange:v=>P(v.target.value),className:"px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:["1m","5m","15m","1h","4h","1d"].map(v=>e.jsx("option",{value:v,children:v},v))}),e.jsxs("button",{onClick:z,disabled:C||!!x,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg text-xs font-bold transition-colors disabled:opacity-40",style:{background:"rgba(0,220,130,0.1)",border:"1px solid rgba(0,220,130,0.2)",color:"var(--green)"},children:[C?e.jsx(jt,{size:13,className:"animate-spin"}):e.jsx(le,{size:13}),C?"Testeando...":"Backtest"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:p,disabled:!!x||!(o!=null&&o.trim()),className:"flex items-center gap-1.5 px-5 py-2 btn-gold rounded-lg text-xs font-bold disabled:opacity-40",children:[A?e.jsx(pe,{size:13}):e.jsx(zt,{size:13}),A?"Guardada!":"Guardar Estrategia"]})]}),e.jsx(Q,{children:h&&e.jsx(Rs,{results:h})})]})]})}const ze=[{id:"signal",label:"Signal Bot",icon:ee,desc:"Indicadores t√©cnicos predefinidos",color:"#3B82F6"},{id:"script",label:"Script Bot",icon:ae,desc:"Estrategia personalizada con c√≥digo",color:"#A855F7"},{id:"grid",label:"Grid Bot",icon:Kt,desc:"Compra y vende en niveles de precio",color:"#00DC82"},{id:"dca",label:"DCA Bot",icon:we,desc:"Inversi√≥n a intervalos regulares",color:"#22D3EE"}];function Ms(){const{bots:d,addBot:t,updateBot:s,removeBot:a,strategies:r,addStrategy:l,brokers:i}=H(),[o,m]=S.useState(!1),[x,g]=S.useState(!1),[u,n]=S.useState(null),[b,c]=S.useState("signal"),[f,y]=S.useState([]),[h,j]=S.useState({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10",upperPrice:"",lowerPrice:"",gridLines:"10",investmentPerOrder:"100",intervalMinutes:"60",maxOrders:"50",useRsiFilter:!1,rsiThreshold:"40",usePriceDipFilter:!1,dipPercent:"3",scriptCode:"",scriptStrategyId:""}),C=()=>{if(!h.name||!h.pair)return;const p={name:h.name,pair:h.pair,botType:b,brokerId:h.brokerId};if(b==="signal"){const T=r.find(I=>I.id===h.strategyId)||{name:"EMA Cross + RSI",entry:{condition:"EMA 20 cruza EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"};Object.assign(p,{timeframe:h.timeframe,strategy:T,balance:parseFloat(h.balance),riskPercent:parseFloat(h.riskPercent),maxTrades:parseInt(h.maxTrades)})}else if(b==="script"){const T=r.find(I=>I.id===h.scriptStrategyId);if(!(T!=null&&T.code))return;Object.assign(p,{timeframe:h.timeframe,strategy:{type:"custom_script",code:T.code,name:T.name},balance:parseFloat(h.balance),riskPercent:parseFloat(h.riskPercent),maxTrades:parseInt(h.maxTrades),scriptName:T.name})}else b==="grid"?Object.assign(p,{upperPrice:parseFloat(h.upperPrice),lowerPrice:parseFloat(h.lowerPrice),gridLines:parseInt(h.gridLines),balance:parseFloat(h.balance)}):b==="dca"&&Object.assign(p,{investmentPerOrder:parseFloat(h.investmentPerOrder),intervalMinutes:parseInt(h.intervalMinutes),maxOrders:parseInt(h.maxOrders),useRsiFilter:h.useRsiFilter,rsiThreshold:parseInt(h.rsiThreshold),usePriceDipFilter:h.usePriceDipFilter,dipPercent:parseFloat(h.dipPercent),balance:parseFloat(h.investmentPerOrder)*parseInt(h.maxOrders)});t(p),m(!1)},k=(p,T)=>{y(I=>[...I.slice(-100),{type:"log",bot:p.name,message:T,time:new Date().toLocaleTimeString()}])},N=(p,T)=>{y(R=>[...R.slice(-100),{type:"trade",bot:p.name,...T,time:new Date().toLocaleTimeString()}]);const I=H.getState().bots.find(R=>R.id===p.id);if(I){const R=(I.trades||0)+1,v=(I.pnl||0)+(T.profit||0);s(p.id,{trades:R,pnl:v})}},w=async p=>{s(p.id,{status:"active"});const T=p.botType||"signal";T==="signal"||T==="script"?nt.startBot({...p,status:"active"},I=>N(p,I),I=>k(p,I)):T==="grid"?ot.start({id:p.id,pair:p.pair,upperPrice:p.upperPrice,lowerPrice:p.lowerPrice,gridLines:p.gridLines,investment:p.balance,onLog:I=>k(p,I),onTrade:I=>N(p,I)}):T==="dca"&&lt.start({id:p.id,pair:p.pair,investmentPerOrder:p.investmentPerOrder,intervalMinutes:p.intervalMinutes,maxOrders:p.maxOrders,useRsiFilter:p.useRsiFilter,rsiThreshold:p.rsiThreshold,usePriceDipFilter:p.usePriceDipFilter,dipPercent:p.dipPercent,onLog:I=>k(p,I),onTrade:I=>N(p,I)})},B=p=>{const T=p.botType||"signal";T==="signal"||T==="script"?nt.stopBot(p.id):T==="grid"?ot.stop(p.id):T==="dca"&&lt.stop(p.id),s(p.id,{status:"stopped"})},P=p=>{B(p),s(p.id,{status:"paused"})},A=p=>{B(p),a(p.id)},M=p=>{switch(p){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},z=p=>ze.find(T=>T.id===p)||ze[0];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[d.filter(p=>p.status==="active").length," activos de ",d.length," total"]})]}),e.jsxs("button",{onClick:()=>m(!o),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(Ke,{size:16})," Crear Bot"]})]}),e.jsx(Q,{children:o&&e.jsx(_.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--text)]",children:"Nuevo Bot de Trading"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:ze.map(p=>{const T=p.icon;return e.jsxs("button",{onClick:()=>c(p.id),className:`p-3 rounded-xl text-left transition-all ${b===p.id?"ring-1":"hover:bg-[var(--surface-2)]"}`,style:{background:b===p.id?`${p.color}10`:"var(--surface-2)",borderColor:b===p.id?`${p.color}40`:"var(--border)",border:`1px solid ${b===p.id?p.color+"30":"var(--border)"}`},children:[e.jsx(T,{size:20,style:{color:p.color},className:"mb-1.5"}),e.jsx("p",{className:"text-xs font-bold",style:{color:b===p.id?p.color:"var(--text)"},children:p.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mt-0.5",children:p.desc})]},p.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:h.name,onChange:p=>j({...h,name:p.target.value}),placeholder:"Mi Bot",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Par"}),e.jsx("select",{value:h.pair,onChange:p=>j({...h,pair:p.target.value}),className:"w-full",children:St.map(p=>e.jsx("option",{value:p,children:p},p))})]})]}),b==="signal"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:h.timeframe,onChange:p=>j({...h,timeframe:p.target.value}),className:"w-full",children:Ve.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:h.balance,onChange:p=>j({...h,balance:p.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:h.riskPercent,onChange:p=>j({...h,riskPercent:p.target.value}),className:"w-full"})]})]}),b==="script"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:h.timeframe,onChange:p=>j({...h,timeframe:p.target.value}),className:"w-full",children:Ve.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:h.balance,onChange:p=>j({...h,balance:p.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:h.riskPercent,onChange:p=>j({...h,riskPercent:p.target.value}),className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Estrategia"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:h.scriptStrategyId,onChange:p=>j({...h,scriptStrategyId:p.target.value}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Seleccionar estrategia..."}),r.filter(p=>p.type==="custom_script").map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shrink-0",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(ae,{size:13})," ",r.filter(p=>p.type==="custom_script").length>0?"Crear Nueva":"Crear Estrategia"]})]})]})]}),b==="grid"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Superior ($)"}),e.jsx("input",{type:"number",value:h.upperPrice,onChange:p=>j({...h,upperPrice:p.target.value}),placeholder:"100000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Inferior ($)"}),e.jsx("input",{type:"number",value:h.lowerPrice,onChange:p=>j({...h,lowerPrice:p.target.value}),placeholder:"90000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Niveles de Grid"}),e.jsx("input",{type:"number",value:h.gridLines,onChange:p=>j({...h,gridLines:p.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Inversi√≥n Total ($)"}),e.jsx("input",{type:"number",value:h.balance,onChange:p=>j({...h,balance:p.target.value}),className:"w-full"})]})]}),b==="dca"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"$ por Compra"}),e.jsx("input",{type:"number",value:h.investmentPerOrder,onChange:p=>j({...h,investmentPerOrder:p.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Intervalo (min)"}),e.jsx("input",{type:"number",value:h.intervalMinutes,onChange:p=>j({...h,intervalMinutes:p.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"M√°x. Compras"}),e.jsx("input",{type:"number",value:h.maxOrders,onChange:p=>j({...h,maxOrders:p.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.useRsiFilter,onChange:p=>j({...h,useRsiFilter:p.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro RSI (comprar solo si RSI < ",h.rsiThreshold,")"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.usePriceDipFilter,onChange:p=>j({...h,usePriceDipFilter:p.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro de Ca√≠da (comprar cuando baje ",h.dipPercent,"%)"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm",children:"Crear Bot"}),e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2.5 bg-[var(--surface-2)] text-[var(--text-dim)] rounded-xl text-sm border border-[var(--border)]",children:"Cancelar"})]})]})})}),d.length===0?e.jsxs("div",{className:"rounded-xl p-12 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(ue,{size:48,className:"text-[var(--text-dim)]/20 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay bots creados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primer bot para automatizar tu trading"})]}):e.jsx("div",{className:"space-y-3",children:d.map(p=>{var R;const T=z(p.botType||"signal"),I=T.icon;return e.jsxs(_.div,{layout:!0,className:"rounded-xl p-4",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:`${T.color}12`,border:`1px solid ${T.color}20`},children:e.jsx(I,{size:20,style:{color:T.color}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-bold",children:p.name}),e.jsx("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded-md uppercase tracking-wider",style:{background:`${T.color}15`,color:T.color},children:T.label})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[p.pair,p.timeframe?` ‚Ä¢ ${p.timeframe}`:""]})]})]}),e.jsx("span",{className:"px-2.5 py-1 rounded-lg text-[10px] font-bold",style:{color:M(p.status),background:`${M(p.status)}15`},children:p.status==="active"?"‚óè Activo":p.status==="paused"?"‚ùö‚ùö Pausado":"‚ñ† Detenido"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Trades"}),e.jsx("p",{className:"text-sm font-bold",children:p.trades||0})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`text-sm font-bold ${(p.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(p.pnl||0)>=0?"+":"","$",(p.pnl||0).toFixed(2)]})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--gold)]",children:[(p.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold",children:["$",((R=p.balance)==null?void 0:R.toLocaleString())||"0"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[p.status!=="active"?e.jsxs("button",{onClick:()=>w(p),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/10 text-[var(--green)] rounded-lg text-xs font-bold hover:bg-[var(--green)]/20 transition-colors border border-[var(--green)]/20",children:[e.jsx(le,{size:12})," Iniciar"]}):e.jsxs("button",{onClick:()=>P(p),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--gold)]/10 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/20 transition-colors border border-[var(--gold)]/20",children:[e.jsx(Ut,{size:12})," Pausar"]}),e.jsxs("button",{onClick:()=>B(p),className:"flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Vt,{size:12})," Detener"]}),e.jsx("button",{onClick:()=>A(p),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] hover:text-[var(--red)] rounded-lg text-xs transition-colors",children:e.jsx(ge,{size:12})})]})]},p.id)})}),f.length>0&&e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-3",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),"Actividad en Vivo"]}),e.jsx("button",{onClick:()=>y([]),className:"text-xs text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:"Limpiar"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-3 space-y-1 font-mono text-[11px]",children:f.slice(-50).reverse().map((p,T)=>{var I;return e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:p.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0 font-semibold",children:["[",p.bot,"]"]}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:p.message||`${(I=p.side)==null?void 0:I.toUpperCase()} ${p.quantity} @ $${p.price}`})]},T)})})]}),r.filter(p=>p.type==="custom_script").length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(ae,{size:16,className:"text-[#A855F7]"})," Mis Estrategias"]}),e.jsxs("button",{onClick:()=>g(!0),className:"text-xs text-[var(--text-dim)] hover:text-[#A855F7] transition-colors flex items-center gap-1",children:[e.jsx(Ke,{size:12})," Nueva"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.filter(p=>p.type==="custom_script").map(p=>{var T;return e.jsxs("div",{className:"rounded-lg p-3 transition-colors hover:bg-[var(--dark-3)]",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-[var(--text)] flex items-center gap-1.5",children:[e.jsx(ae,{size:12,className:"text-[#A855F7]"})," ",p.name]}),e.jsx("button",{onClick:()=>{n(p),g(!0)},className:"text-[var(--text-dim)] hover:text-[#A855F7] transition-colors",children:e.jsx(wt,{size:12})})]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[((T=p.code)==null?void 0:T.split(`
`).filter(I=>I.trim()&&!I.trim().startsWith("//")).length)||0," l√≠neas de l√≥gica"]}),e.jsxs("p",{className:"text-[9px] text-[var(--text-dim)] mt-1",children:["Creada: ",new Date(p.createdAt).toLocaleDateString("es")]})]},p.id)})})]}),e.jsx(Q,{children:x&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{g(!1),n(null)},children:e.jsx(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:p=>p.stopPropagation(),children:e.jsx(At,{initialCode:u==null?void 0:u.code,initialName:u==null?void 0:u.name,editMode:!!u,onClose:()=>{g(!1),n(null)},onSave:p=>{const T=l(p);j(I=>({...I,scriptStrategyId:T.id})),g(!1),n(null)}})})})})]})}const ct=[{id:"binance",name:"Binance",logo:"üü°",color:"#F0B90B",desc:"El exchange m√°s grande del mundo",features:["Spot","Futuros","Margin"],users:"150M+",apiUrl:"https://www.binance.com/en/my/settings/api-management",steps:[{title:"Inicia sesi√≥n en Binance",desc:"Ve a binance.com e inicia sesi√≥n en tu cuenta."},{title:"Ve a API Management",desc:'Haz clic en tu perfil ‚Üí "API Management" o usa el enlace directo de abajo.'},{title:"Crea una nueva API Key",desc:'Haz clic en "Create API" ‚Üí Elige "System Generated Keys".'},{title:"Configura permisos",desc:'Activa solo "Enable Reading" y "Enable Spot & Margin Trading". NO actives retiros.'},{title:"Copia tus claves",desc:"Copia el API Key y Secret Key. El Secret solo se muestra UNA vez."}]},{id:"bybit",name:"Bybit",logo:"üü†",color:"#F7A600",desc:"Trading de derivados l√≠der",features:["Spot","Futuros","Opciones"],users:"20M+",apiUrl:"https://www.bybit.com/app/user/api-management",steps:[{title:"Inicia sesi√≥n en Bybit",desc:"Ve a bybit.com e inicia sesi√≥n."},{title:"Ve a API Management",desc:'Perfil ‚Üí "API" o usa el enlace directo de abajo.'},{title:"Crea nueva API Key",desc:'Clic en "Create New Key" ‚Üí "System-generated API Keys".'},{title:"Configura permisos",desc:'Selecciona "Read-Write" para Trading. Deja desactivado "Withdrawal".'},{title:"Copia tus claves",desc:"Copia el API Key y API Secret antes de cerrar."}]},{id:"kraken",name:"Kraken",logo:"üü£",color:"#7B61FF",desc:"Regulado y seguro desde 2011",features:["Spot","Futuros","Staking"],users:"10M+",apiUrl:"https://www.kraken.com/u/security/api",steps:[{title:"Inicia sesi√≥n en Kraken",desc:"Ve a kraken.com e inicia sesi√≥n."},{title:"Ve a API Settings",desc:'Security ‚Üí API ‚Üí "Add Key".'},{title:"Configura permisos",desc:'Activa "Query Funds", "Query Orders", "Create/Modify Orders".'},{title:"Guarda la clave",desc:"Kraken te da un Key y un Private Key. Copia ambos."}]},{id:"coinbase",name:"Coinbase",logo:"üîµ",color:"#0052FF",desc:"Exchange p√∫blico regulado en USA",features:["Spot","Advanced Trade"],users:"110M+",apiUrl:"https://www.coinbase.com/settings/api",needsPassphrase:!0,steps:[{title:"Inicia sesi√≥n en Coinbase",desc:"Ve a coinbase.com ‚Üí Settings ‚Üí API."},{title:"Crea nueva API Key",desc:'Haz clic en "New API Key".'},{title:"Configura permisos y Passphrase",desc:'Selecciona "Trade" y "View". Crea un passphrase seguro.'},{title:"Copia tus claves",desc:"Necesitar√°s: API Key, API Secret y Passphrase."}]},{id:"kucoin",name:"KuCoin",logo:"üü¢",color:"#23AF91",desc:"La exchange del pueblo",features:["Spot","Futuros","Bots"],users:"30M+",apiUrl:"https://www.kucoin.com/account/api",needsPassphrase:!0,steps:[{title:"Inicia sesi√≥n en KuCoin",desc:"Ve a kucoin.com e inicia sesi√≥n."},{title:"Ve a API Management",desc:'Account ‚Üí API Management ‚Üí "Create API".'},{title:"Configura permisos y Passphrase",desc:'Activa "General" y "Trade". Crea un passphrase. No actives "Transfer".'},{title:"Copia tus 3 claves",desc:"Necesitar√°s: API Key, API Secret y Passphrase."}]},{id:"okx",name:"OKX",logo:"‚ö´",color:"#FFFFFF",desc:"Trading avanzado multimercado",features:["Spot","Futuros","Opciones"],users:"50M+",apiUrl:"https://www.okx.com/account/my-api",needsPassphrase:!0,steps:[{title:"Inicia sesi√≥n en OKX",desc:"Ve a okx.com e inicia sesi√≥n."},{title:"Ve a API Settings",desc:'Perfil ‚Üí API ‚Üí "Create API Key".'},{title:"Configura permisos y Passphrase",desc:'Selecciona "Read" y "Trade". Crea un passphrase. NO actives "Withdraw".'},{title:"Copia tus 3 claves",desc:"Necesitar√°s: API Key, Secret Key y Passphrase."}]},{id:"bitget",name:"Bitget",logo:"üî∑",color:"#00CED1",desc:"Copy trading #1 del mundo",features:["Spot","Futuros","Copy"],users:"25M+",apiUrl:"https://www.bitget.com/account/newapi",needsPassphrase:!0,steps:[{title:"Inicia sesi√≥n en Bitget",desc:"Ve a bitget.com e inicia sesi√≥n."},{title:"Ve a API Management",desc:'Account ‚Üí API Management ‚Üí "Create API".'},{title:"Configura permisos y Passphrase",desc:'Activa "Read" y "Trade". Crea passphrase. No actives "Transfer".'},{title:"Copia tus 3 claves",desc:"Necesitar√°s: API Key, Secret Key y Passphrase."}]},{id:"mexc",name:"MEXC",logo:"üîª",color:"#00B897",desc:"M√°s de 1,500 criptomonedas",features:["Spot","Futuros"],users:"10M+",apiUrl:"https://www.mexc.com/ucenter/api",steps:[{title:"Inicia sesi√≥n en MEXC",desc:"Ve a mexc.com e inicia sesi√≥n."},{title:"Ve a API Management",desc:'Account ‚Üí API Management ‚Üí "Create API Key".'},{title:"Configura permisos",desc:'Marca "Read" y "Trade". Sin permisos de retiro.'},{title:"Copia tus claves",desc:"Copia API Key y Secret Key."}]}],J={SELECT:"select",GUIDE:"guide",KEYS:"keys",VERIFYING:"verifying",SUCCESS:"success"};function _s(){const{brokers:d,addBroker:t,removeBroker:s,updateBrokerStatus:a,setActiveBroker:r}=H(),[l,i]=S.useState(!1),[o,m]=S.useState(J.SELECT),[x,g]=S.useState(null),[u,n]=S.useState(0),[b,c]=S.useState({apiKey:"",apiSecret:"",passphrase:"",label:""}),[f,y]=S.useState(!1),[h,j]=S.useState(""),[C,k]=S.useState({}),[N,w]=S.useState({}),[B,P]=S.useState(null),A=S.useCallback(async v=>{w($=>({...$,[v.id]:!0}));try{const $=await _e.getBalances(v.id);$.success&&k(q=>({...q,[v.id]:$.balances}))}catch{}w($=>({...$,[v.id]:!1}))},[]);S.useEffect(()=>{const v=d.filter(q=>q.connected);v.forEach(q=>A(q));const $=setInterval(()=>v.forEach(q=>A(q)),3e4);return()=>clearInterval($)},[d,A]);const M=v=>{g(v),n(0),m(J.GUIDE),c({apiKey:"",apiSecret:"",passphrase:"",label:""}),j(""),i(!0)},z=async()=>{if(!b.apiKey.trim()||!b.apiSecret.trim()){j("API Key y Secret son obligatorios");return}if(x.needsPassphrase&&!b.passphrase.trim()){j("Este exchange requiere Passphrase");return}j(""),m(J.VERIFYING);const v=t({brokerId:x.id,label:b.label||x.name,apiKey:b.apiKey.trim(),apiSecret:b.apiSecret.trim(),passphrase:b.passphrase.trim()||void 0});try{const $=await _e.connect(v);a(v.id,$.success),$.success?(r(v),A(v),m(J.SUCCESS),setTimeout(()=>{i(!1),m(J.SELECT)},2500)):(m(J.KEYS),j("No se pudo conectar. Verifica que tus claves sean correctas y tengan los permisos adecuados."))}catch($){m(J.KEYS),j(`Error de conexi√≥n: ${$.message}`)}},p=v=>{_e.disconnect(v),s(v),k($=>{const q={...$};return delete q[v],q})},T=v=>(C[v]||[]).reduce((q,Y)=>["USDT","USDC","BUSD","FDUSD","KAIROS"].includes(Y.asset)?q+parseFloat(Y.free)+parseFloat(Y.locked||0):q,0),I=d.map(v=>v.brokerId),R=()=>{i(!1),m(J.SELECT)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Conectar Exchange"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1",children:"Conecta tu cuenta en 3 simples pasos. Te guiamos durante todo el proceso."})]}),e.jsxs("div",{className:"rounded-xl p-4 flex items-start gap-3",style:{background:"rgba(59,130,246,0.04)",border:"1px solid rgba(59,130,246,0.1)"},children:[e.jsx(ce,{size:20,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"Conexi√≥n segura con API Keys"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:["Tu exchange genera claves especiales (API Keys) que solo permiten leer y operar ‚Äî ",e.jsx("strong",{className:"text-[var(--text)]",children:"nunca retirar fondos"}),". Las claves se almacenan encriptadas solo en tu dispositivo. Kairos Trade nunca tiene acceso a tu contrase√±a ni a tus fondos directamente."]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{num:"1",title:"Elige tu Exchange",desc:"Selecciona de la lista",icon:ee},{num:"2",title:"Sigue la gu√≠a",desc:"Te mostramos paso a paso",icon:Xe},{num:"3",title:"Pega tus claves",desc:"Y listo, conectado",icon:Ue}].map((v,$)=>e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center text-xs font-bold",style:{background:"rgba(59,130,246,0.1)",color:"var(--gold)",border:"1px solid rgba(59,130,246,0.15)"},children:v.num}),e.jsx("p",{className:"text-xs font-bold mb-0.5",children:v.title}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:v.desc})]},$))}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-bold text-[var(--text-dim)] uppercase tracking-wider",children:"Cuentas Conectadas"}),d.map(v=>{const $=ct.find(O=>O.id===v.brokerId),q=C[v.id]||[],Y=B===v.id,F=T(v.id);return e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer",onClick:()=>P(Y?null:v.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-xl",style:{background:`${($==null?void 0:$.color)||"#333"}15`,border:`1px solid ${($==null?void 0:$.color)||"#333"}30`},children:($==null?void 0:$.logo)||"üìä"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:v.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:($==null?void 0:$.name)||v.brokerId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[v.connected&&e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--gold)]",children:["$",F.toFixed(2)]})]}),v.connected?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--green)] px-2 py-1 rounded-lg",style:{background:"rgba(0,220,130,0.1)"},children:[e.jsx(pe,{size:12})," Conectado"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--text-dim)] px-2 py-1 rounded-lg",style:{background:"var(--surface-2)"},children:[e.jsx(Je,{size:12})," Error"]}),e.jsx("button",{onClick:O=>{O.stopPropagation(),p(v.id)},className:"text-xs text-[var(--text-dim)] hover:text-[var(--red)] transition-colors px-2 py-1 rounded-lg hover:bg-[var(--red)]/5",children:e.jsx(ge,{size:14})})]})]}),e.jsx(Q,{children:Y&&v.connected&&e.jsx(_.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 space-y-3",style:{borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between pt-3",children:[e.jsxs("h4",{className:"text-xs font-bold uppercase tracking-wider text-[var(--text-dim)] flex items-center gap-2",children:[e.jsx($e,{size:13,className:"text-[var(--gold)]"})," Balances"]}),e.jsxs("button",{onClick:()=>A(v),className:"text-[10px] text-[var(--text-dim)] hover:text-[var(--gold)] flex items-center gap-1",children:[e.jsx(Wt,{size:11,className:N[v.id]?"animate-spin":""})," Actualizar"]})]}),q.length>0?e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:q.slice(0,15).map(O=>e.jsxs("div",{className:"rounded-lg p-2",style:{background:"var(--surface-2)"},children:[e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)]",children:O.asset}),e.jsx("p",{className:"text-xs font-bold mt-0.5",children:parseFloat(O.free).toFixed(O.asset==="BTC"?8:2)})]},O.asset))}):e.jsx("p",{className:"text-xs text-[var(--text-dim)] py-2",children:N[v.id]?"Cargando...":"Sin balances"})]})})})]},v.id)})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-[var(--text-dim)] uppercase tracking-wider mb-3",children:d.length>0?"Conectar Otro Exchange":"Selecciona tu Exchange"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:ct.map(v=>{const $=I.includes(v.id);return e.jsxs("button",{onClick:()=>!$&&M(v),disabled:$,className:"group relative rounded-xl p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-default",style:{background:$?"rgba(0,220,130,0.04)":"linear-gradient(135deg, rgba(17,19,24,0.9), rgba(24,26,32,0.7))",border:`1px solid ${$?"rgba(0,220,130,0.15)":"var(--border)"}`},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{background:`${v.color}15`,border:`1px solid ${v.color}25`},children:v.logo}),$?e.jsx(pe,{size:16,className:"text-[var(--green)]"}):e.jsx(je,{size:16,className:"text-[var(--text-dim)] group-hover:text-[var(--gold)] transition-colors"})]}),e.jsx("h3",{className:"text-sm font-bold mb-0.5",children:v.name}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 leading-relaxed",children:v.desc}),e.jsx("div",{className:"flex flex-wrap gap-1",children:v.features.map(q=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-white/[0.04] text-[var(--text-dim)] font-medium",children:q},q))}),e.jsxs("p",{className:"text-[9px] text-[var(--text-dim)]/50 mt-2",children:[v.users," usuarios"]})]},v.id)})})]}),e.jsx(Q,{children:l&&x&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"},onClick:R,children:e.jsxs(_.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},onClick:v=>v.stopPropagation(),className:"w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl",style:{background:"#0E1015",border:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"p-5 pb-4 flex items-center justify-between",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-xl",style:{background:`${x.color}15`,border:`1px solid ${x.color}30`},children:x.logo}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",children:["Conectar ",x.name]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(Me,{size:9,className:"text-[var(--green)]"}),e.jsx("span",{className:"text-[9px] text-[var(--green)] font-semibold",children:"Conexi√≥n segura con API Keys"})]})]})]}),e.jsx("button",{onClick:R,className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] transition-colors hover:bg-white/5",children:e.jsx(ft,{size:18})})]}),o===J.GUIDE&&e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center gap-1.5 mb-2",children:x.steps.map((v,$)=>e.jsx("div",{className:"transition-all duration-300",style:{width:$===u?20:6,height:6,borderRadius:3,background:$===u?x.color:$<u?"var(--green)":"rgba(30,34,45,0.6)"}},$))}),e.jsx(Q,{mode:"wait",children:e.jsx(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:e.jsx("div",{className:"rounded-xl p-4",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold shrink-0",style:{background:`${x.color}15`,color:x.color},children:u+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:x.steps[u].title}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] leading-relaxed",children:x.steps[u].desc})]})]})})},u)}),u===0&&e.jsxs("a",{href:x.apiUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full py-3 rounded-xl text-sm font-bold transition-all hover:brightness-110",style:{background:`${x.color}20`,color:x.color,border:`1px solid ${x.color}30`},children:[e.jsx(Ht,{size:14})," Abrir ",x.name," API Management"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u>0&&e.jsxs("button",{onClick:()=>n(v=>v-1),className:"flex items-center gap-1 px-4 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx(Le,{size:14})," Anterior"]}),e.jsx("div",{className:"flex-1"}),u<x.steps.length-1?e.jsxs("button",{onClick:()=>n(v=>v+1),className:"flex items-center gap-1 px-5 py-2.5 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110",style:{background:`linear-gradient(135deg, ${x.color}, ${x.color}CC)`},children:["Siguiente ",e.jsx(je,{size:14})]}):e.jsxs("button",{onClick:()=>m(J.KEYS),className:"flex items-center gap-1 px-5 py-2.5 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110",style:{background:"linear-gradient(135deg, #0ECB81, #0AA06A)"},children:["Ya tengo mis claves ",e.jsx(bt,{size:14})]})]}),e.jsx("button",{onClick:()=>m(J.KEYS),className:"w-full text-center text-[11px] text-[var(--text-dim)]/50 hover:text-[var(--text-dim)] transition-colors py-1",children:"Ya s√© c√≥mo hacerlo, ir directo a pegar claves ‚Üí"})]}),o===J.KEYS&&e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"text-center mb-1",children:[e.jsxs("p",{className:"text-sm font-bold",children:["Pega tus API Keys de ",x.name]}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1",children:"Las claves se encriptan y almacenan solo en tu dispositivo"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:["Nombre de la cuenta ",e.jsx("span",{className:"text-[var(--text-dim)]/40",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.label,onChange:v=>c({...b,label:v.target.value}),placeholder:`Mi cuenta ${x.name}`,className:"w-full text-sm rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Ue,{size:10,className:"text-[var(--gold)]"})," API Key ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:"text",value:b.apiKey,onChange:v=>c({...b,apiKey:v.target.value}),placeholder:"Pega tu API Key aqu√≠",className:"w-full text-sm font-mono rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"},autoFocus:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Me,{size:10,className:"text-[var(--gold)]"})," API Secret ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:f?"text":"password",value:b.apiSecret,onChange:v=>c({...b,apiSecret:v.target.value}),placeholder:"Pega tu API Secret aqu√≠",className:"w-full text-sm font-mono rounded-xl pr-10",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}}),e.jsx("button",{onClick:()=>y(!f),className:"absolute right-3 top-7 text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",children:f?e.jsx(ht,{size:15}):e.jsx(gt,{size:15})})]}),x.needsPassphrase&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(ce,{size:10,className:"text-[var(--gold)]"})," Passphrase ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:"password",value:b.passphrase,onChange:v=>c({...b,passphrase:v.target.value}),placeholder:"Pega tu Passphrase aqu√≠",className:"w-full text-sm font-mono rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}})]})]}),h&&e.jsxs("div",{className:"rounded-lg px-3 py-2 text-xs text-[var(--red)] flex items-start gap-2",style:{background:"rgba(246,70,93,0.08)",border:"1px solid rgba(246,70,93,0.15)"},children:[e.jsx(Je,{size:14,className:"shrink-0 mt-0.5"})," ",h]}),e.jsxs("div",{className:"rounded-lg px-3 py-2 flex items-start gap-2",style:{background:"rgba(59,130,246,0.04)",border:"1px solid rgba(59,130,246,0.08)"},children:[e.jsx(Xe,{size:13,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:["Aseg√∫rate de que tu API Key tenga permisos de ",e.jsx("strong",{className:"text-[var(--text)]",children:"lectura"})," y ",e.jsx("strong",{className:"text-[var(--text)]",children:"trading"}),".",e.jsx("strong",{className:"text-[var(--red)]",children:" Nunca actives permisos de retiro."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{m(J.GUIDE),n(0)},className:"flex items-center gap-1 px-4 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx(Le,{size:14})," Ver gu√≠a"]}),e.jsxs("button",{onClick:z,disabled:!b.apiKey||!b.apiSecret,className:"flex-1 py-3 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110 disabled:opacity-40",style:{background:"linear-gradient(135deg, #0ECB81, #0AA06A)"},children:["Conectar ",x.name]})]})]}),o===J.VERIFYING&&e.jsxs("div",{className:"p-8 flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-3xl",style:{background:`${x.color}15`},children:x.logo}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 rounded-full bg-[var(--dark)] flex items-center justify-center",children:e.jsx(Gt,{size:16,className:"text-[var(--gold)] animate-spin"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:"Verificando conexi√≥n..."}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)]",children:["Conectando de forma segura con ",x.name]})]}),e.jsx("div",{className:"w-48 h-1 rounded-full overflow-hidden",style:{background:"rgba(30,34,45,0.5)"},children:e.jsx(_.div,{className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${x.color}, var(--gold))`},initial:{width:"0%"},animate:{width:"90%"},transition:{duration:3,ease:"easeOut"}})})]}),o===J.SUCCESS&&e.jsxs("div",{className:"p-8 flex flex-col items-center gap-4",children:[e.jsx(_.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:12},children:e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:"rgba(14,203,129,0.12)",border:"2px solid rgba(14,203,129,0.3)"},children:e.jsx(pe,{size:32,className:"text-[var(--green)]"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:"¬°Conectado exitosamente!"}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)]",children:["Tu cuenta de ",x.name," est√° lista para operar desde Kairos Trade"]})]})]}),e.jsxs("div",{className:"px-5 py-3 flex items-center justify-center gap-2",style:{borderTop:"1px solid rgba(30,34,45,0.3)"},children:[e.jsx(Me,{size:10,className:"text-[var(--text-dim)]/40"}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/40",children:"Tus claves est√°n encriptadas localmente"})]})]})})})]})}const Os={ema:"La **EMA (Media M√≥vil Exponencial)** da m√°s peso a los precios recientes. EMA 20 corto plazo, EMA 50 mediano, EMA 200 largo. Cuando EMA r√°pida cruza encima de la lenta = se√±al de compra (Golden Cross). Cuando cruza debajo = se√±al de venta (Death Cross).",sma:"La **SMA (Media M√≥vil Simple)** es el promedio aritm√©tico de los √∫ltimos N precios. SMA 200 es la referencia institucional de tendencia a largo plazo.",rsi:"El **RSI (√çndice de Fuerza Relativa)** mide momentum en escala 0-100. RSI > 70 = sobrecompra (posible ca√≠da), RSI < 30 = sobreventa (posible rebote). Divergencias RSI son se√±ales muy poderosas.",macd:"El **MACD** mide momentum con: l√≠nea MACD (EMA12 ‚àí EMA26), l√≠nea de se√±al (EMA9 del MACD), e histograma. Cruce alcista = compra. Histograma creciente = momentum positivo.",bollinger:"Las **Bandas de Bollinger** forman un canal de volatilidad (SMA ¬± 2œÉ). Precio toca banda superior = posible sobrecompra. Compresi√≥n (Squeeze) = explosi√≥n de volatilidad inminente.",vwap:"El **VWAP** es el precio promedio ponderado por volumen del d√≠a. Price > VWAP = sesgo alcista. Es la principal referencia institucional intraday.",fibonacci:"Los retrocesos de **Fibonacci** (23.6%, 38.2%, 50%, 61.8%) identifican soporte/resistencia. El 61.8% (golden ratio) es el nivel m√°s respetado.",soporte:"**Soporte** es donde la demanda frena la ca√≠da. **Resistencia** donde la oferta frena la subida. Cuando un soporte se rompe, se convierte en resistencia y viceversa.",tendencia:"**Tendencia alcista** = m√°ximos y m√≠nimos m√°s altos. **Bajista** = m√°ximos y m√≠nimos m√°s bajos. **Nunca operes contra la tendencia principal.**",scalping:"**Scalping** busca ganancias r√°pidas (0.1-0.5%) en timeframes 1-5 min. Requiere spread bajo, ejecuci√≥n r√°pida, y disciplina.",swing:"**Swing trading** captura movimientos de 2-10% en d√≠as o semanas. Timeframes 4h y 1D. Mejor ratio riesgo/recompensa que scalping.",day_trading:"**Day trading** abre y cierra en el mismo d√≠a. Timeframes 5m-1h. No hay riesgo overnight.",riesgo:"**Regla del 1-2%**: Nunca arriesgues m√°s del 1-2% por trade. Si tienes $10,000, p√©rdida m√°xima por operaci√≥n = $100-200.",stop_loss:"El **Stop Loss** es obligatorio. M√©todos: porcentaje fijo (1-3%), debajo de soporte, ATR multiplier, o swing low/high.",take_profit:"**Take Profit** debe ser al menos 2x tu Stop Loss (ratio 1:2 m√≠nimo). Usa trailing stops para movimientos grandes.",position:"**Position sizing**: Capital √ó Riesgo% √∑ (Entrada ‚àí StopLoss) = Cantidad. Esto controla tu riesgo sin importar el resultado.",doji:"**Doji** = apertura ‚âà cierre. Indica indecisi√≥n. Despu√©s de tendencia fuerte = posible reversal.",engulfing:"**Engulfing bullish** = vela roja + verde que la envuelve. Se√±al alcista fuerte en soporte.",hammer:"**Hammer** = mecha inferior larga en fondo bajista. Indica rechazo de precios bajos = posible reversal alcista.",doble_techo:"**Doble techo** = dos m√°ximos iguales. Reversal bajista. Confirmar con ruptura del neckline.",hch:"**Cabeza y hombros** = tres m√°ximos, central m√°s alto. El patr√≥n de reversal m√°s confiable.",liquidez:"**Liquidez** se concentra en m√°ximos/m√≠nimos iguales, n√∫meros redondos y zonas de alto volumen. Market Makers buscan liquidez antes de moverse.",order_block:"**Order Block** = zona de √≥rdenes institucionales. √öltima vela antes de movimiento impulsivo. Precio regresa a estas zonas.",funding:"**Funding rate** en futuros indica consenso. Funding muy positivo = exceso de longs, posible ca√≠da. Negativo = exceso de shorts, posible subida.",bitcoin:"**Bitcoin (BTC)** es la referencia. ~70% de altcoins siguen a BTC. Siempre analiza BTC primero.",altseason:"**Altseason** = altcoins superan a Bitcoin (BTC dominance baja). Se identifica cuando ETH/BTC sube.",halving:"**Halving** reduce emisi√≥n BTC a la mitad cada ~4 a√±os. Hist√≥ricamente precede bull runs de 12-18 meses.",apalancamiento:"**Apalancamiento** multiplica tu exposici√≥n. 10x = ganas/pierdes 10 veces m√°s r√°pido. Para principiantes: m√°ximo 3x. Profesionales: 5-10x con SL estricto.",volumen:"**Volumen** confirma movimientos. Ruptura con volumen alto = real. Ruptura sin volumen = probable fake out. Volumen creciente en tendencia = saludable."},zs={ema:["ema","media movil exponencial","exponential moving","golden cross","death cross"],sma:["sma","media movil simple","simple moving"],rsi:["rsi","fuerza relativa","relative strength","sobrecompra","sobreventa","overbought","oversold"],macd:["macd","convergencia divergencia","histograma"],bollinger:["bollinger","bandas de bollinger","bollinger bands","squeeze","bb "],vwap:["vwap","precio ponderado","volume weighted"],fibonacci:["fibonacci","fibo","retroceso","golden ratio","61.8"],soporte:["soporte","resistencia","support","resistance","nivel clave"],tendencia:["tendencia","trend","alcista","bajista","lateral","rango"],scalping:["scalping","scalp","escalpeo"],swing:["swing trading","swing trade"],day_trading:["day trading","intradia","intraday"],riesgo:["riesgo","risk management","money management","gestion de riesgo"],stop_loss:["stop loss","stoploss","parar perdida"],take_profit:["take profit","tomar ganancia","objetivo de ganancia"],position:["position sizing","tamano de posicion","cuanto invertir","cuanto comprar","cuanto arriesgar"],doji:["doji","vela de indecision"],engulfing:["engulfing","envolvente","patron de vela"],hammer:["hammer","martillo","pin bar"],doble_techo:["doble techo","double top","doble suelo","double bottom"],hch:["cabeza y hombros","head and shoulders","hch"],liquidez:["liquidez","liquidity","market maker"],order_block:["order block","bloque de orden","smc","smart money"],funding:["funding","funding rate"],bitcoin:["dominancia","btc dominance"],altseason:["altseason","alt season","altcoins"],halving:["halving","halvening"],apalancamiento:["apalancamiento","leverage","margen","margin"],volumen:["volumen","volume","vol "]};class Ls{constructor(){this.apiKey=null,this.model="gpt-4o-mini",this.conversationHistory=[],this._cache=new Map,this._cacheTTL=3e4}setApiKey(t){this.apiKey=t}async chat(t,s=null){this.conversationHistory.push({role:"user",content:t});try{const a=this._parseIntent(t);return this.apiKey?await this._openAI(t,s,a):await this._engine(t,s,a)}catch(a){console.error("Kairos AI error:",a);const r={text:`‚ö†Ô∏è Error: ${a.message}. Intenta de nuevo.`,strategy:null,kairosScript:null,action:null};return this.conversationHistory.push({role:"assistant",content:r.text}),r}}_parseIntent(t){const s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=t.match(/\b([A-Z]{2,10})(USDT|USD|BTC|ETH|BNB|BUSD)\b/i)||t.match(/\b(BTC|ETH|SOL|BNB|XRP|ADA|DOGE|AVAX|DOT|MATIC|LINK|UNI|ATOM|NEAR|APT|ARB|OP|SUI|TIA|JUP|WIF|PEPE|SHIB|LTC|BCH|EOS|TRX|FIL|AAVE|MKR|COMP|SNX|CRV|INJ|SEI|MANTA|STRK|PYTH)\b/i),r=a?a[0].toUpperCase().endsWith("USDT")?a[0].toUpperCase():a[0].toUpperCase()+"USDT":null;return{changePair:!!s.match(/\b(cambi|muestra|ponme|pon |abre|ver |quiero ver|busca|grafico de)\b/),analyze:!!s.match(/\b(analiz|analisis|como ves|como esta|que ves|revis|resumen|overview)\b/),strategy:!!s.match(/\b(estrategia|estratergia|strategy)\b/),kairosScript:!!(s.match(/\b(script|codigo|code|kairos script)\b/)||s.includes("bot")&&s.match(/\b(crea|genera|haz|dame)\b/)),education:!!s.match(/\b(que es|explica|como funciona|ensen|aprend|como se|que significa|diferencia|que son)\b/),risk:!!s.match(/\b(riesgo|stop loss|position siz|gestion|cuanto debo|cuanto arriesg)\b/),predict:!!s.match(/\b(subir|bajar|precio|target|objetivo|va a|prediccion|pronostico|proyeccion)\b/),greeting:!!s.match(/^(hola|hey|buenas|saludos|hi|hello|que tal|buenos dias|buenas noches|buenas tardes)\b/),help:!!s.match(/\b(ayuda|help|puedes|que sabes|funciones|que haces|capacidades)\b/),detectedPair:r}}async _engine(t,s,a){const r=t.toLowerCase();if(a.greeting)return this._reply(`üëã ¬°Hola! Soy **Kairos AI**, tu experto de trading.

Puedo:
‚Ä¢ üìä **Analizar cualquier par** ‚Äî "Analiza ETHUSDT"
‚Ä¢ üéØ **Generar estrategias** ‚Äî "Dame una estrategia para SOL"
‚Ä¢ üíª **Crear Kairos Script** ‚Äî "Crea un script para BTC"
‚Ä¢ üîÑ **Cambiar el gr√°fico** ‚Äî "Mu√©strame SOLUSDT"
‚Ä¢ üìö **Ense√±arte trading** ‚Äî "¬øQu√© es el RSI?"

¬øEn qu√© te ayudo?`);if(a.help)return this._reply(`ü§ñ **Kairos AI ‚Äî Capacidades**

üìä **An√°lisis T√©cnico** ‚Äî Calculo EMA, SMA, RSI, MACD, BB, VWAP en tiempo real. Detecto cruces, divergencias, y se√±ales.

üéØ **Estrategias** ‚Äî Genero estrategias basadas en el estado actual del mercado con SL/TP calculados.

üíª **Kairos Script** ‚Äî Creo c√≥digo que puedes copiar ‚Üí paste en un Script Bot ‚Üí el bot lo ejecuta autom√°ticamente.

üîÑ **Control del Gr√°fico** ‚Äî "Mu√©strame SOL" y cambio el par en pantalla.

üìö **Educaci√≥n** ‚Äî Preg√∫ntame sobre cualquier indicador, patr√≥n o concepto.

Prueba: **"Analiza BTC y crea un script ganador"**`);if(a.changePair&&a.detectedPair){const i=a.detectedPair;try{const o=await this._analyze(i);return this._reply(`üîÑ **Cambiando a ${i}**

${this._quickSummary(i,o)}

¬øQuieres un an√°lisis completo o un script para ${i}?`,null,null,{type:"changePair",pair:i})}catch{return this._reply(`üîÑ **Cambiando a ${i}**
Cargando datos...`,null,null,{type:"changePair",pair:i})}}if(a.kairosScript||a.strategy&&(r.includes("script")||r.includes("codigo")||r.includes("bot"))){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._genScript(i,s)}if(a.strategy){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._genStrategy(i,s)}if(a.analyze||a.predict){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._fullAnalysis(i,s)}if(a.education||a.risk)return this._educate(t);if(a.detectedPair){const i=a.detectedPair;return await this._fullAnalysis(i,s,{type:"changePair",pair:i})}const l=this._matchKB(r);return l?this._reply(l):this._reply(`ü§ñ Entiendo: "${t}"

Puedo:
‚Ä¢ üìä **"Analiza BTCUSDT"** ‚Äî An√°lisis t√©cnico
‚Ä¢ üíª **"Crea un script para ETH"** ‚Äî C√≥digo para bot
‚Ä¢ üîÑ **"Mu√©strame SOLUSDT"** ‚Äî Cambiar gr√°fico
‚Ä¢ üìö **"¬øQu√© es el MACD?"** ‚Äî Educaci√≥n

¬øQu√© necesitas?`)}async _analyze(t,s="1h",a=200){const r=`${t}_${s}`,l=this._cache.get(r);if(l&&Date.now()-l.ts<this._cacheTTL)return l.data;const[i,o]=await Promise.all([W.getCandles(t,s,a),W.get24hrTicker(t)]);if(!i||i.length<50)throw new Error(`Datos insuficientes para ${t}`);const m=i.map(V=>V.close),x=i.map(V=>V.high),g=i.map(V=>V.low),u=i.map(V=>V.volume),n=m.length,b=Z(m,20),c=Z(m,50),f=Fe(m,200),y=de(m,14),h=Be(m,12,26,9),j=Qe(m,20,2),C=Pt(i),k=m[n-1],N=b[n-1],w=c[n-1],B=f[n-1],P=y[n-1],A=h.macd[n-1],M=h.signal[n-1],z=h.histogram[n-1],p=j.upper[n-1],T=j.lower[n-1],I=j.middle[n-1],R=C[n-1],v=k>N?"alcista":"bajista",$=k>w?"alcista":"bajista",q=B?k>B?"alcista":"bajista":"indefinida",Y=N>w&&(B?w>B:!0),F=be(b,c,n-1),O=be(h.macd,h.signal,n-1),E=js(m,y,14),D=p&&T?(p-T)/I*100:0,L=[];for(let V=Math.max(0,n-20);V<n;V++)j.upper[V]&&j.lower[V]&&j.middle[V]&&L.push((j.upper[V]-j.lower[V])/j.middle[V]*100);const xe=L.length>0?L.reduce((V,De)=>V+De,0)/L.length:D,ke=D<xe*.75,ne=u.slice(-20).reduce((V,De)=>V+De,0)/20,ve=u[n-1]/ne,Pe=Math.max(...x.slice(-20)),Re=Math.min(...g.slice(-20));let G=50;v==="alcista"&&(G+=8),$==="alcista"&&(G+=8),q==="alcista"&&(G+=8),Y&&(G+=6),P>50&&P<70&&(G+=5),P<30&&(G+=10),P>70&&(G-=10),z>0&&(G+=5),O==="bullish_cross"&&(G+=10),O==="bearish_cross"&&(G-=10),F==="bullish_cross"&&(G+=10),F==="bearish_cross"&&(G-=10),k>R&&(G+=5),E==="bullish_divergence"&&(G+=8),E==="bearish_divergence"&&(G-=8),ve>1.5&&(G+=v==="alcista"?5:-5),G=Math.max(0,Math.min(100,G));const Ye={pair:t,price:k,ticker:o,ind:{ema20:N,ema50:w,sma200:B,rsi:P,macdLine:A,macdSig:M,macdHist:z,bbU:p,bbL:T,bbM:I,bbWidth:D,squeeze:ke,vwap:R},trend:{short:v,mid:$,long:q,aligned:Y,emaCross:F},signals:{rsiDiv:E,macdCross:O,volRatio:ve,avgVol:ne},levels:{support:Re,resistance:Pe},score:G,candles:i};return this._cache.set(r,{data:Ye,ts:Date.now()}),Ye}async _fullAnalysis(t,s,a=null){var r,l;try{const i=await this._analyze(t),{price:o,ind:m,trend:x,signals:g,levels:u,score:n,ticker:b}=i;let c,f;n>=70?(c="FUERTEMENTE ALCISTA",f="üü¢üü¢"):n>=55?(c="MODERADAMENTE ALCISTA",f="üü¢"):n>=45?(c="NEUTRAL / LATERAL",f="üü°"):n>=30?(c="MODERADAMENTE BAJISTA",f="üî¥"):(c="FUERTEMENTE BAJISTA",f="üî¥üî¥");const y=[];x.emaCross==="bullish_cross"&&y.push("‚úÖ **Golden Cross** ‚Äî EMA20 cruz√≥ encima de EMA50"),x.emaCross==="bearish_cross"&&y.push("‚ùå **Death Cross** ‚Äî EMA20 cruz√≥ debajo de EMA50"),g.macdCross==="bullish_cross"&&y.push("‚úÖ **MACD Bullish Cross**"),g.macdCross==="bearish_cross"&&y.push("‚ùå **MACD Bearish Cross**"),m.rsi<30&&y.push("‚ö° **RSI Sobreventa** ‚Äî Posible rebote"),m.rsi>70&&y.push("‚ö†Ô∏è **RSI Sobrecompra** ‚Äî Posible correcci√≥n"),g.rsiDiv==="bullish_divergence"&&y.push("üî• **Divergencia RSI Alcista** ‚Äî Reversal probable"),g.rsiDiv==="bearish_divergence"&&y.push("‚ö†Ô∏è **Divergencia RSI Bajista**"),m.squeeze&&y.push("üí• **BB Squeeze** ‚Äî Explosi√≥n inminente"),g.volRatio>2&&y.push(`üìä **Volumen ${g.volRatio.toFixed(1)}x** sobre promedio`),x.aligned&&y.push("üìà **EMAs Alineadas** ‚Äî Tendencia fuerte");let h;n>=65?h=`üü¢ **BUSCAR COMPRAS** en pullback a EMA20 ($${m.ema20.toFixed(2)}). SL debajo EMA50. TP: $${u.resistance.toFixed(2)}.`:n>=45?h=`üü° **ESPERAR** ‚Äî Operar rango $${u.support.toFixed(2)} - $${u.resistance.toFixed(2)}.`:h=`üî¥ **PRECAUCI√ìN** ‚Äî Evitar longs. Short target: $${u.support.toFixed(2)}.`;const j=(b==null?void 0:b.changePercent)||0,C=`üìä **AN√ÅLISIS ‚Äî ${t}**

**Precio:** $${o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}
**24h:** ${j>=0?"+":""}${j.toFixed(2)}% | **Vol:** $${(((b==null?void 0:b.quoteVolume)||0)/1e6).toFixed(1)}M

‚îÅ‚îÅ **INDICADORES** ‚îÅ‚îÅ
‚Ä¢ EMA 20: $${m.ema20.toFixed(2)} ${o>m.ema20?"‚úÖ":"‚ùå"}
‚Ä¢ EMA 50: $${m.ema50.toFixed(2)} ${o>m.ema50?"‚úÖ":"‚ùå"}
`+(m.sma200?`‚Ä¢ SMA 200: $${m.sma200.toFixed(2)} ${o>m.sma200?"‚úÖ":"‚ùå"}
`:"")+`‚Ä¢ RSI: ${(r=m.rsi)==null?void 0:r.toFixed(1)} ${m.rsi>70?"‚ö†Ô∏è":m.rsi<30?"‚ö°":"üü¢"}
‚Ä¢ MACD: ${m.macdHist>0?"üü¢":"üî¥"} ${(l=m.macdHist)==null?void 0:l.toFixed(4)}
‚Ä¢ BB: ${m.bbWidth.toFixed(2)}% ${m.squeeze?"üí• SQUEEZE":""}
‚Ä¢ VWAP: $${m.vwap.toFixed(2)} ${o>m.vwap?"‚úÖ":"‚ùå"}

‚îÅ‚îÅ **TENDENCIA** ‚îÅ‚îÅ
Corto: **${x.short}** | Medio: **${x.mid}** | Largo: **${x.long}**
EMAs alineadas: ${x.aligned?"‚úÖ":"‚ùå"}

‚îÅ‚îÅ **NIVELES** ‚îÅ‚îÅ
Soporte: $${u.support.toFixed(2)} | Resistencia: $${u.resistance.toFixed(2)}

`+(y.length>0?`‚îÅ‚îÅ **SE√ëALES** ‚îÅ‚îÅ
${y.join(`
`)}

`:"")+`‚îÅ‚îÅ **VEREDICTO** ‚îÅ‚îÅ
${f} **${c}** (Score: ${n}/100)

${h}

üí° _Di "crea un script para ${t}" para generar c√≥digo autom√°tico._`;return this._reply(C,null,null,a)}catch(i){if(s)return this._basicAnalysis(s);throw i}}_quickSummary(t,s){var m;const{price:a,ind:r,trend:l,score:i}=s;return`${i>=60?"üü¢":i>=40?"üü°":"üî¥"} **${t}** ‚Äî $${a.toLocaleString(void 0,{minimumFractionDigits:2})}
RSI: ${(m=r.rsi)==null?void 0:m.toFixed(1)} | MACD: ${r.macdHist>0?"üü¢":"üî¥"} | Tendencia: ${l.short}
Score: **${i}/100**`}_basicAnalysis(t){var a,r;const s=t.changePercent>0?"alcista":"bajista";return this._reply(`üìà **${t.symbol}** ‚Äî $${(a=t.price)==null?void 0:a.toLocaleString()}
Cambio 24h: ${t.changePercent>0?"+":""}${(r=t.changePercent)==null?void 0:r.toFixed(2)}%
Tendencia: ${s}

‚ö†Ô∏è Para an√°lisis completo con indicadores, carga el gr√°fico primero.`)}async _genStrategy(t,s){try{const a=await this._analyze(t),{ind:r,trend:l,score:i,levels:o,signals:m,price:x}=a;let g,u,n,b,c,f,y,h;i>=65&&l.aligned?(g="ema_cross",u=`Tendencia Alcista ‚Äî ${t}`,n="EMA 20 > EMA 50 + RSI > 40",b="RSI > 75 o precio < EMA 50",c=Math.max(1.5,(x-o.support)/x*100).toFixed(1),f=Math.max(parseFloat(c)*2,(o.resistance-x)/x*100).toFixed(1),y="1h",h=`EMAs alineadas, Score ${i}/100.`):r.rsi<35&&m.rsiDiv==="bullish_divergence"?(g="ema_cross_rsi",u=`RSI Reversal ‚Äî ${t}`,n="RSI < 30 + Divergencia alcista",b="RSI > 65",c="2",f="5",y="4h",h=`RSI ${r.rsi.toFixed(1)} con divergencia alcista.`):r.squeeze?(g="ema_cross",u=`BB Breakout ‚Äî ${t}`,n="Precio rompe BB superior + volumen alto",b="Precio vuelve dentro de BB",c=(r.bbWidth/2).toFixed(1),f=(r.bbWidth*1.5).toFixed(1),y="1h",h=`BB Squeeze (${r.bbWidth.toFixed(2)}%). Explosi√≥n inminente.`):i<=35?(g="rsi",u=`Short Bajista ‚Äî ${t}`,n="Rechazo en EMA 20 + RSI < 50",b="RSI < 25 o soporte",c="2",f="4",y="1h",h=`Score bajista ${i}/100.`):(g="ema_cross_rsi",u=`Range Trading ‚Äî ${t}`,n=`Compra en soporte $${o.support.toFixed(2)} + RSI < 40`,b="RSI > 65 o resistencia",c=((x-o.support)/x*100+.5).toFixed(1),f=((o.resistance-x)/x*100).toFixed(1),y="1h",h=`Lateral, Score ${i}/100.`);const j=(parseFloat(f)/parseFloat(c)).toFixed(1),C={name:u,pair:t,timeframe:y,entry:{condition:n,indicator:g,params:g==="ema_cross"?{fast:20,slow:50}:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30,rsiOverbought:70}},exit:{condition:b,indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:`${c}%`,takeProfit:`${f}%`,riskReward:`1:${j}`},k=`üéØ **ESTRATEGIA ‚Äî ${t}**

**${u}**

üìä **Raz√≥n:** ${h}

**Entrada:** ${n}
**Salida:** ${b}
**SL:** ${c}% | **TP:** ${f}% | **R:R:** 1:${j}
**TF:** ${y}

Activa con el bot√≥n de abajo, o di **"crea un script"** para c√≥digo de bot.`;return this._reply(k,C)}catch{const a={name:`Auto ‚Äî ${t}`,pair:t,timeframe:"1h",entry:{condition:"EMA Cross + RSI",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:35}},exit:{condition:"RSI > 70",indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:"2%",takeProfit:"4%",riskReward:"1:2"};return this._reply(`üéØ **Estrategia para ${t}**

EMA Cross + RSI
SL: 2% | TP: 4% | R:R: 1:2

Activa con el bot√≥n.`,a)}}async _genScript(t,s){try{const a=await this._analyze(t),{ind:r,trend:l,score:i,levels:o}=a;let m,x;if(i>=65&&l.aligned)x=`Tendencia alcista, Score ${i}/100. EMAs alineadas.`,m=`// Tendencia Alcista ‚Äî ${t}
// Generado por Kairos AI | Score: ${i}/100
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// EMA20: $${r.ema20.toFixed(2)} | EMA50: $${r.ema50.toFixed(2)} | RSI: ${r.rsi.toFixed(1)}

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);
const v = vwap();

// Compra: Pullback en tendencia alcista
if (close > slow && momentum > 40 && momentum < 70) {
  if (crossover(fast, slow) || (close > fast && m.histogram > 0)) {
    buy();
    log("Compra: Tendencia alcista + momentum positivo");
  }
}

// Rebote en VWAP
if (close > v && crossover(close, fast) && momentum < 60) {
  buy();
  log("Compra: Rebote VWAP");
}

// Venta: Sobrecompra o p√©rdida de tendencia
if (momentum > 75 || crossunder(fast, slow)) {
  sell();
  log("Venta: " + (momentum > 75 ? "RSI alto" : "Death cross"));
}

config({ stopLoss: ${Math.max(1.5,(r.ema20-o.support)/r.ema20*100).toFixed(1)}, takeProfit: ${Math.max(3,(o.resistance-r.ema20)/r.ema20*100).toFixed(1)} });`;else if(i<=35)x=`Tendencia bajista, Score ${i}/100.`,m=`// Tendencia Bajista ‚Äî ${t}
// Generado por Kairos AI | Score: ${i}/100
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);

// Short: rechazo de EMA en bajista
if (close < slow && momentum < 55) {
  if (crossunder(fast, slow) || (close < fast && m.histogram < 0)) {
    sell();
    log("Short: Rechazo EMA bajista");
  }
}

// Cubrir: RSI sobreventa extrema
if (momentum < 25) {
  buy();
  log("Cubrir: RSI extremo");
}

config({ stopLoss: 2, takeProfit: 4 });`;else if(r.squeeze)x="BB Squeeze detectado. Volatility breakout.",m=`// BB Breakout ‚Äî ${t}
// Generado por Kairos AI | BB Width: ${r.bbWidth.toFixed(2)}%
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const bands = bb(20, 2);
const momentum = rsi(14);
const m = macd(12, 26, 9);

// Breakout alcista
if (close > bands.upper && momentum > 50 && momentum < 80 && m.histogram > 0) {
  buy();
  log("Breakout alcista BB");
}

// Breakout bajista
if (close < bands.lower && momentum < 50 && momentum > 20 && m.histogram < 0) {
  sell();
  log("Breakout bajista BB");
}

// Salida
if (close < bands.middle && change(close, 3) < 0) {
  sell();
  log("Salida: momentum perdido");
}

config({ stopLoss: ${(r.bbWidth/2).toFixed(1)}, takeProfit: ${(r.bbWidth*1.5).toFixed(1)} });`;else if(r.rsi<35||r.rsi>65){const u=r.rsi<35;x=`RSI ${r.rsi.toFixed(1)} ‚Äî ${u?"Sobreventa":"Sobrecompra"}.`,m=`// RSI Reversal ‚Äî ${t}
// Generado por Kairos AI | RSI: ${r.rsi.toFixed(1)}
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const momentum = rsi(14);
const fast = ema(20);
const slow = ema(50);
const m = macd(12, 26, 9);

${u?`// Compra en sobreventa
if (momentum < 30 && m.histogram > m.signal) {
  buy();
  log("Compra: RSI sobreventa + MACD girando");
}
if (momentum < 35 && crossover(fast, slow)) {
  buy();
  log("Compra: RSI bajo + Golden Cross");
}
if (momentum > 65) {
  sell();
  log("Venta: tomar ganancia");
}`:`// Venta en sobrecompra
if (momentum > 70 && m.histogram < m.signal) {
  sell();
  log("Venta: RSI sobrecompra");
}
if (momentum < 40) {
  buy();
  log("Cubrir: RSI normalizado");
}`}

config({ stopLoss: 2, takeProfit: 4.5 });`}else x=`Mercado lateral. Rango $${o.support.toFixed(2)} ‚Äî $${o.resistance.toFixed(2)}.`,m=`// Rango ‚Äî ${t}
// Generado por Kairos AI | Score: ${i}/100
// Soporte: $${o.support.toFixed(2)} | Resistencia: $${o.resistance.toFixed(2)}
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const bands = bb(20, 2);
const momentum = rsi(14);
const v = vwap();

// Compra en soporte
if (close < bands.lower && momentum < 35) {
  buy();
  log("Compra: soporte BB + RSI bajo");
}
if (crossover(close, v) && momentum < 50) {
  buy();
  log("Compra: rebote VWAP");
}

// Venta en resistencia
if (close > bands.upper && momentum > 65) {
  sell();
  log("Venta: resistencia BB + RSI alto");
}
if (momentum > 75) {
  sell();
  log("Venta: RSI sobrecompra");
}

config({ stopLoss: ${Math.max(1.5,(o.resistance-o.support)/o.support*100/3).toFixed(1)}, takeProfit: ${Math.max(2.5,(o.resistance-o.support)/o.support*100*.6).toFixed(1)} });`;const g=`üíª **KAIROS SCRIPT ‚Äî ${t}**

üìä ${x}

**C√≥mo usar:**
1. Copia el c√≥digo
2. Ve a **Bots** ‚Üí Script Bot
3. Pega ‚Üí Backtest ‚Üí Activar

_Basado en an√°lisis real ‚Äî Score: ${i}/100_`;return this._reply(g,null,m)}catch{const a=this._genericScript(t);return this._reply(`üíª **KAIROS SCRIPT ‚Äî ${t}**

Script multi-indicador profesional.

**C√≥mo usar:** Copia ‚Üí Bots ‚Üí Script Bot ‚Üí Backtest ‚Üí Activar`,null,a)}}_genericScript(t){return`// Multi-Indicador ‚Äî ${t}
// Generado por Kairos AI
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);
const bands = bb(20, 2);
const v = vwap();

// COMPRA
if (crossover(fast, slow) && momentum > 40 && momentum < 65) {
  buy();
  log("Compra: Golden Cross + RSI ok");
}
if (close < bands.lower && momentum < 30) {
  buy();
  log("Compra: Sobreventa + soporte BB");
}
if (crossover(close, v) && close > fast && momentum > 45) {
  buy();
  log("Compra: VWAP breakout");
}

// VENTA
if (crossunder(fast, slow) && momentum < 55) {
  sell();
  log("Venta: Death Cross");
}
if (momentum > 75 && close > bands.upper) {
  sell();
  log("Venta: Sobrecompra + resistencia BB");
}
if (crossunder(m.line, m.signal) && momentum > 60) {
  sell();
  log("Venta: MACD bearish cross");
}

config({ stopLoss: 2, takeProfit: 4.5 });`}_educate(t){const s=this._matchKB(t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));return s?this._reply(s):this._reply(`üìö Puedo ense√±arte sobre:

**Indicadores:** RSI, EMA, SMA, MACD, Bollinger, VWAP, Fibonacci
**Conceptos:** Scalping, Swing, Day Trading, Tendencia, Soporte/Resistencia
**Riesgo:** Stop Loss, Take Profit, Position Sizing, Apalancamiento
**Patrones:** Doji, Engulfing, Hammer, Doble Techo, Cabeza y Hombros
**Avanzado:** Liquidez, Order Blocks, Smart Money, Volumen

Pregunta lo que quieras.`)}_matchKB(t){const s=[];for(const[a,r]of Object.entries(zs))r.some(l=>t.includes(l))&&s.push(Os[a]);return s.length===0?null:`üìö **Kairos Academy**

${s.join(`

`)}

üí° _¬øQuieres que analice un par usando esto? Di "Analiza" + par._`}async _openAI(t,s,a){let r="";if((a.analyze||a.strategy||a.kairosScript)&&(a.detectedPair||s!=null&&s.symbol))try{const i=await this._analyze(a.detectedPair||s.symbol);r=`

[DATOS REAL-TIME ‚Äî ${i.pair}]
Precio: $${i.price}
EMA20: $${i.ind.ema20.toFixed(2)}
EMA50: $${i.ind.ema50.toFixed(2)}
RSI: ${i.ind.rsi.toFixed(1)}
MACD: ${i.ind.macdHist.toFixed(6)}
BB Width: ${i.ind.bbWidth.toFixed(2)}%
Tendencia: ${i.trend.short}/${i.trend.mid}
Score: ${i.score}/100
Soporte: $${i.levels.support.toFixed(2)}
Resistencia: $${i.levels.resistance.toFixed(2)}`}catch{}const l="Eres Kairos AI, experto de trading de Kairos Trade (Kairos 777 Inc). Responde en espa√±ol. S√© directo y profesional. Usa datos reales proporcionados. Nunca des consejos financieros personales. Incluye siempre SL/TP en estrategias."+(a.kairosScript?`

Para Kairos Script:
${He}`:"");try{const i=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"system",content:l},...this.conversationHistory.slice(-20).map(n=>({role:n.role,content:n.content+(n.role==="user"?r:"")}))],temperature:.7,max_tokens:2e3})});if(!i.ok)throw new Error("API error");const m=(await i.json()).choices[0].message.content;let x=null;a.changePair&&a.detectedPair&&(x={type:"changePair",pair:a.detectedPair});const g=m.match(/```(?:javascript|kairos|js)?\n([\s\S]*?)```/),u=g?g[1].trim():null;return this.conversationHistory.push({role:"assistant",content:m}),{text:m.replace(/```(?:javascript|kairos|js)?\n[\s\S]*?```/g,"").trim(),strategy:this._extractStrategy(m),kairosScript:u,action:x}}catch{return await this._engine(t,s,a)}}_reply(t,s=null,a=null,r=null){return this.conversationHistory.push({role:"assistant",content:t}),{text:t,strategy:s,kairosScript:a,action:r}}_extractStrategy(t){const s=t.match(/```strategy\n([\s\S]*?)```/);if(s)try{return JSON.parse(s[1])}catch{}return null}clearHistory(){this.conversationHistory=[],this._cache.clear()}}const Ge=new Ls;function dt(){const{aiMessages:d,addAiMessage:t,aiLoading:s,setAiLoading:a,clearAiMessages:r,currentPrice:l,selectedPair:i,priceChange24h:o,setSelectedPair:m,setPage:x}=H(),[g,u]=S.useState(""),[n,b]=S.useState(null),c=S.useRef(null);S.useEffect(()=>{var k;(k=c.current)==null||k.scrollIntoView({behavior:"smooth"})},[d]);const f=S.useCallback(async k=>{var w;const N=k||g.trim();if(!(!N||s)){t({role:"user",content:N,time:new Date().toLocaleTimeString()}),k||u(""),a(!0);try{const B=l?{symbol:i,price:l,changePercent:o,high:l*1.02,low:l*.98,volume:0,quoteVolume:0}:null,P=await Ge.chat(N,B);((w=P.action)==null?void 0:w.type)==="changePair"&&m(P.action.pair),t({role:"assistant",content:P.text,strategy:P.strategy,kairosScript:P.kairosScript,action:P.action,time:new Date().toLocaleTimeString()})}catch(B){t({role:"assistant",content:`‚ùå Error: ${B.message}`,time:new Date().toLocaleTimeString()})}a(!1)}},[g,s,l,i,o]),y=(k,N)=>{navigator.clipboard.writeText(k),b(N),setTimeout(()=>b(null),2e3)},h=[{label:`Analiza ${i}`,icon:oe,prompt:`Analiza ${i}`},{label:"Crea un Script Bot",icon:Ze,prompt:`Crea un kairos script ganador para ${i}`},{label:"Estrategia ganadora",icon:Se,prompt:`Dame una estrategia para ${i} seg√∫n el mercado`},{label:"¬øQu√© es el RSI?",icon:yt,prompt:"¬øQu√© es el RSI y c√≥mo se usa?"},{label:"Mu√©strame SOLUSDT",icon:et,prompt:"Mu√©strame SOLUSDT"},{label:"Ayuda",icon:he,prompt:"¬øQu√© puedes hacer?"}],j=k=>k.split(`
`).map((N,w)=>{const P=N.split(/(\*\*.*?\*\*)/g).map((A,M)=>A.startsWith("**")&&A.endsWith("**")?e.jsx("strong",{children:A.slice(2,-2)},M):A.startsWith("_")&&A.endsWith("_")?e.jsx("em",{className:"text-[var(--text-dim)]",children:A.slice(1,-1)},M):A);return N.startsWith("‚îÅ‚îÅ")||N.startsWith("‚îÄ‚îÄ")?e.jsx("div",{className:"border-t border-[var(--border)] my-1.5 pt-1",children:P},w):N.startsWith("‚Ä¢")||N.startsWith("- ")?e.jsx("p",{className:"ml-2 my-0.5",children:P},w):N===""?e.jsx("div",{className:"h-1"},w):e.jsx("p",{className:"my-0.5",children:P},w)}),C=(k,N)=>{var B;const w=k.role==="user";return e.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${w?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[90%] rounded-2xl p-3 ${w?"bg-[var(--gold)] text-white rounded-br-md":"bg-[var(--dark-3)] text-[var(--text)] rounded-bl-md"}`,children:[!w&&e.jsxs("div",{className:"flex items-center gap-1 mb-1.5",children:[e.jsx(fe,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsx("div",{className:"text-[13px] whitespace-pre-wrap leading-relaxed",children:j(k.content)}),((B=k.action)==null?void 0:B.type)==="changePair"&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-[var(--gold)]/10 border border-[var(--gold)]/20 rounded-lg",children:[e.jsx(et,{size:12,className:"text-[var(--gold)]"}),e.jsxs("span",{className:"text-xs text-[var(--gold)] font-semibold",children:["Gr√°fico: ",k.action.pair]})]}),e.jsx("button",{onClick:()=>{m(k.action.pair),x("chart")},className:"px-2 py-1 text-[11px] bg-[var(--dark-4)] text-[var(--text-dim)] hover:text-[var(--gold)] rounded-lg transition-colors",children:"Ver gr√°fico ‚Üí"})]}),k.strategy&&e.jsxs("div",{className:"mt-2 p-2.5 bg-[var(--dark-4)] rounded-xl border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ee,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Estrategia"})]}),e.jsx("p",{className:"text-xs mb-1",children:k.strategy.name||"Auto Strategy"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--text-dim)]",children:[e.jsxs("span",{children:["SL: ",k.strategy.stopLoss]}),e.jsxs("span",{children:["TP: ",k.strategy.takeProfit]}),e.jsxs("span",{children:["R:R: ",k.strategy.riskReward]})]}),e.jsx("button",{onClick:()=>{H.getState().addStrategy(k.strategy),t({role:"assistant",content:"‚úÖ Estrategia guardada. Act√≠vala desde **Bots** ‚Üí crear bot con esta estrategia.",time:new Date().toLocaleTimeString()})},className:"mt-1.5 px-3 py-1 bg-[var(--gold)] text-white text-xs font-bold rounded-lg hover:bg-[var(--gold-light)] transition-colors",children:"Guardar Estrategia"})]}),k.kairosScript&&e.jsxs("div",{className:"mt-2 rounded-xl overflow-hidden border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-[var(--gold)]/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ze,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[11px] font-bold text-[var(--gold)]",children:"Kairos Script"})]}),e.jsx("button",{onClick:()=>y(k.kairosScript,N),className:"flex items-center gap-1 px-2 py-0.5 text-[10px] bg-[var(--dark)] rounded-md text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:n===N?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{size:10})," Copiado"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{size:10})," Copiar"]})})]}),e.jsx("pre",{className:"p-3 bg-[#0B0E11] text-[11px] leading-relaxed overflow-x-auto max-h-64 overflow-y-auto",children:e.jsx("code",{className:"text-[var(--text-secondary)]",children:k.kairosScript})}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-4)]",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(k.kairosScript),b(N),setTimeout(()=>b(null),2e3),x("bots")},className:"flex items-center gap-1 px-3 py-1 bg-[var(--gold)] text-white text-[11px] font-bold rounded-lg hover:bg-[var(--gold-light)] transition-colors",children:[e.jsx(ee,{size:11})," Copiar e ir a Bots"]}),e.jsx("button",{onClick:()=>x("strategies"),className:"px-2 py-1 text-[11px] text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:"Ver Scripts ‚Üí"})]})]}),e.jsx("p",{className:`text-[10px] mt-1.5 ${w?"text-white/60":"text-[var(--text-dim)]"}`,children:k.time})]})},N)};return e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)]/20 flex items-center justify-center",children:e.jsx(fe,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold",children:"Kairos AI"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Experto de trading ‚Ä¢ An√°lisis en tiempo real"})]})]}),e.jsx("button",{onClick:()=>{r(),Ge.clearHistory()},className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(ge,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[d.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(fe,{size:48,className:"text-[var(--gold)] mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Kairos AI"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Experto en trading. Analizo el mercado, genero estrategias y creo c√≥digo para bots autom√°ticos."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-sm",children:h.map((k,N)=>{const w=k.icon;return e.jsxs("button",{onClick:()=>f(k.prompt),className:"flex items-center gap-2 p-2.5 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl text-[12px] hover:border-[var(--gold)]/30 transition-colors text-left",children:[e.jsx(w,{size:14,className:"text-[var(--gold)] shrink-0"}),e.jsx("span",{className:"truncate",children:k.label})]},N)})})]}),d.map(C),s&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-2xl rounded-bl-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(fe,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]",children:"Analizando mercado..."})]})]})}),e.jsx("div",{ref:c})]}),e.jsx("div",{className:"p-3 border-t border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:g,onChange:k=>u(k.target.value),onKeyDown:k=>k.key==="Enter"&&!k.shiftKey&&f(),placeholder:"Analiza BTC, crea un script, ¬øqu√© es RSI?...",className:"flex-1 text-sm"}),e.jsx("button",{onClick:()=>f(),disabled:!g.trim()||s,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:e.jsx(Qt,{size:16})})]})})]})}const qs=[{name:"EMA Cross Classic",description:"Cruces de EMA r√°pida/lenta ‚Äî Tendencia",entry:{condition:"EMA 20 cruza por encima de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},exit:{condition:"EMA 20 cruza por debajo de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},stopLoss:"2",takeProfit:"4"},{name:"RSI Reversal",description:"Compra en sobreventa, vende en sobrecompra",entry:{condition:"RSI < 30 (sobreventa)",indicator:"rsi",params:{period:14,oversold:30}},exit:{condition:"RSI > 70 (sobrecompra)",indicator:"rsi",params:{period:14,overbought:70}},stopLoss:"1.5",takeProfit:"3"},{name:"MACD Momentum",description:"Cruce de l√≠nea MACD y se√±al",entry:{condition:"MACD cruza por encima de se√±al",indicator:"macd_cross",params:{fast:12,slow:26,signal:9}},exit:{condition:"MACD cruza por debajo de se√±al",indicator:"macd_cross",params:{}},stopLoss:"2",takeProfit:"4"},{name:"EMA + RSI Combo",description:"M√°s preciso: cruces de EMA confirmados con RSI",entry:{condition:"EMA 20 > EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"}];function Ks(){const{strategies:d,addStrategy:t,removeStrategy:s,setPage:a}=H(),[r,l]=S.useState(!1),[i,o]=S.useState(null),[m,x]=S.useState("custom"),g=d.filter(c=>c.type==="custom_script"),u=d.filter(c=>c.type!=="custom_script"),n=c=>{t({...c,pair:"BTCUSDT",timeframe:"1h"})},b=c=>{o(c),l(!0)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Estrategias de Trading"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Crea estrategias con c√≥digo o usa plantillas predefinidas"})]}),e.jsxs("button",{onClick:()=>{o(null),l(!0)},className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(ae,{size:16})," Crear con C√≥digo"]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>x("custom"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${m==="custom"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(ae,{size:14})," Custom Scripts (",g.length,")"]}),e.jsxs("button",{onClick:()=>x("preset"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${m==="preset"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(ee,{size:14})," Predefinidas (",u.length,")"]})]}),m==="custom"&&e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl p-6 text-center",style:{background:"linear-gradient(135deg, rgba(168,85,247,0.08) 0%, rgba(59,130,246,0.08) 100%)",border:"1px solid rgba(168,85,247,0.15)"},children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-3",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(ae,{size:24,className:"text-[#A855F7]"})}),e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Kairos Script"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4 max-w-md mx-auto",children:"Escribe tu propia estrategia con c√≥digo simple, o p√≠dele a ChatGPT que la genere por ti. M√°s f√°cil que Pine Script, m√°s potente que MQL."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>{o(null),l(!0)},className:"flex items-center gap-2 px-5 py-2.5 btn-gold rounded-xl text-sm font-bold",children:[e.jsx(ae,{size:14})," Crear Estrategia"]}),e.jsxs("button",{onClick:()=>{var f;(f=navigator.clipboard)==null||f.writeText("Crea una estrategia de trading que use EMA, RSI y MACD para detectar entradas de alta probabilidad")},className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold transition-colors",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(Ie,{size:14})," Copiar Prompt para ChatGPT"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{step:"1",title:"Pide a ChatGPT",desc:"Dile qu√© estrategia quieres con nuestro prompt optimizado",color:"#A855F7"},{step:"2",title:"Pega el C√≥digo",desc:"Copia el c√≥digo que te gener√≥ y p√©galo en el editor",color:"#3B82F6"},{step:"3",title:"Activa el Bot",desc:"Testea con backtest y as√≠gnala a un Script Bot",color:"#00DC82"}].map(({step:c,title:f,desc:y,color:h})=>e.jsxs("div",{className:"rounded-xl p-4 flex gap-3",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shrink-0 text-sm font-black",style:{background:`${h}15`,color:h,border:`1px solid ${h}25`},children:c}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold mb-0.5",children:f}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:y})]})]},c))}),g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Mis Scripts (",g.length,")"]}),g.map(c=>{var f;return e.jsxs(_.div,{layout:!0,className:"rounded-xl p-4 flex items-center justify-between",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(ae,{size:18,className:"text-[#A855F7]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:c.name}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[((f=c.code)==null?void 0:f.split(`
`).filter(y=>y.trim()&&!y.trim().startsWith("//")).length)||0," l√≠neas de l√≥gica"," ‚Ä¢ ","Creada: ",new Date(c.createdAt).toLocaleDateString("es")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(c),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(wt,{size:12})," Editar"]}),e.jsxs("button",{onClick:()=>a("bots"),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/10 text-[var(--green)] rounded-lg text-xs font-bold border border-[var(--green)]/20",children:[e.jsx(le,{size:12})," Usar en Bot"]}),e.jsx("button",{onClick:()=>s(c.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(ge,{size:14})})]})]},c.id)})]}):e.jsxs("div",{className:"rounded-xl p-8 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(ae,{size:32,className:"text-[var(--text-dim)]/20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No tienes scripts custom a√∫n"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primera estrategia personalizada"})]})]}),m==="preset"&&e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:qs.map((c,f)=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{size:16,className:"text-[var(--gold)]"}),e.jsx("h3",{className:"text-sm font-bold",children:c.name})]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:c.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--green)]",children:"‚ñ≤"})," ",c.entry.condition]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--red)]",children:"‚ñº"})," ",c.exit.condition]}),e.jsxs("p",{className:"text-[var(--text-dim)]",children:["SL: ",c.stopLoss,"% | TP: ",c.takeProfit,"%"]})]}),e.jsx("button",{onClick:()=>n(c),className:"w-full py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:"Usar Plantilla"})]},c.name))}),u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Guardadas (",u.length,")"]}),u.map(c=>{var f;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:c.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[(f=c.entry)==null?void 0:f.condition," | SL: ",c.stopLoss,"% | TP: ",c.takeProfit,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a("bots"),className:"px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold",children:[e.jsx(le,{size:12,className:"inline mr-1"})," Usar en Bot"]}),e.jsx("button",{onClick:()=>s(c.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)]",children:e.jsx(ge,{size:14})})]})]},c.id)})]})]}),e.jsx(Q,{children:r&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{l(!1),o(null)},children:e.jsx(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:e.jsx(At,{initialCode:i==null?void 0:i.code,initialName:i==null?void 0:i.name,editMode:!!i,onClose:()=>{l(!1),o(null)},onSave:c=>{t(c),l(!1),o(null)}})})})})]})}function Us(){const{tradeHistory:d,positions:t}=H(),[s,a]=S.useState("open"),r=d.reduce((o,m)=>o+(m.pnl||0),0),l=d.filter(o=>(o.pnl||0)>0).length,i=d.length>0?l/d.length*100:0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Historial de Trading"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[d.length," trades cerrados ‚Ä¢ ",t.length," posiciones abiertas"]})]}),e.jsxs("button",{onClick:()=>{const o=[["Par","Lado","Entrada","Salida","Cantidad","P&L","Fecha Apertura","Fecha Cierre"]];d.forEach(n=>{var b,c;o.push([n.symbol,n.side,(b=n.entryPrice)==null?void 0:b.toFixed(2),((c=n.exitPrice)==null?void 0:c.toFixed(2))||"",n.quantity,(n.pnl||0).toFixed(2),n.openedAt||"",n.closedAt||""])});const m=o.map(n=>n.join(",")).join(`
`),x=new Blob([m],{type:"text/csv"}),g=URL.createObjectURL(x),u=document.createElement("a");u.href=g,u.download=`kairos-trades-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(g)},className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all border border-[var(--border)]",children:[e.jsx(Xt,{size:14})," Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-bold",children:d.length})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L Total"}),e.jsxs("p",{className:`text-lg font-bold ${r>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[r>=0?"+":"","$",r.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[i.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Posiciones Abiertas"}),e.jsx("p",{className:"text-lg font-bold text-[var(--blue)]",children:t.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>a("open"),className:`px-4 py-1.5 text-sm rounded-md ${s==="open"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Abiertas (",t.length,")"]}),e.jsxs("button",{onClick:()=>a("closed"),className:`px-4 py-1.5 text-sm rounded-md ${s==="closed"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Cerradas (",d.length,")"]})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-[var(--text-dim)] text-xs",children:[e.jsx("th",{className:"text-left p-3",children:"Par"}),e.jsx("th",{className:"text-left p-3",children:"Lado"}),e.jsx("th",{className:"text-right p-3",children:"Entrada"}),e.jsx("th",{className:"text-right p-3",children:"Cantidad"}),e.jsx("th",{className:"text-right p-3",children:"P&L"}),e.jsx("th",{className:"text-right p-3",children:"Fecha"})]})}),e.jsx("tbody",{children:(s==="open"?t:d).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-[var(--text-dim)]",children:s==="open"?"Sin posiciones abiertas":"Sin trades cerrados"})}):(s==="open"?t:d).map((o,m)=>{var x,g;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--dark-3)] transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:o.symbol}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold
                    ${o.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:(x=o.side)==null?void 0:x.toUpperCase()})}),e.jsxs("td",{className:"p-3 text-right font-mono",children:["$",(g=o.entryPrice)==null?void 0:g.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right font-mono",children:o.quantity}),e.jsxs("td",{className:`p-3 text-right font-mono font-bold ${(o.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(o.pnl||0)>=0?"+":"","$",(o.pnl||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-right text-xs text-[var(--text-dim)]",children:new Date(o.openedAt||o.closedAt).toLocaleDateString()})]},o.id||m)})})]})})]})}const xt="kairos_trade_simulator";class Vs{constructor(){this.state=this._load()}_load(){try{const t=JSON.parse(localStorage.getItem(xt));if(t)return t}catch{}return this._defaultState()}_defaultState(){return{balance:1e4,initialBalance:1e4,positions:[],closedTrades:[],orders:[],equity:1e4,stats:{totalTrades:0,wins:0,losses:0,totalPnl:0,bestTrade:0,worstTrade:0,avgWin:0,avgLoss:0,maxDrawdown:0,sharpeRatio:0},equityHistory:[{time:Date.now(),value:1e4}],createdAt:new Date().toISOString()}}_save(){localStorage.setItem(xt,JSON.stringify(this.state))}reset(t=1e4){return this.state=this._defaultState(),this.state.balance=t,this.state.initialBalance=t,this.state.equity=t,this.state.equityHistory=[{time:Date.now(),value:t}],this._save(),this.state}async openPosition(t,s,a,r={}){const l=await W.getPrice(t),i=l*a;if(i>this.state.balance)throw new Error(`Fondos insuficientes. Necesitas $${i.toFixed(2)}, tienes $${this.state.balance.toFixed(2)}`);const o={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),symbol:t,side:s,quantity:a,entryPrice:l,currentPrice:l,cost:i,pnl:0,pnlPercent:0,stopLoss:r.stopLoss||null,takeProfit:r.takeProfit||null,leverage:r.leverage||1,openedAt:new Date().toISOString()};return this.state.balance-=i,this.state.positions.push(o),this._save(),{success:!0,position:o,message:`${s.toUpperCase()} ${a} ${t} @ $${l.toFixed(2)}`}}async closePosition(t){const s=this.state.positions.findIndex(m=>m.id===t);if(s===-1)throw new Error("Posici√≥n no encontrada");const a=this.state.positions[s],r=await W.getPrice(a.symbol),l=a.side==="buy"?(r-a.entryPrice)*a.quantity*a.leverage:(a.entryPrice-r)*a.quantity*a.leverage,i=l/a.cost*100,o={...a,exitPrice:r,pnl:l,pnlPercent:i,closedAt:new Date().toISOString(),duration:Date.now()-new Date(a.openedAt).getTime()};return this.state.balance+=a.cost+l,this.state.positions.splice(s,1),this.state.closedTrades.push(o),this._updateStats(l),this._save(),{success:!0,trade:o,message:`Cerrada: ${l>=0?"+":""}$${l.toFixed(2)} (${i.toFixed(1)}%)`}}async placeLimitOrder(t,s,a,r,l={}){const i=await W.getPrice(t),o={id:Date.now().toString(36),symbol:t,side:s,quantity:a,targetPrice:r,currentPrice:i,type:"limit",stopLoss:l.stopLoss||null,takeProfit:l.takeProfit||null,status:"pending",createdAt:new Date().toISOString()};return this.state.orders.push(o),this._save(),{success:!0,order:o}}cancelOrder(t){return this.state.orders=this.state.orders.filter(s=>s.id!==t),this._save(),{success:!0}}async updatePositions(){let t=this.state.balance;for(const s of this.state.positions)try{const a=await W.getPrice(s.symbol);if(s.currentPrice=a,s.pnl=s.side==="buy"?(a-s.entryPrice)*s.quantity*(s.leverage||1):(s.entryPrice-a)*s.quantity*(s.leverage||1),s.pnlPercent=s.pnl/s.cost*100,t+=s.cost+s.pnl,s.stopLoss&&(s.side==="buy"?a<=s.stopLoss:a>=s.stopLoss)){await this.closePosition(s.id);continue}if(s.takeProfit&&(s.side==="buy"?a>=s.takeProfit:a<=s.takeProfit)){await this.closePosition(s.id);continue}}catch{}for(const s of this.state.orders.filter(a=>a.status==="pending"))try{const a=await W.getPrice(s.symbol);(s.side==="buy"?a<=s.targetPrice:a>=s.targetPrice)&&(s.status="filled",await this.openPosition(s.symbol,s.side,s.quantity,{stopLoss:s.stopLoss,takeProfit:s.takeProfit}))}catch{}return this.state.orders=this.state.orders.filter(s=>s.status==="pending"),this.state.equity=t,this.state.equityHistory.push({time:Date.now(),value:t}),this.state.equityHistory.length>500&&(this.state.equityHistory=this.state.equityHistory.slice(-500)),this._save(),this.state}_updateStats(t){const s=this.state.stats;s.totalTrades++,s.totalPnl+=t,t>0?(s.wins++,s.bestTrade=Math.max(s.bestTrade,t)):(s.losses++,s.worstTrade=Math.min(s.worstTrade,t)),s.avgWin=s.wins>0?s.totalPnl/s.wins:0,s.avgLoss=s.losses>0?(s.totalPnl-s.avgWin*s.wins)/s.losses:0;const a=Math.max(...this.state.equityHistory.map(i=>i.value));s.maxDrawdown=(a-this.state.equity)/a*100,s.winRate=s.totalTrades>0?s.wins/s.totalTrades*100:0;const r=this.state.closedTrades.filter(i=>i.pnl>0).reduce((i,o)=>i+o.pnl,0),l=Math.abs(this.state.closedTrades.filter(i=>i.pnl<0).reduce((i,o)=>i+o.pnl,0));s.profitFactor=l>0?r/l:r>0?1/0:0}getState(){return this.state}getPerformance(){const t=this.state,s=(t.equity-t.initialBalance)/t.initialBalance*100;return{balance:t.balance,equity:t.equity,initialBalance:t.initialBalance,returnPct:s,openPositions:t.positions.length,pendingOrders:t.orders.length,...t.stats}}}const te=new Vs;function Ws({data:d,height:t=140}){const s=S.useRef(null);return S.useEffect(()=>{const a=s.current;if(!a||!d||d.length<2)return;const r=a.getContext("2d"),l=window.devicePixelRatio||1,i=a.clientWidth,o=a.clientHeight;a.width=i*l,a.height=o*l,r.scale(l,l),r.clearRect(0,0,i,o);const m=d.map(A=>A.value),x=Math.min(...m)*.998,g=Math.max(...m)*1.002,u=g-x||1,n={top:8,bottom:20,left:0,right:0},b=i-n.left-n.right,c=o-n.top-n.bottom,f=A=>n.left+A/(d.length-1)*b,y=A=>n.top+c-(A-x)/u*c,h=m[0],j=m[m.length-1],C=j>=h,k=C?"#00DC82":"#FF3B30";r.beginPath(),r.moveTo(f(0),y(m[0]));for(let A=1;A<m.length;A++)r.lineTo(f(A),y(m[A]));r.lineTo(f(m.length-1),o-n.bottom),r.lineTo(f(0),o-n.bottom),r.closePath();const N=r.createLinearGradient(0,0,0,o);N.addColorStop(0,C?"rgba(0,220,130,0.2)":"rgba(255,59,48,0.2)"),N.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=N,r.fill(),r.beginPath(),r.moveTo(f(0),y(m[0]));for(let A=1;A<m.length;A++)r.lineTo(f(A),y(m[A]));r.strokeStyle=k,r.lineWidth=2,r.lineJoin="round",r.stroke(),r.beginPath(),r.setLineDash([3,3]);const w=y(h);r.moveTo(0,w),r.lineTo(i,w),r.strokeStyle="#3B82F640",r.lineWidth=1,r.stroke(),r.setLineDash([]),r.fillStyle="#666",r.font="9px Inter, sans-serif",r.textAlign="left",r.fillText(`$${x.toFixed(0)}`,4,o-n.bottom+12),r.textAlign="right",r.fillText(`$${g.toFixed(0)}`,i-4,o-n.bottom+12);const B=f(m.length-1),P=y(j);r.beginPath(),r.arc(B,P,3,0,Math.PI*2),r.fillStyle=k,r.fill(),r.beginPath(),r.arc(B,P,6,0,Math.PI*2),r.strokeStyle=k,r.lineWidth=1,r.globalAlpha=.4,r.stroke(),r.globalAlpha=1},[d,t]),!d||d.length<2?e.jsx("div",{className:"flex items-center justify-center text-xs text-[var(--text-dim)]",style:{height:t},children:"Ejecuta trades para ver la curva de equity"}):e.jsx("canvas",{ref:s,style:{width:"100%",height:t}})}function Hs(){var j,C,k,N;const{selectedPair:d,currentPrice:t,setPage:s}=H(),[a,r]=S.useState(te.getState()),[l,i]=S.useState(te.getPerformance()),[o,m]=S.useState({quantity:"",stopLoss:"",takeProfit:"",side:"buy"}),[x,g]=S.useState(!1),[u,n]=S.useState(null);S.useEffect(()=>{const w=setInterval(async()=>{const B=await te.updatePositions();r({...B}),i(te.getPerformance())},1e4);return()=>clearInterval(w)},[]);const b=S.useCallback(async()=>{const w=await te.updatePositions();r({...w}),i(te.getPerformance())},[]),c=async()=>{if(!(!o.quantity||!t)){g(!0);try{const w=await te.openPosition(d,o.side,parseFloat(o.quantity),{stopLoss:o.stopLoss?parseFloat(o.stopLoss):null,takeProfit:o.takeProfit?parseFloat(o.takeProfit):null});n({type:"success",text:w.message}),m({...o,quantity:"",stopLoss:"",takeProfit:""}),await b()}catch(w){n({type:"error",text:w.message})}g(!1),setTimeout(()=>n(null),3e3)}},f=async w=>{try{const B=await te.closePosition(w);n({type:B.trade.pnl>=0?"success":"error",text:B.message}),await b()}catch(B){n({type:"error",text:B.message})}setTimeout(()=>n(null),3e3)},y=()=>{te.reset(1e4),r(te.getState()),i(te.getPerformance()),n({type:"success",text:"Simulador reiniciado con $10,000"}),setTimeout(()=>n(null),2e3)},h=l.returnPct||0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-[var(--gold)]"}),"Paper Trading Simulator"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Practica con datos reales, sin arriesgar dinero real"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:"Actualizar"}),e.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--red)]/20 text-[var(--red)] rounded-lg text-xs font-bold hover:bg-[var(--red)]/30 transition-colors",children:[e.jsx(jt,{size:12})," Reiniciar"]})]})]}),e.jsx(Q,{children:u&&e.jsx(_.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-3 rounded-xl text-sm font-bold text-center ${u.type==="success"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:u.text})}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Balance",value:`$${(j=l.balance)==null?void 0:j.toFixed(2)}`,icon:we,color:"var(--gold)"},{label:"Equity",value:`$${(C=l.equity)==null?void 0:C.toFixed(2)}`,icon:oe,color:"var(--blue)"},{label:"Retorno",value:`${h>=0?"+":""}${h.toFixed(2)}%`,icon:h>=0?ie:Ne,color:h>=0?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${(l.winRate||0).toFixed(0)}%`,icon:Jt,color:"var(--gold)"},{label:"Trades",value:l.totalTrades||0,icon:Se,color:"var(--text)"}].map((w,B)=>{const P=w.icon;return e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:B*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx(P,{size:16,style:{color:w.color},className:"mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold font-mono",style:{color:w.color},children:w.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:w.label})]},w.label)})}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"P&L Total",value:`${l.totalPnl>=0?"+":""}$${(l.totalPnl||0).toFixed(2)}`,color:(l.totalPnl||0)>=0?"var(--green)":"var(--red)"},{label:"Mejor Trade",value:`+$${(l.bestTrade||0).toFixed(2)}`,color:"var(--green)"},{label:"Peor Trade",value:`$${(l.worstTrade||0).toFixed(2)}`,color:"var(--red)"},{label:"Max Drawdown",value:`${(l.maxDrawdown||0).toFixed(1)}%`,color:"var(--red)"}].map(w=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:w.label}),e.jsx("p",{className:"text-sm font-bold font-mono",style:{color:w.color},children:w.value})]},w.label))}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(ie,{size:14,className:"text-[var(--gold)]"})," Curva de Equity"]}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[((k=a.equityHistory)==null?void 0:k.length)||0," puntos"]})]}),e.jsx("div",{className:"p-2",children:e.jsx(Ws,{data:a.equityHistory,height:160})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Abrir Posici√≥n (Demo)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--gold)]",children:d}),e.jsxs("span",{className:"text-sm font-mono",children:["$",(t==null?void 0:t.toLocaleString(void 0,{maximumFractionDigits:2}))||"---"]}),e.jsx("button",{onClick:()=>s("chart"),className:"text-xs text-[var(--gold)] hover:underline ml-auto",children:"Ver gr√°fico ‚Üí"})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>m({...o,side:"buy"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${o.side==="buy"?"bg-[var(--green)] text-white":"text-[var(--text-dim)]"}`,children:"COMPRAR"}),e.jsx("button",{onClick:()=>m({...o,side:"sell"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${o.side==="sell"?"bg-[var(--red)] text-white":"text-[var(--text-dim)]"}`,children:"VENDER"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Cantidad"}),e.jsx("input",{type:"number",value:o.quantity,onChange:w=>m({...o,quantity:w.target.value}),placeholder:"Ej: 0.01",className:"w-full text-sm"}),o.quantity&&t&&e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] mt-1",children:["Costo: $",(parseFloat(o.quantity)*t).toFixed(2)," de $",(N=l.balance)==null?void 0:N.toFixed(2)," disponible"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(ce,{size:10})," Stop Loss"]}),e.jsx("input",{type:"number",value:o.stopLoss,onChange:w=>m({...o,stopLoss:w.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(Se,{size:10})," Take Profit"]}),e.jsx("input",{type:"number",value:o.takeProfit,onChange:w=>m({...o,takeProfit:w.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsx("button",{onClick:c,disabled:!o.quantity||!t||x,className:`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50 ${o.side==="buy"?"bg-[var(--green)] text-white":"bg-[var(--red)] text-white"}`,children:x?"Ejecutando...":`${o.side==="buy"?"Comprar":"Vender"} ${d.replace("USDT","")} (Demo)`})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold mb-3",children:["Posiciones Abiertas (",a.positions.length,")"]}),a.positions.length===0?e.jsx("p",{className:"text-sm text-[var(--text-dim)] text-center py-8",children:"Sin posiciones abiertas"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.positions.map(w=>{var B,P,A,M;return e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded ${w.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:w.side.toUpperCase()}),e.jsx("span",{className:"text-sm font-bold",children:w.symbol})]}),e.jsx("button",{onClick:()=>f(w.id),className:"px-2 py-0.5 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cerrar"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Entrada"}),e.jsxs("p",{className:"font-mono",children:["$",(B=w.entryPrice)==null?void 0:B.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Actual"}),e.jsxs("p",{className:"font-mono",children:["$",(P=w.currentPrice)==null?void 0:P.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`font-mono font-bold ${w.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[w.pnl>=0?"+":"","$",(A=w.pnl)==null?void 0:A.toFixed(2)," (",(M=w.pnlPercent)==null?void 0:M.toFixed(1),"%)"]})]})]})]},w.id)})})]})]}),a.closedTrades.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-[var(--border)]",children:e.jsx("h3",{className:"text-sm font-bold",children:"Historial de Trades (Demo)"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left p-2",children:"Par"}),e.jsx("th",{className:"text-left p-2",children:"Lado"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"})]})}),e.jsx("tbody",{children:a.closedTrades.slice().reverse().map(w=>{var B,P,A;return e.jsxs("tr",{className:"border-b border-[var(--border)]/50 hover:bg-[var(--dark-3)]",children:[e.jsx("td",{className:"p-2 font-bold",children:w.symbol}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:w.side==="buy"?"text-[var(--green)]":"text-[var(--red)]",children:w.side.toUpperCase()})}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(B=w.entryPrice)==null?void 0:B.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(P=w.exitPrice)==null?void 0:P.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-mono font-bold ${w.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[w.pnl>=0?"+":"","$",(A=w.pnl)==null?void 0:A.toFixed(2)]})]},w.id)})})]})})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"‚ö†Ô∏è Esto es un simulador con datos reales del mercado. No se usa dinero real."}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Practica tus estrategias sin riesgo."})]})]})}function Gs(){var m;const{settings:d,updateSettings:t,user:s}=H(),[a,r]=S.useState(""),[l,i]=S.useState(!1),o=()=>{a.trim()&&(Ge.setApiKey(a.trim()),t({openaiKey:a.trim()}),i(!0),setTimeout(()=>i(!1),2e3))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Ajustes"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Configuraci√≥n de tu plataforma"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-[var(--gold)]"})," Perfil"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Nombre:"})," ",s==null?void 0:s.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Plan:"})," ",e.jsx("span",{className:"text-[var(--gold)]",children:(m=s==null?void 0:s.plan)==null?void 0:m.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Ue,{size:16,className:"text-[var(--gold)]"})," API Key de OpenAI"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-2",children:"Opcional. Sin API key, Kairos AI usa an√°lisis local integrado. Con API key, accedes a GPT-4 para an√°lisis avanzado."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:a,onChange:x=>r(x.target.value),placeholder:"sk-...",className:"flex-1 text-sm font-mono"}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl text-sm font-bold",children:l?"‚úì Guardado":"Guardar"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Zt,{size:16,className:"text-[var(--gold)]"})," Trading por Defecto"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo m√°x. por trade (%)"}),e.jsx("input",{type:"number",value:d.maxRiskPerTrade,onChange:x=>t({maxRiskPerTrade:parseFloat(x.target.value)}),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Apalancamiento predeterminado"}),e.jsx("input",{type:"number",value:d.defaultLeverage,onChange:x=>t({defaultLeverage:parseFloat(x.target.value)}),className:"w-full text-sm"})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ye,{size:16,className:"text-[var(--gold)]"})," Notificaciones"]}),e.jsx("div",{className:"space-y-3",children:[{key:"notifications",label:"Notificaciones",desc:"Alertas de trades y se√±ales"},{key:"soundAlerts",label:"Sonido",desc:"Alertas sonoras al ejecutar trades"}].map(x=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:x.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:x.desc})]}),e.jsx("button",{onClick:()=>t({[x.key]:!d[x.key]}),className:`w-12 h-6 rounded-full transition-colors relative
                  ${d[x.key]?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform
                    ${d[x.key]?"left-6":"left-0.5"}`})})]},x.key))})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx($e,{size:16,className:"text-[var(--gold)]"})," Kairos Wallet"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:"Conecta tu Kairos Wallet para usar KAIROS Coin como m√©todo de pago y recibir recompensas."}),e.jsxs("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--gold)]/20 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx($e,{size:14})," Abrir Kairos Wallet"]})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"Kairos Trade v1.0.0 ‚Ä¢ Kairos 777 Inc"}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Powered by Kairos AI"})]})]})}const mt="kairos_trade_alerts";class Qs{constructor(){this.alerts=this._load(),this.triggered=[],this.monitoring=!1,this.interval=null,this.callbacks=new Set}_load(){try{return JSON.parse(localStorage.getItem(mt))||[]}catch{return[]}}_save(){localStorage.setItem(mt,JSON.stringify(this.alerts))}subscribe(t){return this.callbacks.add(t),()=>this.callbacks.delete(t)}_notify(t){this.callbacks.forEach(s=>s(t)),Notification.permission==="granted"&&new Notification(`Kairos Trade ‚Äî ${t.symbol}`,{body:t.message,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%23D4AF37"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%230A0A0F" font-family="serif" font-weight="bold">K</text></svg>'})}async requestPermission(){Notification.permission!=="granted"&&await Notification.requestPermission()}addPriceAlert(t,s,a,r={}){const l={id:Date.now().toString(36),type:"price",symbol:t,condition:s,targetPrice:parseFloat(a),active:!0,repeat:r.repeat||!1,message:`${t} ${s==="above"?">":"<"} $${a}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}addSignalAlert(t,s,a={}){const r={ema_cross:`EMA ${a.fast||20}/${a.slow||50} Cross`,rsi_oversold:`RSI < ${a.threshold||30}`,rsi_overbought:`RSI > ${a.threshold||70}`,macd_cross:"MACD Signal Cross",volume_spike:`Volume Spike > ${a.multiplier||2}x avg`},l={id:Date.now().toString(36),type:"signal",symbol:t,signalType:s,params:a,active:!0,repeat:a.repeat||!1,message:`${t}: ${r[s]||s}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}removeAlert(t){this.alerts=this.alerts.filter(s=>s.id!==t),this._save()}getAlerts(){return this.alerts}getTriggered(){return this.triggered}_ensureMonitoring(){this.monitoring||(this.monitoring=!0,this.interval=setInterval(()=>this._check(),15e3),this._check())}stop(){this.monitoring=!1,this.interval&&clearInterval(this.interval)}async _check(){const t=this.alerts.filter(a=>a.active);if(t.length===0)return;const s={};t.forEach(a=>{s[a.symbol]||(s[a.symbol]=[]),s[a.symbol].push(a)});for(const[a,r]of Object.entries(s))try{const l=await W.getPrice(a);for(const i of r){let o=!1;i.type==="price"&&(i.condition==="above"&&l>=i.targetPrice&&(o=!0),i.condition==="below"&&l<=i.targetPrice&&(o=!0)),i.type==="signal"&&(o=await this._checkSignal(a,i)),o&&(i.triggeredAt=new Date().toISOString(),i.triggeredPrice=l,this.triggered.push({...i}),this._notify({...i,currentPrice:l,message:`üîî ${i.message} ‚Äî Precio actual: $${l.toLocaleString()}`}),i.repeat||(i.active=!1))}}catch{}this._save()}async _checkSignal(t,s){try{const a=await W.getCandles(t,"1h",60),r=a.map(i=>i.close),l=r.length;switch(s.signalType){case"ema_cross":{const i=Z(r,s.params.fast||20),o=Z(r,s.params.slow||50);return be(i,o,l-1)!==null}case"rsi_oversold":return de(r,s.params.period||14)[l-1]<(s.params.threshold||30);case"rsi_overbought":return de(r,s.params.period||14)[l-1]>(s.params.threshold||70);case"macd_cross":{const{macd:i,signal:o}=Be(r);return be(i,o,l-1)!==null}case"volume_spike":{const i=a.map(m=>m.volume),o=i.slice(-20).reduce((m,x)=>m+x,0)/20;return i[l-1]>o*(s.params.multiplier||2)}default:return!1}}catch{return!1}}}const se=new Qs,Ys=[{id:"ema_cross",label:"EMA Cruce",desc:"EMA 20/50 crossover",icon:qe},{id:"rsi_oversold",label:"RSI Sobreventa",desc:"RSI < 30",icon:Ne},{id:"rsi_overbought",label:"RSI Sobrecompra",desc:"RSI > 70",icon:ie},{id:"macd_cross",label:"MACD Cruce",desc:"MACD/Signal crossover",icon:ee},{id:"volume_spike",label:"Spike Volumen",desc:"Volumen > 2x promedio",icon:Nt}];function Xs(){const{selectedPair:d}=H(),[t,s]=S.useState([]),[a,r]=S.useState([]),[l,i]=S.useState("active"),[o,m]=S.useState({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1});S.useEffect(()=>{s(se.getAlerts()),r(se.getTriggered());const n=se.subscribe(()=>{s([...se.getAlerts()]),r([...se.getTriggered()])});return se.requestPermission(),n},[]);const x=()=>{if(o.type==="price"){if(!o.price)return;se.addPriceAlert(d,o.condition,o.price,{repeat:o.repeat})}else se.addSignalAlert(d,o.signalType,{repeat:o.repeat});s([...se.getAlerts()]),m({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1}),i("active")},g=n=>{se.removeAlert(n),s([...se.getAlerts()])},u=t.filter(n=>n.active);return t.filter(n=>!n.active),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(_.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight flex items-center gap-2",children:[e.jsx(ye,{size:22,className:"text-[var(--gold)]"}),"Alertas"]}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:[u.length," alerta",u.length!==1?"s":""," activa",u.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>i("create"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold text-white transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:[e.jsx(Ke,{size:16}),"Nueva Alerta"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[{id:"active",label:`Activas (${u.length})`},{id:"triggered",label:`Disparadas (${a.length})`},{id:"create",label:"Crear"}].map(n=>e.jsx("button",{onClick:()=>i(n.id),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-200
              ${l===n.id?"text-white":"text-[var(--text-dim)]"}`,style:l===n.id?{background:"linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.08))",border:"1px solid rgba(59,130,246,0.15)"}:{},children:n.label},n.id))}),e.jsx(Q,{children:l==="create"&&e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl p-5 space-y-4",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Crear Alerta para ",d]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m({...o,type:"price"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${o.type==="price"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Precio"}),e.jsx("button",{onClick:()=>m({...o,type:"signal"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${o.type==="signal"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Se√±al T√©cnica"})]}),o.type==="price"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2",children:["above","below"].map(n=>e.jsxs("button",{onClick:()=>m({...o,condition:n}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1.5
                        ${o.condition===n?n==="above"?"bg-[var(--green)]/10 text-[var(--green)] border border-[var(--green)]/15":"bg-[var(--red)]/10 text-[var(--red)] border border-[var(--red)]/15":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:[n==="above"?e.jsx(ie,{size:12}):e.jsx(Ne,{size:12}),n==="above"?"Sube a":"Baja a"]},n))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Precio objetivo (USD)"}),e.jsx("input",{type:"number",value:o.price,onChange:n=>m({...o,price:n.target.value}),placeholder:"Ej: 100000",className:"w-full",step:"any"})]})]}):e.jsx("div",{className:"space-y-2",children:Ys.map(n=>{const b=n.icon;return e.jsxs("button",{onClick:()=>m({...o,signalType:n.id}),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left
                        ${o.signalType===n.id?"bg-[var(--gold)]/10 border border-[var(--gold)]/15":"bg-[var(--dark-3)] border border-transparent hover:border-[var(--border)]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${o.signalType===n.id?"bg-[var(--gold)]/15":"bg-[var(--dark-4)]"}`,children:e.jsx(b,{size:14,className:o.signalType===n.id?"text-[var(--gold)]":"text-[var(--text-dim)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:n.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:n.desc})]})]},n.id)})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("div",{className:`w-9 h-5 rounded-full transition-colors relative ${o.repeat?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,onClick:()=>m({...o,repeat:!o.repeat}),children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform ${o.repeat?"translate-x-4":"translate-x-0.5"}`})}),e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Repetir alerta"})]}),e.jsx("button",{onClick:x,disabled:o.type==="price"&&!o.price,className:"w-full py-3 text-white font-bold rounded-xl text-sm transition-all disabled:opacity-40",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:"Crear Alerta"})]})}),l==="active"&&e.jsx("div",{className:"space-y-2",children:u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas activas"}),e.jsx("button",{onClick:()=>i("create"),className:"text-xs text-[var(--gold)] mt-2 font-semibold",children:"Crear primera alerta ‚Üí"})]}):u.map((n,b)=>e.jsxs(_.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:b*.04},className:"flex items-center gap-3 p-3 rounded-xl group",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0",style:{background:n.type==="price"?"rgba(59,130,246,0.08)":"rgba(139,92,246,0.08)"},children:n.type==="price"?n.condition==="above"?e.jsx(ie,{size:16,className:"text-[var(--green)]"}):e.jsx(Ne,{size:16,className:"text-[var(--red)]"}):e.jsx(ee,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:n.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:n.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.repeat&&e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] bg-[var(--gold)]/10 px-1.5 py-0.5 rounded",children:"‚Üª"}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("button",{onClick:()=>g(n.id),className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/[0.06] transition-all opacity-0 group-hover:opacity-100",children:e.jsx(ge,{size:13})})]})]},n.id))}),l==="triggered"&&e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas disparadas"})]}):[...a].reverse().map((n,b)=>{var c;return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(14,203,129,0.04), rgba(17,19,24,0.6))",border:"1px solid rgba(14,203,129,0.08)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--green)]/[0.08] flex items-center justify-center shrink-0",children:e.jsx(pe,{size:16,className:"text-[var(--green)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:n.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:n.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono text-[var(--green)]",children:["$",(c=n.triggeredPrice)==null?void 0:c.toLocaleString()]}),e.jsx("p",{className:"text-[9px] text-[var(--text-dim)]",children:new Date(n.triggeredAt).toLocaleTimeString()})]})]},`${n.id}-${b}`)})})]})}function Js(){const{positions:d,orders:t,tradeHistory:s,bots:a,currentPrice:r,closePosition:l,cancelOrder:i}=H(),[o,m]=S.useState("positions"),[x,g]=S.useState(!1),u=a.flatMap(c=>(c.tradeLog||c.trades_log||[]).map(y=>({...y,botName:c.name,botId:c.id}))).sort((c,f)=>new Date(f.time||f.timestamp||0)-new Date(c.time||c.timestamp||0)),n=a.filter(c=>c.status==="active"),b=[{id:"positions",label:"Posiciones",count:d.length},{id:"orders",label:"√ìrdenes",count:t.length},{id:"botTrades",label:"Bot Trades",count:u.length},{id:"history",label:"Historial",count:s.length}];return x?e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 cursor-pointer shrink-0 select-none",style:{borderTop:"1px solid rgba(30,34,45,0.6)",background:"rgba(14,16,21,0.95)"},onClick:()=>g(!1),children:[e.jsx("div",{className:"flex items-center gap-3",children:b.map(c=>e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)] font-medium",children:[c.label," ",e.jsxs("span",{className:"text-[var(--text-dim)]/60",children:["(",c.count,")"]})]},c.id))}),e.jsx(es,{size:14,className:"text-[var(--text-dim)]"})]}):e.jsxs("div",{className:"flex flex-col shrink-0",style:{height:200,borderTop:"1px solid rgba(30,34,45,0.6)",background:"rgba(14,16,21,0.95)"},children:[e.jsxs("div",{className:"flex items-center shrink-0 px-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:[b.map(c=>e.jsxs("button",{onClick:()=>m(c.id),className:`px-3 py-2 text-[11px] font-semibold transition-colors relative
              ${o===c.id?"text-[var(--text)]":"text-[var(--text-dim)] hover:text-[var(--text-secondary)]"}`,children:[c.label,c.count>0&&e.jsx("span",{className:`ml-1 text-[9px] px-1.5 py-0.5 rounded-full font-bold
                ${o===c.id?"bg-[var(--gold)]/15 text-[var(--gold)]":"bg-white/5 text-[var(--text-dim)]"}`,children:c.count}),o===c.id&&e.jsx("div",{className:"absolute bottom-0 left-1 right-1 h-[2px] rounded-t-full bg-[var(--gold)]"})]},c.id)),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>g(!0),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--text)] transition-colors mr-1",children:e.jsx(ts,{size:14})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",style:{scrollbarWidth:"thin"},children:[o==="positions"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Entrada"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Actual"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"SL"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"TP"}),e.jsx("th",{className:"text-right py-1.5 px-3 font-semibold",children:"Acci√≥n"})]})}),e.jsx("tbody",{children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin posiciones abiertas"})}):d.map(c=>{const f=r||c.entryPrice,y=c.side==="buy"?(f-c.entryPrice)*c.quantity:(c.entryPrice-f)*c.quantity,h=y/(c.entryPrice*c.quantity)*100;return e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:c.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${c.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":"text-[var(--red)] bg-[var(--red)]/10"}`,children:c.side==="buy"?"LONG":"SHORT"})}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:c.quantity}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(c.entryPrice).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(f).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:`py-1.5 px-2 text-right font-mono font-bold ${y>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[y>=0?"+":"",y.toFixed(2)," ",e.jsxs("span",{className:"text-[9px] opacity-70",children:["(",h>=0?"+":"",h.toFixed(2),"%)"]})]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-[var(--red)]",children:c.stopLoss?`$${c.stopLoss}`:"‚Äî"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-[var(--green)]",children:c.takeProfit?`$${c.takeProfit}`:"‚Äî"}),e.jsx("td",{className:"py-1.5 px-3 text-right",children:e.jsx("button",{onClick:()=>l(c.id),className:"text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] px-2 py-1 rounded-md hover:bg-[var(--red)]/10 transition-all",children:"Cerrar"})})]},c.id)})})]}),o==="orders"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Tipo"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Precio"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Total"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Fecha"}),e.jsx("th",{className:"text-right py-1.5 px-3 font-semibold",children:"Acci√≥n"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin √≥rdenes pendientes"})}):t.map(c=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:c.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded bg-white/5 text-[var(--text-secondary)]",children:c.type==="limit"?"LIMIT":c.type==="stop_loss"?"STOP":"MARKET"})}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold ${c.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:c.side==="buy"?"COMPRA":"VENTA"})}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(c.price).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:c.quantity}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",(c.price*c.quantity).toFixed(2)]}),e.jsx("td",{className:"py-1.5 px-2 text-[var(--text-dim)]",children:c.createdAt?new Date(c.createdAt).toLocaleString("es",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî"}),e.jsx("td",{className:"py-1.5 px-3 text-right",children:e.jsx("button",{onClick:()=>i(c.id),className:"text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] px-2 py-1 rounded-md hover:bg-[var(--red)]/10 transition-all",children:"Cancelar"})})]},c.id))})]}),o==="botTrades"&&e.jsxs("div",{children:[n.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",style:{borderBottom:"1px solid rgba(30,34,45,0.3)"},children:[e.jsx(ue,{size:12,className:"text-[var(--gold)]"}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[n.length," bot",n.length>1?"s":""," activo",n.length>1?"s":""]}),n.map(c=>e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-[var(--green)]/10 text-[var(--green)] font-semibold",children:[c.name," ‚Ä¢ ",c.trades||0," trades ‚Ä¢ P&L: ",(c.pnl||0)>=0?"+":"","$",(c.pnl||0).toFixed(2)]},c.id))]}),e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Bot"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Se√±al"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Precio"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Hora"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:a.length===0?"No hay bots configurados":"Los bots no han ejecutado trades a√∫n"})}):u.slice(0,50).map((c,f)=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-semibold text-[var(--gold)]",children:c.botName||"Bot"}),e.jsx("td",{className:"py-1.5 px-2 font-bold text-[var(--text)]",children:c.symbol||c.pair||"‚Äî"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded
                        ${c.signal==="buy"||c.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":c.signal==="sell"||c.side==="sell"?"text-[var(--red)] bg-[var(--red)]/10":"text-[var(--text-dim)] bg-white/5"}`,children:(c.signal||c.side||"HOLD").toUpperCase()})}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:c.price?`$${Number(c.price).toLocaleString(void 0,{minimumFractionDigits:2})}`:"‚Äî"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:c.quantity||c.amount||"‚Äî"}),e.jsx("td",{className:`py-1.5 px-2 text-right font-mono font-bold
                      ${(c.pnl||0)>0?"text-[var(--green)]":(c.pnl||0)<0?"text-[var(--red)]":"text-[var(--text-dim)]"}`,children:c.pnl!=null?`${c.pnl>=0?"+":""}$${c.pnl.toFixed(2)}`:"‚Äî"}),e.jsx("td",{className:"py-1.5 px-3 text-[var(--text-dim)]",children:c.time||c.timestamp?new Date(c.time||c.timestamp).toLocaleString("es",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"‚Äî"})]},f))})]})]}),o==="history"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Entrada"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Salida"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Fecha"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin trades cerrados"})}):[...s].reverse().slice(0,50).map((c,f)=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:c.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${c.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":"text-[var(--red)] bg-[var(--red)]/10"}`,children:c.side==="buy"?"LONG":"SHORT"})}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(c.entryPrice).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",c.exitPrice?Number(c.exitPrice).toLocaleString(void 0,{minimumFractionDigits:2}):"‚Äî"]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:c.quantity}),e.jsxs("td",{className:`py-1.5 px-2 text-right font-mono font-bold ${(c.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(c.pnl||0)>=0?"+":"","$",(c.pnl||0).toFixed(2)]}),e.jsx("td",{className:"py-1.5 px-3 text-[var(--text-dim)]",children:c.closedAt?new Date(c.closedAt).toLocaleString("es",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî"})]},c.id||f))})]})]})]})}function Zs(){const[d,t]=S.useState("chart"),{selectedPair:s}=H();return e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex gap-1 px-3 pt-2 shrink-0",style:{background:"var(--surface)"},children:[["chart","Chart"],["depth","Depth"]].map(([a,r])=>e.jsx("button",{onClick:()=>t(a),className:`px-3 py-1.5 text-xs font-bold rounded-t-lg transition-colors ${d===a?"text-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--text-secondary)]"}`,style:d===a?{background:"var(--dark)",borderTop:"2px solid var(--gold)"}:{},children:r},a))}),d==="chart"?e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex flex-col",children:e.jsx(Ns,{})}):e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex flex-col",children:e.jsx(Ss,{pair:s||"BTCUSDT",height:500})})]}),e.jsx(Js,{})]}),e.jsx(ks,{})]})}function ea(){const{isAuthenticated:d,currentPage:t,aiPanelOpen:s}=H();if(!d)return e.jsx(fs,{});const a=()=>{switch(t){case"dashboard":return e.jsx(rt,{});case"chart":return e.jsx(Zs,{});case"bots":return e.jsx(Ms,{});case"simulator":return e.jsx(Hs,{});case"brokers":return e.jsx(_s,{});case"ai":return e.jsx(dt,{});case"strategies":return e.jsx(Ks,{});case"history":return e.jsx(Us,{});case"alerts":return e.jsx(Xs,{});case"wallet":return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)]/15 flex items-center justify-center text-[var(--gold)] text-2xl font-bold mx-auto mb-4",children:"K"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Kairos Wallet"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Conecta tu Kairos Wallet para integrar tus balances de KAIROS Coin con la plataforma de trading."}),e.jsx("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-[var(--gold)] text-white font-semibold rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Abrir Kairos Wallet"})]})});case"settings":return e.jsx(Gs,{});default:return e.jsx(rt,{})}};return e.jsxs("div",{className:"flex h-screen bg-[var(--dark)] overflow-hidden",children:[e.jsx(ss,{position:"top-right",toastOptions:{style:{background:"#181A20",color:"#EAECEF",border:"1px solid #1E222D",fontSize:"13px"}}}),e.jsx(gs,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(bs,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(Q,{mode:"wait",children:e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"flex-1 flex flex-col overflow-hidden",children:a()},t)}),e.jsx(Q,{children:s&&t!=="ai"&&e.jsx(_.div,{initial:{width:0,opacity:0},animate:{width:380,opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"border-l border-[var(--border)] overflow-hidden shrink-0",children:e.jsx(dt,{})})})]})]})]})}ps.createRoot(document.getElementById("root")).render(e.jsx(ns.StrictMode,{children:e.jsx(os,{children:e.jsx(ea,{})})}));
