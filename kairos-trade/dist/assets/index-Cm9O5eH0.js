import{j as e,m as I,U as nt,C as We,L as lt,B as re,P as ie,a as xe,Z as X,S as ne,b as $e,H as ot,c as pe,W as fe,d as ct,e as dt,A as W,f as xt,g as Pe,T as ae,h as me,i as pt,k as mt,l as de,n as ce,E as Ge,o as Qe,p as ut,q as Ce,D as ue,r as ht,s as Ye,t as gt,u as ye,v as J,X as vt,w as bt,x as ft,y as Te,M as yt,R as Je,z as je,F as jt,G as Nt,I as Xe,J as wt,K as Ne,N as St,O as kt,Q as Pt,V as le,Y as Ze,_ as Ct,$ as Tt,a0 as At,a1 as $t,a2 as Ft,a3 as Et,a4 as Bt,a5 as It,a6 as Dt}from"./ui-DU6piuzj.js";import{b as Rt,g as Mt,c as Ot,a as N,R as zt,B as _t}from"./vendor-CUCP814w.js";import{V as qt,a as Lt,I as Ut}from"./charts-UjLl1g-4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();var ve={},Re;function Kt(){if(Re)return ve;Re=1;var d=Rt();return ve.createRoot=d.createRoot,ve.hydrateRoot=d.hydrateRoot,ve}var Vt=Kt();const Ht=Mt(Vt),se={binance:{id:"binance",name:"Binance",logo:"üü°",baseUrl:"https://api.binance.com",wsUrl:"wss://stream.binance.com:9443/ws",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},bybit:{id:"bybit",name:"Bybit",logo:"üü†",baseUrl:"https://api.bybit.com",wsUrl:"wss://stream.bybit.com/v5/public/spot",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret"]},kraken:{id:"kraken",name:"Kraken",logo:"üü£",baseUrl:"https://api.kraken.com",wsUrl:"wss://ws.kraken.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},coinbase:{id:"coinbase",name:"Coinbase",logo:"üîµ",baseUrl:"https://api.coinbase.com",wsUrl:"wss://ws-feed.exchange.coinbase.com",supportedMarkets:["spot"],requiredFields:["apiKey","apiSecret","passphrase"]},kucoin:{id:"kucoin",name:"KuCoin",logo:"üü¢",baseUrl:"https://api.kucoin.com",wsUrl:"wss://ws-api.kucoin.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret","passphrase"]},okx:{id:"okx",name:"OKX",logo:"‚ö´",baseUrl:"https://www.okx.com",wsUrl:"wss://ws.okx.com:8443/ws/v5/public",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret","passphrase"]}},et=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT","DOGEUSDT","AVAXUSDT","DOTUSDT","MATICUSDT","LINKUSDT","ATOMUSDT","LTCUSDT","UNIUSDT","AAVEUSDT"],Ae=[{label:"1m",value:"1m",seconds:60},{label:"5m",value:"5m",seconds:300},{label:"15m",value:"15m",seconds:900},{label:"1H",value:"1h",seconds:3600},{label:"4H",value:"4h",seconds:14400},{label:"1D",value:"1d",seconds:86400},{label:"1W",value:"1w",seconds:604800}],q={AUTH:"kairos_trade_auth",BROKERS:"kairos_trade_brokers",BOTS:"kairos_trade_bots",SETTINGS:"kairos_trade_settings",STRATEGIES:"kairos_trade_strategies",POSITIONS:"kairos_trade_positions",ORDERS:"kairos_trade_orders",TRADE_HISTORY:"kairos_trade_history"},te=(d,s)=>{try{return JSON.parse(localStorage.getItem(d))||s}catch{return s}},G=(d,s)=>localStorage.setItem(d,JSON.stringify(s)),V=Ot((d,s)=>({user:te(q.AUTH,null),isAuthenticated:!!te(q.AUTH,null),login:t=>{G(q.AUTH,t),d({user:t,isAuthenticated:!0})},logout:()=>{localStorage.removeItem(q.AUTH),d({user:null,isAuthenticated:!1})},currentPage:"dashboard",setPage:t=>d({currentPage:t}),brokers:te(q.BROKERS,[]),activeBroker:null,addBroker:t=>{const a={...t,id:Date.now().toString(36),apiKey:btoa(t.apiKey),apiSecret:btoa(t.apiSecret),passphrase:t.passphrase?btoa(t.passphrase):void 0,connected:!1,addedAt:new Date().toISOString()},r=[...s().brokers,a];return G(q.BROKERS,r),d({brokers:r}),a},removeBroker:t=>{var r;const a=s().brokers.filter(l=>l.id!==t);G(q.BROKERS,a),d({brokers:a,activeBroker:((r=s().activeBroker)==null?void 0:r.id)===t?null:s().activeBroker})},setActiveBroker:t=>d({activeBroker:t}),updateBrokerStatus:(t,a)=>{const r=s().brokers.map(l=>l.id===t?{...l,connected:a}:l);G(q.BROKERS,r),d({brokers:r})},bots:te(q.BOTS,[]),addBot:t=>{const a={...t,id:Date.now().toString(36),status:"stopped",trades:0,pnl:0,winRate:0,createdAt:new Date().toISOString()},r=[...s().bots,a];return G(q.BOTS,r),d({bots:r}),a},updateBot:(t,a)=>{const r=s().bots.map(l=>l.id===t?{...l,...a}:l);G(q.BOTS,r),d({bots:r})},removeBot:t=>{const a=s().bots.filter(r=>r.id!==t);G(q.BOTS,a),d({bots:a})},selectedPair:"BTCUSDT",selectedTimeframe:"1h",currentPrice:null,priceChange24h:null,orderBook:{bids:[],asks:[]},positions:te(q.POSITIONS,[]),orders:te(q.ORDERS,[]),tradeHistory:te(q.TRADE_HISTORY,[]),setSelectedPair:t=>d({selectedPair:t}),setSelectedTimeframe:t=>d({selectedTimeframe:t}),setCurrentPrice:t=>d({currentPrice:t}),setPriceChange24h:t=>d({priceChange24h:t}),setOrderBook:t=>d({orderBook:t}),addPosition:t=>{const a=[...s().positions,{...t,id:Date.now().toString(36)}];G(q.POSITIONS,a),d({positions:a})},closePosition:t=>{const a=s().positions.find(r=>r.id===t);if(a){const r=s().currentPrice||a.entryPrice,l=a.side==="buy"?(r-a.entryPrice)*a.quantity:(a.entryPrice-r)*a.quantity,i={...a,closedAt:new Date().toISOString(),exitPrice:r,pnl:l},n=s().positions.filter(p=>p.id!==t),x=[...s().tradeHistory,i];G(q.POSITIONS,n),G(q.TRADE_HISTORY,x),d({positions:n,tradeHistory:x})}},addOrder:t=>{const a=[...s().orders,{...t,id:Date.now().toString(36)}];G(q.ORDERS,a),d({orders:a})},cancelOrder:t=>{const a=s().orders.filter(r=>r.id!==t);G(q.ORDERS,a),d({orders:a})},strategies:te(q.STRATEGIES,[]),addStrategy:t=>{const a={...t,id:Date.now().toString(36),createdAt:new Date().toISOString()},r=[...s().strategies,a];return G(q.STRATEGIES,r),d({strategies:r}),a},removeStrategy:t=>{const a=s().strategies.filter(r=>r.id!==t);G(q.STRATEGIES,a),d({strategies:a})},aiMessages:[],aiLoading:!1,addAiMessage:t=>d({aiMessages:[...s().aiMessages,t]}),setAiLoading:t=>d({aiLoading:t}),clearAiMessages:()=>d({aiMessages:[]}),settings:te(q.SETTINGS,{theme:"dark",language:"es",notifications:!0,soundAlerts:!0,maxRiskPerTrade:2,defaultLeverage:1}),updateSettings:t=>{const a={...s().settings,...t};G(q.SETTINGS,a),d({settings:a})},sidebarOpen:!0,aiPanelOpen:!1,modalOpen:null,toggleSidebar:()=>d({sidebarOpen:!s().sidebarOpen}),toggleAiPanel:()=>d({aiPanelOpen:!s().aiPanelOpen}),setModal:t=>d({modalOpen:t})})),Wt=[{label:"Principal",items:[{id:"dashboard",icon:lt,label:"Dashboard",desc:"Panel de control"},{id:"chart",icon:re,label:"Trading",desc:"Gr√°ficos en vivo"},{id:"simulator",icon:ie,label:"Simulador",desc:"Paper trading"}]},{label:"Automatizaci√≥n",items:[{id:"bots",icon:xe,label:"Bots",desc:"Trading autom√°tico"},{id:"strategies",icon:X,label:"Estrategias",desc:"Crear y gestionar"},{id:"ai",icon:ne,label:"Kairos AI",desc:"Asistente IA",accent:!0}]},{label:"Gesti√≥n",items:[{id:"brokers",icon:$e,label:"Brokers",desc:"Conexiones API"},{id:"history",icon:ot,label:"Historial",desc:"Trades y reportes"},{id:"alerts",icon:pe,label:"Alertas",desc:"Notificaciones"}]}],Gt=[{id:"wallet",icon:fe,label:"Wallet"},{id:"settings",icon:ct,label:"Ajustes"}];function Qt(){const{currentPage:d,setPage:s,sidebarOpen:t,toggleSidebar:a,bots:r,brokers:l,logout:i,user:n}=V(),[x,p]=N.useState(null),g=r.filter(b=>b.status==="active").length,u=l.filter(b=>b.connected).length,o=b=>b==="bots"?g:b==="brokers"?u:0,f=({item:b,compact:y=!1})=>{const m=b.icon,j=d===b.id,T=o(b.id),B=x===b.id;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>s(b.id),onMouseEnter:()=>p(b.id),onMouseLeave:()=>p(null),title:t?void 0:b.label,className:`w-full flex items-center rounded-xl transition-all duration-200 relative group
            ${t?"px-3 py-3 gap-3":"px-0 py-3 justify-center"}
            ${j?"text-white":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:[j&&e.jsx(I.div,{layoutId:"navBg",className:"absolute inset-0 rounded-xl",style:{background:b.accent?"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(96,165,250,0.06))":"linear-gradient(135deg, rgba(59,130,246,0.08), rgba(59,130,246,0.02))",border:"1px solid rgba(59,130,246,0.1)"},transition:{type:"spring",stiffness:350,damping:30}}),j&&e.jsx(I.div,{layoutId:"activeBar",className:"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-6 rounded-r-full",style:{background:"linear-gradient(180deg, #60A5FA, #3B82F6)"},transition:{type:"spring",stiffness:350,damping:30}}),e.jsxs("div",{className:`relative z-10 flex items-center justify-center shrink-0 rounded-lg transition-all duration-200
            ${t?"w-8 h-8":"w-9 h-9"}
            ${j?b.accent?"bg-[var(--gold)]/20":"bg-white/[0.06]":"bg-transparent group-hover:bg-white/[0.04]"}`,children:[e.jsx(m,{size:t?18:20,strokeWidth:j?2:1.5,className:`transition-colors ${j&&b.accent?"text-[var(--gold-light)]":""}`}),T>0&&!t&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-[14px] h-[14px] bg-[var(--gold)] rounded-full text-[8px] font-bold text-white flex items-center justify-center",children:T})]}),t&&e.jsxs("div",{className:"relative z-10 flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[13px] truncate leading-tight ${j?"font-semibold":"font-medium"}`,children:b.label}),b.accent&&e.jsx("span",{className:"text-[8px] font-bold bg-[var(--gold)]/20 text-[var(--gold-light)] px-1.5 py-0.5 rounded-full uppercase tracking-wider",children:"Pro"}),T>0&&e.jsx("span",{className:"ml-auto text-[10px] font-semibold bg-[var(--gold)]/12 text-[var(--gold)] rounded-full px-2 py-0.5 min-w-[22px] text-center",children:T})]}),!y&&b.desc&&e.jsx("span",{className:`text-[10px] leading-tight truncate block mt-0.5 transition-colors
                  ${j?"text-[var(--text-dim)]":"text-[var(--text-dim)]/50"}`,children:b.desc})]})]}),e.jsx(W,{children:!t&&B&&e.jsx(I.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] whitespace-nowrap",children:b.label}),b.desc&&e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] whitespace-nowrap",children:b.desc})]})})})]})},h=({label:b})=>t?e.jsxs("div",{className:"flex items-center gap-2 px-3 mb-2 mt-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--text-dim)]/40 uppercase tracking-[0.12em]",children:b}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]/50"})]}):e.jsx("div",{className:"mx-auto w-6 h-px bg-[var(--border)]/60 my-3"});return e.jsxs(I.aside,{animate:{width:t?260:72},transition:{duration:.25,ease:[.4,0,.2,1]},className:"h-full flex flex-col relative shrink-0",style:{borderRight:"1px solid var(--border)",background:"linear-gradient(180deg, #0E1015 0%, #08090C 100%)"},children:[e.jsxs("div",{className:`flex items-center shrink-0 ${t?"px-5 gap-3 h-[60px]":"justify-center h-[60px]"}`,style:{borderBottom:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center shrink-0 relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx("span",{className:"text-white font-extrabold text-sm",children:"K"}),e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{boxShadow:"0 0 20px rgba(59,130,246,0.2)"}})]}),t&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1,duration:.2},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-[15px] font-bold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-widest",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium tracking-wider",children:"BY KAIROS 777"})]})})]}),t&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-3 mt-4 mb-2 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.04), rgba(26,29,38,0.5))",border:"1px solid rgba(59,130,246,0.06)"},children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--dark-4)] flex items-center justify-center",children:e.jsx(nt,{size:14,className:"text-[var(--text-dim)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] truncate",children:(n==null?void 0:n.name)||"Trader"}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(We,{size:9,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] uppercase tracking-wider",children:"Free Plan"})]})]})]})}),e.jsx("nav",{className:`flex-1 overflow-y-auto py-2 ${t?"px-3":"px-2"}`,style:{scrollbarWidth:"none"},children:Wt.map((b,y)=>e.jsxs("div",{className:y>0?"mt-5":"mt-1",children:[e.jsx(h,{label:b.label}),e.jsx("div",{className:"space-y-0.5",children:b.items.map(m=>e.jsx(f,{item:m},m.id))})]},b.label))}),e.jsxs("div",{className:`py-3 ${t?"px-3":"px-2"}`,style:{borderTop:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"space-y-0.5",children:Gt.map(b=>e.jsx(f,{item:b,compact:!0},b.id))}),e.jsxs("button",{onClick:i,onMouseEnter:()=>p("logout"),onMouseLeave:()=>p(null),title:t?void 0:"Salir",className:`w-full flex items-center rounded-xl text-[var(--text-dim)] hover:text-[var(--red)] transition-all duration-200 mt-1 relative
            ${t?"px-3 py-2.5 gap-3":"px-0 py-2.5 justify-center"}
            hover:bg-[var(--red)]/[0.06]`,children:[e.jsx("div",{className:`flex items-center justify-center shrink-0 rounded-lg ${t?"w-8 h-8":"w-9 h-9"}`,children:e.jsx(dt,{size:t?16:18,strokeWidth:1.5})}),t&&e.jsx("span",{className:"text-[13px] font-medium",children:"Cerrar Sesi√≥n"}),e.jsx(W,{children:!t&&x==="logout"&&e.jsx(I.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsx("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:e.jsx("p",{className:"text-xs font-semibold text-[var(--red)] whitespace-nowrap",children:"Cerrar Sesi√≥n"})})})})]})]}),e.jsx("button",{onClick:a,className:"absolute -right-3 top-7 w-6 h-6 bg-[var(--dark-3)] border border-[var(--border)] rounded-full flex items-center justify-center text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 hover:bg-[var(--dark-4)] transition-all z-10 shadow-lg",children:t?e.jsx(xt,{size:11}):e.jsx(Pe,{size:11})})]})}function Yt(){const{selectedPair:d,currentPrice:s,priceChange24h:t,toggleAiPanel:a,aiPanelOpen:r,brokers:l}=V(),i=l.some(p=>p.connected),[n,x]=N.useState(!1);return e.jsxs("header",{className:"h-[56px] shrink-0 flex items-center justify-between px-5",style:{borderBottom:"1px solid rgba(26,29,38,0.6)",background:"linear-gradient(180deg, rgba(14,16,21,0.95) 0%, rgba(8,9,12,0.95) 100%)",backdropFilter:"blur(16px)"},children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.04))",border:"1px solid rgba(59,130,246,0.1)"},children:e.jsx("span",{className:"text-[var(--gold)]",children:d==null?void 0:d.replace("USDT","").slice(0,3)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[14px] font-bold text-[var(--text)] tracking-wide leading-none",children:d}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium",children:"Perpetual"})]})]}),e.jsx("div",{className:"w-px h-7 bg-[var(--border)]/50"}),s&&e.jsx("div",{children:e.jsxs("span",{className:"text-[16px] font-mono font-bold text-[var(--text)] leading-none",children:["$",s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),t!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-mono font-semibold px-2.5 py-1 rounded-lg
              ${t>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,style:{border:`1px solid ${t>=0?"rgba(14,203,129,0.12)":"rgba(246,70,93,0.12)"}`},children:[t>=0?e.jsx(ae,{size:12}):e.jsx(me,{size:12}),t>=0?"+":"",t==null?void 0:t.toFixed(2),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]/40 font-medium",children:"24h"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1.5 text-[11px] px-3 py-1.5 rounded-lg transition-all
          ${i?"text-[var(--green)] bg-[var(--green)]/[0.06] border border-[var(--green)]/10":"text-[var(--text-dim)] bg-white/[0.02] border border-[var(--border)]/50"}`,children:[i?e.jsx(pt,{size:12}):e.jsx(mt,{size:12}),e.jsx("span",{className:"font-semibold",children:i?"Live":"Demo"})]}),e.jsxs("button",{onClick:a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all border
            ${r?"bg-[var(--gold)]/10 text-[var(--gold)] border-[var(--gold)]/15":"text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border-[var(--border)]/50 hover:border-[var(--gold)]/20"}`,title:"Kairos AI",children:[e.jsx(de,{size:13}),e.jsx("span",{children:"AI"}),r&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gold)] animate-pulse"})]}),e.jsxs("button",{className:"p-2 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border border-[var(--border)]/50 hover:border-[var(--border)] transition-all relative",children:[e.jsx(pe,{size:15}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-[var(--gold)] rounded-full shadow-[0_0_6px_rgba(59,130,246,0.4)]"})]})]})]})}const Me=[{icon:ae,label:"Trading Profesional",desc:"Gr√°ficos TradingView con datos en tiempo real de Binance"},{icon:xe,label:"Bots Automatizados",desc:"Grid, DCA y bots de se√±ales ejecutan trades 24/7"},{icon:ne,label:"Kairos AI",desc:"Asistente con IA que analiza mercados y genera estrategias"},{icon:ce,label:"Simulador Pro",desc:"Paper trading con $10,000 virtuales y datos reales"}],Jt=[{value:"50+",label:"Pares de Trading"},{value:"6",label:"Exchanges"},{value:"24/7",label:"Automatizaci√≥n"},{value:"<1ms",label:"Latencia"}];function Xt(){const{login:d}=V(),[s,t]=N.useState(!0),[a,r]=N.useState({email:"",password:"",name:""}),[l,i]=N.useState(""),[n,x]=N.useState(!1),[p,g]=N.useState(!1),[u,o]=N.useState(0);N.useEffect(()=>{const h=setInterval(()=>{o(b=>(b+1)%Me.length)},3e3);return()=>clearInterval(h)},[]);const f=async h=>{if(h.preventDefault(),i(""),!a.email||!a.password){i("Completa todos los campos");return}if(!s&&!a.name){i("Ingresa tu nombre");return}if(a.password.length<6){i("La contrase√±a debe tener al menos 6 caracteres");return}x(!0),setTimeout(()=>{d({id:Date.now().toString(36),email:a.email,name:a.name||a.email.split("@")[0],plan:"free",createdAt:new Date().toISOString()}),x(!1)},800)};return e.jsxs("div",{className:"min-h-screen bg-[var(--dark)] flex relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[700px] h-[700px] rounded-full opacity-[0.03]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute bottom-[-20%] left-[-10%] w-[600px] h-[600px] rounded-full opacity-[0.02]",style:{background:"radial-gradient(circle, #60A5FA 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[900px] h-[900px] rounded-full opacity-[0.015]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 50%)"}}),e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:"linear-gradient(rgba(59,130,246,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.3) 1px, transparent 1px)",backgroundSize:"60px 60px"}})]}),e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col justify-between p-12 relative",children:[e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25), inset 0 1px 0 rgba(255,255,255,0.15)"},children:e.jsx("span",{className:"text-white font-extrabold text-lg",children:"K"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[17px] font-extrabold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[11px] font-bold text-gradient-gold tracking-[0.2em]",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)] font-medium tracking-[0.15em] uppercase",children:"by Kairos 777 Inc"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7,delay:.2},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-r from-transparent to-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-[0.2em] uppercase",children:"Professional Trading Platform"}),e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-l from-transparent to-[var(--gold)]"})]}),e.jsxs("h2",{className:"text-4xl font-extrabold text-[var(--text)] leading-[1.15] mb-4 tracking-tight",children:["Automatiza tu Trading",e.jsx("br",{}),e.jsx("span",{className:"text-gradient-gold",children:"con Inteligencia."})]}),e.jsx("p",{className:"text-[15px] text-[var(--text-secondary)] leading-relaxed mb-10 max-w-md",children:"Conecta tu exchange favorito y deja que nuestros bots inteligentes operen por ti. Datos en tiempo real, ejecuci√≥n autom√°tica, resultados profesionales."})]}),e.jsx("div",{className:"space-y-3 mb-10",children:Me.map((h,b)=>{const y=h.icon,m=b===u;return e.jsxs(I.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+b*.1},className:`flex items-start gap-4 p-3.5 rounded-xl transition-all duration-500 cursor-default ${m?"glass-gold":"bg-transparent"}`,onMouseEnter:()=>o(b),children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all duration-500
                    ${m?"bg-gradient-to-br from-[var(--gold)] to-[var(--gold-dark)] shadow-[0_0_20px_rgba(59,130,246,0.2)]":"bg-[var(--surface-2)] border border-[var(--border)]"}`,children:e.jsx(y,{size:18,className:`transition-colors duration-500 ${m?"text-white":"text-[var(--text-dim)]"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-[13px] font-bold transition-colors duration-500 ${m?"text-[var(--text)]":"text-[var(--text-secondary)]"}`,children:h.label}),e.jsx("p",{className:`text-[11px] mt-0.5 transition-colors duration-500 ${m?"text-[var(--text-secondary)]":"text-[var(--text-dim)]"}`,children:h.desc})]})]},h.label)})}),e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"flex gap-6",children:Jt.map(h=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-extrabold text-gradient-gold",children:h.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] font-medium mt-0.5",children:h.label})]},h.label))})]}),e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"relative z-10 flex items-center justify-between",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/40",children:"¬© 2026 Kairos 777 Inc. Todos los derechos reservados."}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("span",{className:"text-[10px] text-[var(--green)] font-semibold",children:"Sistemas operacionales"})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 lg:max-w-[480px] relative z-10",children:e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-[380px]",children:[e.jsxs("div",{className:"text-center mb-8 lg:hidden",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-white font-extrabold text-xl mx-auto mb-3",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25)"},children:"K"}),e.jsxs("h1",{className:"text-xl font-extrabold tracking-tight",children:[e.jsx("span",{className:"text-gradient-gold",children:"KAIROS"})," ",e.jsx("span",{className:"text-[var(--text)]",children:"TRADE"})]})]}),e.jsxs("div",{className:"mb-7",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-[var(--text)] tracking-tight",children:s?"Bienvenido.":"Empieza a operar."}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1.5",children:s?"Accede a tu plataforma de trading":"Crea tu cuenta en 30 segundos"})]}),e.jsxs("div",{className:"flex mb-7 rounded-xl p-1 glass",children:[e.jsx("button",{onClick:()=>{t(!0),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${s?"text-white font-bold shadow-lg":"text-[var(--text-dim)] font-medium hover:text-[var(--text)]"}`,style:s?{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"}:{},children:"Iniciar Sesi√≥n"}),e.jsx("button",{onClick:()=>{t(!1),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${s?"text-[var(--text-dim)] font-medium hover:text-[var(--text)]":"text-white font-bold shadow-lg"}`,style:s?{}:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"},children:"Registrarse"})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx(W,{mode:"wait",children:!s&&e.jsxs(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{type:"text",value:a.name,onChange:h=>r({...a,name:h.target.value}),placeholder:"Tu nombre completo",className:"w-full",autoComplete:"name"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:h=>r({...a,email:h.target.value}),placeholder:"tu@email.com",className:"w-full",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Contrase√±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",value:a.password,onChange:h=>r({...a,password:h.target.value}),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",className:"w-full pr-10",autoComplete:s?"current-password":"new-password"}),e.jsx("button",{type:"button",onClick:()=>g(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:p?e.jsx(Ge,{size:15}):e.jsx(Qe,{size:15})})]})]}),e.jsx(W,{children:l&&e.jsx(I.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},className:"text-xs text-[var(--red)] bg-[var(--red)]/[0.06] border border-[var(--red)]/10 px-3.5 py-2.5 rounded-xl",children:l})}),e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3.5 rounded-xl transition-all duration-300 disabled:opacity-50 flex items-center justify-center gap-2 text-sm btn-gold",children:n?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[s?"Acceder a la Plataforma":"Crear Cuenta",e.jsx(ut,{size:16})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-medium",children:"ECOSISTEMA"}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"})]}),e.jsxs("a",{href:"https://kairos-777.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--gold)] transition-all border border-[var(--border)] hover:border-[var(--gold)]/20",children:[e.jsx(We,{size:14,className:"text-[var(--gold)]"}),"Conoce el ecosistema Kairos 777"]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]/30 text-center mt-5",children:["Parte del ecosistema ",e.jsx("span",{className:"text-[var(--gold)] font-semibold",children:"Kairos 777"})]})]})})]})}class Zt{constructor(){this.ws=null,this.subscribers=new Map,this.reconnectAttempts=0,this.maxReconnect=5,this.candleCache=new Map}connectStream(s,t={}){const a=s.toLowerCase(),r=`wss://stream.binance.com:9443/ws/${a}@ticker/${a}@kline_1m`;return this.ws&&this.ws.close(),this.ws=new WebSocket(r),this.ws.onopen=()=>{var l;this.reconnectAttempts=0,(l=t.onConnect)==null||l.call(t)},this.ws.onmessage=l=>{var i,n;try{const x=JSON.parse(l.data);if(x.e==="24hrTicker"&&((i=t.onTicker)==null||i.call(t,{symbol:x.s,price:parseFloat(x.c),change:parseFloat(x.p),changePercent:parseFloat(x.P),high:parseFloat(x.h),low:parseFloat(x.l),volume:parseFloat(x.v),quoteVolume:parseFloat(x.q)})),x.e==="kline"){const p=x.k;(n=t.onCandle)==null||n.call(t,{time:Math.floor(p.t/1e3),open:parseFloat(p.o),high:parseFloat(p.h),low:parseFloat(p.l),close:parseFloat(p.c),volume:parseFloat(p.v),closed:p.x})}}catch(x){console.error("WS parse error:",x)}},this.ws.onerror=l=>{var i;console.error("WS error:",l),(i=t.onError)==null||i.call(t,l)},this.ws.onclose=()=>{var l;this.reconnectAttempts<this.maxReconnect&&(this.reconnectAttempts++,setTimeout(()=>this.connectStream(s,t),2e3*this.reconnectAttempts)),(l=t.onDisconnect)==null||l.call(t)},()=>this.disconnect()}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}async getCandles(s,t="1h",a=500){const r=`${s}_${t}`;try{const l=`https://api.binance.com/api/v3/klines?symbol=${s}&interval=${t}&limit=${a}`,i=await fetch(l);if(!i.ok)throw new Error(`HTTP ${i.status}`);const x=(await i.json()).map(p=>({time:Math.floor(p[0]/1e3),open:parseFloat(p[1]),high:parseFloat(p[2]),low:parseFloat(p[3]),close:parseFloat(p[4]),volume:parseFloat(p[5])}));return this.candleCache.set(r,{data:x,ts:Date.now()}),x}catch(l){const i=this.candleCache.get(r);if(i)return i.data;throw l}}async getPrice(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${s}`)).json();return parseFloat(a.price)}async get24hrTicker(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`)).json();return{symbol:a.symbol,price:parseFloat(a.lastPrice),change:parseFloat(a.priceChange),changePercent:parseFloat(a.priceChangePercent),high:parseFloat(a.highPrice),low:parseFloat(a.lowPrice),volume:parseFloat(a.volume),quoteVolume:parseFloat(a.quoteVolume)}}async getOrderBook(s,t=20){const r=await(await fetch(`https://api.binance.com/api/v3/depth?symbol=${s}&limit=${t}`)).json();return{bids:r.bids.map(([l,i])=>({price:parseFloat(l),quantity:parseFloat(i)})),asks:r.asks.map(([l,i])=>({price:parseFloat(l),quantity:parseFloat(i)}))}}async searchSymbols(s){const a=await(await fetch("https://api.binance.com/api/v3/exchangeInfo")).json(),r=s.toUpperCase();return a.symbols.filter(l=>l.status==="TRADING"&&(l.symbol.includes(r)||l.baseAsset.includes(r))).slice(0,20).map(l=>({symbol:l.symbol,base:l.baseAsset,quote:l.quoteAsset}))}}const H=new Zt;function Oe(){const{setPage:d,bots:s,brokers:t,tradeHistory:a,positions:r,user:l}=V(),[i,n]=N.useState([]),[x,p]=N.useState(!0);N.useEffect(()=>{g();const y=setInterval(g,3e4);return()=>clearInterval(y)},[]);const g=async()=>{try{const y=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"],m=await Promise.all(y.map(async j=>{try{return await H.get24hrTicker(j)}catch{return null}}));n(m.filter(Boolean))}catch(y){console.error("Dashboard load error:",y)}p(!1)},u=s.filter(y=>y.status==="active"),o=a.reduce((y,m)=>y+(m.pnl||0),0),f=t.filter(y=>y.connected),h=[{label:"Bots Activos",value:u.length,icon:xe,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.02))",border:"rgba(59,130,246,0.1)",action:"bots"},{label:"Brokers",value:`${f.length}/${t.length}`,icon:$e,color:"#A855F7",gradient:"linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.02))",border:"rgba(168,85,247,0.1)",action:"brokers"},{label:"Posiciones",value:r.length,icon:Ce,color:"#00DC82",gradient:"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))",border:"rgba(0,220,130,0.1)",action:"history"},{label:"P&L Total",value:`${o>=0?"+":""}$${o.toFixed(2)}`,icon:ue,color:o>=0?"#00DC82":"#FF4757",gradient:o>=0?"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))":"linear-gradient(135deg, rgba(255,71,87,0.1), rgba(255,71,87,0.02))",border:o>=0?"rgba(0,220,130,0.1)":"rgba(255,71,87,0.1)",action:"history"}],b=[{label:"Trading",icon:re,page:"chart",desc:"Gr√°ficos profesionales",color:"#3B82F6"},{label:"Simulador",icon:ie,page:"simulator",desc:"Paper trading sin riesgo",color:"#00DC82"},{label:"Kairos AI",icon:ne,page:"ai",desc:"Asistente inteligente",color:"#A855F7"},{label:"Crear Bot",icon:xe,page:"bots",desc:"Automatiza tu trading",color:"#60A5FA"},{label:"Estrategias",icon:X,page:"strategies",desc:"Crea y gestiona",color:"#EC4899"},{label:"Brokers",icon:ce,page:"brokers",desc:"Conecta tu cuenta",color:"#22D3EE"}];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(I.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight",children:["Bienvenido, ",e.jsx("span",{className:"text-[var(--gold)]",children:(l==null?void 0:l.name)||"Trader"})]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:"Tu centro de control de trading automatizado"})]}),e.jsxs("button",{onClick:()=>d("chart"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold transition-all hover:opacity-90 btn-gold",children:[e.jsx(re,{size:16}),"Abrir Trading"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:h.map((y,m)=>{const j=y.icon;return e.jsxs(I.button,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:m*.06},onClick:()=>d(y.action),className:"rounded-xl p-4 text-left transition-all duration-200 hover:scale-[1.02] group",style:{background:y.gradient,border:`1px solid ${y.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:`${y.color}15`},children:e.jsx(j,{size:18,style:{color:y.color}})}),e.jsx(Pe,{size:14,className:"text-[var(--text-dim)]/30 group-hover:text-[var(--text-dim)] transition-colors"})]}),e.jsx("p",{className:"text-[22px] font-bold leading-none",style:{color:y.color},children:y.value}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 font-medium",children:y.label})]},y.label)})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold text-[var(--text)] mb-3 flex items-center gap-2",children:[e.jsx(X,{size:14,className:"text-[var(--gold)]"}),"Acceso R√°pido"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:b.map((y,m)=>{const j=y.icon;return e.jsxs(I.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2+m*.05},onClick:()=>d(y.page),className:"rounded-xl p-4 text-left transition-all duration-200 group hover:scale-[1.01]",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},onMouseEnter:T=>T.currentTarget.style.borderColor=`${y.color}30`,onMouseLeave:T=>T.currentTarget.style.borderColor="rgba(30,34,45,0.5)",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center mb-3 transition-transform group-hover:scale-110",style:{background:`${y.color}12`},children:e.jsx(j,{size:20,style:{color:y.color}})}),e.jsx("p",{className:"text-[13px] font-bold text-[var(--text)]",children:y.label}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-0.5",children:y.desc})]},y.label)})})]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{size:14,className:"text-[var(--gold)]"}),e.jsx("h2",{className:"text-sm font-bold",children:"Mercado en Tiempo Real"})]}),e.jsxs("button",{onClick:()=>d("chart"),className:"text-[11px] text-[var(--gold)] hover:text-[var(--gold-light)] font-semibold flex items-center gap-1 transition-colors",children:["Ver gr√°fico ",e.jsx(Pe,{size:12})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-2 text-[10px] font-bold text-[var(--text-dim)]/50 uppercase tracking-wider",children:[e.jsx("span",{children:"Par"}),e.jsx("span",{className:"text-right",children:"Precio"}),e.jsx("span",{className:"text-right",children:"Cambio 24h"}),e.jsx("span",{className:"text-right",children:"Acci√≥n"})]}),e.jsx("div",{className:"divide-y divide-[var(--border)]/30",children:x?e.jsx("div",{className:"p-8 text-center text-sm text-[var(--text-dim)] animate-pulse",children:"Cargando mercado..."}):i.map((y,m)=>e.jsxs(I.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:m*.05},onClick:()=>{V.getState().setSelectedPair(y.symbol),d("chart")},className:"group w-full grid grid-cols-4 gap-4 items-center px-4 py-3 hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:y.changePercent>=0?"rgba(14,203,129,0.08)":"rgba(246,70,93,0.08)"},children:e.jsx("span",{className:y.changePercent>=0?"text-[var(--green)]":"text-[var(--red)]",children:y.symbol.replace("USDT","").slice(0,3)})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[13px] font-bold leading-none",children:y.symbol.replace("USDT","")}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/50 mt-0.5",children:"USDT"})]})]}),e.jsxs("p",{className:"text-[13px] font-mono font-semibold text-right",children:["$",y.price.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsx("div",{className:"flex items-center gap-1 justify-end",children:e.jsxs("span",{className:`flex items-center gap-0.5 text-xs font-mono font-semibold px-2 py-0.5 rounded-md
                  ${y.changePercent>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:[y.changePercent>=0?e.jsx(ht,{size:10}):e.jsx(Ye,{size:10}),y.changePercent>=0?"+":"",y.changePercent.toFixed(2),"%"]})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] font-semibold text-[var(--gold)] opacity-0 group-hover:opacity-100 transition-opacity bg-[var(--gold)]/10 px-2 py-1 rounded-md",children:"Trading ‚Üí"})})]},y.symbol))})]})]})}function Z(d,s){const t=2/(s+1),a=[d[0]];for(let r=1;r<d.length;r++)a.push(d[r]*t+a[r-1]*(1-t));return a}function Fe(d,s){const t=[];for(let a=0;a<d.length;a++){if(a<s-1){t.push(null);continue}const r=d.slice(a-s+1,a+1);t.push(r.reduce((l,i)=>l+i,0)/s)}return t}function oe(d,s=14){const t=new Array(s).fill(null);let a=0,r=0;for(let l=1;l<=s;l++){const i=d[l]-d[l-1];i>0?a+=i:r+=Math.abs(i)}a/=s,r/=s,t.push(r===0?100:100-100/(1+a/r));for(let l=s+1;l<d.length;l++){const i=d[l]-d[l-1];a=(a*(s-1)+(i>0?i:0))/s,r=(r*(s-1)+(i<0?Math.abs(i):0))/s,t.push(r===0?100:100-100/(1+a/r))}return t}function Ee(d,s=12,t=26,a=9){const r=Z(d,s),l=Z(d,t),i=r.map((p,g)=>p-l[g]),n=Z(i,a),x=i.map((p,g)=>p-n[g]);return{macd:i,signal:n,histogram:x}}function tt(d,s=20,t=2){const a=Fe(d,s),r=[],l=[];for(let i=0;i<d.length;i++){if(i<s-1){r.push(null),l.push(null);continue}const n=d.slice(i-s+1,i+1),x=a[i],p=n.reduce((u,o)=>u+Math.pow(o-x,2),0)/s,g=Math.sqrt(p)*t;r.push(x+g),l.push(x-g)}return{upper:r,middle:a,lower:l}}function es(d){let s=0,t=0;return d.map(a=>{const r=(a.high+a.low+a.close)/3;return t+=r*a.volume,s+=a.volume,s>0?t/s:r})}function we(d,s,t){if(t<1)return null;const a=d[t-1],r=d[t],l=s[t-1],i=s[t];return a<=l&&r>i?"bullish_cross":a>=l&&r<i?"bearish_cross":null}function ts(){const d=N.useRef(null),s=N.useRef(null),t=N.useRef(null),a=N.useRef(null),r=N.useRef([]),l=N.useRef(null),{selectedPair:i,selectedTimeframe:n,setSelectedPair:x,setSelectedTimeframe:p,setCurrentPrice:g,setPriceChange24h:u}=V(),[o,f]=N.useState(!0),[h,b]=N.useState(null),[y,m]=N.useState(!1),[j,T]=N.useState(""),[B,S]=N.useState(["ema20"]);N.useEffect(()=>{const P=d.current;if(!P)return;const A=P.getBoundingClientRect(),D=A.width||P.clientWidth||800,z=A.height||P.clientHeight||500,c=qt(P,{width:D,height:z,layout:{background:{type:Ut.Solid,color:"#0B0E11"},textColor:"#848E9C",fontFamily:"Inter, sans-serif",fontSize:11},grid:{vertLines:{color:"#1E222D"},horzLines:{color:"#1E222D"}},crosshair:{mode:Lt.Normal,vertLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"},horzLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"}},timeScale:{borderColor:"#1E222D",timeVisible:!0,secondsVisible:!1,rightOffset:5,barSpacing:8},rightPriceScale:{borderColor:"#1E222D",scaleMargins:{top:.05,bottom:.2}},handleScroll:{mouseWheel:!0,pressedMouseMove:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}}),$=c.addCandlestickSeries({upColor:"#0ECB81",downColor:"#F6465D",borderUpColor:"#0ECB81",borderDownColor:"#F6465D",wickUpColor:"#0ECB81",wickDownColor:"#F6465D"}),v=c.addHistogramSeries({color:"#3B82F622",priceFormat:{type:"volume"},priceScaleId:"volume"});c.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0}}),s.current=c,t.current=$,a.current=v;const C=new ResizeObserver(w=>{if(!w||!w[0])return;const{width:L,height:ee}=w[0].contentRect;L>0&&ee>0&&c.applyOptions({width:L,height:ee})});return C.observe(P),()=>{C.disconnect(),c.remove(),s.current=null,t.current=null,a.current=null}},[]),N.useEffect(()=>{let P=!1;return(async()=>{f(!0),b(null);try{const[D,z]=await Promise.all([H.getCandles(i,n,500),H.get24hrTicker(i)]);if(P)return;if(!D||D.length===0){b("No se recibieron datos de Binance"),f(!1);return}t.current&&t.current.setData(D),a.current&&a.current.setData(D.map(c=>({time:c.time,value:c.volume||0,color:c.close>=c.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"}))),g(z.price),u(z.changePercent);try{k(D)}catch(c){console.warn("Indicator error (non-fatal):",c)}s.current&&s.current.timeScale().fitContent()}catch(D){console.error("Chart data load error:",D),P||b(`Error cargando datos: ${D.message}`)}P||f(!1)})(),l.current&&l.current(),l.current=H.connectStream(i,{onTicker:D=>{g(D.price),u(D.changePercent)},onCandle:D=>{t.current&&t.current.update(D),a.current&&a.current.update({time:D.time,value:D.volume||0,color:D.close>=D.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"})}}),()=>{P=!0,l.current&&(l.current(),l.current=null)}},[i,n]);const k=P=>{if(!s.current)return;r.current.forEach(z=>{var c;try{(c=s.current)==null||c.removeSeries(z)}catch{}}),r.current=[];const A=P.map(z=>z.close),D=P.map(z=>z.time);B.forEach(z=>{try{if(z==="ema20"){const $=Z(A,20).map((v,C)=>v!=null&&isFinite(v)?{time:D[C],value:v}:null).filter(Boolean);if($.length>0){const v=s.current.addLineSeries({color:"#3B82F6",lineWidth:1.5,title:"EMA 20",lastValueVisible:!1,priceLineVisible:!1});v.setData($),r.current.push(v)}}if(z==="ema50"){const $=Z(A,50).map((v,C)=>v!=null&&isFinite(v)?{time:D[C],value:v}:null).filter(Boolean);if($.length>0){const v=s.current.addLineSeries({color:"#8B5CF6",lineWidth:1.5,title:"EMA 50",lastValueVisible:!1,priceLineVisible:!1});v.setData($),r.current.push(v)}}if(z==="sma200"){const $=Fe(A,200).map((v,C)=>v!=null&&isFinite(v)?{time:D[C],value:v}:null).filter(Boolean);if($.length>0){const v=s.current.addLineSeries({color:"#FF6D00",lineWidth:1,title:"SMA 200",lastValueVisible:!1,priceLineVisible:!1});v.setData($),r.current.push(v)}}if(z==="bb"){const c=tt(A),$=c.upper.map((C,w)=>C!=null&&isFinite(C)?{time:D[w],value:C}:null).filter(Boolean),v=c.lower.map((C,w)=>C!=null&&isFinite(C)?{time:D[w],value:C}:null).filter(Boolean);if($.length>0){const C=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Upper",lastValueVisible:!1,priceLineVisible:!1}),w=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Lower",lastValueVisible:!1,priceLineVisible:!1});C.setData($),w.setData(v),r.current.push(C,w)}}}catch(c){console.warn(`Indicator ${z} error:`,c)}})};N.useEffect(()=>{if(!t.current)return;(async()=>{try{const A=await H.getCandles(i,n,500);k(A)}catch{}})()},[B]);const M=P=>{S(A=>A.includes(P)?A.filter(D=>D!==P):[...A,P])};return e.jsxs("div",{className:"flex flex-col w-full h-full",style:{minHeight:0},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 shrink-0 flex-wrap",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>m(!y),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(gt,{size:13,className:"text-[var(--text-dim)]"}),i]}),y&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2",children:[e.jsx("input",{type:"text",value:j,onChange:P=>T(P.target.value.toUpperCase()),placeholder:"Buscar par...",className:"w-full text-sm mb-2",autoFocus:!0}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:et.filter(P=>P.includes(j)).map(P=>e.jsx("button",{onClick:()=>{x(P),m(!1),T("")},className:`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors
                        ${P===i?"bg-[var(--gold)]/15 text-[var(--gold)]":"text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]"}`,children:P},P))})]})]}),e.jsx("div",{className:"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5",children:Ae.map(P=>e.jsx("button",{onClick:()=>p(P.value),className:`px-2.5 py-1 text-xs rounded-md transition-colors
                ${n===P.value?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:P.label},P.value))}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(ae,{size:13,className:"text-[var(--text-dim)]"}),[{id:"ema20",label:"EMA 20",color:"#3B82F6"},{id:"ema50",label:"EMA 50",color:"#8B5CF6"},{id:"sma200",label:"SMA 200",color:"#FF6D00"},{id:"bb",label:"BB",color:"#9C27B0"}].map(P=>e.jsx("button",{onClick:()=>M(P.id),className:`px-2 py-0.5 text-[11px] rounded transition-all
                ${B.includes(P.id)?"font-semibold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:B.includes(P.id)?{color:P.color,background:`${P.color}15`}:{},children:P.label},P.id))]})]}),e.jsxs("div",{ref:d,className:"relative",style:{flex:"1 1 0%",minHeight:0,overflow:"hidden"},children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.85)"},children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-[var(--gold)] border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-xs text-[var(--text-dim)]",children:["Cargando ",i,"..."]})]})}),h&&!o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.9)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-[var(--red)] mb-2",children:h}),e.jsx("button",{onClick:()=>{b(null),f(!0)},className:"px-4 py-2 text-xs bg-[var(--gold)] text-white rounded-lg font-semibold",children:"Reintentar"})]})})]})]})}const ss="https://api.binance.com/api/v3/depth";function as({pair:d="BTCUSDT",height:s=260}){const t=N.useRef(null),[a,r]=N.useState(null),[l,i]=N.useState(null),n=N.useRef(null),x=N.useCallback(async()=>{try{const u=await fetch(`${ss}?symbol=${d}&limit=100`);if(!u.ok)return;const o=await u.json();r(o)}catch{}},[d]);N.useEffect(()=>{x();const u=setInterval(x,3e3);return()=>clearInterval(u)},[x]);const p=N.useCallback(()=>{var E,_;const u=t.current;if(!u||!a)return;const o=u.getContext("2d"),f=window.devicePixelRatio||1,h=u.clientWidth,b=u.clientHeight;u.width=h*f,u.height=b*f,o.scale(f,f),o.clearRect(0,0,h,b);const y=a.bids.map(([F,R])=>[parseFloat(F),parseFloat(R)]),m=a.asks.map(([F,R])=>[parseFloat(F),parseFloat(R)]);if(!y.length||!m.length)return;const j=[];let T=0;for(const[F,R]of y)T+=R,j.push([F,T]);const B=[];let S=0;for(const[F,R]of m)S+=R,B.push([F,S]);const k=(y[0][0]+m[0][0])/2,M=Math.max(((E=j[j.length-1])==null?void 0:E[1])||0,((_=B[B.length-1])==null?void 0:_[1])||0),P=[...j.map(F=>F[0]),...B.map(F=>F[0])],A=Math.min(...P),D=Math.max(...P),z=D-A||1,c={top:10,bottom:25,left:0,right:0},$=h-c.left-c.right,v=b-c.top-c.bottom,C=F=>c.left+(F-A)/z*$,w=F=>c.top+v-F/M*v;o.beginPath(),o.moveTo(C(j[0][0]),w(0));for(const[F,R]of j)o.lineTo(C(F),w(R));o.lineTo(C(j[j.length-1][0]),w(0)),o.closePath();const L=o.createLinearGradient(0,0,0,b);L.addColorStop(0,"rgba(0,220,130,0.25)"),L.addColorStop(1,"rgba(0,220,130,0.02)"),o.fillStyle=L,o.fill(),o.beginPath();for(let F=0;F<j.length;F++){const[R,O]=j[F];F===0?o.moveTo(C(R),w(O)):o.lineTo(C(R),w(O))}o.strokeStyle="#00DC82",o.lineWidth=1.5,o.stroke(),o.beginPath(),o.moveTo(C(B[0][0]),w(0));for(const[F,R]of B)o.lineTo(C(F),w(R));o.lineTo(C(B[B.length-1][0]),w(0)),o.closePath();const ee=o.createLinearGradient(0,0,0,b);ee.addColorStop(0,"rgba(255,59,48,0.25)"),ee.addColorStop(1,"rgba(255,59,48,0.02)"),o.fillStyle=ee,o.fill(),o.beginPath();for(let F=0;F<B.length;F++){const[R,O]=B[F];F===0?o.moveTo(C(R),w(O)):o.lineTo(C(R),w(O))}o.strokeStyle="#FF3B30",o.lineWidth=1.5,o.stroke();const K=C(k);if(o.beginPath(),o.setLineDash([4,4]),o.moveTo(K,c.top),o.lineTo(K,b-c.bottom),o.strokeStyle="#3B82F680",o.lineWidth=1,o.stroke(),o.setLineDash([]),o.fillStyle="#3B82F6",o.font="600 10px Inter, sans-serif",o.textAlign="center",o.fillText(`$${k.toFixed(2)}`,K,b-c.bottom+14),o.fillStyle="#555",o.font="9px Inter, sans-serif",o.textAlign="left",o.fillText(`$${A.toFixed(0)}`,c.left+4,b-c.bottom+14),o.textAlign="right",o.fillText(`$${D.toFixed(0)}`,h-c.right-4,b-c.bottom+14),l&&l.x>=0&&l.x<=h){const F=A+l.x/h*z,R=F<k,O=R?j:B;let he=0;for(const[De,it]of O)(R?De>=F:De<=F)&&(he=it);o.beginPath(),o.setLineDash([2,2]),o.moveTo(l.x,c.top),o.lineTo(l.x,b-c.bottom),o.strokeStyle="rgba(255,255,255,0.15)",o.lineWidth=1,o.stroke(),o.setLineDash([]);const Be=`$${F.toFixed(2)} ‚Äî Vol: ${he.toFixed(4)}`,ge=o.measureText(Be).width+16,Ie=Math.min(l.x-ge/2,h-ge-4);o.fillStyle="#1A1B1E",o.strokeStyle="rgba(59,130,246,0.3)",o.lineWidth=1,o.beginPath(),o.roundRect(Math.max(Ie,4),c.top,ge,22,4),o.fill(),o.stroke(),o.fillStyle="#fff",o.font="10px Inter, sans-serif",o.textAlign="center",o.fillText(Be,Math.max(Ie,4)+ge/2,c.top+15)}},[a,l]);N.useEffect(()=>(n.current=requestAnimationFrame(p),()=>cancelAnimationFrame(n.current)),[p]);const g=u=>{var f;const o=(f=t.current)==null?void 0:f.getBoundingClientRect();o&&i({x:u.clientX-o.left,y:u.clientY-o.top})};return e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-xl overflow-hidden relative",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(re,{size:14,className:"text-[var(--gold)]"})," Depth Chart"]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00DC82]"})," Bids"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#FF3B30]"})," Asks"]})]})]}),a?e.jsx("canvas",{ref:t,style:{width:"100%",height:s},onMouseMove:g,onMouseLeave:()=>i(null),className:"cursor-crosshair"}):e.jsx("div",{className:"flex items-center justify-center",style:{height:s},children:e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Cargando profundidad‚Ä¶"})})]})}function rs(){const{selectedPair:d,currentPrice:s,positions:t,orders:a,addPosition:r,addOrder:l,closePosition:i,cancelOrder:n}=V(),[x,p]=N.useState("buy"),[g,u]=N.useState("market"),[o,f]=N.useState({quantity:"",price:"",stopLoss:"",takeProfit:""}),[h,b]=N.useState({bids:[],asks:[]}),[y,m]=N.useState("order");N.useEffect(()=>{j();const S=setInterval(j,5e3);return()=>clearInterval(S)},[d]);const j=async()=>{try{const S=await H.getOrderBook(d,10);b(S)}catch{}},T=()=>{if(!o.quantity)return;const S=g==="market"?s:parseFloat(o.price);S&&(g==="market"?r({symbol:d,side:x,quantity:parseFloat(o.quantity),entryPrice:S,stopLoss:o.stopLoss?parseFloat(o.stopLoss):null,takeProfit:o.takeProfit?parseFloat(o.takeProfit):null,openedAt:new Date().toISOString()}):l({symbol:d,side:x,type:g,quantity:parseFloat(o.quantity),price:S,stopLoss:o.stopLoss?parseFloat(o.stopLoss):null,takeProfit:o.takeProfit?parseFloat(o.takeProfit):null,status:"open",createdAt:new Date().toISOString()}),f({quantity:"",price:"",stopLoss:"",takeProfit:""}))},B=parseFloat(o.quantity||0)*(g==="market"?s||0:parseFloat(o.price||0));return e.jsxs("div",{className:"flex flex-col h-full",style:{width:320,borderLeft:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"flex shrink-0 px-2 pt-2 gap-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:["order","positions","orders"].map(S=>e.jsx("button",{onClick:()=>m(S),className:`flex-1 py-2.5 text-[11px] font-bold rounded-t-lg transition-all
              ${y===S?"text-[var(--gold)] bg-[var(--gold)]/[0.06]":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:y===S?{borderBottom:"2px solid var(--gold)"}:{borderBottom:"2px solid transparent"},children:S==="order"?"Orden":S==="positions"?`Pos (${t.length})`:`√ìrd (${a.length})`},S))}),y==="order"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("button",{onClick:()=>p("buy"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${x==="buy"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:x==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 12px rgba(14,203,129,0.25)"}:{},children:"Comprar"}),e.jsx("button",{onClick:()=>p("sell"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${x==="sell"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:x==="sell"?{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 12px rgba(246,70,93,0.25)"}:{},children:"Vender"})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-lg bg-[var(--dark-3)]",children:["market","limit","stop_loss"].map(S=>e.jsx("button",{onClick:()=>u(S),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all
                  ${g===S?"bg-[var(--dark-4)] text-[var(--text)] shadow-sm":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:S==="market"?"Market":S==="limit"?"L√≠mite":"Stop"},S))}),g!=="market"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio"}),e.jsx("input",{type:"number",value:o.price,onChange:S=>f({...o,price:S.target.value}),placeholder:s==null?void 0:s.toString(),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Cantidad"}),e.jsx("input",{type:"number",value:o.quantity,onChange:S=>f({...o,quantity:S.target.value}),placeholder:"0.001",className:"w-full text-sm"}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:[25,50,75,100].map(S=>e.jsxs("button",{onClick:()=>{const k=g==="market"?s:parseFloat(o.price)||s;if(k){const P=1e4*(S/100)/k;f({...o,quantity:P.toFixed(6)})}},className:"flex-1 py-1.5 text-[10px] font-semibold rounded-md text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all",style:{background:"rgba(14,16,21,0.6)",border:"1px solid var(--border)"},children:[S,"%"]},S))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(ce,{size:9,className:"text-[var(--red)]"})," SL"]}),e.jsx("input",{type:"number",value:o.stopLoss,onChange:S=>f({...o,stopLoss:S.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(ye,{size:9,className:"text-[var(--green)]"})," TP"]}),e.jsx("input",{type:"number",value:o.takeProfit,onChange:S=>f({...o,takeProfit:S.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg p-3 flex items-center justify-between",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-semibold uppercase tracking-wider",children:"Total"}),e.jsxs("span",{className:"text-sm font-mono font-bold",children:["$",B.toFixed(2)]})]}),e.jsxs("button",{onClick:T,disabled:!o.quantity,className:"w-full py-3.5 font-bold rounded-xl text-sm transition-all duration-200 disabled:opacity-40 text-white",style:x==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 15px rgba(14,203,129,0.25)"}:{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 15px rgba(246,70,93,0.25)"},children:[x==="buy"?"Comprar":"Vender"," ",d.replace("USDT","")]}),e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 font-bold uppercase tracking-wider",children:"Order Book"}),e.jsxs("div",{className:"space-y-[2px] text-[10px] font-mono",children:[h.asks.slice(0,5).reverse().map((S,k)=>e.jsxs("div",{className:"flex justify-between text-[var(--red)] py-0.5 px-1 rounded hover:bg-[var(--red)]/[0.04]",children:[e.jsxs("span",{children:["$",S.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:S.quantity.toFixed(4)})]},`a${k}`)),e.jsxs("div",{className:"text-center py-1.5 text-[15px] font-bold text-[var(--gold)] my-1",style:{background:"rgba(59,130,246,0.04)",borderRadius:"6px"},children:["$",(s==null?void 0:s.toLocaleString(void 0,{minimumFractionDigits:2}))||"---"]}),h.bids.slice(0,5).map((S,k)=>e.jsxs("div",{className:"flex justify-between text-[var(--green)] py-0.5 px-1 rounded hover:bg-[var(--green)]/[0.04]",children:[e.jsxs("span",{children:["$",S.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:S.quantity.toFixed(4)})]},`b${k}`))]})]})]}),y==="positions"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin posiciones abiertas"})]}):t.map(S=>{const k=S.side==="buy"?(s-S.entryPrice)*S.quantity:(S.entryPrice-s)*S.quantity;return e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:`1px solid ${k>=0?"rgba(14,203,129,0.1)":"rgba(246,70,93,0.1)"}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold",children:S.symbol}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-md ${S.side==="buy"?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:S.side.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-[var(--text-dim)] mb-2",children:[e.jsxs("span",{children:["Entrada: $",S.entryPrice]}),e.jsxs("span",{className:`font-bold ${k>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:["P&L: ",k>=0?"+":"","$",k.toFixed(2)]})]}),e.jsx("button",{onClick:()=>i(S.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cerrar Posici√≥n"})]},S.id)})}),y==="orders"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin √≥rdenes pendientes"})]}):a.map(S=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:S.symbol}),e.jsxs("span",{className:`text-[10px] font-bold ${S.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:[S.side.toUpperCase()," ",S.type]})]}),e.jsxs("div",{className:"text-[10px] text-[var(--text-dim)] mb-2",children:["Precio: $",S.price," | Cantidad: ",S.quantity]}),e.jsx("button",{onClick:()=>n(S.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cancelar"})]},S.id))})]})}class is{constructor(){this.connections=new Map}_decrypt(s){return{...s,apiKey:atob(s.apiKey),apiSecret:atob(s.apiSecret),passphrase:s.passphrase?atob(s.passphrase):void 0}}async _hmacSign(s,t){const a=new TextEncoder,r=await crypto.subtle.importKey("raw",a.encode(s),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",r,a.encode(t));return Array.from(new Uint8Array(l)).map(i=>i.toString(16).padStart(2,"0")).join("")}async _binanceSignedRequest(s,t,a,r={}){const l=Date.now(),i={...r,timestamp:l,recvWindow:5e3},n=Object.entries(i).filter(([,h])=>h!=null).map(([h,b])=>`${h}=${encodeURIComponent(b)}`).join("&"),x=await this._hmacSign(s.apiSecret,n),p=`${n}&signature=${x}`,g=t==="GET"?`${se.binance.baseUrl}${a}?${p}`:`${se.binance.baseUrl}${a}`,u={method:t,headers:{"X-MBX-APIKEY":s.apiKey,"Content-Type":"application/x-www-form-urlencoded"}};(t==="POST"||t==="DELETE")&&(u.body=p);const o=await fetch(g,u),f=await o.json();if(!o.ok)throw new Error(`Binance ${a}: ${f.msg||o.statusText} (${f.code||o.status})`);return f}async _binancePublicRequest(s,t={}){const a=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,n])=>`${i}=${encodeURIComponent(n)}`).join("&"),r=`${se.binance.baseUrl}${s}${a?"?"+a:""}`,l=await fetch(r);if(!l.ok)throw new Error(`Binance API error: ${l.status}`);return l.json()}async connect(s){const t=this._decrypt(s),a=se[s.brokerId];if(!a)throw new Error(`Unsupported broker: ${s.brokerId}`);try{switch(s.brokerId){case"binance":{await this._binancePublicRequest("/api/v3/ping");const r=await this._binanceSignedRequest(t,"GET","/api/v3/account");return this.connections.set(s.id,{creds:t,config:a,connected:!0,permissions:r.permissions||[],accountType:r.accountType}),{success:!0,message:`Connected to Binance (${r.accountType})`,permissions:r.permissions}}default:return await fetch(a.baseUrl),this.connections.set(s.id,{creds:t,config:a,connected:!0,permissions:[]}),{success:!0,message:`Connected to ${a.name} (simulated)`}}}catch(r){return{success:!1,message:r.message}}}async getBalances(s){const t=this.connections.get(s);if(!t)throw new Error("Broker not connected");if(t.config.id==="binance")try{return(await this._binanceSignedRequest(t.creds,"GET","/api/v3/account")).balances.filter(r=>parseFloat(r.free)>0||parseFloat(r.locked)>0).map(r=>({asset:r.asset,free:r.free,locked:r.locked,total:(parseFloat(r.free)+parseFloat(r.locked)).toString()}))}catch(a){throw console.error("Binance getBalances error:",a),a}return[]}async placeOrder(s,t){var u,o,f,h,b,y;const a=this.connections.get(s);if(!a)throw new Error("Broker not connected");const{symbol:r,side:l,type:i,quantity:n,price:x,stopLoss:p,takeProfit:g}=t;if(!r||!l||!i||!n)throw new Error("Missing required order fields");if(a.config.id==="binance")try{const m={market:"MARKET",limit:"LIMIT",stop_loss:"STOP_LOSS_LIMIT"}[i]||"MARKET",j={symbol:r,side:l.toUpperCase(),type:m,quantity:n.toString()};(m==="LIMIT"||m==="STOP_LOSS_LIMIT")&&(j.timeInForce="GTC",j.price=parseFloat(x).toFixed(2)),m==="STOP_LOSS_LIMIT"&&(j.stopPrice=parseFloat(p||x).toFixed(2));const T=await this._binanceSignedRequest(a.creds,"POST","/api/v3/order",j);return{id:(u=T.orderId)==null?void 0:u.toString(),clientOrderId:T.clientOrderId,symbol:T.symbol,side:(o=T.side)==null?void 0:o.toLowerCase(),type:(f=T.type)==null?void 0:f.toLowerCase(),quantity:parseFloat(T.origQty||n),price:parseFloat(T.price||x||0),filledPrice:parseFloat(((b=(h=T.fills)==null?void 0:h[0])==null?void 0:b.price)||T.price||0),filledQty:parseFloat(T.executedQty||0),status:(y=T.status)==null?void 0:y.toLowerCase(),timestamp:new Date(T.transactTime||Date.now()).toISOString(),broker:"Binance",raw:T}}catch(m){throw console.error("Binance placeOrder error:",m),m}return{id:Date.now().toString(36),symbol:r,side:l,type:i,quantity:parseFloat(n),price:x?parseFloat(x):null,status:i==="market"?"filled":"new",filledPrice:i==="market"?parseFloat(x||0):null,timestamp:new Date().toISOString(),broker:a.config.name,simulated:!0}}async cancelOrder(s,t,a){const r=this.connections.get(s);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{const l=await this._binanceSignedRequest(r.creds,"DELETE","/api/v3/order",{symbol:a,orderId:t});return{success:!0,orderId:l.orderId,status:l.status}}catch(l){return{success:!1,message:l.message}}return{success:!0,orderId:t,simulated:!0}}async getOpenOrders(s,t){const a=this.connections.get(s);if(!a)throw new Error("Broker not connected");if(a.config.id==="binance")try{const r=t?{symbol:t}:{};return(await this._binanceSignedRequest(a.creds,"GET","/api/v3/openOrders",r)).map(i=>{var n,x,p,g;return{id:(n=i.orderId)==null?void 0:n.toString(),symbol:i.symbol,side:(x=i.side)==null?void 0:x.toLowerCase(),type:(p=i.type)==null?void 0:p.toLowerCase(),quantity:parseFloat(i.origQty),price:parseFloat(i.price),filledQty:parseFloat(i.executedQty),status:(g=i.status)==null?void 0:g.toLowerCase(),time:new Date(i.time).toISOString()}})}catch{return[]}return[]}async getTradeHistory(s,t,a=50){const r=this.connections.get(s);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{return(await this._binanceSignedRequest(r.creds,"GET","/api/v3/myTrades",{symbol:t,limit:a})).map(i=>{var n,x;return{id:(n=i.id)==null?void 0:n.toString(),orderId:(x=i.orderId)==null?void 0:x.toString(),symbol:i.symbol,side:i.isBuyer?"buy":"sell",price:parseFloat(i.price),quantity:parseFloat(i.qty),commission:parseFloat(i.commission),commissionAsset:i.commissionAsset,time:new Date(i.time).toISOString(),isMaker:i.isMaker}})}catch{return[]}return[]}async getExchangeInfo(s){var t,a,r,l;try{const n=(t=(await this._binancePublicRequest("/api/v3/exchangeInfo",{symbol:s})).symbols)==null?void 0:t[0];if(!n)return null;const x=(a=n.filters)==null?void 0:a.find(u=>u.filterType==="LOT_SIZE"),p=(r=n.filters)==null?void 0:r.find(u=>u.filterType==="PRICE_FILTER"),g=(l=n.filters)==null?void 0:l.find(u=>u.filterType==="NOTIONAL"||u.filterType==="MIN_NOTIONAL");return{symbol:n.symbol,status:n.status,baseAsset:n.baseAsset,quoteAsset:n.quoteAsset,minQty:x?parseFloat(x.minQty):0,maxQty:x?parseFloat(x.maxQty):1/0,stepSize:x?parseFloat(x.stepSize):0,minPrice:p?parseFloat(p.minPrice):0,tickSize:p?parseFloat(p.tickSize):0,minNotional:g?parseFloat(g.minNotional||g.notional):0}}catch{return null}}isConnected(s){return this.connections.has(s)}getConnection(s){return this.connections.get(s)}disconnect(s){this.connections.delete(s)}}const be=new is;class U{constructor(s){this._series=s.map(t=>t??0),this._value=this._series[this._series.length-1]||0}valueOf(){return this._value}toString(){return String(this._value)}get value(){return this._value}get series(){return this._series}prev(s=1){return this._series[this._series.length-1-s]||0}toFixed(s){return this._value.toFixed(s)}}function ns(d){const s=d.map(E=>E.close),t=d.map(E=>E.open),a=d.map(E=>E.high),r=d.map(E=>E.low),l=d.map(E=>E.volume),i=s.length;let n=null,x={stopLoss:2,takeProfit:4};const p=[],g=(E=20)=>new U(Z(s,E)),u=(E=20)=>new U(Fe(s,E)),o=(E=14)=>new U(oe(s,E)),f=(E=12,_=26,F=9)=>{const R=Ee(s,E,_,F);return{line:new U(R.macd),signal:new U(R.signal),histogram:new U(R.histogram),valueOf(){return R.histogram[i-1]||0}}},h=(E=20,_=2)=>{const F=tt(s,E,_);return{upper:new U(F.upper),middle:new U(F.middle),lower:new U(F.lower)}},b=()=>new U(es(d)),y=(E,_)=>{const F=E instanceof U?E.series:typeof E=="number"?[E,E]:[],R=_ instanceof U?_.series:typeof _=="number"?[_,_]:[];if(F.length<2||R.length<2)return!1;const O=Math.min(F.length,R.length)-1;return F[O-1]<=R[O-1]&&F[O]>R[O]},m=(E,_)=>{const F=E instanceof U?E.series:typeof E=="number"?[E,E]:[],R=_ instanceof U?_.series:typeof _=="number"?[_,_]:[];if(F.length<2||R.length<2)return!1;const O=Math.min(F.length,R.length)-1;return F[O-1]>=R[O-1]&&F[O]<R[O]},j=(E={})=>{n={type:"buy",...E}},T=(E={})=>{n={type:"sell",...E}},B=(E={})=>{Object.assign(x,E)},S=E=>{p.push(String(E))},k=E=>{p.push(`‚ö†Ô∏è ${String(E)}`)},M=new U(s),P=new U(t),A=new U(a),D=new U(r),z=new U(l),c=s[i-1]||0,$=i-1;return{sandbox:{ema:g,sma:u,rsi:o,macd:f,bb:h,vwap:b,close:M,open:P,high:A,low:D,volume:z,price:c,barIndex:$,crossover:y,crossunder:m,buy:j,sell:T,config:B,log:S,alert:k,highest:(E,_)=>{const R=(E instanceof U?E.series:s).slice(-_);return Math.max(...R.filter(O=>O!=null))},lowest:(E,_)=>{const R=(E instanceof U?E.series:s).slice(-_);return Math.min(...R.filter(O=>O!=null))},avg:(E,_)=>{const R=(E instanceof U?E.series:s).slice(-_).filter(O=>O!=null);return R.reduce((O,he)=>O+he,0)/(R.length||1)},change:(E,_=1)=>{const F=E instanceof U?E.series:s,R=F[F.length-1]||0,O=F[F.length-1-_]||0;return R-O},percentChange:(E,_=1)=>{const F=E instanceof U?E.series:s,R=F[F.length-1]||0,O=F[F.length-1-_]||0;return O!==0?(R-O)/O*100:0},Math,Number,parseInt,parseFloat,isNaN,isFinite},getSignal:()=>n,getConfig:()=>x,getLogs:()=>p}}function st(d,s){if(!d||!s||s.length<2)return{signal:null,config:{stopLoss:2,takeProfit:4},logs:["No hay datos suficientes"]};const{sandbox:t,getSignal:a,getConfig:r,getLogs:l}=ns(s);try{const i=["window","document","globalThis","self","fetch","XMLHttpRequest","WebSocket","eval","Function","setTimeout","setInterval","importScripts","localStorage","sessionStorage","indexedDB","crypto","navigator","location","history","process","require","module","exports","__dirname","__filename"],n=[...Object.keys(t),...i],x=[...Object.values(t),...i.map(()=>{})],p=`"use strict";
${d}`;return new Function(...n,p)(...x),{signal:a(),config:r(),logs:l(),error:null}}catch(i){return{signal:null,config:r(),logs:[...l(),`‚ùå Error: ${i.message}`],error:i.message}}}function ze(d){if(!d||!d.trim())return{valid:!1,error:"El script est√° vac√≠o"};try{const s=[/\beval\s*\(/,/\bFunction\s*\(/,/\bimport\s*\(/,/\brequire\s*\(/,/\bfetch\s*\(/,/\bXMLHttpRequest\b/,/\bWebSocket\b/,/\bwindow\b/,/\bdocument\b/,/\bprocess\b/,/\b__proto__\b/,/\bconstructor\s*\[/,/\bprototype\b/];for(const t of s)if(t.test(d))return{valid:!1,error:`C√≥digo no permitido: ${t.source}`};return new Function(d),{valid:!0,error:null}}catch(s){return{valid:!1,error:`Error de sintaxis: ${s.message}`}}}function ls(d,s,t={}){var b,y;const{initialBalance:a=1e3,riskPercent:r=2}=t;let l=a,i=null;const n=[],x=[a],p=[],g=50;if(s.length<g)return{trades:[],equityCurve:[a],finalBalance:a,logs:["Se necesitan al menos 50 velas"]};for(let m=g;m<s.length;m++){const j=s.slice(0,m+1),T=j[j.length-1].close,B=st(d,j);if(B.error){p.push(`Bar ${m}: ${B.error}`);continue}const S=((b=B.config)==null?void 0:b.stopLoss)||2,k=((y=B.config)==null?void 0:y.takeProfit)||4;if(i){const P=i.side==="buy"?(T-i.entryPrice)/i.entryPrice*100:(i.entryPrice-T)/i.entryPrice*100;if(P<=-S||P>=k){const A=i.quantity*(T-i.entryPrice)*(i.side==="buy"?1:-1);l+=A,n.push({...i,exitPrice:T,exitBar:m,pnl:A,pnlPercent:P,reason:P>=k?"Take Profit":"Stop Loss"}),i=null}}if(B.signal){if(B.signal.type==="buy"&&!i){const P=l*(r/100)/T;i={side:"buy",entryPrice:T,quantity:P,entryBar:m}}else if(B.signal.type==="sell"&&(i==null?void 0:i.side)==="buy"){const P=i.quantity*(T-i.entryPrice);l+=P;const A=(T-i.entryPrice)/i.entryPrice*100;n.push({...i,exitPrice:T,exitBar:m,pnl:P,pnlPercent:A,reason:"Signal"}),i=null}else if(B.signal.type==="sell"&&!i){const P=l*(r/100)/T;i={side:"sell",entryPrice:T,quantity:P,entryBar:m}}else if(B.signal.type==="buy"&&(i==null?void 0:i.side)==="sell"){const P=i.quantity*(i.entryPrice-T);l+=P;const A=(i.entryPrice-T)/i.entryPrice*100;n.push({...i,exitPrice:T,exitBar:m,pnl:P,pnlPercent:A,reason:"Signal"}),i=null}}const M=i?i.quantity*(i.side==="buy"?T-i.entryPrice:i.entryPrice-T):0;x.push(l+M)}if(i){const m=s[s.length-1].close,j=i.quantity*(i.side==="buy"?m-i.entryPrice:i.entryPrice-m);l+=j,n.push({...i,exitPrice:m,exitBar:s.length-1,pnl:j,pnlPercent:j/i.entryPrice/i.quantity*100,reason:"End of Data"})}const u=n.filter(m=>m.pnl>0).length,o=n.filter(m=>m.pnl<=0).length,f=n.reduce((m,j)=>m+j.pnl,0),h=os(x);return{trades:n,equityCurve:x,finalBalance:l,totalTrades:n.length,wins:u,losses:o,winRate:n.length>0?u/n.length*100:0,totalPnl:f,maxDrawdown:h,profitFactor:o>0?n.filter(m=>m.pnl>0).reduce((m,j)=>m+j.pnl,0)/Math.abs(n.filter(m=>m.pnl<=0).reduce((m,j)=>m+j.pnl,0)||1):u>0?1/0:0,logs:p}}function os(d){let s=d[0],t=0;for(const a of d){a>s&&(s=a);const r=(s-a)/s*100;r>t&&(t=r)}return t}const Se=[{id:"ema_cross",name:"EMA Crossover",description:"Compra cuando EMA r√°pida cruza arriba de EMA lenta, vende al cruce inverso",difficulty:"Principiante",code:`// EMA Crossover Strategy
// Se√±al de compra: EMA r√°pida cruza arriba de EMA lenta
// Se√±al de venta: EMA r√°pida cruza abajo de EMA lenta

const fast = ema(12);
const slow = ema(26);

if (crossover(fast, slow)) {
  buy();
}

if (crossunder(fast, slow)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 4 });`},{id:"rsi_reversal",name:"RSI Reversal",description:"Compra en sobreventa (RSI < 30), vende en sobrecompra (RSI > 70)",difficulty:"Principiante",code:`// RSI Reversal Strategy
// Compra cuando RSI est√° sobrevendido
// Vende cuando RSI est√° sobrecomprado

const rsiVal = rsi(14);

if (rsiVal < 30) {
  buy();
}

if (rsiVal > 70) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"macd_momentum",name:"MACD Momentum",description:"Opera el cruce de la l√≠nea MACD con su se√±al",difficulty:"Intermedio",code:`// MACD Momentum Strategy
// Se√±al de compra: l√≠nea MACD cruza arriba de se√±al
// Se√±al de venta: l√≠nea MACD cruza abajo de se√±al

const m = macd(12, 26, 9);

if (crossover(m.line, m.signal)) {
  buy();
}

if (crossunder(m.line, m.signal)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 5 });`},{id:"bb_squeeze",name:"Bollinger Bands Squeeze",description:"Compra cuando el precio toca la banda inferior, vende en la superior",difficulty:"Intermedio",code:`// Bollinger Bands Bounce Strategy
// Compra en banda inferior, vende en banda superior

const bands = bb(20, 2);
const rsiVal = rsi(14);

// Comprar cerca de banda inferior con RSI sobrevendido
if (close < bands.lower && rsiVal < 35) {
  buy();
}

// Vender cerca de banda superior con RSI sobrecomprado
if (close > bands.upper && rsiVal > 65) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"triple_confirmation",name:"Triple Confirmaci√≥n",description:"EMA + RSI + MACD confirman la se√±al de entrada ‚Äî alta probabilidad",difficulty:"Avanzado",code:`// Triple Confirmation Strategy
// Requiere 3 indicadores para confirmar entrada
// Alta probabilidad, menos trades pero m√°s precisos

const ema20 = ema(20);
const ema50 = ema(50);
const rsiVal = rsi(14);
const m = macd(12, 26, 9);

// COMPRA: EMA cruce alcista + RSI < 45 + MACD positivo
if (crossover(ema20, ema50) && rsiVal < 45 && m.histogram > 0) {
  buy();
  log("Triple confirmaci√≥n alcista");
}

// VENTA: EMA cruce bajista + RSI > 55 + MACD negativo
if (crossunder(ema20, ema50) && rsiVal > 55 && m.histogram < 0) {
  sell();
  log("Triple confirmaci√≥n bajista");
}

config({ stopLoss: 2.5, takeProfit: 6 });`},{id:"vwap_scalper",name:"VWAP Scalper",description:"Scalping basado en VWAP con EMA como filtro de tendencia",difficulty:"Avanzado",code:`// VWAP Scalper Strategy
// Compra cuando precio cruza arriba de VWAP con tendencia alcista
// Scalping r√°pido con stops ajustados

const v = vwap();
const trend = ema(50);
const momentum = rsi(10);

// Tendencia alcista + precio cruza VWAP hacia arriba
if (crossover(close, v) && close > trend && momentum > 50) {
  buy();
  log("Long VWAP bounce en tendencia alcista");
}

// Tendencia bajista + precio cruza VWAP hacia abajo
if (crossunder(close, v) && close < trend && momentum < 50) {
  sell();
  log("Short VWAP rejection en tendencia bajista");
}

config({ stopLoss: 0.8, takeProfit: 1.5 });`},{id:"custom_blank",name:"Script Vac√≠o",description:"Empieza desde cero ‚Äî escribe tu propia estrategia",difficulty:"Cualquiera",code:`// Mi Estrategia Personalizada
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Funciones disponibles:
//   ema(periodo), sma(periodo), rsi(periodo)
//   macd(fast, slow, signal), bb(periodo, stdDev), vwap()
//   crossover(a, b), crossunder(a, b)
//   highest(indicador, periodo), lowest(indicador, periodo)
//   avg(indicador, periodo), change(indicador, periodos)
//   percentChange(indicador, periodos)
//
// Variables: close, open, high, low, volume, price
// Acciones: buy(), sell(), config({ stopLoss, takeProfit })
//           log("mensaje"), alert("alerta")
//
// Tip: P√≠dele a ChatGPT que te genere una estrategia
//      usando estas funciones!

// Escribe tu estrategia aqu√≠:


config({ stopLoss: 2, takeProfit: 4 });`}],_e=`Eres un experto creando estrategias de trading para Kairos Script. Genera c√≥digo usando SOLO estas funciones:

INDICADORES (retornan valores num√©ricos):
- ema(periodo) ‚Äî Media M√≥vil Exponencial
- sma(periodo) ‚Äî Media M√≥vil Simple
- rsi(periodo) ‚Äî √çndice de Fuerza Relativa (0-100)
- macd(fast, slow, signal) ‚Äî retorna { line, signal, histogram }
- bb(periodo, stdDev) ‚Äî retorna { upper, middle, lower }
- vwap() ‚Äî Volume Weighted Average Price

DATOS:
- close, open, high, low, volume ‚Äî valores actuales
- price ‚Äî precio actual (n√∫mero)

DETECCI√ìN DE CRUCES:
- crossover(a, b) ‚Äî true si A cruza arriba de B
- crossunder(a, b) ‚Äî true si A cruza abajo de B

UTILIDADES:
- highest(indicador, periodo) ‚Äî valor m√°s alto en N per√≠odos
- lowest(indicador, periodo) ‚Äî valor m√°s bajo en N per√≠odos
- avg(indicador, periodo) ‚Äî promedio en N per√≠odos
- change(indicador, periodos) ‚Äî cambio absoluto
- percentChange(indicador, periodos) ‚Äî cambio porcentual

ACCIONES:
- buy() ‚Äî se√±al de compra
- sell() ‚Äî se√±al de venta
- config({ stopLoss: %, takeProfit: % }) ‚Äî configurar SL/TP
- log("mensaje") ‚Äî registrar mensaje

REGLAS:
1. NO uses window, document, fetch, eval, require, import
2. Solo JavaScript simple (if/else, const/let, operadores)
3. El c√≥digo se ejecuta en cada vela nueva
4. Siempre incluye config() con stopLoss y takeProfit
5. Las comparaciones con indicadores funcionan directamente (ej: rsi(14) < 30)

Genera SOLO el c√≥digo, sin explicaciones fuera del c√≥digo. Usa comentarios en espa√±ol.`;class cs{constructor(){this.activeBots=new Map,this.intervals=new Map}async startBot(s,t,a){if(this.activeBots.has(s.id))return;a==null||a(`ü§ñ Bot "${s.name}" iniciado en ${s.pair}`),this.activeBots.set(s.id,{bot:s,running:!0});const r=this._getCheckInterval(s.timeframe),l=async()=>{var n;if((n=this.activeBots.get(s.id))!=null&&n.running)try{const x=await H.getCandles(s.pair,s.timeframe,100),p=x.map(o=>o.close),g=p[p.length-1],u=this._evaluateStrategy(s.strategy,x,p);if(u){a==null||a(`üìä Se√±al detectada: ${u.type.toUpperCase()} a $${g}`);const o=this._calculatePositionSize(s,g),f={symbol:s.pair,side:u.type,type:"market",quantity:o,price:g,stopLoss:u.type==="buy"?g*(1-parseFloat(s.strategy.stopLoss)/100):g*(1+parseFloat(s.strategy.stopLoss)/100),takeProfit:u.type==="buy"?g*(1+parseFloat(s.strategy.takeProfit)/100):g*(1-parseFloat(s.strategy.takeProfit)/100)};t==null||t(f),a==null||a(`‚úÖ Orden ejecutada: ${u.type.toUpperCase()} ${o} ${s.pair} @ $${g}`)}}catch(x){a==null||a(`‚ùå Error: ${x.message}`)}};await l();const i=setInterval(l,r);this.intervals.set(s.id,i)}stopBot(s){const t=this.activeBots.get(s);t&&(t.running=!1,this.activeBots.delete(s));const a=this.intervals.get(s);a&&(clearInterval(a),this.intervals.delete(s))}_evaluateStrategy(s,t,a){var i,n,x,p,g,u,o,f,h,b,y,m;if((s==null?void 0:s.type)==="custom_script"&&(s!=null&&s.code)){const j=st(s.code,t);return j.error?(console.warn("[KairosScript] Error:",j.error),null):j.signal}if(!((i=s==null?void 0:s.entry)!=null&&i.indicator))return null;const r=a.length,l=s.entry.indicator;switch(l){case"ema_cross":case"ema_cross_rsi":{const j=((n=s.entry.params)==null?void 0:n.fastEma)||((x=s.entry.params)==null?void 0:x.fast)||20,T=((p=s.entry.params)==null?void 0:p.slowEma)||((g=s.entry.params)==null?void 0:g.slow)||50,B=Z(a,j),S=Z(a,T),k=we(B,S,r-1);if(l==="ema_cross_rsi"){const M=((u=s.entry.params)==null?void 0:u.rsiPeriod)||14,A=oe(a,M)[r-1],D=((o=s.entry.params)==null?void 0:o.rsiOversold)||30,z=((h=(f=s.exit)==null?void 0:f.params)==null?void 0:h.rsiOverbought)||70;if(k==="bullish_cross"&&A<D)return{type:"buy"};if(k==="bearish_cross"&&A>z)return{type:"sell"};if(A>z)return{type:"sell"};if(A<D)return{type:"buy"}}else{if(k==="bullish_cross")return{type:"buy"};if(k==="bearish_cross")return{type:"sell"}}break}case"rsi":{const j=((b=s.entry.params)==null?void 0:b.period)||14,B=oe(a,j)[r-1];if(B<(((y=s.entry.params)==null?void 0:y.oversold)||30))return{type:"buy"};if(B>(((m=s.entry.params)==null?void 0:m.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:j,signal:T}=Ee(a),B=we(j,T,r-1);if(B==="bullish_cross")return{type:"buy"};if(B==="bearish_cross")return{type:"sell"};break}default:return null}return null}_calculatePositionSize(s,t){const a=s.balance||1e3,r=parseFloat(s.riskPercent||2)/100,l=a*r/t;return Math.round(l*1e8)/1e8}_getCheckInterval(s){return{"1m":6e4,"5m":3e5,"15m":9e5,"1h":3e5,"4h":9e5,"1d":36e5}[s]||3e5}getActiveBotCount(){return this.activeBots.size}}const qe=new cs;class ds{constructor(){this.activeBots=new Map}start(s){if(this.activeBots.has(s.id))return;const{pair:t,upperPrice:a,lowerPrice:r,gridLines:l,investment:i,onLog:n,onTrade:x}=s,p=(a-r)/(l-1),g=[];for(let f=0;f<l;f++)g.push(+(r+p*f).toFixed(2));const u=i/(l-1),o={id:s.id,pair:t,levels:g,priceStep:p,investmentPerGrid:u,activeOrders:new Map,filledBuys:[],totalProfit:0,trades:0,running:!0,lastPrice:null};this.activeBots.set(s.id,o),n==null||n(`üìä Grid Bot started: ${l} levels from $${r} to $${a}`),n==null||n(`üí∞ Investment per grid: $${u.toFixed(2)}`),this._startMonitor(o,n,x)}async _startMonitor(s,t,a){const r=async()=>{if(s.running)try{const n=(await H.get24hrTicker(s.pair)).price,x=s.lastPrice;if(s.lastPrice=n,!x){t==null||t(`üìà Current price: $${n.toFixed(2)}`);for(const g of s.levels)g<n?s.activeOrders.set(g,{side:"buy",price:g,status:"pending"}):g>n;const p=s.activeOrders.size;t==null||t(`üü¢ ${p} buy orders placed below current price`);return}for(const p of s.levels){const g=s.activeOrders.get(p);if((g==null?void 0:g.side)==="buy"&&g.status==="pending"&&n<=p){const u=s.investmentPerGrid/p;g.status="filled",s.filledBuys.push(p),s.trades++,a==null||a({symbol:s.pair,side:"buy",type:"grid",quantity:+u.toFixed(6),price:p,gridLevel:p}),t==null||t(`‚úÖ BUY filled at $${p} (qty: ${u.toFixed(6)})`);const o=p+s.priceStep;o<=s.levels[s.levels.length-1]&&(s.activeOrders.set(o,{side:"sell",price:o,status:"pending",buyLevel:p,quantity:u}),t==null||t(`üì§ SELL order placed at $${o.toFixed(2)}`))}if((g==null?void 0:g.side)==="sell"&&g.status==="pending"&&n>=p){g.status="filled";const u=(p-g.buyLevel)*g.quantity;s.totalProfit+=u,s.trades++,a==null||a({symbol:s.pair,side:"sell",type:"grid",quantity:+g.quantity.toFixed(6),price:p,profit:+u.toFixed(2),gridLevel:p}),t==null||t(`‚úÖ SELL filled at $${p.toFixed(2)} ‚Äî Profit: +$${u.toFixed(2)}`);const o=p-s.priceStep;o>=s.levels[0]&&(s.activeOrders.set(o,{side:"buy",price:o,status:"pending"}),t==null||t(`üì• BUY order re-placed at $${o.toFixed(2)}`))}}}catch(i){t==null||t(`‚ùå Error: ${i.message}`)}};await r();const l=setInterval(r,1e4);s._interval=l}stop(s){const t=this.activeBots.get(s);t&&(t.running=!1,t._interval&&clearInterval(t._interval),this.activeBots.delete(s))}getStats(s){const t=this.activeBots.get(s);return t?{levels:t.levels.length,activeOrders:[...t.activeOrders.values()].filter(a=>a.status==="pending").length,filledBuys:t.filledBuys.length,totalProfit:t.totalProfit,trades:t.trades,lastPrice:t.lastPrice}:null}isRunning(s){return this.activeBots.has(s)}}const Le=new ds;class xs{constructor(){this.activeBots=new Map}start(s){if(this.activeBots.has(s.id))return;const{pair:t,investmentPerOrder:a,intervalMinutes:r,maxOrders:l=100,useRsiFilter:i=!1,rsiPeriod:n=14,rsiThreshold:x=40,usePriceDipFilter:p=!1,dipPercent:g=3,onLog:u,onTrade:o}=s,f={id:s.id,pair:t,investmentPerOrder:a,intervalMinutes:r,maxOrders:l,useRsiFilter:i,rsiPeriod:n,rsiThreshold:x,usePriceDipFilter:p,dipPercent:g,executedOrders:0,totalInvested:0,totalQuantity:0,avgPrice:0,prices:[],running:!0,lastBuyPrice:null,startTime:Date.now()};this.activeBots.set(s.id,f),u==null||u(`üìä DCA Bot started: $${a} every ${r}min on ${t}`),i&&(u==null||u(`üìâ RSI filter enabled: buy when RSI < ${x}`)),p&&(u==null||u(`üìâ Dip filter enabled: buy when price drops ${g}%`)),this._startMonitor(f,u,o)}async _startMonitor(s,t,a){const r=async()=>{if(s.running){if(s.executedOrders>=s.maxOrders){t==null||t(`üèÅ Max orders reached (${s.maxOrders}). DCA Bot stopped.`),this.stop(s.id);return}try{const n=(await H.get24hrTicker(s.pair)).price;if(s.useRsiFilter)try{const g=(await H.getCandles(s.pair,"1h",100)).map(f=>f.close),u=oe(g,s.rsiPeriod),o=u[u.length-1];if(o>s.rsiThreshold){t==null||t(`‚è∏Ô∏è RSI ${o.toFixed(1)} > ${s.rsiThreshold} ‚Äî skipping buy`);return}t==null||t(`üìâ RSI ${o.toFixed(1)} < ${s.rsiThreshold} ‚Äî proceeding with buy`)}catch(p){t==null||t(`‚ö†Ô∏è RSI check failed, proceeding anyway: ${p.message}`)}if(s.usePriceDipFilter&&s.lastBuyPrice){const p=(s.lastBuyPrice-n)/s.lastBuyPrice*100;if(p<s.dipPercent){t==null||t(`‚è∏Ô∏è Price drop ${p.toFixed(2)}% < ${s.dipPercent}% ‚Äî skipping buy`);return}t==null||t(`üìâ Price dropped ${p.toFixed(2)}% ‚Äî proceeding with buy`)}const x=s.investmentPerOrder/n;s.executedOrders++,s.totalInvested+=s.investmentPerOrder,s.totalQuantity+=x,s.avgPrice=s.totalInvested/s.totalQuantity,s.lastBuyPrice=n,s.prices.push(n),a==null||a({symbol:s.pair,side:"buy",type:"dca",quantity:+x.toFixed(8),price:n,dcaOrder:s.executedOrders,avgPrice:+s.avgPrice.toFixed(2)}),t==null||t(`‚úÖ DCA Buy #${s.executedOrders}: ${x.toFixed(6)} ${s.pair.replace("USDT","")} @ $${n.toFixed(2)}`),t==null||t(`üìä Avg price: $${s.avgPrice.toFixed(2)} | Total invested: $${s.totalInvested.toFixed(2)}`)}catch(i){t==null||t(`‚ùå Error: ${i.message}`)}}};await r();const l=setInterval(r,s.intervalMinutes*60*1e3);s._interval=l}stop(s){const t=this.activeBots.get(s);t&&(t.running=!1,t._interval&&clearInterval(t._interval),this.activeBots.delete(s))}getStats(s){const t=this.activeBots.get(s);if(!t)return null;const r=t.totalQuantity*(t.lastBuyPrice||0)-t.totalInvested;return{executedOrders:t.executedOrders,maxOrders:t.maxOrders,totalInvested:t.totalInvested,totalQuantity:t.totalQuantity,avgPrice:t.avgPrice,currentPrice:t.lastBuyPrice,unrealizedPnl:r,unrealizedPnlPercent:t.totalInvested>0?r/t.totalInvested*100:0,runningTime:Date.now()-t.startTime}}isRunning(s){return this.activeBots.has(s)}}const Ue=new xs;function ps(d){if(!d)return"";let s=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return s=s.replace(/(\/\/.*$)/gm,'<span class="ks-comment">$1</span>'),s=s.replace(/("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*'|`(?:[^`\\]|\\.)*`)/g,'<span class="ks-string">$1</span>'),s=s.replace(/\b(\d+\.?\d*)\b/g,'<span class="ks-number">$1</span>'),s=s.replace(/\b(const|let|var|if|else|return|true|false|null|undefined)\b/g,'<span class="ks-keyword">$1</span>'),s=s.replace(/\b(ema|sma|rsi|macd|bb|vwap|crossover|crossunder|highest|lowest|avg|change|percentChange)\b/g,'<span class="ks-function">$1</span>'),s=s.replace(/\b(buy|sell|config|log|alert)\b/g,'<span class="ks-action">$1</span>'),s=s.replace(/\b(close|open|high|low|volume|price|barIndex)\b/g,'<span class="ks-data">$1</span>'),s=s.replace(/\.(line|signal|histogram|upper|middle|lower|stopLoss|takeProfit)\b/g,'.<span class="ks-property">$1</span>'),s}function ms({code:d,onChange:s,error:t,readOnly:a=!1}){const r=N.useRef(null),l=N.useRef(null),i=N.useRef(null),x=(d||"").split(`
`).length,p=N.useCallback(()=>{r.current&&l.current&&i.current&&(l.current.scrollTop=r.current.scrollTop,l.current.scrollLeft=r.current.scrollLeft,i.current.scrollTop=r.current.scrollTop)},[]),g=u=>{if(a)return;if(u.key==="Tab"){u.preventDefault();const f=u.target.selectionStart,h=u.target.selectionEnd,b=d.substring(0,f)+"  "+d.substring(h);s(b),setTimeout(()=>{u.target.selectionStart=u.target.selectionEnd=f+2},0)}const o={"(":")","[":"]","{":"}",'"':'"',"'":"'"};if(o[u.key]){u.preventDefault();const f=u.target.selectionStart,h=u.target.selectionEnd,b=d.substring(f,h),y=d.substring(0,f)+u.key+b+o[u.key]+d.substring(h);s(y),setTimeout(()=>{u.target.selectionStart=f+1,u.target.selectionEnd=f+1+b.length},0)}};return e.jsxs("div",{className:"relative rounded-xl overflow-hidden border",style:{background:"#0a0c10",borderColor:t?"var(--red)":"var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-[10px] font-bold tracking-wider uppercase",style:{background:"rgba(59,130,246,0.05)",borderBottom:"1px solid var(--border)",color:"var(--text-dim)"},children:[e.jsx(Nt,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{children:"Kairos Script"}),t&&e.jsxs("span",{className:"ml-auto text-[var(--red)] normal-case tracking-normal flex items-center gap-1",children:[e.jsx(Xe,{size:10})," ",t]})]}),e.jsxs("div",{className:"flex",style:{height:320},children:[e.jsx("div",{ref:i,className:"select-none text-right pr-3 pl-3 pt-3 overflow-hidden shrink-0 font-mono text-xs leading-[1.65]",style:{color:"var(--text-dim)",background:"rgba(255,255,255,0.02)",width:48},children:Array.from({length:x},(u,o)=>e.jsx("div",{children:o+1},o))}),e.jsxs("div",{className:"relative flex-1 overflow-hidden",children:[e.jsx("pre",{ref:l,className:"absolute inset-0 p-3 font-mono text-xs leading-[1.65] overflow-auto pointer-events-none whitespace-pre-wrap break-words",style:{color:"var(--text)"},dangerouslySetInnerHTML:{__html:ps(d)}}),e.jsx("textarea",{ref:r,value:d,onChange:u=>s(u.target.value),onScroll:p,onKeyDown:g,readOnly:a,spellCheck:!1,className:"absolute inset-0 w-full h-full p-3 font-mono text-xs leading-[1.65] resize-none outline-none bg-transparent caret-[var(--gold)]",style:{color:"transparent",caretColor:"var(--gold)",WebkitTextFillColor:"transparent"},placeholder:"// Escribe o pega tu estrategia aqu√≠..."})]})]})]})}function us({results:d,onClose:s}){if(!d)return null;const{trades:t,equityCurve:a,finalBalance:r,totalTrades:l,wins:i,losses:n,winRate:x,totalPnl:p,maxDrawdown:g,profitFactor:u}=d,o=p>=0;return e.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Balance Final",value:`$${r.toFixed(2)}`,icon:re,color:o?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${x.toFixed(1)}%`,icon:wt,color:x>=50?"var(--green)":"var(--red)"},{label:"Max Drawdown",value:`${g.toFixed(1)}%`,icon:Ye,color:g<10?"var(--green)":"var(--red)"},{label:"Profit Factor",value:u===1/0?"‚àû":u.toFixed(2),icon:ye,color:u>=1.5?"var(--green)":"var(--red)"}].map((f,h)=>e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(f.icon,{size:14,className:"mx-auto mb-1",style:{color:f.color}}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:f.label}),e.jsx("p",{className:"text-sm font-bold",style:{color:f.color},children:f.value})]},h))}),e.jsxs("div",{className:"flex items-center gap-4 text-xs px-3 py-2 rounded-lg",style:{background:"var(--surface-2)"},children:[e.jsxs("span",{className:"text-[var(--text-dim)]",children:["Total trades: ",e.jsx("b",{className:"text-[var(--text)]",children:l})]}),e.jsxs("span",{className:"text-[var(--green)]",children:["Ganados: ",e.jsx("b",{children:i})]}),e.jsxs("span",{className:"text-[var(--red)]",children:["Perdidos: ",e.jsx("b",{children:n})]}),e.jsxs("span",{className:"ml-auto font-bold",style:{color:o?"var(--green)":"var(--red)"},children:[o?"+":"","$",p.toFixed(2)]})]}),e.jsx(hs,{data:a}),t.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto rounded-lg",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px]",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("th",{className:"text-left p-2",children:"Tipo"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"}),e.jsx("th",{className:"text-right p-2",children:"Raz√≥n"})]})}),e.jsx("tbody",{children:t.slice(-10).reverse().map((f,h)=>{var b,y,m;return e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{className:`p-2 font-bold ${f.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:f.side==="buy"?"LONG":"SHORT"}),e.jsxs("td",{className:"p-2 text-right text-[var(--text)]",children:["$",(b=f.entryPrice)==null?void 0:b.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right text-[var(--text)]",children:["$",(y=f.exitPrice)==null?void 0:y.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-bold ${f.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[f.pnl>=0?"+":"","$",(m=f.pnl)==null?void 0:m.toFixed(2)]}),e.jsx("td",{className:"p-2 text-right text-[var(--text-dim)]",children:f.reason})]},h)})})]})})]})}function hs({data:d}){const s=N.useRef(null);return N.useEffect(()=>{const t=s.current;if(!t||!d||d.length<2)return;const a=t.getContext("2d");t.width=t.offsetWidth*2,t.height=t.offsetHeight*2,a.scale(2,2);const r=t.offsetWidth,l=t.offsetHeight;a.clearRect(0,0,r,l);const i=Math.min(...d),x=Math.max(...d)-i||1,p=a.createLinearGradient(0,0,0,l),g=d[d.length-1]>=d[0];p.addColorStop(0,g?"rgba(0,220,130,0.2)":"rgba(255,71,87,0.2)"),p.addColorStop(1,"transparent"),a.beginPath(),d.forEach((u,o)=>{const f=o/(d.length-1)*r,h=l-(u-i)/x*(l-8)-4;o===0?a.moveTo(f,h):a.lineTo(f,h)}),a.strokeStyle=g?"#00DC82":"#FF4757",a.lineWidth=1.5,a.stroke(),a.lineTo(r,l),a.lineTo(0,l),a.closePath(),a.fillStyle=p,a.fill()},[d]),e.jsxs("div",{className:"rounded-lg overflow-hidden",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"px-3 py-1.5 flex items-center justify-between",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-bold uppercase tracking-wider",children:"Equity Curve"}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[(d==null?void 0:d.length)||0," bars"]})]}),e.jsx("canvas",{ref:s,className:"w-full",style:{height:80}})]})}function at({onSave:d,onClose:s,initialCode:t,initialName:a,editMode:r=!1}){const[l,i]=N.useState(a||""),[n,x]=N.useState(t||Se[Se.length-1].code),[p,g]=N.useState(null),[u,o]=N.useState(!1),[f,h]=N.useState(!1),[b,y]=N.useState(!1),[m,j]=N.useState(null),[T,B]=N.useState(!1),[S,k]=N.useState("BTCUSDT"),[M,P]=N.useState("1h"),[A,D]=N.useState(!1);N.useEffect(()=>{const w=setTimeout(()=>{if(n!=null&&n.trim()){const L=ze(n);g(L.valid?null:L.error)}else g(null)},500);return()=>clearTimeout(w)},[n]);const z=async()=>{B(!0),j(null);try{const w=await H.getCandles(S,M,500);if(!w||w.length<50){g("No hay suficientes datos para el backtest"),B(!1);return}const L=ls(n,w,{initialBalance:1e3,riskPercent:2});j(L)}catch(w){g(`Error en backtest: ${w.message}`)}B(!1)},c=()=>{if(!l.trim()){g("Dale un nombre a tu estrategia");return}const w=ze(n);if(!w.valid){g(w.error);return}d==null||d({name:l.trim(),code:n,type:"custom_script"}),D(!0),setTimeout(()=>D(!1),2e3)},$=w=>{x(w.code),l||i(w.name),o(!1),j(null)},v=()=>{var w;(w=navigator.clipboard)==null||w.writeText(_e),y(!1)},C=async()=>{var w;try{const L=await((w=navigator.clipboard)==null?void 0:w.readText());L&&(x(L),j(null))}catch{}};return e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)"},children:e.jsx(J,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold",children:r?"Editar Estrategia":"Nueva Estrategia Custom"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Escribe c√≥digo o pega desde ChatGPT"})]})]}),s&&e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-lg flex items-center justify-center hover:bg-[var(--surface-2)] transition-colors",children:e.jsx(vt,{size:16,className:"text-[var(--text-dim)]"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:l,onChange:w=>i(w.target.value),placeholder:"Mi Estrategia EMA Cross",className:"w-full px-3 py-2 rounded-lg text-sm",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"}})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>o(!u),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(bt,{size:13})," Templates"]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(ft,{size:13})," Pegar"]}),e.jsxs("button",{onClick:()=>{var w;return(w=navigator.clipboard)==null?void 0:w.writeText(n)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:[e.jsx(Te,{size:13})," Copiar"]}),e.jsxs("button",{onClick:()=>y(!b),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)",color:"var(--gold)"},children:[e.jsx(ne,{size:13})," Prompt ChatGPT"]}),e.jsxs("button",{onClick:()=>h(!f),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-colors hover:bg-[var(--surface-2)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text-dim)"},children:[e.jsx(yt,{size:13})," Ayuda"]})]}),e.jsx(W,{children:u&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 p-3 rounded-xl",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:Se.map(w=>e.jsxs("button",{onClick:()=>$(w),className:"text-left p-3 rounded-lg transition-colors hover:bg-[var(--dark-3)]",style:{border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(X,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--text)]",children:w.name})]}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:w.description}),e.jsx("span",{className:"text-[9px] mt-1.5 inline-block px-1.5 py-0.5 rounded-md font-bold uppercase",style:{color:w.difficulty==="Principiante"?"var(--green)":w.difficulty==="Intermedio"?"var(--gold)":"#A855F7",background:w.difficulty==="Principiante"?"rgba(0,220,130,0.1)":w.difficulty==="Intermedio"?"rgba(59,130,246,0.1)":"rgba(168,85,247,0.1)"},children:w.difficulty})]},w.id))})})}),e.jsx(W,{children:b&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 rounded-xl space-y-3",style:{background:"rgba(59,130,246,0.05)",border:"1px solid rgba(59,130,246,0.2)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:14,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Genera estrategias con ChatGPT"})]}),e.jsx("p",{className:"text-[11px] text-[var(--text-secondary)] leading-relaxed",children:"1. Copia este prompt ‚Üí 2. P√©galo en ChatGPT ‚Üí 3. Dile qu√© estrategia quieres ‚Üí 4. Copia el c√≥digo que te d√© ‚Üí 5. P√©galo aqu√≠"}),e.jsxs("div",{className:"p-2 rounded-lg font-mono text-[10px] max-h-24 overflow-y-auto",style:{background:"var(--surface-2)",color:"var(--text-dim)",border:"1px solid var(--border)"},children:[_e.slice(0,200),"..."]}),e.jsxs("button",{onClick:v,className:"w-full py-2 btn-gold rounded-lg text-xs font-bold flex items-center justify-center gap-2",children:[e.jsx(Te,{size:12})," Copiar Prompt Completo"]})]})})}),e.jsx(W,{children:f&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 rounded-xl space-y-3 max-h-48 overflow-y-auto",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("h4",{className:"text-xs font-bold text-[var(--gold)]",children:"Funciones Disponibles"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-[10px] font-mono",children:[["ema(periodo)","Media M√≥vil Exponencial"],["sma(periodo)","Media M√≥vil Simple"],["rsi(periodo)","Fuerza Relativa (0-100)"],["macd(f, s, sig)","MACD ‚Üí .line .signal .histogram"],["bb(periodo, std)","Bollinger ‚Üí .upper .middle .lower"],["vwap()","Precio Promedio por Volumen"],["crossover(a, b)","A cruza arriba de B"],["crossunder(a, b)","A cruza abajo de B"],["highest(ind, n)","M√°ximo en N per√≠odos"],["lowest(ind, n)","M√≠nimo en N per√≠odos"],["buy()","Se√±al de compra"],["sell()","Se√±al de venta"],["config({...})","stopLoss, takeProfit (%)"],['log("msg")',"Registrar mensaje"]].map(([w,L])=>e.jsxs("div",{className:"flex items-baseline gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--gold)] shrink-0",children:w}),e.jsx("span",{className:"text-[var(--text-dim)]",children:L})]},w))}),e.jsx("h4",{className:"text-xs font-bold text-[var(--gold)] pt-2",children:"Variables"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] font-mono",children:"close, open, high, low, volume, price, barIndex"})]})})}),e.jsx(ms,{code:n,onChange:w=>{x(w),j(null)},error:p}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:S,onChange:w=>k(w.target.value),className:"px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","ADAUSDT","DOGEUSDT","XRPUSDT"].map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsx("select",{value:M,onChange:w=>P(w.target.value),className:"px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text)"},children:["1m","5m","15m","1h","4h","1d"].map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsxs("button",{onClick:z,disabled:T||!!p,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg text-xs font-bold transition-colors disabled:opacity-40",style:{background:"rgba(0,220,130,0.1)",border:"1px solid rgba(0,220,130,0.2)",color:"var(--green)"},children:[T?e.jsx(Je,{size:13,className:"animate-spin"}):e.jsx(ie,{size:13}),T?"Testeando...":"Backtest"]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:c,disabled:!!p||!(n!=null&&n.trim()),className:"flex items-center gap-1.5 px-5 py-2 btn-gold rounded-lg text-xs font-bold disabled:opacity-40",children:[A?e.jsx(je,{size:13}):e.jsx(jt,{size:13}),A?"Guardada!":"Guardar Estrategia"]})]}),e.jsx(W,{children:m&&e.jsx(us,{results:m})})]})]})}const ke=[{id:"signal",label:"Signal Bot",icon:X,desc:"Indicadores t√©cnicos predefinidos",color:"#3B82F6"},{id:"script",label:"Script Bot",icon:J,desc:"Estrategia personalizada con c√≥digo",color:"#A855F7"},{id:"grid",label:"Grid Bot",icon:St,desc:"Compra y vende en niveles de precio",color:"#00DC82"},{id:"dca",label:"DCA Bot",icon:ue,desc:"Inversi√≥n a intervalos regulares",color:"#22D3EE"}];function gs(){const{bots:d,addBot:s,updateBot:t,removeBot:a,strategies:r,addStrategy:l,brokers:i}=V(),[n,x]=N.useState(!1),[p,g]=N.useState(!1),[u,o]=N.useState(null),[f,h]=N.useState("signal"),[b,y]=N.useState([]),[m,j]=N.useState({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10",upperPrice:"",lowerPrice:"",gridLines:"10",investmentPerOrder:"100",intervalMinutes:"60",maxOrders:"50",useRsiFilter:!1,rsiThreshold:"40",usePriceDipFilter:!1,dipPercent:"3",scriptCode:"",scriptStrategyId:""}),T=()=>{if(!m.name||!m.pair)return;const c={name:m.name,pair:m.pair,botType:f,brokerId:m.brokerId};if(f==="signal"){const $=r.find(v=>v.id===m.strategyId)||{name:"EMA Cross + RSI",entry:{condition:"EMA 20 cruza EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"};Object.assign(c,{timeframe:m.timeframe,strategy:$,balance:parseFloat(m.balance),riskPercent:parseFloat(m.riskPercent),maxTrades:parseInt(m.maxTrades)})}else if(f==="script"){const $=r.find(v=>v.id===m.scriptStrategyId);if(!($!=null&&$.code))return;Object.assign(c,{timeframe:m.timeframe,strategy:{type:"custom_script",code:$.code,name:$.name},balance:parseFloat(m.balance),riskPercent:parseFloat(m.riskPercent),maxTrades:parseInt(m.maxTrades),scriptName:$.name})}else f==="grid"?Object.assign(c,{upperPrice:parseFloat(m.upperPrice),lowerPrice:parseFloat(m.lowerPrice),gridLines:parseInt(m.gridLines),balance:parseFloat(m.balance)}):f==="dca"&&Object.assign(c,{investmentPerOrder:parseFloat(m.investmentPerOrder),intervalMinutes:parseInt(m.intervalMinutes),maxOrders:parseInt(m.maxOrders),useRsiFilter:m.useRsiFilter,rsiThreshold:parseInt(m.rsiThreshold),usePriceDipFilter:m.usePriceDipFilter,dipPercent:parseFloat(m.dipPercent),balance:parseFloat(m.investmentPerOrder)*parseInt(m.maxOrders)});s(c),x(!1)},B=(c,$)=>{y(v=>[...v.slice(-100),{type:"log",bot:c.name,message:$,time:new Date().toLocaleTimeString()}])},S=(c,$)=>{y(C=>[...C.slice(-100),{type:"trade",bot:c.name,...$,time:new Date().toLocaleTimeString()}]);const v=V.getState().bots.find(C=>C.id===c.id);if(v){const C=(v.trades||0)+1,w=(v.pnl||0)+($.profit||0);t(c.id,{trades:C,pnl:w})}},k=async c=>{t(c.id,{status:"active"});const $=c.botType||"signal";$==="signal"||$==="script"?qe.startBot({...c,status:"active"},v=>S(c,v),v=>B(c,v)):$==="grid"?Le.start({id:c.id,pair:c.pair,upperPrice:c.upperPrice,lowerPrice:c.lowerPrice,gridLines:c.gridLines,investment:c.balance,onLog:v=>B(c,v),onTrade:v=>S(c,v)}):$==="dca"&&Ue.start({id:c.id,pair:c.pair,investmentPerOrder:c.investmentPerOrder,intervalMinutes:c.intervalMinutes,maxOrders:c.maxOrders,useRsiFilter:c.useRsiFilter,rsiThreshold:c.rsiThreshold,usePriceDipFilter:c.usePriceDipFilter,dipPercent:c.dipPercent,onLog:v=>B(c,v),onTrade:v=>S(c,v)})},M=c=>{const $=c.botType||"signal";$==="signal"||$==="script"?qe.stopBot(c.id):$==="grid"?Le.stop(c.id):$==="dca"&&Ue.stop(c.id),t(c.id,{status:"stopped"})},P=c=>{M(c),t(c.id,{status:"paused"})},A=c=>{M(c),a(c.id)},D=c=>{switch(c){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},z=c=>ke.find($=>$.id===c)||ke[0];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[d.filter(c=>c.status==="active").length," activos de ",d.length," total"]})]}),e.jsxs("button",{onClick:()=>x(!n),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(Ne,{size:16})," Crear Bot"]})]}),e.jsx(W,{children:n&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--text)]",children:"Nuevo Bot de Trading"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:ke.map(c=>{const $=c.icon;return e.jsxs("button",{onClick:()=>h(c.id),className:`p-3 rounded-xl text-left transition-all ${f===c.id?"ring-1":"hover:bg-[var(--surface-2)]"}`,style:{background:f===c.id?`${c.color}10`:"var(--surface-2)",borderColor:f===c.id?`${c.color}40`:"var(--border)",border:`1px solid ${f===c.id?c.color+"30":"var(--border)"}`},children:[e.jsx($,{size:20,style:{color:c.color},className:"mb-1.5"}),e.jsx("p",{className:"text-xs font-bold",style:{color:f===c.id?c.color:"var(--text)"},children:c.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mt-0.5",children:c.desc})]},c.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:m.name,onChange:c=>j({...m,name:c.target.value}),placeholder:"Mi Bot",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Par"}),e.jsx("select",{value:m.pair,onChange:c=>j({...m,pair:c.target.value}),className:"w-full",children:et.map(c=>e.jsx("option",{value:c,children:c},c))})]})]}),f==="signal"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:m.timeframe,onChange:c=>j({...m,timeframe:c.target.value}),className:"w-full",children:Ae.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:m.balance,onChange:c=>j({...m,balance:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:m.riskPercent,onChange:c=>j({...m,riskPercent:c.target.value}),className:"w-full"})]})]}),f==="script"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:m.timeframe,onChange:c=>j({...m,timeframe:c.target.value}),className:"w-full",children:Ae.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:m.balance,onChange:c=>j({...m,balance:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:m.riskPercent,onChange:c=>j({...m,riskPercent:c.target.value}),className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Estrategia"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:m.scriptStrategyId,onChange:c=>j({...m,scriptStrategyId:c.target.value}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Seleccionar estrategia..."}),r.filter(c=>c.type==="custom_script").map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shrink-0",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(J,{size:13})," ",r.filter(c=>c.type==="custom_script").length>0?"Crear Nueva":"Crear Estrategia"]})]})]})]}),f==="grid"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Superior ($)"}),e.jsx("input",{type:"number",value:m.upperPrice,onChange:c=>j({...m,upperPrice:c.target.value}),placeholder:"100000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Inferior ($)"}),e.jsx("input",{type:"number",value:m.lowerPrice,onChange:c=>j({...m,lowerPrice:c.target.value}),placeholder:"90000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Niveles de Grid"}),e.jsx("input",{type:"number",value:m.gridLines,onChange:c=>j({...m,gridLines:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Inversi√≥n Total ($)"}),e.jsx("input",{type:"number",value:m.balance,onChange:c=>j({...m,balance:c.target.value}),className:"w-full"})]})]}),f==="dca"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"$ por Compra"}),e.jsx("input",{type:"number",value:m.investmentPerOrder,onChange:c=>j({...m,investmentPerOrder:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Intervalo (min)"}),e.jsx("input",{type:"number",value:m.intervalMinutes,onChange:c=>j({...m,intervalMinutes:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"M√°x. Compras"}),e.jsx("input",{type:"number",value:m.maxOrders,onChange:c=>j({...m,maxOrders:c.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.useRsiFilter,onChange:c=>j({...m,useRsiFilter:c.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro RSI (comprar solo si RSI < ",m.rsiThreshold,")"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.usePriceDipFilter,onChange:c=>j({...m,usePriceDipFilter:c.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro de Ca√≠da (comprar cuando baje ",m.dipPercent,"%)"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm",children:"Crear Bot"}),e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2.5 bg-[var(--surface-2)] text-[var(--text-dim)] rounded-xl text-sm border border-[var(--border)]",children:"Cancelar"})]})]})})}),d.length===0?e.jsxs("div",{className:"rounded-xl p-12 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(xe,{size:48,className:"text-[var(--text-dim)]/20 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay bots creados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primer bot para automatizar tu trading"})]}):e.jsx("div",{className:"space-y-3",children:d.map(c=>{var C;const $=z(c.botType||"signal"),v=$.icon;return e.jsxs(I.div,{layout:!0,className:"rounded-xl p-4",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:`${$.color}12`,border:`1px solid ${$.color}20`},children:e.jsx(v,{size:20,style:{color:$.color}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-bold",children:c.name}),e.jsx("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded-md uppercase tracking-wider",style:{background:`${$.color}15`,color:$.color},children:$.label})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[c.pair,c.timeframe?` ‚Ä¢ ${c.timeframe}`:""]})]})]}),e.jsx("span",{className:"px-2.5 py-1 rounded-lg text-[10px] font-bold",style:{color:D(c.status),background:`${D(c.status)}15`},children:c.status==="active"?"‚óè Activo":c.status==="paused"?"‚ùö‚ùö Pausado":"‚ñ† Detenido"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Trades"}),e.jsx("p",{className:"text-sm font-bold",children:c.trades||0})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`text-sm font-bold ${(c.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(c.pnl||0)>=0?"+":"","$",(c.pnl||0).toFixed(2)]})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--gold)]",children:[(c.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"rounded-lg p-2 text-center",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold",children:["$",((C=c.balance)==null?void 0:C.toLocaleString())||"0"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[c.status!=="active"?e.jsxs("button",{onClick:()=>k(c),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/10 text-[var(--green)] rounded-lg text-xs font-bold hover:bg-[var(--green)]/20 transition-colors border border-[var(--green)]/20",children:[e.jsx(ie,{size:12})," Iniciar"]}):e.jsxs("button",{onClick:()=>P(c),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--gold)]/10 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/20 transition-colors border border-[var(--gold)]/20",children:[e.jsx(kt,{size:12})," Pausar"]}),e.jsxs("button",{onClick:()=>M(c),className:"flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Pt,{size:12})," Detener"]}),e.jsx("button",{onClick:()=>A(c),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] hover:text-[var(--red)] rounded-lg text-xs transition-colors",children:e.jsx(le,{size:12})})]})]},c.id)})}),b.length>0&&e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-3",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),"Actividad en Vivo"]}),e.jsx("button",{onClick:()=>y([]),className:"text-xs text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:"Limpiar"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-3 space-y-1 font-mono text-[11px]",children:b.slice(-50).reverse().map((c,$)=>{var v;return e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:c.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0 font-semibold",children:["[",c.bot,"]"]}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:c.message||`${(v=c.side)==null?void 0:v.toUpperCase()} ${c.quantity} @ $${c.price}`})]},$)})})]}),r.filter(c=>c.type==="custom_script").length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(J,{size:16,className:"text-[#A855F7]"})," Mis Estrategias"]}),e.jsxs("button",{onClick:()=>g(!0),className:"text-xs text-[var(--text-dim)] hover:text-[#A855F7] transition-colors flex items-center gap-1",children:[e.jsx(Ne,{size:12})," Nueva"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.filter(c=>c.type==="custom_script").map(c=>{var $;return e.jsxs("div",{className:"rounded-lg p-3 transition-colors hover:bg-[var(--dark-3)]",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-[var(--text)] flex items-center gap-1.5",children:[e.jsx(J,{size:12,className:"text-[#A855F7]"})," ",c.name]}),e.jsx("button",{onClick:()=>{o(c),g(!0)},className:"text-[var(--text-dim)] hover:text-[#A855F7] transition-colors",children:e.jsx(Ze,{size:12})})]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[(($=c.code)==null?void 0:$.split(`
`).filter(v=>v.trim()&&!v.trim().startsWith("//")).length)||0," l√≠neas de l√≥gica"]}),e.jsxs("p",{className:"text-[9px] text-[var(--text-dim)] mt-1",children:["Creada: ",new Date(c.createdAt).toLocaleDateString("es")]})]},c.id)})})]}),e.jsx(W,{children:p&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{g(!1),o(null)},children:e.jsx(I.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:e.jsx(at,{initialCode:u==null?void 0:u.code,initialName:u==null?void 0:u.name,editMode:!!u,onClose:()=>{g(!1),o(null)},onSave:c=>{const $=l(c);j(v=>({...v,scriptStrategyId:$.id})),g(!1),o(null)}})})})})]})}function vs(){var $;const{brokers:d,addBroker:s,removeBroker:t,updateBrokerStatus:a,setActiveBroker:r}=V(),[l,i]=N.useState(!1),[n,x]=N.useState({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),[p,g]=N.useState(!1),[u,o]=N.useState(null),[f,h]=N.useState(""),[b,y]=N.useState({}),[m,j]=N.useState({}),[T,B]=N.useState(null),[S,k]=N.useState({}),M=()=>{if(h(""),!n.apiKey||!n.apiSecret){h("API Key y Secret son obligatorios");return}const v=se[n.brokerId];if(v.requiredFields.includes("passphrase")&&!n.passphrase){h("Este broker requiere Passphrase");return}s({brokerId:n.brokerId,label:n.label||v.name,apiKey:n.apiKey,apiSecret:n.apiSecret,passphrase:n.passphrase}),x({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),i(!1)},P=async v=>{o(v.id);const C=await be.connect(v);a(v.id,C.success),C.success&&(r(v),A(v)),o(null)},A=N.useCallback(async v=>{j(C=>({...C,[v.id]:!0}));try{const C=await be.getBalances(v.id);C.success&&y(w=>({...w,[v.id]:C.balances}))}catch{}j(C=>({...C,[v.id]:!1}))},[]),D=N.useCallback(async v=>{try{const C=await be.getTradeHistory(v.id,"BTCUSDT",10);C.success&&k(w=>({...w,[v.id]:C.trades}))}catch{}},[]);N.useEffect(()=>{const v=d.filter(w=>w.connected);v.forEach(w=>A(w));const C=setInterval(()=>v.forEach(w=>A(w)),3e4);return()=>clearInterval(C)},[d,A]);const z=v=>{be.disconnect(v),t(v),y(C=>{const w={...C};return delete w[v],w})},c=v=>(b[v]||[]).reduce((w,L)=>["USDT","USDC","BUSD","FDUSD"].includes(L.asset)?w+parseFloat(L.free)+parseFloat(L.locked||0):w,0);return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Brokers Conectados"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[d.filter(v=>v.connected).length," conectados de ",d.length]})]}),e.jsxs("button",{onClick:()=>i(!l),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(Ne,{size:16})," Agregar Broker"]})]}),e.jsx("div",{className:"rounded-xl p-4 flex items-start gap-3",style:{background:"var(--gold-dark)",opacity:.08,position:"absolute"}}),e.jsxs("div",{className:"rounded-xl p-4 flex items-start gap-3",style:{background:"rgba(59,130,246,0.05)",border:"1px solid rgba(59,130,246,0.15)"},children:[e.jsx(ce,{size:20,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"Tus API Keys est√°n seguras"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:["Las claves se almacenan encriptadas localmente. Kairos Trade solo necesita permisos de lectura y trading.",e.jsx("strong",{className:"text-[var(--text)]",children:" Nunca actives permisos de retiro."})]})]})]}),e.jsx(W,{children:l&&e.jsx(I.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Nuevo Broker"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(se).map(v=>e.jsxs("button",{onClick:()=>x({...n,brokerId:v.id}),className:"p-3 rounded-xl text-center transition-all",style:{background:n.brokerId===v.id?"rgba(59,130,246,0.08)":"var(--surface-2)",border:`1px solid ${n.brokerId===v.id?"var(--gold)":"var(--border)"}`},children:[e.jsx("span",{className:"text-2xl",children:v.logo}),e.jsx("p",{className:"text-sm font-bold mt-1",children:v.name}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:v.supportedMarkets.join(", ")})]},v.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Etiqueta (opcional)"}),e.jsx("input",{value:n.label,onChange:v=>x({...n,label:v.target.value}),placeholder:"Mi cuenta Binance",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"API Key"}),e.jsx("input",{value:n.apiKey,onChange:v=>x({...n,apiKey:v.target.value}),placeholder:"Tu API Key",className:"w-full font-mono text-xs"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"API Secret"}),e.jsx("input",{type:p?"text":"password",value:n.apiSecret,onChange:v=>x({...n,apiSecret:v.target.value}),placeholder:"Tu API Secret",className:"w-full font-mono text-xs pr-10"}),e.jsx("button",{onClick:()=>g(!p),className:"absolute right-3 top-7 text-[var(--text-dim)]",children:p?e.jsx(Ge,{size:14}):e.jsx(Qe,{size:14})})]}),(($=se[n.brokerId])==null?void 0:$.requiredFields.includes("passphrase"))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Passphrase"}),e.jsx("input",{type:"password",value:n.passphrase,onChange:v=>x({...n,passphrase:v.target.value}),placeholder:"Passphrase",className:"w-full font-mono text-xs"})]})]}),f&&e.jsx("p",{className:"text-xs text-[var(--red)]",children:f}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:M,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm",children:"Guardar Broker"}),e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2.5 rounded-xl text-sm text-[var(--text-dim)]",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:"Cancelar"})]})]})})}),d.length===0?e.jsxs("div",{className:"rounded-xl p-12 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx($e,{size:48,className:"text-[var(--text-dim)]/20 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay brokers conectados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Agrega tu primer broker para empezar a operar"})]}):e.jsx("div",{className:"space-y-3",children:d.map(v=>{const C=se[v.brokerId],w=b[v.id]||[],L=T===v.id,ee=c(v.id);return e.jsxs(I.div,{layout:!0,className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer",onClick:()=>B(L?null:v.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:(C==null?void 0:C.logo)||"üìä"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:v.label}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[C==null?void 0:C.name," ‚Ä¢ API: ",atob(v.apiKey).slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[v.connected&&w.length>0&&e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Balance Total"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--gold)]",children:["$",ee.toFixed(2)," USD"]})]}),v.connected?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--green)] px-2 py-1 rounded-lg",style:{background:"rgba(0,220,130,0.1)"},children:[e.jsx(je,{size:12})," Conectado"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--text-dim)] px-2 py-1 rounded-lg",style:{background:"var(--surface-2)"},children:[e.jsx(Ct,{size:12})," Desconectado"]}),e.jsx("button",{onClick:K=>{K.stopPropagation(),P(v)},disabled:u===v.id,className:"px-3 py-1.5 rounded-lg text-xs font-bold transition-colors disabled:opacity-50",style:{background:"rgba(59,130,246,0.1)",color:"var(--gold)",border:"1px solid rgba(59,130,246,0.2)"},children:u===v.id?"...":v.connected?"Reconectar":"Conectar"}),e.jsx("button",{onClick:K=>{K.stopPropagation(),z(v.id)},className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(le,{size:14})})]})]}),e.jsx(W,{children:L&&v.connected&&e.jsx(I.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 space-y-4",style:{borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-xs font-bold uppercase tracking-wider text-[var(--text-dim)] flex items-center gap-2",children:[e.jsx(fe,{size:14,className:"text-[var(--gold)]"})," Balances en Tiempo Real"]}),e.jsxs("button",{onClick:()=>A(v),className:`text-xs text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors flex items-center gap-1 ${m[v.id]?"animate-spin":""}`,children:[e.jsx(Tt,{size:12})," Refrescar"]})]}),w.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:w.slice(0,12).map(K=>e.jsxs("div",{className:"rounded-lg p-2.5",style:{background:"var(--surface-2)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:K.asset}),parseFloat(K.locked||0)>0&&e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]",children:"üîí"})]}),e.jsx("p",{className:"text-sm font-bold mt-0.5",children:parseFloat(K.free).toFixed(K.asset==="BTC"?8:2)}),parseFloat(K.locked||0)>0&&e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Bloq: ",parseFloat(K.locked).toFixed(4)]})]},K.asset))}):e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:m[v.id]?"Cargando...":"Sin balances disponibles"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>D(v),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"var(--text-secondary)"},children:[e.jsx(At,{size:12})," Ver √öltimos Trades"]})}),S[v.id]&&S[v.id].length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold uppercase tracking-wider text-[var(--text-dim)] mb-2",children:"√öltimos Trades"}),e.jsx("div",{className:"space-y-1",children:S[v.id].slice(0,5).map((K,E)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-2 rounded-lg text-xs",style:{background:"var(--surface-2)"},children:[e.jsx("span",{className:`font-bold ${K.isBuyer?"text-[var(--green)]":"text-[var(--red)]"}`,children:K.isBuyer?"COMPRA":"VENTA"}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:parseFloat(K.qty).toFixed(6)}),e.jsxs("span",{className:"font-mono",children:["$",parseFloat(K.price).toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:new Date(K.time).toLocaleTimeString()})]},E))})]})]})})})]},v.id)})})]})}const bs=`Eres Kairos AI, el asistente de trading m√°s avanzado del mundo.
Eres parte de Kairos Trade, la plataforma de trading automatizado de Kairos 777 Inc.

Tu especialidad:
- An√°lisis t√©cnico (EMA, RSI, MACD, Bollinger Bands, VWAP, estructura de mercado)
- Generaci√≥n de estrategias de trading autom√°ticas
- An√°lisis de sentimiento del mercado
- Gesti√≥n de riesgo
- Educaci√≥n en trading

Reglas:
- Responde en espa√±ol siempre
- S√© directo, conciso y profesional
- Cuando generes estrategias, usa formato JSON estructurado
- Nunca des consejos financieros personales ‚Äî eres una herramienta de an√°lisis
- Si te piden una estrategia, incluye SIEMPRE: entry, exit, stopLoss, takeProfit, timeframe
- Usa datos t√©cnicos reales cuando los tengas disponibles

Cuando generes una estrategia, responde con un bloque JSON as√≠:
\`\`\`strategy
{
  "name": "Nombre de la estrategia",
  "pair": "BTCUSDT",
  "timeframe": "1h",
  "entry": { "condition": "EMA 20 cruza por encima de EMA 50", "indicator": "ema_cross", "params": { "fast": 20, "slow": 50 } },
  "exit": { "condition": "RSI > 70", "indicator": "rsi", "params": { "period": 14, "threshold": 70 } },
  "stopLoss": "1.5%",
  "takeProfit": "3%",
  "riskReward": "1:2"
}
\`\`\``;class fs{constructor(){this.apiKey=null,this.model="gpt-4o-mini",this.conversationHistory=[]}setApiKey(s){this.apiKey=s}async chat(s,t=null){var r;let a=s;if(t&&(a+=`

[Datos del mercado actual]
Par: ${t.symbol}
Precio: $${t.price}
Cambio 24h: ${t.changePercent}%
Volumen: ${t.volume}
M√°ximo 24h: $${t.high}
M√≠nimo 24h: $${t.low}`),this.conversationHistory.push({role:"user",content:a}),!this.apiKey)return this._localAnalysis(s,t);try{const l=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"system",content:bs},...this.conversationHistory.slice(-20)],temperature:.7,max_tokens:1e3})});if(!l.ok){const x=await l.json();throw new Error(((r=x.error)==null?void 0:r.message)||"API error")}const i=await l.json(),n=i.choices[0].message.content;return this.conversationHistory.push({role:"assistant",content:n}),{text:n,strategy:this._extractStrategy(n),usage:i.usage}}catch(l){return console.error("AI error:",l),this._localAnalysis(s,t)}}_localAnalysis(s,t){var l,i,n,x;const a=s.toLowerCase();if(a.includes("estrategia")||a.includes("strategy")){const p=(t==null?void 0:t.symbol)||"BTCUSDT",g={name:`Kairos Auto Strategy ‚Äî ${p}`,pair:p,timeframe:"1h",entry:{condition:"EMA 20 cruza por encima de EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70 o EMA 20 cruza por debajo de EMA 50",indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:"2%",takeProfit:"4%",riskReward:"1:2"},u=`üìä **Estrategia generada para ${p}**

**Entrada:** ${g.entry.condition}
**Salida:** ${g.exit.condition}
**Stop Loss:** ${g.stopLoss}
**Take Profit:** ${g.takeProfit}
**Risk/Reward:** ${g.riskReward}

Puedes activar esta estrategia desde el panel de bots.`;return this.conversationHistory.push({role:"assistant",content:u}),{text:u,strategy:g}}if(a.includes("analiz")||a.includes("mercado")||a.includes("market")||a.includes("c√≥mo ves")){let p="";if(t){const g=t.changePercent>0?"alcista":t.changePercent<-0?"bajista":"lateral",u=Math.abs(t.changePercent),o=u>3?"fuerte":u>1?"moderado":"d√©bil";p=`üìà **An√°lisis de ${t.symbol}**

**Precio:** $${(l=t.price)==null?void 0:l.toLocaleString()}
**Tendencia 24h:** ${g} (${t.changePercent>0?"+":""}${(i=t.changePercent)==null?void 0:i.toFixed(2)}%)
**Momentum:** ${o}
**Rango 24h:** $${(n=t.low)==null?void 0:n.toLocaleString()} ‚Äî $${(x=t.high)==null?void 0:x.toLocaleString()}
**Volumen:** $${(t.quoteVolume/1e6).toFixed(1)}M

`+(t.changePercent>2?`‚ö° El mercado muestra fuerza compradora. Considerar compras en retrocesos.
`:t.changePercent<-2?`‚ö†Ô∏è Presi√≥n vendedora activa. Esperar confirmaci√≥n de soporte.
`:`üìä Mercado en consolidaci√≥n. Esperar ruptura para tomar posici√≥n.
`)+`
üí° Recomendaci√≥n: ${g==="alcista"?"Buscar entradas en pullbacks al EMA 20.":g==="bajista"?"Precauci√≥n. Esperar divergencia RSI para posible reversal.":"Operar rango ‚Äî comprar soporte, vender resistencia."}`}else p="üìä Necesito datos del mercado para analizar. Selecciona un par de trading primero.";return this.conversationHistory.push({role:"assistant",content:p}),{text:p,strategy:null}}const r=`ü§ñ Soy **Kairos AI**, tu asistente de trading.

Puedo ayudarte con:
‚Ä¢ **"Analiza BTC"** ‚Äî An√°lisis t√©cnico del mercado
‚Ä¢ **"Dame una estrategia para ETHUSDT"** ‚Äî Generar estrategia autom√°tica
‚Ä¢ **"¬øC√≥mo ves el mercado?"** ‚Äî Visi√≥n general
‚Ä¢ **"Configura un bot"** ‚Äî Ayuda con automatizaci√≥n

¬øEn qu√© te puedo ayudar?`;return this.conversationHistory.push({role:"assistant",content:r}),{text:r,strategy:null}}_extractStrategy(s){const t=s.match(/```strategy\n([\s\S]*?)```/);if(t)try{return JSON.parse(t[1])}catch{return null}return null}clearHistory(){this.conversationHistory=[]}}const rt=new fs;function Ke(){const{aiMessages:d,addAiMessage:s,aiLoading:t,setAiLoading:a,clearAiMessages:r,currentPrice:l,selectedPair:i,priceChange24h:n}=V(),[x,p]=N.useState(""),g=N.useRef(null);N.useEffect(()=>{var h;(h=g.current)==null||h.scrollIntoView({behavior:"smooth"})},[d]);const u=async()=>{if(!x.trim()||t)return;const h={role:"user",content:x.trim(),time:new Date().toLocaleTimeString()};s(h),p(""),a(!0);try{const b=l?{symbol:i,price:l,changePercent:n,high:l*1.02,low:l*.98,volume:0,quoteVolume:0}:null,y=await rt.chat(x.trim(),b);s({role:"assistant",content:y.text,strategy:y.strategy,time:new Date().toLocaleTimeString()})}catch(b){s({role:"assistant",content:`‚ùå Error: ${b.message}`,time:new Date().toLocaleTimeString()})}a(!1)},o=[{label:"Analiza el mercado",icon:re,prompt:`Analiza ${i} ahora mismo`},{label:"Dame una estrategia",icon:X,prompt:`Dame una estrategia de trading para ${i}`},{label:"¬øC√≥mo ves BTC?",icon:ne,prompt:"¬øC√≥mo ves Bitcoin hoy?"}],f=(h,b)=>{const y=h.role==="user";return e.jsx(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${y?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl p-3 ${y?"bg-[var(--gold)] text-white rounded-br-md":"bg-[var(--dark-3)] text-[var(--text)] rounded-bl-md"}`,children:[!y&&e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(de,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:h.content.split(`
`).map((m,j)=>m.startsWith("**")&&m.endsWith("**")?e.jsx("p",{className:"font-bold my-0.5",children:m.replace(/\*\*/g,"")},j):m.startsWith("‚Ä¢")||m.startsWith("-")?e.jsx("p",{className:"ml-2",children:m},j):e.jsx("p",{children:m},j))}),h.strategy&&e.jsxs("div",{className:"mt-2 p-2 bg-[var(--dark-4)] rounded-xl border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(X,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Estrategia Lista"})]}),e.jsx("p",{className:"text-xs",children:h.strategy.name||"Auto Strategy"}),e.jsx("button",{onClick:()=>{V.getState().addStrategy(h.strategy),s({role:"assistant",content:"‚úÖ Estrategia guardada. Puedes activarla desde el panel de Bots.",time:new Date().toLocaleTimeString()})},className:"mt-1 px-3 py-1 bg-[var(--gold)] text-white text-xs font-bold rounded-lg",children:"Activar Estrategia"})]}),e.jsx("p",{className:`text-[10px] mt-1 ${y?"text-white/60":"text-[var(--text-dim)]"}`,children:h.time})]})},b)};return e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)]/20 flex items-center justify-center",children:e.jsx(de,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold",children:"Kairos AI"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Asistente de trading inteligente"})]})]}),e.jsx("button",{onClick:r,className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(le,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[d.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(de,{size:48,className:"text-[var(--gold)] mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Kairos AI"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-6 max-w-xs",children:"Tu asistente de trading con inteligencia artificial. Preg√∫ntame cualquier cosa sobre el mercado."}),e.jsx("div",{className:"space-y-2 w-full max-w-xs",children:o.map((h,b)=>{const y=h.icon;return e.jsxs("button",{onClick:()=>{p(h.prompt)},className:"w-full flex items-center gap-2 p-3 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl text-sm hover:border-[var(--gold)]/30 transition-colors text-left",children:[e.jsx(y,{size:16,className:"text-[var(--gold)] shrink-0"}),h.label]},b)})})]}),d.map(f),t&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-2xl rounded-bl-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"300ms"}})]})]})}),e.jsx("div",{ref:g})]}),e.jsx("div",{className:"p-3 border-t border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:x,onChange:h=>p(h.target.value),onKeyDown:h=>h.key==="Enter"&&u(),placeholder:"Pregunta sobre el mercado, pide estrategias...",className:"flex-1 text-sm"}),e.jsx("button",{onClick:u,disabled:!x.trim()||t,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:e.jsx($t,{size:16})})]})})]})}const ys=[{name:"EMA Cross Classic",description:"Cruces de EMA r√°pida/lenta ‚Äî Tendencia",entry:{condition:"EMA 20 cruza por encima de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},exit:{condition:"EMA 20 cruza por debajo de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},stopLoss:"2",takeProfit:"4"},{name:"RSI Reversal",description:"Compra en sobreventa, vende en sobrecompra",entry:{condition:"RSI < 30 (sobreventa)",indicator:"rsi",params:{period:14,oversold:30}},exit:{condition:"RSI > 70 (sobrecompra)",indicator:"rsi",params:{period:14,overbought:70}},stopLoss:"1.5",takeProfit:"3"},{name:"MACD Momentum",description:"Cruce de l√≠nea MACD y se√±al",entry:{condition:"MACD cruza por encima de se√±al",indicator:"macd_cross",params:{fast:12,slow:26,signal:9}},exit:{condition:"MACD cruza por debajo de se√±al",indicator:"macd_cross",params:{}},stopLoss:"2",takeProfit:"4"},{name:"EMA + RSI Combo",description:"M√°s preciso: cruces de EMA confirmados con RSI",entry:{condition:"EMA 20 > EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"}];function js(){const{strategies:d,addStrategy:s,removeStrategy:t,setPage:a}=V(),[r,l]=N.useState(!1),[i,n]=N.useState(null),[x,p]=N.useState("custom"),g=d.filter(h=>h.type==="custom_script"),u=d.filter(h=>h.type!=="custom_script"),o=h=>{s({...h,pair:"BTCUSDT",timeframe:"1h"})},f=h=>{n(h),l(!0)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Estrategias de Trading"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Crea estrategias con c√≥digo o usa plantillas predefinidas"})]}),e.jsxs("button",{onClick:()=>{n(null),l(!0)},className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(J,{size:16})," Crear con C√≥digo"]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>p("custom"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${x==="custom"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(J,{size:14})," Custom Scripts (",g.length,")"]}),e.jsxs("button",{onClick:()=>p("preset"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${x==="preset"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(X,{size:14})," Predefinidas (",u.length,")"]})]}),x==="custom"&&e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl p-6 text-center",style:{background:"linear-gradient(135deg, rgba(168,85,247,0.08) 0%, rgba(59,130,246,0.08) 100%)",border:"1px solid rgba(168,85,247,0.15)"},children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-3",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(J,{size:24,className:"text-[#A855F7]"})}),e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Kairos Script"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4 max-w-md mx-auto",children:"Escribe tu propia estrategia con c√≥digo simple, o p√≠dele a ChatGPT que la genere por ti. M√°s f√°cil que Pine Script, m√°s potente que MQL."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>{n(null),l(!0)},className:"flex items-center gap-2 px-5 py-2.5 btn-gold rounded-xl text-sm font-bold",children:[e.jsx(J,{size:14})," Crear Estrategia"]}),e.jsxs("button",{onClick:()=>{var b;(b=navigator.clipboard)==null||b.writeText("Crea una estrategia de trading que use EMA, RSI y MACD para detectar entradas de alta probabilidad")},className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold transition-colors",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(Te,{size:14})," Copiar Prompt para ChatGPT"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{step:"1",title:"Pide a ChatGPT",desc:"Dile qu√© estrategia quieres con nuestro prompt optimizado",color:"#A855F7"},{step:"2",title:"Pega el C√≥digo",desc:"Copia el c√≥digo que te gener√≥ y p√©galo en el editor",color:"#3B82F6"},{step:"3",title:"Activa el Bot",desc:"Testea con backtest y as√≠gnala a un Script Bot",color:"#00DC82"}].map(({step:h,title:b,desc:y,color:m})=>e.jsxs("div",{className:"rounded-xl p-4 flex gap-3",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shrink-0 text-sm font-black",style:{background:`${m}15`,color:m,border:`1px solid ${m}25`},children:h}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold mb-0.5",children:b}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:y})]})]},h))}),g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Mis Scripts (",g.length,")"]}),g.map(h=>{var b;return e.jsxs(I.div,{layout:!0,className:"rounded-xl p-4 flex items-center justify-between",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(J,{size:18,className:"text-[#A855F7]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:h.name}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[((b=h.code)==null?void 0:b.split(`
`).filter(y=>y.trim()&&!y.trim().startsWith("//")).length)||0," l√≠neas de l√≥gica"," ‚Ä¢ ","Creada: ",new Date(h.createdAt).toLocaleDateString("es")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f(h),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(Ze,{size:12})," Editar"]}),e.jsxs("button",{onClick:()=>a("bots"),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/10 text-[var(--green)] rounded-lg text-xs font-bold border border-[var(--green)]/20",children:[e.jsx(ie,{size:12})," Usar en Bot"]}),e.jsx("button",{onClick:()=>t(h.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(le,{size:14})})]})]},h.id)})]}):e.jsxs("div",{className:"rounded-xl p-8 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(J,{size:32,className:"text-[var(--text-dim)]/20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No tienes scripts custom a√∫n"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primera estrategia personalizada"})]})]}),x==="preset"&&e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ys.map((h,b)=>e.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:b*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{size:16,className:"text-[var(--gold)]"}),e.jsx("h3",{className:"text-sm font-bold",children:h.name})]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:h.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--green)]",children:"‚ñ≤"})," ",h.entry.condition]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--red)]",children:"‚ñº"})," ",h.exit.condition]}),e.jsxs("p",{className:"text-[var(--text-dim)]",children:["SL: ",h.stopLoss,"% | TP: ",h.takeProfit,"%"]})]}),e.jsx("button",{onClick:()=>o(h),className:"w-full py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:"Usar Plantilla"})]},h.name))}),u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Guardadas (",u.length,")"]}),u.map(h=>{var b;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:h.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[(b=h.entry)==null?void 0:b.condition," | SL: ",h.stopLoss,"% | TP: ",h.takeProfit,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a("bots"),className:"px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold",children:[e.jsx(ie,{size:12,className:"inline mr-1"})," Usar en Bot"]}),e.jsx("button",{onClick:()=>t(h.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)]",children:e.jsx(le,{size:14})})]})]},h.id)})]})]}),e.jsx(W,{children:r&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{l(!1),n(null)},children:e.jsx(I.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:h=>h.stopPropagation(),children:e.jsx(at,{initialCode:i==null?void 0:i.code,initialName:i==null?void 0:i.name,editMode:!!i,onClose:()=>{l(!1),n(null)},onSave:h=>{s(h),l(!1),n(null)}})})})})]})}function Ns(){const{tradeHistory:d,positions:s}=V(),[t,a]=N.useState("open"),r=d.reduce((n,x)=>n+(x.pnl||0),0),l=d.filter(n=>(n.pnl||0)>0).length,i=d.length>0?l/d.length*100:0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Historial de Trading"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[d.length," trades cerrados ‚Ä¢ ",s.length," posiciones abiertas"]})]}),e.jsxs("button",{onClick:()=>{const n=[["Par","Lado","Entrada","Salida","Cantidad","P&L","Fecha Apertura","Fecha Cierre"]];d.forEach(o=>{var f,h;n.push([o.symbol,o.side,(f=o.entryPrice)==null?void 0:f.toFixed(2),((h=o.exitPrice)==null?void 0:h.toFixed(2))||"",o.quantity,(o.pnl||0).toFixed(2),o.openedAt||"",o.closedAt||""])});const x=n.map(o=>o.join(",")).join(`
`),p=new Blob([x],{type:"text/csv"}),g=URL.createObjectURL(p),u=document.createElement("a");u.href=g,u.download=`kairos-trades-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(g)},className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all border border-[var(--border)]",children:[e.jsx(Ft,{size:14})," Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-bold",children:d.length})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L Total"}),e.jsxs("p",{className:`text-lg font-bold ${r>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[r>=0?"+":"","$",r.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[i.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Posiciones Abiertas"}),e.jsx("p",{className:"text-lg font-bold text-[var(--blue)]",children:s.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>a("open"),className:`px-4 py-1.5 text-sm rounded-md ${t==="open"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Abiertas (",s.length,")"]}),e.jsxs("button",{onClick:()=>a("closed"),className:`px-4 py-1.5 text-sm rounded-md ${t==="closed"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Cerradas (",d.length,")"]})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-[var(--text-dim)] text-xs",children:[e.jsx("th",{className:"text-left p-3",children:"Par"}),e.jsx("th",{className:"text-left p-3",children:"Lado"}),e.jsx("th",{className:"text-right p-3",children:"Entrada"}),e.jsx("th",{className:"text-right p-3",children:"Cantidad"}),e.jsx("th",{className:"text-right p-3",children:"P&L"}),e.jsx("th",{className:"text-right p-3",children:"Fecha"})]})}),e.jsx("tbody",{children:(t==="open"?s:d).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-[var(--text-dim)]",children:t==="open"?"Sin posiciones abiertas":"Sin trades cerrados"})}):(t==="open"?s:d).map((n,x)=>{var p,g;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--dark-3)] transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:n.symbol}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold
                    ${n.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:(p=n.side)==null?void 0:p.toUpperCase()})}),e.jsxs("td",{className:"p-3 text-right font-mono",children:["$",(g=n.entryPrice)==null?void 0:g.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right font-mono",children:n.quantity}),e.jsxs("td",{className:`p-3 text-right font-mono font-bold ${(n.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(n.pnl||0)>=0?"+":"","$",(n.pnl||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-right text-xs text-[var(--text-dim)]",children:new Date(n.openedAt||n.closedAt).toLocaleDateString()})]},n.id||x)})})]})})]})}const Ve="kairos_trade_simulator";class ws{constructor(){this.state=this._load()}_load(){try{const s=JSON.parse(localStorage.getItem(Ve));if(s)return s}catch{}return this._defaultState()}_defaultState(){return{balance:1e4,initialBalance:1e4,positions:[],closedTrades:[],orders:[],equity:1e4,stats:{totalTrades:0,wins:0,losses:0,totalPnl:0,bestTrade:0,worstTrade:0,avgWin:0,avgLoss:0,maxDrawdown:0,sharpeRatio:0},equityHistory:[{time:Date.now(),value:1e4}],createdAt:new Date().toISOString()}}_save(){localStorage.setItem(Ve,JSON.stringify(this.state))}reset(s=1e4){return this.state=this._defaultState(),this.state.balance=s,this.state.initialBalance=s,this.state.equity=s,this.state.equityHistory=[{time:Date.now(),value:s}],this._save(),this.state}async openPosition(s,t,a,r={}){const l=await H.getPrice(s),i=l*a;if(i>this.state.balance)throw new Error(`Fondos insuficientes. Necesitas $${i.toFixed(2)}, tienes $${this.state.balance.toFixed(2)}`);const n={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),symbol:s,side:t,quantity:a,entryPrice:l,currentPrice:l,cost:i,pnl:0,pnlPercent:0,stopLoss:r.stopLoss||null,takeProfit:r.takeProfit||null,leverage:r.leverage||1,openedAt:new Date().toISOString()};return this.state.balance-=i,this.state.positions.push(n),this._save(),{success:!0,position:n,message:`${t.toUpperCase()} ${a} ${s} @ $${l.toFixed(2)}`}}async closePosition(s){const t=this.state.positions.findIndex(x=>x.id===s);if(t===-1)throw new Error("Posici√≥n no encontrada");const a=this.state.positions[t],r=await H.getPrice(a.symbol),l=a.side==="buy"?(r-a.entryPrice)*a.quantity*a.leverage:(a.entryPrice-r)*a.quantity*a.leverage,i=l/a.cost*100,n={...a,exitPrice:r,pnl:l,pnlPercent:i,closedAt:new Date().toISOString(),duration:Date.now()-new Date(a.openedAt).getTime()};return this.state.balance+=a.cost+l,this.state.positions.splice(t,1),this.state.closedTrades.push(n),this._updateStats(l),this._save(),{success:!0,trade:n,message:`Cerrada: ${l>=0?"+":""}$${l.toFixed(2)} (${i.toFixed(1)}%)`}}async placeLimitOrder(s,t,a,r,l={}){const i=await H.getPrice(s),n={id:Date.now().toString(36),symbol:s,side:t,quantity:a,targetPrice:r,currentPrice:i,type:"limit",stopLoss:l.stopLoss||null,takeProfit:l.takeProfit||null,status:"pending",createdAt:new Date().toISOString()};return this.state.orders.push(n),this._save(),{success:!0,order:n}}cancelOrder(s){return this.state.orders=this.state.orders.filter(t=>t.id!==s),this._save(),{success:!0}}async updatePositions(){let s=this.state.balance;for(const t of this.state.positions)try{const a=await H.getPrice(t.symbol);if(t.currentPrice=a,t.pnl=t.side==="buy"?(a-t.entryPrice)*t.quantity*(t.leverage||1):(t.entryPrice-a)*t.quantity*(t.leverage||1),t.pnlPercent=t.pnl/t.cost*100,s+=t.cost+t.pnl,t.stopLoss&&(t.side==="buy"?a<=t.stopLoss:a>=t.stopLoss)){await this.closePosition(t.id);continue}if(t.takeProfit&&(t.side==="buy"?a>=t.takeProfit:a<=t.takeProfit)){await this.closePosition(t.id);continue}}catch{}for(const t of this.state.orders.filter(a=>a.status==="pending"))try{const a=await H.getPrice(t.symbol);(t.side==="buy"?a<=t.targetPrice:a>=t.targetPrice)&&(t.status="filled",await this.openPosition(t.symbol,t.side,t.quantity,{stopLoss:t.stopLoss,takeProfit:t.takeProfit}))}catch{}return this.state.orders=this.state.orders.filter(t=>t.status==="pending"),this.state.equity=s,this.state.equityHistory.push({time:Date.now(),value:s}),this.state.equityHistory.length>500&&(this.state.equityHistory=this.state.equityHistory.slice(-500)),this._save(),this.state}_updateStats(s){const t=this.state.stats;t.totalTrades++,t.totalPnl+=s,s>0?(t.wins++,t.bestTrade=Math.max(t.bestTrade,s)):(t.losses++,t.worstTrade=Math.min(t.worstTrade,s)),t.avgWin=t.wins>0?t.totalPnl/t.wins:0,t.avgLoss=t.losses>0?(t.totalPnl-t.avgWin*t.wins)/t.losses:0;const a=Math.max(...this.state.equityHistory.map(i=>i.value));t.maxDrawdown=(a-this.state.equity)/a*100,t.winRate=t.totalTrades>0?t.wins/t.totalTrades*100:0;const r=this.state.closedTrades.filter(i=>i.pnl>0).reduce((i,n)=>i+n.pnl,0),l=Math.abs(this.state.closedTrades.filter(i=>i.pnl<0).reduce((i,n)=>i+n.pnl,0));t.profitFactor=l>0?r/l:r>0?1/0:0}getState(){return this.state}getPerformance(){const s=this.state,t=(s.equity-s.initialBalance)/s.initialBalance*100;return{balance:s.balance,equity:s.equity,initialBalance:s.initialBalance,returnPct:t,openPositions:s.positions.length,pendingOrders:s.orders.length,...s.stats}}}const Q=new ws;function Ss({data:d,height:s=140}){const t=N.useRef(null);return N.useEffect(()=>{const a=t.current;if(!a||!d||d.length<2)return;const r=a.getContext("2d"),l=window.devicePixelRatio||1,i=a.clientWidth,n=a.clientHeight;a.width=i*l,a.height=n*l,r.scale(l,l),r.clearRect(0,0,i,n);const x=d.map(A=>A.value),p=Math.min(...x)*.998,g=Math.max(...x)*1.002,u=g-p||1,o={top:8,bottom:20,left:0,right:0},f=i-o.left-o.right,h=n-o.top-o.bottom,b=A=>o.left+A/(d.length-1)*f,y=A=>o.top+h-(A-p)/u*h,m=x[0],j=x[x.length-1],T=j>=m,B=T?"#00DC82":"#FF3B30";r.beginPath(),r.moveTo(b(0),y(x[0]));for(let A=1;A<x.length;A++)r.lineTo(b(A),y(x[A]));r.lineTo(b(x.length-1),n-o.bottom),r.lineTo(b(0),n-o.bottom),r.closePath();const S=r.createLinearGradient(0,0,0,n);S.addColorStop(0,T?"rgba(0,220,130,0.2)":"rgba(255,59,48,0.2)"),S.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=S,r.fill(),r.beginPath(),r.moveTo(b(0),y(x[0]));for(let A=1;A<x.length;A++)r.lineTo(b(A),y(x[A]));r.strokeStyle=B,r.lineWidth=2,r.lineJoin="round",r.stroke(),r.beginPath(),r.setLineDash([3,3]);const k=y(m);r.moveTo(0,k),r.lineTo(i,k),r.strokeStyle="#3B82F640",r.lineWidth=1,r.stroke(),r.setLineDash([]),r.fillStyle="#666",r.font="9px Inter, sans-serif",r.textAlign="left",r.fillText(`$${p.toFixed(0)}`,4,n-o.bottom+12),r.textAlign="right",r.fillText(`$${g.toFixed(0)}`,i-4,n-o.bottom+12);const M=b(x.length-1),P=y(j);r.beginPath(),r.arc(M,P,3,0,Math.PI*2),r.fillStyle=B,r.fill(),r.beginPath(),r.arc(M,P,6,0,Math.PI*2),r.strokeStyle=B,r.lineWidth=1,r.globalAlpha=.4,r.stroke(),r.globalAlpha=1},[d,s]),!d||d.length<2?e.jsx("div",{className:"flex items-center justify-center text-xs text-[var(--text-dim)]",style:{height:s},children:"Ejecuta trades para ver la curva de equity"}):e.jsx("canvas",{ref:t,style:{width:"100%",height:s}})}function ks(){var j,T,B,S;const{selectedPair:d,currentPrice:s,setPage:t}=V(),[a,r]=N.useState(Q.getState()),[l,i]=N.useState(Q.getPerformance()),[n,x]=N.useState({quantity:"",stopLoss:"",takeProfit:"",side:"buy"}),[p,g]=N.useState(!1),[u,o]=N.useState(null);N.useEffect(()=>{const k=setInterval(async()=>{const M=await Q.updatePositions();r({...M}),i(Q.getPerformance())},1e4);return()=>clearInterval(k)},[]);const f=N.useCallback(async()=>{const k=await Q.updatePositions();r({...k}),i(Q.getPerformance())},[]),h=async()=>{if(!(!n.quantity||!s)){g(!0);try{const k=await Q.openPosition(d,n.side,parseFloat(n.quantity),{stopLoss:n.stopLoss?parseFloat(n.stopLoss):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit):null});o({type:"success",text:k.message}),x({...n,quantity:"",stopLoss:"",takeProfit:""}),await f()}catch(k){o({type:"error",text:k.message})}g(!1),setTimeout(()=>o(null),3e3)}},b=async k=>{try{const M=await Q.closePosition(k);o({type:M.trade.pnl>=0?"success":"error",text:M.message}),await f()}catch(M){o({type:"error",text:M.message})}setTimeout(()=>o(null),3e3)},y=()=>{Q.reset(1e4),r(Q.getState()),i(Q.getPerformance()),o({type:"success",text:"Simulador reiniciado con $10,000"}),setTimeout(()=>o(null),2e3)},m=l.returnPct||0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ie,{size:20,className:"text-[var(--gold)]"}),"Paper Trading Simulator"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Practica con datos reales, sin arriesgar dinero real"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:"Actualizar"}),e.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--red)]/20 text-[var(--red)] rounded-lg text-xs font-bold hover:bg-[var(--red)]/30 transition-colors",children:[e.jsx(Je,{size:12})," Reiniciar"]})]})]}),e.jsx(W,{children:u&&e.jsx(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-3 rounded-xl text-sm font-bold text-center ${u.type==="success"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:u.text})}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Balance",value:`$${(j=l.balance)==null?void 0:j.toFixed(2)}`,icon:ue,color:"var(--gold)"},{label:"Equity",value:`$${(T=l.equity)==null?void 0:T.toFixed(2)}`,icon:re,color:"var(--blue)"},{label:"Retorno",value:`${m>=0?"+":""}${m.toFixed(2)}%`,icon:m>=0?ae:me,color:m>=0?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${(l.winRate||0).toFixed(0)}%`,icon:Et,color:"var(--gold)"},{label:"Trades",value:l.totalTrades||0,icon:ye,color:"var(--text)"}].map((k,M)=>{const P=k.icon;return e.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:M*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx(P,{size:16,style:{color:k.color},className:"mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold font-mono",style:{color:k.color},children:k.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:k.label})]},k.label)})}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"P&L Total",value:`${l.totalPnl>=0?"+":""}$${(l.totalPnl||0).toFixed(2)}`,color:(l.totalPnl||0)>=0?"var(--green)":"var(--red)"},{label:"Mejor Trade",value:`+$${(l.bestTrade||0).toFixed(2)}`,color:"var(--green)"},{label:"Peor Trade",value:`$${(l.worstTrade||0).toFixed(2)}`,color:"var(--red)"},{label:"Max Drawdown",value:`${(l.maxDrawdown||0).toFixed(1)}%`,color:"var(--red)"}].map(k=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:k.label}),e.jsx("p",{className:"text-sm font-bold font-mono",style:{color:k.color},children:k.value})]},k.label))}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(ae,{size:14,className:"text-[var(--gold)]"})," Curva de Equity"]}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[((B=a.equityHistory)==null?void 0:B.length)||0," puntos"]})]}),e.jsx("div",{className:"p-2",children:e.jsx(Ss,{data:a.equityHistory,height:160})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Abrir Posici√≥n (Demo)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--gold)]",children:d}),e.jsxs("span",{className:"text-sm font-mono",children:["$",(s==null?void 0:s.toLocaleString(void 0,{maximumFractionDigits:2}))||"---"]}),e.jsx("button",{onClick:()=>t("chart"),className:"text-xs text-[var(--gold)] hover:underline ml-auto",children:"Ver gr√°fico ‚Üí"})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x({...n,side:"buy"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="buy"?"bg-[var(--green)] text-white":"text-[var(--text-dim)]"}`,children:"COMPRAR"}),e.jsx("button",{onClick:()=>x({...n,side:"sell"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="sell"?"bg-[var(--red)] text-white":"text-[var(--text-dim)]"}`,children:"VENDER"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Cantidad"}),e.jsx("input",{type:"number",value:n.quantity,onChange:k=>x({...n,quantity:k.target.value}),placeholder:"Ej: 0.01",className:"w-full text-sm"}),n.quantity&&s&&e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] mt-1",children:["Costo: $",(parseFloat(n.quantity)*s).toFixed(2)," de $",(S=l.balance)==null?void 0:S.toFixed(2)," disponible"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(ce,{size:10})," Stop Loss"]}),e.jsx("input",{type:"number",value:n.stopLoss,onChange:k=>x({...n,stopLoss:k.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(ye,{size:10})," Take Profit"]}),e.jsx("input",{type:"number",value:n.takeProfit,onChange:k=>x({...n,takeProfit:k.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsx("button",{onClick:h,disabled:!n.quantity||!s||p,className:`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50 ${n.side==="buy"?"bg-[var(--green)] text-white":"bg-[var(--red)] text-white"}`,children:p?"Ejecutando...":`${n.side==="buy"?"Comprar":"Vender"} ${d.replace("USDT","")} (Demo)`})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold mb-3",children:["Posiciones Abiertas (",a.positions.length,")"]}),a.positions.length===0?e.jsx("p",{className:"text-sm text-[var(--text-dim)] text-center py-8",children:"Sin posiciones abiertas"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.positions.map(k=>{var M,P,A,D;return e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded ${k.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:k.side.toUpperCase()}),e.jsx("span",{className:"text-sm font-bold",children:k.symbol})]}),e.jsx("button",{onClick:()=>b(k.id),className:"px-2 py-0.5 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cerrar"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Entrada"}),e.jsxs("p",{className:"font-mono",children:["$",(M=k.entryPrice)==null?void 0:M.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Actual"}),e.jsxs("p",{className:"font-mono",children:["$",(P=k.currentPrice)==null?void 0:P.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`font-mono font-bold ${k.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[k.pnl>=0?"+":"","$",(A=k.pnl)==null?void 0:A.toFixed(2)," (",(D=k.pnlPercent)==null?void 0:D.toFixed(1),"%)"]})]})]})]},k.id)})})]})]}),a.closedTrades.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-[var(--border)]",children:e.jsx("h3",{className:"text-sm font-bold",children:"Historial de Trades (Demo)"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left p-2",children:"Par"}),e.jsx("th",{className:"text-left p-2",children:"Lado"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"})]})}),e.jsx("tbody",{children:a.closedTrades.slice().reverse().map(k=>{var M,P,A;return e.jsxs("tr",{className:"border-b border-[var(--border)]/50 hover:bg-[var(--dark-3)]",children:[e.jsx("td",{className:"p-2 font-bold",children:k.symbol}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:k.side==="buy"?"text-[var(--green)]":"text-[var(--red)]",children:k.side.toUpperCase()})}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(M=k.entryPrice)==null?void 0:M.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(P=k.exitPrice)==null?void 0:P.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-mono font-bold ${k.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[k.pnl>=0?"+":"","$",(A=k.pnl)==null?void 0:A.toFixed(2)]})]},k.id)})})]})})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"‚ö†Ô∏è Esto es un simulador con datos reales del mercado. No se usa dinero real."}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Practica tus estrategias sin riesgo."})]})]})}function Ps(){var x;const{settings:d,updateSettings:s,user:t}=V(),[a,r]=N.useState(""),[l,i]=N.useState(!1),n=()=>{a.trim()&&(rt.setApiKey(a.trim()),s({openaiKey:a.trim()}),i(!0),setTimeout(()=>i(!1),2e3))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Ajustes"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Configuraci√≥n de tu plataforma"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-[var(--gold)]"})," Perfil"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Email:"})," ",t==null?void 0:t.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Nombre:"})," ",t==null?void 0:t.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Plan:"})," ",e.jsx("span",{className:"text-[var(--gold)]",children:(x=t==null?void 0:t.plan)==null?void 0:x.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Bt,{size:16,className:"text-[var(--gold)]"})," API Key de OpenAI"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-2",children:"Opcional. Sin API key, Kairos AI usa an√°lisis local integrado. Con API key, accedes a GPT-4 para an√°lisis avanzado."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:a,onChange:p=>r(p.target.value),placeholder:"sk-...",className:"flex-1 text-sm font-mono"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl text-sm font-bold",children:l?"‚úì Guardado":"Guardar"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(It,{size:16,className:"text-[var(--gold)]"})," Trading por Defecto"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo m√°x. por trade (%)"}),e.jsx("input",{type:"number",value:d.maxRiskPerTrade,onChange:p=>s({maxRiskPerTrade:parseFloat(p.target.value)}),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Apalancamiento predeterminado"}),e.jsx("input",{type:"number",value:d.defaultLeverage,onChange:p=>s({defaultLeverage:parseFloat(p.target.value)}),className:"w-full text-sm"})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-[var(--gold)]"})," Notificaciones"]}),e.jsx("div",{className:"space-y-3",children:[{key:"notifications",label:"Notificaciones",desc:"Alertas de trades y se√±ales"},{key:"soundAlerts",label:"Sonido",desc:"Alertas sonoras al ejecutar trades"}].map(p=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:p.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:p.desc})]}),e.jsx("button",{onClick:()=>s({[p.key]:!d[p.key]}),className:`w-12 h-6 rounded-full transition-colors relative
                  ${d[p.key]?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform
                    ${d[p.key]?"left-6":"left-0.5"}`})})]},p.key))})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-[var(--gold)]"})," Kairos Wallet"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:"Conecta tu Kairos Wallet para usar KAIROS Coin como m√©todo de pago y recibir recompensas."}),e.jsxs("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--gold)]/20 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(fe,{size:14})," Abrir Kairos Wallet"]})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"Kairos Trade v1.0.0 ‚Ä¢ Kairos 777 Inc"}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Powered by Kairos AI"})]})]})}const He="kairos_trade_alerts";class Cs{constructor(){this.alerts=this._load(),this.triggered=[],this.monitoring=!1,this.interval=null,this.callbacks=new Set}_load(){try{return JSON.parse(localStorage.getItem(He))||[]}catch{return[]}}_save(){localStorage.setItem(He,JSON.stringify(this.alerts))}subscribe(s){return this.callbacks.add(s),()=>this.callbacks.delete(s)}_notify(s){this.callbacks.forEach(t=>t(s)),Notification.permission==="granted"&&new Notification(`Kairos Trade ‚Äî ${s.symbol}`,{body:s.message,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%23D4AF37"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%230A0A0F" font-family="serif" font-weight="bold">K</text></svg>'})}async requestPermission(){Notification.permission!=="granted"&&await Notification.requestPermission()}addPriceAlert(s,t,a,r={}){const l={id:Date.now().toString(36),type:"price",symbol:s,condition:t,targetPrice:parseFloat(a),active:!0,repeat:r.repeat||!1,message:`${s} ${t==="above"?">":"<"} $${a}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}addSignalAlert(s,t,a={}){const r={ema_cross:`EMA ${a.fast||20}/${a.slow||50} Cross`,rsi_oversold:`RSI < ${a.threshold||30}`,rsi_overbought:`RSI > ${a.threshold||70}`,macd_cross:"MACD Signal Cross",volume_spike:`Volume Spike > ${a.multiplier||2}x avg`},l={id:Date.now().toString(36),type:"signal",symbol:s,signalType:t,params:a,active:!0,repeat:a.repeat||!1,message:`${s}: ${r[t]||t}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}removeAlert(s){this.alerts=this.alerts.filter(t=>t.id!==s),this._save()}getAlerts(){return this.alerts}getTriggered(){return this.triggered}_ensureMonitoring(){this.monitoring||(this.monitoring=!0,this.interval=setInterval(()=>this._check(),15e3),this._check())}stop(){this.monitoring=!1,this.interval&&clearInterval(this.interval)}async _check(){const s=this.alerts.filter(a=>a.active);if(s.length===0)return;const t={};s.forEach(a=>{t[a.symbol]||(t[a.symbol]=[]),t[a.symbol].push(a)});for(const[a,r]of Object.entries(t))try{const l=await H.getPrice(a);for(const i of r){let n=!1;i.type==="price"&&(i.condition==="above"&&l>=i.targetPrice&&(n=!0),i.condition==="below"&&l<=i.targetPrice&&(n=!0)),i.type==="signal"&&(n=await this._checkSignal(a,i)),n&&(i.triggeredAt=new Date().toISOString(),i.triggeredPrice=l,this.triggered.push({...i}),this._notify({...i,currentPrice:l,message:`üîî ${i.message} ‚Äî Precio actual: $${l.toLocaleString()}`}),i.repeat||(i.active=!1))}}catch{}this._save()}async _checkSignal(s,t){try{const a=await H.getCandles(s,"1h",60),r=a.map(i=>i.close),l=r.length;switch(t.signalType){case"ema_cross":{const i=Z(r,t.params.fast||20),n=Z(r,t.params.slow||50);return we(i,n,l-1)!==null}case"rsi_oversold":return oe(r,t.params.period||14)[l-1]<(t.params.threshold||30);case"rsi_overbought":return oe(r,t.params.period||14)[l-1]>(t.params.threshold||70);case"macd_cross":{const{macd:i,signal:n}=Ee(r);return we(i,n,l-1)!==null}case"volume_spike":{const i=a.map(x=>x.volume),n=i.slice(-20).reduce((x,p)=>x+p,0)/20;return i[l-1]>n*(t.params.multiplier||2)}default:return!1}}catch{return!1}}}const Y=new Cs,Ts=[{id:"ema_cross",label:"EMA Cruce",desc:"EMA 20/50 crossover",icon:Ce},{id:"rsi_oversold",label:"RSI Sobreventa",desc:"RSI < 30",icon:me},{id:"rsi_overbought",label:"RSI Sobrecompra",desc:"RSI > 70",icon:ae},{id:"macd_cross",label:"MACD Cruce",desc:"MACD/Signal crossover",icon:X},{id:"volume_spike",label:"Spike Volumen",desc:"Volumen > 2x promedio",icon:Xe}];function As(){const{selectedPair:d}=V(),[s,t]=N.useState([]),[a,r]=N.useState([]),[l,i]=N.useState("active"),[n,x]=N.useState({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1});N.useEffect(()=>{t(Y.getAlerts()),r(Y.getTriggered());const o=Y.subscribe(()=>{t([...Y.getAlerts()]),r([...Y.getTriggered()])});return Y.requestPermission(),o},[]);const p=()=>{if(n.type==="price"){if(!n.price)return;Y.addPriceAlert(d,n.condition,n.price,{repeat:n.repeat})}else Y.addSignalAlert(d,n.signalType,{repeat:n.repeat});t([...Y.getAlerts()]),x({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1}),i("active")},g=o=>{Y.removeAlert(o),t([...Y.getAlerts()])},u=s.filter(o=>o.active);return s.filter(o=>!o.active),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(I.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight flex items-center gap-2",children:[e.jsx(pe,{size:22,className:"text-[var(--gold)]"}),"Alertas"]}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:[u.length," alerta",u.length!==1?"s":""," activa",u.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>i("create"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold text-white transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:[e.jsx(Ne,{size:16}),"Nueva Alerta"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[{id:"active",label:`Activas (${u.length})`},{id:"triggered",label:`Disparadas (${a.length})`},{id:"create",label:"Crear"}].map(o=>e.jsx("button",{onClick:()=>i(o.id),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-200
              ${l===o.id?"text-white":"text-[var(--text-dim)]"}`,style:l===o.id?{background:"linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.08))",border:"1px solid rgba(59,130,246,0.15)"}:{},children:o.label},o.id))}),e.jsx(W,{children:l==="create"&&e.jsxs(I.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl p-5 space-y-4",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Crear Alerta para ",d]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x({...n,type:"price"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="price"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Precio"}),e.jsx("button",{onClick:()=>x({...n,type:"signal"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="signal"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Se√±al T√©cnica"})]}),n.type==="price"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2",children:["above","below"].map(o=>e.jsxs("button",{onClick:()=>x({...n,condition:o}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1.5
                        ${n.condition===o?o==="above"?"bg-[var(--green)]/10 text-[var(--green)] border border-[var(--green)]/15":"bg-[var(--red)]/10 text-[var(--red)] border border-[var(--red)]/15":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:[o==="above"?e.jsx(ae,{size:12}):e.jsx(me,{size:12}),o==="above"?"Sube a":"Baja a"]},o))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Precio objetivo (USD)"}),e.jsx("input",{type:"number",value:n.price,onChange:o=>x({...n,price:o.target.value}),placeholder:"Ej: 100000",className:"w-full",step:"any"})]})]}):e.jsx("div",{className:"space-y-2",children:Ts.map(o=>{const f=o.icon;return e.jsxs("button",{onClick:()=>x({...n,signalType:o.id}),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left
                        ${n.signalType===o.id?"bg-[var(--gold)]/10 border border-[var(--gold)]/15":"bg-[var(--dark-3)] border border-transparent hover:border-[var(--border)]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n.signalType===o.id?"bg-[var(--gold)]/15":"bg-[var(--dark-4)]"}`,children:e.jsx(f,{size:14,className:n.signalType===o.id?"text-[var(--gold)]":"text-[var(--text-dim)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:o.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:o.desc})]})]},o.id)})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("div",{className:`w-9 h-5 rounded-full transition-colors relative ${n.repeat?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,onClick:()=>x({...n,repeat:!n.repeat}),children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform ${n.repeat?"translate-x-4":"translate-x-0.5"}`})}),e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Repetir alerta"})]}),e.jsx("button",{onClick:p,disabled:n.type==="price"&&!n.price,className:"w-full py-3 text-white font-bold rounded-xl text-sm transition-all disabled:opacity-40",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:"Crear Alerta"})]})}),l==="active"&&e.jsx("div",{className:"space-y-2",children:u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas activas"}),e.jsx("button",{onClick:()=>i("create"),className:"text-xs text-[var(--gold)] mt-2 font-semibold",children:"Crear primera alerta ‚Üí"})]}):u.map((o,f)=>e.jsxs(I.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:f*.04},className:"flex items-center gap-3 p-3 rounded-xl group",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0",style:{background:o.type==="price"?"rgba(59,130,246,0.08)":"rgba(139,92,246,0.08)"},children:o.type==="price"?o.condition==="above"?e.jsx(ae,{size:16,className:"text-[var(--green)]"}):e.jsx(me,{size:16,className:"text-[var(--red)]"}):e.jsx(X,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:o.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:o.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.repeat&&e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] bg-[var(--gold)]/10 px-1.5 py-0.5 rounded",children:"‚Üª"}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("button",{onClick:()=>g(o.id),className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/[0.06] transition-all opacity-0 group-hover:opacity-100",children:e.jsx(le,{size:13})})]})]},o.id))}),l==="triggered"&&e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas disparadas"})]}):[...a].reverse().map((o,f)=>{var h;return e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(14,203,129,0.04), rgba(17,19,24,0.6))",border:"1px solid rgba(14,203,129,0.08)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--green)]/[0.08] flex items-center justify-center shrink-0",children:e.jsx(je,{size:16,className:"text-[var(--green)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:o.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:o.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono text-[var(--green)]",children:["$",(h=o.triggeredPrice)==null?void 0:h.toLocaleString()]}),e.jsx("p",{className:"text-[9px] text-[var(--text-dim)]",children:new Date(o.triggeredAt).toLocaleTimeString()})]})]},`${o.id}-${f}`)})})]})}function $s(){const[d,s]=N.useState("chart"),{selectedPair:t}=V();return e.jsxs("div",{className:"flex flex-1 overflow-hidden h-full",children:[e.jsxs("div",{className:"flex-1 h-full overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex gap-1 px-3 pt-2",style:{background:"var(--surface)"},children:[["chart","Chart"],["depth","Depth"]].map(([a,r])=>e.jsx("button",{onClick:()=>s(a),className:`px-3 py-1.5 text-xs font-bold rounded-t-lg transition-colors ${d===a?"text-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--text-secondary)]"}`,style:d===a?{background:"var(--dark)",borderTop:"2px solid var(--gold)"}:{},children:r},a))}),d==="chart"?e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(ts,{})}):e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(as,{pair:t||"BTCUSDT",height:500})})]}),e.jsx(rs,{})]})}function Fs(){const{isAuthenticated:d,currentPage:s,aiPanelOpen:t}=V();if(!d)return e.jsx(Xt,{});const a=()=>{switch(s){case"dashboard":return e.jsx(Oe,{});case"chart":return e.jsx($s,{});case"bots":return e.jsx(gs,{});case"simulator":return e.jsx(ks,{});case"brokers":return e.jsx(vs,{});case"ai":return e.jsx(Ke,{});case"strategies":return e.jsx(js,{});case"history":return e.jsx(Ns,{});case"alerts":return e.jsx(As,{});case"wallet":return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)]/15 flex items-center justify-center text-[var(--gold)] text-2xl font-bold mx-auto mb-4",children:"K"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Kairos Wallet"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Conecta tu Kairos Wallet para integrar tus balances de KAIROS Coin con la plataforma de trading."}),e.jsx("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-[var(--gold)] text-white font-semibold rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Abrir Kairos Wallet"})]})});case"settings":return e.jsx(Ps,{});default:return e.jsx(Oe,{})}};return e.jsxs("div",{className:"flex h-screen bg-[var(--dark)] overflow-hidden",children:[e.jsx(Dt,{position:"top-right",toastOptions:{style:{background:"#181A20",color:"#EAECEF",border:"1px solid #1E222D",fontSize:"13px"}}}),e.jsx(Qt,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Yt,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(W,{mode:"wait",children:e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"flex-1 flex flex-col overflow-hidden",children:a()},s)}),e.jsx(W,{children:t&&s!=="ai"&&e.jsx(I.div,{initial:{width:0,opacity:0},animate:{width:380,opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"border-l border-[var(--border)] overflow-hidden shrink-0",children:e.jsx(Ke,{})})})]})]})]})}Ht.createRoot(document.getElementById("root")).render(e.jsx(zt.StrictMode,{children:e.jsx(_t,{children:e.jsx(Fs,{})})}));
