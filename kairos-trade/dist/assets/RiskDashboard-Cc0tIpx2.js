import{a as S,j as e,S as T,a0 as H,A as K,N as G,s as V,aH as W,x as J,I as C,aI as Q}from"./ui-C9JhL7YV.js";import{u as X}from"./index-MgTkGNfr.js";import{t as F}from"./tradingEngine-BncutJ0b.js";import"./vendor-09nSF2_j.js";import"./indicators-DJQYQkcq.js";import"./marketData-K1zKCjjj.js";import"./broker-C2BN0UWn.js";import"./kairosScript-O85dqfEI.js";function Y({segments:i,size:n=120,strokeWidth:h=14}){const m=(n-h)/2,x=2*Math.PI*m;let y=0;return e.jsx("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,className:"transform -rotate-90",children:i.map((w,r)=>{const f=w.value/100*x,u=-y;return y+=f,e.jsx("circle",{cx:n/2,cy:n/2,r:m,fill:"none",stroke:w.color,strokeWidth:h,strokeDasharray:`${f} ${x-f}`,strokeDashoffset:u,strokeLinecap:"round"},r)})})}function M({value:i,max:n=100,label:h}){const m=Math.min(i/n*100,100),x=m<30?"#10B981":m<60?"#F59E0B":"#EF4444";return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:h}),e.jsxs("span",{style:{color:x},className:"font-bold",children:[i.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-1.5 bg-[var(--dark-4)] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${m}%`,background:x}})})]})}function ie(){const{bots:i,brokers:n,positions:h,tradeHistory:m,settings:x}=X(),[y,w]=S.useState(0);S.useEffect(()=>{const s=setInterval(()=>w(l=>l+1),1e4);return()=>clearInterval(s)},[]);const r=S.useMemo(()=>{const s=i.filter(a=>a.status==="active");n.filter(a=>a.connected);const l=h||[],c=m||[];let o=0;const d={},g={};l.forEach(a=>{const t=(a.quantity||0)*(a.currentPrice||a.entryPrice||0);o+=t;const k=a.pair||"Unknown";d[k]=(d[k]||0)+t;const v=a.botName||"Manual";g[v]=(g[v]||0)+t}),s.forEach(a=>{const t=F.getLiveData(a.id);if(t!=null&&t.position){const k=(t.position.quantity||0)*(t.price||t.position.entryPrice||0);if(!l.some(v=>v.botId===a.id)){o+=k;const v=a.pair||"Unknown";d[v]=(d[v]||0)+k}}});const P=i.reduce((a,t)=>a+(t.balance||0),0)||1e3;let R=0;s.forEach(a=>{const t=F.getLiveData(a.id);t!=null&&t.unrealizedPnl&&(R+=t.unrealizedPnl)});const j=c.slice(-100),U=j.filter(a=>(a.pnl||0)>0).length;j.filter(a=>(a.pnl||0)<0).length;const A=j.length>0?U/j.length*100:0;let b=0,E=0,D=0;c.forEach(a=>{D+=a.pnl||0,b=Math.max(b,D);const t=b>0?(b-D)/b*100:0;E=Math.max(E,t)});const N=[],B={};c.forEach(a=>{const t=new Date(a.closedAt||a.time).toLocaleDateString();B[t]=(B[t]||0)+(a.pnl||0)}),Object.values(B).forEach(a=>{N.push(a/Math.max(P,1))}),N.sort((a,t)=>a-t);const O=Math.floor(N.length*.05),q=N.length>5?Math.abs(N[O]||0)*100:0,L=Object.entries(d),z=L.length>0?Math.max(...L.map(([,a])=>a))/Math.max(o,1)*100:0,I=P>0?o/P:0;let p=0;return p+=Math.min(E,40),p+=Math.min(I*20,30),p+=Math.min(z*.3,20),p+=(100-A)*.1,p=Math.min(Math.max(p,0),100),{totalExposure:o,totalBalance:P,unrealizedPnl:R,winRate:A,maxDrawdown:E,var95:q,maxPairExposure:z,leverageUsed:I,riskScore:p,activeBots:s.length,openPositions:l.length,exposureByPair:d,exposureByBroker:g,recentTrades:j.length}},[i,n,h,m,y]),f=r.riskScore<30?"Bajo":r.riskScore<60?"Moderado":"Alto",u=r.riskScore<30?"#10B981":r.riskScore<60?"#F59E0B":"#EF4444",$=(()=>{const s=Object.entries(r.exposureByPair),l=s.reduce((o,[,d])=>o+d,0)||1,c=["#D4AF37","#3B82F6","#10B981","#F59E0B","#8B5CF6","#EC4899"];return s.map(([o,d],g)=>({label:o,value:d/l*100,color:c[g%c.length]}))})();return e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(T,{size:22,className:"text-[var(--gold)]"})," Risk Dashboard"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Gestión de riesgo en tiempo real"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5",style:{background:`${u}20`,color:u},children:[e.jsx(T,{size:12}),"Riesgo ",f," (",r.riskScore.toFixed(0),"/100)"]})})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{width:"140",height:"80",viewBox:"0 0 140 80",children:[e.jsx("path",{d:"M 10 75 A 60 60 0 0 1 130 75",fill:"none",stroke:"var(--dark-4)",strokeWidth:"8",strokeLinecap:"round"}),e.jsx("path",{d:"M 10 75 A 60 60 0 0 1 130 75",fill:"none",stroke:u,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${r.riskScore/100*188} 188`})]}),e.jsxs("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 text-center",children:[e.jsx("p",{className:"text-2xl font-black",style:{color:u},children:r.riskScore.toFixed(0)}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Risk Score"})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(M,{label:"Max Drawdown",value:r.maxDrawdown,max:50}),e.jsx(M,{label:"Apalancamiento",value:r.leverageUsed*100,max:300}),e.jsx(M,{label:"Concentración",value:r.maxPairExposure,max:100}),e.jsx(M,{label:"VaR (95%)",value:r.var95,max:20})]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{icon:H,label:"Exposición Total",value:`$${r.totalExposure.toFixed(2)}`,color:"var(--gold)"},{icon:K,label:"P&L No Realizado",value:`${r.unrealizedPnl>=0?"+":""}$${r.unrealizedPnl.toFixed(2)}`,color:r.unrealizedPnl>=0?"#10B981":"#EF4444"},{icon:G,label:"Posiciones Abiertas",value:`${r.openPositions}`,color:"#3B82F6"},{icon:V,label:"Max Drawdown",value:`${r.maxDrawdown.toFixed(1)}%`,color:r.maxDrawdown<10?"#10B981":"#EF4444"}].map((s,l)=>{const c=s.icon;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[var(--text-dim)] mb-1",children:[e.jsx(c,{size:14,style:{color:s.color}}),e.jsx("span",{className:"text-[10px]",children:s.label})]}),e.jsx("p",{className:"text-base font-bold",style:{color:s.color},children:s.value})]},l)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2 mb-4",children:[e.jsx(W,{size:14,className:"text-[var(--gold)]"})," Exposición por Par"]}),$.length>0?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Y,{segments:$}),e.jsx("div",{className:"space-y-2 flex-1",children:$.map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{background:s.color}}),e.jsx("span",{className:"text-xs flex-1",children:s.label}),e.jsxs("span",{className:"text-xs font-bold",style:{color:s.color},children:[s.value.toFixed(1),"%"]})]},l))})]}):e.jsx("p",{className:"text-xs text-[var(--text-dim)] text-center py-6",children:"Sin posiciones abiertas"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2 mb-4",children:[e.jsx(J,{size:14,className:"text-[var(--gold)]"})," Bots Activos — Riesgo"]}),i.filter(s=>s.status==="active").length>0?e.jsx("div",{className:"space-y-2",children:i.filter(s=>s.status==="active").map(s=>{const l=F.getLiveData(s.id),c=!!(l!=null&&l.position),o=(l==null?void 0:l.unrealizedPnl)||0,d=s.riskPercent||x.maxRiskPerTrade||2;return e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-[var(--dark)]",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c?"bg-[var(--gold)]":"bg-emerald-500"} animate-pulse`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold truncate",children:s.name}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[s.pair," • ",d,"% riesgo"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-xs font-bold ${o>=0?"text-emerald-400":"text-red-400"}`,children:c?`${o>=0?"+":""}$${o.toFixed(2)}`:"Esperando"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:c?`${l.position.side.toUpperCase()} @ $${l.position.entryPrice.toFixed(2)}`:"—"})]})]},s.id)})}):e.jsx("p",{className:"text-xs text-[var(--text-dim)] text-center py-6",children:"No hay bots activos"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2 mb-3",children:[e.jsx(C,{size:14,className:"text-[var(--gold)]"})," Reglas de Riesgo"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[{label:"Riesgo Máx por Trade",value:`${x.maxRiskPerTrade||2}%`,status:!0},{label:"Apalancamiento Máx",value:`${x.defaultLeverage||1}x`,status:!0},{label:"Max Drawdown Permitido",value:"25%",status:r.maxDrawdown<25},{label:"Máx Posiciones Simultáneas",value:`${i.filter(s=>s.status==="active").length}`,status:!0},{label:"Trailing Stop",value:i.some(s=>s.trailingStop)?"Activo":"Inactivo",status:i.some(s=>s.trailingStop)},{label:"Notificaciones",value:x.notifications?"Activas":"Inactivas",status:x.notifications}].map((s,l)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-[var(--dark)]",children:[s.status?e.jsx(C,{size:12,className:"text-emerald-400 shrink-0"}):e.jsx(Q,{size:12,className:"text-red-400 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:s.label}),e.jsx("p",{className:"text-xs font-bold",children:s.value})]})]},l))})]})]})}export{ie as default};
//# sourceMappingURL=RiskDashboard-Cc0tIpx2.js.map
