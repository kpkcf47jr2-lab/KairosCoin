import{j as e,m as C,U as Be,C as $e,L as Ee,B as W,P as ee,a as Y,Z as q,S as le,b as ue,H as Ie,c as Q,W as ce,d as Fe,e as De,A as U,f as Re,g as de,T as G,h as Z,i as Me,k as ze,l as X,n as J,E as Se,o as Pe,p as Le,q as xe,D as re,r as _e,s as Oe,t as Ke,u as me,v as oe,w as qe,x as Ue,y as te,z as pe,X as He,F as Ve,G as We,R as Ge,I as Je,K as Xe,J as Ye,M as Qe,N as Ze}from"./ui-aLxSizve.js";import{b as et,g as tt,c as st,a as b,R as at,B as rt}from"./vendor-CUCP814w.js";import{V as it,a as nt,I as lt}from"./charts-UjLl1g-4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(l){if(l.ep)return;l.ep=!0;const i=t(l);fetch(l.href,i)}})();var se={},fe;function ot(){if(fe)return se;fe=1;var o=et();return se.createRoot=o.createRoot,se.hydrateRoot=o.hydrateRoot,se}var ct=ot();const dt=tt(ct),V={binance:{id:"binance",name:"Binance",logo:"ðŸŸ¡",baseUrl:"https://api.binance.com",wsUrl:"wss://stream.binance.com:9443/ws",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},bybit:{id:"bybit",name:"Bybit",logo:"ðŸŸ ",baseUrl:"https://api.bybit.com",wsUrl:"wss://stream.bybit.com/v5/public/spot",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret"]},kraken:{id:"kraken",name:"Kraken",logo:"ðŸŸ£",baseUrl:"https://api.kraken.com",wsUrl:"wss://ws.kraken.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},coinbase:{id:"coinbase",name:"Coinbase",logo:"ðŸ”µ",baseUrl:"https://api.coinbase.com",wsUrl:"wss://ws-feed.exchange.coinbase.com",supportedMarkets:["spot"],requiredFields:["apiKey","apiSecret","passphrase"]},kucoin:{id:"kucoin",name:"KuCoin",logo:"ðŸŸ¢",baseUrl:"https://api.kucoin.com",wsUrl:"wss://ws-api.kucoin.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret","passphrase"]},okx:{id:"okx",name:"OKX",logo:"âš«",baseUrl:"https://www.okx.com",wsUrl:"wss://ws.okx.com:8443/ws/v5/public",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret","passphrase"]}},he=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT","DOGEUSDT","AVAXUSDT","DOTUSDT","MATICUSDT","LINKUSDT","ATOMUSDT","LTCUSDT","UNIUSDT","AAVEUSDT"],ge=[{label:"1m",value:"1m",seconds:60},{label:"5m",value:"5m",seconds:300},{label:"15m",value:"15m",seconds:900},{label:"1H",value:"1h",seconds:3600},{label:"4H",value:"4h",seconds:14400},{label:"1D",value:"1d",seconds:86400},{label:"1W",value:"1w",seconds:604800}],I={AUTH:"kairos_trade_auth",BROKERS:"kairos_trade_brokers",BOTS:"kairos_trade_bots",SETTINGS:"kairos_trade_settings",STRATEGIES:"kairos_trade_strategies"},H=(o,s)=>{try{return JSON.parse(localStorage.getItem(o))||s}catch{return s}},O=(o,s)=>localStorage.setItem(o,JSON.stringify(s)),F=st((o,s)=>({user:H(I.AUTH,null),isAuthenticated:!!H(I.AUTH,null),login:t=>{O(I.AUTH,t),o({user:t,isAuthenticated:!0})},logout:()=>{localStorage.removeItem(I.AUTH),o({user:null,isAuthenticated:!1})},currentPage:"dashboard",setPage:t=>o({currentPage:t}),brokers:H(I.BROKERS,[]),activeBroker:null,addBroker:t=>{const a={...t,id:Date.now().toString(36),apiKey:btoa(t.apiKey),apiSecret:btoa(t.apiSecret),passphrase:t.passphrase?btoa(t.passphrase):void 0,connected:!1,addedAt:new Date().toISOString()},l=[...s().brokers,a];return O(I.BROKERS,l),o({brokers:l}),a},removeBroker:t=>{var l;const a=s().brokers.filter(i=>i.id!==t);O(I.BROKERS,a),o({brokers:a,activeBroker:((l=s().activeBroker)==null?void 0:l.id)===t?null:s().activeBroker})},setActiveBroker:t=>o({activeBroker:t}),updateBrokerStatus:(t,a)=>{const l=s().brokers.map(i=>i.id===t?{...i,connected:a}:i);O(I.BROKERS,l),o({brokers:l})},bots:H(I.BOTS,[]),addBot:t=>{const a={...t,id:Date.now().toString(36),status:"stopped",trades:0,pnl:0,winRate:0,createdAt:new Date().toISOString()},l=[...s().bots,a];return O(I.BOTS,l),o({bots:l}),a},updateBot:(t,a)=>{const l=s().bots.map(i=>i.id===t?{...i,...a}:i);O(I.BOTS,l),o({bots:l})},removeBot:t=>{const a=s().bots.filter(l=>l.id!==t);O(I.BOTS,a),o({bots:a})},selectedPair:"BTCUSDT",selectedTimeframe:"1h",currentPrice:null,priceChange24h:null,orderBook:{bids:[],asks:[]},positions:[],orders:[],tradeHistory:[],setSelectedPair:t=>o({selectedPair:t}),setSelectedTimeframe:t=>o({selectedTimeframe:t}),setCurrentPrice:t=>o({currentPrice:t}),setPriceChange24h:t=>o({priceChange24h:t}),setOrderBook:t=>o({orderBook:t}),addPosition:t=>o({positions:[...s().positions,{...t,id:Date.now().toString(36)}]}),closePosition:t=>{const a=s().positions.find(l=>l.id===t);a&&o({positions:s().positions.filter(l=>l.id!==t),tradeHistory:[...s().tradeHistory,{...a,closedAt:new Date().toISOString()}]})},addOrder:t=>o({orders:[...s().orders,{...t,id:Date.now().toString(36)}]}),cancelOrder:t=>o({orders:s().orders.filter(a=>a.id!==t)}),strategies:H(I.STRATEGIES,[]),addStrategy:t=>{const a={...t,id:Date.now().toString(36),createdAt:new Date().toISOString()},l=[...s().strategies,a];return O(I.STRATEGIES,l),o({strategies:l}),a},removeStrategy:t=>{const a=s().strategies.filter(l=>l.id!==t);O(I.STRATEGIES,a),o({strategies:a})},aiMessages:[],aiLoading:!1,addAiMessage:t=>o({aiMessages:[...s().aiMessages,t]}),setAiLoading:t=>o({aiLoading:t}),clearAiMessages:()=>o({aiMessages:[]}),settings:H(I.SETTINGS,{theme:"dark",language:"es",notifications:!0,soundAlerts:!0,maxRiskPerTrade:2,defaultLeverage:1}),updateSettings:t=>{const a={...s().settings,...t};O(I.SETTINGS,a),o({settings:a})},sidebarOpen:!0,aiPanelOpen:!1,modalOpen:null,toggleSidebar:()=>o({sidebarOpen:!s().sidebarOpen}),toggleAiPanel:()=>o({aiPanelOpen:!s().aiPanelOpen}),setModal:t=>o({modalOpen:t})})),xt=[{label:"Principal",items:[{id:"dashboard",icon:Ee,label:"Dashboard",desc:"Panel de control"},{id:"chart",icon:W,label:"Trading",desc:"GrÃ¡ficos en vivo"},{id:"simulator",icon:ee,label:"Simulador",desc:"Paper trading"}]},{label:"AutomatizaciÃ³n",items:[{id:"bots",icon:Y,label:"Bots",desc:"Trading automÃ¡tico"},{id:"strategies",icon:q,label:"Estrategias",desc:"Crear y gestionar"},{id:"ai",icon:le,label:"Kairos AI",desc:"Asistente IA",accent:!0}]},{label:"GestiÃ³n",items:[{id:"brokers",icon:ue,label:"Brokers",desc:"Conexiones API"},{id:"history",icon:Ie,label:"Historial",desc:"Trades y reportes"},{id:"alerts",icon:Q,label:"Alertas",desc:"Notificaciones"}]}],mt=[{id:"wallet",icon:ce,label:"Wallet"},{id:"settings",icon:Fe,label:"Ajustes"}];function pt(){const{currentPage:o,setPage:s,sidebarOpen:t,toggleSidebar:a,bots:l,brokers:i,logout:r,user:n}=F(),[p,u]=b.useState(null),c=l.filter(v=>v.status==="active").length,g=i.filter(v=>v.connected).length,x=v=>v==="bots"?c:v==="brokers"?g:0,w=({item:v,compact:h=!1})=>{const y=v.icon,k=o===v.id,d=x(v.id),N=p===v.id;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>s(v.id),onMouseEnter:()=>u(v.id),onMouseLeave:()=>u(null),title:t?void 0:v.label,className:`w-full flex items-center rounded-xl transition-all duration-200 relative group
            ${t?"px-3 py-3 gap-3":"px-0 py-3 justify-center"}
            ${k?"text-white":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:[k&&e.jsx(C.div,{layoutId:"navBg",className:"absolute inset-0 rounded-xl",style:{background:v.accent?"linear-gradient(135deg, rgba(59,130,246,0.15), rgba(96,165,250,0.08))":"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.04))",border:"1px solid rgba(59,130,246,0.15)"},transition:{type:"spring",stiffness:350,damping:30}}),k&&e.jsx(C.div,{layoutId:"activeBar",className:"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-6 rounded-r-full",style:{background:"linear-gradient(180deg, #60A5FA, #3B82F6)"},transition:{type:"spring",stiffness:350,damping:30}}),e.jsxs("div",{className:`relative z-10 flex items-center justify-center shrink-0 rounded-lg transition-all duration-200
            ${t?"w-8 h-8":"w-9 h-9"}
            ${k?v.accent?"bg-[var(--gold)]/20":"bg-white/[0.06]":"bg-transparent group-hover:bg-white/[0.04]"}`,children:[e.jsx(y,{size:t?18:20,strokeWidth:k?2:1.5,className:`transition-colors ${k&&v.accent?"text-[var(--gold-light)]":""}`}),d>0&&!t&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-[14px] h-[14px] bg-[var(--gold)] rounded-full text-[8px] font-bold text-white flex items-center justify-center",children:d})]}),t&&e.jsxs("div",{className:"relative z-10 flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[13px] truncate leading-tight ${k?"font-semibold":"font-medium"}`,children:v.label}),v.accent&&e.jsx("span",{className:"text-[8px] font-bold bg-[var(--gold)]/20 text-[var(--gold-light)] px-1.5 py-0.5 rounded-full uppercase tracking-wider",children:"Pro"}),d>0&&e.jsx("span",{className:"ml-auto text-[10px] font-semibold bg-[var(--gold)]/12 text-[var(--gold)] rounded-full px-2 py-0.5 min-w-[22px] text-center",children:d})]}),!h&&v.desc&&e.jsx("span",{className:`text-[10px] leading-tight truncate block mt-0.5 transition-colors
                  ${k?"text-[var(--text-dim)]":"text-[var(--text-dim)]/50"}`,children:v.desc})]})]}),e.jsx(U,{children:!t&&N&&e.jsx(C.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] whitespace-nowrap",children:v.label}),v.desc&&e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] whitespace-nowrap",children:v.desc})]})})})]})},j=({label:v})=>t?e.jsxs("div",{className:"flex items-center gap-2 px-3 mb-2 mt-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--text-dim)]/40 uppercase tracking-[0.12em]",children:v}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]/50"})]}):e.jsx("div",{className:"mx-auto w-6 h-px bg-[var(--border)]/60 my-3"});return e.jsxs(C.aside,{animate:{width:t?260:72},transition:{duration:.25,ease:[.4,0,.2,1]},className:"h-full flex flex-col relative shrink-0",style:{borderRight:"1px solid var(--border)",background:"linear-gradient(180deg, #111318 0%, #0D1017 100%)"},children:[e.jsxs("div",{className:`flex items-center shrink-0 ${t?"px-5 gap-3 h-[60px]":"justify-center h-[60px]"}`,style:{borderBottom:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center shrink-0 relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx("span",{className:"text-white font-bold text-sm",children:"K"}),e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{boxShadow:"0 0 20px rgba(59,130,246,0.25)"}})]}),t&&e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1,duration:.2},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-[15px] font-bold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-widest",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium tracking-wider",children:"BY KAIROS 777"})]})})]}),t&&e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-3 mt-4 mb-2 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.06), rgba(30,34,45,0.5))",border:"1px solid rgba(59,130,246,0.08)"},children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--dark-4)] flex items-center justify-center",children:e.jsx(Be,{size:14,className:"text-[var(--text-dim)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] truncate",children:(n==null?void 0:n.name)||"Trader"}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx($e,{size:9,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] uppercase tracking-wider",children:"Free Plan"})]})]})]})}),e.jsx("nav",{className:`flex-1 overflow-y-auto py-2 ${t?"px-3":"px-2"}`,style:{scrollbarWidth:"none"},children:xt.map((v,h)=>e.jsxs("div",{className:h>0?"mt-5":"mt-1",children:[e.jsx(j,{label:v.label}),e.jsx("div",{className:"space-y-0.5",children:v.items.map(y=>e.jsx(w,{item:y},y.id))})]},v.label))}),e.jsxs("div",{className:`py-3 ${t?"px-3":"px-2"}`,style:{borderTop:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"space-y-0.5",children:mt.map(v=>e.jsx(w,{item:v,compact:!0},v.id))}),e.jsxs("button",{onClick:r,onMouseEnter:()=>u("logout"),onMouseLeave:()=>u(null),title:t?void 0:"Salir",className:`w-full flex items-center rounded-xl text-[var(--text-dim)] hover:text-[var(--red)] transition-all duration-200 mt-1 relative
            ${t?"px-3 py-2.5 gap-3":"px-0 py-2.5 justify-center"}
            hover:bg-[var(--red)]/[0.06]`,children:[e.jsx("div",{className:`flex items-center justify-center shrink-0 rounded-lg ${t?"w-8 h-8":"w-9 h-9"}`,children:e.jsx(De,{size:t?16:18,strokeWidth:1.5})}),t&&e.jsx("span",{className:"text-[13px] font-medium",children:"Cerrar SesiÃ³n"}),e.jsx(U,{children:!t&&p==="logout"&&e.jsx(C.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsx("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:e.jsx("p",{className:"text-xs font-semibold text-[var(--red)] whitespace-nowrap",children:"Cerrar SesiÃ³n"})})})})]})]}),e.jsx("button",{onClick:a,className:"absolute -right-3 top-7 w-6 h-6 bg-[var(--dark-3)] border border-[var(--border)] rounded-full flex items-center justify-center text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 hover:bg-[var(--dark-4)] transition-all z-10 shadow-lg",children:t?e.jsx(Re,{size:11}):e.jsx(de,{size:11})})]})}function ut(){const{selectedPair:o,currentPrice:s,priceChange24h:t,toggleAiPanel:a,aiPanelOpen:l,brokers:i}=F(),r=i.some(u=>u.connected),[n,p]=b.useState(!1);return e.jsxs("header",{className:"h-[56px] shrink-0 flex items-center justify-between px-5",style:{borderBottom:"1px solid rgba(30,34,45,0.6)",background:"linear-gradient(180deg, rgba(17,19,24,0.95) 0%, rgba(11,14,17,0.95) 100%)",backdropFilter:"blur(12px)"},children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.05))",border:"1px solid rgba(59,130,246,0.15)"},children:e.jsx("span",{className:"text-[var(--gold)]",children:o==null?void 0:o.replace("USDT","").slice(0,3)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[14px] font-bold text-[var(--text)] tracking-wide leading-none",children:o}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium",children:"Perpetual"})]})]}),e.jsx("div",{className:"w-px h-7 bg-[var(--border)]/50"}),s&&e.jsx("div",{children:e.jsxs("span",{className:"text-[16px] font-mono font-bold text-[var(--text)] leading-none",children:["$",s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),t!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-mono font-semibold px-2.5 py-1 rounded-lg
              ${t>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,style:{border:`1px solid ${t>=0?"rgba(14,203,129,0.12)":"rgba(246,70,93,0.12)"}`},children:[t>=0?e.jsx(G,{size:12}):e.jsx(Z,{size:12}),t>=0?"+":"",t==null?void 0:t.toFixed(2),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]/40 font-medium",children:"24h"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1.5 text-[11px] px-3 py-1.5 rounded-lg transition-all
          ${r?"text-[var(--green)] bg-[var(--green)]/[0.06] border border-[var(--green)]/10":"text-[var(--text-dim)] bg-white/[0.02] border border-[var(--border)]/50"}`,children:[r?e.jsx(Me,{size:12}):e.jsx(ze,{size:12}),e.jsx("span",{className:"font-semibold",children:r?"Live":"Demo"})]}),e.jsxs("button",{onClick:a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all border
            ${l?"bg-[var(--gold)]/10 text-[var(--gold)] border-[var(--gold)]/15":"text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border-[var(--border)]/50 hover:border-[var(--gold)]/20"}`,title:"Kairos AI",children:[e.jsx(X,{size:13}),e.jsx("span",{children:"AI"}),l&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gold)] animate-pulse"})]}),e.jsxs("button",{className:"p-2 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border border-[var(--border)]/50 hover:border-[var(--border)] transition-all relative",children:[e.jsx(Q,{size:15}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-[var(--gold)] rounded-full shadow-[0_0_6px_rgba(59,130,246,0.4)]"})]})]})]})}const ht=[{icon:W,label:"Trading en tiempo real",desc:"GrÃ¡ficos profesionales con datos de Binance"},{icon:le,label:"Inteligencia artificial",desc:"AnÃ¡lisis de mercado impulsado por IA"},{icon:q,label:"Bots automatizados",desc:"Automatiza tus estrategias 24/7"},{icon:J,label:"Paper Trading",desc:"Practica sin riesgo con dinero virtual"}];function gt(){const{login:o}=F(),[s,t]=b.useState(!0),[a,l]=b.useState({email:"",password:"",name:""}),[i,r]=b.useState(""),[n,p]=b.useState(!1),[u,c]=b.useState(!1),g=async x=>{if(x.preventDefault(),r(""),!a.email||!a.password){r("Completa todos los campos");return}if(!s&&!a.name){r("Ingresa tu nombre");return}p(!0),setTimeout(()=>{o({id:Date.now().toString(36),email:a.email,name:a.name||a.email.split("@")[0],plan:"free",createdAt:new Date().toISOString()}),p(!1)},800)};return e.jsxs("div",{className:"min-h-screen bg-[var(--dark)] flex",children:[e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col justify-between p-10 relative overflow-hidden",style:{background:"linear-gradient(160deg, #0B0E11 0%, #111827 50%, #0B0E11 100%)"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] rounded-full opacity-[0.03]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 70%)"}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-[400px] h-[400px] rounded-full opacity-[0.02]",style:{background:"radial-gradient(circle, #60A5FA 0%, transparent 70%)"}}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 25px rgba(59,130,246,0.3)"},children:e.jsx("span",{className:"text-white font-bold text-lg",children:"K"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-lg font-bold text-[var(--text)]",children:"KAIROS"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)] tracking-widest",children:"TRADE"})]})})]})}),e.jsxs("div",{className:"relative z-10 max-w-md",children:[e.jsxs("h2",{className:"text-3xl font-bold text-[var(--text)] leading-tight mb-2",children:["Trading inteligente,",e.jsx("br",{}),e.jsx("span",{className:"text-[var(--gold)]",children:"resultados reales."})]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-8",children:"La plataforma de trading automatizado mÃ¡s avanzada del ecosistema Kairos 777."}),e.jsx("div",{className:"space-y-4",children:ht.map((x,w)=>{const j=x.icon;return e.jsxs(C.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+w*.1},className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0 mt-0.5",style:{background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.1)"},children:e.jsx(j,{size:16,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[13px] font-semibold text-[var(--text)]",children:x.label}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)]",children:x.desc})]})]},x.label)})})]}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/30 relative z-10",children:"Â© 2026 Kairos 777 Inc. Todos los derechos reservados."})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 lg:max-w-lg",children:e.jsxs(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-sm",children:[e.jsxs("div",{className:"text-center mb-8 lg:hidden",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center text-white font-bold text-xl mx-auto mb-3",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:"K"}),e.jsxs("h1",{className:"text-xl font-bold tracking-tight",children:[e.jsx("span",{className:"text-[var(--gold)]",children:"KAIROS"})," ",e.jsx("span",{className:"text-[var(--text)]",children:"TRADE"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-[var(--text)]",children:s?"Bienvenido de vuelta":"Crear cuenta"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1",children:s?"Inicia sesiÃ³n para continuar":"Empieza a operar en minutos"})]}),e.jsxs("div",{className:"flex mb-6 rounded-xl p-1",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("button",{onClick:()=>t(!0),className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-200
                ${s?"text-white font-bold shadow-lg":"text-[var(--text-dim)] font-medium"}`,style:s?{background:"linear-gradient(135deg, #3B82F6, #2563EB)"}:{},children:"Iniciar SesiÃ³n"}),e.jsx("button",{onClick:()=>t(!1),className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-200
                ${s?"text-[var(--text-dim)] font-medium":"text-white font-bold shadow-lg"}`,style:s?{}:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:"Registrarse"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[!s&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Nombre"}),e.jsx("input",{type:"text",value:a.name,onChange:x=>l({...a,name:x.target.value}),placeholder:"Tu nombre completo",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:x=>l({...a,email:x.target.value}),placeholder:"tu@email.com",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"ContraseÃ±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u?"text":"password",value:a.password,onChange:x=>l({...a,password:x.target.value}),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full pr-10"}),e.jsx("button",{type:"button",onClick:()=>c(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",children:u?e.jsx(Se,{size:15}):e.jsx(Pe,{size:15})})]})]}),i&&e.jsx("div",{className:"text-xs text-[var(--red)] bg-[var(--red)]/[0.06] border border-[var(--red)]/10 px-3 py-2 rounded-lg",children:i}),e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3 text-white font-bold rounded-xl transition-all duration-200 disabled:opacity-50 flex items-center justify-center gap-2 text-sm",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"},children:n?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[s?"Entrar":"Crear Cuenta",e.jsx(Le,{size:16})]})})]}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)]/50 text-center mt-6",children:["Parte del ecosistema ",e.jsx("span",{className:"text-[var(--gold)] font-semibold",children:"Kairos 777"})]})]})})]})}class vt{constructor(){this.ws=null,this.subscribers=new Map,this.reconnectAttempts=0,this.maxReconnect=5,this.candleCache=new Map}connectStream(s,t={}){const a=s.toLowerCase(),l=`wss://stream.binance.com:9443/ws/${a}@ticker/${a}@kline_1m`;return this.ws&&this.ws.close(),this.ws=new WebSocket(l),this.ws.onopen=()=>{var i;this.reconnectAttempts=0,(i=t.onConnect)==null||i.call(t)},this.ws.onmessage=i=>{var r,n;try{const p=JSON.parse(i.data);if(p.e==="24hrTicker"&&((r=t.onTicker)==null||r.call(t,{symbol:p.s,price:parseFloat(p.c),change:parseFloat(p.p),changePercent:parseFloat(p.P),high:parseFloat(p.h),low:parseFloat(p.l),volume:parseFloat(p.v),quoteVolume:parseFloat(p.q)})),p.e==="kline"){const u=p.k;(n=t.onCandle)==null||n.call(t,{time:Math.floor(u.t/1e3),open:parseFloat(u.o),high:parseFloat(u.h),low:parseFloat(u.l),close:parseFloat(u.c),volume:parseFloat(u.v),closed:u.x})}}catch(p){console.error("WS parse error:",p)}},this.ws.onerror=i=>{var r;console.error("WS error:",i),(r=t.onError)==null||r.call(t,i)},this.ws.onclose=()=>{var i;this.reconnectAttempts<this.maxReconnect&&(this.reconnectAttempts++,setTimeout(()=>this.connectStream(s,t),2e3*this.reconnectAttempts)),(i=t.onDisconnect)==null||i.call(t)},()=>this.disconnect()}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}async getCandles(s,t="1h",a=500){const l=`${s}_${t}`;try{const i=`https://api.binance.com/api/v3/klines?symbol=${s}&interval=${t}&limit=${a}`,r=await fetch(i);if(!r.ok)throw new Error(`HTTP ${r.status}`);const p=(await r.json()).map(u=>({time:Math.floor(u[0]/1e3),open:parseFloat(u[1]),high:parseFloat(u[2]),low:parseFloat(u[3]),close:parseFloat(u[4]),volume:parseFloat(u[5])}));return this.candleCache.set(l,{data:p,ts:Date.now()}),p}catch(i){const r=this.candleCache.get(l);if(r)return r.data;throw i}}async getPrice(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${s}`)).json();return parseFloat(a.price)}async get24hrTicker(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`)).json();return{symbol:a.symbol,price:parseFloat(a.lastPrice),change:parseFloat(a.priceChange),changePercent:parseFloat(a.priceChangePercent),high:parseFloat(a.highPrice),low:parseFloat(a.lowPrice),volume:parseFloat(a.volume),quoteVolume:parseFloat(a.quoteVolume)}}async getOrderBook(s,t=20){const l=await(await fetch(`https://api.binance.com/api/v3/depth?symbol=${s}&limit=${t}`)).json();return{bids:l.bids.map(([i,r])=>({price:parseFloat(i),quantity:parseFloat(r)})),asks:l.asks.map(([i,r])=>({price:parseFloat(i),quantity:parseFloat(r)}))}}async searchSymbols(s){const a=await(await fetch("https://api.binance.com/api/v3/exchangeInfo")).json(),l=s.toUpperCase();return a.symbols.filter(i=>i.status==="TRADING"&&(i.symbol.includes(l)||i.baseAsset.includes(l))).slice(0,20).map(i=>({symbol:i.symbol,base:i.baseAsset,quote:i.quoteAsset}))}}const D=new vt;function je(){const{setPage:o,bots:s,brokers:t,tradeHistory:a,positions:l,user:i}=F(),[r,n]=b.useState([]),[p,u]=b.useState(!0);b.useEffect(()=>{c();const h=setInterval(c,3e4);return()=>clearInterval(h)},[]);const c=async()=>{try{const h=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"],y=await Promise.all(h.map(async k=>{try{return await D.get24hrTicker(k)}catch{return null}}));n(y.filter(Boolean))}catch(h){console.error("Dashboard load error:",h)}u(!1)},g=s.filter(h=>h.status==="active"),x=a.reduce((h,y)=>h+(y.pnl||0),0),w=t.filter(h=>h.connected),j=[{label:"Bots Activos",value:g.length,icon:Y,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.03))",border:"rgba(59,130,246,0.12)",action:"bots"},{label:"Brokers",value:`${w.length}/${t.length}`,icon:ue,color:"#8B5CF6",gradient:"linear-gradient(135deg, rgba(139,92,246,0.12), rgba(139,92,246,0.03))",border:"rgba(139,92,246,0.12)",action:"brokers"},{label:"Posiciones",value:l.length,icon:xe,color:"#0ECB81",gradient:"linear-gradient(135deg, rgba(14,203,129,0.12), rgba(14,203,129,0.03))",border:"rgba(14,203,129,0.12)",action:"history"},{label:"P&L Total",value:`${x>=0?"+":""}$${x.toFixed(2)}`,icon:re,color:x>=0?"#0ECB81":"#F6465D",gradient:x>=0?"linear-gradient(135deg, rgba(14,203,129,0.12), rgba(14,203,129,0.03))":"linear-gradient(135deg, rgba(246,70,93,0.12), rgba(246,70,93,0.03))",border:x>=0?"rgba(14,203,129,0.12)":"rgba(246,70,93,0.12)",action:"history"}],v=[{label:"Trading",icon:W,page:"chart",desc:"GrÃ¡ficos profesionales",color:"#3B82F6"},{label:"Simulador",icon:ee,page:"simulator",desc:"Paper trading sin riesgo",color:"#0ECB81"},{label:"Kairos AI",icon:le,page:"ai",desc:"Asistente inteligente",color:"#8B5CF6"},{label:"Crear Bot",icon:Y,page:"bots",desc:"Automatiza tu trading",color:"#F59E0B"},{label:"Estrategias",icon:q,page:"strategies",desc:"Crea y gestiona",color:"#EC4899"},{label:"Brokers",icon:J,page:"brokers",desc:"Conecta tu cuenta",color:"#06B6D4"}];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(C.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight",children:["Bienvenido, ",e.jsx("span",{className:"text-[var(--gold)]",children:(i==null?void 0:i.name)||"Trader"})]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:"Tu centro de control de trading automatizado"})]}),e.jsxs("button",{onClick:()=>o("chart"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold text-white transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:[e.jsx(W,{size:16}),"Abrir Trading"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:j.map((h,y)=>{const k=h.icon;return e.jsxs(C.button,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:y*.06},onClick:()=>o(h.action),className:"rounded-xl p-4 text-left transition-all duration-200 hover:scale-[1.02] group",style:{background:h.gradient,border:`1px solid ${h.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:`${h.color}15`},children:e.jsx(k,{size:18,style:{color:h.color}})}),e.jsx(de,{size:14,className:"text-[var(--text-dim)]/30 group-hover:text-[var(--text-dim)] transition-colors"})]}),e.jsx("p",{className:"text-[22px] font-bold leading-none",style:{color:h.color},children:h.value}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 font-medium",children:h.label})]},h.label)})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold text-[var(--text)] mb-3 flex items-center gap-2",children:[e.jsx(q,{size:14,className:"text-[var(--gold)]"}),"Acceso RÃ¡pido"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:v.map((h,y)=>{const k=h.icon;return e.jsxs(C.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2+y*.05},onClick:()=>o(h.page),className:"rounded-xl p-4 text-left transition-all duration-200 group hover:scale-[1.01]",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},onMouseEnter:d=>d.currentTarget.style.borderColor=`${h.color}30`,onMouseLeave:d=>d.currentTarget.style.borderColor="rgba(30,34,45,0.5)",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center mb-3 transition-transform group-hover:scale-110",style:{background:`${h.color}12`},children:e.jsx(k,{size:20,style:{color:h.color}})}),e.jsx("p",{className:"text-[13px] font-bold text-[var(--text)]",children:h.label}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-0.5",children:h.desc})]},h.label)})})]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:14,className:"text-[var(--gold)]"}),e.jsx("h2",{className:"text-sm font-bold",children:"Mercado en Tiempo Real"})]}),e.jsxs("button",{onClick:()=>o("chart"),className:"text-[11px] text-[var(--gold)] hover:text-[var(--gold-light)] font-semibold flex items-center gap-1 transition-colors",children:["Ver grÃ¡fico ",e.jsx(de,{size:12})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 px-4 py-2 text-[10px] font-bold text-[var(--text-dim)]/50 uppercase tracking-wider",children:[e.jsx("span",{children:"Par"}),e.jsx("span",{className:"text-right",children:"Precio"}),e.jsx("span",{className:"text-right",children:"Cambio 24h"}),e.jsx("span",{className:"text-right",children:"AcciÃ³n"})]}),e.jsx("div",{className:"divide-y divide-[var(--border)]/30",children:p?e.jsx("div",{className:"p-8 text-center text-sm text-[var(--text-dim)] animate-pulse",children:"Cargando mercado..."}):r.map((h,y)=>e.jsxs(C.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:y*.05},onClick:()=>{F.getState().setSelectedPair(h.symbol),o("chart")},className:"w-full grid grid-cols-4 gap-4 items-center px-4 py-3 hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:h.changePercent>=0?"rgba(14,203,129,0.08)":"rgba(246,70,93,0.08)"},children:e.jsx("span",{className:h.changePercent>=0?"text-[var(--green)]":"text-[var(--red)]",children:h.symbol.replace("USDT","").slice(0,3)})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[13px] font-bold leading-none",children:h.symbol.replace("USDT","")}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/50 mt-0.5",children:"USDT"})]})]}),e.jsxs("p",{className:"text-[13px] font-mono font-semibold text-right",children:["$",h.price.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsx("div",{className:"flex items-center gap-1 justify-end",children:e.jsxs("span",{className:`flex items-center gap-0.5 text-xs font-mono font-semibold px-2 py-0.5 rounded-md
                  ${h.changePercent>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:[h.changePercent>=0?e.jsx(_e,{size:10}):e.jsx(Oe,{size:10}),h.changePercent>=0?"+":"",h.changePercent.toFixed(2),"%"]})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] font-semibold text-[var(--gold)] opacity-0 group-hover:opacity-100 transition-opacity bg-[var(--gold)]/10 px-2 py-1 rounded-md",children:"Trading â†’"})})]},h.symbol))})]})]})}function K(o,s){const t=2/(s+1),a=[o[0]];for(let l=1;l<o.length;l++)a.push(o[l]*t+a[l-1]*(1-t));return a}function Ce(o,s){const t=[];for(let a=0;a<o.length;a++){if(a<s-1){t.push(null);continue}const l=o.slice(a-s+1,a+1);t.push(l.reduce((i,r)=>i+r,0)/s)}return t}function ie(o,s=14){const t=new Array(s).fill(null);let a=0,l=0;for(let i=1;i<=s;i++){const r=o[i]-o[i-1];r>0?a+=r:l+=Math.abs(r)}a/=s,l/=s,t.push(l===0?100:100-100/(1+a/l));for(let i=s+1;i<o.length;i++){const r=o[i]-o[i-1];a=(a*(s-1)+(r>0?r:0))/s,l=(l*(s-1)+(r<0?Math.abs(r):0))/s,t.push(l===0?100:100-100/(1+a/l))}return t}function Ae(o,s=12,t=26,a=9){const l=K(o,s),i=K(o,t),r=l.map((u,c)=>u-i[c]),n=K(r,a),p=r.map((u,c)=>u-n[c]);return{macd:r,signal:n,histogram:p}}function bt(o,s=20,t=2){const a=Ce(o,s),l=[],i=[];for(let r=0;r<o.length;r++){if(r<s-1){l.push(null),i.push(null);continue}const n=o.slice(r-s+1,r+1),p=a[r],u=n.reduce((g,x)=>g+Math.pow(x-p,2),0)/s,c=Math.sqrt(u)*t;l.push(p+c),i.push(p-c)}return{upper:l,middle:a,lower:i}}function ne(o,s,t){if(t<1)return null;const a=o[t-1],l=o[t],i=s[t-1],r=s[t];return a<=i&&l>r?"bullish_cross":a>=i&&l<r?"bearish_cross":null}function ft(){const o=b.useRef(null),s=b.useRef(null),t=b.useRef(null),a=b.useRef(null),l=b.useRef([]),i=b.useRef(null),{selectedPair:r,selectedTimeframe:n,setSelectedPair:p,setSelectedTimeframe:u,setCurrentPrice:c,setPriceChange24h:g}=F(),[x,w]=b.useState(!0),[j,v]=b.useState(null),[h,y]=b.useState(!1),[k,d]=b.useState(""),[N,m]=b.useState(["ema20"]);b.useEffect(()=>{const f=o.current;if(!f)return;const B=f.getBoundingClientRect(),P=B.width||f.clientWidth||800,$=B.height||f.clientHeight||500,A=it(f,{width:P,height:$,layout:{background:{type:lt.Solid,color:"#0B0E11"},textColor:"#848E9C",fontFamily:"Inter, sans-serif",fontSize:11},grid:{vertLines:{color:"#1E222D"},horzLines:{color:"#1E222D"}},crosshair:{mode:nt.Normal,vertLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"},horzLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"}},timeScale:{borderColor:"#1E222D",timeVisible:!0,secondsVisible:!1,rightOffset:5,barSpacing:8},rightPriceScale:{borderColor:"#1E222D",scaleMargins:{top:.05,bottom:.2}},handleScroll:{mouseWheel:!0,pressedMouseMove:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}}),R=A.addCandlestickSeries({upColor:"#0ECB81",downColor:"#F6465D",borderUpColor:"#0ECB81",borderDownColor:"#F6465D",wickUpColor:"#0ECB81",wickDownColor:"#F6465D"}),T=A.addHistogramSeries({color:"#3B82F622",priceFormat:{type:"volume"},priceScaleId:"volume"});A.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0}}),s.current=A,t.current=R,a.current=T;const E=new ResizeObserver(_=>{if(!_||!_[0])return;const{width:ve,height:be}=_[0].contentRect;ve>0&&be>0&&A.applyOptions({width:ve,height:be})});return E.observe(f),()=>{E.disconnect(),A.remove(),s.current=null,t.current=null,a.current=null}},[]),b.useEffect(()=>{let f=!1;return(async()=>{w(!0),v(null);try{const[P,$]=await Promise.all([D.getCandles(r,n,500),D.get24hrTicker(r)]);if(f)return;if(!P||P.length===0){v("No se recibieron datos de Binance"),w(!1);return}t.current&&t.current.setData(P),a.current&&a.current.setData(P.map(A=>({time:A.time,value:A.volume||0,color:A.close>=A.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"}))),c($.price),g($.changePercent);try{S(P)}catch(A){console.warn("Indicator error (non-fatal):",A)}s.current&&s.current.timeScale().fitContent()}catch(P){console.error("Chart data load error:",P),f||v(`Error cargando datos: ${P.message}`)}f||w(!1)})(),i.current&&i.current(),i.current=D.connectStream(r,{onTicker:P=>{c(P.price),g(P.changePercent)},onCandle:P=>{t.current&&t.current.update(P),a.current&&a.current.update({time:P.time,value:P.volume||0,color:P.close>=P.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"})}}),()=>{f=!0,i.current&&(i.current(),i.current=null)}},[r,n]);const S=f=>{if(!s.current)return;l.current.forEach($=>{var A;try{(A=s.current)==null||A.removeSeries($)}catch{}}),l.current=[];const B=f.map($=>$.close),P=f.map($=>$.time);N.forEach($=>{try{if($==="ema20"){const R=K(B,20).map((T,E)=>T!=null&&isFinite(T)?{time:P[E],value:T}:null).filter(Boolean);if(R.length>0){const T=s.current.addLineSeries({color:"#3B82F6",lineWidth:1.5,title:"EMA 20",lastValueVisible:!1,priceLineVisible:!1});T.setData(R),l.current.push(T)}}if($==="ema50"){const R=K(B,50).map((T,E)=>T!=null&&isFinite(T)?{time:P[E],value:T}:null).filter(Boolean);if(R.length>0){const T=s.current.addLineSeries({color:"#8B5CF6",lineWidth:1.5,title:"EMA 50",lastValueVisible:!1,priceLineVisible:!1});T.setData(R),l.current.push(T)}}if($==="sma200"){const R=Ce(B,200).map((T,E)=>T!=null&&isFinite(T)?{time:P[E],value:T}:null).filter(Boolean);if(R.length>0){const T=s.current.addLineSeries({color:"#FF6D00",lineWidth:1,title:"SMA 200",lastValueVisible:!1,priceLineVisible:!1});T.setData(R),l.current.push(T)}}if($==="bb"){const A=bt(B),R=A.upper.map((E,_)=>E!=null&&isFinite(E)?{time:P[_],value:E}:null).filter(Boolean),T=A.lower.map((E,_)=>E!=null&&isFinite(E)?{time:P[_],value:E}:null).filter(Boolean);if(R.length>0){const E=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Upper",lastValueVisible:!1,priceLineVisible:!1}),_=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Lower",lastValueVisible:!1,priceLineVisible:!1});E.setData(R),_.setData(T),l.current.push(E,_)}}}catch(A){console.warn(`Indicator ${$} error:`,A)}})};b.useEffect(()=>{if(!t.current)return;(async()=>{try{const B=await D.getCandles(r,n,500);S(B)}catch{}})()},[N]);const M=f=>{m(B=>B.includes(f)?B.filter(P=>P!==f):[...B,f])};return e.jsxs("div",{className:"flex flex-col w-full h-full",style:{minHeight:0},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 shrink-0 flex-wrap",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>y(!h),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Ke,{size:13,className:"text-[var(--text-dim)]"}),r]}),h&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2",children:[e.jsx("input",{type:"text",value:k,onChange:f=>d(f.target.value.toUpperCase()),placeholder:"Buscar par...",className:"w-full text-sm mb-2",autoFocus:!0}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:he.filter(f=>f.includes(k)).map(f=>e.jsx("button",{onClick:()=>{p(f),y(!1),d("")},className:`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors
                        ${f===r?"bg-[var(--gold)]/15 text-[var(--gold)]":"text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]"}`,children:f},f))})]})]}),e.jsx("div",{className:"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5",children:ge.map(f=>e.jsx("button",{onClick:()=>u(f.value),className:`px-2.5 py-1 text-xs rounded-md transition-colors
                ${n===f.value?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:f.label},f.value))}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(G,{size:13,className:"text-[var(--text-dim)]"}),[{id:"ema20",label:"EMA 20",color:"#3B82F6"},{id:"ema50",label:"EMA 50",color:"#8B5CF6"},{id:"sma200",label:"SMA 200",color:"#FF6D00"},{id:"bb",label:"BB",color:"#9C27B0"}].map(f=>e.jsx("button",{onClick:()=>M(f.id),className:`px-2 py-0.5 text-[11px] rounded transition-all
                ${N.includes(f.id)?"font-semibold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:N.includes(f.id)?{color:f.color,background:`${f.color}15`}:{},children:f.label},f.id))]})]}),e.jsxs("div",{ref:o,className:"relative",style:{flex:"1 1 0%",minHeight:0,overflow:"hidden"},children:[x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.85)"},children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-[var(--gold)] border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-xs text-[var(--text-dim)]",children:["Cargando ",r,"..."]})]})}),j&&!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.9)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-[var(--red)] mb-2",children:j}),e.jsx("button",{onClick:()=>{v(null),w(!0)},className:"px-4 py-2 text-xs bg-[var(--gold)] text-white rounded-lg font-semibold",children:"Reintentar"})]})})]})]})}function jt(){const{selectedPair:o,currentPrice:s,positions:t,orders:a,addPosition:l,addOrder:i,closePosition:r,cancelOrder:n}=F(),[p,u]=b.useState("buy"),[c,g]=b.useState("market"),[x,w]=b.useState({quantity:"",price:"",stopLoss:"",takeProfit:""}),[j,v]=b.useState({bids:[],asks:[]}),[h,y]=b.useState("order");b.useEffect(()=>{k();const m=setInterval(k,5e3);return()=>clearInterval(m)},[o]);const k=async()=>{try{const m=await D.getOrderBook(o,10);v(m)}catch{}},d=()=>{if(!x.quantity)return;const m=c==="market"?s:parseFloat(x.price);m&&(c==="market"?l({symbol:o,side:p,quantity:parseFloat(x.quantity),entryPrice:m,stopLoss:x.stopLoss?parseFloat(x.stopLoss):null,takeProfit:x.takeProfit?parseFloat(x.takeProfit):null,openedAt:new Date().toISOString()}):i({symbol:o,side:p,type:c,quantity:parseFloat(x.quantity),price:m,stopLoss:x.stopLoss?parseFloat(x.stopLoss):null,takeProfit:x.takeProfit?parseFloat(x.takeProfit):null,status:"open",createdAt:new Date().toISOString()}),w({quantity:"",price:"",stopLoss:"",takeProfit:""}))},N=parseFloat(x.quantity||0)*(c==="market"?s||0:parseFloat(x.price||0));return e.jsxs("div",{className:"flex flex-col h-full",style:{width:320,borderLeft:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"flex shrink-0 px-2 pt-2 gap-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:["order","positions","orders"].map(m=>e.jsx("button",{onClick:()=>y(m),className:`flex-1 py-2.5 text-[11px] font-bold rounded-t-lg transition-all
              ${h===m?"text-[var(--gold)] bg-[var(--gold)]/[0.06]":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:h===m?{borderBottom:"2px solid var(--gold)"}:{borderBottom:"2px solid transparent"},children:m==="order"?"Orden":m==="positions"?`Pos (${t.length})`:`Ã“rd (${a.length})`},m))}),h==="order"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("button",{onClick:()=>u("buy"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${p==="buy"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:p==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 12px rgba(14,203,129,0.25)"}:{},children:"Comprar"}),e.jsx("button",{onClick:()=>u("sell"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${p==="sell"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:p==="sell"?{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 12px rgba(246,70,93,0.25)"}:{},children:"Vender"})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-lg bg-[var(--dark-3)]",children:["market","limit","stop_loss"].map(m=>e.jsx("button",{onClick:()=>g(m),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all
                  ${c===m?"bg-[var(--dark-4)] text-[var(--text)] shadow-sm":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:m==="market"?"Market":m==="limit"?"LÃ­mite":"Stop"},m))}),c!=="market"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio"}),e.jsx("input",{type:"number",value:x.price,onChange:m=>w({...x,price:m.target.value}),placeholder:s==null?void 0:s.toString(),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Cantidad"}),e.jsx("input",{type:"number",value:x.quantity,onChange:m=>w({...x,quantity:m.target.value}),placeholder:"0.001",className:"w-full text-sm"}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:["25%","50%","75%","100%"].map(m=>e.jsx("button",{className:"flex-1 py-1.5 text-[10px] font-semibold rounded-md text-[var(--text-dim)] hover:text-[var(--text)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:m},m))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(J,{size:9,className:"text-[var(--red)]"})," SL"]}),e.jsx("input",{type:"number",value:x.stopLoss,onChange:m=>w({...x,stopLoss:m.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(me,{size:9,className:"text-[var(--green)]"})," TP"]}),e.jsx("input",{type:"number",value:x.takeProfit,onChange:m=>w({...x,takeProfit:m.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg p-3 flex items-center justify-between",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-semibold uppercase tracking-wider",children:"Total"}),e.jsxs("span",{className:"text-sm font-mono font-bold",children:["$",N.toFixed(2)]})]}),e.jsxs("button",{onClick:d,disabled:!x.quantity,className:"w-full py-3.5 font-bold rounded-xl text-sm transition-all duration-200 disabled:opacity-40 text-white",style:p==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 15px rgba(14,203,129,0.25)"}:{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 15px rgba(246,70,93,0.25)"},children:[p==="buy"?"Comprar":"Vender"," ",o.replace("USDT","")]}),e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 font-bold uppercase tracking-wider",children:"Order Book"}),e.jsxs("div",{className:"space-y-[2px] text-[10px] font-mono",children:[j.asks.slice(0,5).reverse().map((m,S)=>e.jsxs("div",{className:"flex justify-between text-[var(--red)] py-0.5 px-1 rounded hover:bg-[var(--red)]/[0.04]",children:[e.jsxs("span",{children:["$",m.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:m.quantity.toFixed(4)})]},`a${S}`)),e.jsxs("div",{className:"text-center py-1.5 text-[15px] font-bold text-[var(--gold)] my-1",style:{background:"rgba(59,130,246,0.04)",borderRadius:"6px"},children:["$",(s==null?void 0:s.toLocaleString(void 0,{minimumFractionDigits:2}))||"---"]}),j.bids.slice(0,5).map((m,S)=>e.jsxs("div",{className:"flex justify-between text-[var(--green)] py-0.5 px-1 rounded hover:bg-[var(--green)]/[0.04]",children:[e.jsxs("span",{children:["$",m.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:m.quantity.toFixed(4)})]},`b${S}`))]})]})]}),h==="positions"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin posiciones abiertas"})]}):t.map(m=>{const S=m.side==="buy"?(s-m.entryPrice)*m.quantity:(m.entryPrice-s)*m.quantity;return e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:`1px solid ${S>=0?"rgba(14,203,129,0.1)":"rgba(246,70,93,0.1)"}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold",children:m.symbol}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-md ${m.side==="buy"?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:m.side.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-[var(--text-dim)] mb-2",children:[e.jsxs("span",{children:["Entrada: $",m.entryPrice]}),e.jsxs("span",{className:`font-bold ${S>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:["P&L: ",S>=0?"+":"","$",S.toFixed(2)]})]}),e.jsx("button",{onClick:()=>r(m.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cerrar PosiciÃ³n"})]},m.id)})}),h==="orders"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin Ã³rdenes pendientes"})]}):a.map(m=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:m.symbol}),e.jsxs("span",{className:`text-[10px] font-bold ${m.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:[m.side.toUpperCase()," ",m.type]})]}),e.jsxs("div",{className:"text-[10px] text-[var(--text-dim)] mb-2",children:["Precio: $",m.price," | Cantidad: ",m.quantity]}),e.jsx("button",{onClick:()=>n(m.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cancelar"})]},m.id))})]})}class yt{constructor(){this.connections=new Map}_decrypt(s){return{...s,apiKey:atob(s.apiKey),apiSecret:atob(s.apiSecret),passphrase:s.passphrase?atob(s.passphrase):void 0}}async _binanceRequest(s,t,a={}){const l=new URL(`${V.binance.baseUrl}${t}`);Object.entries(a).forEach(([r,n])=>l.searchParams.set(r,n));const i=await fetch(l.toString(),{headers:{"X-MBX-APIKEY":s.apiKey}});if(!i.ok)throw new Error(`Binance API error: ${i.status}`);return i.json()}async connect(s){const t=this._decrypt(s),a=V[s.brokerId];if(!a)throw new Error(`Unsupported broker: ${s.brokerId}`);try{switch(s.brokerId){case"binance":await this._binanceRequest(t,"/api/v3/ping");break;default:await fetch(a.baseUrl)}return this.connections.set(s.id,{creds:t,config:a,connected:!0}),{success:!0,message:`Connected to ${a.name}`}}catch(l){return{success:!1,message:l.message}}}async getBalances(s){if(!this.connections.get(s))throw new Error("Broker not connected");return[{asset:"BTC",free:"0.5432",locked:"0.0000"},{asset:"ETH",free:"12.3456",locked:"0.0000"},{asset:"USDT",free:"15000.00",locked:"500.00"},{asset:"BNB",free:"25.00",locked:"0.0000"},{asset:"SOL",free:"100.00",locked:"0.0000"}]}async placeOrder(s,t){const a=this.connections.get(s);if(!a)throw new Error("Broker not connected");const{symbol:l,side:i,type:r,quantity:n,price:p,stopLoss:u,takeProfit:c}=t;if(!l||!i||!r||!n)throw new Error("Missing required order fields");return{id:Date.now().toString(36),symbol:l,side:i,type:r,quantity:parseFloat(n),price:p?parseFloat(p):null,stopLoss:u?parseFloat(u):null,takeProfit:c?parseFloat(c):null,status:r==="market"?"filled":"open",filledPrice:r==="market"?parseFloat(p||0):null,timestamp:new Date().toISOString(),broker:a.config.name}}async cancelOrder(s,t){if(!this.connections.get(s))throw new Error("Broker not connected");return{success:!0,orderId:t}}async getOpenOrders(s,t){if(!this.connections.get(s))throw new Error("Broker not connected");return[]}async getPositions(s){if(!this.connections.get(s))throw new Error("Broker not connected");return[]}disconnect(s){this.connections.delete(s)}}const ye=new yt;class Nt{constructor(){this.activeBots=new Map,this.intervals=new Map}async startBot(s,t,a){if(this.activeBots.has(s.id))return;a==null||a(`ðŸ¤– Bot "${s.name}" iniciado en ${s.pair}`),this.activeBots.set(s.id,{bot:s,running:!0});const l=this._getCheckInterval(s.timeframe),i=async()=>{var n;if((n=this.activeBots.get(s.id))!=null&&n.running)try{const p=await D.getCandles(s.pair,s.timeframe,100),u=p.map(x=>x.close),c=u[u.length-1],g=this._evaluateStrategy(s.strategy,p,u);if(g){a==null||a(`ðŸ“Š SeÃ±al detectada: ${g.type.toUpperCase()} a $${c}`);const x=this._calculatePositionSize(s,c),w={symbol:s.pair,side:g.type,type:"market",quantity:x,price:c,stopLoss:g.type==="buy"?c*(1-parseFloat(s.strategy.stopLoss)/100):c*(1+parseFloat(s.strategy.stopLoss)/100),takeProfit:g.type==="buy"?c*(1+parseFloat(s.strategy.takeProfit)/100):c*(1-parseFloat(s.strategy.takeProfit)/100)};t==null||t(w),a==null||a(`âœ… Orden ejecutada: ${g.type.toUpperCase()} ${x} ${s.pair} @ $${c}`)}}catch(p){a==null||a(`âŒ Error: ${p.message}`)}};await i();const r=setInterval(i,l);this.intervals.set(s.id,r)}stopBot(s){const t=this.activeBots.get(s);t&&(t.running=!1,this.activeBots.delete(s));const a=this.intervals.get(s);a&&(clearInterval(a),this.intervals.delete(s))}_evaluateStrategy(s,t,a){var r,n,p,u,c,g,x,w,j,v,h,y;if(!((r=s==null?void 0:s.entry)!=null&&r.indicator))return null;const l=a.length,i=s.entry.indicator;switch(i){case"ema_cross":case"ema_cross_rsi":{const k=((n=s.entry.params)==null?void 0:n.fastEma)||((p=s.entry.params)==null?void 0:p.fast)||20,d=((u=s.entry.params)==null?void 0:u.slowEma)||((c=s.entry.params)==null?void 0:c.slow)||50,N=K(a,k),m=K(a,d),S=ne(N,m,l-1);if(i==="ema_cross_rsi"){const M=((g=s.entry.params)==null?void 0:g.rsiPeriod)||14,B=ie(a,M)[l-1],P=((x=s.entry.params)==null?void 0:x.rsiOversold)||30,$=((j=(w=s.exit)==null?void 0:w.params)==null?void 0:j.rsiOverbought)||70;if(S==="bullish_cross"&&B<P)return{type:"buy"};if(S==="bearish_cross"&&B>$)return{type:"sell"};if(B>$)return{type:"sell"};if(B<P)return{type:"buy"}}else{if(S==="bullish_cross")return{type:"buy"};if(S==="bearish_cross")return{type:"sell"}}break}case"rsi":{const k=((v=s.entry.params)==null?void 0:v.period)||14,N=ie(a,k)[l-1];if(N<(((h=s.entry.params)==null?void 0:h.oversold)||30))return{type:"buy"};if(N>(((y=s.entry.params)==null?void 0:y.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:k,signal:d}=Ae(a),N=ne(k,d,l-1);if(N==="bullish_cross")return{type:"buy"};if(N==="bearish_cross")return{type:"sell"};break}default:return null}return null}_calculatePositionSize(s,t){const a=s.balance||1e3,l=parseFloat(s.riskPercent||2)/100,i=a*l/t;return Math.round(i*1e8)/1e8}_getCheckInterval(s){return{"1m":6e4,"5m":3e5,"15m":9e5,"1h":3e5,"4h":9e5,"1d":36e5}[s]||3e5}getActiveBotCount(){return this.activeBots.size}}const ae=new Nt;function wt(){const{bots:o,addBot:s,updateBot:t,removeBot:a,strategies:l,brokers:i}=F(),[r,n]=b.useState(!1),[p,u]=b.useState([]),[c,g]=b.useState({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10"}),x=()=>{if(!c.name||!c.pair)return;const d=l.find(N=>N.id===c.strategyId)||{name:"EMA Cross + RSI",entry:{condition:"EMA 20 cruza EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"};s({name:c.name,pair:c.pair,timeframe:c.timeframe,strategy:d,brokerId:c.brokerId,balance:parseFloat(c.balance),riskPercent:parseFloat(c.riskPercent),maxTrades:parseInt(c.maxTrades)}),g({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10"}),n(!1)},w=async d=>{t(d.id,{status:"active"}),ae.startBot({...d,status:"active"},N=>{u(m=>[...m,{type:"trade",bot:d.name,...N,time:new Date().toLocaleTimeString()}])},N=>{u(m=>[...m,{type:"log",bot:d.name,message:N,time:new Date().toLocaleTimeString()}])})},j=d=>{ae.stopBot(d.id),t(d.id,{status:"paused"})},v=d=>{ae.stopBot(d.id),t(d.id,{status:"stopped"})},h=d=>{ae.stopBot(d.id),a(d.id)},y=d=>{switch(d){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},k=d=>{switch(d){case"active":return"Activo";case"paused":return"Pausado";case"stopped":return"Detenido";case"error":return"Error";default:return d}};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[o.filter(d=>d.status==="active").length," activos de ",o.length," total"]})]}),e.jsxs("button",{onClick:()=>n(!r),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-white font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(oe,{size:16})," Crear Bot"]})]}),e.jsx(U,{children:r&&e.jsx(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Nuevo Bot de Trading"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Nombre del Bot"}),e.jsx("input",{value:c.name,onChange:d=>g({...c,name:d.target.value}),placeholder:"Mi Bot BTC",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Par"}),e.jsx("select",{value:c.pair,onChange:d=>g({...c,pair:d.target.value}),className:"w-full",children:he.map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Timeframe"}),e.jsx("select",{value:c.timeframe,onChange:d=>g({...c,timeframe:d.target.value}),className:"w-full",children:ge.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Balance Asignado ($)"}),e.jsx("input",{type:"number",value:c.balance,onChange:d=>g({...c,balance:d.target.value}),placeholder:"1000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo por Trade (%)"}),e.jsx("input",{type:"number",value:c.riskPercent,onChange:d=>g({...c,riskPercent:d.target.value}),placeholder:"2",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"MÃ¡x. Trades por DÃ­a"}),e.jsx("input",{type:"number",value:c.maxTrades,onChange:d=>g({...c,maxTrades:d.target.value}),placeholder:"10",className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"Estrategia Predeterminada"}),e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"EMA Cross + RSI"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Compra: EMA 20 cruza EMA 50 + RSI < 30 | Venta: RSI > 70 | SL: 2% | TP: 4%"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"flex-1 py-2.5 bg-[var(--gold)] text-white font-bold rounded-xl text-sm hover:bg-[var(--gold-light)] transition-colors",children:"Crear Bot"}),e.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm",children:"Cancelar"})]})]})})}),o.length===0?e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-12 text-center",children:[e.jsx(Y,{size:48,className:"text-[var(--text-dim)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay bots creados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primer bot para automatizar tu trading"})]}):e.jsx("div",{className:"space-y-3",children:o.map(d=>{var N;return e.jsxs(C.div,{layout:!0,className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[var(--dark-3)] flex items-center justify-center",children:e.jsx(Y,{size:20,style:{color:y(d.status)}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:d.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[d.pair," â€¢ ",d.timeframe]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold",style:{color:y(d.status),background:`${y(d.status)}20`},children:k(d.status)})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Trades"}),e.jsx("p",{className:"text-sm font-bold",children:d.trades||0})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`text-sm font-bold ${(d.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(d.pnl||0)>=0?"+":"","$",(d.pnl||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-sm font-bold",children:[(d.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold",children:["$",(N=d.balance)==null?void 0:N.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[d.status!=="active"?e.jsxs("button",{onClick:()=>w(d),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold hover:bg-[var(--green)]/30 transition-colors",children:[e.jsx(ee,{size:12})," Iniciar"]}):e.jsxs("button",{onClick:()=>j(d),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(qe,{size:12})," Pausar"]}),e.jsxs("button",{onClick:()=>v(d),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Ue,{size:12})," Detener"]}),e.jsxs("button",{onClick:()=>h(d),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] hover:text-[var(--red)] rounded-lg text-xs transition-colors",children:[e.jsx(te,{size:12})," Eliminar"]})]})]},d.id)})}),p.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-[var(--border)]",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Actividad en Vivo"}),e.jsx("button",{onClick:()=>u([]),className:"text-xs text-[var(--text-dim)]",children:"Limpiar"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-3 space-y-1 font-mono text-xs",children:p.slice(-50).reverse().map((d,N)=>{var m;return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:d.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0",children:["[",d.bot,"]"]}),e.jsx("span",{className:"text-[var(--text)]",children:d.message||`${(m=d.side)==null?void 0:m.toUpperCase()} ${d.quantity} @ $${d.price}`})]},N)})})]})]})}function kt(){var k;const{brokers:o,addBroker:s,removeBroker:t,updateBrokerStatus:a,setActiveBroker:l}=F(),[i,r]=b.useState(!1),[n,p]=b.useState({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),[u,c]=b.useState(!1),[g,x]=b.useState(null),[w,j]=b.useState(""),v=()=>{if(j(""),!n.apiKey||!n.apiSecret){j("API Key y Secret son obligatorios");return}const d=V[n.brokerId];if(d.requiredFields.includes("passphrase")&&!n.passphrase){j("Este broker requiere Passphrase");return}s({brokerId:n.brokerId,label:n.label||d.name,apiKey:n.apiKey,apiSecret:n.apiSecret,passphrase:n.passphrase}),p({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),r(!1)},h=async d=>{x(d.id);const N=await ye.connect(d);a(d.id,N.success),N.success&&l(d),x(null)},y=d=>{ye.disconnect(d),t(d)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Brokers Conectados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Conecta tu broker para ejecutar trades automÃ¡ticamente"})]}),e.jsxs("button",{onClick:()=>r(!i),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-white font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(oe,{size:16})," Agregar Broker"]})]}),e.jsxs("div",{className:"bg-[var(--gold)]/5 border border-[var(--gold)]/20 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(J,{size:20,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"Tus API Keys estÃ¡n seguras"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:["Las claves se almacenan encriptadas localmente. Kairos Trade solo necesita permisos de lectura y trading.",e.jsx("strong",{className:"text-[var(--text)]",children:" Nunca actives permisos de retiro."})]})]})]}),e.jsx(U,{children:i&&e.jsx(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Nuevo Broker"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(V).map(d=>e.jsxs("button",{onClick:()=>p({...n,brokerId:d.id}),className:`p-3 rounded-xl border text-center transition-all
                      ${n.brokerId===d.id?"border-[var(--gold)] bg-[var(--gold)]/10":"border-[var(--border)] hover:border-[var(--gold)]/30"}`,children:[e.jsx("span",{className:"text-2xl",children:d.logo}),e.jsx("p",{className:"text-sm font-bold mt-1",children:d.name}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:d.supportedMarkets.join(", ")})]},d.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Etiqueta (opcional)"}),e.jsx("input",{value:n.label,onChange:d=>p({...n,label:d.target.value}),placeholder:"Mi cuenta Binance",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"API Key"}),e.jsx("input",{value:n.apiKey,onChange:d=>p({...n,apiKey:d.target.value}),placeholder:"Tu API Key",className:"w-full font-mono text-xs"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"API Secret"}),e.jsx("input",{type:u?"text":"password",value:n.apiSecret,onChange:d=>p({...n,apiSecret:d.target.value}),placeholder:"Tu API Secret",className:"w-full font-mono text-xs pr-10"}),e.jsx("button",{onClick:()=>c(!u),className:"absolute right-3 top-7 text-[var(--text-dim)]",children:u?e.jsx(Se,{size:14}):e.jsx(Pe,{size:14})})]}),((k=V[n.brokerId])==null?void 0:k.requiredFields.includes("passphrase"))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Passphrase"}),e.jsx("input",{type:"password",value:n.passphrase,onChange:d=>p({...n,passphrase:d.target.value}),placeholder:"Passphrase",className:"w-full font-mono text-xs"})]})]}),w&&e.jsx("p",{className:"text-xs text-[var(--red)]",children:w}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,className:"flex-1 py-2.5 bg-[var(--gold)] text-white font-bold rounded-xl text-sm hover:bg-[var(--gold-light)] transition-colors",children:"Guardar Broker"}),e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm hover:bg-[var(--dark-4)] transition-colors",children:"Cancelar"})]})]})})}),o.length===0?e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-12 text-center",children:[e.jsx(ue,{size:48,className:"text-[var(--text-dim)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay brokers conectados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Agrega tu primer broker para empezar a operar"})]}):e.jsx("div",{className:"space-y-3",children:o.map(d=>{const N=V[d.brokerId];return e.jsxs(C.div,{layout:!0,className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:(N==null?void 0:N.logo)||"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:d.label}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[N==null?void 0:N.name," â€¢ API: ",atob(d.apiKey).slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.connected?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--green)]",children:[e.jsx(pe,{size:14})," Conectado"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--text-dim)]",children:[e.jsx(He,{size:14})," Desconectado"]}),e.jsx("button",{onClick:()=>h(d),disabled:g===d.id,className:"px-3 py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors disabled:opacity-50",children:g===d.id?"...":d.connected?"Reconectar":"Conectar"}),e.jsx("button",{onClick:()=>y(d.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(te,{size:14})})]})]},d.id)})})]})}const St=`Eres Kairos AI, el asistente de trading mÃ¡s avanzado del mundo.
Eres parte de Kairos Trade, la plataforma de trading automatizado de Kairos 777 Inc.

Tu especialidad:
- AnÃ¡lisis tÃ©cnico (EMA, RSI, MACD, Bollinger Bands, VWAP, estructura de mercado)
- GeneraciÃ³n de estrategias de trading automÃ¡ticas
- AnÃ¡lisis de sentimiento del mercado
- GestiÃ³n de riesgo
- EducaciÃ³n en trading

Reglas:
- Responde en espaÃ±ol siempre
- SÃ© directo, conciso y profesional
- Cuando generes estrategias, usa formato JSON estructurado
- Nunca des consejos financieros personales â€” eres una herramienta de anÃ¡lisis
- Si te piden una estrategia, incluye SIEMPRE: entry, exit, stopLoss, takeProfit, timeframe
- Usa datos tÃ©cnicos reales cuando los tengas disponibles

Cuando generes una estrategia, responde con un bloque JSON asÃ­:
\`\`\`strategy
{
  "name": "Nombre de la estrategia",
  "pair": "BTCUSDT",
  "timeframe": "1h",
  "entry": { "condition": "EMA 20 cruza por encima de EMA 50", "indicator": "ema_cross", "params": { "fast": 20, "slow": 50 } },
  "exit": { "condition": "RSI > 70", "indicator": "rsi", "params": { "period": 14, "threshold": 70 } },
  "stopLoss": "1.5%",
  "takeProfit": "3%",
  "riskReward": "1:2"
}
\`\`\``;class Pt{constructor(){this.apiKey=null,this.model="gpt-4o-mini",this.conversationHistory=[]}setApiKey(s){this.apiKey=s}async chat(s,t=null){var l;let a=s;if(t&&(a+=`

[Datos del mercado actual]
Par: ${t.symbol}
Precio: $${t.price}
Cambio 24h: ${t.changePercent}%
Volumen: ${t.volume}
MÃ¡ximo 24h: $${t.high}
MÃ­nimo 24h: $${t.low}`),this.conversationHistory.push({role:"user",content:a}),!this.apiKey)return this._localAnalysis(s,t);try{const i=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"system",content:St},...this.conversationHistory.slice(-20)],temperature:.7,max_tokens:1e3})});if(!i.ok){const p=await i.json();throw new Error(((l=p.error)==null?void 0:l.message)||"API error")}const r=await i.json(),n=r.choices[0].message.content;return this.conversationHistory.push({role:"assistant",content:n}),{text:n,strategy:this._extractStrategy(n),usage:r.usage}}catch(i){return console.error("AI error:",i),this._localAnalysis(s,t)}}_localAnalysis(s,t){var i,r,n,p;const a=s.toLowerCase();if(a.includes("estrategia")||a.includes("strategy")){const u=(t==null?void 0:t.symbol)||"BTCUSDT",c={name:`Kairos Auto Strategy â€” ${u}`,pair:u,timeframe:"1h",entry:{condition:"EMA 20 cruza por encima de EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70 o EMA 20 cruza por debajo de EMA 50",indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:"2%",takeProfit:"4%",riskReward:"1:2"},g=`ðŸ“Š **Estrategia generada para ${u}**

**Entrada:** ${c.entry.condition}
**Salida:** ${c.exit.condition}
**Stop Loss:** ${c.stopLoss}
**Take Profit:** ${c.takeProfit}
**Risk/Reward:** ${c.riskReward}

Puedes activar esta estrategia desde el panel de bots.`;return this.conversationHistory.push({role:"assistant",content:g}),{text:g,strategy:c}}if(a.includes("analiz")||a.includes("mercado")||a.includes("market")||a.includes("cÃ³mo ves")){let u="";if(t){const c=t.changePercent>0?"alcista":t.changePercent<-0?"bajista":"lateral",g=Math.abs(t.changePercent),x=g>3?"fuerte":g>1?"moderado":"dÃ©bil";u=`ðŸ“ˆ **AnÃ¡lisis de ${t.symbol}**

**Precio:** $${(i=t.price)==null?void 0:i.toLocaleString()}
**Tendencia 24h:** ${c} (${t.changePercent>0?"+":""}${(r=t.changePercent)==null?void 0:r.toFixed(2)}%)
**Momentum:** ${x}
**Rango 24h:** $${(n=t.low)==null?void 0:n.toLocaleString()} â€” $${(p=t.high)==null?void 0:p.toLocaleString()}
**Volumen:** $${(t.quoteVolume/1e6).toFixed(1)}M

`+(t.changePercent>2?`âš¡ El mercado muestra fuerza compradora. Considerar compras en retrocesos.
`:t.changePercent<-2?`âš ï¸ PresiÃ³n vendedora activa. Esperar confirmaciÃ³n de soporte.
`:`ðŸ“Š Mercado en consolidaciÃ³n. Esperar ruptura para tomar posiciÃ³n.
`)+`
ðŸ’¡ RecomendaciÃ³n: ${c==="alcista"?"Buscar entradas en pullbacks al EMA 20.":c==="bajista"?"PrecauciÃ³n. Esperar divergencia RSI para posible reversal.":"Operar rango â€” comprar soporte, vender resistencia."}`}else u="ðŸ“Š Necesito datos del mercado para analizar. Selecciona un par de trading primero.";return this.conversationHistory.push({role:"assistant",content:u}),{text:u,strategy:null}}const l=`ðŸ¤– Soy **Kairos AI**, tu asistente de trading.

Puedo ayudarte con:
â€¢ **"Analiza BTC"** â€” AnÃ¡lisis tÃ©cnico del mercado
â€¢ **"Dame una estrategia para ETHUSDT"** â€” Generar estrategia automÃ¡tica
â€¢ **"Â¿CÃ³mo ves el mercado?"** â€” VisiÃ³n general
â€¢ **"Configura un bot"** â€” Ayuda con automatizaciÃ³n

Â¿En quÃ© te puedo ayudar?`;return this.conversationHistory.push({role:"assistant",content:l}),{text:l,strategy:null}}_extractStrategy(s){const t=s.match(/```strategy\n([\s\S]*?)```/);if(t)try{return JSON.parse(t[1])}catch{return null}return null}clearHistory(){this.conversationHistory=[]}}const Te=new Pt;function Ne(){const{aiMessages:o,addAiMessage:s,aiLoading:t,setAiLoading:a,clearAiMessages:l,currentPrice:i,selectedPair:r,priceChange24h:n}=F(),[p,u]=b.useState(""),c=b.useRef(null);b.useEffect(()=>{var j;(j=c.current)==null||j.scrollIntoView({behavior:"smooth"})},[o]);const g=async()=>{if(!p.trim()||t)return;const j={role:"user",content:p.trim(),time:new Date().toLocaleTimeString()};s(j),u(""),a(!0);try{const v=i?{symbol:r,price:i,changePercent:n,high:i*1.02,low:i*.98,volume:0,quoteVolume:0}:null,h=await Te.chat(p.trim(),v);s({role:"assistant",content:h.text,strategy:h.strategy,time:new Date().toLocaleTimeString()})}catch(v){s({role:"assistant",content:`âŒ Error: ${v.message}`,time:new Date().toLocaleTimeString()})}a(!1)},x=[{label:"Analiza el mercado",icon:W,prompt:`Analiza ${r} ahora mismo`},{label:"Dame una estrategia",icon:q,prompt:`Dame una estrategia de trading para ${r}`},{label:"Â¿CÃ³mo ves BTC?",icon:le,prompt:"Â¿CÃ³mo ves Bitcoin hoy?"}],w=(j,v)=>{const h=j.role==="user";return e.jsx(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${h?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl p-3 ${h?"bg-[var(--gold)] text-white rounded-br-md":"bg-[var(--dark-3)] text-[var(--text)] rounded-bl-md"}`,children:[!h&&e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(X,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:j.content.split(`
`).map((y,k)=>y.startsWith("**")&&y.endsWith("**")?e.jsx("p",{className:"font-bold my-0.5",children:y.replace(/\*\*/g,"")},k):y.startsWith("â€¢")||y.startsWith("-")?e.jsx("p",{className:"ml-2",children:y},k):e.jsx("p",{children:y},k))}),j.strategy&&e.jsxs("div",{className:"mt-2 p-2 bg-[var(--dark-4)] rounded-xl border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(q,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Estrategia Lista"})]}),e.jsx("p",{className:"text-xs",children:j.strategy.name||"Auto Strategy"}),e.jsx("button",{onClick:()=>{F.getState().addStrategy(j.strategy),s({role:"assistant",content:"âœ… Estrategia guardada. Puedes activarla desde el panel de Bots.",time:new Date().toLocaleTimeString()})},className:"mt-1 px-3 py-1 bg-[var(--gold)] text-white text-xs font-bold rounded-lg",children:"Activar Estrategia"})]}),e.jsx("p",{className:`text-[10px] mt-1 ${h?"text-white/60":"text-[var(--text-dim)]"}`,children:j.time})]})},v)};return e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)]/20 flex items-center justify-center",children:e.jsx(X,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold",children:"Kairos AI"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Asistente de trading inteligente"})]})]}),e.jsx("button",{onClick:l,className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(te,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(X,{size:48,className:"text-[var(--gold)] mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Kairos AI"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-6 max-w-xs",children:"Tu asistente de trading con inteligencia artificial. PregÃºntame cualquier cosa sobre el mercado."}),e.jsx("div",{className:"space-y-2 w-full max-w-xs",children:x.map((j,v)=>{const h=j.icon;return e.jsxs("button",{onClick:()=>{u(j.prompt)},className:"w-full flex items-center gap-2 p-3 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl text-sm hover:border-[var(--gold)]/30 transition-colors text-left",children:[e.jsx(h,{size:16,className:"text-[var(--gold)] shrink-0"}),j.label]},v)})})]}),o.map(w),t&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-2xl rounded-bl-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"300ms"}})]})]})}),e.jsx("div",{ref:c})]}),e.jsx("div",{className:"p-3 border-t border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:p,onChange:j=>u(j.target.value),onKeyDown:j=>j.key==="Enter"&&g(),placeholder:"Pregunta sobre el mercado, pide estrategias...",className:"flex-1 text-sm"}),e.jsx("button",{onClick:g,disabled:!p.trim()||t,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:e.jsx(Ve,{size:16})})]})})]})}const Ct=[{name:"EMA Cross Classic",description:"Cruces de EMA rÃ¡pida/lenta â€” Tendencia",entry:{condition:"EMA 20 cruza por encima de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},exit:{condition:"EMA 20 cruza por debajo de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},stopLoss:"2",takeProfit:"4"},{name:"RSI Reversal",description:"Compra en sobreventa, vende en sobrecompra",entry:{condition:"RSI < 30 (sobreventa)",indicator:"rsi",params:{period:14,oversold:30}},exit:{condition:"RSI > 70 (sobrecompra)",indicator:"rsi",params:{period:14,overbought:70}},stopLoss:"1.5",takeProfit:"3"},{name:"MACD Momentum",description:"Cruce de lÃ­nea MACD y seÃ±al",entry:{condition:"MACD cruza por encima de seÃ±al",indicator:"macd_cross",params:{fast:12,slow:26,signal:9}},exit:{condition:"MACD cruza por debajo de seÃ±al",indicator:"macd_cross",params:{}},stopLoss:"2",takeProfit:"4"},{name:"Bollinger Bounce",description:"Compra en banda inferior, vende en superior",entry:{condition:"Precio toca Bollinger Band inferior",indicator:"bb_bounce",params:{period:20,stdDev:2}},exit:{condition:"Precio toca Bollinger Band superior",indicator:"bb_bounce",params:{}},stopLoss:"1",takeProfit:"2"},{name:"EMA + RSI Combo",description:"MÃ¡s preciso: cruces de EMA confirmados con RSI",entry:{condition:"EMA 20 > EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"}];function At(){const{strategies:o,addStrategy:s,removeStrategy:t,setPage:a}=F(),[l,i]=b.useState(!1),[r,n]=b.useState({name:"",pair:"BTCUSDT",timeframe:"1h",entryIndicator:"ema_cross",entryCondition:"",exitIndicator:"rsi",exitCondition:"",stopLoss:"2",takeProfit:"4"}),p=c=>{s({...c,pair:"BTCUSDT",timeframe:"1h"})},u=()=>{r.name&&(s({name:r.name,pair:r.pair,timeframe:r.timeframe,entry:{condition:r.entryCondition||`${r.entryIndicator} signal`,indicator:r.entryIndicator,params:{}},exit:{condition:r.exitCondition||`${r.exitIndicator} signal`,indicator:r.exitIndicator,params:{}},stopLoss:r.stopLoss,takeProfit:r.takeProfit}),n({name:"",pair:"BTCUSDT",timeframe:"1h",entryIndicator:"ema_cross",entryCondition:"",exitIndicator:"rsi",exitCondition:"",stopLoss:"2",takeProfit:"4"}),i(!1))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Estrategias de Trading"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Crea, gestiona y aplica estrategias a tus bots"})]}),e.jsxs("button",{onClick:()=>i(!l),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-white font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(oe,{size:16})," Crear Estrategia"]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold mb-3",children:"Plantillas Predefinidas"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Ct.map((c,g)=>e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:g*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{size:16,className:"text-[var(--gold)]"}),e.jsx("h3",{className:"text-sm font-bold",children:c.name})]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:c.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--green)]",children:"â–²"})," ",c.entry.condition]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--red)]",children:"â–¼"})," ",c.exit.condition]}),e.jsxs("p",{className:"text-[var(--text-dim)]",children:["SL: ",c.stopLoss,"% | TP: ",c.takeProfit,"%"]})]}),e.jsx("button",{onClick:()=>p(c),className:"w-full py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:"Usar Plantilla"})]},c.name))})]}),e.jsx(U,{children:l&&e.jsx(C.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Crear Estrategia Personalizada"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Nombre"}),e.jsx("input",{value:r.name,onChange:c=>n({...r,name:c.target.value}),placeholder:"Mi estrategia",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Par"}),e.jsx("select",{value:r.pair,onChange:c=>n({...r,pair:c.target.value}),className:"w-full",children:he.map(c=>e.jsx("option",{children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Timeframe"}),e.jsx("select",{value:r.timeframe,onChange:c=>n({...r,timeframe:c.target.value}),className:"w-full",children:ge.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-bold text-[var(--green)] mb-2",children:"â–² CondiciÃ³n de Entrada"}),e.jsxs("select",{value:r.entryIndicator,onChange:c=>n({...r,entryIndicator:c.target.value}),className:"w-full mb-2 text-sm",children:[e.jsx("option",{value:"ema_cross",children:"EMA Cross"}),e.jsx("option",{value:"rsi",children:"RSI"}),e.jsx("option",{value:"macd_cross",children:"MACD Cross"}),e.jsx("option",{value:"ema_cross_rsi",children:"EMA + RSI Combo"}),e.jsx("option",{value:"bb_bounce",children:"Bollinger Bounce"})]}),e.jsx("input",{value:r.entryCondition,onChange:c=>n({...r,entryCondition:c.target.value}),placeholder:"Describe la condiciÃ³n...",className:"w-full text-xs"})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-bold text-[var(--red)] mb-2",children:"â–¼ CondiciÃ³n de Salida"}),e.jsxs("select",{value:r.exitIndicator,onChange:c=>n({...r,exitIndicator:c.target.value}),className:"w-full mb-2 text-sm",children:[e.jsx("option",{value:"rsi",children:"RSI"}),e.jsx("option",{value:"ema_cross",children:"EMA Cross"}),e.jsx("option",{value:"macd_cross",children:"MACD Cross"})]}),e.jsx("input",{value:r.exitCondition,onChange:c=>n({...r,exitCondition:c.target.value}),placeholder:"Describe la condiciÃ³n...",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Stop Loss (%)"}),e.jsx("input",{type:"number",value:r.stopLoss,onChange:c=>n({...r,stopLoss:c.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Take Profit (%)"}),e.jsx("input",{type:"number",value:r.takeProfit,onChange:c=>n({...r,takeProfit:c.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"flex-1 py-2.5 bg-[var(--gold)] text-white font-bold rounded-xl text-sm",children:"Crear Estrategia"}),e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm",children:"Cancelar"})]})]})})}),o.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold mb-3",children:["Mis Estrategias (",o.length,")"]}),e.jsx("div",{className:"space-y-2",children:o.map(c=>{var g;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:c.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[(g=c.entry)==null?void 0:g.condition," | SL: ",c.stopLoss,"% | TP: ",c.takeProfit,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a("bots"),className:"px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold",children:[e.jsx(ee,{size:12,className:"inline mr-1"})," Usar en Bot"]}),e.jsx("button",{onClick:()=>t(c.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)]",children:e.jsx(te,{size:14})})]})]},c.id)})})]})]})}function Tt(){const{tradeHistory:o,positions:s}=F(),[t,a]=b.useState("open"),l=o.reduce((n,p)=>n+(p.pnl||0),0),i=o.filter(n=>(n.pnl||0)>0).length,r=o.length>0?i/o.length*100:0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Historial de Trading"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[o.length," trades cerrados â€¢ ",s.length," posiciones abiertas"]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:[e.jsx(We,{size:14})," Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-bold",children:o.length})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L Total"}),e.jsxs("p",{className:`text-lg font-bold ${l>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[l>=0?"+":"","$",l.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[r.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Posiciones Abiertas"}),e.jsx("p",{className:"text-lg font-bold text-[var(--blue)]",children:s.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>a("open"),className:`px-4 py-1.5 text-sm rounded-md ${t==="open"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Abiertas (",s.length,")"]}),e.jsxs("button",{onClick:()=>a("closed"),className:`px-4 py-1.5 text-sm rounded-md ${t==="closed"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Cerradas (",o.length,")"]})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-[var(--text-dim)] text-xs",children:[e.jsx("th",{className:"text-left p-3",children:"Par"}),e.jsx("th",{className:"text-left p-3",children:"Lado"}),e.jsx("th",{className:"text-right p-3",children:"Entrada"}),e.jsx("th",{className:"text-right p-3",children:"Cantidad"}),e.jsx("th",{className:"text-right p-3",children:"P&L"}),e.jsx("th",{className:"text-right p-3",children:"Fecha"})]})}),e.jsx("tbody",{children:(t==="open"?s:o).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-[var(--text-dim)]",children:t==="open"?"Sin posiciones abiertas":"Sin trades cerrados"})}):(t==="open"?s:o).map((n,p)=>{var u,c;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--dark-3)] transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:n.symbol}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold
                    ${n.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:(u=n.side)==null?void 0:u.toUpperCase()})}),e.jsxs("td",{className:"p-3 text-right font-mono",children:["$",(c=n.entryPrice)==null?void 0:c.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right font-mono",children:n.quantity}),e.jsxs("td",{className:`p-3 text-right font-mono font-bold ${(n.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(n.pnl||0)>=0?"+":"","$",(n.pnl||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-right text-xs text-[var(--text-dim)]",children:new Date(n.openedAt||n.closedAt).toLocaleDateString()})]},n.id||p)})})]})})]})}const we="kairos_trade_simulator";class Bt{constructor(){this.state=this._load()}_load(){try{const s=JSON.parse(localStorage.getItem(we));if(s)return s}catch{}return this._defaultState()}_defaultState(){return{balance:1e4,initialBalance:1e4,positions:[],closedTrades:[],orders:[],equity:1e4,stats:{totalTrades:0,wins:0,losses:0,totalPnl:0,bestTrade:0,worstTrade:0,avgWin:0,avgLoss:0,maxDrawdown:0,sharpeRatio:0},equityHistory:[{time:Date.now(),value:1e4}],createdAt:new Date().toISOString()}}_save(){localStorage.setItem(we,JSON.stringify(this.state))}reset(s=1e4){return this.state=this._defaultState(),this.state.balance=s,this.state.initialBalance=s,this.state.equity=s,this.state.equityHistory=[{time:Date.now(),value:s}],this._save(),this.state}async openPosition(s,t,a,l={}){const i=await D.getPrice(s),r=i*a;if(r>this.state.balance)throw new Error(`Fondos insuficientes. Necesitas $${r.toFixed(2)}, tienes $${this.state.balance.toFixed(2)}`);const n={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),symbol:s,side:t,quantity:a,entryPrice:i,currentPrice:i,cost:r,pnl:0,pnlPercent:0,stopLoss:l.stopLoss||null,takeProfit:l.takeProfit||null,leverage:l.leverage||1,openedAt:new Date().toISOString()};return this.state.balance-=r,this.state.positions.push(n),this._save(),{success:!0,position:n,message:`${t.toUpperCase()} ${a} ${s} @ $${i.toFixed(2)}`}}async closePosition(s){const t=this.state.positions.findIndex(p=>p.id===s);if(t===-1)throw new Error("PosiciÃ³n no encontrada");const a=this.state.positions[t],l=await D.getPrice(a.symbol),i=a.side==="buy"?(l-a.entryPrice)*a.quantity*a.leverage:(a.entryPrice-l)*a.quantity*a.leverage,r=i/a.cost*100,n={...a,exitPrice:l,pnl:i,pnlPercent:r,closedAt:new Date().toISOString(),duration:Date.now()-new Date(a.openedAt).getTime()};return this.state.balance+=a.cost+i,this.state.positions.splice(t,1),this.state.closedTrades.push(n),this._updateStats(i),this._save(),{success:!0,trade:n,message:`Cerrada: ${i>=0?"+":""}$${i.toFixed(2)} (${r.toFixed(1)}%)`}}async placeLimitOrder(s,t,a,l,i={}){const r=await D.getPrice(s),n={id:Date.now().toString(36),symbol:s,side:t,quantity:a,targetPrice:l,currentPrice:r,type:"limit",stopLoss:i.stopLoss||null,takeProfit:i.takeProfit||null,status:"pending",createdAt:new Date().toISOString()};return this.state.orders.push(n),this._save(),{success:!0,order:n}}cancelOrder(s){return this.state.orders=this.state.orders.filter(t=>t.id!==s),this._save(),{success:!0}}async updatePositions(){let s=this.state.balance;for(const t of this.state.positions)try{const a=await D.getPrice(t.symbol);if(t.currentPrice=a,t.pnl=t.side==="buy"?(a-t.entryPrice)*t.quantity*(t.leverage||1):(t.entryPrice-a)*t.quantity*(t.leverage||1),t.pnlPercent=t.pnl/t.cost*100,s+=t.cost+t.pnl,t.stopLoss&&(t.side==="buy"?a<=t.stopLoss:a>=t.stopLoss)){await this.closePosition(t.id);continue}if(t.takeProfit&&(t.side==="buy"?a>=t.takeProfit:a<=t.takeProfit)){await this.closePosition(t.id);continue}}catch{}for(const t of this.state.orders.filter(a=>a.status==="pending"))try{const a=await D.getPrice(t.symbol);(t.side==="buy"?a<=t.targetPrice:a>=t.targetPrice)&&(t.status="filled",await this.openPosition(t.symbol,t.side,t.quantity,{stopLoss:t.stopLoss,takeProfit:t.takeProfit}))}catch{}return this.state.orders=this.state.orders.filter(t=>t.status==="pending"),this.state.equity=s,this.state.equityHistory.push({time:Date.now(),value:s}),this.state.equityHistory.length>500&&(this.state.equityHistory=this.state.equityHistory.slice(-500)),this._save(),this.state}_updateStats(s){const t=this.state.stats;t.totalTrades++,t.totalPnl+=s,s>0?(t.wins++,t.bestTrade=Math.max(t.bestTrade,s)):(t.losses++,t.worstTrade=Math.min(t.worstTrade,s)),t.avgWin=t.wins>0?t.totalPnl/t.wins:0,t.avgLoss=t.losses>0?(t.totalPnl-t.avgWin*t.wins)/t.losses:0;const a=Math.max(...this.state.equityHistory.map(r=>r.value));t.maxDrawdown=(a-this.state.equity)/a*100,t.winRate=t.totalTrades>0?t.wins/t.totalTrades*100:0;const l=this.state.closedTrades.filter(r=>r.pnl>0).reduce((r,n)=>r+n.pnl,0),i=Math.abs(this.state.closedTrades.filter(r=>r.pnl<0).reduce((r,n)=>r+n.pnl,0));t.profitFactor=i>0?l/i:l>0?1/0:0}getState(){return this.state}getPerformance(){const s=this.state,t=(s.equity-s.initialBalance)/s.initialBalance*100;return{balance:s.balance,equity:s.equity,initialBalance:s.initialBalance,returnPct:t,openPositions:s.positions.length,pendingOrders:s.orders.length,...s.stats}}}const z=new Bt;function $t(){var k,d,N;const{selectedPair:o,currentPrice:s,setPage:t}=F(),[a,l]=b.useState(z.getState()),[i,r]=b.useState(z.getPerformance()),[n,p]=b.useState({quantity:"",stopLoss:"",takeProfit:"",side:"buy"}),[u,c]=b.useState(!1),[g,x]=b.useState(null);b.useEffect(()=>{const m=setInterval(async()=>{const S=await z.updatePositions();l({...S}),r(z.getPerformance())},1e4);return()=>clearInterval(m)},[]);const w=b.useCallback(async()=>{const m=await z.updatePositions();l({...m}),r(z.getPerformance())},[]),j=async()=>{if(!(!n.quantity||!s)){c(!0);try{const m=await z.openPosition(o,n.side,parseFloat(n.quantity),{stopLoss:n.stopLoss?parseFloat(n.stopLoss):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit):null});x({type:"success",text:m.message}),p({...n,quantity:"",stopLoss:"",takeProfit:""}),await w()}catch(m){x({type:"error",text:m.message})}c(!1),setTimeout(()=>x(null),3e3)}},v=async m=>{try{const S=await z.closePosition(m);x({type:S.trade.pnl>=0?"success":"error",text:S.message}),await w()}catch(S){x({type:"error",text:S.message})}setTimeout(()=>x(null),3e3)},h=()=>{z.reset(1e4),l(z.getState()),r(z.getPerformance()),x({type:"success",text:"Simulador reiniciado con $10,000"}),setTimeout(()=>x(null),2e3)},y=i.returnPct||0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ee,{size:20,className:"text-[var(--gold)]"}),"Paper Trading Simulator"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Practica con datos reales, sin arriesgar dinero real"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,className:"px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:"Actualizar"}),e.jsxs("button",{onClick:h,className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--red)]/20 text-[var(--red)] rounded-lg text-xs font-bold hover:bg-[var(--red)]/30 transition-colors",children:[e.jsx(Ge,{size:12})," Reiniciar"]})]})]}),e.jsx(U,{children:g&&e.jsx(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-3 rounded-xl text-sm font-bold text-center ${g.type==="success"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:g.text})}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{label:"Balance",value:`$${(k=i.balance)==null?void 0:k.toFixed(2)}`,icon:re,color:"var(--gold)"},{label:"Equity",value:`$${(d=i.equity)==null?void 0:d.toFixed(2)}`,icon:W,color:"var(--blue)"},{label:"Retorno",value:`${y>=0?"+":""}${y.toFixed(2)}%`,icon:y>=0?G:Z,color:y>=0?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${(i.winRate||0).toFixed(0)}%`,icon:Je,color:"var(--gold)"},{label:"Trades",value:i.totalTrades||0,icon:me,color:"var(--text)"}].map((m,S)=>{const M=m.icon;return e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:S*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx(M,{size:16,style:{color:m.color},className:"mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold font-mono",style:{color:m.color},children:m.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:m.label})]},m.label)})}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"P&L Total",value:`${i.totalPnl>=0?"+":""}$${(i.totalPnl||0).toFixed(2)}`,color:(i.totalPnl||0)>=0?"var(--green)":"var(--red)"},{label:"Mejor Trade",value:`+$${(i.bestTrade||0).toFixed(2)}`,color:"var(--green)"},{label:"Peor Trade",value:`$${(i.worstTrade||0).toFixed(2)}`,color:"var(--red)"},{label:"Max Drawdown",value:`${(i.maxDrawdown||0).toFixed(1)}%`,color:"var(--red)"}].map(m=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:m.label}),e.jsx("p",{className:"text-sm font-bold font-mono",style:{color:m.color},children:m.value})]},m.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Abrir PosiciÃ³n (Demo)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--gold)]",children:o}),e.jsxs("span",{className:"text-sm font-mono",children:["$",(s==null?void 0:s.toLocaleString(void 0,{maximumFractionDigits:2}))||"---"]}),e.jsx("button",{onClick:()=>t("chart"),className:"text-xs text-[var(--gold)] hover:underline ml-auto",children:"Ver grÃ¡fico â†’"})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>p({...n,side:"buy"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="buy"?"bg-[var(--green)] text-white":"text-[var(--text-dim)]"}`,children:"COMPRAR"}),e.jsx("button",{onClick:()=>p({...n,side:"sell"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="sell"?"bg-[var(--red)] text-white":"text-[var(--text-dim)]"}`,children:"VENDER"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Cantidad"}),e.jsx("input",{type:"number",value:n.quantity,onChange:m=>p({...n,quantity:m.target.value}),placeholder:"Ej: 0.01",className:"w-full text-sm"}),n.quantity&&s&&e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] mt-1",children:["Costo: $",(parseFloat(n.quantity)*s).toFixed(2)," de $",(N=i.balance)==null?void 0:N.toFixed(2)," disponible"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(J,{size:10})," Stop Loss"]}),e.jsx("input",{type:"number",value:n.stopLoss,onChange:m=>p({...n,stopLoss:m.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(me,{size:10})," Take Profit"]}),e.jsx("input",{type:"number",value:n.takeProfit,onChange:m=>p({...n,takeProfit:m.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsx("button",{onClick:j,disabled:!n.quantity||!s||u,className:`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50 ${n.side==="buy"?"bg-[var(--green)] text-white":"bg-[var(--red)] text-white"}`,children:u?"Ejecutando...":`${n.side==="buy"?"Comprar":"Vender"} ${o.replace("USDT","")} (Demo)`})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold mb-3",children:["Posiciones Abiertas (",a.positions.length,")"]}),a.positions.length===0?e.jsx("p",{className:"text-sm text-[var(--text-dim)] text-center py-8",children:"Sin posiciones abiertas"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.positions.map(m=>{var S,M,f,B;return e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded ${m.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:m.side.toUpperCase()}),e.jsx("span",{className:"text-sm font-bold",children:m.symbol})]}),e.jsx("button",{onClick:()=>v(m.id),className:"px-2 py-0.5 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cerrar"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Entrada"}),e.jsxs("p",{className:"font-mono",children:["$",(S=m.entryPrice)==null?void 0:S.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Actual"}),e.jsxs("p",{className:"font-mono",children:["$",(M=m.currentPrice)==null?void 0:M.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`font-mono font-bold ${m.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[m.pnl>=0?"+":"","$",(f=m.pnl)==null?void 0:f.toFixed(2)," (",(B=m.pnlPercent)==null?void 0:B.toFixed(1),"%)"]})]})]})]},m.id)})})]})]}),a.closedTrades.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-[var(--border)]",children:e.jsx("h3",{className:"text-sm font-bold",children:"Historial de Trades (Demo)"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left p-2",children:"Par"}),e.jsx("th",{className:"text-left p-2",children:"Lado"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"})]})}),e.jsx("tbody",{children:a.closedTrades.slice().reverse().map(m=>{var S,M,f;return e.jsxs("tr",{className:"border-b border-[var(--border)]/50 hover:bg-[var(--dark-3)]",children:[e.jsx("td",{className:"p-2 font-bold",children:m.symbol}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:m.side==="buy"?"text-[var(--green)]":"text-[var(--red)]",children:m.side.toUpperCase()})}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(S=m.entryPrice)==null?void 0:S.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(M=m.exitPrice)==null?void 0:M.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-mono font-bold ${m.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[m.pnl>=0?"+":"","$",(f=m.pnl)==null?void 0:f.toFixed(2)]})]},m.id)})})]})})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"âš ï¸ Esto es un simulador con datos reales del mercado. No se usa dinero real."}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Practica tus estrategias sin riesgo."})]})]})}function Et(){var p;const{settings:o,updateSettings:s,user:t}=F(),[a,l]=b.useState(""),[i,r]=b.useState(!1),n=()=>{a.trim()&&(Te.setApiKey(a.trim()),s({openaiKey:a.trim()}),r(!0),setTimeout(()=>r(!1),2e3))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Ajustes"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"ConfiguraciÃ³n de tu plataforma"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(J,{size:16,className:"text-[var(--gold)]"})," Perfil"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Email:"})," ",t==null?void 0:t.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Nombre:"})," ",t==null?void 0:t.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Plan:"})," ",e.jsx("span",{className:"text-[var(--gold)]",children:(p=t==null?void 0:t.plan)==null?void 0:p.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Xe,{size:16,className:"text-[var(--gold)]"})," API Key de OpenAI"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-2",children:"Opcional. Sin API key, Kairos AI usa anÃ¡lisis local integrado. Con API key, accedes a GPT-4 para anÃ¡lisis avanzado."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:a,onChange:u=>l(u.target.value),placeholder:"sk-...",className:"flex-1 text-sm font-mono"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl text-sm font-bold",children:i?"âœ“ Guardado":"Guardar"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Ye,{size:16,className:"text-[var(--gold)]"})," Trading por Defecto"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo mÃ¡x. por trade (%)"}),e.jsx("input",{type:"number",value:o.maxRiskPerTrade,onChange:u=>s({maxRiskPerTrade:parseFloat(u.target.value)}),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Apalancamiento predeterminado"}),e.jsx("input",{type:"number",value:o.defaultLeverage,onChange:u=>s({defaultLeverage:parseFloat(u.target.value)}),className:"w-full text-sm"})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Q,{size:16,className:"text-[var(--gold)]"})," Notificaciones"]}),e.jsx("div",{className:"space-y-3",children:[{key:"notifications",label:"Notificaciones",desc:"Alertas de trades y seÃ±ales"},{key:"soundAlerts",label:"Sonido",desc:"Alertas sonoras al ejecutar trades"}].map(u=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:u.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:u.desc})]}),e.jsx("button",{onClick:()=>s({[u.key]:!o[u.key]}),className:`w-12 h-6 rounded-full transition-colors relative
                  ${o[u.key]?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform
                    ${o[u.key]?"left-6":"left-0.5"}`})})]},u.key))})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-[var(--gold)]"})," Kairos Wallet"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:"Conecta tu Kairos Wallet para usar KAIROS Coin como mÃ©todo de pago y recibir recompensas."}),e.jsxs("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--gold)]/20 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(ce,{size:14})," Abrir Kairos Wallet"]})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"Kairos Trade v1.0.0 â€¢ Kairos 777 Inc"}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Powered by Kairos AI"})]})]})}const ke="kairos_trade_alerts";class It{constructor(){this.alerts=this._load(),this.triggered=[],this.monitoring=!1,this.interval=null,this.callbacks=new Set}_load(){try{return JSON.parse(localStorage.getItem(ke))||[]}catch{return[]}}_save(){localStorage.setItem(ke,JSON.stringify(this.alerts))}subscribe(s){return this.callbacks.add(s),()=>this.callbacks.delete(s)}_notify(s){this.callbacks.forEach(t=>t(s)),Notification.permission==="granted"&&new Notification(`Kairos Trade â€” ${s.symbol}`,{body:s.message,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%23D4AF37"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%230A0A0F" font-family="serif" font-weight="bold">K</text></svg>'})}async requestPermission(){Notification.permission!=="granted"&&await Notification.requestPermission()}addPriceAlert(s,t,a,l={}){const i={id:Date.now().toString(36),type:"price",symbol:s,condition:t,targetPrice:parseFloat(a),active:!0,repeat:l.repeat||!1,message:`${s} ${t==="above"?">":"<"} $${a}`,createdAt:new Date().toISOString()};return this.alerts.push(i),this._save(),this._ensureMonitoring(),i}addSignalAlert(s,t,a={}){const l={ema_cross:`EMA ${a.fast||20}/${a.slow||50} Cross`,rsi_oversold:`RSI < ${a.threshold||30}`,rsi_overbought:`RSI > ${a.threshold||70}`,macd_cross:"MACD Signal Cross",volume_spike:`Volume Spike > ${a.multiplier||2}x avg`},i={id:Date.now().toString(36),type:"signal",symbol:s,signalType:t,params:a,active:!0,repeat:a.repeat||!1,message:`${s}: ${l[t]||t}`,createdAt:new Date().toISOString()};return this.alerts.push(i),this._save(),this._ensureMonitoring(),i}removeAlert(s){this.alerts=this.alerts.filter(t=>t.id!==s),this._save()}getAlerts(){return this.alerts}getTriggered(){return this.triggered}_ensureMonitoring(){this.monitoring||(this.monitoring=!0,this.interval=setInterval(()=>this._check(),15e3),this._check())}stop(){this.monitoring=!1,this.interval&&clearInterval(this.interval)}async _check(){const s=this.alerts.filter(a=>a.active);if(s.length===0)return;const t={};s.forEach(a=>{t[a.symbol]||(t[a.symbol]=[]),t[a.symbol].push(a)});for(const[a,l]of Object.entries(t))try{const i=await D.getPrice(a);for(const r of l){let n=!1;r.type==="price"&&(r.condition==="above"&&i>=r.targetPrice&&(n=!0),r.condition==="below"&&i<=r.targetPrice&&(n=!0)),r.type==="signal"&&(n=await this._checkSignal(a,r)),n&&(r.triggeredAt=new Date().toISOString(),r.triggeredPrice=i,this.triggered.push({...r}),this._notify({...r,currentPrice:i,message:`ðŸ”” ${r.message} â€” Precio actual: $${i.toLocaleString()}`}),r.repeat||(r.active=!1))}}catch{}this._save()}async _checkSignal(s,t){try{const a=await D.getCandles(s,"1h",60),l=a.map(r=>r.close),i=l.length;switch(t.signalType){case"ema_cross":{const r=K(l,t.params.fast||20),n=K(l,t.params.slow||50);return ne(r,n,i-1)!==null}case"rsi_oversold":return ie(l,t.params.period||14)[i-1]<(t.params.threshold||30);case"rsi_overbought":return ie(l,t.params.period||14)[i-1]>(t.params.threshold||70);case"macd_cross":{const{macd:r,signal:n}=Ae(l);return ne(r,n,i-1)!==null}case"volume_spike":{const r=a.map(p=>p.volume),n=r.slice(-20).reduce((p,u)=>p+u,0)/20;return r[i-1]>n*(t.params.multiplier||2)}default:return!1}}catch{return!1}}}const L=new It,Ft=[{id:"ema_cross",label:"EMA Cruce",desc:"EMA 20/50 crossover",icon:xe},{id:"rsi_oversold",label:"RSI Sobreventa",desc:"RSI < 30",icon:Z},{id:"rsi_overbought",label:"RSI Sobrecompra",desc:"RSI > 70",icon:G},{id:"macd_cross",label:"MACD Cruce",desc:"MACD/Signal crossover",icon:q},{id:"volume_spike",label:"Spike Volumen",desc:"Volumen > 2x promedio",icon:Qe}];function Dt(){const{selectedPair:o}=F(),[s,t]=b.useState([]),[a,l]=b.useState([]),[i,r]=b.useState("active"),[n,p]=b.useState({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1});b.useEffect(()=>{t(L.getAlerts()),l(L.getTriggered());const x=L.subscribe(()=>{t([...L.getAlerts()]),l([...L.getTriggered()])});return L.requestPermission(),x},[]);const u=()=>{if(n.type==="price"){if(!n.price)return;L.addPriceAlert(o,n.condition,n.price,{repeat:n.repeat})}else L.addSignalAlert(o,n.signalType,{repeat:n.repeat});t([...L.getAlerts()]),p({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1}),r("active")},c=x=>{L.removeAlert(x),t([...L.getAlerts()])},g=s.filter(x=>x.active);return s.filter(x=>!x.active),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs(C.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight flex items-center gap-2",children:[e.jsx(Q,{size:22,className:"text-[var(--gold)]"}),"Alertas"]}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:[g.length," alerta",g.length!==1?"s":""," activa",g.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>r("create"),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-semibold text-white transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:[e.jsx(oe,{size:16}),"Nueva Alerta"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[{id:"active",label:`Activas (${g.length})`},{id:"triggered",label:`Disparadas (${a.length})`},{id:"create",label:"Crear"}].map(x=>e.jsx("button",{onClick:()=>r(x.id),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-200
              ${i===x.id?"text-white":"text-[var(--text-dim)]"}`,style:i===x.id?{background:"linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.08))",border:"1px solid rgba(59,130,246,0.15)"}:{},children:x.label},x.id))}),e.jsx(U,{children:i==="create"&&e.jsxs(C.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl p-5 space-y-4",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Crear Alerta para ",o]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p({...n,type:"price"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="price"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Precio"}),e.jsx("button",{onClick:()=>p({...n,type:"signal"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="signal"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"SeÃ±al TÃ©cnica"})]}),n.type==="price"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2",children:["above","below"].map(x=>e.jsxs("button",{onClick:()=>p({...n,condition:x}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1.5
                        ${n.condition===x?x==="above"?"bg-[var(--green)]/10 text-[var(--green)] border border-[var(--green)]/15":"bg-[var(--red)]/10 text-[var(--red)] border border-[var(--red)]/15":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:[x==="above"?e.jsx(G,{size:12}):e.jsx(Z,{size:12}),x==="above"?"Sube a":"Baja a"]},x))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Precio objetivo (USD)"}),e.jsx("input",{type:"number",value:n.price,onChange:x=>p({...n,price:x.target.value}),placeholder:"Ej: 100000",className:"w-full",step:"any"})]})]}):e.jsx("div",{className:"space-y-2",children:Ft.map(x=>{const w=x.icon;return e.jsxs("button",{onClick:()=>p({...n,signalType:x.id}),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left
                        ${n.signalType===x.id?"bg-[var(--gold)]/10 border border-[var(--gold)]/15":"bg-[var(--dark-3)] border border-transparent hover:border-[var(--border)]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n.signalType===x.id?"bg-[var(--gold)]/15":"bg-[var(--dark-4)]"}`,children:e.jsx(w,{size:14,className:n.signalType===x.id?"text-[var(--gold)]":"text-[var(--text-dim)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:x.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:x.desc})]})]},x.id)})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("div",{className:`w-9 h-5 rounded-full transition-colors relative ${n.repeat?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,onClick:()=>p({...n,repeat:!n.repeat}),children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform ${n.repeat?"translate-x-4":"translate-x-0.5"}`})}),e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Repetir alerta"})]}),e.jsx("button",{onClick:u,disabled:n.type==="price"&&!n.price,className:"w-full py-3 text-white font-bold rounded-xl text-sm transition-all disabled:opacity-40",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:"Crear Alerta"})]})}),i==="active"&&e.jsx("div",{className:"space-y-2",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas activas"}),e.jsx("button",{onClick:()=>r("create"),className:"text-xs text-[var(--gold)] mt-2 font-semibold",children:"Crear primera alerta â†’"})]}):g.map((x,w)=>e.jsxs(C.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:w*.04},className:"flex items-center gap-3 p-3 rounded-xl group",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0",style:{background:x.type==="price"?"rgba(59,130,246,0.08)":"rgba(139,92,246,0.08)"},children:x.type==="price"?x.condition==="above"?e.jsx(G,{size:16,className:"text-[var(--green)]"}):e.jsx(Z,{size:16,className:"text-[var(--red)]"}):e.jsx(q,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:x.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:x.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.repeat&&e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] bg-[var(--gold)]/10 px-1.5 py-0.5 rounded",children:"â†»"}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("button",{onClick:()=>c(x.id),className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/[0.06] transition-all opacity-0 group-hover:opacity-100",children:e.jsx(te,{size:13})})]})]},x.id))}),i==="triggered"&&e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas disparadas"})]}):[...a].reverse().map((x,w)=>{var j;return e.jsxs(C.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(14,203,129,0.04), rgba(17,19,24,0.6))",border:"1px solid rgba(14,203,129,0.08)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--green)]/[0.08] flex items-center justify-center shrink-0",children:e.jsx(pe,{size:16,className:"text-[var(--green)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:x.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:x.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono text-[var(--green)]",children:["$",(j=x.triggeredPrice)==null?void 0:j.toLocaleString()]}),e.jsx("p",{className:"text-[9px] text-[var(--text-dim)]",children:new Date(x.triggeredAt).toLocaleTimeString()})]})]},`${x.id}-${w}`)})})]})}function Rt(){const{isAuthenticated:o,currentPage:s,aiPanelOpen:t}=F();if(!o)return e.jsx(gt,{});const a=()=>{switch(s){case"dashboard":return e.jsx(je,{});case"chart":return e.jsxs("div",{className:"flex flex-1 overflow-hidden h-full",children:[e.jsx("div",{className:"flex-1 h-full overflow-hidden",children:e.jsx(ft,{})}),e.jsx(jt,{})]});case"bots":return e.jsx(wt,{});case"simulator":return e.jsx($t,{});case"brokers":return e.jsx(kt,{});case"ai":return e.jsx(Ne,{});case"strategies":return e.jsx(At,{});case"history":return e.jsx(Tt,{});case"alerts":return e.jsx(Dt,{});case"wallet":return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)]/15 flex items-center justify-center text-[var(--gold)] text-2xl font-bold mx-auto mb-4",children:"K"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Kairos Wallet"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Conecta tu Kairos Wallet para integrar tus balances de KAIROS Coin con la plataforma de trading."}),e.jsx("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-[var(--gold)] text-white font-semibold rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Abrir Kairos Wallet"})]})});case"settings":return e.jsx(Et,{});default:return e.jsx(je,{})}};return e.jsxs("div",{className:"flex h-screen bg-[var(--dark)] overflow-hidden",children:[e.jsx(Ze,{position:"top-right",toastOptions:{style:{background:"#181A20",color:"#EAECEF",border:"1px solid #1E222D",fontSize:"13px"}}}),e.jsx(pt,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ut,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(U,{mode:"wait",children:e.jsx(C.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"flex-1 flex flex-col overflow-hidden",children:a()},s)}),e.jsx(U,{children:t&&s!=="ai"&&e.jsx(C.div,{initial:{width:0,opacity:0},animate:{width:380,opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"border-l border-[var(--border)] overflow-hidden shrink-0",children:e.jsx(Ne,{})})})]})]})]})}dt.createRoot(document.getElementById("root")).render(e.jsx(at.StrictMode,{children:e.jsx(rt,{children:e.jsx(Rt,{})})}));
