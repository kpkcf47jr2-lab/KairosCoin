const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D1oitnvn.js","assets/ui-8HTTZoBK.js","assets/vendor-C1W0orB6.js","assets/index-DBOPDyEw.css"])))=>i.map(i=>d[i]);
import{_ as L,b as O,f as A,e as R}from"./index-D1oitnvn.js";import{c as B,d as T,e as U,g as q}from"./indicators-DJQYQkcq.js";import{m as C}from"./marketData-K1zKCjjj.js";import{b as x}from"./broker-DA0V14si.js";import{e as N}from"./kairosScript-pvBuAMm0.js";const I=["wss://stream.binance.us:9443/ws","wss://stream.binance.com:9443/ws"];class V{constructor(){this.activeBots=new Map,this.streams=new Map,this.positions=new Map,this.candles=new Map,this.lastHeartbeat=new Map,this.logs=new Map,this.callbacks=new Map,this.liveData=new Map}_log(e,s){var n,a,o;const t=this.logs.get(e)||[],i=this.activeBots.get(e);t.push({message:s,time:Date.now(),botName:((n=i==null?void 0:i.bot)==null?void 0:n.name)||"Bot"}),t.length>150&&t.splice(0,50),this.logs.set(e,t);try{(o=(a=this.callbacks.get(e))==null?void 0:a.onLog)==null||o.call(a,s)}catch{}}_onTrade(e,s){var t,i;try{(i=(t=this.callbacks.get(e))==null?void 0:t.onTrade)==null||i.call(t,s)}catch{}}async _syncPositionToStore(e,s,t,i,n){try{const a=(await L(async()=>{const{default:d}=await import("./index-D1oitnvn.js").then(r=>r.ai);return{default:d}},__vite__mapDeps([0,1,2,3]))).default,o=a.getState();o.positions.filter(d=>d.botId===e.id).forEach(d=>o.closePosition(d.id)),a.getState().addPosition({pair:e.pair,side:t,quantity:i,entryPrice:s,currentPrice:s,stopLoss:n.stopLoss?parseFloat(n.stopLoss.toFixed(2)):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit.toFixed(2)):null,botId:e.id,botName:e.name,time:Date.now()})}catch{}}async _removePositionFromStore(e){try{const t=(await L(async()=>{const{default:n}=await import("./index-D1oitnvn.js").then(a=>a.ai);return{default:n}},__vite__mapDeps([0,1,2,3]))).default.getState();t.positions.filter(n=>n.botId===e).forEach(n=>t.closePosition(n.id))}catch{}}setCallbacks(e,s,t){this.callbacks.set(e,{onTrade:s,onLog:t})}getLogs(e){return this.logs.get(e)||[]}getAllLogs(){const e=[];for(const[s,t]of this.logs)e.push(...t.map(i=>({...i,botId:s})));return e.sort((s,t)=>s.time-t.time).slice(-100)}async _ensureBrokerConnected(e){if(!e.brokerId)return!1;if(x.connections.has(e.brokerId))return!0;try{const t=(await L(async()=>{const{default:i}=await import("./index-D1oitnvn.js").then(n=>n.ai);return{default:i}},__vite__mapDeps([0,1,2,3]))).default.getState().brokers.find(i=>i.id===e.brokerId);if(t&&t.connected)return await x.connect(t),!0}catch(s){console.warn("Auto-reconnect failed:",s.message)}return!1}async startBot(e,s,t){var r;if(this.activeBots.has(e.id))return;this.callbacks.set(e.id,{onTrade:s,onLog:t}),this.activeBots.set(e.id,{bot:e,running:!0}),this._log(e.id,`ü§ñ Bot "${e.name}" iniciado en ${e.pair}`);const i=await this._ensureBrokerConnected(e);e.brokerId?this._log(e.id,i?"üîó Broker conectado ‚Äî modo REAL activado":"‚ö†Ô∏è Broker no disponible ‚Äî modo DEMO"):this._log(e.id,"üìã Modo DEMO ‚Äî Conecta un broker para operar en real");const n=O(e.pair);let a;try{a=await C.getCandles(n,e.timeframe,100),this.candles.set(e.id,a);const l=(r=a[a.length-1])==null?void 0:r.close;this._log(e.id,`üìä ${a.length} velas cargadas | Precio: $${l==null?void 0:l.toFixed(2)} | TF: ${e.timeframe}`)}catch(l){this._log(e.id,`‚ùå Error cargando datos: ${l.message}`),this._log(e.id,"‚è±Ô∏è Cambiando a modo polling..."),this._startPollingFallback(e,n);return}const o=a.map(l=>l.close),p=o[o.length-1],d=this._evaluateStrategy(e.strategy,a,o,e.id);d?(this._log(e.id,`üìä Se√±al inicial: ${d.type.toUpperCase()} a $${p.toFixed(2)}`),await this._handleSignal(e,d,p)):this._logIndicatorStatus(e,o),this._connectBotStream(e,n)}_logIndicatorStatus(e,s){var n,a,o,p,d,r,l,c,m,_,P,y,F,w,f,h,g,u;const t=s.length,i=(a=(n=e.strategy)==null?void 0:n.entry)==null?void 0:a.indicator;try{if(i==="ema_cross"||i==="ema_cross_rsi"){const S=((o=e.strategy.entry.params)==null?void 0:o.fastEma)||((p=e.strategy.entry.params)==null?void 0:p.fast)||20,$=((d=e.strategy.entry.params)==null?void 0:d.slowEma)||((r=e.strategy.entry.params)==null?void 0:r.slow)||50,E=B(s,S),k=B(s,$),v=((E[t-1]-k[t-1])/k[t-1]*100).toFixed(3);let D=`üìà EMA${S}: $${(l=E[t-1])==null?void 0:l.toFixed(2)} | EMA${$}: $${(c=k[t-1])==null?void 0:c.toFixed(2)} | Diff: ${v}%`;if(i==="ema_cross_rsi"){const M=T(s,((m=e.strategy.entry.params)==null?void 0:m.rsiPeriod)||14);D+=` | RSI: ${(_=M[t-1])==null?void 0:_.toFixed(1)}`}this._log(e.id,`${D} ‚Äî Sin se√±al, monitoreando...`)}else if(i==="rsi"){const S=T(s,((P=e.strategy.entry.params)==null?void 0:P.period)||14);this._log(e.id,`üìà RSI: ${(y=S[t-1])==null?void 0:y.toFixed(1)} ‚Äî Sin se√±al, monitoreando...`)}else if(i==="macd_cross"){const{macd:S,signal:$}=U(s);this._log(e.id,`üìà MACD: ${(F=S[t-1])==null?void 0:F.toFixed(2)} | Signal: ${(w=$[t-1])==null?void 0:w.toFixed(2)} ‚Äî Sin se√±al, monitoreando...`)}else if(((f=e.strategy)==null?void 0:f.type)==="custom_script"){const S=B(s,9),$=B(s,21),E=T(s,14),k=s[t-1],v=((S[t-1]-$[t-1])/$[t-1]*100).toFixed(3);this._log(e.id,`üìà $${k==null?void 0:k.toFixed(2)} | EMA9: $${(h=S[t-1])==null?void 0:h.toFixed(2)} | EMA21: $${(g=$[t-1])==null?void 0:g.toFixed(2)} (${v}%) | RSI: ${(u=E[t-1])==null?void 0:u.toFixed(1)} ‚Äî Sin se√±al`)}else this._log(e.id,"üëÄ Sin se√±al ‚Äî Monitoreando en tiempo real...")}catch{this._log(e.id,"üëÄ Sin se√±al ‚Äî Monitoreando en tiempo real...")}}_connectBotStream(e,s,t=0){var r;if(!((r=this.activeBots.get(e.id))!=null&&r.running))return;const i=s.toLowerCase(),n=e.timeframe||"1m",a=C._wsBase||I[0],o=`${a}/${i}@ticker/${i}@kline_${n}`;this._log(e.id,`üîå Conectando stream: ${s} @ ${n}${t>0?` (intento ${t+1})`:""}...`);let p;try{p=new WebSocket(o)}catch(l){this._log(e.id,`‚ùå Error WebSocket: ${l.message} ‚Äî Cambiando a polling`),this._startPollingFallback(e,s);return}let d=null;p.onopen=()=>{this._log(e.id,"‚ö° Stream EN VIVO conectado ‚Äî Datos instant√°neos activos"),t=0},p.onmessage=l=>{var c;if((c=this.activeBots.get(e.id))!=null&&c.running)try{const m=JSON.parse(l.data);if(m.e==="24hrTicker"){const _=parseFloat(m.c);this._handleTick(e,_)}if(m.e==="kline"){const _=m.k,P={time:Math.floor(_.t/1e3),open:parseFloat(_.o),high:parseFloat(_.h),low:parseFloat(_.l),close:parseFloat(_.c),volume:parseFloat(_.v)};_.x&&this._handleCandleClose(e,P)}}catch(m){console.error(`[Bot ${e.id}] WS parse:`,m)}},p.onerror=l=>{if(console.error(`[Bot ${e.id}] WS error`,l),t===0){const c=a===I[0]?I[1]:I[0];C._wsBase=c,this._log(e.id,"üîÑ Probando endpoint alternativo...");try{p.close()}catch{}this._connectBotStream(e,s,1);return}},p.onclose=()=>{var l;if((l=this.activeBots.get(e.id))!=null&&l.running)if(t<5){const c=Math.min(2e3*(t+1),1e4);this._log(e.id,`üîÑ Reconectando en ${c/1e3}s...`),d=setTimeout(()=>{this._connectBotStream(e,s,t+1)},c)}else this._log(e.id,"‚ö†Ô∏è WebSocket no disponible ‚Äî Modo polling activado"),this._startPollingFallback(e,s)},this.streams.set(e.id,{ws:p,reconnectTimeout:d})}getLiveData(e){return this.liveData.get(e)||null}_handleTick(e,s){const t=this.positions.get(e.id);if(t){const a=t.side==="buy"?(s-t.entryPrice)*t.quantity:(t.entryPrice-s)*t.quantity,o=t.side==="buy"?(s-t.entryPrice)/t.entryPrice*100:(t.entryPrice-s)/t.entryPrice*100;this.liveData.set(e.id,{price:s,unrealizedPnl:a,pnlPercent:o,position:{side:t.side,entryPrice:t.entryPrice,quantity:t.quantity},time:Date.now()})}else this.liveData.set(e.id,{price:s,unrealizedPnl:0,pnlPercent:0,position:null,time:Date.now()});const i=Date.now(),n=this.lastHeartbeat.get(e.id)||0;if(i-n>1e4)if(this.lastHeartbeat.set(e.id,i),t){const a=t.side==="buy"?(s-t.entryPrice)*t.quantity:(t.entryPrice-s)*t.quantity;this._log(e.id,`üíì $${s.toFixed(2)} | ${t.side.toUpperCase()} @ $${t.entryPrice.toFixed(2)} | P&L: ${a>=0?"+":""}$${a.toFixed(2)}`)}else this._log(e.id,`üíì $${s.toFixed(2)} ‚Äî Esperando se√±al...`);this._checkStopLossTakeProfit(e,s)}async _handleCandleClose(e,s){const t=this.candles.get(e.id)||[];t.length>0&&t[t.length-1].time===s.time?t[t.length-1]=s:(t.push(s),t.length>200&&t.shift()),this.candles.set(e.id,t);const i=t.map(o=>o.close),n=s.close;this._log(e.id,`üïØÔ∏è Vela cerrada: O:${s.open.toFixed(2)} H:${s.high.toFixed(2)} L:${s.low.toFixed(2)} C:${s.close.toFixed(2)}`);const a=this._evaluateStrategy(e.strategy,t,i,e.id);a?await this._handleSignal(e,a,n):this._logIndicatorStatus(e,i)}async _handleSignal(e,s,t){const i=this.positions.get(e.id);i&&i.side!==s.type&&await this._closePosition(e,i,t,s.type),this.positions.has(e.id)||await this._openPosition(e,s,t)}async _closePosition(e,s,t,i,n){const a=s.entryPrice,o=s.quantity,p=s.side==="buy"?(t-a)*o:(a-t)*o,d=A.applyVolumeFee(t,o),r=p-d;this._log(e.id,`üìä Cerrando: ${s.side.toUpperCase()} ‚Üí ${i.toUpperCase()} | $${a.toFixed(2)} ‚Üí $${t.toFixed(2)} | P&L: ${r>=0?"+":""}$${r.toFixed(2)}`);const l={symbol:O(e.pair),side:i,type:"market",quantity:o,price:t};if(e.brokerId&&x.connections.has(e.brokerId))try{this._log(e.id,"üîÑ Cerrando posici√≥n REAL en broker...");const c=await x.placeOrder(e.brokerId,l),m=c.confirmed!==!1,_=c.filledPrice&&c.filledPrice>0?c.filledPrice:t,y=(s.side==="buy"?(_-a)*o:(a-_)*o)-d,F=m?"‚úÖ":"‚ö†Ô∏è";this._log(e.id,`${F} Cerrada: P&L ${y>=0?"+":""}$${y.toFixed(4)} [${c.status}] ID:${c.id||"N/A"}`),this._onTrade(e.id,{...l,...c,profit:y,real:!0,confirmed:m,action:"close",reason:n}),R.notifyTradeClose(e.name,s.side,e.pair,a,_,y,n),this._refreshBotBalance(e)}catch(c){this._log(e.id,`‚ùå Error cerrando: ${c.message}`),this._onTrade(e.id,{...l,profit:r,status:"error",error:c.message,action:"close"})}else this._log(e.id,`üìù [DEMO] Cerrada: P&L ${r>=0?"+":""}$${r.toFixed(2)}`),this._onTrade(e.id,{...l,profit:r,status:"filled",simulated:!0,action:"close",reason:n});this.positions.delete(e.id),this._removePositionFromStore(e.id)}async _openPosition(e,s,t){var l,c,m,_,P,y,F,w;const i=((l=this._lastOrderFail)==null?void 0:l.get(e.id))||0,n=(c=this._lastFailPermanent)!=null&&c.get(e.id)?6e4:5e3;if(Date.now()-i<n)return;this._log(e.id,`üìä Se√±al: ${s.type.toUpperCase()} a $${t.toFixed(2)}`);const a=this._calculatePositionSize(e,t);if(a*t<.5){this._log(e.id,"‚ö†Ô∏è Balance insuficiente para operar (m√≠nimo ~$1). Necesitas al menos $1.10 de saldo."),this._lastOrderFail=this._lastOrderFail||new Map,this._lastFailPermanent=this._lastFailPermanent||new Map,this._lastOrderFail.set(e.id,Date.now()),this._lastFailPermanent.set(e.id,!0);return}const o=(m=this._scriptConfigs)==null?void 0:m.get(e.id),p=parseFloat((o==null?void 0:o.stopLoss)||((_=e.strategy)==null?void 0:_.stopLoss)||2)/100,d=parseFloat((o==null?void 0:o.takeProfit)||((P=e.strategy)==null?void 0:P.takeProfit)||4)/100,r={symbol:O(e.pair),side:s.type,type:"market",quantity:a,price:t,stopLoss:s.type==="buy"?t*(1-p):t*(1+p),takeProfit:s.type==="buy"?t*(1+d):t*(1-d)};if(e.brokerId&&x.connections.has(e.brokerId))try{this._log(e.id,"üîÑ Ejecutando orden REAL en broker...");const f=await x.placeOrder(e.brokerId,r),h=f.filledPrice||t,g=f.confirmed!==!1,u=g?"‚úÖ":"‚ö†Ô∏è";A.applyVolumeFee(h,f.filledQty||a),this._log(e.id,`${u} REAL: ${(y=f.side)==null?void 0:y.toUpperCase()} ${f.filledQty||a} @ $${h.toFixed(2)} [${f.status}] ID:${f.id||"N/A"}`),g||this._log(e.id,"‚ö†Ô∏è Orden no confirmada por el broker ‚Äî el fill real puede diferir"),(F=this._lastOrderFail)==null||F.delete(e.id),(w=this._lastFailPermanent)==null||w.delete(e.id),this.positions.set(e.id,{side:s.type,entryPrice:h,quantity:f.filledQty||a,entryTime:Date.now(),orderId:f.id}),this._syncPositionToStore(e,h,s.type,f.filledQty||a,r),this._onTrade(e.id,{...r,...f,real:!0,action:"open"}),R.notifyTradeOpen(e.name,s.type,e.pair,h,f.filledQty||a,e.brokerName||e.brokerId),this._refreshBotBalance(e)}catch(f){this._log(e.id,`‚ùå Error orden: ${f.message}`),this._lastOrderFail=this._lastOrderFail||new Map,this._lastOrderFail.set(e.id,Date.now()),this._lastFailPermanent=this._lastFailPermanent||new Map;const h=f.message.toLowerCase(),g=h.includes("insufficient")||h.includes("size")||h.includes("balance")||h.includes("too small")||h.includes("minimum");this._lastFailPermanent.set(e.id,g)}else A.applyVolumeFee(t,a),this._log(e.id,`üìù [DEMO] ${s.type.toUpperCase()} ${a} @ $${t.toFixed(2)}`),this.positions.set(e.id,{side:s.type,entryPrice:t,quantity:a,entryTime:Date.now(),simulated:!0}),this._syncPositionToStore(e,t,s.type,a,r),this._onTrade(e.id,{...r,status:"filled",simulated:!0,action:"open"})}async _checkStopLossTakeProfit(e,s){var P,y,F,w,f,h,g;const t=this.positions.get(e.id);if(!t)return;const i=(P=this._scriptConfigs)==null?void 0:P.get(e.id),n=parseFloat((i==null?void 0:i.stopLoss)||((y=e.strategy)==null?void 0:y.stopLoss)||2)/100,a=parseFloat((i==null?void 0:i.takeProfit)||((F=e.strategy)==null?void 0:F.takeProfit)||4)/100,o=e.trailingStop||((w=e.strategy)==null?void 0:w.trailingStop)||(i==null?void 0:i.trailingStop),p=parseFloat(e.trailingStopPct||((f=e.strategy)==null?void 0:f.trailingStopPct)||(i==null?void 0:i.trailingStopPct)||n*100)/100,d=parseFloat(e.trailingActivation||((h=e.strategy)==null?void 0:h.trailingActivation)||(i==null?void 0:i.trailingActivation)||.5)/100;let r,l=!1;o?(t.bestPrice||(t.bestPrice=t.entryPrice),t.side==="buy"?(t.bestPrice=Math.max(t.bestPrice,s),(s-t.entryPrice)/t.entryPrice>=d?(r=t.bestPrice*(1-p),l=!0):r=t.entryPrice*(1-n)):(t.bestPrice=Math.min(t.bestPrice,s),(t.entryPrice-s)/t.entryPrice>=d?(r=t.bestPrice*(1+p),l=!0):r=t.entryPrice*(1+n)),this.positions.set(e.id,t)):r=t.side==="buy"?t.entryPrice*(1-n):t.entryPrice*(1+n);const c=t.side==="buy"?t.entryPrice*(1+a):t.entryPrice*(1-a),m=t.side==="buy"?s<=r:s>=r,_=t.side==="buy"?s>=c:s<=c;if(l){const u=this.liveData.get(e.id);u&&(u.trailingStop=r,u.bestPrice=t.bestPrice,this.liveData.set(e.id,u))}if(m||_){const u=t.side==="buy"?"sell":"buy",S=m?l?"trailing_stop":"stop_loss":"take_profit",$=m?l?"üìê TRAILING-STOP":"üõë STOP-LOSS":"üéØ TAKE-PROFIT";this._log(e.id,`${$} a $${s.toFixed(2)}${l?` (best: $${(g=t.bestPrice)==null?void 0:g.toFixed(2)})`:""}`),await this._closePosition(e,t,s,u,S)}}_startPollingFallback(e,s){const t=this._getCheckInterval(e.timeframe);this._log(e.id,`‚è±Ô∏è Polling cada ${t/1e3}s`);const i=async()=>{var a;if((a=this.activeBots.get(e.id))!=null&&a.running)try{const o=await C.getCandles(s,e.timeframe,100);this.candles.set(e.id,o);const p=o.map(c=>c.close),d=p[p.length-1],r=this.positions.get(e.id);if(r){const c=r.side==="buy"?(d-r.entryPrice)*r.quantity:(r.entryPrice-d)*r.quantity;this._log(e.id,`üíì $${d.toFixed(2)} | ${r.side.toUpperCase()} @ $${r.entryPrice.toFixed(2)} | P&L: ${c>=0?"+":""}$${c.toFixed(2)}`)}else this._log(e.id,`üíì $${d.toFixed(2)} ‚Äî Esperando se√±al...`);const l=this._evaluateStrategy(e.strategy,o,p,e.id);l?await this._handleSignal(e,l,d):this._logIndicatorStatus(e,p),await this._checkStopLossTakeProfit(e,d)}catch(o){this._log(e.id,`‚ùå Error: ${o.message}`)}};i();const n=setInterval(i,t);this.streams.set(e.id,{interval:n})}stopBot(e){const s=this.activeBots.get(e);s&&(s.running=!1,this.activeBots.delete(e));const t=this.streams.get(e);if(t){if(t.ws)try{t.ws.close()}catch{}t.reconnectTimeout&&clearTimeout(t.reconnectTimeout),t.interval&&clearInterval(t.interval),this.streams.delete(e)}this.positions.delete(e),this.candles.delete(e),this.lastHeartbeat.delete(e),this.callbacks.delete(e),this.liveData.delete(e)}_evaluateStrategy(e,s,t,i){var o,p,d,r,l,c,m,_,P,y,F,w,f;if((e==null?void 0:e.type)==="custom_script"&&(e!=null&&e.code)){const h=N(e.code,s);return((o=h.logs)==null?void 0:o.length)>0&&h.logs.forEach(g=>this._log(i,`üìù ${g}`)),h.error?(this._log(i,`‚ùå Script error: ${h.error}`),null):(h.config&&i&&(this._scriptConfigs=this._scriptConfigs||new Map,this._scriptConfigs.set(i,h.config)),h.signal&&this._log(i,`üéØ Script se√±al: ${h.signal.type.toUpperCase()}`),h.signal)}if(!((p=e==null?void 0:e.entry)!=null&&p.indicator))return null;const n=t.length;if(n<50)return null;const a=e.entry.indicator;switch(a){case"ema_cross":case"ema_cross_rsi":{const h=((d=e.entry.params)==null?void 0:d.fastEma)||((r=e.entry.params)==null?void 0:r.fast)||9,g=((l=e.entry.params)==null?void 0:l.slowEma)||((c=e.entry.params)==null?void 0:c.slow)||21,u=B(t,h),S=B(t,g),$=q(u,S,n-1);if(a==="ema_cross_rsi"){const E=((m=e.entry.params)==null?void 0:m.rsiPeriod)||14,v=T(t,E)[n-1],D=((_=e.entry.params)==null?void 0:_.rsiOversold)||35,M=((y=(P=e.exit)==null?void 0:P.params)==null?void 0:y.rsiOverbought)||65;if($==="bullish_cross"&&v<D)return{type:"buy"};if($==="bearish_cross"&&v>M)return{type:"sell"};if(v>M)return{type:"sell"};if(v<D)return{type:"buy"}}else{if($==="bullish_cross")return{type:"buy"};if($==="bearish_cross")return{type:"sell"}}break}case"rsi":{const h=((F=e.entry.params)==null?void 0:F.period)||14,u=T(t,h)[n-1];if(u<(((w=e.entry.params)==null?void 0:w.oversold)||30))return{type:"buy"};if(u>(((f=e.entry.params)==null?void 0:f.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:h,signal:g}=U(t),u=q(h,g,n-1);if(u==="bullish_cross")return{type:"buy"};if(u==="bearish_cross")return{type:"sell"};break}default:return null}return null}async _refreshBotBalance(e){var s;if(!(!e.brokerId||!x.connections.has(e.brokerId)))try{const t=await x.getBalances(e.brokerId),i=["USDT","USD","USDC","BUSD","FDUSD"],n=t.find(a=>{var o;return i.includes((o=a.asset)==null?void 0:o.toUpperCase())});if(n){const a=parseFloat(n.free||n.total||0);if(a>0&&a!==e.balance){this._log(e.id,`üí∞ Balance actualizado: $${(s=e.balance)==null?void 0:s.toFixed(2)} ‚Üí $${a.toFixed(2)}`),e.balance=a;try{const{default:o}=await L(async()=>{const{default:l}=await import("./index-D1oitnvn.js").then(c=>c.ai);return{default:l}},__vite__mapDeps([0,1,2,3])),r=(o.getState().bots||[]).map(l=>l.id===e.id?{...l,balance:a}:l);o.setState({bots:r})}catch{}}}}catch(t){console.warn("[tradingEngine] Balance refresh failed:",t.message)}}_calculatePositionSize(e,s){const t=e.balance||1e3,i=parseFloat(e.riskPercent||2)/100;let n=t*i;const a=1.1;n<a&&(n=Math.min(a,t*.95),this._log(e.id,`‚ö†Ô∏è Monto calculado muy bajo ($${(t*i).toFixed(2)}), ajustado a $${n.toFixed(2)}`)),n>t*.95&&(n=t*.95),this._log(e.id,`üí∞ Tama√±o orden: $${n.toFixed(2)} USD (${i*100}% de $${t})`);const o=n/s;return Math.round(o*1e8)/1e8}_getCheckInterval(e){return{"1m":15e3,"5m":3e4,"15m":6e4,"1h":6e4,"4h":12e4,"1d":3e5}[e]||6e4}getActiveBotCount(){return this.activeBots.size}}const J=new V;export{J as t};
//# sourceMappingURL=tradingEngine-CTWMx4QQ.js.map
