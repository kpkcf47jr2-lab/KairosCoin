import{j as e,m as O,U as Et,C as bt,L as Ft,B as ue,P as he,a as Ne,Z as ne,S as Le,b as tt,H as It,c as Te,W as ze,d as Bt,e as _t,A as se,f as Ge,g as we,T as ge,h as Ee,i as Rt,k as Dt,l as $e,n as fe,E as ft,o as vt,p as st,q as Ye,D as Se,r as Mt,s as yt,t as Ot,u as Fe,v as re,X as Qe,w as jt,I as Je,x as zt,y as Nt,R as wt,z as je,F as Lt,G as St,J as qt,K as Oe,M as Kt,N as Ut,O as Vt,Q as ke,V as kt,Y as Xe,_ as rt,$ as Wt,a0 as Ue,a1 as Ht,a2 as Gt,a3 as it,a4 as nt,a5 as Yt,a6 as Qt,a7 as Jt,a8 as Xt,a9 as Zt,aa as es,ab as ts,ac as ss}from"./ui-C_LJgR3z.js";import{b as as,g as rs,c as is,a as P,R as ns,B as os}from"./vendor-CUCP814w.js";import{V as ls,a as cs,I as ds}from"./charts-UjLl1g-4.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var Re={},ot;function xs(){if(ot)return Re;ot=1;var u=as();return Re.createRoot=u.createRoot,Re.hydrateRoot=u.hydrateRoot,Re}var ms=xs();const ps=rs(ms),De={binance:{id:"binance",name:"Binance",logo:"ðŸŸ¡",baseUrl:"https://api.binance.com",wsUrl:"wss://stream.binance.com:9443/ws",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},bybit:{id:"bybit",name:"Bybit",logo:"ðŸŸ ",baseUrl:"https://api.bybit.com",wsUrl:"wss://stream.bybit.com/v5/public/spot",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret"]},kraken:{id:"kraken",name:"Kraken",logo:"ðŸŸ£",baseUrl:"https://api.kraken.com",wsUrl:"wss://ws.kraken.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},coinbase:{id:"coinbase",name:"Coinbase",logo:"ðŸ”µ",baseUrl:"https://api.coinbase.com",wsUrl:"wss://ws-feed.exchange.coinbase.com",supportedMarkets:["spot"],requiredFields:["apiKey","apiSecret"]},kucoin:{id:"kucoin",name:"KuCoin",logo:"ðŸŸ¢",baseUrl:"https://api.kucoin.com",wsUrl:"wss://ws-api.kucoin.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret","passphrase"]},okx:{id:"okx",name:"OKX",logo:"âš«",baseUrl:"https://www.okx.com",wsUrl:"wss://ws.okx.com:8443/ws/v5/public",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret","passphrase"]}},Ct=["BTCKAIROS","ETHKAIROS","BNBKAIROS","SOLKAIROS","XRPKAIROS","ADAKAIROS","DOGEKAIROS","AVAXKAIROS","DOTKAIROS","MATICKAIROS","LINKKAIROS","ATOMKAIROS","LTCKAIROS","UNIKAIROS","AAVEKAIROS"],Ze=[{label:"1m",value:"1m",seconds:60},{label:"5m",value:"5m",seconds:300},{label:"15m",value:"15m",seconds:900},{label:"1H",value:"1h",seconds:3600},{label:"4H",value:"4h",seconds:14400},{label:"1D",value:"1d",seconds:86400},{label:"1W",value:"1w",seconds:604800}],V={AUTH:"kairos_trade_auth",BROKERS:"kairos_trade_brokers",BOTS:"kairos_trade_bots",SETTINGS:"kairos_trade_settings",STRATEGIES:"kairos_trade_strategies",POSITIONS:"kairos_trade_positions",ORDERS:"kairos_trade_orders",TRADE_HISTORY:"kairos_trade_history"},xe=(u,t)=>{try{return JSON.parse(localStorage.getItem(u))||t}catch{return t}},ee=(u,t)=>localStorage.setItem(u,JSON.stringify(t)),J=is((u,t)=>({user:xe(V.AUTH,null),isAuthenticated:!!xe(V.AUTH,null),login:s=>{ee(V.AUTH,s),u({user:s,isAuthenticated:!0})},logout:()=>{localStorage.removeItem(V.AUTH),u({user:null,isAuthenticated:!1})},currentPage:"dashboard",setPage:s=>u({currentPage:s}),brokers:xe(V.BROKERS,[]),activeBroker:null,addBroker:s=>{const a={...s,id:Date.now().toString(36),apiKey:btoa(s.apiKey),apiSecret:btoa(s.apiSecret),passphrase:s.passphrase?btoa(s.passphrase):void 0,connected:!1,addedAt:new Date().toISOString()},r=[...t().brokers,a];return ee(V.BROKERS,r),u({brokers:r}),a},removeBroker:s=>{var r;const a=t().brokers.filter(l=>l.id!==s);ee(V.BROKERS,a),u({brokers:a,activeBroker:((r=t().activeBroker)==null?void 0:r.id)===s?null:t().activeBroker})},setActiveBroker:s=>u({activeBroker:s}),updateBrokerStatus:(s,a)=>{const r=t().brokers.map(l=>l.id===s?{...l,connected:a}:l);ee(V.BROKERS,r),u({brokers:r})},bots:xe(V.BOTS,[]),addBot:s=>{const a={...s,id:Date.now().toString(36),status:"stopped",trades:0,pnl:0,winRate:0,createdAt:new Date().toISOString()},r=[...t().bots,a];return ee(V.BOTS,r),u({bots:r}),a},updateBot:(s,a)=>{const r=t().bots.map(l=>l.id===s?{...l,...a}:l);ee(V.BOTS,r),u({bots:r})},removeBot:s=>{const a=t().bots.filter(r=>r.id!==s);ee(V.BOTS,a),u({bots:a})},selectedPair:"BTCKAIROS",selectedTimeframe:"1h",currentPrice:null,priceChange24h:null,orderBook:{bids:[],asks:[]},positions:xe(V.POSITIONS,[]),orders:xe(V.ORDERS,[]),tradeHistory:xe(V.TRADE_HISTORY,[]),setSelectedPair:s=>u({selectedPair:s}),setSelectedTimeframe:s=>u({selectedTimeframe:s}),setCurrentPrice:s=>u({currentPrice:s}),setPriceChange24h:s=>u({priceChange24h:s}),setOrderBook:s=>u({orderBook:s}),addPosition:s=>{const a=[...t().positions,{...s,id:Date.now().toString(36)}];ee(V.POSITIONS,a),u({positions:a})},closePosition:s=>{const a=t().positions.find(r=>r.id===s);if(a){const r=t().currentPrice||a.entryPrice,l=a.side==="buy"?(r-a.entryPrice)*a.quantity:(a.entryPrice-r)*a.quantity,i={...a,closedAt:new Date().toISOString(),exitPrice:r,pnl:l},n=t().positions.filter(d=>d.id!==s),c=[...t().tradeHistory,i];ee(V.POSITIONS,n),ee(V.TRADE_HISTORY,c),u({positions:n,tradeHistory:c})}},addOrder:s=>{const a=[...t().orders,{...s,id:Date.now().toString(36)}];ee(V.ORDERS,a),u({orders:a})},cancelOrder:s=>{const a=t().orders.filter(r=>r.id!==s);ee(V.ORDERS,a),u({orders:a})},strategies:xe(V.STRATEGIES,[]),seedDefaultStrategies:()=>{const a=t().strategies;if(parseInt(localStorage.getItem("kairos_factory_ver")||"0")>=3&&a.some(c=>c.isFactory))return;const l=a.filter(c=>!c.isFactory);localStorage.setItem("kairos_factory_ver",String(3));const i=[{id:"factory_alpha",name:"Kairos Alpha v1",type:"custom_script",isFactory:!0,description:"Bot multi-seÃ±al agresivo â€” RSI zones + MACD momentum + volumen + mean reversion. Ã“ptimo en 1m-5m.",code:`// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KAIROS ALPHA v1 â€” Multi-Signal Scalper
// DiseÃ±ado por Mario Isaac @ Kairos 777
// Timeframe recomendado: 1m / 5m
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

config({ stopLoss: 1.2, takeProfit: 2.0 });

// â”€â”€â”€ Indicadores â”€â”€â”€
const r = rsi(14);
const emaFast = ema(8);
const emaMid = ema(21);
const emaSlow = ema(50);
const m = macd(12, 26, 9);
const bands = bb(20, 2);
const volAvg = avg(volume, 20);
const volNow = volume.value;
const volSpike = volNow > volAvg * 1.5;

// â”€â”€â”€ Scoring system â”€â”€â”€
let bullScore = 0;
let bearScore = 0;

// RSI zones
if (r < 30) bullScore += 3;
else if (r < 40) bullScore += 1;
if (r > 70) bearScore += 3;
else if (r > 60) bearScore += 1;

// EMA alignment
if (emaFast > emaMid && emaMid > emaSlow) bullScore += 2;
if (emaFast < emaMid && emaMid < emaSlow) bearScore += 2;

// EMA crossovers
if (crossover(emaFast, emaMid)) bullScore += 2;
if (crossunder(emaFast, emaMid)) bearScore += 2;

// MACD
if (m.histogram > 0 && m.histogram > m.histogram.prev(1)) bullScore += 1;
if (m.histogram < 0 && m.histogram < m.histogram.prev(1)) bearScore += 1;
if (crossover(m.line, m.signal)) bullScore += 2;
if (crossunder(m.line, m.signal)) bearScore += 2;

// Bollinger Bands mean reversion
if (price < bands.lower) bullScore += 2;
if (price > bands.upper) bearScore += 2;

// Volume confirmation
if (volSpike) {
  bullScore += 1;
  bearScore += 1;
}

// â”€â”€â”€ Price action â”€â”€â”€
const pctMove = percentChange(close, 3);
if (pctMove < -0.3) bullScore += 1;  // oversold bounce
if (pctMove > 0.3) bearScore += 1;  // overbought drop

log("ðŸ“Š Bull: " + bullScore + " | Bear: " + bearScore + " | RSI: " + r.toFixed(1) + " | Vol: " + (volSpike ? "ðŸ”¥SPIKE" : "normal"));

// â”€â”€â”€ Execute trades â”€â”€â”€
if (bullScore >= 5 && bearScore < 3) {
  log("ðŸŸ¢ COMPRA â€” Score " + bullScore + " [RSI:" + r.toFixed(0) + " MACD:" + m.histogram.toFixed(2) + "]");
  buy();
}

if (bearScore >= 5 && bullScore < 3) {
  log("ðŸ”´ VENTA â€” Score " + bearScore + " [RSI:" + r.toFixed(0) + " MACD:" + m.histogram.toFixed(2) + "]");
  sell();
}`,createdAt:new Date().toISOString()},{id:"factory_scalper",name:"Scalper RSI+EMA",type:"custom_script",isFactory:!0,description:"Scalper con RSI y doble EMA crossover",code:`// Scalper â€” RSI + EMA cross
config({ stopLoss: 1.5, takeProfit: 2.5 });

const r = rsi(14);
const fast = ema(9);
const slow = ema(21);

log("RSI: " + r.toFixed(1) + " | EMA9: " + fast.toFixed(0) + " | EMA21: " + slow.toFixed(0));

if (r < 35 && crossover(fast, slow)) { log("ðŸŸ¢ COMPRA"); buy(); }
if (r > 65 && crossunder(fast, slow)) { log("ðŸ”´ VENTA"); sell(); }
if (r > 78) { log("ðŸ”´ RSI extremo"); sell(); }
if (r < 22) { log("ðŸŸ¢ RSI extremo bajo"); buy(); }`,createdAt:new Date().toISOString()},{id:"factory_momentum",name:"Momentum MACD+BB",type:"custom_script",isFactory:!0,description:"Momentum trading con MACD y Bollinger Bands",code:`// Momentum MACD + Bollinger Bands
config({ stopLoss: 2, takeProfit: 3 });

const m = macd(12, 26, 9);
const bands = bb(20, 2);
const r = rsi(14);

log("MACD: " + m.histogram.toFixed(2) + " | BB: " + bands.lower.toFixed(0) + "-" + bands.upper.toFixed(0));

if (price < bands.lower && crossover(m.line, m.signal) && r < 40) {
  log("ðŸŸ¢ COMPRA â€” BB inferior + MACD alcista"); buy();
}
if (price > bands.upper && crossunder(m.line, m.signal) && r > 60) {
  log("ðŸ”´ VENTA â€” BB superior + MACD bajista"); sell();
}`,createdAt:new Date().toISOString()},{id:"factory_sniper",name:"Kairos Sniper 1m",type:"custom_script",isFactory:!0,description:"Bot ultra-rÃ¡pido para 1m â€” detecta micro-reversiones con RSI extremo + volumen. Genera seÃ±ales frecuentes.",code:`// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KAIROS SNIPER â€” Ultra-Fast 1m Scalper
// DiseÃ±ado para timeframe 1m / 5m
// Genera seÃ±ales frecuentes para trading activo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

config({ stopLoss: 0.8, takeProfit: 1.2 })

const r = rsi(7)
const r14 = rsi(14)
const fast = ema(5)
const mid = ema(13)
const slow = ema(34)
const m = macd(8, 21, 5)
const bands = bb(15, 2)

const volNow = volume.value
const volAvg5 = avg(volume, 5)
const volAvg20 = avg(volume, 20)
const momentum = percentChange(close, 3)
const momentum5 = percentChange(close, 5)

const trendUp = fast > mid && mid > slow
const trendDown = fast < mid && mid < slow

let go = "none"

// RSI EXTREMO â€” seÃ±al rÃ¡pida
if (r < 25) go = "buy"
if (r > 75) go = "sell"

// MICRO-REVERSAL â€” RSI rebota desde extremo
if (r.prev(1) < 20 && r > 25 && momentum > 0) go = "buy"
if (r.prev(1) > 80 && r < 75 && momentum < 0) go = "sell"

// EMA CROSS rÃ¡pido con confirmaciÃ³n
if (crossover(fast, mid) && r < 55 && r14 < 50) go = "buy"
if (crossunder(fast, mid) && r > 45 && r14 > 50) go = "sell"

// BB SQUEEZE + momentum
if (price < bands.lower && momentum5 < -0.15) go = "buy"
if (price > bands.upper && momentum5 > 0.15) go = "sell"

// MACD cross con volumen
if (crossover(m.line, m.signal) && volNow > volAvg5) go = "buy"
if (crossunder(m.line, m.signal) && volNow > volAvg5) go = "sell"

// FILTRO: no operar contra tendencia fuerte
if (go === "buy" && trendDown && r > 40) go = "none"
if (go === "sell" && trendUp && r < 60) go = "none"

log("âš¡ RSI7:" + r.toFixed(0) + " EMA:" + (trendUp ? "â†‘" : trendDown ? "â†“" : "â†’") + " Mom:" + momentum.toFixed(2) + "% Vol:" + (volNow > volAvg20 * 1.3 ? "ðŸ”¥" : "Â·"))

if (go === "buy") {
  log("ðŸŸ¢ SNIPER BUY â€” RSI:" + r.toFixed(0) + " Price:$" + price.toFixed(2))
  buy()
}
if (go === "sell") {
  log("ðŸ”´ SNIPER SELL â€” RSI:" + r.toFixed(0) + " Price:$" + price.toFixed(2))
  sell()
}`,createdAt:new Date().toISOString()}],n=[...l,...i];ee(V.STRATEGIES,n),u({strategies:n})},addStrategy:s=>{const a={...s,id:Date.now().toString(36),createdAt:new Date().toISOString()},r=[...t().strategies,a];return ee(V.STRATEGIES,r),u({strategies:r}),a},removeStrategy:s=>{const a=t().strategies.filter(r=>r.id!==s);ee(V.STRATEGIES,a),u({strategies:a})},aiMessages:[],aiLoading:!1,addAiMessage:s=>u({aiMessages:[...t().aiMessages,s]}),setAiLoading:s=>u({aiLoading:s}),clearAiMessages:()=>u({aiMessages:[]}),settings:xe(V.SETTINGS,{theme:"dark",language:"es",notifications:!0,soundAlerts:!0,maxRiskPerTrade:2,defaultLeverage:1}),updateSettings:s=>{const a={...t().settings,...s};ee(V.SETTINGS,a),u({settings:a})},sidebarOpen:!0,aiPanelOpen:!1,modalOpen:null,toggleSidebar:()=>u({sidebarOpen:!t().sidebarOpen}),toggleAiPanel:()=>u({aiPanelOpen:!t().aiPanelOpen}),setModal:s=>u({modalOpen:s})})),us=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"})),hs=[{label:"Principal",items:[{id:"dashboard",icon:Ft,label:"Dashboard",desc:"Panel de control"},{id:"chart",icon:ue,label:"Trading",desc:"GrÃ¡ficos en vivo"},{id:"simulator",icon:he,label:"Simulador",desc:"Paper trading"}]},{label:"AutomatizaciÃ³n",items:[{id:"bots",icon:Ne,label:"Bots",desc:"Trading automÃ¡tico"},{id:"strategies",icon:ne,label:"Estrategias",desc:"Crear y gestionar"},{id:"ai",icon:Le,label:"Kairos AI",desc:"Asistente IA",accent:!0}]},{label:"GestiÃ³n",items:[{id:"brokers",icon:tt,label:"Brokers",desc:"Conexiones API"},{id:"history",icon:It,label:"Historial",desc:"Trades y reportes"},{id:"alerts",icon:Te,label:"Alertas",desc:"Notificaciones"}]}],gs=[{id:"wallet",icon:ze,label:"Wallet"},{id:"settings",icon:Bt,label:"Ajustes"}];function bs(){const{currentPage:u,setPage:t,sidebarOpen:s,toggleSidebar:a,bots:r,brokers:l,logout:i,user:n}=J(),[c,d]=P.useState(null),h=r.filter(g=>g.status==="active").length,p=l.filter(g=>g.connected).length,o=g=>g==="bots"?h:g==="brokers"?p:0,b=({item:g,compact:f=!1})=>{const k=g.icon,N=u===g.id,F=o(g.id),v=c===g.id;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>t(g.id),onMouseEnter:()=>d(g.id),onMouseLeave:()=>d(null),title:s?void 0:g.label,className:`w-full flex items-center rounded-xl transition-all duration-200 relative group
            ${s?"px-3 py-3 gap-3.5":"px-0 py-3 justify-center"}
            ${N?"text-white":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:[N&&e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{background:g.accent?"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(96,165,250,0.06))":"linear-gradient(135deg, rgba(59,130,246,0.08), rgba(59,130,246,0.02))",border:"1px solid rgba(59,130,246,0.1)"}}),N&&e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-6 rounded-r-full",style:{background:"linear-gradient(180deg, #60A5FA, #3B82F6)"}}),e.jsxs("div",{className:`relative z-10 flex items-center justify-center shrink-0 rounded-lg transition-all duration-200
            ${s?"w-8 h-8":"w-9 h-9"}
            ${N?g.accent?"bg-[var(--gold)]/20":"bg-white/[0.06]":"bg-transparent group-hover:bg-white/[0.04]"}`,children:[e.jsx(k,{size:s?18:20,strokeWidth:N?2:1.5,className:`transition-colors ${N&&g.accent?"text-[var(--gold-light)]":""}`}),F>0&&!s&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-[14px] h-[14px] bg-[var(--gold)] rounded-full text-[8px] font-bold text-white flex items-center justify-center",children:F})]}),s&&e.jsxs("div",{className:"relative z-10 flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[14px] truncate leading-tight ${N?"font-bold":"font-medium"}`,children:g.label}),g.accent&&e.jsx("span",{className:"text-[8px] font-bold bg-[var(--gold)]/20 text-[var(--gold-light)] px-1.5 py-0.5 rounded-full uppercase tracking-wider",children:"Pro"}),F>0&&e.jsx("span",{className:"ml-auto text-[10px] font-semibold bg-[var(--gold)]/12 text-[var(--gold)] rounded-full px-2 py-0.5 min-w-[22px] text-center",children:F})]}),!f&&g.desc&&e.jsx("span",{className:`text-[11px] leading-tight truncate block mt-0.5 transition-colors
                  ${N?"text-[var(--text-dim)]":"text-[var(--text-dim)]/50"}`,children:g.desc})]})]}),e.jsx(se,{children:!s&&v&&e.jsx(O.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:[e.jsx("p",{className:"text-xs font-semibold text-[var(--text)] whitespace-nowrap",children:g.label}),g.desc&&e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] whitespace-nowrap",children:g.desc})]})})})]})},m=({label:g})=>s?e.jsxs("div",{className:"flex items-center gap-2 px-3 mb-2.5 mt-1",children:[e.jsx("p",{className:"text-[11px] font-bold text-[var(--text-dim)]/60 uppercase tracking-[0.14em] whitespace-nowrap",children:g}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]/50"})]}):e.jsx("div",{className:"mx-auto w-6 h-px bg-[var(--border)]/60 my-3"});return e.jsxs(O.aside,{animate:{width:s?300:72},transition:{duration:.25,ease:[.4,0,.2,1]},className:"h-full flex flex-col relative shrink-0",style:{borderRight:"1px solid var(--border)",background:"linear-gradient(180deg, #0E1015 0%, #08090C 100%)"},children:[e.jsxs("div",{className:`flex items-center shrink-0 ${s?"px-7 gap-3.5 h-[68px]":"justify-center h-[68px]"}`,style:{borderBottom:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0 relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx("span",{className:"text-white font-extrabold text-base",children:"K"}),e.jsx("div",{className:"absolute inset-0 rounded-xl",style:{boxShadow:"0 0 20px rgba(59,130,246,0.2)"}})]}),s&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1,duration:.2},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[17px] font-bold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[11px] font-bold text-[var(--gold)] tracking-widest",children:"TRADE"})]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]/60 font-medium tracking-wider",children:"BY KAIROS 777"})]})})]}),s&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-5 mt-4 mb-2 p-3.5 rounded-xl",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.04), rgba(26,29,38,0.5))",border:"1px solid rgba(59,130,246,0.06)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--dark-4)] flex items-center justify-center",children:e.jsx(Et,{size:16,className:"text-[var(--text-dim)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-[var(--text)] truncate",children:(n==null?void 0:n.name)||"Trader"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(bt,{size:10,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] uppercase tracking-wider",children:"Free Plan"})]})]})]})}),e.jsx("nav",{className:`flex-1 overflow-y-auto py-3 ${s?"px-5":"px-2"}`,style:{scrollbarWidth:"none"},children:hs.map((g,f)=>e.jsxs("div",{className:f>0?"mt-6":"mt-1",children:[e.jsx(m,{label:g.label}),e.jsx("div",{className:"space-y-1",children:g.items.map(k=>e.jsx(b,{item:k},k.id))})]},g.label))}),e.jsxs("div",{className:`py-3 ${s?"px-5":"px-2"}`,style:{borderTop:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"space-y-0.5",children:gs.map(g=>e.jsx(b,{item:g,compact:!0},g.id))}),e.jsxs("button",{onClick:i,onMouseEnter:()=>d("logout"),onMouseLeave:()=>d(null),title:s?void 0:"Salir",className:`w-full flex items-center rounded-xl text-[var(--text-dim)] hover:text-[var(--red)] transition-all duration-200 mt-1 relative
            ${s?"px-3 py-2.5 gap-3":"px-0 py-2.5 justify-center"}
            hover:bg-[var(--red)]/[0.06]`,children:[e.jsx("div",{className:`flex items-center justify-center shrink-0 rounded-lg ${s?"w-8 h-8":"w-9 h-9"}`,children:e.jsx(_t,{size:s?16:18,strokeWidth:1.5})}),s&&e.jsx("span",{className:"text-[14px] font-medium",children:"Cerrar SesiÃ³n"}),e.jsx(se,{children:!s&&c==="logout"&&e.jsx(O.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 z-50 pointer-events-none",children:e.jsx("div",{className:"bg-[var(--dark-3)] border border-[var(--border-light)] px-3 py-2 rounded-lg shadow-xl",children:e.jsx("p",{className:"text-xs font-semibold text-[var(--red)] whitespace-nowrap",children:"Cerrar SesiÃ³n"})})})})]})]}),e.jsx("button",{onClick:a,className:"absolute -right-3 top-7 w-6 h-6 bg-[var(--dark-3)] border border-[var(--border)] rounded-full flex items-center justify-center text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 hover:bg-[var(--dark-4)] transition-all z-10 shadow-lg",children:s?e.jsx(Ge,{size:11}):e.jsx(we,{size:11})})]})}const Ce="KAIROS",Ie="USDT";function be(u){return u?u.endsWith(Ce)?u.replace(Ce,Ie):u:"BTCUSDT"}function fs(u){return u?u.endsWith(Ie)?u.replace(Ie,Ce):u:"BTCKAIROS"}function Pe(u){return u?u.endsWith(Ce)?u.replace(Ce,""):u.endsWith(Ie)?u.replace(Ie,""):u.slice(0,3):"BTC"}function de(u){return`${Pe(u)} / ${Ce}`}function vs(){const{selectedPair:u,currentPrice:t,priceChange24h:s,toggleAiPanel:a,aiPanelOpen:r,brokers:l,activeBroker:i}=J(),n=l.some(p=>p.connected),c=i||l.find(p=>p.connected),[d,h]=P.useState(!1);return e.jsxs("header",{className:"h-[56px] shrink-0 flex items-center justify-between px-5",style:{borderBottom:"1px solid rgba(26,29,38,0.6)",background:"linear-gradient(180deg, rgba(14,16,21,0.95) 0%, rgba(8,9,12,0.95) 100%)",backdropFilter:"blur(16px)"},children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0 flex-1 overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:"linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.04))",border:"1px solid rgba(59,130,246,0.1)"},children:e.jsx("span",{className:"text-[var(--gold)]",children:Pe(u).slice(0,3)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-[14px] font-bold text-[var(--text)] tracking-wide leading-none",children:de(u)}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/60 font-medium",children:"Spot Trading"})]})]}),e.jsx("div",{className:"w-px h-7 bg-[var(--border)]/50 shrink-0"}),t&&e.jsx("div",{className:"shrink-0",children:e.jsxs("span",{className:"text-[16px] font-mono font-bold text-[var(--text)] leading-none whitespace-nowrap",children:["$",t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})}),s!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-xs font-mono font-semibold px-2.5 py-1 rounded-lg
              ${s>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,style:{border:`1px solid ${s>=0?"rgba(14,203,129,0.12)":"rgba(246,70,93,0.12)"}`},children:[s>=0?e.jsx(ge,{size:12}):e.jsx(Ee,{size:12}),s>=0?"+":"",s==null?void 0:s.toFixed(2),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]/40 font-medium shrink-0",children:"24h"})]})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-3",children:[e.jsxs("div",{className:`flex items-center gap-1.5 text-[11px] px-3 py-1.5 rounded-lg transition-all
          ${n?"text-[var(--green)] bg-[var(--green)]/[0.06] border border-[var(--green)]/10":"text-[var(--text-dim)] bg-white/[0.02] border border-[var(--border)]/50"}`,children:[n?e.jsx(Rt,{size:12}):e.jsx(Dt,{size:12}),e.jsx("span",{className:"font-semibold truncate max-w-[100px]",children:n&&c?c.name||c.broker:"Demo"}),n&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--green)] animate-pulse"})]}),e.jsxs("button",{onClick:a,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all border
            ${r?"bg-[var(--gold)]/10 text-[var(--gold)] border-[var(--gold)]/15":"text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border-[var(--border)]/50 hover:border-[var(--gold)]/20"}`,title:"Kairos AI",children:[e.jsx($e,{size:13}),e.jsx("span",{children:"AI"}),r&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gold)] animate-pulse"})]}),e.jsxs("button",{className:"p-2 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] bg-white/[0.02] border border-[var(--border)]/50 hover:border-[var(--border)] transition-all relative",children:[e.jsx(Te,{size:15}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-[var(--gold)] rounded-full shadow-[0_0_6px_rgba(59,130,246,0.4)]"})]})]})]})}const lt=[{icon:ge,label:"Trading Profesional",desc:"GrÃ¡ficos TradingView con datos en tiempo real de Binance"},{icon:Ne,label:"Bots Automatizados",desc:"Grid, DCA y bots de seÃ±ales ejecutan trades 24/7"},{icon:Le,label:"Kairos AI",desc:"Asistente con IA que analiza mercados y genera estrategias"},{icon:fe,label:"Simulador Pro",desc:"Paper trading con $10,000 virtuales y datos reales"}],ys=[{value:"50+",label:"Pares de Trading"},{value:"6",label:"Exchanges"},{value:"24/7",label:"AutomatizaciÃ³n"},{value:"<1ms",label:"Latencia"}];function js(){const{login:u}=J(),[t,s]=P.useState(!0),[a,r]=P.useState({email:"",password:"",name:""}),[l,i]=P.useState(""),[n,c]=P.useState(!1),[d,h]=P.useState(!1),[p,o]=P.useState(0);P.useEffect(()=>{const m=setInterval(()=>{o(g=>(g+1)%lt.length)},3e3);return()=>clearInterval(m)},[]);const b=async m=>{if(m.preventDefault(),i(""),!a.email||!a.password){i("Completa todos los campos");return}if(!t&&!a.name){i("Ingresa tu nombre");return}if(a.password.length<6){i("La contraseÃ±a debe tener al menos 6 caracteres");return}c(!0),setTimeout(()=>{u({id:Date.now().toString(36),email:a.email,name:a.name||a.email.split("@")[0],plan:"free",createdAt:new Date().toISOString()}),c(!1)},800)};return e.jsxs("div",{className:"min-h-screen bg-[var(--dark)] flex relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[700px] h-[700px] rounded-full opacity-[0.03]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute bottom-[-20%] left-[-10%] w-[600px] h-[600px] rounded-full opacity-[0.02]",style:{background:"radial-gradient(circle, #60A5FA 0%, transparent 65%)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[900px] h-[900px] rounded-full opacity-[0.015]",style:{background:"radial-gradient(circle, #3B82F6 0%, transparent 50%)"}}),e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",style:{backgroundImage:"linear-gradient(rgba(59,130,246,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(59,130,246,0.3) 1px, transparent 1px)",backgroundSize:"60px 60px"}})]}),e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col justify-between p-12 relative",children:[e.jsx(O.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center relative",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25), inset 0 1px 0 rgba(255,255,255,0.15)"},children:e.jsx("span",{className:"text-white font-extrabold text-lg",children:"K"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[17px] font-extrabold text-[var(--text)] tracking-wide",children:"KAIROS"}),e.jsx("span",{className:"text-[11px] font-bold text-gradient-gold tracking-[0.2em]",children:"TRADE"})]}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)] font-medium tracking-[0.15em] uppercase",children:"by Kairos 777 Inc"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-lg",children:[e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7,delay:.2},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-r from-transparent to-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)] tracking-[0.2em] uppercase",children:"Professional Trading Platform"}),e.jsx("div",{className:"h-px flex-1 max-w-[40px] bg-gradient-to-l from-transparent to-[var(--gold)]"})]}),e.jsxs("h2",{className:"text-4xl font-extrabold text-[var(--text)] leading-[1.15] mb-4 tracking-tight",children:["Automatiza tu Trading",e.jsx("br",{}),e.jsx("span",{className:"text-gradient-gold",children:"con Inteligencia."})]}),e.jsx("p",{className:"text-[15px] text-[var(--text-secondary)] leading-relaxed mb-10 max-w-md",children:"Conecta tu exchange favorito y deja que nuestros bots inteligentes operen por ti. Datos en tiempo real, ejecuciÃ³n automÃ¡tica, resultados profesionales."})]}),e.jsx("div",{className:"space-y-3 mb-10",children:lt.map((m,g)=>{const f=m.icon,k=g===p;return e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+g*.1},className:`flex items-start gap-4 p-3.5 rounded-xl transition-all duration-500 cursor-default ${k?"glass-gold":"bg-transparent"}`,onMouseEnter:()=>o(g),children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all duration-500
                    ${k?"bg-gradient-to-br from-[var(--gold)] to-[var(--gold-dark)] shadow-[0_0_20px_rgba(59,130,246,0.2)]":"bg-[var(--surface-2)] border border-[var(--border)]"}`,children:e.jsx(f,{size:18,className:`transition-colors duration-500 ${k?"text-white":"text-[var(--text-dim)]"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-[13px] font-bold transition-colors duration-500 ${k?"text-[var(--text)]":"text-[var(--text-secondary)]"}`,children:m.label}),e.jsx("p",{className:`text-[11px] mt-0.5 transition-colors duration-500 ${k?"text-[var(--text-secondary)]":"text-[var(--text-dim)]"}`,children:m.desc})]})]},m.label)})}),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"flex gap-6",children:ys.map(m=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-extrabold text-gradient-gold",children:m.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] font-medium mt-0.5",children:m.label})]},m.label))})]}),e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"relative z-10 flex items-center justify-between",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/40",children:"Â© 2026 Kairos 777 Inc. Todos los derechos reservados."}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("span",{className:"text-[10px] text-[var(--green)] font-semibold",children:"Sistemas operacionales"})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 lg:max-w-[480px] relative z-10",children:e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-[380px]",children:[e.jsxs("div",{className:"text-center mb-8 lg:hidden",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center text-white font-extrabold text-xl mx-auto mb-3",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 0 30px rgba(59,130,246,0.25)"},children:"K"}),e.jsxs("h1",{className:"text-xl font-extrabold tracking-tight",children:[e.jsx("span",{className:"text-gradient-gold",children:"KAIROS"})," ",e.jsx("span",{className:"text-[var(--text)]",children:"TRADE"})]})]}),e.jsxs("div",{className:"mb-7",children:[e.jsx("h2",{className:"text-2xl font-extrabold text-[var(--text)] tracking-tight",children:t?"Bienvenido.":"Empieza a operar."}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1.5",children:t?"Accede a tu plataforma de trading":"Crea tu cuenta en 30 segundos"})]}),e.jsxs("div",{className:"flex mb-7 rounded-xl p-1 glass",children:[e.jsx("button",{onClick:()=>{s(!0),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${t?"text-white font-bold shadow-lg":"text-[var(--text-dim)] font-medium hover:text-[var(--text)]"}`,style:t?{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"}:{},children:"Iniciar SesiÃ³n"}),e.jsx("button",{onClick:()=>{s(!1),i("")},className:`flex-1 py-2.5 text-sm rounded-lg transition-all duration-300 ${t?"text-[var(--text-dim)] font-medium hover:text-[var(--text)]":"text-white font-bold shadow-lg"}`,style:t?{}:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.3)"},children:"Registrarse"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx(se,{mode:"wait",children:!t&&e.jsxs(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{type:"text",value:a.name,onChange:m=>r({...a,name:m.target.value}),placeholder:"Tu nombre completo",className:"w-full",autoComplete:"name"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:m=>r({...a,email:m.target.value}),placeholder:"tu@email.com",className:"w-full",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-semibold uppercase tracking-wider",children:"ContraseÃ±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:d?"text":"password",value:a.password,onChange:m=>r({...a,password:m.target.value}),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full pr-10",autoComplete:t?"current-password":"new-password"}),e.jsx("button",{type:"button",onClick:()=>h(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:d?e.jsx(ft,{size:15}):e.jsx(vt,{size:15})})]})]}),e.jsx(se,{children:l&&e.jsx(O.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},className:"text-xs text-[var(--red)] bg-[var(--red)]/[0.06] border border-[var(--red)]/10 px-3.5 py-2.5 rounded-xl",children:l})}),e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3.5 rounded-xl transition-all duration-300 disabled:opacity-50 flex items-center justify-center gap-2 text-sm btn-gold",children:n?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[t?"Acceder a la Plataforma":"Crear Cuenta",e.jsx(st,{size:16})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-medium",children:"ECOSISTEMA"}),e.jsx("div",{className:"flex-1 h-px bg-[var(--border)]"})]}),e.jsxs("a",{href:"https://kairos-777.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--gold)] transition-all border border-[var(--border)] hover:border-[var(--gold)]/20",children:[e.jsx(bt,{size:14,className:"text-[var(--gold)]"}),"Conoce el ecosistema Kairos 777"]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]/30 text-center mt-5",children:["Parte del ecosistema ",e.jsx("span",{className:"text-[var(--gold)] font-semibold",children:"Kairos 777"})]})]})})]})}const ct=["https://api.binance.us/api/v3","https://api.binance.com/api/v3"],ve=["wss://stream.binance.us:9443/ws","wss://stream.binance.com:9443/ws"];class Ns{constructor(){this.ws=null,this.subscribers=new Map,this.reconnectAttempts=0,this.maxReconnect=5,this.candleCache=new Map,this._apiBase=null,this._wsBase=null}async _getAPI(){if(this._apiBase)return this._apiBase;for(const t of ct)try{const s=new AbortController,a=setTimeout(()=>s.abort(),5e3),r=await fetch(`${t}/ping`,{signal:s.signal});if(clearTimeout(a),r.ok)return this._apiBase=t,this._wsBase=t.includes("binance.us")?ve[0]:ve[1],console.log("Kairos MarketData: using",t),t}catch{}return this._apiBase=ct[0],this._wsBase=ve[0],this._apiBase}connectStream(t,s={}){const a=t.toLowerCase(),r=this._wsBase||ve[0],l=`${r}/${a}@ticker/${a}@kline_1m`;return this.ws&&this.ws.close(),this.ws=new WebSocket(l),this.ws.onopen=()=>{var i;this.reconnectAttempts=0,(i=s.onConnect)==null||i.call(s)},this.ws.onmessage=i=>{var n,c;try{const d=JSON.parse(i.data);if(d.e==="24hrTicker"&&((n=s.onTicker)==null||n.call(s,{symbol:d.s,price:parseFloat(d.c),change:parseFloat(d.p),changePercent:parseFloat(d.P),high:parseFloat(d.h),low:parseFloat(d.l),volume:parseFloat(d.v),quoteVolume:parseFloat(d.q)})),d.e==="kline"){const h=d.k;(c=s.onCandle)==null||c.call(s,{time:Math.floor(h.t/1e3),open:parseFloat(h.o),high:parseFloat(h.h),low:parseFloat(h.l),close:parseFloat(h.c),volume:parseFloat(h.v),closed:h.x})}}catch(d){console.error("WS parse error:",d)}},this.ws.onerror=i=>{var n;if(console.error("WS error:",i),r===ve[1]&&this.reconnectAttempts===0){this._wsBase=ve[0],this.connectStream(t,s);return}(n=s.onError)==null||n.call(s,i)},this.ws.onclose=()=>{var i;this.reconnectAttempts<this.maxReconnect&&(this.reconnectAttempts++,setTimeout(()=>this.connectStream(t,s),2e3*this.reconnectAttempts)),(i=s.onDisconnect)==null||i.call(s)},()=>this.disconnect()}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}async getCandles(t,s="1h",a=500){const r=`${t}_${s}`,l=await this._getAPI();try{const i=new AbortController,n=setTimeout(()=>i.abort(),1e4),c=`${l}/klines?symbol=${t}&interval=${s}&limit=${a}`,d=await fetch(c,{signal:i.signal});if(clearTimeout(n),!d.ok)throw new Error(`HTTP ${d.status}`);const p=(await d.json()).map(o=>({time:Math.floor(o[0]/1e3),open:parseFloat(o[1]),high:parseFloat(o[2]),low:parseFloat(o[3]),close:parseFloat(o[4]),volume:parseFloat(o[5])}));return this.candleCache.set(r,{data:p,ts:Date.now()}),p}catch(i){if(console.error("getCandles error:",i.message),this._apiBase){this._apiBase=null;const c=await this._getAPI();if(c)try{const d=await fetch(`${c}/klines?symbol=${t}&interval=${s}&limit=${a}`);if(d.ok){const p=(await d.json()).map(o=>({time:Math.floor(o[0]/1e3),open:parseFloat(o[1]),high:parseFloat(o[2]),low:parseFloat(o[3]),close:parseFloat(o[4]),volume:parseFloat(o[5])}));return this.candleCache.set(r,{data:p,ts:Date.now()}),p}}catch{}}const n=this.candleCache.get(r);if(n)return n.data;throw i}}async getPrice(t){const s=await this._getAPI(),r=await(await fetch(`${s}/ticker/price?symbol=${t}`)).json();return parseFloat(r.price)}async get24hrTicker(t){const s=await this._getAPI(),r=await(await fetch(`${s}/ticker/24hr?symbol=${t}`)).json();return{symbol:r.symbol,price:parseFloat(r.lastPrice),change:parseFloat(r.priceChange),changePercent:parseFloat(r.priceChangePercent),high:parseFloat(r.highPrice),low:parseFloat(r.lowPrice),volume:parseFloat(r.volume),quoteVolume:parseFloat(r.quoteVolume)}}async getOrderBook(t,s=20){const a=await this._getAPI(),l=await(await fetch(`${a}/depth?symbol=${t}&limit=${s}`)).json();return{bids:l.bids.map(([i,n])=>({price:parseFloat(i),quantity:parseFloat(n)})),asks:l.asks.map(([i,n])=>({price:parseFloat(i),quantity:parseFloat(n)}))}}async searchSymbols(t){const s=await this._getAPI(),r=await(await fetch(`${s}/exchangeInfo`)).json(),l=t.toUpperCase();return r.symbols.filter(i=>i.status==="TRADING"&&(i.symbol.includes(l)||i.baseAsset.includes(l))).slice(0,20).map(i=>({symbol:i.symbol,base:i.baseAsset,quote:i.quoteAsset}))}}const Y=new Ns;function dt(){const{setPage:u,bots:t,brokers:s,tradeHistory:a,positions:r,user:l}=J(),[i,n]=P.useState([]),[c,d]=P.useState(!0);P.useEffect(()=>{h();const f=setInterval(h,3e4);return()=>clearInterval(f)},[]);const h=async()=>{try{const f=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"],k=await Promise.all(f.map(async N=>{try{return await Y.get24hrTicker(N)}catch{return null}}));n(k.filter(Boolean))}catch(f){console.error("Dashboard load error:",f)}d(!1)},p=t.filter(f=>f.status==="active"),o=a.reduce((f,k)=>f+(k.pnl||0),0),b=s.filter(f=>f.connected),m=[{label:"Bots Activos",value:p.length,icon:Ne,color:"#3B82F6",gradient:"linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.02))",border:"rgba(59,130,246,0.1)",action:"bots"},{label:"Brokers",value:`${b.length}/${s.length}`,icon:tt,color:"#A855F7",gradient:"linear-gradient(135deg, rgba(168,85,247,0.1), rgba(168,85,247,0.02))",border:"rgba(168,85,247,0.1)",action:"brokers"},{label:"Posiciones",value:r.length,icon:Ye,color:"#00DC82",gradient:"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))",border:"rgba(0,220,130,0.1)",action:"history"},{label:"P&L Total",value:`${o>=0?"+":""}$${o.toFixed(2)}`,icon:Se,color:o>=0?"#00DC82":"#FF4757",gradient:o>=0?"linear-gradient(135deg, rgba(0,220,130,0.1), rgba(0,220,130,0.02))":"linear-gradient(135deg, rgba(255,71,87,0.1), rgba(255,71,87,0.02))",border:o>=0?"rgba(0,220,130,0.1)":"rgba(255,71,87,0.1)",action:"history"}],g=[{label:"Trading",icon:ue,page:"chart",desc:"GrÃ¡ficos profesionales",color:"#3B82F6"},{label:"Simulador",icon:he,page:"simulator",desc:"Paper trading sin riesgo",color:"#00DC82"},{label:"Kairos AI",icon:Le,page:"ai",desc:"Asistente inteligente",color:"#A855F7"},{label:"Crear Bot",icon:Ne,page:"bots",desc:"Automatiza tu trading",color:"#60A5FA"},{label:"Estrategias",icon:ne,page:"strategies",desc:"Crea y gestiona",color:"#EC4899"},{label:"Brokers",icon:fe,page:"brokers",desc:"Conecta tu cuenta",color:"#22D3EE"}];return e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",style:{maxWidth:"100%"},children:[e.jsxs(O.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-[22px] font-bold tracking-tight truncate",children:["Bienvenido, ",e.jsx("span",{className:"text-[var(--gold)]",children:(l==null?void 0:l.name)||"Trader"})]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-0.5",children:"Tu centro de control de trading automatizado"})]}),e.jsxs("button",{onClick:()=>u("chart"),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-semibold transition-all hover:opacity-90 btn-gold shrink-0",children:[e.jsx(ue,{size:14}),"Trading"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:m.map((f,k)=>{const N=f.icon;return e.jsxs(O.button,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:k*.06},onClick:()=>u(f.action),className:"rounded-xl p-4 text-left transition-all duration-200 hover:scale-[1.02] group",style:{background:f.gradient,border:`1px solid ${f.border}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center",style:{background:`${f.color}15`},children:e.jsx(N,{size:18,style:{color:f.color}})}),e.jsx(we,{size:14,className:"text-[var(--text-dim)]/30 group-hover:text-[var(--text-dim)] transition-colors"})]}),e.jsx("p",{className:"text-[22px] font-bold leading-none truncate",style:{color:f.color},children:f.value}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 font-medium truncate",children:f.label})]},f.label)})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold text-[var(--text)] mb-3 flex items-center gap-2",children:[e.jsx(ne,{size:14,className:"text-[var(--gold)]"}),"Acceso RÃ¡pido"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2.5",children:g.map((f,k)=>{const N=f.icon;return e.jsxs(O.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2+k*.05},onClick:()=>u(f.page),className:"rounded-xl p-4 text-left transition-all duration-200 group hover:scale-[1.01]",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},onMouseEnter:F=>F.currentTarget.style.borderColor=`${f.color}30`,onMouseLeave:F=>F.currentTarget.style.borderColor="rgba(30,34,45,0.5)",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center mb-3 transition-transform group-hover:scale-110",style:{background:`${f.color}12`},children:e.jsx(N,{size:20,style:{color:f.color}})}),e.jsx("p",{className:"text-[13px] font-bold text-[var(--text)] truncate",children:f.label}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-0.5 truncate",children:f.desc})]},f.label)})})]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{size:14,className:"text-[var(--gold)]"}),e.jsx("h2",{className:"text-sm font-bold",children:"Mercado en Tiempo Real"})]}),e.jsxs("button",{onClick:()=>u("chart"),className:"text-[11px] text-[var(--gold)] hover:text-[var(--gold-light)] font-semibold flex items-center gap-1 transition-colors",children:["Ver grÃ¡fico ",e.jsx(we,{size:12})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 px-4 py-2 text-[10px] font-bold text-[var(--text-dim)]/50 uppercase tracking-wider",children:[e.jsx("span",{children:"Par"}),e.jsx("span",{className:"text-right",children:"Precio"}),e.jsx("span",{className:"text-right",children:"Cambio 24h"}),e.jsx("span",{className:"text-right",children:"AcciÃ³n"})]}),e.jsx("div",{className:"divide-y divide-[var(--border)]/30",children:c?e.jsx("div",{className:"p-8 text-center text-sm text-[var(--text-dim)] animate-pulse",children:"Cargando mercado..."}):i.map((f,k)=>e.jsxs(O.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:k*.05},onClick:()=>{J.getState().setSelectedPair(fs(f.symbol)),u("chart")},className:"group w-full grid grid-cols-4 gap-2 items-center px-4 py-3 hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold",style:{background:f.changePercent>=0?"rgba(14,203,129,0.08)":"rgba(246,70,93,0.08)"},children:e.jsx("span",{className:f.changePercent>=0?"text-[var(--green)]":"text-[var(--red)]",children:Pe(f.symbol).slice(0,3)})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[13px] font-bold leading-none",children:Pe(f.symbol)}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]/50 mt-0.5",children:"KAIROS"})]})]}),e.jsxs("p",{className:"text-[13px] font-mono font-semibold text-right",children:["$",f.price.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsx("div",{className:"flex items-center gap-1 justify-end",children:e.jsxs("span",{className:`flex items-center gap-0.5 text-xs font-mono font-semibold px-2 py-0.5 rounded-md
                  ${f.changePercent>=0?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:[f.changePercent>=0?e.jsx(Mt,{size:10}):e.jsx(yt,{size:10}),f.changePercent>=0?"+":"",f.changePercent.toFixed(2),"%"]})}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-[10px] font-semibold text-[var(--gold)] opacity-0 group-hover:opacity-100 transition-opacity bg-[var(--gold)]/10 px-2 py-1 rounded-md",children:"Trading â†’"})})]},f.symbol))})]})]})}function ae(u,t){const s=2/(t+1),a=[u[0]];for(let r=1;r<u.length;r++)a.push(u[r]*s+a[r-1]*(1-s));return a}function qe(u,t){const s=[];for(let a=0;a<u.length;a++){if(a<t-1){s.push(null);continue}const r=u.slice(a-t+1,a+1);s.push(r.reduce((l,i)=>l+i,0)/t)}return s}function me(u,t=14){const s=new Array(t).fill(null);let a=0,r=0;for(let l=1;l<=t;l++){const i=u[l]-u[l-1];i>0?a+=i:r+=Math.abs(i)}a/=t,r/=t,s.push(r===0?100:100-100/(1+a/r));for(let l=t+1;l<u.length;l++){const i=u[l]-u[l-1];a=(a*(t-1)+(i>0?i:0))/t,r=(r*(t-1)+(i<0?Math.abs(i):0))/t,s.push(r===0?100:100-100/(1+a/r))}return s}function Be(u,t=12,s=26,a=9){const r=ae(u,t),l=ae(u,s),i=r.map((d,h)=>d-l[h]),n=ae(i,a),c=i.map((d,h)=>d-n[h]);return{macd:i,signal:n,histogram:c}}function at(u,t=20,s=2){const a=qe(u,t),r=[],l=[];for(let i=0;i<u.length;i++){if(i<t-1){r.push(null),l.push(null);continue}const n=u.slice(i-t+1,i+1),c=a[i],d=n.reduce((p,o)=>p+Math.pow(o-c,2),0)/t,h=Math.sqrt(d)*s;r.push(c+h),l.push(c-h)}return{upper:r,middle:a,lower:l}}function Pt(u){let t=0,s=0;return u.map(a=>{const r=(a.high+a.low+a.close)/3;return s+=r*a.volume,t+=a.volume,t>0?s/t:r})}function Ae(u,t,s){if(s<1)return null;const a=u[s-1],r=u[s],l=t[s-1],i=t[s];return a<=l&&r>i?"bullish_cross":a>=l&&r<i?"bearish_cross":null}function ws(u,t,s=14){if(u.length<s*2)return null;const a=u.length,r=Math.max(...u.slice(a-s)),l=Math.max(...u.slice(a-s*2,a-s)),i=Math.max(...t.slice(a-s).filter(c=>c!==null)),n=Math.max(...t.slice(a-s*2,a-s).filter(c=>c!==null));return r>l&&i<n?"bearish_divergence":r<l&&i>n?"bullish_divergence":null}function Ss(){const u=P.useRef(null),t=P.useRef(null),s=P.useRef(null),a=P.useRef(null),r=P.useRef([]),l=P.useRef(null),{selectedPair:i,selectedTimeframe:n,setSelectedPair:c,setSelectedTimeframe:d,setCurrentPrice:h,setPriceChange24h:p}=J(),[o,b]=P.useState(!0),[m,g]=P.useState(null),[f,k]=P.useState(!1),[N,F]=P.useState(""),[v,w]=P.useState(["ema20"]);P.useEffect(()=>{const y=u.current;if(!y)return;const E=y.getBoundingClientRect(),C=E.width||y.clientWidth||800,R=E.height||y.clientHeight||500,_=ls(y,{width:C,height:R,layout:{background:{type:ds.Solid,color:"#0B0E11"},textColor:"#848E9C",fontFamily:"Inter, sans-serif",fontSize:11},grid:{vertLines:{color:"#1E222D"},horzLines:{color:"#1E222D"}},crosshair:{mode:cs.Normal,vertLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"},horzLine:{color:"#3B82F6",width:1,style:2,labelBackgroundColor:"#3B82F6"}},timeScale:{borderColor:"#1E222D",timeVisible:!0,secondsVisible:!1,rightOffset:5,barSpacing:8},rightPriceScale:{borderColor:"#1E222D",scaleMargins:{top:.05,bottom:.2}},handleScroll:{mouseWheel:!0,pressedMouseMove:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0}}),K=_.addCandlestickSeries({upColor:"#0ECB81",downColor:"#F6465D",borderUpColor:"#0ECB81",borderDownColor:"#F6465D",wickUpColor:"#0ECB81",wickDownColor:"#F6465D"}),L=_.addHistogramSeries({color:"#3B82F622",priceFormat:{type:"volume"},priceScaleId:"volume"});_.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0}}),t.current=_,s.current=K,a.current=L;const M=()=>{const B=y.getBoundingClientRect();B.width>0&&B.height>0&&_.applyOptions({width:B.width,height:B.height})};requestAnimationFrame(M),setTimeout(M,100),setTimeout(M,300);const $=new ResizeObserver(B=>{if(!B||!B[0])return;const{width:q,height:Z}=B[0].contentRect;q>0&&Z>0&&_.applyOptions({width:q,height:Z})});return $.observe(y),()=>{$.disconnect(),_.remove(),t.current=null,s.current=null,a.current=null}},[]),P.useEffect(()=>{let y=!1;return(async()=>{b(!0),g(null);try{const C=be(i),[R,_]=await Promise.all([Y.getCandles(C,n,500),Y.get24hrTicker(C)]);if(y)return;if(!R||R.length===0){g("No se recibieron datos de Binance"),b(!1);return}s.current&&s.current.setData(R),a.current&&a.current.setData(R.map(K=>({time:K.time,value:K.volume||0,color:K.close>=K.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"}))),h(_.price),p(_.changePercent);try{S(R)}catch(K){console.warn("Indicator error (non-fatal):",K)}t.current&&t.current.timeScale().fitContent()}catch(C){console.error("Chart data load error:",C),y||g(`Error cargando datos: ${C.message}`)}y||b(!1)})(),l.current&&l.current(),l.current=Y.connectStream(be(i),{onTicker:C=>{h(C.price),p(C.changePercent)},onCandle:C=>{s.current&&s.current.update(C),a.current&&a.current.update({time:C.time,value:C.volume||0,color:C.close>=C.open?"rgba(14,203,129,0.2)":"rgba(246,70,93,0.2)"})}}),()=>{y=!0,l.current&&(l.current(),l.current=null)}},[i,n]);const S=y=>{if(!t.current)return;r.current.forEach(R=>{var _;try{(_=t.current)==null||_.removeSeries(R)}catch{}}),r.current=[];const E=y.map(R=>R.close),C=y.map(R=>R.time);v.forEach(R=>{try{if(R==="ema20"){const K=ae(E,20).map((L,M)=>L!=null&&isFinite(L)?{time:C[M],value:L}:null).filter(Boolean);if(K.length>0){const L=t.current.addLineSeries({color:"#3B82F6",lineWidth:1.5,title:"EMA 20",lastValueVisible:!1,priceLineVisible:!1});L.setData(K),r.current.push(L)}}if(R==="ema50"){const K=ae(E,50).map((L,M)=>L!=null&&isFinite(L)?{time:C[M],value:L}:null).filter(Boolean);if(K.length>0){const L=t.current.addLineSeries({color:"#8B5CF6",lineWidth:1.5,title:"EMA 50",lastValueVisible:!1,priceLineVisible:!1});L.setData(K),r.current.push(L)}}if(R==="sma200"){const K=qe(E,200).map((L,M)=>L!=null&&isFinite(L)?{time:C[M],value:L}:null).filter(Boolean);if(K.length>0){const L=t.current.addLineSeries({color:"#FF6D00",lineWidth:1,title:"SMA 200",lastValueVisible:!1,priceLineVisible:!1});L.setData(K),r.current.push(L)}}if(R==="bb"){const _=at(E),K=_.upper.map((M,$)=>M!=null&&isFinite(M)?{time:C[$],value:M}:null).filter(Boolean),L=_.lower.map((M,$)=>M!=null&&isFinite(M)?{time:C[$],value:M}:null).filter(Boolean);if(K.length>0){const M=t.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Upper",lastValueVisible:!1,priceLineVisible:!1}),$=t.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Lower",lastValueVisible:!1,priceLineVisible:!1});M.setData(K),$.setData(L),r.current.push(M,$)}}}catch(_){console.warn(`Indicator ${R} error:`,_)}})};P.useEffect(()=>{if(!s.current)return;(async()=>{try{const E=await Y.getCandles(be(i),n,500);S(E)}catch{}})()},[v]);const j=y=>{w(E=>E.includes(y)?E.filter(C=>C!==y):[...E,y])};return e.jsxs("div",{className:"flex flex-col w-full flex-1 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 shrink-0 flex-wrap",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>k(!f),className:"flex items-center gap-1.5 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Ot,{size:13,className:"text-[var(--text-dim)]"}),de(i)]}),f&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2",children:[e.jsx("input",{type:"text",value:N,onChange:y=>F(y.target.value.toUpperCase()),placeholder:"Buscar par...",className:"w-full text-sm mb-2",autoFocus:!0}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:Ct.filter(y=>y.includes(N)).map(y=>e.jsx("button",{onClick:()=>{c(y),k(!1),F("")},className:`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors
                        ${y===i?"bg-[var(--gold)]/15 text-[var(--gold)]":"text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]"}`,children:de(y)},y))})]})]}),e.jsx("div",{className:"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5",children:Ze.map(y=>e.jsx("button",{onClick:()=>d(y.value),className:`px-2.5 py-1 text-xs rounded-md transition-colors
                ${n===y.value?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:y.label},y.value))}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(ge,{size:13,className:"text-[var(--text-dim)]"}),[{id:"ema20",label:"EMA 20",color:"#3B82F6"},{id:"ema50",label:"EMA 50",color:"#8B5CF6"},{id:"sma200",label:"SMA 200",color:"#FF6D00"},{id:"bb",label:"BB",color:"#9C27B0"}].map(y=>e.jsx("button",{onClick:()=>j(y.id),className:`px-2 py-0.5 text-[11px] rounded transition-all
                ${v.includes(y.id)?"font-semibold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:v.includes(y.id)?{color:y.color,background:`${y.color}15`}:{},children:y.label},y.id))]})]}),e.jsxs("div",{ref:u,className:"relative",style:{flex:"1 1 0%",minHeight:0,overflow:"hidden"},children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.85)"},children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-[var(--gold)] border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-xs text-[var(--text-dim)]",children:["Cargando ",de(i),"..."]})]})}),m&&!o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",style:{background:"rgba(11,14,17,0.9)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-[var(--red)] mb-2",children:m}),e.jsx("button",{onClick:()=>{g(null),b(!0)},className:"px-4 py-2 text-xs bg-[var(--gold)] text-white rounded-lg font-semibold",children:"Reintentar"})]})})]})]})}const ks="https://api.binance.com/api/v3/depth";function Cs({pair:u="BTCUSDT",height:t=260}){const s=P.useRef(null),[a,r]=P.useState(null),[l,i]=P.useState(null),n=P.useRef(null),c=P.useCallback(async()=>{try{const p=await fetch(`${ks}?symbol=${u}&limit=100`);if(!p.ok)return;const o=await p.json();r(o)}catch{}},[u]);P.useEffect(()=>{c();const p=setInterval(c,3e3);return()=>clearInterval(p)},[c]);const d=P.useCallback(()=>{var I,z;const p=s.current;if(!p||!a)return;const o=p.getContext("2d"),b=window.devicePixelRatio||1,m=p.clientWidth,g=p.clientHeight;p.width=m*b,p.height=g*b,o.scale(b,b),o.clearRect(0,0,m,g);const f=a.bids.map(([x,A])=>[parseFloat(x),parseFloat(A)]),k=a.asks.map(([x,A])=>[parseFloat(x),parseFloat(A)]);if(!f.length||!k.length)return;const N=[];let F=0;for(const[x,A]of f)F+=A,N.push([x,F]);const v=[];let w=0;for(const[x,A]of k)w+=A,v.push([x,w]);const S=(f[0][0]+k[0][0])/2,j=Math.max(((I=N[N.length-1])==null?void 0:I[1])||0,((z=v[v.length-1])==null?void 0:z[1])||0),y=[...N.map(x=>x[0]),...v.map(x=>x[0])],E=Math.min(...y),C=Math.max(...y),R=C-E||1,_={top:10,bottom:25,left:0,right:0},K=m-_.left-_.right,L=g-_.top-_.bottom,M=x=>_.left+(x-E)/R*K,$=x=>_.top+L-x/j*L;o.beginPath(),o.moveTo(M(N[0][0]),$(0));for(const[x,A]of N)o.lineTo(M(x),$(A));o.lineTo(M(N[N.length-1][0]),$(0)),o.closePath();const B=o.createLinearGradient(0,0,0,g);B.addColorStop(0,"rgba(0,220,130,0.25)"),B.addColorStop(1,"rgba(0,220,130,0.02)"),o.fillStyle=B,o.fill(),o.beginPath();for(let x=0;x<N.length;x++){const[A,T]=N[x];x===0?o.moveTo(M(A),$(T)):o.lineTo(M(A),$(T))}o.strokeStyle="#00DC82",o.lineWidth=1.5,o.stroke(),o.beginPath(),o.moveTo(M(v[0][0]),$(0));for(const[x,A]of v)o.lineTo(M(x),$(A));o.lineTo(M(v[v.length-1][0]),$(0)),o.closePath();const q=o.createLinearGradient(0,0,0,g);q.addColorStop(0,"rgba(255,59,48,0.25)"),q.addColorStop(1,"rgba(255,59,48,0.02)"),o.fillStyle=q,o.fill(),o.beginPath();for(let x=0;x<v.length;x++){const[A,T]=v[x];x===0?o.moveTo(M(A),$(T)):o.lineTo(M(A),$(T))}o.strokeStyle="#FF3B30",o.lineWidth=1.5,o.stroke();const Z=M(S);if(o.beginPath(),o.setLineDash([4,4]),o.moveTo(Z,_.top),o.lineTo(Z,g-_.bottom),o.strokeStyle="#3B82F680",o.lineWidth=1,o.stroke(),o.setLineDash([]),o.fillStyle="#3B82F6",o.font="600 10px Inter, sans-serif",o.textAlign="center",o.fillText(`$${S.toFixed(2)}`,Z,g-_.bottom+14),o.fillStyle="#555",o.font="9px Inter, sans-serif",o.textAlign="left",o.fillText(`$${E.toFixed(0)}`,_.left+4,g-_.bottom+14),o.textAlign="right",o.fillText(`$${C.toFixed(0)}`,m-_.right-4,g-_.bottom+14),l&&l.x>=0&&l.x<=m){const x=E+l.x/m*R,A=x<S,T=A?N:v;let D=0;for(const[W,pe]of T)(A?W>=x:W<=x)&&(D=pe);o.beginPath(),o.setLineDash([2,2]),o.moveTo(l.x,_.top),o.lineTo(l.x,g-_.bottom),o.strokeStyle="rgba(255,255,255,0.15)",o.lineWidth=1,o.stroke(),o.setLineDash([]);const U=`$${x.toFixed(2)} â€” Vol: ${D.toFixed(4)}`,H=o.measureText(U).width+16,oe=Math.min(l.x-H/2,m-H-4);o.fillStyle="#1A1B1E",o.strokeStyle="rgba(59,130,246,0.3)",o.lineWidth=1,o.beginPath(),o.roundRect(Math.max(oe,4),_.top,H,22,4),o.fill(),o.stroke(),o.fillStyle="#fff",o.font="10px Inter, sans-serif",o.textAlign="center",o.fillText(U,Math.max(oe,4)+H/2,_.top+15)}},[a,l]);P.useEffect(()=>(n.current=requestAnimationFrame(d),()=>cancelAnimationFrame(n.current)),[d]);const h=p=>{var b;const o=(b=s.current)==null?void 0:b.getBoundingClientRect();o&&i({x:p.clientX-o.left,y:p.clientY-o.top})};return e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-xl overflow-hidden relative",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(ue,{size:14,className:"text-[var(--gold)]"})," Depth Chart"]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00DC82]"})," Bids"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#FF3B30]"})," Asks"]})]})]}),a?e.jsx("canvas",{ref:s,style:{width:"100%",height:t},onMouseMove:h,onMouseLeave:()=>i(null),className:"cursor-crosshair"}):e.jsx("div",{className:"flex items-center justify-center",style:{height:t},children:e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Cargando profundidadâ€¦"})})]})}function Ps(){const{selectedPair:u,currentPrice:t,positions:s,orders:a,addPosition:r,addOrder:l,closePosition:i,cancelOrder:n}=J(),[c,d]=P.useState("buy"),[h,p]=P.useState("market"),[o,b]=P.useState({quantity:"",price:"",stopLoss:"",takeProfit:""}),[m,g]=P.useState({bids:[],asks:[]}),[f,k]=P.useState("order");P.useEffect(()=>{N();const w=setInterval(N,5e3);return()=>clearInterval(w)},[u]);const N=async()=>{try{const w=await Y.getOrderBook(be(u),10);g(w)}catch{}},F=()=>{if(!o.quantity)return;const w=h==="market"?t:parseFloat(o.price);w&&(h==="market"?r({symbol:u,side:c,quantity:parseFloat(o.quantity),entryPrice:w,stopLoss:o.stopLoss?parseFloat(o.stopLoss):null,takeProfit:o.takeProfit?parseFloat(o.takeProfit):null,openedAt:new Date().toISOString()}):l({symbol:u,side:c,type:h,quantity:parseFloat(o.quantity),price:w,stopLoss:o.stopLoss?parseFloat(o.stopLoss):null,takeProfit:o.takeProfit?parseFloat(o.takeProfit):null,status:"open",createdAt:new Date().toISOString()}),b({quantity:"",price:"",stopLoss:"",takeProfit:""}))},v=parseFloat(o.quantity||0)*(h==="market"?t||0:parseFloat(o.price||0));return e.jsxs("div",{className:"flex flex-col h-full",style:{width:320,borderLeft:"1px solid rgba(30,34,45,0.6)"},children:[e.jsx("div",{className:"flex shrink-0 px-2 pt-2 gap-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:["order","positions","orders"].map(w=>e.jsx("button",{onClick:()=>k(w),className:`flex-1 py-2.5 text-[11px] font-bold rounded-t-lg transition-all
              ${f===w?"text-[var(--gold)] bg-[var(--gold)]/[0.06]":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:f===w?{borderBottom:"2px solid var(--gold)"}:{borderBottom:"2px solid transparent"},children:w==="order"?"Orden":w==="positions"?`Pos (${s.length})`:`Ã“rd (${a.length})`},w))}),f==="order"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("button",{onClick:()=>d("buy"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${c==="buy"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:c==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 12px rgba(14,203,129,0.25)"}:{},children:"Comprar"}),e.jsx("button",{onClick:()=>d("sell"),className:`flex-1 py-2.5 text-sm font-bold rounded-lg transition-all duration-200
                ${c==="sell"?"text-white shadow-lg":"text-[var(--text-dim)]"}`,style:c==="sell"?{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 12px rgba(246,70,93,0.25)"}:{},children:"Vender"})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-lg bg-[var(--dark-3)]",children:["market","limit","stop_loss"].map(w=>e.jsx("button",{onClick:()=>p(w),className:`flex-1 py-1.5 text-[10px] font-bold rounded-md transition-all
                  ${h===w?"bg-[var(--dark-4)] text-[var(--text)] shadow-sm":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:w==="market"?"Market":w==="limit"?"LÃ­mite":"Stop"},w))}),h!=="market"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio"}),e.jsx("input",{type:"number",value:o.price,onChange:w=>b({...o,price:w.target.value}),placeholder:t==null?void 0:t.toString(),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Cantidad"}),e.jsx("input",{type:"number",value:o.quantity,onChange:w=>b({...o,quantity:w.target.value}),placeholder:"0.001",className:"w-full text-sm"}),e.jsx("div",{className:"flex gap-1 mt-1.5",children:[25,50,75,100].map(w=>e.jsxs("button",{onClick:()=>{const S=h==="market"?t:parseFloat(o.price)||t;if(S){const y=1e4*(w/100)/S;b({...o,quantity:y.toFixed(6)})}},className:"flex-1 py-1.5 text-[10px] font-semibold rounded-md text-[var(--text-dim)] hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all",style:{background:"rgba(14,16,21,0.6)",border:"1px solid var(--border)"},children:[w,"%"]},w))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(fe,{size:9,className:"text-[var(--red)]"})," SL"]}),e.jsx("input",{type:"number",value:o.stopLoss,onChange:w=>b({...o,stopLoss:w.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 flex items-center gap-1 font-semibold uppercase tracking-wider",children:[e.jsx(Fe,{size:9,className:"text-[var(--green)]"})," TP"]}),e.jsx("input",{type:"number",value:o.takeProfit,onChange:w=>b({...o,takeProfit:w.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"rounded-lg p-3 flex items-center justify-between",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("span",{className:"text-[10px] text-[var(--text-dim)] font-semibold uppercase tracking-wider",children:"Total"}),e.jsxs("span",{className:"text-sm font-mono font-bold",children:["$",v.toFixed(2)]})]}),e.jsxs("button",{onClick:F,disabled:!o.quantity,className:"w-full py-3.5 font-bold rounded-xl text-sm transition-all duration-200 disabled:opacity-40 text-white",style:c==="buy"?{background:"linear-gradient(135deg, #0ECB81, #0AA06A)",boxShadow:"0 4px 15px rgba(14,203,129,0.25)"}:{background:"linear-gradient(135deg, #F6465D, #D32F4A)",boxShadow:"0 4px 15px rgba(246,70,93,0.25)"},children:[c==="buy"?"Comprar":"Vender"," ",Pe(u)]}),e.jsxs("div",{className:"rounded-xl p-3",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 font-bold uppercase tracking-wider",children:"Order Book"}),e.jsxs("div",{className:"space-y-[2px] text-[10px] font-mono",children:[m.asks.slice(0,5).reverse().map((w,S)=>e.jsxs("div",{className:"flex justify-between text-[var(--red)] py-0.5 px-1 rounded hover:bg-[var(--red)]/[0.04]",children:[e.jsxs("span",{children:["$",w.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:w.quantity.toFixed(4)})]},`a${S}`)),e.jsxs("div",{className:"text-center py-1.5 text-[15px] font-bold text-[var(--gold)] my-1",style:{background:"rgba(59,130,246,0.04)",borderRadius:"6px"},children:["$",(t==null?void 0:t.toLocaleString(void 0,{minimumFractionDigits:2}))||"---"]}),m.bids.slice(0,5).map((w,S)=>e.jsxs("div",{className:"flex justify-between text-[var(--green)] py-0.5 px-1 rounded hover:bg-[var(--green)]/[0.04]",children:[e.jsxs("span",{children:["$",w.price.toFixed(2)]}),e.jsx("span",{className:"text-[var(--text-dim)]",children:w.quantity.toFixed(4)})]},`b${S}`))]})]})]}),f==="positions"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin posiciones abiertas"})]}):s.map(w=>{const S=w.side==="buy"?(t-w.entryPrice)*w.quantity:(w.entryPrice-t)*w.quantity;return e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:`1px solid ${S>=0?"rgba(14,203,129,0.1)":"rgba(246,70,93,0.1)"}`},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold",children:w.symbol}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-md ${w.side==="buy"?"text-[var(--green)] bg-[var(--green)]/[0.08]":"text-[var(--red)] bg-[var(--red)]/[0.08]"}`,children:w.side.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-[var(--text-dim)] mb-2",children:[e.jsxs("span",{children:["Entrada: $",w.entryPrice]}),e.jsxs("span",{className:`font-bold ${S>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:["P&L: ",S>=0?"+":"","$",S.toFixed(2)]})]}),e.jsx("button",{onClick:()=>i(w.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cerrar PosiciÃ³n"})]},w.id)})}),f==="orders"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{size:32,className:"mx-auto text-[var(--text-dim)]/20 mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Sin Ã³rdenes pendientes"})]}):a.map(w=>e.jsxs("div",{className:"rounded-xl p-3",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:w.symbol}),e.jsxs("span",{className:`text-[10px] font-bold ${w.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:[w.side.toUpperCase()," ",w.type]})]}),e.jsxs("div",{className:"text-[10px] text-[var(--text-dim)] mb-2",children:["Precio: $",w.price," | Cantidad: ",w.quantity]}),e.jsx("button",{onClick:()=>n(w.id),className:"w-full py-1.5 rounded-lg text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] transition-all",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:"Cancelar"})]},w.id))})]})}const As="modulepreload",$s=function(u){return"/"+u},xt={},Ts=function(t,s,a){let r=Promise.resolve();if(s&&s.length>0){let i=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));r=i(s.map(d=>{if(d=$s(d),d in xt)return;xt[d]=!0;const h=d.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const o=document.createElement("link");if(o.rel=h?"stylesheet":As,h||(o.as="script"),o.crossOrigin="",o.href=d,c&&o.setAttribute("nonce",c),document.head.appendChild(o),h)return new Promise((b,m)=>{o.addEventListener("load",b),o.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(i){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=i,window.dispatchEvent(n),!n.defaultPrevented)throw i}return r.then(i=>{for(const n of i||[])n.status==="rejected"&&l(n.reason);return t().catch(l)})};class Es{constructor(){this.connections=new Map}_decrypt(t){return{...t,apiKey:atob(t.apiKey),apiSecret:atob(t.apiSecret),passphrase:t.passphrase?atob(t.passphrase):void 0}}async _coinbaseJWT(t,s,a){const r=t.apiKey,l=t.apiSecret,i={alg:"ES256",kid:r,nonce:crypto.randomUUID(),typ:"JWT"},n=Math.floor(Date.now()/1e3),c=`${s} api.coinbase.com${a}`,d={sub:r,iss:"coinbase-cloud",aud:["cdp_service"],nbf:n,exp:n+120,uri:c},h=N=>btoa(N).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),p=N=>h(JSON.stringify(N)),o=N=>h(String.fromCharCode(...new Uint8Array(N))),b=p(i),m=p(d),g=`${b}.${m}`,f=await this._importECKey(l),k=await crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},f,new TextEncoder().encode(g));return`${g}.${o(k)}`}async _importECKey(t){const s=t.replace(/-----BEGIN (?:EC )?PRIVATE KEY-----/g,"").replace(/-----END (?:EC )?PRIVATE KEY-----/g,"").replace(/\\n/g,"").replace(/\n/g,"").replace(/\r/g,"").replace(/\s/g,""),a=Uint8Array.from(atob(s),c=>c.charCodeAt(0));if(t.includes("BEGIN PRIVATE KEY")&&!t.includes("EC PRIVATE KEY"))return crypto.subtle.importKey("pkcs8",a.buffer,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]);const r=this._extractEC_d(a),l=this._extractEC_pub(a);if(!r||r.length!==32)throw new Error(`Clave EC invÃ¡lida: se esperaban 32 bytes para d, se encontraron ${(r==null?void 0:r.length)||0}`);const i=c=>btoa(String.fromCharCode(...c)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),n={kty:"EC",crv:"P-256",d:i(r)};if(l&&l.length===65&&l[0]===4)n.x=i(l.slice(1,33)),n.y=i(l.slice(33,65));else return this._importECKeyPkcs8Wrap(a);return crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"])}_extractEC_d(t){for(let s=0;s<t.length-34;s++)if(t[s]===2&&t[s+1]===1&&t[s+2]===1&&t[s+3]===4&&t[s+4]===32)return t.slice(s+5,s+5+32);return null}_extractEC_pub(t){for(let s=0;s<t.length-67;s++)if(t[s]===161&&t[s+2]===3&&t[s+3]===66&&t[s+4]===0)return t.slice(s+5,s+5+65);return null}async _importECKeyPkcs8Wrap(t){const s=t.length,a=new Uint8Array([48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7]),r=new Uint8Array([2,1,0]),l=this._asn1Len(4,s),i=r.length+a.length+l.length+s,n=this._asn1Len(48,i),c=new Uint8Array(n.length+i);let d=0;return c.set(n,d),d+=n.length,c.set(r,d),d+=r.length,c.set(a,d),d+=a.length,c.set(l,d),d+=l.length,c.set(t,d),crypto.subtle.importKey("pkcs8",c.buffer,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"])}_asn1Len(t,s){return s<128?new Uint8Array([t,s]):s<256?new Uint8Array([t,129,s]):new Uint8Array([t,130,s>>8&255,s&255])}async _coinbaseRequest(t,s,a,r=null){const l=await this._coinbaseJWT(t,s,a),i="/api/coinbase-proxy";try{const n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jwt:l,method:s,path:a,body:r})});let c;const d=await n.text();try{c=JSON.parse(d)}catch{c={error:d}}if(!n.ok)throw new Error(c.error||c.message||`Coinbase HTTP ${n.status}`);return c}catch(n){throw n.message==="Failed to fetch"||n.name==="TypeError"?new Error("Error de red al conectar con el proxy. Reintenta en unos segundos."):n}}async _hmacSign(t,s){const a=new TextEncoder,r=await crypto.subtle.importKey("raw",a.encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=await crypto.subtle.sign("HMAC",r,a.encode(s));return Array.from(new Uint8Array(l)).map(i=>i.toString(16).padStart(2,"0")).join("")}async _binanceSignedRequest(t,s,a,r={}){const l=Date.now(),i={...r,timestamp:l,recvWindow:5e3},n=Object.entries(i).filter(([,m])=>m!=null).map(([m,g])=>`${m}=${encodeURIComponent(g)}`).join("&"),c=await this._hmacSign(t.apiSecret,n),d=`${n}&signature=${c}`,h=s==="GET"?`${De.binance.baseUrl}${a}?${d}`:`${De.binance.baseUrl}${a}`,p={method:s,headers:{"X-MBX-APIKEY":t.apiKey,"Content-Type":"application/x-www-form-urlencoded"}};(s==="POST"||s==="DELETE")&&(p.body=d);const o=await fetch(h,p),b=await o.json();if(!o.ok)throw new Error(`Binance ${a}: ${b.msg||o.statusText} (${b.code||o.status})`);return b}async _binancePublicRequest(t,s={}){const a=Object.entries(s).filter(([,i])=>i!==void 0).map(([i,n])=>`${i}=${encodeURIComponent(n)}`).join("&"),r=`${De.binance.baseUrl}${t}${a?"?"+a:""}`,l=await fetch(r);if(!l.ok)throw new Error(`Binance API error: ${l.status}`);return l.json()}async connect(t){const s=this._decrypt(t),a=De[t.brokerId];if(!a)throw new Error(`Unsupported broker: ${t.brokerId}`);try{switch(t.brokerId){case"binance":{await this._binancePublicRequest("/api/v3/ping");const r=await this._binanceSignedRequest(s,"GET","/api/v3/account");return this.connections.set(t.id,{creds:s,config:a,connected:!0,permissions:r.permissions||[],accountType:r.accountType}),{success:!0,message:`Connected to Binance (${r.accountType})`,permissions:r.permissions}}case"coinbase":{const r=await this._coinbaseRequest(s,"GET","/api/v3/brokerage/accounts");return this.connections.set(t.id,{creds:s,config:a,connected:!0,permissions:["read","trade"],accounts:r.accounts||[]}),{success:!0,message:`Connected to Coinbase (${(r.accounts||[]).length} accounts)`,permissions:["read","trade"]}}default:return await fetch(a.baseUrl),this.connections.set(t.id,{creds:s,config:a,connected:!0,permissions:[]}),{success:!0,message:`Connected to ${a.name}`}}}catch(r){return{success:!1,message:r.message}}}async getBalances(t){const s=this.connections.get(t);if(!s)throw new Error("Broker not connected");if(s.config.id==="binance")try{return(await this._binanceSignedRequest(s.creds,"GET","/api/v3/account")).balances.filter(r=>parseFloat(r.free)>0||parseFloat(r.locked)>0).map(r=>({asset:r.asset,free:r.free,locked:r.locked,total:(parseFloat(r.free)+parseFloat(r.locked)).toString()}))}catch(a){throw console.error("Binance getBalances error:",a),a}if(s.config.id==="coinbase")try{return((await this._coinbaseRequest(s.creds,"GET","/api/v3/brokerage/accounts")).accounts||[]).filter(r=>{var l,i;return parseFloat(((l=r.available_balance)==null?void 0:l.value)||0)>0||parseFloat(((i=r.hold)==null?void 0:i.value)||0)>0}).map(r=>{var l,i,n,c;return{asset:r.currency,free:((l=r.available_balance)==null?void 0:l.value)||"0",locked:((i=r.hold)==null?void 0:i.value)||"0",total:(parseFloat(((n=r.available_balance)==null?void 0:n.value)||0)+parseFloat(((c=r.hold)==null?void 0:c.value)||0)).toString()}})}catch(a){throw console.error("Coinbase getBalances error:",a),a}return[]}async placeOrder(t,s){var p,o,b,m,g,f,k;const a=this.connections.get(t);if(!a)throw new Error("Broker not connected");const{symbol:r,side:l,type:i,quantity:n,price:c,stopLoss:d,takeProfit:h}=s;if(!r||!l||!i||!n)throw new Error("Missing required order fields");if(a.config.id==="binance")try{const N={market:"MARKET",limit:"LIMIT",stop_loss:"STOP_LOSS_LIMIT"}[i]||"MARKET",F={symbol:r,side:l.toUpperCase(),type:N,quantity:n.toString()};(N==="LIMIT"||N==="STOP_LOSS_LIMIT")&&(F.timeInForce="GTC",F.price=parseFloat(c).toFixed(2)),N==="STOP_LOSS_LIMIT"&&(F.stopPrice=parseFloat(d||c).toFixed(2));const v=await this._binanceSignedRequest(a.creds,"POST","/api/v3/order",F);return{id:(p=v.orderId)==null?void 0:p.toString(),clientOrderId:v.clientOrderId,symbol:v.symbol,side:(o=v.side)==null?void 0:o.toLowerCase(),type:(b=v.type)==null?void 0:b.toLowerCase(),quantity:parseFloat(v.origQty||n),price:parseFloat(v.price||c||0),filledPrice:parseFloat(((g=(m=v.fills)==null?void 0:m[0])==null?void 0:g.price)||v.price||0),filledQty:parseFloat(v.executedQty||0),status:(f=v.status)==null?void 0:f.toLowerCase(),timestamp:new Date(v.transactTime||Date.now()).toISOString(),broker:"Binance",raw:v}}catch(N){throw console.error("Binance placeOrder error:",N),N}if(a.config.id==="coinbase")try{const N=r.replace(/([A-Z]+)(USDT|USDC|USD|BTC|ETH)$/i,"$1-$2").toUpperCase(),F={};i==="market"?l.toLowerCase()==="buy"?F.market_market_ioc={quote_size:(parseFloat(n)*parseFloat(c||0)).toFixed(2)}:F.market_market_ioc={base_size:parseFloat(n).toString()}:i==="limit"&&(F.limit_limit_gtc={base_size:parseFloat(n).toString(),limit_price:parseFloat(c).toFixed(2)});const v={client_order_id:crypto.randomUUID(),product_id:N,side:l.toUpperCase(),order_configuration:F},w=await this._coinbaseRequest(a.creds,"POST","/api/v3/brokerage/orders",v),S=w.success_response||w,j=S.order_id||S.id||Date.now().toString(36);let y=parseFloat(c||0),E=parseFloat(n),C="pending";if(w.success)try{const R=await this._coinbaseRequest(a.creds,"GET",`/api/v3/brokerage/orders/historical/${j}`),_=R.order||R;y=parseFloat(_.average_filled_price||_.filled_price||c||0),E=parseFloat(_.filled_size||_.filled_value||n),C=(_.status||"FILLED").toLowerCase()}catch{C="filled"}else{const R=((k=w.error_response)==null?void 0:k.error)||w.error||"Unknown error";throw new Error(`Coinbase order failed: ${R}`)}return{id:j,clientOrderId:v.client_order_id,symbol:N,side:l.toLowerCase(),type:i,quantity:E,price:y,filledPrice:y,filledQty:E,status:C,timestamp:new Date().toISOString(),broker:"Coinbase",real:!0}}catch(N){throw console.error("Coinbase placeOrder error:",N),N}return{id:Date.now().toString(36),symbol:r,side:l,type:i,quantity:parseFloat(n),price:c?parseFloat(c):null,status:i==="market"?"filled":"new",filledPrice:i==="market"?parseFloat(c||0):null,timestamp:new Date().toISOString(),broker:a.config.name,simulated:!0}}async cancelOrder(t,s,a){const r=this.connections.get(t);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{const l=await this._binanceSignedRequest(r.creds,"DELETE","/api/v3/order",{symbol:a,orderId:s});return{success:!0,orderId:l.orderId,status:l.status}}catch(l){return{success:!1,message:l.message}}return{success:!0,orderId:s,simulated:!0}}async getOpenOrders(t,s){const a=this.connections.get(t);if(!a)throw new Error("Broker not connected");if(a.config.id==="binance")try{const r=s?{symbol:s}:{};return(await this._binanceSignedRequest(a.creds,"GET","/api/v3/openOrders",r)).map(i=>{var n,c,d,h;return{id:(n=i.orderId)==null?void 0:n.toString(),symbol:i.symbol,side:(c=i.side)==null?void 0:c.toLowerCase(),type:(d=i.type)==null?void 0:d.toLowerCase(),quantity:parseFloat(i.origQty),price:parseFloat(i.price),filledQty:parseFloat(i.executedQty),status:(h=i.status)==null?void 0:h.toLowerCase(),time:new Date(i.time).toISOString()}})}catch{return[]}return[]}async getTradeHistory(t,s,a=50){const r=this.connections.get(t);if(!r)throw new Error("Broker not connected");if(r.config.id==="binance")try{return(await this._binanceSignedRequest(r.creds,"GET","/api/v3/myTrades",{symbol:s,limit:a})).map(i=>{var n,c;return{id:(n=i.id)==null?void 0:n.toString(),orderId:(c=i.orderId)==null?void 0:c.toString(),symbol:i.symbol,side:i.isBuyer?"buy":"sell",price:parseFloat(i.price),quantity:parseFloat(i.qty),commission:parseFloat(i.commission),commissionAsset:i.commissionAsset,time:new Date(i.time).toISOString(),isMaker:i.isMaker}})}catch{return[]}return[]}async getExchangeInfo(t){var s,a,r,l;try{const n=(s=(await this._binancePublicRequest("/api/v3/exchangeInfo",{symbol:t})).symbols)==null?void 0:s[0];if(!n)return null;const c=(a=n.filters)==null?void 0:a.find(p=>p.filterType==="LOT_SIZE"),d=(r=n.filters)==null?void 0:r.find(p=>p.filterType==="PRICE_FILTER"),h=(l=n.filters)==null?void 0:l.find(p=>p.filterType==="NOTIONAL"||p.filterType==="MIN_NOTIONAL");return{symbol:n.symbol,status:n.status,baseAsset:n.baseAsset,quoteAsset:n.quoteAsset,minQty:c?parseFloat(c.minQty):0,maxQty:c?parseFloat(c.maxQty):1/0,stepSize:c?parseFloat(c.stepSize):0,minPrice:d?parseFloat(d.minPrice):0,tickSize:d?parseFloat(d.tickSize):0,minNotional:h?parseFloat(h.minNotional||h.notional):0}}catch{return null}}isConnected(t){return this.connections.has(t)}getConnection(t){return this.connections.get(t)}disconnect(t){this.connections.delete(t)}}const ie=new Es;class G{constructor(t){this._series=t.map(s=>s??0),this._value=this._series[this._series.length-1]||0}valueOf(){return this._value}toString(){return String(this._value)}get value(){return this._value}get series(){return this._series}prev(t=1){return this._series[this._series.length-1-t]||0}toFixed(t){return this._value.toFixed(t)}}function Fs(u){const t=u.map(I=>I.close),s=u.map(I=>I.open),a=u.map(I=>I.high),r=u.map(I=>I.low),l=u.map(I=>I.volume),i=t.length;let n=null,c={stopLoss:2,takeProfit:4};const d=[],h=(I=20)=>new G(ae(t,I)),p=(I=20)=>new G(qe(t,I)),o=(I=14)=>new G(me(t,I)),b=(I=12,z=26,x=9)=>{const A=Be(t,I,z,x);return{line:new G(A.macd),signal:new G(A.signal),histogram:new G(A.histogram),valueOf(){return A.histogram[i-1]||0}}},m=(I=20,z=2)=>{const x=at(t,I,z);return{upper:new G(x.upper),middle:new G(x.middle),lower:new G(x.lower)}},g=()=>new G(Pt(u)),f=(I,z)=>{const x=I instanceof G?I.series:typeof I=="number"?[I,I]:[],A=z instanceof G?z.series:typeof z=="number"?[z,z]:[];if(x.length<2||A.length<2)return!1;const T=Math.min(x.length,A.length)-1;return x[T-1]<=A[T-1]&&x[T]>A[T]},k=(I,z)=>{const x=I instanceof G?I.series:typeof I=="number"?[I,I]:[],A=z instanceof G?z.series:typeof z=="number"?[z,z]:[];if(x.length<2||A.length<2)return!1;const T=Math.min(x.length,A.length)-1;return x[T-1]>=A[T-1]&&x[T]<A[T]},N=(I={})=>{n={type:"buy",...I}},F=(I={})=>{n={type:"sell",...I}},v=(I={})=>{Object.assign(c,I)},w=I=>{d.push(String(I))},S=I=>{d.push(`âš ï¸ ${String(I)}`)},j=new G(t),y=new G(s),E=new G(a),C=new G(r),R=new G(l),_=t[i-1]||0,K=i-1;return{sandbox:{ema:h,sma:p,rsi:o,macd:b,bb:m,vwap:g,close:j,open:y,high:E,low:C,volume:R,price:_,barIndex:K,crossover:f,crossunder:k,buy:N,sell:F,config:v,log:w,alert:S,highest:(I,z)=>{const A=(I instanceof G?I.series:t).slice(-z);return Math.max(...A.filter(T=>T!=null))},lowest:(I,z)=>{const A=(I instanceof G?I.series:t).slice(-z);return Math.min(...A.filter(T=>T!=null))},avg:(I,z)=>{const A=(I instanceof G?I.series:t).slice(-z).filter(T=>T!=null);return A.reduce((T,D)=>T+D,0)/(A.length||1)},change:(I,z=1)=>{const x=I instanceof G?I.series:t,A=x[x.length-1]||0,T=x[x.length-1-z]||0;return A-T},percentChange:(I,z=1)=>{const x=I instanceof G?I.series:t,A=x[x.length-1]||0,T=x[x.length-1-z]||0;return T!==0?(A-T)/T*100:0},Math,Number,parseInt,parseFloat,isNaN,isFinite},getSignal:()=>n,getConfig:()=>c,getLogs:()=>d}}function At(u,t){if(!u||!t||t.length<2)return{signal:null,config:{stopLoss:2,takeProfit:4},logs:["No hay datos suficientes"]};const{sandbox:s,getSignal:a,getConfig:r,getLogs:l}=Fs(t);try{const i=["window","document","globalThis","self","fetch","XMLHttpRequest","WebSocket","eval","Function","setTimeout","setInterval","importScripts","localStorage","sessionStorage","indexedDB","crypto","navigator","location","history","process","require","module","exports","__dirname","__filename"],n=[...Object.keys(s),...i],c=[...Object.values(s),...i.map(()=>{})],d=`"use strict";
${u}`;return new Function(...n,d)(...c),{signal:a(),config:r(),logs:l(),error:null}}catch(i){return{signal:null,config:r(),logs:[...l(),`âŒ Error: ${i.message}`],error:i.message}}}function mt(u){if(!u||!u.trim())return{valid:!1,error:"El script estÃ¡ vacÃ­o"};try{const t=[/\beval\s*\(/,/\bFunction\s*\(/,/\bimport\s*\(/,/\brequire\s*\(/,/\bfetch\s*\(/,/\bXMLHttpRequest\b/,/\bWebSocket\b/,/\bwindow\b/,/\bdocument\b/,/\bprocess\b/,/\b__proto__\b/,/\bconstructor\s*\[/,/\bprototype\b/];for(const s of t)if(s.test(u))return{valid:!1,error:`CÃ³digo no permitido: ${s.source}`};return new Function(u),{valid:!0,error:null}}catch(t){return{valid:!1,error:`Error de sintaxis: ${t.message}`}}}function Is(u,t,s={}){var g,f;const{initialBalance:a=1e3,riskPercent:r=2}=s;let l=a,i=null;const n=[],c=[a],d=[],h=50;if(t.length<h)return{trades:[],equityCurve:[a],finalBalance:a,logs:["Se necesitan al menos 50 velas"]};for(let k=h;k<t.length;k++){const N=t.slice(0,k+1),F=N[N.length-1].close,v=At(u,N);if(v.error){d.push(`Bar ${k}: ${v.error}`);continue}const w=((g=v.config)==null?void 0:g.stopLoss)||2,S=((f=v.config)==null?void 0:f.takeProfit)||4;if(i){const y=i.side==="buy"?(F-i.entryPrice)/i.entryPrice*100:(i.entryPrice-F)/i.entryPrice*100;if(y<=-w||y>=S){const E=i.quantity*(F-i.entryPrice)*(i.side==="buy"?1:-1);l+=E,n.push({...i,exitPrice:F,exitBar:k,pnl:E,pnlPercent:y,reason:y>=S?"Take Profit":"Stop Loss"}),i=null}}if(v.signal){if(v.signal.type==="buy"&&!i){const y=l*(r/100)/F;i={side:"buy",entryPrice:F,quantity:y,entryBar:k}}else if(v.signal.type==="sell"&&(i==null?void 0:i.side)==="buy"){const y=i.quantity*(F-i.entryPrice);l+=y;const E=(F-i.entryPrice)/i.entryPrice*100;n.push({...i,exitPrice:F,exitBar:k,pnl:y,pnlPercent:E,reason:"Signal"}),i=null}else if(v.signal.type==="sell"&&!i){const y=l*(r/100)/F;i={side:"sell",entryPrice:F,quantity:y,entryBar:k}}else if(v.signal.type==="buy"&&(i==null?void 0:i.side)==="sell"){const y=i.quantity*(i.entryPrice-F);l+=y;const E=(i.entryPrice-F)/i.entryPrice*100;n.push({...i,exitPrice:F,exitBar:k,pnl:y,pnlPercent:E,reason:"Signal"}),i=null}}const j=i?i.quantity*(i.side==="buy"?F-i.entryPrice:i.entryPrice-F):0;c.push(l+j)}if(i){const k=t[t.length-1].close,N=i.quantity*(i.side==="buy"?k-i.entryPrice:i.entryPrice-k);l+=N,n.push({...i,exitPrice:k,exitBar:t.length-1,pnl:N,pnlPercent:N/i.entryPrice/i.quantity*100,reason:"End of Data"})}const p=n.filter(k=>k.pnl>0).length,o=n.filter(k=>k.pnl<=0).length,b=n.reduce((k,N)=>k+N.pnl,0),m=Bs(c);return{trades:n,equityCurve:c,finalBalance:l,totalTrades:n.length,wins:p,losses:o,winRate:n.length>0?p/n.length*100:0,totalPnl:b,maxDrawdown:m,profitFactor:o>0?n.filter(k=>k.pnl>0).reduce((k,N)=>k+N.pnl,0)/Math.abs(n.filter(k=>k.pnl<=0).reduce((k,N)=>k+N.pnl,0)||1):p>0?1/0:0,logs:d}}function Bs(u){let t=u[0],s=0;for(const a of u){a>t&&(t=a);const r=(t-a)/t*100;r>s&&(s=r)}return s}const _s=[{id:"ema_cross",name:"EMA Crossover",description:"Compra cuando EMA rÃ¡pida cruza arriba de EMA lenta, vende al cruce inverso",difficulty:"Principiante",code:`// EMA Crossover Strategy
// SeÃ±al de compra: EMA rÃ¡pida cruza arriba de EMA lenta
// SeÃ±al de venta: EMA rÃ¡pida cruza abajo de EMA lenta

const fast = ema(12);
const slow = ema(26);

if (crossover(fast, slow)) {
  buy();
}

if (crossunder(fast, slow)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 4 });`},{id:"rsi_reversal",name:"RSI Reversal",description:"Compra en sobreventa (RSI < 30), vende en sobrecompra (RSI > 70)",difficulty:"Principiante",code:`// RSI Reversal Strategy
// Compra cuando RSI estÃ¡ sobrevendido
// Vende cuando RSI estÃ¡ sobrecomprado

const rsiVal = rsi(14);

if (rsiVal < 30) {
  buy();
}

if (rsiVal > 70) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"macd_momentum",name:"MACD Momentum",description:"Opera el cruce de la lÃ­nea MACD con su seÃ±al",difficulty:"Intermedio",code:`// MACD Momentum Strategy
// SeÃ±al de compra: lÃ­nea MACD cruza arriba de seÃ±al
// SeÃ±al de venta: lÃ­nea MACD cruza abajo de seÃ±al

const m = macd(12, 26, 9);

if (crossover(m.line, m.signal)) {
  buy();
}

if (crossunder(m.line, m.signal)) {
  sell();
}

config({ stopLoss: 2, takeProfit: 5 });`},{id:"bb_squeeze",name:"Bollinger Bands Squeeze",description:"Compra cuando el precio toca la banda inferior, vende en la superior",difficulty:"Intermedio",code:`// Bollinger Bands Bounce Strategy
// Compra en banda inferior, vende en banda superior

const bands = bb(20, 2);
const rsiVal = rsi(14);

// Comprar cerca de banda inferior con RSI sobrevendido
if (close < bands.lower && rsiVal < 35) {
  buy();
}

// Vender cerca de banda superior con RSI sobrecomprado
if (close > bands.upper && rsiVal > 65) {
  sell();
}

config({ stopLoss: 1.5, takeProfit: 3 });`},{id:"triple_confirmation",name:"Triple ConfirmaciÃ³n",description:"EMA + RSI + MACD confirman la seÃ±al de entrada â€” alta probabilidad",difficulty:"Avanzado",code:`// Triple Confirmation Strategy
// Requiere 3 indicadores para confirmar entrada
// Alta probabilidad, menos trades pero mÃ¡s precisos

const ema20 = ema(20);
const ema50 = ema(50);
const rsiVal = rsi(14);
const m = macd(12, 26, 9);

// COMPRA: EMA cruce alcista + RSI < 45 + MACD positivo
if (crossover(ema20, ema50) && rsiVal < 45 && m.histogram > 0) {
  buy();
  log("Triple confirmaciÃ³n alcista");
}

// VENTA: EMA cruce bajista + RSI > 55 + MACD negativo
if (crossunder(ema20, ema50) && rsiVal > 55 && m.histogram < 0) {
  sell();
  log("Triple confirmaciÃ³n bajista");
}

config({ stopLoss: 2.5, takeProfit: 6 });`},{id:"vwap_scalper",name:"VWAP Scalper",description:"Scalping basado en VWAP con EMA como filtro de tendencia",difficulty:"Avanzado",code:`// VWAP Scalper Strategy
// Compra cuando precio cruza arriba de VWAP con tendencia alcista
// Scalping rÃ¡pido con stops ajustados

const v = vwap();
const trend = ema(50);
const momentum = rsi(10);

// Tendencia alcista + precio cruza VWAP hacia arriba
if (crossover(close, v) && close > trend && momentum > 50) {
  buy();
  log("Long VWAP bounce en tendencia alcista");
}

// Tendencia bajista + precio cruza VWAP hacia abajo
if (crossunder(close, v) && close < trend && momentum < 50) {
  sell();
  log("Short VWAP rejection en tendencia bajista");
}

config({ stopLoss: 0.8, takeProfit: 1.5 });`},{id:"custom_blank",name:"Script VacÃ­o",description:"Empieza desde cero â€” escribe tu propia estrategia",difficulty:"Cualquiera",code:`// Mi Estrategia Personalizada
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Funciones disponibles:
//   ema(periodo), sma(periodo), rsi(periodo)
//   macd(fast, slow, signal), bb(periodo, stdDev), vwap()
//   crossover(a, b), crossunder(a, b)
//   highest(indicador, periodo), lowest(indicador, periodo)
//   avg(indicador, periodo), change(indicador, periodos)
//   percentChange(indicador, periodos)
//
// Variables: close, open, high, low, volume, price
// Acciones: buy(), sell(), config({ stopLoss, takeProfit })
//           log("mensaje"), alert("alerta")
//
// Tip: PÃ­dele a ChatGPT que te genere una estrategia
//      usando estas funciones!

// Escribe tu estrategia aquÃ­:


config({ stopLoss: 2, takeProfit: 4 });`}],Rs=`Eres un experto creando estrategias de trading para Kairos Script. Genera cÃ³digo usando SOLO estas funciones:

INDICADORES (retornan valores numÃ©ricos):
- ema(periodo) â€” Media MÃ³vil Exponencial
- sma(periodo) â€” Media MÃ³vil Simple
- rsi(periodo) â€” Ãndice de Fuerza Relativa (0-100)
- macd(fast, slow, signal) â€” retorna { line, signal, histogram }
- bb(periodo, stdDev) â€” retorna { upper, middle, lower }
- vwap() â€” Volume Weighted Average Price

DATOS:
- close, open, high, low, volume â€” valores actuales
- price â€” precio actual (nÃºmero)

DETECCIÃ“N DE CRUCES:
- crossover(a, b) â€” true si A cruza arriba de B
- crossunder(a, b) â€” true si A cruza abajo de B

UTILIDADES:
- highest(indicador, periodo) â€” valor mÃ¡s alto en N perÃ­odos
- lowest(indicador, periodo) â€” valor mÃ¡s bajo en N perÃ­odos
- avg(indicador, periodo) â€” promedio en N perÃ­odos
- change(indicador, periodos) â€” cambio absoluto
- percentChange(indicador, periodos) â€” cambio porcentual

ACCIONES:
- buy() â€” seÃ±al de compra
- sell() â€” seÃ±al de venta
- config({ stopLoss: %, takeProfit: % }) â€” configurar SL/TP
- log("mensaje") â€” registrar mensaje

REGLAS:
1. NO uses window, document, fetch, eval, require, import
2. Solo JavaScript simple (if/else, const/let, operadores)
3. El cÃ³digo se ejecuta en cada vela nueva
4. Siempre incluye config() con stopLoss y takeProfit
5. Las comparaciones con indicadores funcionan directamente (ej: rsi(14) < 30)

Genera SOLO el cÃ³digo, sin explicaciones fuera del cÃ³digo. Usa comentarios en espaÃ±ol.`,Me=["wss://stream.binance.us:9443/ws","wss://stream.binance.com:9443/ws"];class Ds{constructor(){this.activeBots=new Map,this.streams=new Map,this.positions=new Map,this.candles=new Map,this.lastHeartbeat=new Map,this.logs=new Map,this.callbacks=new Map}_log(t,s){var l,i,n;const a=this.logs.get(t)||[],r=this.activeBots.get(t);a.push({message:s,time:Date.now(),botName:((l=r==null?void 0:r.bot)==null?void 0:l.name)||"Bot"}),a.length>150&&a.splice(0,50),this.logs.set(t,a);try{(n=(i=this.callbacks.get(t))==null?void 0:i.onLog)==null||n.call(i,s)}catch{}}_onTrade(t,s){var a,r;try{(r=(a=this.callbacks.get(t))==null?void 0:a.onTrade)==null||r.call(a,s)}catch{}}setCallbacks(t,s,a){this.callbacks.set(t,{onTrade:s,onLog:a})}getLogs(t){return this.logs.get(t)||[]}getAllLogs(){const t=[];for(const[s,a]of this.logs)t.push(...a.map(r=>({...r,botId:s})));return t.sort((s,a)=>s.time-a.time).slice(-100)}async _ensureBrokerConnected(t){if(!t.brokerId)return!1;if(ie.connections.has(t.brokerId))return!0;try{const a=(await Ts(async()=>{const{default:r}=await Promise.resolve().then(()=>us);return{default:r}},void 0)).default.getState().brokers.find(r=>r.id===t.brokerId);if(a&&a.connected)return await ie.connect(a),!0}catch(s){console.warn("Auto-reconnect failed:",s.message)}return!1}async startBot(t,s,a){var h;if(this.activeBots.has(t.id))return;this.callbacks.set(t.id,{onTrade:s,onLog:a}),this.activeBots.set(t.id,{bot:t,running:!0}),this._log(t.id,`ðŸ¤– Bot "${t.name}" iniciado en ${t.pair}`);const r=await this._ensureBrokerConnected(t);t.brokerId?this._log(t.id,r?"ðŸ”— Broker conectado â€” modo REAL activado":"âš ï¸ Broker no disponible â€” modo DEMO"):this._log(t.id,"ðŸ“‹ Modo DEMO â€” Conecta un broker para operar en real");const l=be(t.pair);let i;try{i=await Y.getCandles(l,t.timeframe,100),this.candles.set(t.id,i);const p=(h=i[i.length-1])==null?void 0:h.close;this._log(t.id,`ðŸ“Š ${i.length} velas cargadas | Precio: $${p==null?void 0:p.toFixed(2)} | TF: ${t.timeframe}`)}catch(p){this._log(t.id,`âŒ Error cargando datos: ${p.message}`),this._log(t.id,"â±ï¸ Cambiando a modo polling..."),this._startPollingFallback(t,l);return}const n=i.map(p=>p.close),c=n[n.length-1],d=this._evaluateStrategy(t.strategy,i,n);d?(this._log(t.id,`ðŸ“Š SeÃ±al inicial: ${d.type.toUpperCase()} a $${c.toFixed(2)}`),await this._handleSignal(t,d,c)):this._logIndicatorStatus(t,n),this._connectBotStream(t,l)}_logIndicatorStatus(t,s){var l,i,n,c,d,h,p,o,b,m,g,f,k,N;const a=s.length,r=(i=(l=t.strategy)==null?void 0:l.entry)==null?void 0:i.indicator;try{if(r==="ema_cross"||r==="ema_cross_rsi"){const F=((n=t.strategy.entry.params)==null?void 0:n.fastEma)||((c=t.strategy.entry.params)==null?void 0:c.fast)||20,v=((d=t.strategy.entry.params)==null?void 0:d.slowEma)||((h=t.strategy.entry.params)==null?void 0:h.slow)||50,w=ae(s,F),S=ae(s,v),j=((w[a-1]-S[a-1])/S[a-1]*100).toFixed(3);let y=`ðŸ“ˆ EMA${F}: $${(p=w[a-1])==null?void 0:p.toFixed(2)} | EMA${v}: $${(o=S[a-1])==null?void 0:o.toFixed(2)} | Diff: ${j}%`;if(r==="ema_cross_rsi"){const E=me(s,((b=t.strategy.entry.params)==null?void 0:b.rsiPeriod)||14);y+=` | RSI: ${(m=E[a-1])==null?void 0:m.toFixed(1)}`}this._log(t.id,`${y} â€” Sin seÃ±al, monitoreando...`)}else if(r==="rsi"){const F=me(s,((g=t.strategy.entry.params)==null?void 0:g.period)||14);this._log(t.id,`ðŸ“ˆ RSI: ${(f=F[a-1])==null?void 0:f.toFixed(1)} â€” Sin seÃ±al, monitoreando...`)}else if(r==="macd_cross"){const{macd:F,signal:v}=Be(s);this._log(t.id,`ðŸ“ˆ MACD: ${(k=F[a-1])==null?void 0:k.toFixed(2)} | Signal: ${(N=v[a-1])==null?void 0:N.toFixed(2)} â€” Sin seÃ±al, monitoreando...`)}else this._log(t.id,"ðŸ‘€ Sin seÃ±al â€” Monitoreando en tiempo real...")}catch{this._log(t.id,"ðŸ‘€ Sin seÃ±al â€” Monitoreando en tiempo real...")}}_connectBotStream(t,s,a=0){var h;if(!((h=this.activeBots.get(t.id))!=null&&h.running))return;const r=s.toLowerCase(),l=t.timeframe||"1m",i=Y._wsBase||Me[0],n=`${i}/${r}@ticker/${r}@kline_${l}`;this._log(t.id,`ðŸ”Œ Conectando stream: ${s} @ ${l}${a>0?` (intento ${a+1})`:""}...`);let c;try{c=new WebSocket(n)}catch(p){this._log(t.id,`âŒ Error WebSocket: ${p.message} â€” Cambiando a polling`),this._startPollingFallback(t,s);return}let d=null;c.onopen=()=>{this._log(t.id,"âš¡ Stream EN VIVO conectado â€” Datos instantÃ¡neos activos"),a=0},c.onmessage=p=>{var o;if((o=this.activeBots.get(t.id))!=null&&o.running)try{const b=JSON.parse(p.data);if(b.e==="24hrTicker"){const m=parseFloat(b.c);this._handleTick(t,m)}if(b.e==="kline"){const m=b.k,g={time:Math.floor(m.t/1e3),open:parseFloat(m.o),high:parseFloat(m.h),low:parseFloat(m.l),close:parseFloat(m.c),volume:parseFloat(m.v)};m.x&&this._handleCandleClose(t,g)}}catch(b){console.error(`[Bot ${t.id}] WS parse:`,b)}},c.onerror=p=>{if(console.error(`[Bot ${t.id}] WS error`,p),a===0){const o=i===Me[0]?Me[1]:Me[0];Y._wsBase=o,this._log(t.id,"ðŸ”„ Probando endpoint alternativo...");try{c.close()}catch{}this._connectBotStream(t,s,1);return}},c.onclose=()=>{var p;if((p=this.activeBots.get(t.id))!=null&&p.running)if(a<5){const o=Math.min(2e3*(a+1),1e4);this._log(t.id,`ðŸ”„ Reconectando en ${o/1e3}s...`),d=setTimeout(()=>{this._connectBotStream(t,s,a+1)},o)}else this._log(t.id,"âš ï¸ WebSocket no disponible â€” Modo polling activado"),this._startPollingFallback(t,s)},this.streams.set(t.id,{ws:c,reconnectTimeout:d})}_handleTick(t,s){const a=Date.now(),r=this.lastHeartbeat.get(t.id)||0;if(a-r>1e4){this.lastHeartbeat.set(t.id,a);const l=this.positions.get(t.id);if(l){const i=l.side==="buy"?(s-l.entryPrice)*l.quantity:(l.entryPrice-s)*l.quantity;this._log(t.id,`ðŸ’“ $${s.toFixed(2)} | ${l.side.toUpperCase()} @ $${l.entryPrice.toFixed(2)} | P&L: ${i>=0?"+":""}$${i.toFixed(2)}`)}else this._log(t.id,`ðŸ’“ $${s.toFixed(2)} â€” Esperando seÃ±al...`)}this._checkStopLossTakeProfit(t,s)}async _handleCandleClose(t,s){const a=this.candles.get(t.id)||[];a.length>0&&a[a.length-1].time===s.time?a[a.length-1]=s:(a.push(s),a.length>200&&a.shift()),this.candles.set(t.id,a);const r=a.map(n=>n.close),l=s.close;this._log(t.id,`ðŸ•¯ï¸ Vela cerrada: O:${s.open.toFixed(2)} H:${s.high.toFixed(2)} L:${s.low.toFixed(2)} C:${s.close.toFixed(2)}`);const i=this._evaluateStrategy(t.strategy,a,r);i?await this._handleSignal(t,i,l):this._logIndicatorStatus(t,r)}async _handleSignal(t,s,a){const r=this.positions.get(t.id);r&&r.side!==s.type&&await this._closePosition(t,r,a,s.type),this.positions.has(t.id)||await this._openPosition(t,s,a)}async _closePosition(t,s,a,r,l){const i=s.entryPrice,n=s.quantity,c=s.side==="buy"?(a-i)*n:(i-a)*n;this._log(t.id,`ðŸ“Š Cerrando: ${s.side.toUpperCase()} â†’ ${r.toUpperCase()} | $${i.toFixed(2)} â†’ $${a.toFixed(2)} | P&L: ${c>=0?"+":""}$${c.toFixed(2)}`);const d={symbol:be(t.pair),side:r,type:"market",quantity:n,price:a};if(t.brokerId&&ie.connections.has(t.brokerId))try{this._log(t.id,"ðŸ”„ Cerrando posiciÃ³n REAL en broker...");const h=await ie.placeOrder(t.brokerId,d),p=h.filledPrice?s.side==="buy"?(h.filledPrice-i)*n:(i-h.filledPrice)*n:c;this._log(t.id,`âœ… Cerrada: P&L real ${p>=0?"+":""}$${p.toFixed(2)}`),this._onTrade(t.id,{...d,...h,profit:p,real:!0,action:"close",reason:l})}catch(h){this._log(t.id,`âŒ Error cerrando: ${h.message}`),this._onTrade(t.id,{...d,profit:c,status:"error",error:h.message,action:"close"})}else this._log(t.id,`ðŸ“ [DEMO] Cerrada: P&L ${c>=0?"+":""}$${c.toFixed(2)}`),this._onTrade(t.id,{...d,profit:c,status:"filled",simulated:!0,action:"close",reason:l});this.positions.delete(t.id)}async _openPosition(t,s,a){var c,d,h;this._log(t.id,`ðŸ“Š SeÃ±al: ${s.type.toUpperCase()} a $${a.toFixed(2)}`);const r=this._calculatePositionSize(t,a),l=parseFloat(((c=t.strategy)==null?void 0:c.stopLoss)||2)/100,i=parseFloat(((d=t.strategy)==null?void 0:d.takeProfit)||4)/100,n={symbol:be(t.pair),side:s.type,type:"market",quantity:r,price:a,stopLoss:s.type==="buy"?a*(1-l):a*(1+l),takeProfit:s.type==="buy"?a*(1+i):a*(1-i)};if(t.brokerId&&ie.connections.has(t.brokerId))try{this._log(t.id,"ðŸ”„ Ejecutando orden REAL en broker...");const p=await ie.placeOrder(t.brokerId,n),o=p.filledPrice||a;this._log(t.id,`âœ… REAL: ${(h=p.side)==null?void 0:h.toUpperCase()} ${p.filledQty||r} @ $${o} [${p.status}]`),this.positions.set(t.id,{side:s.type,entryPrice:o,quantity:p.filledQty||r,entryTime:Date.now(),orderId:p.id}),this._onTrade(t.id,{...n,...p,real:!0,action:"open"})}catch(p){this._log(t.id,`âŒ Error orden: ${p.message}`),this._onTrade(t.id,{...n,status:"error",error:p.message})}else this._log(t.id,`ðŸ“ [DEMO] ${s.type.toUpperCase()} ${r} @ $${a.toFixed(2)}`),this.positions.set(t.id,{side:s.type,entryPrice:a,quantity:r,entryTime:Date.now(),simulated:!0}),this._onTrade(t.id,{...n,status:"filled",simulated:!0,action:"open"})}async _checkStopLossTakeProfit(t,s){var h,p;const a=this.positions.get(t.id);if(!a)return;const r=parseFloat(((h=t.strategy)==null?void 0:h.stopLoss)||2)/100,l=parseFloat(((p=t.strategy)==null?void 0:p.takeProfit)||4)/100,i=a.side==="buy"?a.entryPrice*(1-r):a.entryPrice*(1+r),n=a.side==="buy"?a.entryPrice*(1+l):a.entryPrice*(1-l),c=a.side==="buy"?s<=i:s>=i,d=a.side==="buy"?s>=n:s<=n;if(c||d){const o=a.side==="buy"?"sell":"buy",b=c?"stop_loss":"take_profit";this._log(t.id,`${c?"ðŸ›‘ STOP-LOSS":"ðŸŽ¯ TAKE-PROFIT"} a $${s.toFixed(2)}`),await this._closePosition(t,a,s,o,b)}}_startPollingFallback(t,s){const a=this._getCheckInterval(t.timeframe);this._log(t.id,`â±ï¸ Polling cada ${a/1e3}s`);const r=async()=>{var i;if((i=this.activeBots.get(t.id))!=null&&i.running)try{const n=await Y.getCandles(s,t.timeframe,100);this.candles.set(t.id,n);const c=n.map(o=>o.close),d=c[c.length-1],h=this.positions.get(t.id);if(h){const o=h.side==="buy"?(d-h.entryPrice)*h.quantity:(h.entryPrice-d)*h.quantity;this._log(t.id,`ðŸ’“ $${d.toFixed(2)} | ${h.side.toUpperCase()} @ $${h.entryPrice.toFixed(2)} | P&L: ${o>=0?"+":""}$${o.toFixed(2)}`)}else this._log(t.id,`ðŸ’“ $${d.toFixed(2)} â€” Esperando seÃ±al...`);const p=this._evaluateStrategy(t.strategy,n,c);p?await this._handleSignal(t,p,d):this._logIndicatorStatus(t,c),await this._checkStopLossTakeProfit(t,d)}catch(n){this._log(t.id,`âŒ Error: ${n.message}`)}};r();const l=setInterval(r,a);this.streams.set(t.id,{interval:l})}stopBot(t){const s=this.activeBots.get(t);s&&(s.running=!1,this.activeBots.delete(t));const a=this.streams.get(t);if(a){if(a.ws)try{a.ws.close()}catch{}a.reconnectTimeout&&clearTimeout(a.reconnectTimeout),a.interval&&clearInterval(a.interval),this.streams.delete(t)}this.positions.delete(t),this.candles.delete(t),this.lastHeartbeat.delete(t),this.callbacks.delete(t)}_evaluateStrategy(t,s,a){var i,n,c,d,h,p,o,b,m,g,f,k;if((t==null?void 0:t.type)==="custom_script"&&(t!=null&&t.code)){const N=At(t.code,s);return N.error?(console.warn("[KairosScript] Error:",N.error),null):N.signal}if(!((i=t==null?void 0:t.entry)!=null&&i.indicator))return null;const r=a.length;if(r<50)return null;const l=t.entry.indicator;switch(l){case"ema_cross":case"ema_cross_rsi":{const N=((n=t.entry.params)==null?void 0:n.fastEma)||((c=t.entry.params)==null?void 0:c.fast)||9,F=((d=t.entry.params)==null?void 0:d.slowEma)||((h=t.entry.params)==null?void 0:h.slow)||21,v=ae(a,N),w=ae(a,F),S=Ae(v,w,r-1);if(l==="ema_cross_rsi"){const j=((p=t.entry.params)==null?void 0:p.rsiPeriod)||14,E=me(a,j)[r-1],C=((o=t.entry.params)==null?void 0:o.rsiOversold)||35,R=((m=(b=t.exit)==null?void 0:b.params)==null?void 0:m.rsiOverbought)||65;if(S==="bullish_cross"&&E<C)return{type:"buy"};if(S==="bearish_cross"&&E>R)return{type:"sell"};if(E>R)return{type:"sell"};if(E<C)return{type:"buy"}}else{if(S==="bullish_cross")return{type:"buy"};if(S==="bearish_cross")return{type:"sell"}}break}case"rsi":{const N=((g=t.entry.params)==null?void 0:g.period)||14,v=me(a,N)[r-1];if(v<(((f=t.entry.params)==null?void 0:f.oversold)||30))return{type:"buy"};if(v>(((k=t.entry.params)==null?void 0:k.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:N,signal:F}=Be(a),v=Ae(N,F,r-1);if(v==="bullish_cross")return{type:"buy"};if(v==="bearish_cross")return{type:"sell"};break}default:return null}return null}_calculatePositionSize(t,s){const a=t.balance||1e3,r=parseFloat(t.riskPercent||2)/100,l=a*r/s;return Math.round(l*1e8)/1e8}_getCheckInterval(t){return{"1m":15e3,"5m":3e4,"15m":6e4,"1h":6e4,"4h":12e4,"1d":3e5}[t]||6e4}getActiveBotCount(){return this.activeBots.size}}const ye=new Ds;class Ms{constructor(){this.activeBots=new Map}start(t){if(this.activeBots.has(t.id))return;const{pair:s,upperPrice:a,lowerPrice:r,gridLines:l,investment:i,onLog:n,onTrade:c}=t,d=(a-r)/(l-1),h=[];for(let b=0;b<l;b++)h.push(+(r+d*b).toFixed(2));const p=i/(l-1),o={id:t.id,pair:s,levels:h,priceStep:d,investmentPerGrid:p,activeOrders:new Map,filledBuys:[],totalProfit:0,trades:0,running:!0,lastPrice:null};this.activeBots.set(t.id,o),n==null||n(`ðŸ“Š Grid Bot started: ${l} levels from $${r} to $${a}`),n==null||n(`ðŸ’° Investment per grid: $${p.toFixed(2)}`),this._startMonitor(o,n,c)}async _startMonitor(t,s,a){const r=async()=>{if(t.running)try{const n=(await Y.get24hrTicker(t.pair)).price,c=t.lastPrice;if(t.lastPrice=n,!c){s==null||s(`ðŸ“ˆ Current price: $${n.toFixed(2)}`);for(const h of t.levels)h<n?t.activeOrders.set(h,{side:"buy",price:h,status:"pending"}):h>n;const d=t.activeOrders.size;s==null||s(`ðŸŸ¢ ${d} buy orders placed below current price`);return}for(const d of t.levels){const h=t.activeOrders.get(d);if((h==null?void 0:h.side)==="buy"&&h.status==="pending"&&n<=d){const p=t.investmentPerGrid/d;h.status="filled",t.filledBuys.push(d),t.trades++,a==null||a({symbol:t.pair,side:"buy",type:"grid",quantity:+p.toFixed(6),price:d,gridLevel:d}),s==null||s(`âœ… BUY filled at $${d} (qty: ${p.toFixed(6)})`);const o=d+t.priceStep;o<=t.levels[t.levels.length-1]&&(t.activeOrders.set(o,{side:"sell",price:o,status:"pending",buyLevel:d,quantity:p}),s==null||s(`ðŸ“¤ SELL order placed at $${o.toFixed(2)}`))}if((h==null?void 0:h.side)==="sell"&&h.status==="pending"&&n>=d){h.status="filled";const p=(d-h.buyLevel)*h.quantity;t.totalProfit+=p,t.trades++,a==null||a({symbol:t.pair,side:"sell",type:"grid",quantity:+h.quantity.toFixed(6),price:d,profit:+p.toFixed(2),gridLevel:d}),s==null||s(`âœ… SELL filled at $${d.toFixed(2)} â€” Profit: +$${p.toFixed(2)}`);const o=d-t.priceStep;o>=t.levels[0]&&(t.activeOrders.set(o,{side:"buy",price:o,status:"pending"}),s==null||s(`ðŸ“¥ BUY order re-placed at $${o.toFixed(2)}`))}}}catch(i){s==null||s(`âŒ Error: ${i.message}`)}};await r();const l=setInterval(r,1e4);t._interval=l}stop(t){const s=this.activeBots.get(t);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(t))}getStats(t){const s=this.activeBots.get(t);return s?{levels:s.levels.length,activeOrders:[...s.activeOrders.values()].filter(a=>a.status==="pending").length,filledBuys:s.filledBuys.length,totalProfit:s.totalProfit,trades:s.trades,lastPrice:s.lastPrice}:null}isRunning(t){return this.activeBots.has(t)}}const Ve=new Ms;class Os{constructor(){this.activeBots=new Map}start(t){if(this.activeBots.has(t.id))return;const{pair:s,investmentPerOrder:a,intervalMinutes:r,maxOrders:l=100,useRsiFilter:i=!1,rsiPeriod:n=14,rsiThreshold:c=40,usePriceDipFilter:d=!1,dipPercent:h=3,onLog:p,onTrade:o}=t,b={id:t.id,pair:s,investmentPerOrder:a,intervalMinutes:r,maxOrders:l,useRsiFilter:i,rsiPeriod:n,rsiThreshold:c,usePriceDipFilter:d,dipPercent:h,executedOrders:0,totalInvested:0,totalQuantity:0,avgPrice:0,prices:[],running:!0,lastBuyPrice:null,startTime:Date.now()};this.activeBots.set(t.id,b),p==null||p(`ðŸ“Š DCA Bot started: $${a} every ${r}min on ${s}`),i&&(p==null||p(`ðŸ“‰ RSI filter enabled: buy when RSI < ${c}`)),d&&(p==null||p(`ðŸ“‰ Dip filter enabled: buy when price drops ${h}%`)),this._startMonitor(b,p,o)}async _startMonitor(t,s,a){const r=async()=>{if(t.running){if(t.executedOrders>=t.maxOrders){s==null||s(`ðŸ Max orders reached (${t.maxOrders}). DCA Bot stopped.`),this.stop(t.id);return}try{const n=(await Y.get24hrTicker(t.pair)).price;if(t.useRsiFilter)try{const h=(await Y.getCandles(t.pair,"1h",100)).map(b=>b.close),p=me(h,t.rsiPeriod),o=p[p.length-1];if(o>t.rsiThreshold){s==null||s(`â¸ï¸ RSI ${o.toFixed(1)} > ${t.rsiThreshold} â€” skipping buy`);return}s==null||s(`ðŸ“‰ RSI ${o.toFixed(1)} < ${t.rsiThreshold} â€” proceeding with buy`)}catch(d){s==null||s(`âš ï¸ RSI check failed, proceeding anyway: ${d.message}`)}if(t.usePriceDipFilter&&t.lastBuyPrice){const d=(t.lastBuyPrice-n)/t.lastBuyPrice*100;if(d<t.dipPercent){s==null||s(`â¸ï¸ Price drop ${d.toFixed(2)}% < ${t.dipPercent}% â€” skipping buy`);return}s==null||s(`ðŸ“‰ Price dropped ${d.toFixed(2)}% â€” proceeding with buy`)}const c=t.investmentPerOrder/n;t.executedOrders++,t.totalInvested+=t.investmentPerOrder,t.totalQuantity+=c,t.avgPrice=t.totalInvested/t.totalQuantity,t.lastBuyPrice=n,t.prices.push(n),a==null||a({symbol:t.pair,side:"buy",type:"dca",quantity:+c.toFixed(8),price:n,dcaOrder:t.executedOrders,avgPrice:+t.avgPrice.toFixed(2)}),s==null||s(`âœ… DCA Buy #${t.executedOrders}: ${c.toFixed(6)} ${t.pair.replace("USDT","")} @ $${n.toFixed(2)}`),s==null||s(`ðŸ“Š Avg price: $${t.avgPrice.toFixed(2)} | Total invested: $${t.totalInvested.toFixed(2)}`)}catch(i){s==null||s(`âŒ Error: ${i.message}`)}}};await r();const l=setInterval(r,t.intervalMinutes*60*1e3);t._interval=l}stop(t){const s=this.activeBots.get(t);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(t))}getStats(t){const s=this.activeBots.get(t);if(!s)return null;const r=s.totalQuantity*(s.lastBuyPrice||0)-s.totalInvested;return{executedOrders:s.executedOrders,maxOrders:s.maxOrders,totalInvested:s.totalInvested,totalQuantity:s.totalQuantity,avgPrice:s.avgPrice,currentPrice:s.lastBuyPrice,unrealizedPnl:r,unrealizedPnlPercent:s.totalInvested>0?r/s.totalInvested*100:0,runningTime:Date.now()-s.startTime}}isRunning(t){return this.activeBots.has(t)}}const We=new Os;function $t(u){let t=u;const s=[...t.matchAll(/```(?:javascript|js|jsx)?\s*\n([\s\S]*?)```/g)];s.length>0&&(t=s.reduce((i,n)=>n[1].length>i.length?n[1]:i,""));const a=t.split(`
`),r=[];let l=!1;for(let i=0;i<a.length;i++){const n=a[i],c=n.trim();if(!l&&!c)continue;if(c===""||c.startsWith("//")||c.startsWith("/*")||c.startsWith("*")||c.startsWith("*/")||/^(config|const |let |var |if |else|for |while |function |return |buy|sell|log|alert|\{|\}|\(|\)|\/\/)/.test(c)||/^[a-zA-Z_$][a-zA-Z0-9_$]*\s*[\(=\.\[]/.test(c)||/^[a-zA-Z_$][a-zA-Z0-9_$]*\s*[+\-*/%<>&|!]/.test(c)||/^\}/.test(c))l=!0,r.push(n);else if(l&&!a.slice(i).some(o=>/^(\/\/|config|const |let |var |if |else|buy|sell|log)/.test(o.trim())))break}return r.join(`
`).trim()||t.trim()}function zs({code:u,onChange:t,error:s}){const a=P.useRef(null),r=n=>{if(n.key==="Tab"){n.preventDefault();const c=n.target.selectionStart,d=n.target.selectionEnd;t(u.substring(0,c)+"  "+u.substring(d)),setTimeout(()=>{n.target.selectionStart=n.target.selectionEnd=c+2},0)}},l=n=>{n.preventDefault();const c=n.clipboardData.getData("text"),d=$t(c),h=n.target,p=h.selectionStart,o=h.selectionEnd,b=u.substring(0,p)+d+u.substring(o);t(b)},i=(u||"").split(`
`).length;return e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:`1px solid ${s?"#ef4444":"rgba(255,255,255,0.08)"}`},children:[s&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2",style:{background:"rgba(239,68,68,0.08)",borderBottom:"1px solid rgba(239,68,68,0.2)"},children:[e.jsx(St,{size:13,style:{color:"#ef4444"}}),e.jsx("span",{className:"text-xs",style:{color:"#ef4444"},children:s})]}),e.jsxs("div",{className:"flex",style:{background:"#0d1117"},children:[e.jsx("div",{className:"select-none text-right pr-3 pl-3 pt-4 pb-4 shrink-0 font-mono text-[11px] leading-6",style:{color:"#484f58",background:"#0d1117",borderRight:"1px solid rgba(255,255,255,0.06)",minWidth:44},children:Array.from({length:Math.max(i,12)},(n,c)=>e.jsx("div",{children:c+1},c))}),e.jsx("textarea",{ref:a,value:u,onChange:n=>t(n.target.value),onPaste:l,onKeyDown:r,spellCheck:!1,className:"flex-1 p-4 font-mono text-[12px] leading-6 resize-none outline-none",style:{background:"#0d1117",color:"#c9d1d9",caretColor:"#3B82F6",minHeight:260},placeholder:"// Pega o escribe tu cÃ³digo aquÃ­..."})]})]})}function Ls({results:u}){if(!u)return null;const{trades:t,finalBalance:s,totalTrades:a,wins:r,losses:l,winRate:i,totalPnl:n,maxDrawdown:c,profitFactor:d}=u,h=n>=0;return e.jsxs(O.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Balance",value:`$${s.toFixed(0)}`,icon:ue,color:h?"#00DC82":"#ef4444"},{label:"Win Rate",value:`${i.toFixed(0)}%`,icon:qt,color:i>=50?"#00DC82":"#ef4444"},{label:"Drawdown",value:`${c.toFixed(1)}%`,icon:yt,color:c<10?"#00DC82":"#ef4444"},{label:"Profit F.",value:d===1/0?"âˆž":d.toFixed(2),icon:Fe,color:d>=1.5?"#00DC82":"#ef4444"}].map((p,o)=>e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(p.icon,{size:16,className:"mx-auto mb-1",style:{color:p.color}}),e.jsx("p",{className:"text-[10px]",style:{color:"#8b949e"},children:p.label}),e.jsx("p",{className:"text-base font-bold",style:{color:p.color},children:p.value})]},o))}),e.jsxs("div",{className:"flex items-center gap-4 text-xs px-4 py-2.5 rounded-xl",style:{background:"var(--surface-2)"},children:[e.jsxs("span",{style:{color:"#8b949e"},children:["Trades: ",e.jsx("b",{style:{color:"#c9d1d9"},children:a})]}),e.jsxs("span",{style:{color:"#00DC82"},children:["âœ“ ",r]}),e.jsxs("span",{style:{color:"#ef4444"},children:["âœ— ",l]}),e.jsxs("span",{className:"ml-auto font-bold text-sm",style:{color:h?"#00DC82":"#ef4444"},children:[h?"+":"","$",n.toFixed(2)]})]}),t.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto rounded-xl",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{color:"#8b949e",borderBottom:"1px solid var(--border)"},children:[e.jsx("th",{className:"text-left p-2.5 text-[10px]",children:"Tipo"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"Entrada"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"Salida"}),e.jsx("th",{className:"text-right p-2.5 text-[10px]",children:"P&L"})]})}),e.jsx("tbody",{children:t.slice(-8).reverse().map((p,o)=>{var b,m,g;return e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{className:"p-2.5 font-bold",style:{color:p.side==="buy"?"#00DC82":"#ef4444"},children:p.side==="buy"?"LONG":"SHORT"}),e.jsxs("td",{className:"p-2.5 text-right",style:{color:"#c9d1d9"},children:["$",(b=p.entryPrice)==null?void 0:b.toFixed(2)]}),e.jsxs("td",{className:"p-2.5 text-right",style:{color:"#c9d1d9"},children:["$",(m=p.exitPrice)==null?void 0:m.toFixed(2)]}),e.jsxs("td",{className:"p-2.5 text-right font-bold",style:{color:p.pnl>=0?"#00DC82":"#ef4444"},children:[p.pnl>=0?"+":"","$",(g=p.pnl)==null?void 0:g.toFixed(2)]})]},o)})})]})})]})}function Tt({onSave:u,onClose:t,initialCode:s,initialName:a,editMode:r=!1}){const[l,i]=P.useState(a||""),[n,c]=P.useState(s||""),[d,h]=P.useState(null),[p,o]=P.useState("editor"),[b,m]=P.useState(null),[g,f]=P.useState(!1),[k,N]=P.useState("BTCUSDT"),[F,v]=P.useState("1h"),[w,S]=P.useState(!1);P.useEffect(()=>{const C=setTimeout(()=>{if(n!=null&&n.trim()){const R=mt(n);h(R.valid?null:R.error)}else h(null)},600);return()=>clearTimeout(C)},[n]);const j=async()=>{f(!0),m(null);try{const C=await Y.getCandles(k,F,500);if(!C||C.length<50){h("No hay suficientes datos"),f(!1);return}m(Is(n,C,{initialBalance:1e3,riskPercent:2}))}catch(C){h(`Error: ${C.message}`)}f(!1)},y=()=>{if(!l.trim()){h("Escribe un nombre para tu estrategia");return}const C=mt(n);if(!C.valid){h(C.error);return}u==null||u({name:l.trim(),code:n,type:"custom_script"}),S(!0),setTimeout(()=>S(!1),2500)},E=async()=>{var C;try{const R=await((C=navigator.clipboard)==null?void 0:C.readText());R&&(c($t(R)),m(null))}catch{}};return e.jsxs(O.div,{initial:{opacity:0,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.97},className:"rounded-2xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4",style:{borderBottom:"1px solid var(--border)",background:"rgba(59,130,246,0.03)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(59,130,246,0.12)",border:"1px solid rgba(59,130,246,0.25)"},children:e.jsx(re,{size:20,style:{color:"#3B82F6"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold",style:{color:"#c9d1d9"},children:r?"Editar Estrategia":"Crear Estrategia"}),e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Escribe cÃ³digo, elige un template o pega desde ChatGPT"})]})]}),t&&e.jsx("button",{onClick:t,className:"w-9 h-9 rounded-xl flex items-center justify-center transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsx(Qe,{size:16,style:{color:"#8b949e"}})})]}),e.jsx("div",{className:"flex px-5 pt-3 gap-1",children:[{id:"editor",label:"Editor",icon:re},{id:"templates",label:"Templates",icon:jt},{id:"help",label:"Referencia",icon:Je}].map(C=>{const R=p===C.id;return e.jsxs("button",{onClick:()=>o(C.id),className:"flex items-center gap-1.5 px-4 py-2 rounded-t-xl text-xs font-semibold transition-all",style:{background:R?"var(--surface-2)":"transparent",color:R?"#3B82F6":"#8b949e",borderBottom:R?"2px solid #3B82F6":"2px solid transparent"},children:[e.jsx(C.icon,{size:13}),C.label]},C.id)})}),e.jsxs("div",{className:"p-5 space-y-4",children:[p==="editor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold mb-1.5 block",style:{color:"#8b949e"},children:"NOMBRE DE LA ESTRATEGIA"}),e.jsx("input",{value:l,onChange:C=>i(C.target.value),placeholder:"Ej: Mi Bot Scalper",className:"w-full px-4 py-2.5 rounded-xl text-sm outline-none transition-all focus:ring-1 focus:ring-[#D4AF37]",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"}})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:E,className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"rgba(0,220,130,0.08)",border:"1px solid rgba(0,220,130,0.2)",color:"#00DC82"},children:[e.jsx(zt,{size:14})," Pegar CÃ³digo"]}),e.jsxs("button",{onClick:()=>{var C;return(C=navigator.clipboard)==null?void 0:C.writeText(n)},className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:[e.jsx(Nt,{size:14})," Copiar"]}),e.jsxs("button",{onClick:()=>{c(""),m(null)},className:"flex items-center justify-center gap-2 py-2.5 rounded-xl text-xs font-semibold transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#8b949e"},children:[e.jsx(Qe,{size:14})," Limpiar"]})]}),e.jsx(zs,{code:n,onChange:C=>{c(C),m(null)},error:d}),e.jsxs("div",{className:"rounded-xl p-3 space-y-3",style:{background:"rgba(0,220,130,0.03)",border:"1px solid rgba(0,220,130,0.1)"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(he,{size:13,style:{color:"#00DC82"}}),e.jsx("span",{className:"text-[11px] font-bold",style:{color:"#00DC82"},children:"Backtest"}),e.jsx("span",{className:"text-[10px]",style:{color:"#6b7280"},children:"â€” Prueba tu cÃ³digo con datos reales antes de activar el bot"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("select",{value:k,onChange:C=>N(C.target.value),className:"px-3 py-1.5 rounded-lg text-[11px] font-semibold outline-none",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT"].map(C=>e.jsx("option",{value:C,children:C},C))}),e.jsx("select",{value:F,onChange:C=>v(C.target.value),className:"px-3 py-1.5 rounded-lg text-[11px] font-semibold outline-none",style:{background:"var(--surface-2)",border:"1px solid var(--border)",color:"#c9d1d9"},children:["1m","5m","15m","1h","4h","1d"].map(C=>e.jsx("option",{value:C,children:C},C))}),e.jsxs("button",{onClick:j,disabled:g||!!d||!(n!=null&&n.trim()),className:"flex items-center gap-2 px-4 py-1.5 rounded-lg text-[11px] font-bold transition-all hover:brightness-110 disabled:opacity-40",style:{background:"rgba(0,220,130,0.12)",border:"1px solid rgba(0,220,130,0.25)",color:"#00DC82"},children:[g?e.jsx(wt,{size:12,className:"animate-spin"}):e.jsx(he,{size:12}),g?"Probando...":"Ejecutar Test"]})]})]}),e.jsx(se,{children:b&&e.jsx(Ls,{results:b})}),e.jsx("button",{onClick:y,disabled:!!d||!(n!=null&&n.trim())||!(l!=null&&l.trim()),className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-bold transition-all hover:brightness-110 disabled:opacity-40",style:{background:w?"rgba(0,220,130,0.15)":"linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)",color:w?"#00DC82":"#fff",border:"none"},children:w?e.jsxs(e.Fragment,{children:[e.jsx(je,{size:15})," Estrategia Guardada"]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{size:15})," Guardar Estrategia"]})})]}),p==="templates"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Haz clic en un template para cargarlo en el editor. Puedes modificarlo despuÃ©s."}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:_s.map(C=>e.jsxs("button",{onClick:()=>{c(C.code),l||i(C.name),o("editor"),m(null)},className:"flex items-center gap-4 p-4 rounded-xl text-left transition-all hover:brightness-110",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)"},children:e.jsx(ne,{size:18,style:{color:"#3B82F6"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold",style:{color:"#c9d1d9"},children:C.name}),e.jsx("p",{className:"text-[11px] mt-0.5",style:{color:"#8b949e"},children:C.description})]}),e.jsx("span",{className:"text-[10px] px-2 py-1 rounded-lg font-bold shrink-0",style:{color:C.difficulty==="Principiante"?"#00DC82":C.difficulty==="Intermedio"?"#3B82F6":"#A855F7",background:C.difficulty==="Principiante"?"rgba(0,220,130,0.1)":C.difficulty==="Intermedio"?"rgba(59,130,246,0.1)":"rgba(168,85,247,0.1)"},children:C.difficulty}),e.jsx(we,{size:16,style:{color:"#484f58"}})]},C.id))})]}),p==="help"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-xs",style:{color:"#8b949e"},children:"Funciones disponibles en Kairos Script."}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(97,175,239,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#61AFEF"},children:"ðŸ“Š Indicadores"})}),[["ema(periodo)","Media MÃ³vil Exponencial"],["sma(periodo)","Media MÃ³vil Simple"],["rsi(periodo)","Fuerza Relativa (0-100)"],["macd(f, s, sig)",".line .signal .histogram"],["bb(periodo, std)",".upper .middle .lower"],["vwap()","Precio Promedio por Volumen"]].map(([C,R])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#61AFEF"},children:C}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:R})]},C))]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(224,108,117,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#E06C75"},children:"âš¡ Acciones"})}),[["buy()","SeÃ±al de COMPRA"],["sell()","SeÃ±al de VENTA"],["config({ stopLoss, takeProfit })","SL/TP en %"],['log("msg")',"Log del bot"]].map(([C,R])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#E06C75"},children:C}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:R})]},C))]}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{border:"1px solid var(--border)"},children:[e.jsx("div",{className:"px-4 py-2.5",style:{background:"rgba(0,220,130,0.06)",borderBottom:"1px solid var(--border)"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:"#00DC82"},children:"ðŸ” DetecciÃ³n"})}),[["crossover(a, b)","A cruza arriba de B"],["crossunder(a, b)","A cruza abajo de B"],["highest(ind, n)","MÃ¡ximo en N barras"],["lowest(ind, n)","MÃ­nimo en N barras"],["avg(ind, n)","Promedio en N barras"],["percentChange(ind, n)","Cambio % en N barras"]].map(([C,R])=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("code",{className:"text-xs font-bold",style:{color:"#00DC82"},children:C}),e.jsx("span",{className:"text-[10px]",style:{color:"#8b949e"},children:R})]},C))]}),e.jsxs("div",{className:"rounded-xl p-4",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx("span",{className:"text-xs font-bold",style:{color:"#56B6C2"},children:"ðŸ“ˆ Variables"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:["close","open","high","low","volume","price","barIndex"].map(C=>e.jsx("code",{className:"text-[11px] px-2.5 py-1 rounded-lg font-bold",style:{background:"rgba(86,182,194,0.1)",color:"#56B6C2",border:"1px solid rgba(86,182,194,0.2)"},children:C},C))})]}),e.jsxs("button",{onClick:()=>o("editor"),className:"w-full py-2.5 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all hover:brightness-110",style:{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.2)",color:"#3B82F6"},children:[e.jsx(re,{size:14})," Volver al Editor"]})]})]})]})}const He=[{id:"signal",label:"Signal Bot",icon:ne,desc:"Indicadores tÃ©cnicos predefinidos",color:"#3B82F6"},{id:"script",label:"Script Bot",icon:re,desc:"Estrategia personalizada con cÃ³digo",color:"#A855F7"},{id:"grid",label:"Grid Bot",icon:Kt,desc:"Compra y vende en niveles de precio",color:"#00DC82"},{id:"dca",label:"DCA Bot",icon:Se,desc:"InversiÃ³n a intervalos regulares",color:"#22D3EE"}];function qs(){const{bots:u,addBot:t,updateBot:s,removeBot:a,strategies:r,addStrategy:l,brokers:i,setPage:n,setSelectedPair:c}=J(),[d,h]=P.useState(!1),[p,o]=P.useState(!1),[b,m]=P.useState(null),[g,f]=P.useState("signal"),[k,N]=P.useState([]),[F,v]=P.useState(""),[w,S]=P.useState({}),[j,y]=P.useState({name:"",pair:"BTCKAIROS",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10",upperPrice:"",lowerPrice:"",gridLines:"10",investmentPerOrder:"100",intervalMinutes:"60",maxOrders:"50",useRsiFilter:!1,rsiThreshold:"40",usePriceDipFilter:!1,dipPercent:"3",scriptCode:"",scriptStrategyId:""}),E=P.useCallback(async()=>{var x;for(const A of i.filter(T=>T.connected))try{(x=ie.connections)!=null&&x.has(A.id)||await ie.connect(A);const T=await ie.getBalances(A.id),D=Array.isArray(T)?T:(T==null?void 0:T.balances)||[];S(U=>({...U,[A.id]:{balances:D,loading:!1,error:!1}}))}catch(T){console.warn("Balance fetch failed for",A.id,T.message),S(D=>({...D,[A.id]:{balances:[],loading:!1,error:!0}}))}},[i]);P.useEffect(()=>{E();const x=setInterval(E,3e4);return()=>clearInterval(x)},[E]),P.useEffect(()=>{const A=J.getState().bots.filter(D=>D.status==="active");for(const D of A)if(ye.activeBots.has(D.id))ye.setCallbacks(D.id,U=>M(D,U),U=>L(D,U));else{const U=D.botType||"signal";U==="signal"||U==="script"?ye.startBot({...D,status:"active"},H=>M(D,H),H=>L(D,H)):U==="grid"?Ve.start({id:D.id,pair:D.pair,upperPrice:D.upperPrice,lowerPrice:D.lowerPrice,gridLines:D.gridLines,investment:D.balance,onLog:H=>L(D,H),onTrade:H=>M(D,H)}):U==="dca"&&We.start({id:D.id,pair:D.pair,investmentPerOrder:D.investmentPerOrder,intervalMinutes:D.intervalMinutes,maxOrders:D.maxOrders,onLog:H=>L(D,H),onTrade:H=>M(D,H)})}const T=ye.getAllLogs();T.length>0&&N(D=>D.length>0?D:T.map(U=>({type:"log",bot:U.botName,message:U.message,time:new Date(U.time).toLocaleTimeString()})))},[]);const C=x=>i.find(A=>A.id===x.brokerId),R=x=>w[x]||null,_=x=>{c(x.pair),n("chart")},K=()=>{v("");const x=j.name.trim()||`Bot ${new Date().toLocaleTimeString("es",{hour:"2-digit",minute:"2-digit"})}`;if(!j.pair){v("Selecciona un par de trading");return}const A={name:x,pair:j.pair,botType:g,brokerId:j.brokerId};if(g==="signal"){const T=r.find(D=>D.id===j.strategyId)||{name:"EMA Cross 9/21",entry:{condition:"EMA 9 cruza EMA 21",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},exit:{condition:"Cruce opuesto",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},stopLoss:"2",takeProfit:"4"};Object.assign(A,{timeframe:j.timeframe,strategy:T,balance:parseFloat(j.balance),riskPercent:parseFloat(j.riskPercent),maxTrades:parseInt(j.maxTrades)})}else if(g==="script"){if(!j.scriptStrategyId){v("Selecciona una estrategia o crea una nueva");return}const T=r.find(D=>D.id===j.scriptStrategyId);if(!(T!=null&&T.code)){v("La estrategia seleccionada no tiene cÃ³digo. EdÃ­tala y guarda el cÃ³digo primero.");return}Object.assign(A,{timeframe:j.timeframe,strategy:{type:"custom_script",code:T.code,name:T.name},balance:parseFloat(j.balance),riskPercent:parseFloat(j.riskPercent),maxTrades:parseInt(j.maxTrades),scriptName:T.name})}else if(g==="grid"){if(!j.upperPrice||!j.lowerPrice){v("Ingresa el precio superior e inferior para el grid");return}Object.assign(A,{upperPrice:parseFloat(j.upperPrice),lowerPrice:parseFloat(j.lowerPrice),gridLines:parseInt(j.gridLines),balance:parseFloat(j.balance)})}else g==="dca"&&Object.assign(A,{investmentPerOrder:parseFloat(j.investmentPerOrder),intervalMinutes:parseInt(j.intervalMinutes),maxOrders:parseInt(j.maxOrders),useRsiFilter:j.useRsiFilter,rsiThreshold:parseInt(j.rsiThreshold),usePriceDipFilter:j.usePriceDipFilter,dipPercent:parseFloat(j.dipPercent),balance:parseFloat(j.investmentPerOrder)*parseInt(j.maxOrders)});t(A),h(!1),v("")},L=(x,A)=>{N(T=>[...T.slice(-100),{type:"log",bot:x.name,message:A,time:new Date().toLocaleTimeString()}])},M=(x,A)=>{N(D=>[...D.slice(-100),{type:"trade",bot:x.name,...A,time:new Date().toLocaleTimeString()}]);const T=J.getState().bots.find(D=>D.id===x.id);if(T){const D=(T.trades||0)+1,U=parseFloat(A.profit)||0,H=(T.pnl||0)+U;let oe=T.winRate||0;if(A.action==="close"&&U!==0){const W=(T._closedTrades||0)+1,pe=(T._wins||0)+(U>0?1:0);oe=W>0?pe/W*100:0,s(x.id,{trades:D,pnl:H,winRate:oe,_closedTrades:W,_wins:pe})}else s(x.id,{trades:D,pnl:H})}},$=async x=>{s(x.id,{status:"active"});const A=x.botType||"signal";A==="signal"||A==="script"?ye.startBot({...x,status:"active"},T=>M(x,T),T=>L(x,T)):A==="grid"?Ve.start({id:x.id,pair:x.pair,upperPrice:x.upperPrice,lowerPrice:x.lowerPrice,gridLines:x.gridLines,investment:x.balance,onLog:T=>L(x,T),onTrade:T=>M(x,T)}):A==="dca"&&We.start({id:x.id,pair:x.pair,investmentPerOrder:x.investmentPerOrder,intervalMinutes:x.intervalMinutes,maxOrders:x.maxOrders,useRsiFilter:x.useRsiFilter,rsiThreshold:x.rsiThreshold,usePriceDipFilter:x.usePriceDipFilter,dipPercent:x.dipPercent,onLog:T=>L(x,T),onTrade:T=>M(x,T)})},B=x=>{const A=x.botType||"signal";A==="signal"||A==="script"?ye.stopBot(x.id):A==="grid"?Ve.stop(x.id):A==="dca"&&We.stop(x.id),s(x.id,{status:"stopped"})},q=x=>{B(x),s(x.id,{status:"paused"})},Z=x=>{B(x),a(x.id)},I=x=>{switch(x){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},z=x=>He.find(A=>A.id===x)||He[0];return e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-5 py-5 space-y-5 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[u.filter(x=>x.status==="active").length," activos de ",u.length," total"]})]}),e.jsxs("button",{onClick:()=>h(!d),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-xs font-semibold shrink-0",children:[e.jsx(Oe,{size:14})," Crear Bot"]})]}),e.jsx(se,{children:d&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--text)]",children:"Nuevo Bot de Trading"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:He.map(x=>{const A=x.icon;return e.jsxs("button",{onClick:()=>f(x.id),className:`p-3 rounded-xl text-center transition-all flex flex-col items-center justify-center min-w-0 ${g===x.id?"ring-1":"hover:bg-[var(--surface-2)]"}`,style:{background:g===x.id?`${x.color}10`:"var(--surface-2)",borderColor:g===x.id?`${x.color}40`:"var(--border)",border:`1px solid ${g===x.id?x.color+"30":"var(--border)"}`},children:[e.jsx(A,{size:20,style:{color:x.color},className:"mb-1.5 shrink-0"}),e.jsx("p",{className:"text-xs font-bold truncate w-full",style:{color:g===x.id?x.color:"var(--text)"},children:x.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mt-0.5 truncate w-full",children:x.desc})]},x.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:j.name,onChange:x=>y({...j,name:x.target.value}),placeholder:"Mi Bot",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Par"}),e.jsx("select",{value:j.pair,onChange:x=>y({...j,pair:x.target.value}),className:"w-full",children:Ct.map(x=>e.jsx("option",{value:x,children:de(x)},x))})]})]}),g==="signal"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:j.timeframe,onChange:x=>y({...j,timeframe:x.target.value}),className:"w-full",children:Ze.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:j.balance,onChange:x=>y({...j,balance:x.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:j.riskPercent,onChange:x=>y({...j,riskPercent:x.target.value}),className:"w-full"})]})]}),g==="script"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:j.timeframe,onChange:x=>y({...j,timeframe:x.target.value}),className:"w-full",children:Ze.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:j.balance,onChange:x=>y({...j,balance:x.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:j.riskPercent,onChange:x=>y({...j,riskPercent:x.target.value}),className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Estrategia"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:j.scriptStrategyId,onChange:x=>y({...j,scriptStrategyId:x.target.value}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Seleccionar estrategia..."}),r.filter(x=>x.type==="custom_script").map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shrink-0",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(re,{size:13})," ",r.filter(x=>x.type==="custom_script").length>0?"Crear Nueva":"Crear Estrategia"]})]})]})]}),g==="grid"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Superior ($)"}),e.jsx("input",{type:"number",value:j.upperPrice,onChange:x=>y({...j,upperPrice:x.target.value}),placeholder:"100000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Inferior ($)"}),e.jsx("input",{type:"number",value:j.lowerPrice,onChange:x=>y({...j,lowerPrice:x.target.value}),placeholder:"90000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Niveles de Grid"}),e.jsx("input",{type:"number",value:j.gridLines,onChange:x=>y({...j,gridLines:x.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"InversiÃ³n Total ($)"}),e.jsx("input",{type:"number",value:j.balance,onChange:x=>y({...j,balance:x.target.value}),className:"w-full"})]})]}),g==="dca"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"$ por Compra"}),e.jsx("input",{type:"number",value:j.investmentPerOrder,onChange:x=>y({...j,investmentPerOrder:x.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Intervalo (min)"}),e.jsx("input",{type:"number",value:j.intervalMinutes,onChange:x=>y({...j,intervalMinutes:x.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"MÃ¡x. Compras"}),e.jsx("input",{type:"number",value:j.maxOrders,onChange:x=>y({...j,maxOrders:x.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.useRsiFilter,onChange:x=>y({...j,useRsiFilter:x.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro RSI (comprar solo si RSI < ",j.rsiThreshold,")"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.usePriceDipFilter,onChange:x=>y({...j,usePriceDipFilter:x.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro de CaÃ­da (comprar cuando baje ",j.dipPercent,"%)"]})]})]}),i.filter(x=>x.connected).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Broker (ejecuciÃ³n real)"}),e.jsxs("select",{value:j.brokerId,onChange:x=>y({...j,brokerId:x.target.value}),className:"w-full",children:[e.jsx("option",{value:"",children:"Demo (sin broker)"}),i.filter(x=>x.connected).map(x=>e.jsxs("option",{value:x.id,children:["ðŸŸ¢ ",x.name||x.broker," â€” Real"]},x.id))]}),j.brokerId&&e.jsx("p",{className:"text-[10px] text-[var(--red)] mt-1 font-semibold",children:"âš ï¸ Este bot ejecutarÃ¡ Ã³rdenes REALES con dinero real"})]}),F&&e.jsxs("p",{className:"text-xs text-[var(--red)] font-semibold px-1",children:["âš ï¸ ",F]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:K,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm font-bold text-center justify-center",children:"Crear Bot"}),e.jsx("button",{onClick:()=>{h(!1),v("")},className:"px-4 py-2.5 bg-[var(--surface-2)] text-[var(--text-dim)] rounded-xl text-sm border border-[var(--border)] text-center shrink-0",children:"Cancelar"})]})]})})}),u.length===0?e.jsxs("div",{className:"rounded-2xl p-16 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(Ne,{size:56,className:"text-[var(--text-dim)]/20 mx-auto mb-5"}),e.jsx("p",{className:"text-lg text-[var(--text-dim)] font-semibold",children:"No hay bots creados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-2",children:"Crea tu primer bot para automatizar tu trading"}),e.jsxs("button",{onClick:()=>h(!0),className:"mt-5 px-6 py-3 btn-gold rounded-xl text-sm font-bold inline-flex items-center gap-2",children:[e.jsx(Oe,{size:16})," Crear Bot"]})]}):e.jsx("div",{className:"space-y-4",children:u.map(x=>{var oe;const A=z(x.botType||"signal"),T=A.icon,D=C(x),U=x.brokerId?R(x.brokerId):null,H=x.scriptName||((oe=x.strategy)==null?void 0:oe.name)||"Default";return e.jsxs(O.div,{layout:!0,className:"rounded-2xl overflow-hidden min-w-0",style:{background:"var(--surface)",border:`1px solid ${x.status==="active"?"rgba(0,220,130,0.2)":"var(--border)"}`},children:[e.jsxs("div",{className:"p-5 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:()=>_(x),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:`${A.color}12`,border:`1px solid ${A.color}25`},children:e.jsx(T,{size:24,style:{color:A.color}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-wrap",children:[e.jsx("p",{className:"text-base font-bold truncate",children:x.name}),e.jsx("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-lg uppercase tracking-wider shrink-0",style:{background:`${A.color}15`,color:A.color},children:A.label})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-[var(--text-dim)] flex-wrap",children:[e.jsx("span",{className:"font-semibold text-[var(--text-secondary)]",children:de(x.pair)}),x.timeframe&&e.jsxs("span",{children:["â€¢ ",x.timeframe]}),e.jsxs("span",{children:["â€¢ ",H]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("span",{className:"px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap",style:{color:I(x.status),background:`${I(x.status)}15`,border:`1px solid ${I(x.status)}20`},children:x.status==="active"?"â— Activo":x.status==="paused"?"âšâš Pausado":"â–  Detenido"}),e.jsx(st,{size:16,className:"text-[var(--text-dim)]"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[D?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(tt,{size:13,className:"text-[var(--green)] shrink-0"}),e.jsx("span",{className:"font-semibold text-[var(--text)]",children:D.label||D.name||D.broker}),e.jsx("span",{className:"text-[var(--green)] font-bold",children:"â€¢ Conectado"})]}):e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsx("span",{className:"text-[var(--text-dim)]",children:"ðŸ“‹ Modo Demo"})}),U&&U.balances.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Se,{size:13,className:"text-[var(--gold)] shrink-0"}),e.jsxs("span",{className:"font-semibold text-[var(--text)]",children:["Saldo: ",U.balances.slice(0,3).map(W=>`${parseFloat(W.free).toFixed(4)} ${W.asset}`).join(" â€¢ ")]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-px",style:{background:"var(--border)",borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"Trades"}),e.jsx("p",{className:"text-lg font-bold",children:x.trades||0})]}),e.jsxs("div",{className:"p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"P&L"}),e.jsxs("p",{className:`text-lg font-bold ${(x.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(x.pnl||0)>=0?"+":"","$",(x.pnl||0).toFixed(2)]})]}),e.jsxs("div",{className:"p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[(x.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"Balance"}),(()=>{const W=parseFloat(x.balance)||0,pe=parseFloat(x.pnl)||0,Q=W+pe,_e=Q>=W;return e.jsxs("div",{children:[e.jsxs("p",{className:`text-lg font-bold ${_e?"text-[var(--green)]":"text-[var(--red)]"}`,children:["$",Q.toFixed(2)]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Inicio: $",W.toFixed(2)]})]})})()]})]}),e.jsxs("div",{className:"flex gap-3 p-4 flex-wrap items-center",style:{borderTop:"1px solid var(--border)"},children:[x.status!=="active"?e.jsxs("button",{onClick:W=>{W.stopPropagation(),$(x)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--green)]/10 text-[var(--green)] rounded-xl text-sm font-bold hover:bg-[var(--green)]/20 transition-colors border border-[var(--green)]/20",children:[e.jsx(he,{size:15,className:"shrink-0"})," Iniciar"]}):e.jsxs("button",{onClick:W=>{W.stopPropagation(),q(x)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--gold)]/10 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/20 transition-colors border border-[var(--gold)]/20",children:[e.jsx(Ut,{size:15,className:"shrink-0"})," Pausar"]}),e.jsxs("button",{onClick:W=>{W.stopPropagation(),B(x)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--text-dim)] rounded-xl text-sm hover:text-[var(--text)] transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Vt,{size:15,className:"shrink-0"})," Detener"]}),e.jsxs("button",{onClick:W=>{W.stopPropagation(),_(x)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--gold)] rounded-xl text-sm font-semibold hover:bg-[var(--gold)]/10 transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--gold)/20"},children:[e.jsx(ue,{size:15,className:"shrink-0"})," Ver GrÃ¡fico"]}),e.jsxs("button",{onClick:W=>{W.stopPropagation(),Z(x)},className:"ml-auto inline-flex items-center justify-center gap-1.5 px-4 py-2.5 text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/10 rounded-xl text-sm transition-colors",children:[e.jsx(ke,{size:14,className:"shrink-0"})," Eliminar"]})]})]},x.id)})}),k.length>0&&e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[var(--green)] animate-pulse"}),"Actividad en Vivo"]}),e.jsx("button",{onClick:()=>N([]),className:"text-sm text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors px-3 py-1 rounded-lg hover:bg-[var(--gold)]/10",children:"Limpiar"})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto p-4 space-y-1.5 font-mono text-xs",children:k.slice(-50).reverse().map((x,A)=>{var T;return e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:x.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0 font-semibold",children:["[",x.bot,"]"]}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:x.message||`${(T=x.side)==null?void 0:T.toUpperCase()} ${x.quantity} @ $${x.price}`})]},A)})})]}),r.filter(x=>x.type==="custom_script").length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("h2",{className:"text-base font-bold flex items-center gap-2.5 min-w-0",children:[e.jsx(re,{size:18,className:"text-[#A855F7] shrink-0"})," Mis Estrategias"]}),e.jsxs("button",{onClick:()=>o(!0),className:"text-sm text-[var(--text-dim)] hover:text-[#A855F7] transition-colors flex items-center gap-1.5 shrink-0 px-3 py-1.5 rounded-xl hover:bg-[#A855F7]/10",children:[e.jsx(Oe,{size:14})," Nueva"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.filter(x=>x.type==="custom_script").map(x=>{var A;return e.jsxs("div",{className:"rounded-xl p-4 transition-colors hover:bg-[var(--dark-3)] min-w-0",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-[var(--text)] flex items-center gap-2 min-w-0 truncate",children:[e.jsx(re,{size:14,className:"text-[#A855F7] shrink-0"})," ",e.jsx("span",{className:"truncate",children:x.name})]}),e.jsx("button",{onClick:()=>{m(x),o(!0)},className:"text-[var(--text-dim)] hover:text-[#A855F7] transition-colors shrink-0 p-1.5 rounded-lg hover:bg-[#A855F7]/10",children:e.jsx(kt,{size:14})})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] truncate",children:[((A=x.code)==null?void 0:A.split(`
`).filter(T=>T.trim()&&!T.trim().startsWith("//")).length)||0," lÃ­neas de lÃ³gica"]}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 truncate",children:["Creada: ",new Date(x.createdAt).toLocaleDateString("es")]})]},x.id)})})]}),e.jsx(se,{children:p&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{o(!1),m(null)},children:e.jsx(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:x=>x.stopPropagation(),children:e.jsx(Tt,{initialCode:b==null?void 0:b.code,initialName:b==null?void 0:b.name,editMode:!!b,onClose:()=>{o(!1),m(null)},onSave:x=>{const A=l(x);y(T=>({...T,scriptStrategyId:A.id})),o(!1),m(null)}})})})})]})}const pt=[{id:"binance",name:"Binance",logo:"ðŸŸ¡",color:"#F0B90B",desc:"El exchange mÃ¡s grande del mundo",features:["Spot","Futuros","Margin"],users:"150M+",apiUrl:"https://www.binance.com/en/my/settings/api-management",steps:[{title:"Inicia sesiÃ³n en Binance",desc:"Ve a binance.com e inicia sesiÃ³n en tu cuenta."},{title:"Ve a API Management",desc:'Haz clic en tu perfil â†’ "API Management" o usa el enlace directo de abajo.'},{title:"Crea una nueva API Key",desc:'Haz clic en "Create API" â†’ Elige "System Generated Keys".'},{title:"Configura permisos",desc:'Activa solo "Enable Reading" y "Enable Spot & Margin Trading". NO actives retiros.'},{title:"Copia tus claves",desc:"Copia el API Key y Secret Key. El Secret solo se muestra UNA vez."}]},{id:"bybit",name:"Bybit",logo:"ðŸŸ ",color:"#F7A600",desc:"Trading de derivados lÃ­der",features:["Spot","Futuros","Opciones"],users:"20M+",apiUrl:"https://www.bybit.com/app/user/api-management",steps:[{title:"Inicia sesiÃ³n en Bybit",desc:"Ve a bybit.com e inicia sesiÃ³n."},{title:"Ve a API Management",desc:'Perfil â†’ "API" o usa el enlace directo de abajo.'},{title:"Crea nueva API Key",desc:'Clic en "Create New Key" â†’ "System-generated API Keys".'},{title:"Configura permisos",desc:'Selecciona "Read-Write" para Trading. Deja desactivado "Withdrawal".'},{title:"Copia tus claves",desc:"Copia el API Key y API Secret antes de cerrar."}]},{id:"kraken",name:"Kraken",logo:"ðŸŸ£",color:"#7B61FF",desc:"Regulado y seguro desde 2011",features:["Spot","Futuros","Staking"],users:"10M+",apiUrl:"https://www.kraken.com/u/security/api",steps:[{title:"Inicia sesiÃ³n en Kraken",desc:"Ve a kraken.com e inicia sesiÃ³n."},{title:"Ve a API Settings",desc:'Security â†’ API â†’ "Add Key".'},{title:"Configura permisos",desc:'Activa "Query Funds", "Query Orders", "Create/Modify Orders".'},{title:"Guarda la clave",desc:"Kraken te da un Key y un Private Key. Copia ambos."}]},{id:"coinbase",name:"Coinbase",logo:"ðŸ”µ",color:"#0052FF",desc:"Exchange pÃºblico regulado en USA",features:["Spot","Advanced Trade"],users:"110M+",apiUrl:"https://portal.cdp.coinbase.com/access/api",steps:[{title:"Inicia sesiÃ³n en Coinbase",desc:"Ve a portal.cdp.coinbase.com e inicia sesiÃ³n."},{title:"Crea nueva API Key",desc:'Haz clic en "Create API Key". Coinbase te darÃ¡ un API Key Name y una EC Private Key.'},{title:"Configura permisos",desc:'Selecciona "View" y "Trade". NO actives "Transfer".'},{title:"Copia tus 2 claves",desc:"Copia el API Key Name (va en API KEY) y la EC Private Key completa (va en API SECRET). No necesitas Passphrase."}]},{id:"kucoin",name:"KuCoin",logo:"ðŸŸ¢",color:"#23AF91",desc:"La exchange del pueblo",features:["Spot","Futuros","Bots"],users:"30M+",apiUrl:"https://www.kucoin.com/account/api",needsPassphrase:!0,steps:[{title:"Inicia sesiÃ³n en KuCoin",desc:"Ve a kucoin.com e inicia sesiÃ³n."},{title:"Ve a API Management",desc:'Account â†’ API Management â†’ "Create API".'},{title:"Configura permisos y Passphrase",desc:'Activa "General" y "Trade". Crea un passphrase. No actives "Transfer".'},{title:"Copia tus 3 claves",desc:"NecesitarÃ¡s: API Key, API Secret y Passphrase."}]},{id:"okx",name:"OKX",logo:"âš«",color:"#FFFFFF",desc:"Trading avanzado multimercado",features:["Spot","Futuros","Opciones"],users:"50M+",apiUrl:"https://www.okx.com/account/my-api",needsPassphrase:!0,steps:[{title:"Inicia sesiÃ³n en OKX",desc:"Ve a okx.com e inicia sesiÃ³n."},{title:"Ve a API Settings",desc:'Perfil â†’ API â†’ "Create API Key".'},{title:"Configura permisos y Passphrase",desc:'Selecciona "Read" y "Trade". Crea un passphrase. NO actives "Withdraw".'},{title:"Copia tus 3 claves",desc:"NecesitarÃ¡s: API Key, Secret Key y Passphrase."}]},{id:"bitget",name:"Bitget",logo:"ðŸ”·",color:"#00CED1",desc:"Copy trading #1 del mundo",features:["Spot","Futuros","Copy"],users:"25M+",apiUrl:"https://www.bitget.com/account/newapi",needsPassphrase:!0,steps:[{title:"Inicia sesiÃ³n en Bitget",desc:"Ve a bitget.com e inicia sesiÃ³n."},{title:"Ve a API Management",desc:'Account â†’ API Management â†’ "Create API".'},{title:"Configura permisos y Passphrase",desc:'Activa "Read" y "Trade". Crea passphrase. No actives "Transfer".'},{title:"Copia tus 3 claves",desc:"NecesitarÃ¡s: API Key, Secret Key y Passphrase."}]},{id:"mexc",name:"MEXC",logo:"ðŸ”»",color:"#00B897",desc:"MÃ¡s de 1,500 criptomonedas",features:["Spot","Futuros"],users:"10M+",apiUrl:"https://www.mexc.com/ucenter/api",steps:[{title:"Inicia sesiÃ³n en MEXC",desc:"Ve a mexc.com e inicia sesiÃ³n."},{title:"Ve a API Management",desc:'Account â†’ API Management â†’ "Create API Key".'},{title:"Configura permisos",desc:'Marca "Read" y "Trade". Sin permisos de retiro.'},{title:"Copia tus claves",desc:"Copia API Key y Secret Key."}]}],te={SELECT:"select",GUIDE:"guide",KEYS:"keys",VERIFYING:"verifying",SUCCESS:"success"};function Ks(){const{brokers:u,addBroker:t,removeBroker:s,updateBrokerStatus:a,setActiveBroker:r}=J(),[l,i]=P.useState(!1),[n,c]=P.useState(te.SELECT),[d,h]=P.useState(null),[p,o]=P.useState(0),[b,m]=P.useState({apiKey:"",apiSecret:"",passphrase:"",label:""}),[g,f]=P.useState(!1),[k,N]=P.useState(""),[F,v]=P.useState({}),[w,S]=P.useState({}),[j,y]=P.useState(null),E=P.useCallback(async $=>{S(B=>({...B,[$.id]:!0}));try{const B=await ie.getBalances($.id);Array.isArray(B)?v(q=>({...q,[$.id]:B})):B!=null&&B.success&&v(q=>({...q,[$.id]:B.balances}))}catch{}S(B=>({...B,[$.id]:!1}))},[]);P.useEffect(()=>{const $=u.filter(q=>q.connected);$.forEach(q=>E(q));const B=setInterval(()=>$.forEach(q=>E(q)),3e4);return()=>clearInterval(B)},[u,E]);const C=$=>{h($),o(0),c(te.GUIDE),m({apiKey:"",apiSecret:"",passphrase:"",label:""}),N(""),i(!0)},R=async()=>{if(!b.apiKey.trim()||!b.apiSecret.trim()){N("API Key y Secret son obligatorios");return}if(d.needsPassphrase&&!b.passphrase.trim()){N("Este exchange requiere Passphrase");return}N(""),c(te.VERIFYING);const $=t({brokerId:d.id,label:b.label||d.name,apiKey:b.apiKey.trim(),apiSecret:b.apiSecret.trim(),passphrase:b.passphrase.trim()||void 0});try{const B=await ie.connect($);a($.id,B.success),B.success?(r($),E($),c(te.SUCCESS),setTimeout(()=>{i(!1),c(te.SELECT)},2500)):(c(te.KEYS),N(B.message||"No se pudo conectar. Verifica que tus claves sean correctas y tengan los permisos adecuados."))}catch(B){c(te.KEYS),N(B.message||"Error de conexiÃ³n desconocido")}},_=$=>{ie.disconnect($),s($),v(B=>{const q={...B};return delete q[$],q})},K=$=>(F[$]||[]).reduce((q,Z)=>["USDT","USDC","BUSD","FDUSD","KAIROS"].includes(Z.asset)?q+parseFloat(Z.free)+parseFloat(Z.locked||0):q,0),L=u.map($=>$.brokerId),M=()=>{i(!1),c(te.SELECT)};return e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Conectar Exchange"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Conecta tu cuenta en 3 simples pasos."})]}),e.jsxs("div",{className:"rounded-xl p-4 flex items-start gap-3",style:{background:"rgba(59,130,246,0.04)",border:"1px solid rgba(59,130,246,0.1)"},children:[e.jsx(fe,{size:20,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"ConexiÃ³n segura con API Keys"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:["Tu exchange genera claves especiales (API Keys) que solo permiten leer y operar â€” ",e.jsx("strong",{className:"text-[var(--text)]",children:"nunca retirar fondos"}),". Las claves se almacenan encriptadas solo en tu dispositivo. Kairos Trade nunca tiene acceso a tu contraseÃ±a ni a tus fondos directamente."]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{num:"1",title:"Elige tu Exchange",desc:"Selecciona de la lista",icon:ne},{num:"2",title:"Sigue la guÃ­a",desc:"Te mostramos paso a paso",icon:Je},{num:"3",title:"Pega tus claves",desc:"Y listo, conectado",icon:Xe}].map(($,B)=>e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full mx-auto mb-2 flex items-center justify-center text-xs font-bold",style:{background:"rgba(59,130,246,0.1)",color:"var(--gold)",border:"1px solid rgba(59,130,246,0.15)"},children:$.num}),e.jsx("p",{className:"text-xs font-bold mb-0.5",children:$.title}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:$.desc})]},B))}),u.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-bold text-[var(--text-dim)] uppercase tracking-wider",children:"Cuentas Conectadas"}),u.map($=>{const B=pt.find(z=>z.id===$.brokerId),q=F[$.id]||[],Z=j===$.id,I=K($.id);return e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer",onClick:()=>y(Z?null:$.id),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-xl",style:{background:`${(B==null?void 0:B.color)||"#333"}15`,border:`1px solid ${(B==null?void 0:B.color)||"#333"}30`},children:(B==null?void 0:B.logo)||"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:$.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:(B==null?void 0:B.name)||$.brokerId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[$.connected&&e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--gold)]",children:["$",I.toFixed(2)]})]}),$.connected?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--green)] px-2 py-1 rounded-lg",style:{background:"rgba(0,220,130,0.1)"},children:[e.jsx(je,{size:12})," Conectado"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--text-dim)] px-2 py-1 rounded-lg",style:{background:"var(--surface-2)"},children:[e.jsx(rt,{size:12})," Error"]}),e.jsx("button",{onClick:z=>{z.stopPropagation(),_($.id)},className:"text-xs text-[var(--text-dim)] hover:text-[var(--red)] transition-colors px-2 py-1 rounded-lg hover:bg-[var(--red)]/5",children:e.jsx(ke,{size:14})})]})]}),e.jsx(se,{children:Z&&$.connected&&e.jsx(O.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 space-y-3",style:{borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between pt-3",children:[e.jsxs("h4",{className:"text-xs font-bold uppercase tracking-wider text-[var(--text-dim)] flex items-center gap-2",children:[e.jsx(ze,{size:13,className:"text-[var(--gold)]"})," Balances"]}),e.jsxs("button",{onClick:()=>E($),className:"text-[10px] text-[var(--text-dim)] hover:text-[var(--gold)] flex items-center gap-1",children:[e.jsx(Wt,{size:11,className:w[$.id]?"animate-spin":""})," Actualizar"]})]}),q.length>0?e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:q.slice(0,15).map(z=>e.jsxs("div",{className:"rounded-lg p-2",style:{background:"var(--surface-2)"},children:[e.jsx("span",{className:"text-[10px] font-bold text-[var(--gold)]",children:z.asset}),e.jsx("p",{className:"text-xs font-bold mt-0.5",children:parseFloat(z.free).toFixed(z.asset==="BTC"?8:2)})]},z.asset))}):e.jsx("p",{className:"text-xs text-[var(--text-dim)] py-2",children:w[$.id]?"Cargando...":"Sin balances"})]})})})]},$.id)})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-[var(--text-dim)] uppercase tracking-wider mb-3",children:u.length>0?"Conectar Otro Exchange":"Selecciona tu Exchange"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:pt.map($=>{const B=L.includes($.id);return e.jsxs("button",{onClick:()=>!B&&C($),disabled:B,className:"group relative rounded-xl p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-default",style:{background:B?"rgba(0,220,130,0.04)":"linear-gradient(135deg, rgba(17,19,24,0.9), rgba(24,26,32,0.7))",border:`1px solid ${B?"rgba(0,220,130,0.15)":"var(--border)"}`},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{background:`${$.color}15`,border:`1px solid ${$.color}25`},children:$.logo}),B?e.jsx(je,{size:16,className:"text-[var(--green)]"}):e.jsx(we,{size:16,className:"text-[var(--text-dim)] group-hover:text-[var(--gold)] transition-colors"})]}),e.jsx("h3",{className:"text-sm font-bold mb-0.5",children:$.name}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-2 leading-relaxed",children:$.desc}),e.jsx("div",{className:"flex flex-wrap gap-1",children:$.features.map(q=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-white/[0.04] text-[var(--text-dim)] font-medium",children:q},q))}),e.jsxs("p",{className:"text-[9px] text-[var(--text-dim)]/50 mt-2",children:[$.users," usuarios"]})]},$.id)})})]}),e.jsx(se,{children:l&&d&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"},onClick:M,children:e.jsxs(O.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:300},onClick:$=>$.stopPropagation(),className:"w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl",style:{background:"#0E1015",border:"1px solid rgba(30,34,45,0.6)"},children:[e.jsxs("div",{className:"p-5 pb-4 flex items-center justify-between",style:{borderBottom:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-xl",style:{background:`${d.color}15`,border:`1px solid ${d.color}30`},children:d.logo}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",children:["Conectar ",d.name]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(Ue,{size:9,className:"text-[var(--green)]"}),e.jsx("span",{className:"text-[9px] text-[var(--green)] font-semibold",children:"ConexiÃ³n segura con API Keys"})]})]})]}),e.jsx("button",{onClick:M,className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] transition-colors hover:bg-white/5",children:e.jsx(Qe,{size:18})})]}),n===te.GUIDE&&e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center gap-1.5 mb-2",children:d.steps.map(($,B)=>e.jsx("div",{className:"transition-all duration-300",style:{width:B===p?20:6,height:6,borderRadius:3,background:B===p?d.color:B<p?"var(--green)":"rgba(30,34,45,0.6)"}},B))}),e.jsx(se,{mode:"wait",children:e.jsx(O.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:e.jsx("div",{className:"rounded-xl p-4",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold shrink-0",style:{background:`${d.color}15`,color:d.color},children:p+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:d.steps[p].title}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] leading-relaxed",children:d.steps[p].desc})]})]})})},p)}),p===0&&e.jsxs("a",{href:d.apiUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 w-full py-3 rounded-xl text-sm font-bold transition-all hover:brightness-110",style:{background:`${d.color}20`,color:d.color,border:`1px solid ${d.color}30`},children:[e.jsx(Ht,{size:14})," Abrir ",d.name," API Management"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p>0&&e.jsxs("button",{onClick:()=>o($=>$-1),className:"flex items-center gap-1 px-4 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx(Ge,{size:14})," Anterior"]}),e.jsx("div",{className:"flex-1"}),p<d.steps.length-1?e.jsxs("button",{onClick:()=>o($=>$+1),className:"flex items-center gap-1 px-5 py-2.5 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110",style:{background:`linear-gradient(135deg, ${d.color}, ${d.color}CC)`},children:["Siguiente ",e.jsx(we,{size:14})]}):e.jsxs("button",{onClick:()=>c(te.KEYS),className:"flex items-center gap-1 px-5 py-2.5 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110",style:{background:"linear-gradient(135deg, #0ECB81, #0AA06A)"},children:["Ya tengo mis claves ",e.jsx(st,{size:14})]})]}),e.jsx("button",{onClick:()=>c(te.KEYS),className:"w-full text-center text-[11px] text-[var(--text-dim)]/50 hover:text-[var(--text-dim)] transition-colors py-1",children:"Ya sÃ© cÃ³mo hacerlo, ir directo a pegar claves â†’"})]}),n===te.KEYS&&e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"text-center mb-1",children:[e.jsxs("p",{className:"text-sm font-bold",children:["Pega tus API Keys de ",d.name]}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] mt-1",children:"Las claves se encriptan y almacenan solo en tu dispositivo"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:["Nombre de la cuenta ",e.jsx("span",{className:"text-[var(--text-dim)]/40",children:"(opcional)"})]}),e.jsx("input",{type:"text",value:b.label,onChange:$=>m({...b,label:$.target.value}),placeholder:`Mi cuenta ${d.name}`,className:"w-full text-sm rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Xe,{size:10,className:"text-[var(--gold)]"})," API Key ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:"text",value:b.apiKey,onChange:$=>m({...b,apiKey:$.target.value}),placeholder:"Pega tu API Key aquÃ­",className:"w-full text-sm font-mono rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"},autoFocus:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Ue,{size:10,className:"text-[var(--gold)]"})," API Secret ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:g?"text":"password",value:b.apiSecret,onChange:$=>m({...b,apiSecret:$.target.value}),placeholder:"Pega tu API Secret aquÃ­",className:"w-full text-sm font-mono rounded-xl pr-10",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}}),e.jsx("button",{onClick:()=>f(!g),className:"absolute right-3 top-7 text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",children:g?e.jsx(ft,{size:15}):e.jsx(vt,{size:15})})]}),d.needsPassphrase&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(fe,{size:10,className:"text-[var(--gold)]"})," Passphrase ",e.jsx("span",{className:"text-[var(--red)]",children:"*"})]}),e.jsx("input",{type:"password",value:b.passphrase,onChange:$=>m({...b,passphrase:$.target.value}),placeholder:"Pega tu Passphrase aquÃ­",className:"w-full text-sm font-mono rounded-xl",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.5)",padding:"10px 14px"}})]})]}),k&&e.jsxs("div",{className:"rounded-lg px-3 py-2 text-xs text-[var(--red)] flex items-start gap-2",style:{background:"rgba(246,70,93,0.08)",border:"1px solid rgba(246,70,93,0.15)"},children:[e.jsx(rt,{size:14,className:"shrink-0 mt-0.5"})," ",k]}),e.jsxs("div",{className:"rounded-lg px-3 py-2 flex items-start gap-2",style:{background:"rgba(59,130,246,0.04)",border:"1px solid rgba(59,130,246,0.08)"},children:[e.jsx(Je,{size:13,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:["AsegÃºrate de que tu API Key tenga permisos de ",e.jsx("strong",{className:"text-[var(--text)]",children:"lectura"})," y ",e.jsx("strong",{className:"text-[var(--text)]",children:"trading"}),".",e.jsx("strong",{className:"text-[var(--red)]",children:" Nunca actives permisos de retiro."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{c(te.GUIDE),o(0)},className:"flex items-center gap-1 px-4 py-2.5 rounded-xl text-xs font-semibold text-[var(--text-dim)] hover:text-[var(--text)] transition-colors",style:{background:"rgba(24,26,32,0.6)",border:"1px solid rgba(30,34,45,0.4)"},children:[e.jsx(Ge,{size:14})," Ver guÃ­a"]}),e.jsxs("button",{onClick:R,disabled:!b.apiKey||!b.apiSecret,className:"flex-1 py-3 rounded-xl text-sm font-bold text-white transition-all hover:brightness-110 disabled:opacity-40",style:{background:"linear-gradient(135deg, #0ECB81, #0AA06A)"},children:["Conectar ",d.name]})]})]}),n===te.VERIFYING&&e.jsxs("div",{className:"p-8 flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center text-3xl",style:{background:`${d.color}15`},children:d.logo}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 rounded-full bg-[var(--dark)] flex items-center justify-center",children:e.jsx(Gt,{size:16,className:"text-[var(--gold)] animate-spin"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:"Verificando conexiÃ³n..."}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)]",children:["Conectando de forma segura con ",d.name]})]}),e.jsx("div",{className:"w-48 h-1 rounded-full overflow-hidden",style:{background:"rgba(30,34,45,0.5)"},children:e.jsx(O.div,{className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${d.color}, var(--gold))`},initial:{width:"0%"},animate:{width:"90%"},transition:{duration:3,ease:"easeOut"}})})]}),n===te.SUCCESS&&e.jsxs("div",{className:"p-8 flex flex-col items-center gap-4",children:[e.jsx(O.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:12},children:e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:"rgba(14,203,129,0.12)",border:"2px solid rgba(14,203,129,0.3)"},children:e.jsx(je,{size:32,className:"text-[var(--green)]"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold mb-1",children:"Â¡Conectado exitosamente!"}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)]",children:["Tu cuenta de ",d.name," estÃ¡ lista para operar desde Kairos Trade"]})]})]}),e.jsxs("div",{className:"px-5 py-3 flex items-center justify-center gap-2",style:{borderTop:"1px solid rgba(30,34,45,0.3)"},children:[e.jsx(Ue,{size:10,className:"text-[var(--text-dim)]/40"}),e.jsx("span",{className:"text-[9px] text-[var(--text-dim)]/40",children:"Tus claves estÃ¡n encriptadas localmente"})]})]})})})]})}const Us={ema:"La **EMA (Media MÃ³vil Exponencial)** da mÃ¡s peso a los precios recientes. EMA 20 corto plazo, EMA 50 mediano, EMA 200 largo. Cuando EMA rÃ¡pida cruza encima de la lenta = seÃ±al de compra (Golden Cross). Cuando cruza debajo = seÃ±al de venta (Death Cross).",sma:"La **SMA (Media MÃ³vil Simple)** es el promedio aritmÃ©tico de los Ãºltimos N precios. SMA 200 es la referencia institucional de tendencia a largo plazo.",rsi:"El **RSI (Ãndice de Fuerza Relativa)** mide momentum en escala 0-100. RSI > 70 = sobrecompra (posible caÃ­da), RSI < 30 = sobreventa (posible rebote). Divergencias RSI son seÃ±ales muy poderosas.",macd:"El **MACD** mide momentum con: lÃ­nea MACD (EMA12 âˆ’ EMA26), lÃ­nea de seÃ±al (EMA9 del MACD), e histograma. Cruce alcista = compra. Histograma creciente = momentum positivo.",bollinger:"Las **Bandas de Bollinger** forman un canal de volatilidad (SMA Â± 2Ïƒ). Precio toca banda superior = posible sobrecompra. CompresiÃ³n (Squeeze) = explosiÃ³n de volatilidad inminente.",vwap:"El **VWAP** es el precio promedio ponderado por volumen del dÃ­a. Price > VWAP = sesgo alcista. Es la principal referencia institucional intraday.",fibonacci:"Los retrocesos de **Fibonacci** (23.6%, 38.2%, 50%, 61.8%) identifican soporte/resistencia. El 61.8% (golden ratio) es el nivel mÃ¡s respetado.",soporte:"**Soporte** es donde la demanda frena la caÃ­da. **Resistencia** donde la oferta frena la subida. Cuando un soporte se rompe, se convierte en resistencia y viceversa.",tendencia:"**Tendencia alcista** = mÃ¡ximos y mÃ­nimos mÃ¡s altos. **Bajista** = mÃ¡ximos y mÃ­nimos mÃ¡s bajos. **Nunca operes contra la tendencia principal.**",scalping:"**Scalping** busca ganancias rÃ¡pidas (0.1-0.5%) en timeframes 1-5 min. Requiere spread bajo, ejecuciÃ³n rÃ¡pida, y disciplina.",swing:"**Swing trading** captura movimientos de 2-10% en dÃ­as o semanas. Timeframes 4h y 1D. Mejor ratio riesgo/recompensa que scalping.",day_trading:"**Day trading** abre y cierra en el mismo dÃ­a. Timeframes 5m-1h. No hay riesgo overnight.",riesgo:"**Regla del 1-2%**: Nunca arriesgues mÃ¡s del 1-2% por trade. Si tienes $10,000, pÃ©rdida mÃ¡xima por operaciÃ³n = $100-200.",stop_loss:"El **Stop Loss** es obligatorio. MÃ©todos: porcentaje fijo (1-3%), debajo de soporte, ATR multiplier, o swing low/high.",take_profit:"**Take Profit** debe ser al menos 2x tu Stop Loss (ratio 1:2 mÃ­nimo). Usa trailing stops para movimientos grandes.",position:"**Position sizing**: Capital Ã— Riesgo% Ã· (Entrada âˆ’ StopLoss) = Cantidad. Esto controla tu riesgo sin importar el resultado.",doji:"**Doji** = apertura â‰ˆ cierre. Indica indecisiÃ³n. DespuÃ©s de tendencia fuerte = posible reversal.",engulfing:"**Engulfing bullish** = vela roja + verde que la envuelve. SeÃ±al alcista fuerte en soporte.",hammer:"**Hammer** = mecha inferior larga en fondo bajista. Indica rechazo de precios bajos = posible reversal alcista.",doble_techo:"**Doble techo** = dos mÃ¡ximos iguales. Reversal bajista. Confirmar con ruptura del neckline.",hch:"**Cabeza y hombros** = tres mÃ¡ximos, central mÃ¡s alto. El patrÃ³n de reversal mÃ¡s confiable.",liquidez:"**Liquidez** se concentra en mÃ¡ximos/mÃ­nimos iguales, nÃºmeros redondos y zonas de alto volumen. Market Makers buscan liquidez antes de moverse.",order_block:"**Order Block** = zona de Ã³rdenes institucionales. Ãšltima vela antes de movimiento impulsivo. Precio regresa a estas zonas.",funding:"**Funding rate** en futuros indica consenso. Funding muy positivo = exceso de longs, posible caÃ­da. Negativo = exceso de shorts, posible subida.",bitcoin:"**Bitcoin (BTC)** es la referencia. ~70% de altcoins siguen a BTC. Siempre analiza BTC primero.",altseason:"**Altseason** = altcoins superan a Bitcoin (BTC dominance baja). Se identifica cuando ETH/BTC sube.",halving:"**Halving** reduce emisiÃ³n BTC a la mitad cada ~4 aÃ±os. HistÃ³ricamente precede bull runs de 12-18 meses.",apalancamiento:"**Apalancamiento** multiplica tu exposiciÃ³n. 10x = ganas/pierdes 10 veces mÃ¡s rÃ¡pido. Para principiantes: mÃ¡ximo 3x. Profesionales: 5-10x con SL estricto.",volumen:"**Volumen** confirma movimientos. Ruptura con volumen alto = real. Ruptura sin volumen = probable fake out. Volumen creciente en tendencia = saludable."},Vs={ema:["ema","media movil exponencial","exponential moving","golden cross","death cross"],sma:["sma","media movil simple","simple moving"],rsi:["rsi","fuerza relativa","relative strength","sobrecompra","sobreventa","overbought","oversold"],macd:["macd","convergencia divergencia","histograma"],bollinger:["bollinger","bandas de bollinger","bollinger bands","squeeze","bb "],vwap:["vwap","precio ponderado","volume weighted"],fibonacci:["fibonacci","fibo","retroceso","golden ratio","61.8"],soporte:["soporte","resistencia","support","resistance","nivel clave"],tendencia:["tendencia","trend","alcista","bajista","lateral","rango"],scalping:["scalping","scalp","escalpeo"],swing:["swing trading","swing trade"],day_trading:["day trading","intradia","intraday"],riesgo:["riesgo","risk management","money management","gestion de riesgo"],stop_loss:["stop loss","stoploss","parar perdida"],take_profit:["take profit","tomar ganancia","objetivo de ganancia"],position:["position sizing","tamano de posicion","cuanto invertir","cuanto comprar","cuanto arriesgar"],doji:["doji","vela de indecision"],engulfing:["engulfing","envolvente","patron de vela"],hammer:["hammer","martillo","pin bar"],doble_techo:["doble techo","double top","doble suelo","double bottom"],hch:["cabeza y hombros","head and shoulders","hch"],liquidez:["liquidez","liquidity","market maker"],order_block:["order block","bloque de orden","smc","smart money"],funding:["funding","funding rate"],bitcoin:["dominancia","btc dominance"],altseason:["altseason","alt season","altcoins"],halving:["halving","halvening"],apalancamiento:["apalancamiento","leverage","margen","margin"],volumen:["volumen","volume","vol "]};class Ws{constructor(){this.apiKey=null,this.model="gpt-4o-mini",this.conversationHistory=[],this._cache=new Map,this._cacheTTL=3e4}setApiKey(t){this.apiKey=t}async chat(t,s=null){this.conversationHistory.push({role:"user",content:t});try{const a=this._parseIntent(t);return this.apiKey?await this._openAI(t,s,a):await this._engine(t,s,a)}catch(a){console.error("Kairos AI error:",a);const r={text:`âš ï¸ Error: ${a.message}. Intenta de nuevo.`,strategy:null,kairosScript:null,action:null};return this.conversationHistory.push({role:"assistant",content:r.text}),r}}_parseIntent(t){const s=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=t.match(/\b([A-Z]{2,10})(USDT|USD|BTC|ETH|BNB|BUSD)\b/i)||t.match(/\b(BTC|ETH|SOL|BNB|XRP|ADA|DOGE|AVAX|DOT|MATIC|LINK|UNI|ATOM|NEAR|APT|ARB|OP|SUI|TIA|JUP|WIF|PEPE|SHIB|LTC|BCH|EOS|TRX|FIL|AAVE|MKR|COMP|SNX|CRV|INJ|SEI|MANTA|STRK|PYTH)\b/i),r=a?a[0].toUpperCase().endsWith("USDT")?a[0].toUpperCase():a[0].toUpperCase()+"USDT":null;return{changePair:!!s.match(/\b(cambi|muestra|ponme|pon |abre|ver |quiero ver|busca|grafico de)\b/),analyze:!!s.match(/\b(analiz|analisis|como ves|como esta|que ves|revis|resumen|overview)\b/),strategy:!!s.match(/\b(estrategia|estratergia|strategy)\b/),kairosScript:!!(s.match(/\b(script|codigo|code|kairos script)\b/)||s.includes("bot")&&s.match(/\b(crea|genera|haz|dame)\b/)),education:!!s.match(/\b(que es|explica|como funciona|ensen|aprend|como se|que significa|diferencia|que son)\b/),risk:!!s.match(/\b(riesgo|stop loss|position siz|gestion|cuanto debo|cuanto arriesg)\b/),predict:!!s.match(/\b(subir|bajar|precio|target|objetivo|va a|prediccion|pronostico|proyeccion)\b/),greeting:!!s.match(/^(hola|hey|buenas|saludos|hi|hello|que tal|buenos dias|buenas noches|buenas tardes)\b/),help:!!s.match(/\b(ayuda|help|puedes|que sabes|funciones|que haces|capacidades)\b/),detectedPair:r}}async _engine(t,s,a){const r=t.toLowerCase();if(a.greeting)return this._reply(`ðŸ‘‹ Â¡Hola! Soy **Kairos AI**, tu experto de trading.

Puedo:
â€¢ ðŸ“Š **Analizar cualquier par** â€” "Analiza ETHUSDT"
â€¢ ðŸŽ¯ **Generar estrategias** â€” "Dame una estrategia para SOL"
â€¢ ðŸ’» **Crear Kairos Script** â€” "Crea un script para BTC"
â€¢ ðŸ”„ **Cambiar el grÃ¡fico** â€” "MuÃ©strame SOLUSDT"
â€¢ ðŸ“š **EnseÃ±arte trading** â€” "Â¿QuÃ© es el RSI?"

Â¿En quÃ© te ayudo?`);if(a.help)return this._reply(`ðŸ¤– **Kairos AI â€” Capacidades**

ðŸ“Š **AnÃ¡lisis TÃ©cnico** â€” Calculo EMA, SMA, RSI, MACD, BB, VWAP en tiempo real. Detecto cruces, divergencias, y seÃ±ales.

ðŸŽ¯ **Estrategias** â€” Genero estrategias basadas en el estado actual del mercado con SL/TP calculados.

ðŸ’» **Kairos Script** â€” Creo cÃ³digo que puedes copiar â†’ paste en un Script Bot â†’ el bot lo ejecuta automÃ¡ticamente.

ðŸ”„ **Control del GrÃ¡fico** â€” "MuÃ©strame SOL" y cambio el par en pantalla.

ðŸ“š **EducaciÃ³n** â€” PregÃºntame sobre cualquier indicador, patrÃ³n o concepto.

Prueba: **"Analiza BTC y crea un script ganador"**`);if(a.changePair&&a.detectedPair){const i=a.detectedPair;try{const n=await this._analyze(i);return this._reply(`ðŸ”„ **Cambiando a ${i}**

${this._quickSummary(i,n)}

Â¿Quieres un anÃ¡lisis completo o un script para ${i}?`,null,null,{type:"changePair",pair:i})}catch{return this._reply(`ðŸ”„ **Cambiando a ${i}**
Cargando datos...`,null,null,{type:"changePair",pair:i})}}if(a.kairosScript||a.strategy&&(r.includes("script")||r.includes("codigo")||r.includes("bot"))){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._genScript(i,s)}if(a.strategy){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._genStrategy(i,s)}if(a.analyze||a.predict){const i=a.detectedPair||(s==null?void 0:s.symbol)||"BTCUSDT";return await this._fullAnalysis(i,s)}if(a.education||a.risk)return this._educate(t);if(a.detectedPair){const i=a.detectedPair;return await this._fullAnalysis(i,s,{type:"changePair",pair:i})}const l=this._matchKB(r);return l?this._reply(l):this._reply(`ðŸ¤– Entiendo: "${t}"

Puedo:
â€¢ ðŸ“Š **"Analiza BTCUSDT"** â€” AnÃ¡lisis tÃ©cnico
â€¢ ðŸ’» **"Crea un script para ETH"** â€” CÃ³digo para bot
â€¢ ðŸ”„ **"MuÃ©strame SOLUSDT"** â€” Cambiar grÃ¡fico
â€¢ ðŸ“š **"Â¿QuÃ© es el MACD?"** â€” EducaciÃ³n

Â¿QuÃ© necesitas?`)}async _analyze(t,s="1h",a=200){const r=`${t}_${s}`,l=this._cache.get(r);if(l&&Date.now()-l.ts<this._cacheTTL)return l.data;const[i,n]=await Promise.all([Y.getCandles(t,s,a),Y.get24hrTicker(t)]);if(!i||i.length<50)throw new Error(`Datos insuficientes para ${t}`);const c=i.map(X=>X.close),d=i.map(X=>X.high),h=i.map(X=>X.low),p=i.map(X=>X.volume),o=c.length,b=ae(c,20),m=ae(c,50),g=qe(c,200),f=me(c,14),k=Be(c,12,26,9),N=at(c,20,2),F=Pt(i),v=c[o-1],w=b[o-1],S=m[o-1],j=g[o-1],y=f[o-1],E=k.macd[o-1],C=k.signal[o-1],R=k.histogram[o-1],_=N.upper[o-1],K=N.lower[o-1],L=N.middle[o-1],M=F[o-1],$=v>w?"alcista":"bajista",B=v>S?"alcista":"bajista",q=j?v>j?"alcista":"bajista":"indefinida",Z=w>S&&(j?S>j:!0),I=Ae(b,m,o-1),z=Ae(k.macd,k.signal,o-1),x=ws(c,f,14),A=_&&K?(_-K)/L*100:0,T=[];for(let X=Math.max(0,o-20);X<o;X++)N.upper[X]&&N.lower[X]&&N.middle[X]&&T.push((N.upper[X]-N.lower[X])/N.middle[X]*100);const D=T.length>0?T.reduce((X,Ke)=>X+Ke,0)/T.length:A,U=A<D*.75,H=p.slice(-20).reduce((X,Ke)=>X+Ke,0)/20,oe=p[o-1]/H,W=Math.max(...d.slice(-20)),pe=Math.min(...h.slice(-20));let Q=50;$==="alcista"&&(Q+=8),B==="alcista"&&(Q+=8),q==="alcista"&&(Q+=8),Z&&(Q+=6),y>50&&y<70&&(Q+=5),y<30&&(Q+=10),y>70&&(Q-=10),R>0&&(Q+=5),z==="bullish_cross"&&(Q+=10),z==="bearish_cross"&&(Q-=10),I==="bullish_cross"&&(Q+=10),I==="bearish_cross"&&(Q-=10),v>M&&(Q+=5),x==="bullish_divergence"&&(Q+=8),x==="bearish_divergence"&&(Q-=8),oe>1.5&&(Q+=$==="alcista"?5:-5),Q=Math.max(0,Math.min(100,Q));const _e={pair:t,price:v,ticker:n,ind:{ema20:w,ema50:S,sma200:j,rsi:y,macdLine:E,macdSig:C,macdHist:R,bbU:_,bbL:K,bbM:L,bbWidth:A,squeeze:U,vwap:M},trend:{short:$,mid:B,long:q,aligned:Z,emaCross:I},signals:{rsiDiv:x,macdCross:z,volRatio:oe,avgVol:H},levels:{support:pe,resistance:W},score:Q,candles:i};return this._cache.set(r,{data:_e,ts:Date.now()}),_e}async _fullAnalysis(t,s,a=null){var r,l;try{const i=await this._analyze(t),{price:n,ind:c,trend:d,signals:h,levels:p,score:o,ticker:b}=i;let m,g;o>=70?(m="FUERTEMENTE ALCISTA",g="ðŸŸ¢ðŸŸ¢"):o>=55?(m="MODERADAMENTE ALCISTA",g="ðŸŸ¢"):o>=45?(m="NEUTRAL / LATERAL",g="ðŸŸ¡"):o>=30?(m="MODERADAMENTE BAJISTA",g="ðŸ”´"):(m="FUERTEMENTE BAJISTA",g="ðŸ”´ðŸ”´");const f=[];d.emaCross==="bullish_cross"&&f.push("âœ… **Golden Cross** â€” EMA20 cruzÃ³ encima de EMA50"),d.emaCross==="bearish_cross"&&f.push("âŒ **Death Cross** â€” EMA20 cruzÃ³ debajo de EMA50"),h.macdCross==="bullish_cross"&&f.push("âœ… **MACD Bullish Cross**"),h.macdCross==="bearish_cross"&&f.push("âŒ **MACD Bearish Cross**"),c.rsi<30&&f.push("âš¡ **RSI Sobreventa** â€” Posible rebote"),c.rsi>70&&f.push("âš ï¸ **RSI Sobrecompra** â€” Posible correcciÃ³n"),h.rsiDiv==="bullish_divergence"&&f.push("ðŸ”¥ **Divergencia RSI Alcista** â€” Reversal probable"),h.rsiDiv==="bearish_divergence"&&f.push("âš ï¸ **Divergencia RSI Bajista**"),c.squeeze&&f.push("ðŸ’¥ **BB Squeeze** â€” ExplosiÃ³n inminente"),h.volRatio>2&&f.push(`ðŸ“Š **Volumen ${h.volRatio.toFixed(1)}x** sobre promedio`),d.aligned&&f.push("ðŸ“ˆ **EMAs Alineadas** â€” Tendencia fuerte");let k;o>=65?k=`ðŸŸ¢ **BUSCAR COMPRAS** en pullback a EMA20 ($${c.ema20.toFixed(2)}). SL debajo EMA50. TP: $${p.resistance.toFixed(2)}.`:o>=45?k=`ðŸŸ¡ **ESPERAR** â€” Operar rango $${p.support.toFixed(2)} - $${p.resistance.toFixed(2)}.`:k=`ðŸ”´ **PRECAUCIÃ“N** â€” Evitar longs. Short target: $${p.support.toFixed(2)}.`;const N=(b==null?void 0:b.changePercent)||0,F=`ðŸ“Š **ANÃLISIS â€” ${t}**

**Precio:** $${n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}
**24h:** ${N>=0?"+":""}${N.toFixed(2)}% | **Vol:** $${(((b==null?void 0:b.quoteVolume)||0)/1e6).toFixed(1)}M

â”â” **INDICADORES** â”â”
â€¢ EMA 20: $${c.ema20.toFixed(2)} ${n>c.ema20?"âœ…":"âŒ"}
â€¢ EMA 50: $${c.ema50.toFixed(2)} ${n>c.ema50?"âœ…":"âŒ"}
`+(c.sma200?`â€¢ SMA 200: $${c.sma200.toFixed(2)} ${n>c.sma200?"âœ…":"âŒ"}
`:"")+`â€¢ RSI: ${(r=c.rsi)==null?void 0:r.toFixed(1)} ${c.rsi>70?"âš ï¸":c.rsi<30?"âš¡":"ðŸŸ¢"}
â€¢ MACD: ${c.macdHist>0?"ðŸŸ¢":"ðŸ”´"} ${(l=c.macdHist)==null?void 0:l.toFixed(4)}
â€¢ BB: ${c.bbWidth.toFixed(2)}% ${c.squeeze?"ðŸ’¥ SQUEEZE":""}
â€¢ VWAP: $${c.vwap.toFixed(2)} ${n>c.vwap?"âœ…":"âŒ"}

â”â” **TENDENCIA** â”â”
Corto: **${d.short}** | Medio: **${d.mid}** | Largo: **${d.long}**
EMAs alineadas: ${d.aligned?"âœ…":"âŒ"}

â”â” **NIVELES** â”â”
Soporte: $${p.support.toFixed(2)} | Resistencia: $${p.resistance.toFixed(2)}

`+(f.length>0?`â”â” **SEÃ‘ALES** â”â”
${f.join(`
`)}

`:"")+`â”â” **VEREDICTO** â”â”
${g} **${m}** (Score: ${o}/100)

${k}

ðŸ’¡ _Di "crea un script para ${t}" para generar cÃ³digo automÃ¡tico._`;return this._reply(F,null,null,a)}catch(i){if(s)return this._basicAnalysis(s);throw i}}_quickSummary(t,s){var c;const{price:a,ind:r,trend:l,score:i}=s;return`${i>=60?"ðŸŸ¢":i>=40?"ðŸŸ¡":"ðŸ”´"} **${t}** â€” $${a.toLocaleString(void 0,{minimumFractionDigits:2})}
RSI: ${(c=r.rsi)==null?void 0:c.toFixed(1)} | MACD: ${r.macdHist>0?"ðŸŸ¢":"ðŸ”´"} | Tendencia: ${l.short}
Score: **${i}/100**`}_basicAnalysis(t){var a,r;const s=t.changePercent>0?"alcista":"bajista";return this._reply(`ðŸ“ˆ **${t.symbol}** â€” $${(a=t.price)==null?void 0:a.toLocaleString()}
Cambio 24h: ${t.changePercent>0?"+":""}${(r=t.changePercent)==null?void 0:r.toFixed(2)}%
Tendencia: ${s}

âš ï¸ Para anÃ¡lisis completo con indicadores, carga el grÃ¡fico primero.`)}async _genStrategy(t,s){try{const a=await this._analyze(t),{ind:r,trend:l,score:i,levels:n,signals:c,price:d}=a;let h,p,o,b,m,g,f,k;i>=65&&l.aligned?(h="ema_cross",p=`Tendencia Alcista â€” ${t}`,o="EMA 20 > EMA 50 + RSI > 40",b="RSI > 75 o precio < EMA 50",m=Math.max(1.5,(d-n.support)/d*100).toFixed(1),g=Math.max(parseFloat(m)*2,(n.resistance-d)/d*100).toFixed(1),f="1h",k=`EMAs alineadas, Score ${i}/100.`):r.rsi<35&&c.rsiDiv==="bullish_divergence"?(h="ema_cross_rsi",p=`RSI Reversal â€” ${t}`,o="RSI < 30 + Divergencia alcista",b="RSI > 65",m="2",g="5",f="4h",k=`RSI ${r.rsi.toFixed(1)} con divergencia alcista.`):r.squeeze?(h="ema_cross",p=`BB Breakout â€” ${t}`,o="Precio rompe BB superior + volumen alto",b="Precio vuelve dentro de BB",m=(r.bbWidth/2).toFixed(1),g=(r.bbWidth*1.5).toFixed(1),f="1h",k=`BB Squeeze (${r.bbWidth.toFixed(2)}%). ExplosiÃ³n inminente.`):i<=35?(h="rsi",p=`Short Bajista â€” ${t}`,o="Rechazo en EMA 20 + RSI < 50",b="RSI < 25 o soporte",m="2",g="4",f="1h",k=`Score bajista ${i}/100.`):(h="ema_cross_rsi",p=`Range Trading â€” ${t}`,o=`Compra en soporte $${n.support.toFixed(2)} + RSI < 40`,b="RSI > 65 o resistencia",m=((d-n.support)/d*100+.5).toFixed(1),g=((n.resistance-d)/d*100).toFixed(1),f="1h",k=`Lateral, Score ${i}/100.`);const N=(parseFloat(g)/parseFloat(m)).toFixed(1),F={name:p,pair:t,timeframe:f,entry:{condition:o,indicator:h,params:h==="ema_cross"?{fast:20,slow:50}:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30,rsiOverbought:70}},exit:{condition:b,indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:`${m}%`,takeProfit:`${g}%`,riskReward:`1:${N}`},v=`ðŸŽ¯ **ESTRATEGIA â€” ${t}**

**${p}**

ðŸ“Š **RazÃ³n:** ${k}

**Entrada:** ${o}
**Salida:** ${b}
**SL:** ${m}% | **TP:** ${g}% | **R:R:** 1:${N}
**TF:** ${f}

Activa con el botÃ³n de abajo, o di **"crea un script"** para cÃ³digo de bot.`;return this._reply(v,F)}catch{const a={name:`Auto â€” ${t}`,pair:t,timeframe:"1h",entry:{condition:"EMA Cross + RSI",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:35}},exit:{condition:"RSI > 70",indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:"2%",takeProfit:"4%",riskReward:"1:2"};return this._reply(`ðŸŽ¯ **Estrategia para ${t}**

EMA Cross + RSI
SL: 2% | TP: 4% | R:R: 1:2

Activa con el botÃ³n.`,a)}}async _genScript(t,s){try{const a=await this._analyze(t),{ind:r,trend:l,score:i,levels:n}=a;let c,d;if(i>=65&&l.aligned)d=`Tendencia alcista, Score ${i}/100. EMAs alineadas.`,c=`// Tendencia Alcista â€” ${t}
// Generado por Kairos AI | Score: ${i}/100
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMA20: $${r.ema20.toFixed(2)} | EMA50: $${r.ema50.toFixed(2)} | RSI: ${r.rsi.toFixed(1)}

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);
const v = vwap();

// Compra: Pullback en tendencia alcista
if (close > slow && momentum > 40 && momentum < 70) {
  if (crossover(fast, slow) || (close > fast && m.histogram > 0)) {
    buy();
    log("Compra: Tendencia alcista + momentum positivo");
  }
}

// Rebote en VWAP
if (close > v && crossover(close, fast) && momentum < 60) {
  buy();
  log("Compra: Rebote VWAP");
}

// Venta: Sobrecompra o pÃ©rdida de tendencia
if (momentum > 75 || crossunder(fast, slow)) {
  sell();
  log("Venta: " + (momentum > 75 ? "RSI alto" : "Death cross"));
}

config({ stopLoss: ${Math.max(1.5,(r.ema20-n.support)/r.ema20*100).toFixed(1)}, takeProfit: ${Math.max(3,(n.resistance-r.ema20)/r.ema20*100).toFixed(1)} });`;else if(i<=35)d=`Tendencia bajista, Score ${i}/100.`,c=`// Tendencia Bajista â€” ${t}
// Generado por Kairos AI | Score: ${i}/100
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);

// Short: rechazo de EMA en bajista
if (close < slow && momentum < 55) {
  if (crossunder(fast, slow) || (close < fast && m.histogram < 0)) {
    sell();
    log("Short: Rechazo EMA bajista");
  }
}

// Cubrir: RSI sobreventa extrema
if (momentum < 25) {
  buy();
  log("Cubrir: RSI extremo");
}

config({ stopLoss: 2, takeProfit: 4 });`;else if(r.squeeze)d="BB Squeeze detectado. Volatility breakout.",c=`// BB Breakout â€” ${t}
// Generado por Kairos AI | BB Width: ${r.bbWidth.toFixed(2)}%
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const bands = bb(20, 2);
const momentum = rsi(14);
const m = macd(12, 26, 9);

// Breakout alcista
if (close > bands.upper && momentum > 50 && momentum < 80 && m.histogram > 0) {
  buy();
  log("Breakout alcista BB");
}

// Breakout bajista
if (close < bands.lower && momentum < 50 && momentum > 20 && m.histogram < 0) {
  sell();
  log("Breakout bajista BB");
}

// Salida
if (close < bands.middle && change(close, 3) < 0) {
  sell();
  log("Salida: momentum perdido");
}

config({ stopLoss: ${(r.bbWidth/2).toFixed(1)}, takeProfit: ${(r.bbWidth*1.5).toFixed(1)} });`;else if(r.rsi<35||r.rsi>65){const p=r.rsi<35;d=`RSI ${r.rsi.toFixed(1)} â€” ${p?"Sobreventa":"Sobrecompra"}.`,c=`// RSI Reversal â€” ${t}
// Generado por Kairos AI | RSI: ${r.rsi.toFixed(1)}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const momentum = rsi(14);
const fast = ema(20);
const slow = ema(50);
const m = macd(12, 26, 9);

${p?`// Compra en sobreventa
if (momentum < 30 && m.histogram > m.signal) {
  buy();
  log("Compra: RSI sobreventa + MACD girando");
}
if (momentum < 35 && crossover(fast, slow)) {
  buy();
  log("Compra: RSI bajo + Golden Cross");
}
if (momentum > 65) {
  sell();
  log("Venta: tomar ganancia");
}`:`// Venta en sobrecompra
if (momentum > 70 && m.histogram < m.signal) {
  sell();
  log("Venta: RSI sobrecompra");
}
if (momentum < 40) {
  buy();
  log("Cubrir: RSI normalizado");
}`}

config({ stopLoss: 2, takeProfit: 4.5 });`}else d=`Mercado lateral. Rango $${n.support.toFixed(2)} â€” $${n.resistance.toFixed(2)}.`,c=`// Rango â€” ${t}
// Generado por Kairos AI | Score: ${i}/100
// Soporte: $${n.support.toFixed(2)} | Resistencia: $${n.resistance.toFixed(2)}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const bands = bb(20, 2);
const momentum = rsi(14);
const v = vwap();

// Compra en soporte
if (close < bands.lower && momentum < 35) {
  buy();
  log("Compra: soporte BB + RSI bajo");
}
if (crossover(close, v) && momentum < 50) {
  buy();
  log("Compra: rebote VWAP");
}

// Venta en resistencia
if (close > bands.upper && momentum > 65) {
  sell();
  log("Venta: resistencia BB + RSI alto");
}
if (momentum > 75) {
  sell();
  log("Venta: RSI sobrecompra");
}

config({ stopLoss: ${Math.max(1.5,(n.resistance-n.support)/n.support*100/3).toFixed(1)}, takeProfit: ${Math.max(2.5,(n.resistance-n.support)/n.support*100*.6).toFixed(1)} });`;const h=`ðŸ’» **KAIROS SCRIPT â€” ${t}**

ðŸ“Š ${d}

**CÃ³mo usar:**
1. Copia el cÃ³digo
2. Ve a **Bots** â†’ Script Bot
3. Pega â†’ Backtest â†’ Activar

_Basado en anÃ¡lisis real â€” Score: ${i}/100_`;return this._reply(h,null,c)}catch{const a=this._genericScript(t);return this._reply(`ðŸ’» **KAIROS SCRIPT â€” ${t}**

Script multi-indicador profesional.

**CÃ³mo usar:** Copia â†’ Bots â†’ Script Bot â†’ Backtest â†’ Activar`,null,a)}}_genericScript(t){return`// Multi-Indicador â€” ${t}
// Generado por Kairos AI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const fast = ema(20);
const slow = ema(50);
const momentum = rsi(14);
const m = macd(12, 26, 9);
const bands = bb(20, 2);
const v = vwap();

// COMPRA
if (crossover(fast, slow) && momentum > 40 && momentum < 65) {
  buy();
  log("Compra: Golden Cross + RSI ok");
}
if (close < bands.lower && momentum < 30) {
  buy();
  log("Compra: Sobreventa + soporte BB");
}
if (crossover(close, v) && close > fast && momentum > 45) {
  buy();
  log("Compra: VWAP breakout");
}

// VENTA
if (crossunder(fast, slow) && momentum < 55) {
  sell();
  log("Venta: Death Cross");
}
if (momentum > 75 && close > bands.upper) {
  sell();
  log("Venta: Sobrecompra + resistencia BB");
}
if (crossunder(m.line, m.signal) && momentum > 60) {
  sell();
  log("Venta: MACD bearish cross");
}

config({ stopLoss: 2, takeProfit: 4.5 });`}_educate(t){const s=this._matchKB(t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));return s?this._reply(s):this._reply(`ðŸ“š Puedo enseÃ±arte sobre:

**Indicadores:** RSI, EMA, SMA, MACD, Bollinger, VWAP, Fibonacci
**Conceptos:** Scalping, Swing, Day Trading, Tendencia, Soporte/Resistencia
**Riesgo:** Stop Loss, Take Profit, Position Sizing, Apalancamiento
**Patrones:** Doji, Engulfing, Hammer, Doble Techo, Cabeza y Hombros
**Avanzado:** Liquidez, Order Blocks, Smart Money, Volumen

Pregunta lo que quieras.`)}_matchKB(t){const s=[];for(const[a,r]of Object.entries(Vs))r.some(l=>t.includes(l))&&s.push(Us[a]);return s.length===0?null:`ðŸ“š **Kairos Academy**

${s.join(`

`)}

ðŸ’¡ _Â¿Quieres que analice un par usando esto? Di "Analiza" + par._`}async _openAI(t,s,a){let r="";if((a.analyze||a.strategy||a.kairosScript)&&(a.detectedPair||s!=null&&s.symbol))try{const i=await this._analyze(a.detectedPair||s.symbol);r=`

[DATOS REAL-TIME â€” ${i.pair}]
Precio: $${i.price}
EMA20: $${i.ind.ema20.toFixed(2)}
EMA50: $${i.ind.ema50.toFixed(2)}
RSI: ${i.ind.rsi.toFixed(1)}
MACD: ${i.ind.macdHist.toFixed(6)}
BB Width: ${i.ind.bbWidth.toFixed(2)}%
Tendencia: ${i.trend.short}/${i.trend.mid}
Score: ${i.score}/100
Soporte: $${i.levels.support.toFixed(2)}
Resistencia: $${i.levels.resistance.toFixed(2)}`}catch{}const l="Eres Kairos AI, experto de trading de Kairos Trade (Kairos 777 Inc). Responde en espaÃ±ol. SÃ© directo y profesional. Usa datos reales proporcionados. Nunca des consejos financieros personales. Incluye siempre SL/TP en estrategias."+(a.kairosScript?`

Para Kairos Script:
${Rs}`:"");try{const i=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"system",content:l},...this.conversationHistory.slice(-20).map(o=>({role:o.role,content:o.content+(o.role==="user"?r:"")}))],temperature:.7,max_tokens:2e3})});if(!i.ok)throw new Error("API error");const c=(await i.json()).choices[0].message.content;let d=null;a.changePair&&a.detectedPair&&(d={type:"changePair",pair:a.detectedPair});const h=c.match(/```(?:javascript|kairos|js)?\n([\s\S]*?)```/),p=h?h[1].trim():null;return this.conversationHistory.push({role:"assistant",content:c}),{text:c.replace(/```(?:javascript|kairos|js)?\n[\s\S]*?```/g,"").trim(),strategy:this._extractStrategy(c),kairosScript:p,action:d}}catch{return await this._engine(t,s,a)}}_reply(t,s=null,a=null,r=null){return this.conversationHistory.push({role:"assistant",content:t}),{text:t,strategy:s,kairosScript:a,action:r}}_extractStrategy(t){const s=t.match(/```strategy\n([\s\S]*?)```/);if(s)try{return JSON.parse(s[1])}catch{}return null}clearHistory(){this.conversationHistory=[],this._cache.clear()}}const et=new Ws;function ut(){const{aiMessages:u,addAiMessage:t,aiLoading:s,setAiLoading:a,clearAiMessages:r,currentPrice:l,selectedPair:i,priceChange24h:n,setSelectedPair:c,setPage:d}=J(),[h,p]=P.useState(""),[o,b]=P.useState(null),m=P.useRef(null);P.useEffect(()=>{var v;(v=m.current)==null||v.scrollIntoView({behavior:"smooth"})},[u]);const g=P.useCallback(async v=>{var S;const w=v||h.trim();if(!(!w||s)){t({role:"user",content:w,time:new Date().toLocaleTimeString()}),v||p(""),a(!0);try{const j=l?{symbol:i,price:l,changePercent:n,high:l*1.02,low:l*.98,volume:0,quoteVolume:0}:null,y=await et.chat(w,j);((S=y.action)==null?void 0:S.type)==="changePair"&&c(y.action.pair),t({role:"assistant",content:y.text,strategy:y.strategy,kairosScript:y.kairosScript,action:y.action,time:new Date().toLocaleTimeString()})}catch(j){t({role:"assistant",content:`âŒ Error: ${j.message}`,time:new Date().toLocaleTimeString()})}a(!1)}},[h,s,l,i,n]),f=(v,w)=>{navigator.clipboard.writeText(v),b(w),setTimeout(()=>b(null),2e3)},k=[{label:`Analiza ${de(i)}`,icon:ue,prompt:`Analiza ${i}`},{label:"Crea un Script Bot",icon:it,prompt:`Crea un kairos script ganador para ${i}`},{label:"Estrategia ganadora",icon:Fe,prompt:`Dame una estrategia para ${de(i)} segÃºn el mercado`},{label:"Â¿QuÃ© es el RSI?",icon:jt,prompt:"Â¿QuÃ© es el RSI y cÃ³mo se usa?"},{label:"MuÃ©strame SOLUSDT",icon:nt,prompt:"MuÃ©strame SOLUSDT"},{label:"Ayuda",icon:Le,prompt:"Â¿QuÃ© puedes hacer?"}],N=v=>v.split(`
`).map((w,S)=>{const y=w.split(/(\*\*.*?\*\*)/g).map((E,C)=>E.startsWith("**")&&E.endsWith("**")?e.jsx("strong",{children:E.slice(2,-2)},C):E.startsWith("_")&&E.endsWith("_")?e.jsx("em",{className:"text-[var(--text-dim)]",children:E.slice(1,-1)},C):E);return w.startsWith("â”â”")||w.startsWith("â”€â”€")?e.jsx("div",{className:"border-t border-[var(--border)] my-1.5 pt-1",children:y},S):w.startsWith("â€¢")||w.startsWith("- ")?e.jsx("p",{className:"ml-2 my-0.5",children:y},S):w===""?e.jsx("div",{className:"h-1"},S):e.jsx("p",{className:"my-0.5",children:y},S)}),F=(v,w)=>{var j;const S=v.role==="user";return e.jsx(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${S?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[90%] rounded-2xl p-3 ${S?"bg-[var(--gold)] text-white rounded-br-md":"bg-[var(--dark-3)] text-[var(--text)] rounded-bl-md"}`,children:[!S&&e.jsxs("div",{className:"flex items-center gap-1 mb-1.5",children:[e.jsx($e,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsx("div",{className:"text-[13px] whitespace-pre-wrap leading-relaxed",children:N(v.content)}),((j=v.action)==null?void 0:j.type)==="changePair"&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-[var(--gold)]/10 border border-[var(--gold)]/20 rounded-lg",children:[e.jsx(nt,{size:12,className:"text-[var(--gold)]"}),e.jsxs("span",{className:"text-xs text-[var(--gold)] font-semibold",children:["GrÃ¡fico: ",v.action.pair]})]}),e.jsx("button",{onClick:()=>{c(v.action.pair),d("chart")},className:"px-2 py-1 text-[11px] bg-[var(--dark-4)] text-[var(--text-dim)] hover:text-[var(--gold)] rounded-lg transition-colors",children:"Ver grÃ¡fico â†’"})]}),v.strategy&&e.jsxs("div",{className:"mt-2 p-2.5 bg-[var(--dark-4)] rounded-xl border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ne,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Estrategia"})]}),e.jsx("p",{className:"text-xs mb-1",children:v.strategy.name||"Auto Strategy"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--text-dim)]",children:[e.jsxs("span",{children:["SL: ",v.strategy.stopLoss]}),e.jsxs("span",{children:["TP: ",v.strategy.takeProfit]}),e.jsxs("span",{children:["R:R: ",v.strategy.riskReward]})]}),e.jsx("button",{onClick:()=>{J.getState().addStrategy(v.strategy),t({role:"assistant",content:"âœ… Estrategia guardada. ActÃ­vala desde **Bots** â†’ crear bot con esta estrategia.",time:new Date().toLocaleTimeString()})},className:"mt-1.5 px-3 py-1 bg-[var(--gold)] text-white text-xs font-bold rounded-lg hover:bg-[var(--gold-light)] transition-colors",children:"Guardar Estrategia"})]}),v.kairosScript&&e.jsxs("div",{className:"mt-2 rounded-xl overflow-hidden border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-[var(--gold)]/10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(it,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[11px] font-bold text-[var(--gold)]",children:"Kairos Script"})]}),e.jsx("button",{onClick:()=>f(v.kairosScript,w),className:"flex items-center gap-1 px-2 py-0.5 text-[10px] bg-[var(--dark)] rounded-md text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:o===w?e.jsxs(e.Fragment,{children:[e.jsx(Qt,{size:10})," Copiado"]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{size:10})," Copiar"]})})]}),e.jsx("pre",{className:"p-3 bg-[#0B0E11] text-[11px] leading-relaxed overflow-x-auto max-h-64 overflow-y-auto",children:e.jsx("code",{className:"text-[var(--text-secondary)]",children:v.kairosScript})}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-4)]",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(v.kairosScript),b(w),setTimeout(()=>b(null),2e3),d("bots")},className:"flex items-center gap-1 px-3 py-1 bg-[var(--gold)] text-white text-[11px] font-bold rounded-lg hover:bg-[var(--gold-light)] transition-colors",children:[e.jsx(ne,{size:11})," Copiar e ir a Bots"]}),e.jsx("button",{onClick:()=>d("strategies"),className:"px-2 py-1 text-[11px] text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:"Ver Scripts â†’"})]})]}),e.jsx("p",{className:`text-[10px] mt-1.5 ${S?"text-white/60":"text-[var(--text-dim)]"}`,children:v.time})]})},w)};return e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)]/20 flex items-center justify-center",children:e.jsx($e,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold",children:"Kairos AI"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Experto de trading â€¢ AnÃ¡lisis en tiempo real"})]})]}),e.jsx("button",{onClick:()=>{r(),et.clearHistory()},className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(ke,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[u.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx($e,{size:48,className:"text-[var(--gold)] mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-1",children:"Kairos AI"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Experto en trading. Analizo el mercado, genero estrategias y creo cÃ³digo para bots automÃ¡ticos."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-sm",children:k.map((v,w)=>{const S=v.icon;return e.jsxs("button",{onClick:()=>g(v.prompt),className:"flex items-center gap-2 p-2.5 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl text-[12px] hover:border-[var(--gold)]/30 transition-colors text-left",children:[e.jsx(S,{size:14,className:"text-[var(--gold)] shrink-0"}),e.jsx("span",{className:"truncate",children:v.label})]},w)})})]}),u.map(F),s&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-2xl rounded-bl-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx($e,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-[10px] text-[var(--text-dim)]",children:"Analizando mercado..."})]})]})}),e.jsx("div",{ref:m})]}),e.jsx("div",{className:"p-3 border-t border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:h,onChange:v=>p(v.target.value),onKeyDown:v=>v.key==="Enter"&&!v.shiftKey&&g(),placeholder:"Analiza BTC, crea un script, Â¿quÃ© es RSI?...",className:"flex-1 text-sm"}),e.jsx("button",{onClick:()=>g(),disabled:!h.trim()||s,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:e.jsx(Yt,{size:16})})]})})]})}const Hs=[{name:"EMA Cross Classic",description:"Cruces de EMA rÃ¡pida/lenta â€” Tendencia",entry:{condition:"EMA 20 cruza por encima de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},exit:{condition:"EMA 20 cruza por debajo de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},stopLoss:"2",takeProfit:"4"},{name:"RSI Reversal",description:"Compra en sobreventa, vende en sobrecompra",entry:{condition:"RSI < 30 (sobreventa)",indicator:"rsi",params:{period:14,oversold:30}},exit:{condition:"RSI > 70 (sobrecompra)",indicator:"rsi",params:{period:14,overbought:70}},stopLoss:"1.5",takeProfit:"3"},{name:"MACD Momentum",description:"Cruce de lÃ­nea MACD y seÃ±al",entry:{condition:"MACD cruza por encima de seÃ±al",indicator:"macd_cross",params:{fast:12,slow:26,signal:9}},exit:{condition:"MACD cruza por debajo de seÃ±al",indicator:"macd_cross",params:{}},stopLoss:"2",takeProfit:"4"},{name:"EMA + RSI Combo",description:"MÃ¡s preciso: cruces de EMA confirmados con RSI",entry:{condition:"EMA 20 > EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"}];function Gs(){const{strategies:u,addStrategy:t,removeStrategy:s,setPage:a}=J(),[r,l]=P.useState(!1),[i,n]=P.useState(null),[c,d]=P.useState("custom"),h=u.filter(m=>m.type==="custom_script"),p=u.filter(m=>m.type!=="custom_script"),o=m=>{t({...m,pair:"BTCUSDT",timeframe:"1h"})},b=m=>{n(m),l(!0)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Estrategias de Trading"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Crea estrategias con cÃ³digo o usa plantillas predefinidas"})]}),e.jsxs("button",{onClick:()=>{n(null),l(!0)},className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-sm",children:[e.jsx(re,{size:16})," Crear con CÃ³digo"]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>d("custom"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${c==="custom"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(re,{size:14})," Custom Scripts (",h.length,")"]}),e.jsxs("button",{onClick:()=>d("preset"),className:`flex items-center gap-1.5 px-4 py-1.5 text-sm rounded-md transition-colors ${c==="preset"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:[e.jsx(ne,{size:14})," Predefinidas (",p.length,")"]})]}),c==="custom"&&e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl p-6 text-center",style:{background:"linear-gradient(135deg, rgba(168,85,247,0.08) 0%, rgba(59,130,246,0.08) 100%)",border:"1px solid rgba(168,85,247,0.15)"},children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-3",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(re,{size:24,className:"text-[#A855F7]"})}),e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Kairos Script"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-4 max-w-md mx-auto",children:"Escribe tu propia estrategia con cÃ³digo simple, o pÃ­dele a ChatGPT que la genere por ti. MÃ¡s fÃ¡cil que Pine Script, mÃ¡s potente que MQL."}),e.jsx("div",{className:"flex gap-3 justify-center flex-wrap",children:e.jsxs("button",{onClick:()=>{n(null),l(!0)},className:"flex items-center gap-2 px-5 py-2.5 btn-gold rounded-xl text-sm font-bold",children:[e.jsx(re,{size:14})," Crear Estrategia"]})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[{step:"1",title:"Pide a ChatGPT",desc:"Dile quÃ© estrategia quieres con nuestro prompt optimizado",color:"#A855F7"},{step:"2",title:"Pega el CÃ³digo",desc:"Copia el cÃ³digo que te generÃ³ y pÃ©galo en el editor",color:"#3B82F6"},{step:"3",title:"Activa el Bot",desc:"Testea con backtest y asÃ­gnala a un Script Bot",color:"#00DC82"}].map(({step:m,title:g,desc:f,color:k})=>e.jsxs("div",{className:"rounded-xl p-4 flex gap-3",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shrink-0 text-sm font-black",style:{background:`${k}15`,color:k,border:`1px solid ${k}25`},children:m}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold mb-0.5",children:g}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] leading-relaxed",children:f})]})]},m))}),h.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Mis Scripts (",h.length,")"]}),h.map(m=>{var g;return e.jsxs(O.div,{layout:!0,className:"rounded-xl p-4 flex items-center justify-between",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)"},children:e.jsx(re,{size:18,className:"text-[#A855F7]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:m.name}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:[((g=m.code)==null?void 0:g.split(`
`).filter(f=>f.trim()&&!f.trim().startsWith("//")).length)||0," lÃ­neas de lÃ³gica"," â€¢ ","Creada: ",new Date(m.createdAt).toLocaleDateString("es")]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>b(m),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(kt,{size:12})," Editar"]}),e.jsxs("button",{onClick:()=>a("bots"),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/10 text-[var(--green)] rounded-lg text-xs font-bold border border-[var(--green)]/20",children:[e.jsx(he,{size:12})," Usar en Bot"]}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(ke,{size:14})})]})]},m.id)})]}):e.jsxs("div",{className:"rounded-xl p-8 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(re,{size:32,className:"text-[var(--text-dim)]/20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No tienes scripts custom aÃºn"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primera estrategia personalizada"})]})]}),c==="preset"&&e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Hs.map((m,g)=>e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:g*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{size:16,className:"text-[var(--gold)]"}),e.jsx("h3",{className:"text-sm font-bold",children:m.name})]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:m.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--green)]",children:"â–²"})," ",m.entry.condition]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--red)]",children:"â–¼"})," ",m.exit.condition]}),e.jsxs("p",{className:"text-[var(--text-dim)]",children:["SL: ",m.stopLoss,"% | TP: ",m.takeProfit,"%"]})]}),e.jsx("button",{onClick:()=>o(m),className:"w-full py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:"Usar Plantilla"})]},m.name))}),p.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Guardadas (",p.length,")"]}),p.map(m=>{var g;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:m.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[(g=m.entry)==null?void 0:g.condition," | SL: ",m.stopLoss,"% | TP: ",m.takeProfit,"%"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>a("bots"),className:"px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold",children:[e.jsx(he,{size:12,className:"inline mr-1"})," Usar en Bot"]}),e.jsx("button",{onClick:()=>s(m.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)]",children:e.jsx(ke,{size:14})})]})]},m.id)})]})]}),e.jsx(se,{children:r&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{l(!1),n(null)},children:e.jsx(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:m=>m.stopPropagation(),children:e.jsx(Tt,{initialCode:i==null?void 0:i.code,initialName:i==null?void 0:i.name,editMode:!!i,onClose:()=>{l(!1),n(null)},onSave:m=>{t(m),l(!1),n(null)}})})})})]})}function Ys(){const{tradeHistory:u,positions:t}=J(),[s,a]=P.useState("open"),r=u.reduce((n,c)=>n+(c.pnl||0),0),l=u.filter(n=>(n.pnl||0)>0).length,i=u.length>0?l/u.length*100:0;return e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Historial de Trading"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[u.length," trades cerrados â€¢ ",t.length," posiciones abiertas"]})]}),e.jsxs("button",{onClick:()=>{const n=[["Par","Lado","Entrada","Salida","Cantidad","P&L","Fecha Apertura","Fecha Cierre"]];u.forEach(o=>{var b,m;n.push([o.symbol,o.side,(b=o.entryPrice)==null?void 0:b.toFixed(2),((m=o.exitPrice)==null?void 0:m.toFixed(2))||"",o.quantity,(o.pnl||0).toFixed(2),o.openedAt||"",o.closedAt||""])});const c=n.map(o=>o.join(",")).join(`
`),d=new Blob([c],{type:"text/csv"}),h=URL.createObjectURL(d),p=document.createElement("a");p.href=h,p.download=`kairos-trades-${new Date().toISOString().split("T")[0]}.csv`,p.click(),URL.revokeObjectURL(h)},className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--gold)] hover:border-[var(--gold)]/30 transition-all border border-[var(--border)]",children:[e.jsx(Jt,{size:14})," Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-bold",children:u.length})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L Total"}),e.jsxs("p",{className:`text-lg font-bold ${r>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[r>=0?"+":"","$",r.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[i.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Posiciones Abiertas"}),e.jsx("p",{className:"text-lg font-bold text-[var(--blue)]",children:t.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>a("open"),className:`px-4 py-1.5 text-sm rounded-md ${s==="open"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Abiertas (",t.length,")"]}),e.jsxs("button",{onClick:()=>a("closed"),className:`px-4 py-1.5 text-sm rounded-md ${s==="closed"?"bg-[var(--gold)] text-white font-bold":"text-[var(--text-dim)]"}`,children:["Cerradas (",u.length,")"]})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm min-w-[600px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-[var(--text-dim)] text-xs",children:[e.jsx("th",{className:"text-left p-3",children:"Par"}),e.jsx("th",{className:"text-left p-3",children:"Lado"}),e.jsx("th",{className:"text-right p-3",children:"Entrada"}),e.jsx("th",{className:"text-right p-3",children:"Cantidad"}),e.jsx("th",{className:"text-right p-3",children:"P&L"}),e.jsx("th",{className:"text-right p-3",children:"Fecha"})]})}),e.jsx("tbody",{children:(s==="open"?t:u).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-[var(--text-dim)]",children:s==="open"?"Sin posiciones abiertas":"Sin trades cerrados"})}):(s==="open"?t:u).map((n,c)=>{var d,h;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--dark-3)] transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:n.symbol}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold
                    ${n.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:(d=n.side)==null?void 0:d.toUpperCase()})}),e.jsxs("td",{className:"p-3 text-right font-mono",children:["$",(h=n.entryPrice)==null?void 0:h.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right font-mono",children:n.quantity}),e.jsxs("td",{className:`p-3 text-right font-mono font-bold ${(n.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(n.pnl||0)>=0?"+":"","$",(n.pnl||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-right text-xs text-[var(--text-dim)]",children:new Date(n.openedAt||n.closedAt).toLocaleDateString()})]},n.id||c)})})]})})]})}const ht="kairos_trade_simulator";class Qs{constructor(){this.state=this._load()}_load(){try{const t=JSON.parse(localStorage.getItem(ht));if(t)return t}catch{}return this._defaultState()}_defaultState(){return{balance:1e4,initialBalance:1e4,positions:[],closedTrades:[],orders:[],equity:1e4,stats:{totalTrades:0,wins:0,losses:0,totalPnl:0,bestTrade:0,worstTrade:0,avgWin:0,avgLoss:0,maxDrawdown:0,sharpeRatio:0},equityHistory:[{time:Date.now(),value:1e4}],createdAt:new Date().toISOString()}}_save(){localStorage.setItem(ht,JSON.stringify(this.state))}reset(t=1e4){return this.state=this._defaultState(),this.state.balance=t,this.state.initialBalance=t,this.state.equity=t,this.state.equityHistory=[{time:Date.now(),value:t}],this._save(),this.state}async openPosition(t,s,a,r={}){const l=await Y.getPrice(t),i=l*a;if(i>this.state.balance)throw new Error(`Fondos insuficientes. Necesitas $${i.toFixed(2)}, tienes $${this.state.balance.toFixed(2)}`);const n={id:Date.now().toString(36)+Math.random().toString(36).slice(2,6),symbol:t,side:s,quantity:a,entryPrice:l,currentPrice:l,cost:i,pnl:0,pnlPercent:0,stopLoss:r.stopLoss||null,takeProfit:r.takeProfit||null,leverage:r.leverage||1,openedAt:new Date().toISOString()};return this.state.balance-=i,this.state.positions.push(n),this._save(),{success:!0,position:n,message:`${s.toUpperCase()} ${a} ${t} @ $${l.toFixed(2)}`}}async closePosition(t){const s=this.state.positions.findIndex(c=>c.id===t);if(s===-1)throw new Error("PosiciÃ³n no encontrada");const a=this.state.positions[s],r=await Y.getPrice(a.symbol),l=a.side==="buy"?(r-a.entryPrice)*a.quantity*a.leverage:(a.entryPrice-r)*a.quantity*a.leverage,i=l/a.cost*100,n={...a,exitPrice:r,pnl:l,pnlPercent:i,closedAt:new Date().toISOString(),duration:Date.now()-new Date(a.openedAt).getTime()};return this.state.balance+=a.cost+l,this.state.positions.splice(s,1),this.state.closedTrades.push(n),this._updateStats(l),this._save(),{success:!0,trade:n,message:`Cerrada: ${l>=0?"+":""}$${l.toFixed(2)} (${i.toFixed(1)}%)`}}async placeLimitOrder(t,s,a,r,l={}){const i=await Y.getPrice(t),n={id:Date.now().toString(36),symbol:t,side:s,quantity:a,targetPrice:r,currentPrice:i,type:"limit",stopLoss:l.stopLoss||null,takeProfit:l.takeProfit||null,status:"pending",createdAt:new Date().toISOString()};return this.state.orders.push(n),this._save(),{success:!0,order:n}}cancelOrder(t){return this.state.orders=this.state.orders.filter(s=>s.id!==t),this._save(),{success:!0}}async updatePositions(){let t=this.state.balance;for(const s of this.state.positions)try{const a=await Y.getPrice(s.symbol);if(s.currentPrice=a,s.pnl=s.side==="buy"?(a-s.entryPrice)*s.quantity*(s.leverage||1):(s.entryPrice-a)*s.quantity*(s.leverage||1),s.pnlPercent=s.pnl/s.cost*100,t+=s.cost+s.pnl,s.stopLoss&&(s.side==="buy"?a<=s.stopLoss:a>=s.stopLoss)){await this.closePosition(s.id);continue}if(s.takeProfit&&(s.side==="buy"?a>=s.takeProfit:a<=s.takeProfit)){await this.closePosition(s.id);continue}}catch{}for(const s of this.state.orders.filter(a=>a.status==="pending"))try{const a=await Y.getPrice(s.symbol);(s.side==="buy"?a<=s.targetPrice:a>=s.targetPrice)&&(s.status="filled",await this.openPosition(s.symbol,s.side,s.quantity,{stopLoss:s.stopLoss,takeProfit:s.takeProfit}))}catch{}return this.state.orders=this.state.orders.filter(s=>s.status==="pending"),this.state.equity=t,this.state.equityHistory.push({time:Date.now(),value:t}),this.state.equityHistory.length>500&&(this.state.equityHistory=this.state.equityHistory.slice(-500)),this._save(),this.state}_updateStats(t){const s=this.state.stats;s.totalTrades++,s.totalPnl+=t,t>0?(s.wins++,s.bestTrade=Math.max(s.bestTrade,t)):(s.losses++,s.worstTrade=Math.min(s.worstTrade,t)),s.avgWin=s.wins>0?s.totalPnl/s.wins:0,s.avgLoss=s.losses>0?(s.totalPnl-s.avgWin*s.wins)/s.losses:0;const a=Math.max(...this.state.equityHistory.map(i=>i.value));s.maxDrawdown=(a-this.state.equity)/a*100,s.winRate=s.totalTrades>0?s.wins/s.totalTrades*100:0;const r=this.state.closedTrades.filter(i=>i.pnl>0).reduce((i,n)=>i+n.pnl,0),l=Math.abs(this.state.closedTrades.filter(i=>i.pnl<0).reduce((i,n)=>i+n.pnl,0));s.profitFactor=l>0?r/l:r>0?1/0:0}getState(){return this.state}getPerformance(){const t=this.state,s=(t.equity-t.initialBalance)/t.initialBalance*100;return{balance:t.balance,equity:t.equity,initialBalance:t.initialBalance,returnPct:s,openPositions:t.positions.length,pendingOrders:t.orders.length,...t.stats}}}const le=new Qs;function Js({data:u,height:t=140}){const s=P.useRef(null);return P.useEffect(()=>{const a=s.current;if(!a||!u||u.length<2)return;const r=a.getContext("2d"),l=window.devicePixelRatio||1,i=a.clientWidth,n=a.clientHeight;a.width=i*l,a.height=n*l,r.scale(l,l),r.clearRect(0,0,i,n);const c=u.map(E=>E.value),d=Math.min(...c)*.998,h=Math.max(...c)*1.002,p=h-d||1,o={top:8,bottom:20,left:0,right:0},b=i-o.left-o.right,m=n-o.top-o.bottom,g=E=>o.left+E/(u.length-1)*b,f=E=>o.top+m-(E-d)/p*m,k=c[0],N=c[c.length-1],F=N>=k,v=F?"#00DC82":"#FF3B30";r.beginPath(),r.moveTo(g(0),f(c[0]));for(let E=1;E<c.length;E++)r.lineTo(g(E),f(c[E]));r.lineTo(g(c.length-1),n-o.bottom),r.lineTo(g(0),n-o.bottom),r.closePath();const w=r.createLinearGradient(0,0,0,n);w.addColorStop(0,F?"rgba(0,220,130,0.2)":"rgba(255,59,48,0.2)"),w.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=w,r.fill(),r.beginPath(),r.moveTo(g(0),f(c[0]));for(let E=1;E<c.length;E++)r.lineTo(g(E),f(c[E]));r.strokeStyle=v,r.lineWidth=2,r.lineJoin="round",r.stroke(),r.beginPath(),r.setLineDash([3,3]);const S=f(k);r.moveTo(0,S),r.lineTo(i,S),r.strokeStyle="#3B82F640",r.lineWidth=1,r.stroke(),r.setLineDash([]),r.fillStyle="#666",r.font="9px Inter, sans-serif",r.textAlign="left",r.fillText(`$${d.toFixed(0)}`,4,n-o.bottom+12),r.textAlign="right",r.fillText(`$${h.toFixed(0)}`,i-4,n-o.bottom+12);const j=g(c.length-1),y=f(N);r.beginPath(),r.arc(j,y,3,0,Math.PI*2),r.fillStyle=v,r.fill(),r.beginPath(),r.arc(j,y,6,0,Math.PI*2),r.strokeStyle=v,r.lineWidth=1,r.globalAlpha=.4,r.stroke(),r.globalAlpha=1},[u,t]),!u||u.length<2?e.jsx("div",{className:"flex items-center justify-center text-xs text-[var(--text-dim)]",style:{height:t},children:"Ejecuta trades para ver la curva de equity"}):e.jsx("canvas",{ref:s,style:{width:"100%",height:t}})}function Xs(){var N,F,v,w;const{selectedPair:u,currentPrice:t,setPage:s}=J(),[a,r]=P.useState(le.getState()),[l,i]=P.useState(le.getPerformance()),[n,c]=P.useState({quantity:"",stopLoss:"",takeProfit:"",side:"buy"}),[d,h]=P.useState(!1),[p,o]=P.useState(null);P.useEffect(()=>{const S=setInterval(async()=>{const j=await le.updatePositions();r({...j}),i(le.getPerformance())},1e4);return()=>clearInterval(S)},[]);const b=P.useCallback(async()=>{const S=await le.updatePositions();r({...S}),i(le.getPerformance())},[]),m=async()=>{if(!(!n.quantity||!t)){h(!0);try{const S=await le.openPosition(u,n.side,parseFloat(n.quantity),{stopLoss:n.stopLoss?parseFloat(n.stopLoss):null,takeProfit:n.takeProfit?parseFloat(n.takeProfit):null});o({type:"success",text:S.message}),c({...n,quantity:"",stopLoss:"",takeProfit:""}),await b()}catch(S){o({type:"error",text:S.message})}h(!1),setTimeout(()=>o(null),3e3)}},g=async S=>{try{const j=await le.closePosition(S);o({type:j.trade.pnl>=0?"success":"error",text:j.message}),await b()}catch(j){o({type:"error",text:j.message})}setTimeout(()=>o(null),3e3)},f=()=>{le.reset(1e4),r(le.getState()),i(le.getPerformance()),o({type:"success",text:"Simulador reiniciado con $10,000"}),setTimeout(()=>o(null),2e3)},k=l.returnPct||0;return e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(he,{size:18,className:"text-[var(--gold)] shrink-0"}),"Paper Trading"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Practica con datos reales, sin arriesgar dinero"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:"Actualizar"}),e.jsxs("button",{onClick:f,className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--red)]/20 text-[var(--red)] rounded-lg text-xs font-bold hover:bg-[var(--red)]/30 transition-colors",children:[e.jsx(wt,{size:12})," Reiniciar"]})]})]}),e.jsx(se,{children:p&&e.jsx(O.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-3 rounded-xl text-sm font-bold text-center ${p.type==="success"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:p.text})}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2",children:[{label:"Balance",value:`$${(N=l.balance)==null?void 0:N.toFixed(2)}`,icon:Se,color:"var(--gold)"},{label:"Equity",value:`$${(F=l.equity)==null?void 0:F.toFixed(2)}`,icon:ue,color:"var(--blue)"},{label:"Retorno",value:`${k>=0?"+":""}${k.toFixed(2)}%`,icon:k>=0?ge:Ee,color:k>=0?"var(--green)":"var(--red)"},{label:"Win Rate",value:`${(l.winRate||0).toFixed(0)}%`,icon:Xt,color:"var(--gold)"},{label:"Trades",value:l.totalTrades||0,icon:Fe,color:"var(--text)"}].map((S,j)=>{const y=S.icon;return e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:j*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx(y,{size:16,style:{color:S.color},className:"mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold font-mono",style:{color:S.color},children:S.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:S.label})]},S.label)})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[{label:"P&L Total",value:`${l.totalPnl>=0?"+":""}$${(l.totalPnl||0).toFixed(2)}`,color:(l.totalPnl||0)>=0?"var(--green)":"var(--red)"},{label:"Mejor Trade",value:`+$${(l.bestTrade||0).toFixed(2)}`,color:"var(--green)"},{label:"Peor Trade",value:`$${(l.worstTrade||0).toFixed(2)}`,color:"var(--red)"},{label:"Max Drawdown",value:`${(l.maxDrawdown||0).toFixed(1)}%`,color:"var(--red)"}].map(S=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:S.label}),e.jsx("p",{className:"text-sm font-bold font-mono",style:{color:S.color},children:S.value})]},S.label))}),e.jsxs("div",{className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[e.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[e.jsx(ge,{size:14,className:"text-[var(--gold)]"})," Curva de Equity"]}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)]",children:[((v=a.equityHistory)==null?void 0:v.length)||0," puntos"]})]}),e.jsx("div",{className:"p-2",children:e.jsx(Js,{data:a.equityHistory,height:160})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Abrir PosiciÃ³n (Demo)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--gold)]",children:de(u)}),e.jsxs("span",{className:"text-sm font-mono",children:["$",(t==null?void 0:t.toLocaleString(void 0,{maximumFractionDigits:2}))||"---"]}),e.jsx("button",{onClick:()=>s("chart"),className:"text-xs text-[var(--gold)] hover:underline ml-auto",children:"Ver grÃ¡fico â†’"})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>c({...n,side:"buy"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="buy"?"bg-[var(--green)] text-white":"text-[var(--text-dim)]"}`,children:"COMPRAR"}),e.jsx("button",{onClick:()=>c({...n,side:"sell"}),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${n.side==="sell"?"bg-[var(--red)] text-white":"text-[var(--text-dim)]"}`,children:"VENDER"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Cantidad"}),e.jsx("input",{type:"number",value:n.quantity,onChange:S=>c({...n,quantity:S.target.value}),placeholder:"Ej: 0.01",className:"w-full text-sm"}),n.quantity&&t&&e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)] mt-1",children:["Costo: $",(parseFloat(n.quantity)*t).toFixed(2)," de $",(w=l.balance)==null?void 0:w.toFixed(2)," disponible"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(fe,{size:10})," Stop Loss"]}),e.jsx("input",{type:"number",value:n.stopLoss,onChange:S=>c({...n,stopLoss:S.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(Fe,{size:10})," Take Profit"]}),e.jsx("input",{type:"number",value:n.takeProfit,onChange:S=>c({...n,takeProfit:S.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsx("button",{onClick:m,disabled:!n.quantity||!t||d,className:`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50 ${n.side==="buy"?"bg-[var(--green)] text-white":"bg-[var(--red)] text-white"}`,children:d?"Ejecutando...":`${n.side==="buy"?"Comprar":"Vender"} ${Pe(u)} (Demo)`})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold mb-3",children:["Posiciones Abiertas (",a.positions.length,")"]}),a.positions.length===0?e.jsx("p",{className:"text-sm text-[var(--text-dim)] text-center py-8",children:"Sin posiciones abiertas"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.positions.map(S=>{var j,y,E,C;return e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded ${S.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:S.side.toUpperCase()}),e.jsx("span",{className:"text-sm font-bold",children:S.symbol})]}),e.jsx("button",{onClick:()=>g(S.id),className:"px-2 py-0.5 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cerrar"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Entrada"}),e.jsxs("p",{className:"font-mono",children:["$",(j=S.entryPrice)==null?void 0:j.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Actual"}),e.jsxs("p",{className:"font-mono",children:["$",(y=S.currentPrice)==null?void 0:y.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`font-mono font-bold ${S.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[S.pnl>=0?"+":"","$",(E=S.pnl)==null?void 0:E.toFixed(2)," (",(C=S.pnlPercent)==null?void 0:C.toFixed(1),"%)"]})]})]})]},S.id)})})]})]}),a.closedTrades.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-[var(--border)]",children:e.jsx("h3",{className:"text-sm font-bold",children:"Historial de Trades (Demo)"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left p-2",children:"Par"}),e.jsx("th",{className:"text-left p-2",children:"Lado"}),e.jsx("th",{className:"text-right p-2",children:"Entrada"}),e.jsx("th",{className:"text-right p-2",children:"Salida"}),e.jsx("th",{className:"text-right p-2",children:"P&L"})]})}),e.jsx("tbody",{children:a.closedTrades.slice().reverse().map(S=>{var j,y,E;return e.jsxs("tr",{className:"border-b border-[var(--border)]/50 hover:bg-[var(--dark-3)]",children:[e.jsx("td",{className:"p-2 font-bold",children:S.symbol}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:S.side==="buy"?"text-[var(--green)]":"text-[var(--red)]",children:S.side.toUpperCase()})}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(j=S.entryPrice)==null?void 0:j.toFixed(2)]}),e.jsxs("td",{className:"p-2 text-right font-mono",children:["$",(y=S.exitPrice)==null?void 0:y.toFixed(2)]}),e.jsxs("td",{className:`p-2 text-right font-mono font-bold ${S.pnl>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[S.pnl>=0?"+":"","$",(E=S.pnl)==null?void 0:E.toFixed(2)]})]},S.id)})})]})})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"âš ï¸ Esto es un simulador con datos reales del mercado. No se usa dinero real."}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Practica tus estrategias sin riesgo."})]})]})}function Zs(){var c;const{settings:u,updateSettings:t,user:s}=J(),[a,r]=P.useState(""),[l,i]=P.useState(!1),n=()=>{a.trim()&&(et.setApiKey(a.trim()),t({openaiKey:a.trim()}),i(!0),setTimeout(()=>i(!1),2e3))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Ajustes"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"ConfiguraciÃ³n de tu plataforma"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(fe,{size:16,className:"text-[var(--gold)]"})," Perfil"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Nombre:"})," ",s==null?void 0:s.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Plan:"})," ",e.jsx("span",{className:"text-[var(--gold)]",children:(c=s==null?void 0:s.plan)==null?void 0:c.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Xe,{size:16,className:"text-[var(--gold)]"})," API Key de OpenAI"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-2",children:"Opcional. Sin API key, Kairos AI usa anÃ¡lisis local integrado. Con API key, accedes a GPT-4 para anÃ¡lisis avanzado."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:a,onChange:d=>r(d.target.value),placeholder:"sk-...",className:"flex-1 text-sm font-mono"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-[var(--gold)] text-white rounded-xl text-sm font-bold",children:l?"âœ“ Guardado":"Guardar"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Zt,{size:16,className:"text-[var(--gold)]"})," Trading por Defecto"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo mÃ¡x. por trade (%)"}),e.jsx("input",{type:"number",value:u.maxRiskPerTrade,onChange:d=>t({maxRiskPerTrade:parseFloat(d.target.value)}),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Apalancamiento predeterminado"}),e.jsx("input",{type:"number",value:u.defaultLeverage,onChange:d=>t({defaultLeverage:parseFloat(d.target.value)}),className:"w-full text-sm"})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Te,{size:16,className:"text-[var(--gold)]"})," Notificaciones"]}),e.jsx("div",{className:"space-y-3",children:[{key:"notifications",label:"Notificaciones",desc:"Alertas de trades y seÃ±ales"},{key:"soundAlerts",label:"Sonido",desc:"Alertas sonoras al ejecutar trades"}].map(d=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:d.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:d.desc})]}),e.jsx("button",{onClick:()=>t({[d.key]:!u[d.key]}),className:`w-12 h-6 rounded-full transition-colors relative
                  ${u[d.key]?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform
                    ${u[d.key]?"left-6":"left-0.5"}`})})]},d.key))})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ze,{size:16,className:"text-[var(--gold)]"})," Kairos Wallet"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:"Conecta tu Kairos Wallet para usar KAIROS Coin como mÃ©todo de pago y recibir recompensas."}),e.jsxs("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--gold)]/20 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(ze,{size:14})," Abrir Kairos Wallet"]})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"Kairos Trade v1.0.0 â€¢ Kairos 777 Inc"}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Powered by Kairos AI"})]})]})}const gt="kairos_trade_alerts";class ea{constructor(){this.alerts=this._load(),this.triggered=[],this.monitoring=!1,this.interval=null,this.callbacks=new Set}_load(){try{return JSON.parse(localStorage.getItem(gt))||[]}catch{return[]}}_save(){localStorage.setItem(gt,JSON.stringify(this.alerts))}subscribe(t){return this.callbacks.add(t),()=>this.callbacks.delete(t)}_notify(t){this.callbacks.forEach(s=>s(t)),Notification.permission==="granted"&&new Notification(`Kairos Trade â€” ${t.symbol}`,{body:t.message,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%23D4AF37"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%230A0A0F" font-family="serif" font-weight="bold">K</text></svg>'})}async requestPermission(){Notification.permission!=="granted"&&await Notification.requestPermission()}addPriceAlert(t,s,a,r={}){const l={id:Date.now().toString(36),type:"price",symbol:t,condition:s,targetPrice:parseFloat(a),active:!0,repeat:r.repeat||!1,message:`${t} ${s==="above"?">":"<"} $${a}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}addSignalAlert(t,s,a={}){const r={ema_cross:`EMA ${a.fast||20}/${a.slow||50} Cross`,rsi_oversold:`RSI < ${a.threshold||30}`,rsi_overbought:`RSI > ${a.threshold||70}`,macd_cross:"MACD Signal Cross",volume_spike:`Volume Spike > ${a.multiplier||2}x avg`},l={id:Date.now().toString(36),type:"signal",symbol:t,signalType:s,params:a,active:!0,repeat:a.repeat||!1,message:`${t}: ${r[s]||s}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}removeAlert(t){this.alerts=this.alerts.filter(s=>s.id!==t),this._save()}getAlerts(){return this.alerts}getTriggered(){return this.triggered}_ensureMonitoring(){this.monitoring||(this.monitoring=!0,this.interval=setInterval(()=>this._check(),15e3),this._check())}stop(){this.monitoring=!1,this.interval&&clearInterval(this.interval)}async _check(){const t=this.alerts.filter(a=>a.active);if(t.length===0)return;const s={};t.forEach(a=>{s[a.symbol]||(s[a.symbol]=[]),s[a.symbol].push(a)});for(const[a,r]of Object.entries(s))try{const l=await Y.getPrice(a);for(const i of r){let n=!1;i.type==="price"&&(i.condition==="above"&&l>=i.targetPrice&&(n=!0),i.condition==="below"&&l<=i.targetPrice&&(n=!0)),i.type==="signal"&&(n=await this._checkSignal(a,i)),n&&(i.triggeredAt=new Date().toISOString(),i.triggeredPrice=l,this.triggered.push({...i}),this._notify({...i,currentPrice:l,message:`ðŸ”” ${i.message} â€” Precio actual: $${l.toLocaleString()}`}),i.repeat||(i.active=!1))}}catch{}this._save()}async _checkSignal(t,s){try{const a=await Y.getCandles(t,"1h",60),r=a.map(i=>i.close),l=r.length;switch(s.signalType){case"ema_cross":{const i=ae(r,s.params.fast||20),n=ae(r,s.params.slow||50);return Ae(i,n,l-1)!==null}case"rsi_oversold":return me(r,s.params.period||14)[l-1]<(s.params.threshold||30);case"rsi_overbought":return me(r,s.params.period||14)[l-1]>(s.params.threshold||70);case"macd_cross":{const{macd:i,signal:n}=Be(r);return Ae(i,n,l-1)!==null}case"volume_spike":{const i=a.map(c=>c.volume),n=i.slice(-20).reduce((c,d)=>c+d,0)/20;return i[l-1]>n*(s.params.multiplier||2)}default:return!1}}catch{return!1}}}const ce=new ea,ta=[{id:"ema_cross",label:"EMA Cruce",desc:"EMA 20/50 crossover",icon:Ye},{id:"rsi_oversold",label:"RSI Sobreventa",desc:"RSI < 30",icon:Ee},{id:"rsi_overbought",label:"RSI Sobrecompra",desc:"RSI > 70",icon:ge},{id:"macd_cross",label:"MACD Cruce",desc:"MACD/Signal crossover",icon:ne},{id:"volume_spike",label:"Spike Volumen",desc:"Volumen > 2x promedio",icon:St}];function sa(){const{selectedPair:u}=J(),[t,s]=P.useState([]),[a,r]=P.useState([]),[l,i]=P.useState("active"),[n,c]=P.useState({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1});P.useEffect(()=>{s(ce.getAlerts()),r(ce.getTriggered());const o=ce.subscribe(()=>{s([...ce.getAlerts()]),r([...ce.getTriggered()])});return ce.requestPermission(),o},[]);const d=()=>{if(n.type==="price"){if(!n.price)return;ce.addPriceAlert(u,n.condition,n.price,{repeat:n.repeat})}else ce.addSignalAlert(u,n.signalType,{repeat:n.repeat});s([...ce.getAlerts()]),c({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1}),i("active")},h=o=>{ce.removeAlert(o),s([...ce.getAlerts()])},p=t.filter(o=>o.active);return t.filter(o=>!o.active),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",children:[e.jsxs(O.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Te,{size:18,className:"text-[var(--gold)] shrink-0"}),"Alertas"]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-0.5",children:[p.length," alerta",p.length!==1?"s":""," activa",p.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>i("create"),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-semibold text-white transition-all hover:opacity-90 shrink-0",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx(Oe,{size:14}),"Nueva Alerta"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[{id:"active",label:`Activas (${p.length})`},{id:"triggered",label:`Disparadas (${a.length})`},{id:"create",label:"Crear"}].map(o=>e.jsx("button",{onClick:()=>i(o.id),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-200
              ${l===o.id?"text-white":"text-[var(--text-dim)]"}`,style:l===o.id?{background:"linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.08))",border:"1px solid rgba(59,130,246,0.15)"}:{},children:o.label},o.id))}),e.jsx(se,{children:l==="create"&&e.jsxs(O.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl p-5 space-y-4",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Crear Alerta para ",de(u)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c({...n,type:"price"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="price"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Precio"}),e.jsx("button",{onClick:()=>c({...n,type:"signal"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${n.type==="signal"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"SeÃ±al TÃ©cnica"})]}),n.type==="price"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2",children:["above","below"].map(o=>e.jsxs("button",{onClick:()=>c({...n,condition:o}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1.5
                        ${n.condition===o?o==="above"?"bg-[var(--green)]/10 text-[var(--green)] border border-[var(--green)]/15":"bg-[var(--red)]/10 text-[var(--red)] border border-[var(--red)]/15":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:[o==="above"?e.jsx(ge,{size:12}):e.jsx(Ee,{size:12}),o==="above"?"Sube a":"Baja a"]},o))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Precio objetivo (USD)"}),e.jsx("input",{type:"number",value:n.price,onChange:o=>c({...n,price:o.target.value}),placeholder:"Ej: 100000",className:"w-full",step:"any"})]})]}):e.jsx("div",{className:"space-y-2",children:ta.map(o=>{const b=o.icon;return e.jsxs("button",{onClick:()=>c({...n,signalType:o.id}),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left
                        ${n.signalType===o.id?"bg-[var(--gold)]/10 border border-[var(--gold)]/15":"bg-[var(--dark-3)] border border-transparent hover:border-[var(--border)]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${n.signalType===o.id?"bg-[var(--gold)]/15":"bg-[var(--dark-4)]"}`,children:e.jsx(b,{size:14,className:n.signalType===o.id?"text-[var(--gold)]":"text-[var(--text-dim)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:o.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:o.desc})]})]},o.id)})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("div",{className:`w-9 h-5 rounded-full transition-colors relative ${n.repeat?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,onClick:()=>c({...n,repeat:!n.repeat}),children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform ${n.repeat?"translate-x-4":"translate-x-0.5"}`})}),e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Repetir alerta"})]}),e.jsx("button",{onClick:d,disabled:n.type==="price"&&!n.price,className:"w-full py-3 text-white font-bold rounded-xl text-sm transition-all disabled:opacity-40",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:"Crear Alerta"})]})}),l==="active"&&e.jsx("div",{className:"space-y-2",children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas activas"}),e.jsx("button",{onClick:()=>i("create"),className:"text-xs text-[var(--gold)] mt-2 font-semibold",children:"Crear primera alerta â†’"})]}):p.map((o,b)=>e.jsxs(O.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:b*.04},className:"flex items-center gap-3 p-3 rounded-xl group",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0",style:{background:o.type==="price"?"rgba(59,130,246,0.08)":"rgba(139,92,246,0.08)"},children:o.type==="price"?o.condition==="above"?e.jsx(ge,{size:16,className:"text-[var(--green)]"}):e.jsx(Ee,{size:16,className:"text-[var(--red)]"}):e.jsx(ne,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:o.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:o.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.repeat&&e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] bg-[var(--gold)]/10 px-1.5 py-0.5 rounded",children:"â†»"}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("button",{onClick:()=>h(o.id),className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/[0.06] transition-all opacity-0 group-hover:opacity-100",children:e.jsx(ke,{size:13})})]})]},o.id))}),l==="triggered"&&e.jsx("div",{className:"space-y-2",children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas disparadas"})]}):[...a].reverse().map((o,b)=>{var m;return e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(14,203,129,0.04), rgba(17,19,24,0.6))",border:"1px solid rgba(14,203,129,0.08)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--green)]/[0.08] flex items-center justify-center shrink-0",children:e.jsx(je,{size:16,className:"text-[var(--green)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:o.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:o.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono text-[var(--green)]",children:["$",(m=o.triggeredPrice)==null?void 0:m.toLocaleString()]}),e.jsx("p",{className:"text-[9px] text-[var(--text-dim)]",children:new Date(o.triggeredAt).toLocaleTimeString()})]})]},`${o.id}-${b}`)})})]})}function aa(){const{positions:u,orders:t,tradeHistory:s,bots:a,currentPrice:r,closePosition:l,cancelOrder:i}=J(),[n,c]=P.useState("positions"),[d,h]=P.useState(!1),p=a.flatMap(m=>(m.tradeLog||m.trades_log||[]).map(f=>({...f,botName:m.name,botId:m.id}))).sort((m,g)=>new Date(g.time||g.timestamp||0)-new Date(m.time||m.timestamp||0)),o=a.filter(m=>m.status==="active"),b=[{id:"positions",label:"Posiciones",count:u.length},{id:"orders",label:"Ã“rdenes",count:t.length},{id:"botTrades",label:"Bot Trades",count:p.length},{id:"history",label:"Historial",count:s.length}];return d?e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 cursor-pointer shrink-0 select-none",style:{borderTop:"1px solid rgba(30,34,45,0.6)",background:"rgba(14,16,21,0.95)"},onClick:()=>h(!1),children:[e.jsx("div",{className:"flex items-center gap-4 overflow-x-auto",children:b.map(m=>e.jsxs("span",{className:"text-[11px] text-[var(--text-dim)] font-medium whitespace-nowrap",children:[m.label," ",e.jsxs("span",{style:{opacity:.5},children:["(",m.count,")"]})]},m.id))}),e.jsx(es,{size:14,className:"text-[var(--text-dim)] shrink-0 ml-2"})]}):e.jsxs("div",{className:"flex flex-col shrink-0",style:{height:200,borderTop:"1px solid rgba(30,34,45,0.6)",background:"rgba(14,16,21,0.95)"},children:[e.jsxs("div",{className:"flex items-center shrink-0 px-3 gap-1",style:{borderBottom:"1px solid rgba(30,34,45,0.4)"},children:[b.map((m,g)=>e.jsxs("button",{onClick:()=>c(m.id),className:`px-3 py-2.5 text-[11px] font-semibold transition-colors relative whitespace-nowrap
              ${n===m.id?"text-[var(--text)]":"text-[var(--text-dim)] hover:text-[var(--text-secondary)]"}`,children:[m.label,m.count>0&&e.jsx("span",{className:`ml-1.5 text-[9px] px-1.5 py-0.5 rounded-full font-bold
                ${n===m.id?"bg-[var(--gold)]/15 text-[var(--gold)]":"bg-white/5 text-[var(--text-dim)]"}`,children:m.count}),n===m.id&&e.jsx("div",{className:"absolute bottom-0 left-1 right-1 h-[2px] rounded-t-full bg-[var(--gold)]"})]},m.id)),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>h(!0),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--text)] transition-colors mr-1 shrink-0",children:e.jsx(ts,{size:14})})]}),e.jsxs("div",{className:"flex-1 overflow-auto",style:{scrollbarWidth:"thin"},children:[n==="positions"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Entrada"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Actual"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"SL"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"TP"}),e.jsx("th",{className:"text-right py-1.5 px-3 font-semibold",children:"AcciÃ³n"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin posiciones abiertas"})}):u.map(m=>{const g=r||m.entryPrice,f=m.side==="buy"?(g-m.entryPrice)*m.quantity:(m.entryPrice-g)*m.quantity,k=f/(m.entryPrice*m.quantity)*100;return e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:m.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${m.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":"text-[var(--red)] bg-[var(--red)]/10"}`,children:m.side==="buy"?"LONG":"SHORT"})}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:m.quantity}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(m.entryPrice).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(g).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:`py-1.5 px-2 text-right font-mono font-bold ${f>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[f>=0?"+":"",f.toFixed(2)," ",e.jsxs("span",{className:"text-[9px] opacity-70",children:["(",k>=0?"+":"",k.toFixed(2),"%)"]})]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-[var(--red)]",children:m.stopLoss?`$${m.stopLoss}`:"â€”"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono text-[var(--green)]",children:m.takeProfit?`$${m.takeProfit}`:"â€”"}),e.jsx("td",{className:"py-1.5 px-3 text-right",children:e.jsx("button",{onClick:()=>l(m.id),className:"text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] px-2 py-1 rounded-md hover:bg-[var(--red)]/10 transition-all",children:"Cerrar"})})]},m.id)})})]}),n==="orders"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Tipo"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Precio"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Total"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Fecha"}),e.jsx("th",{className:"text-right py-1.5 px-3 font-semibold",children:"AcciÃ³n"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin Ã³rdenes pendientes"})}):t.map(m=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:m.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded bg-white/5 text-[var(--text-secondary)]",children:m.type==="limit"?"LIMIT":m.type==="stop_loss"?"STOP":"MARKET"})}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold ${m.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:m.side==="buy"?"COMPRA":"VENTA"})}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(m.price).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:m.quantity}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",(m.price*m.quantity).toFixed(2)]}),e.jsx("td",{className:"py-1.5 px-2 text-[var(--text-dim)]",children:m.createdAt?new Date(m.createdAt).toLocaleString("es",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”"}),e.jsx("td",{className:"py-1.5 px-3 text-right",children:e.jsx("button",{onClick:()=>i(m.id),className:"text-[10px] font-semibold text-[var(--text-dim)] hover:text-[var(--red)] px-2 py-1 rounded-md hover:bg-[var(--red)]/10 transition-all",children:"Cancelar"})})]},m.id))})]}),n==="botTrades"&&e.jsxs("div",{children:[o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 flex-wrap overflow-hidden",style:{borderBottom:"1px solid rgba(30,34,45,0.3)"},children:[e.jsx(Ne,{size:12,className:"text-[var(--gold)] shrink-0"}),e.jsxs("span",{className:"text-[10px] text-[var(--text-dim)] shrink-0",children:[o.length," bot",o.length>1?"s":""," activo",o.length>1?"s":""]}),o.map(m=>e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-[var(--green)]/10 text-[var(--green)] font-semibold truncate max-w-[200px]",children:[m.name," â€¢ ",m.trades||0," trades"]},m.id))]}),e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Bot"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"SeÃ±al"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Precio"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Hora"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:a.length===0?"No hay bots configurados":"Los bots no han ejecutado trades aÃºn"})}):p.slice(0,50).map((m,g)=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-semibold text-[var(--gold)]",children:m.botName||"Bot"}),e.jsx("td",{className:"py-1.5 px-2 font-bold text-[var(--text)]",children:m.symbol||m.pair||"â€”"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded
                        ${m.signal==="buy"||m.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":m.signal==="sell"||m.side==="sell"?"text-[var(--red)] bg-[var(--red)]/10":"text-[var(--text-dim)] bg-white/5"}`,children:(m.signal||m.side||"HOLD").toUpperCase()})}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:m.price?`$${Number(m.price).toLocaleString(void 0,{minimumFractionDigits:2})}`:"â€”"}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:m.quantity||m.amount||"â€”"}),e.jsx("td",{className:`py-1.5 px-2 text-right font-mono font-bold
                      ${(m.pnl||0)>0?"text-[var(--green)]":(m.pnl||0)<0?"text-[var(--red)]":"text-[var(--text-dim)]"}`,children:m.pnl!=null?`${m.pnl>=0?"+":""}$${m.pnl.toFixed(2)}`:"â€”"}),e.jsx("td",{className:"py-1.5 px-3 text-[var(--text-dim)]",children:m.time||m.timestamp?new Date(m.time||m.timestamp).toLocaleString("es",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"â€”"})]},g))})]})]}),n==="history"&&e.jsxs("table",{className:"w-full text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] text-[10px] uppercase tracking-wider",children:[e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Par"}),e.jsx("th",{className:"text-left py-1.5 px-2 font-semibold",children:"Lado"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Entrada"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Salida"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"Cantidad"}),e.jsx("th",{className:"text-right py-1.5 px-2 font-semibold",children:"P&L"}),e.jsx("th",{className:"text-left py-1.5 px-3 font-semibold",children:"Fecha"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-[var(--text-dim)]/50 text-xs",children:"Sin trades cerrados"})}):[...s].reverse().slice(0,50).map((m,g)=>e.jsxs("tr",{className:"border-b border-[var(--border)]/30 hover:bg-white/[0.015] transition-colors",children:[e.jsx("td",{className:"py-1.5 px-3 font-bold text-[var(--text)]",children:m.symbol}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${m.side==="buy"?"text-[var(--green)] bg-[var(--green)]/10":"text-[var(--red)] bg-[var(--red)]/10"}`,children:m.side==="buy"?"LONG":"SHORT"})}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",Number(m.entryPrice).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:"py-1.5 px-2 text-right font-mono",children:["$",m.exitPrice?Number(m.exitPrice).toLocaleString(void 0,{minimumFractionDigits:2}):"â€”"]}),e.jsx("td",{className:"py-1.5 px-2 text-right font-mono",children:m.quantity}),e.jsxs("td",{className:`py-1.5 px-2 text-right font-mono font-bold ${(m.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(m.pnl||0)>=0?"+":"","$",(m.pnl||0).toFixed(2)]}),e.jsx("td",{className:"py-1.5 px-3 text-[var(--text-dim)]",children:m.closedAt?new Date(m.closedAt).toLocaleString("es",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”"})]},m.id||g))})]})]})]})}function ra(){const[u,t]=P.useState("chart"),{selectedPair:s}=J();return e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex gap-1 px-3 pt-2 shrink-0",style:{background:"var(--surface)"},children:[["chart","Chart"],["depth","Depth"]].map(([a,r])=>e.jsx("button",{onClick:()=>t(a),className:`px-3 py-1.5 text-xs font-bold rounded-t-lg transition-colors ${u===a?"text-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--text-secondary)]"}`,style:u===a?{background:"var(--dark)",borderTop:"2px solid var(--gold)"}:{},children:r},a))}),u==="chart"?e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex flex-col",children:e.jsx(Ss,{})}):e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex flex-col",children:e.jsx(Cs,{pair:s||"BTCUSDT",height:500})})]}),e.jsx(aa,{})]}),e.jsx(Ps,{})]})}function ia(){const{isAuthenticated:u,currentPage:t,aiPanelOpen:s,seedDefaultStrategies:a}=J();if(P.useEffect(()=>{a()},[]),!u)return e.jsx(js,{});const r=()=>{switch(t){case"dashboard":return e.jsx(dt,{});case"chart":return e.jsx(ra,{});case"bots":return e.jsx(qs,{});case"simulator":return e.jsx(Xs,{});case"brokers":return e.jsx(Ks,{});case"ai":return e.jsx(ut,{});case"strategies":return e.jsx(Gs,{});case"history":return e.jsx(Ys,{});case"alerts":return e.jsx(sa,{});case"wallet":return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)]/15 flex items-center justify-center text-[var(--gold)] text-2xl font-bold mx-auto mb-4",children:"K"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Kairos Wallet"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Conecta tu Kairos Wallet para integrar tus balances de KAIROS Coin con la plataforma de trading."}),e.jsx("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-[var(--gold)] text-white font-semibold rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Abrir Kairos Wallet"})]})});case"settings":return e.jsx(Zs,{});default:return e.jsx(dt,{})}};return e.jsxs("div",{className:"flex h-screen bg-[var(--dark)] overflow-hidden",children:[e.jsx(ss,{position:"top-right",toastOptions:{style:{background:"#181A20",color:"#EAECEF",border:"1px solid #1E222D",fontSize:"13px"}}}),e.jsx(bs,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(vs,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(se,{mode:"wait",children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"flex-1 flex flex-col overflow-hidden",children:r()},t)}),e.jsx(se,{children:s&&t!=="ai"&&e.jsx(O.div,{initial:{width:0,opacity:0},animate:{width:380,opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"border-l border-[var(--border)] overflow-hidden shrink-0",children:e.jsx(ut,{})})})]})]})]})}ps.createRoot(document.getElementById("root")).render(e.jsx(ns.StrictMode,{children:e.jsx(os,{children:e.jsx(ia,{})})}));
