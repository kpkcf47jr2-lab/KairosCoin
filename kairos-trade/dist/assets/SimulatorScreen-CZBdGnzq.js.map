{"version":3,"file":"SimulatorScreen-CZBdGnzq.js","sources":["../../src/services/simulator.js","../../src/components/Trading/SimulatorScreen.jsx"],"sourcesContent":["// Kairos Trade — Paper Trading Simulator (Demo Mode)\n// Users can practice trading with virtual money using REAL market data\n// No risk, full learning experience\n\nimport marketData from './marketData';\nimport { calculateEMA, calculateRSI } from './indicators';\nimport { feeService } from './feeService';\n\nconst STORAGE_KEY = 'kairos_trade_simulator';\n\nclass TradingSimulator {\n  constructor() {\n    this.state = this._load();\n  }\n\n  _load() {\n    try {\n      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));\n      if (saved) return saved;\n    } catch {}\n    return this._defaultState();\n  }\n\n  _defaultState() {\n    return {\n      balance: 10000,\n      initialBalance: 10000,\n      positions: [],\n      closedTrades: [],\n      orders: [],\n      equity: 10000,\n      stats: {\n        totalTrades: 0,\n        wins: 0,\n        losses: 0,\n        totalPnl: 0,\n        bestTrade: 0,\n        worstTrade: 0,\n        avgWin: 0,\n        avgLoss: 0,\n        maxDrawdown: 0,\n        sharpeRatio: 0,\n      },\n      equityHistory: [{ time: Date.now(), value: 10000 }],\n      createdAt: new Date().toISOString(),\n    };\n  }\n\n  _save() {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(this.state));\n  }\n\n  // ─── Reset simulator ───\n  reset(startingBalance = 10000) {\n    this.state = this._defaultState();\n    this.state.balance = startingBalance;\n    this.state.initialBalance = startingBalance;\n    this.state.equity = startingBalance;\n    this.state.equityHistory = [{ time: Date.now(), value: startingBalance }];\n    this._save();\n    return this.state;\n  }\n\n  // ─── Open position ───\n  async openPosition(symbol, side, quantity, options = {}) {\n    const price = await marketData.getPrice(symbol);\n    const cost = price * quantity;\n\n    if (cost > this.state.balance) {\n      throw new Error(`Fondos insuficientes. Necesitas $${cost.toFixed(2)}, tienes $${this.state.balance.toFixed(2)}`);\n    }\n\n    const position = {\n      id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),\n      symbol,\n      side,\n      quantity,\n      entryPrice: price,\n      currentPrice: price,\n      cost,\n      pnl: 0,\n      pnlPercent: 0,\n      stopLoss: options.stopLoss || null,\n      takeProfit: options.takeProfit || null,\n      leverage: options.leverage || 1,\n      openedAt: new Date().toISOString(),\n    };\n\n    // Platform fee on open (0.05% of volume)\n    const openFee = feeService.applyVolumeFee(price, quantity);\n\n    this.state.balance -= cost + openFee;\n    this.state.positions.push(position);\n    this._save();\n\n    return { success: true, position, message: `${side.toUpperCase()} ${quantity} ${symbol} @ $${price.toFixed(2)}` };\n  }\n\n  // ─── Close position ───\n  async closePosition(positionId) {\n    const idx = this.state.positions.findIndex(p => p.id === positionId);\n    if (idx === -1) throw new Error('Posición no encontrada');\n\n    const pos = this.state.positions[idx];\n    const exitPrice = await marketData.getPrice(pos.symbol);\n\n    const rawPnl = pos.side === 'buy'\n      ? (exitPrice - pos.entryPrice) * pos.quantity * pos.leverage\n      : (pos.entryPrice - exitPrice) * pos.quantity * pos.leverage;\n\n    // Platform fee on close (0.05% of volume)\n    const { adjustedPnl: pnl, fee: closeFee } = feeService.applyFee(exitPrice, pos.quantity, rawPnl);\n\n    const pnlPercent = (pnl / pos.cost) * 100;\n\n    const closedTrade = {\n      ...pos,\n      exitPrice,\n      pnl,\n      pnlPercent,\n      closedAt: new Date().toISOString(),\n      duration: Date.now() - new Date(pos.openedAt).getTime(),\n    };\n\n    // Update balance and stats\n    this.state.balance += pos.cost + pnl;\n    this.state.positions.splice(idx, 1);\n    this.state.closedTrades.push(closedTrade);\n    this._updateStats(pnl);\n    this._save();\n\n    return { success: true, trade: closedTrade, message: `Cerrada: ${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)} (${pnlPercent.toFixed(1)}%)` };\n  }\n\n  // ─── Place limit order ───\n  async placeLimitOrder(symbol, side, quantity, targetPrice, options = {}) {\n    const currentPrice = await marketData.getPrice(symbol);\n\n    const order = {\n      id: Date.now().toString(36),\n      symbol,\n      side,\n      quantity,\n      targetPrice,\n      currentPrice,\n      type: 'limit',\n      stopLoss: options.stopLoss || null,\n      takeProfit: options.takeProfit || null,\n      status: 'pending',\n      createdAt: new Date().toISOString(),\n    };\n\n    this.state.orders.push(order);\n    this._save();\n    return { success: true, order };\n  }\n\n  // ─── Cancel order ───\n  cancelOrder(orderId) {\n    this.state.orders = this.state.orders.filter(o => o.id !== orderId);\n    this._save();\n    return { success: true };\n  }\n\n  // ─── Update positions with current prices ───\n  async updatePositions() {\n    let totalEquity = this.state.balance;\n\n    for (const pos of this.state.positions) {\n      try {\n        const price = await marketData.getPrice(pos.symbol);\n        pos.currentPrice = price;\n        pos.pnl = pos.side === 'buy'\n          ? (price - pos.entryPrice) * pos.quantity * (pos.leverage || 1)\n          : (pos.entryPrice - price) * pos.quantity * (pos.leverage || 1);\n        pos.pnlPercent = (pos.pnl / pos.cost) * 100;\n        totalEquity += pos.cost + pos.pnl;\n\n        // Check stop loss\n        if (pos.stopLoss) {\n          const hit = pos.side === 'buy' ? price <= pos.stopLoss : price >= pos.stopLoss;\n          if (hit) {\n            await this.closePosition(pos.id);\n            continue;\n          }\n        }\n\n        // Check take profit\n        if (pos.takeProfit) {\n          const hit = pos.side === 'buy' ? price >= pos.takeProfit : price <= pos.takeProfit;\n          if (hit) {\n            await this.closePosition(pos.id);\n            continue;\n          }\n        }\n      } catch {}\n    }\n\n    // Check pending limit orders\n    for (const order of this.state.orders.filter(o => o.status === 'pending')) {\n      try {\n        const price = await marketData.getPrice(order.symbol);\n        const triggered = order.side === 'buy'\n          ? price <= order.targetPrice\n          : price >= order.targetPrice;\n\n        if (triggered) {\n          order.status = 'filled';\n          await this.openPosition(order.symbol, order.side, order.quantity, {\n            stopLoss: order.stopLoss,\n            takeProfit: order.takeProfit,\n          });\n        }\n      } catch {}\n    }\n\n    // Remove filled orders\n    this.state.orders = this.state.orders.filter(o => o.status === 'pending');\n\n    this.state.equity = totalEquity;\n    this.state.equityHistory.push({ time: Date.now(), value: totalEquity });\n\n    // Keep last 500 equity points\n    if (this.state.equityHistory.length > 500) {\n      this.state.equityHistory = this.state.equityHistory.slice(-500);\n    }\n\n    this._save();\n    return this.state;\n  }\n\n  // ─── Update stats ───\n  _updateStats(pnl) {\n    const s = this.state.stats;\n    s.totalTrades++;\n    s.totalPnl += pnl;\n\n    if (pnl > 0) {\n      s.wins++;\n      s.bestTrade = Math.max(s.bestTrade, pnl);\n    } else {\n      s.losses++;\n      s.worstTrade = Math.min(s.worstTrade, pnl);\n    }\n\n    s.avgWin = s.wins > 0 ? s.totalPnl / s.wins : 0;\n    s.avgLoss = s.losses > 0 ? (s.totalPnl - s.avgWin * s.wins) / s.losses : 0;\n\n    // Max drawdown\n    const peakEquity = Math.max(...this.state.equityHistory.map(e => e.value));\n    s.maxDrawdown = ((peakEquity - this.state.equity) / peakEquity) * 100;\n\n    // Win rate\n    s.winRate = s.totalTrades > 0 ? (s.wins / s.totalTrades) * 100 : 0;\n\n    // Profit factor\n    const grossProfit = this.state.closedTrades.filter(t => t.pnl > 0).reduce((s, t) => s + t.pnl, 0);\n    const grossLoss = Math.abs(this.state.closedTrades.filter(t => t.pnl < 0).reduce((s, t) => s + t.pnl, 0));\n    s.profitFactor = grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? Infinity : 0;\n  }\n\n  // ─── Get state ───\n  getState() {\n    return this.state;\n  }\n\n  // ─── Get performance summary ───\n  getPerformance() {\n    const s = this.state;\n    const returnPct = ((s.equity - s.initialBalance) / s.initialBalance) * 100;\n    return {\n      balance: s.balance,\n      equity: s.equity,\n      initialBalance: s.initialBalance,\n      returnPct,\n      openPositions: s.positions.length,\n      pendingOrders: s.orders.length,\n      ...s.stats,\n    };\n  }\n}\n\nexport const simulator = new TradingSimulator();\nexport default simulator;\n","// Kairos Trade — Paper Trading Simulator Screen\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Play, Pause, RotateCcw, TrendingUp, TrendingDown,\n  DollarSign, Target, Shield, Award, BarChart3, ArrowUpRight, ArrowDownRight, X\n} from 'lucide-react';\nimport useStore from '../../store/useStore';\nimport simulator from '../../services/simulator';\nimport { POPULAR_PAIRS } from '../../constants';\nimport { formatPair, getBase } from '../../utils/pairUtils';\n\n// Mini equity curve component\nfunction EquityCurve({ data, height = 140 }) {\n  const canvasRef = useRef(null);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas || !data || data.length < 2) return;\n    const ctx = canvas.getContext('2d');\n    const dpr = window.devicePixelRatio || 1;\n    const w = canvas.clientWidth;\n    const h = canvas.clientHeight;\n    canvas.width = w * dpr;\n    canvas.height = h * dpr;\n    ctx.scale(dpr, dpr);\n    ctx.clearRect(0, 0, w, h);\n\n    const values = data.map(d => d.value);\n    const minV = Math.min(...values) * 0.998;\n    const maxV = Math.max(...values) * 1.002;\n    const range = maxV - minV || 1;\n    const pad = { top: 8, bottom: 20, left: 0, right: 0 };\n    const cw = w - pad.left - pad.right;\n    const ch = h - pad.top - pad.bottom;\n\n    const px = (i) => pad.left + (i / (data.length - 1)) * cw;\n    const py = (v) => pad.top + ch - ((v - minV) / range) * ch;\n\n    const startVal = values[0];\n    const endVal = values[values.length - 1];\n    const isPositive = endVal >= startVal;\n    const lineColor = isPositive ? '#00DC82' : '#FF3B30';\n\n    // Fill area\n    ctx.beginPath();\n    ctx.moveTo(px(0), py(values[0]));\n    for (let i = 1; i < values.length; i++) ctx.lineTo(px(i), py(values[i]));\n    ctx.lineTo(px(values.length - 1), h - pad.bottom);\n    ctx.lineTo(px(0), h - pad.bottom);\n    ctx.closePath();\n    const grad = ctx.createLinearGradient(0, 0, 0, h);\n    grad.addColorStop(0, isPositive ? 'rgba(0,220,130,0.2)' : 'rgba(255,59,48,0.2)');\n    grad.addColorStop(1, 'rgba(0,0,0,0)');\n    ctx.fillStyle = grad;\n    ctx.fill();\n\n    // Line\n    ctx.beginPath();\n    ctx.moveTo(px(0), py(values[0]));\n    for (let i = 1; i < values.length; i++) ctx.lineTo(px(i), py(values[i]));\n    ctx.strokeStyle = lineColor;\n    ctx.lineWidth = 2;\n    ctx.lineJoin = 'round';\n    ctx.stroke();\n\n    // Start dotted line (initial balance)\n    ctx.beginPath();\n    ctx.setLineDash([3, 3]);\n    const baseY = py(startVal);\n    ctx.moveTo(0, baseY);\n    ctx.lineTo(w, baseY);\n    ctx.strokeStyle = '#3B82F640';\n    ctx.lineWidth = 1;\n    ctx.stroke();\n    ctx.setLineDash([]);\n\n    // Labels\n    ctx.fillStyle = '#666';\n    ctx.font = '9px Inter, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText(`$${minV.toFixed(0)}`, 4, h - pad.bottom + 12);\n    ctx.textAlign = 'right';\n    ctx.fillText(`$${maxV.toFixed(0)}`, w - 4, h - pad.bottom + 12);\n\n    // Current value dot\n    const lastX = px(values.length - 1);\n    const lastY = py(endVal);\n    ctx.beginPath();\n    ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);\n    ctx.fillStyle = lineColor;\n    ctx.fill();\n    ctx.beginPath();\n    ctx.arc(lastX, lastY, 6, 0, Math.PI * 2);\n    ctx.strokeStyle = lineColor;\n    ctx.lineWidth = 1;\n    ctx.globalAlpha = 0.4;\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n  }, [data, height]);\n\n  if (!data || data.length < 2) {\n    return (\n      <div className=\"flex items-center justify-center text-xs text-[var(--text-dim)]\" style={{ height }}>\n        Ejecuta trades para ver la curva de equity\n      </div>\n    );\n  }\n\n  return <canvas ref={canvasRef} style={{ width: '100%', height }} />;\n}\n\nexport default function SimulatorScreen() {\n  const { selectedPair, currentPrice, setPage } = useStore();\n  const [state, setState] = useState(simulator.getState());\n  const [perf, setPerf] = useState(simulator.getPerformance());\n  const [form, setForm] = useState({ quantity: '', stopLoss: '', takeProfit: '', side: 'buy' });\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState(null);\n\n  // Auto-update positions every 10 seconds\n  useEffect(() => {\n    const interval = setInterval(async () => {\n      const updated = await simulator.updatePositions();\n      setState({ ...updated });\n      setPerf(simulator.getPerformance());\n    }, 10000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const refresh = useCallback(async () => {\n    const updated = await simulator.updatePositions();\n    setState({ ...updated });\n    setPerf(simulator.getPerformance());\n  }, []);\n\n  const handleTrade = async () => {\n    if (!form.quantity || !currentPrice) return;\n    setLoading(true);\n    try {\n      const result = await simulator.openPosition(selectedPair, form.side, parseFloat(form.quantity), {\n        stopLoss: form.stopLoss ? parseFloat(form.stopLoss) : null,\n        takeProfit: form.takeProfit ? parseFloat(form.takeProfit) : null,\n      });\n      setMsg({ type: 'success', text: result.message });\n      setForm({ ...form, quantity: '', stopLoss: '', takeProfit: '' });\n      await refresh();\n    } catch (err) {\n      setMsg({ type: 'error', text: err.message });\n    }\n    setLoading(false);\n    setTimeout(() => setMsg(null), 3000);\n  };\n\n  const handleClose = async (posId) => {\n    try {\n      const result = await simulator.closePosition(posId);\n      setMsg({ type: result.trade.pnl >= 0 ? 'success' : 'error', text: result.message });\n      await refresh();\n    } catch (err) {\n      setMsg({ type: 'error', text: err.message });\n    }\n    setTimeout(() => setMsg(null), 3000);\n  };\n\n  const handleReset = () => {\n    simulator.reset(10000);\n    setState(simulator.getState());\n    setPerf(simulator.getPerformance());\n    setMsg({ type: 'success', text: 'Simulador reiniciado con $10,000' });\n    setTimeout(() => setMsg(null), 2000);\n  };\n\n  const returnPct = perf.returnPct || 0;\n\n  return (\n    <div className=\"flex-1 overflow-y-auto px-5 py-5 space-y-5\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between gap-3\">\n        <div className=\"min-w-0\">\n          <h1 className=\"text-lg font-bold flex items-center gap-2\">\n            <Play size={18} className=\"text-[var(--gold)] shrink-0\" />\n            Paper Trading\n          </h1>\n          <p className=\"text-xs text-[var(--text-dim)]\">Practica con datos reales, sin arriesgar dinero</p>\n        </div>\n        <div className=\"flex gap-2\">\n          <button onClick={refresh} className=\"px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors\">\n            Actualizar\n          </button>\n          <button onClick={handleReset} className=\"flex items-center gap-1 px-3 py-1.5 bg-[var(--red)]/20 text-[var(--red)] rounded-lg text-xs font-bold hover:bg-[var(--red)]/30 transition-colors\">\n            <RotateCcw size={12} /> Reiniciar\n          </button>\n        </div>\n      </div>\n\n      {/* Toast message */}\n      <AnimatePresence>\n        {msg && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            className={`p-3 rounded-xl text-sm font-bold text-center ${\n              msg.type === 'success' ? 'bg-[var(--green)]/20 text-[var(--green)]' : 'bg-[var(--red)]/20 text-[var(--red)]'\n            }`}\n          >\n            {msg.text}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Performance grid */}\n      <div className=\"grid grid-cols-3 sm:grid-cols-5 gap-2\">\n        {[\n          { label: 'Balance', value: `$${perf.balance?.toFixed(2)}`, icon: DollarSign, color: 'var(--gold)' },\n          { label: 'Equity', value: `$${perf.equity?.toFixed(2)}`, icon: BarChart3, color: 'var(--blue)' },\n          { label: 'Retorno', value: `${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%`, icon: returnPct >= 0 ? TrendingUp : TrendingDown, color: returnPct >= 0 ? 'var(--green)' : 'var(--red)' },\n          { label: 'Win Rate', value: `${(perf.winRate || 0).toFixed(0)}%`, icon: Award, color: 'var(--gold)' },\n          { label: 'Trades', value: perf.totalTrades || 0, icon: Target, color: 'var(--text)' },\n        ].map((s, i) => {\n          const Icon = s.icon;\n          return (\n            <motion.div\n              key={s.label}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: i * 0.05 }}\n              className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center\"\n            >\n              <Icon size={16} style={{ color: s.color }} className=\"mx-auto mb-1\" />\n              <p className=\"text-lg font-bold font-mono\" style={{ color: s.color }}>{s.value}</p>\n              <p className=\"text-[10px] text-[var(--text-dim)]\">{s.label}</p>\n            </motion.div>\n          );\n        })}\n      </div>\n\n      {/* Additional stats */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n        {[\n          { label: 'P&L Total', value: `${perf.totalPnl >= 0 ? '+' : ''}$${(perf.totalPnl || 0).toFixed(2)}`, color: (perf.totalPnl || 0) >= 0 ? 'var(--green)' : 'var(--red)' },\n          { label: 'Mejor Trade', value: `+$${(perf.bestTrade || 0).toFixed(2)}`, color: 'var(--green)' },\n          { label: 'Peor Trade', value: `$${(perf.worstTrade || 0).toFixed(2)}`, color: 'var(--red)' },\n          { label: 'Max Drawdown', value: `${(perf.maxDrawdown || 0).toFixed(1)}%`, color: 'var(--red)' },\n        ].map(s => (\n          <div key={s.label} className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3\">\n            <p className=\"text-xs text-[var(--text-dim)]\">{s.label}</p>\n            <p className=\"text-sm font-bold font-mono\" style={{ color: s.color }}>{s.value}</p>\n          </div>\n        ))}\n      </div>\n\n      {/* Equity Curve */}\n      <div className=\"rounded-xl overflow-hidden\" style={{ background: 'var(--surface)', border: '1px solid var(--border)' }}>\n        <div className=\"flex items-center justify-between px-4 py-2.5\" style={{ borderBottom: '1px solid var(--border)' }}>\n          <h3 className=\"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]\">\n            <TrendingUp size={14} className=\"text-[var(--gold)]\" /> Curva de Equity\n          </h3>\n          <span className=\"text-[10px] text-[var(--text-dim)]\">{state.equityHistory?.length || 0} puntos</span>\n        </div>\n        <div className=\"p-2\">\n          <EquityCurve data={state.equityHistory} height={160} />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {/* Open position form */}\n        <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-3\">\n          <h3 className=\"text-sm font-bold\">Abrir Posición (Demo)</h3>\n\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-bold text-[var(--gold)]\">{formatPair(selectedPair)}</span>\n            <span className=\"text-sm font-mono\">${currentPrice?.toLocaleString(undefined, { maximumFractionDigits: 2 }) || '---'}</span>\n            <button onClick={() => setPage('chart')} className=\"text-xs text-[var(--gold)] hover:underline ml-auto\">\n              Ver gráfico →\n            </button>\n          </div>\n\n          {/* Buy/Sell */}\n          <div className=\"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1\">\n            <button\n              onClick={() => setForm({ ...form, side: 'buy' })}\n              className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${form.side === 'buy' ? 'bg-[var(--green)] text-white' : 'text-[var(--text-dim)]'}`}\n            >\n              COMPRAR\n            </button>\n            <button\n              onClick={() => setForm({ ...form, side: 'sell' })}\n              className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${form.side === 'sell' ? 'bg-[var(--red)] text-white' : 'text-[var(--text-dim)]'}`}\n            >\n              VENDER\n            </button>\n          </div>\n\n          <div>\n            <label className=\"text-xs text-[var(--text-dim)] mb-1 block\">Cantidad</label>\n            <input\n              type=\"number\"\n              value={form.quantity}\n              onChange={(e) => setForm({ ...form, quantity: e.target.value })}\n              placeholder=\"Ej: 0.01\"\n              className=\"w-full text-sm\"\n            />\n            {form.quantity && currentPrice && (\n              <p className=\"text-[10px] text-[var(--text-dim)] mt-1\">\n                Costo: ${(parseFloat(form.quantity) * currentPrice).toFixed(2)} de ${perf.balance?.toFixed(2)} disponible\n              </p>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div>\n              <label className=\"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1\">\n                <Shield size={10} /> Stop Loss\n              </label>\n              <input\n                type=\"number\"\n                value={form.stopLoss}\n                onChange={(e) => setForm({ ...form, stopLoss: e.target.value })}\n                placeholder=\"Precio\"\n                className=\"w-full text-xs\"\n              />\n            </div>\n            <div>\n              <label className=\"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1\">\n                <Target size={10} /> Take Profit\n              </label>\n              <input\n                type=\"number\"\n                value={form.takeProfit}\n                onChange={(e) => setForm({ ...form, takeProfit: e.target.value })}\n                placeholder=\"Precio\"\n                className=\"w-full text-xs\"\n              />\n            </div>\n          </div>\n\n          <button\n            onClick={handleTrade}\n            disabled={!form.quantity || !currentPrice || loading}\n            className={`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50 ${\n              form.side === 'buy' ? 'bg-[var(--green)] text-white' : 'bg-[var(--red)] text-white'\n            }`}\n          >\n            {loading ? 'Ejecutando...' : `${form.side === 'buy' ? 'Comprar' : 'Vender'} ${getBase(selectedPair)} (Demo)`}\n          </button>\n        </div>\n\n        {/* Open positions */}\n        <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4\">\n          <h3 className=\"text-sm font-bold mb-3\">Posiciones Abiertas ({state.positions.length})</h3>\n          {state.positions.length === 0 ? (\n            <p className=\"text-sm text-[var(--text-dim)] text-center py-8\">Sin posiciones abiertas</p>\n          ) : (\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n              {state.positions.map(pos => (\n                <div key={pos.id} className=\"bg-[var(--dark-3)] rounded-xl p-3\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${pos.side === 'buy' ? 'bg-[var(--green)]/20 text-[var(--green)]' : 'bg-[var(--red)]/20 text-[var(--red)]'}`}>\n                        {pos.side.toUpperCase()}\n                      </span>\n                      <span className=\"text-sm font-bold\">{pos.symbol}</span>\n                    </div>\n                    <button\n                      onClick={() => handleClose(pos.id)}\n                      className=\"px-2 py-0.5 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors\"\n                    >\n                      Cerrar\n                    </button>\n                  </div>\n                  <div className=\"grid grid-cols-3 gap-2 text-[10px]\">\n                    <div>\n                      <span className=\"text-[var(--text-dim)]\">Entrada</span>\n                      <p className=\"font-mono\">${pos.entryPrice?.toFixed(2)}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-[var(--text-dim)]\">Actual</span>\n                      <p className=\"font-mono\">${pos.currentPrice?.toFixed(2)}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-[var(--text-dim)]\">P&L</span>\n                      <p className={`font-mono font-bold ${pos.pnl >= 0 ? 'text-[var(--green)]' : 'text-[var(--red)]'}`}>\n                        {pos.pnl >= 0 ? '+' : ''}${pos.pnl?.toFixed(2)} ({pos.pnlPercent?.toFixed(1)}%)\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Closed trades history */}\n      {state.closedTrades.length > 0 && (\n        <div className=\"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden\">\n          <div className=\"p-3 border-b border-[var(--border)]\">\n            <h3 className=\"text-sm font-bold\">Historial de Trades (Demo)</h3>\n          </div>\n          <div className=\"max-h-64 overflow-y-auto\">\n            <table className=\"w-full text-xs\">\n              <thead>\n                <tr className=\"text-[var(--text-dim)] border-b border-[var(--border)]\">\n                  <th className=\"text-left p-2\">Par</th>\n                  <th className=\"text-left p-2\">Lado</th>\n                  <th className=\"text-right p-2\">Entrada</th>\n                  <th className=\"text-right p-2\">Salida</th>\n                  <th className=\"text-right p-2\">P&L</th>\n                </tr>\n              </thead>\n              <tbody>\n                {state.closedTrades.slice().reverse().map(t => (\n                  <tr key={t.id} className=\"border-b border-[var(--border)]/50 hover:bg-[var(--dark-3)]\">\n                    <td className=\"p-2 font-bold\">{t.symbol}</td>\n                    <td className=\"p-2\">\n                      <span className={t.side === 'buy' ? 'text-[var(--green)]' : 'text-[var(--red)]'}>\n                        {t.side.toUpperCase()}\n                      </span>\n                    </td>\n                    <td className=\"p-2 text-right font-mono\">${t.entryPrice?.toFixed(2)}</td>\n                    <td className=\"p-2 text-right font-mono\">${t.exitPrice?.toFixed(2)}</td>\n                    <td className={`p-2 text-right font-mono font-bold ${t.pnl >= 0 ? 'text-[var(--green)]' : 'text-[var(--red)]'}`}>\n                      {t.pnl >= 0 ? '+' : ''}${t.pnl?.toFixed(2)}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n\n      {/* Demo disclaimer */}\n      <div className=\"text-center text-xs text-[var(--text-dim)] pb-4\">\n        <p>⚠️ Esto es un simulador con datos reales del mercado. No se usa dinero real.</p>\n        <p className=\"text-[var(--gold)] mt-1\">Practica tus estrategias sin riesgo.</p>\n      </div>\n    </div>\n  );\n}\n"],"names":["STORAGE_KEY","TradingSimulator","saved","startingBalance","symbol","side","quantity","options","price","marketData","cost","position","openFee","feeService","positionId","idx","p","pos","exitPrice","rawPnl","pnl","closeFee","pnlPercent","closedTrade","targetPrice","currentPrice","order","orderId","o","totalEquity","s","peakEquity","e","grossProfit","t","grossLoss","returnPct","simulator","EquityCurve","data","height","canvasRef","useRef","useEffect","canvas","ctx","dpr","w","h","values","minV","maxV","range","pad","cw","ch","px","i","py","v","startVal","endVal","isPositive","lineColor","grad","baseY","lastX","lastY","jsx","SimulatorScreen","selectedPair","setPage","useStore","state","setState","useState","perf","setPerf","form","setForm","loading","setLoading","msg","setMsg","interval","updated","refresh","useCallback","handleTrade","result","err","handleClose","posId","handleReset","jsxs","Play","RotateCcw","AnimatePresence","motion","_a","DollarSign","_b","BarChart3","TrendingUp","TrendingDown","Award","Target","Icon","_c","formatPair","_d","Shield","getBase"],"mappings":"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"}