{"version":3,"file":"indicators-DJQYQkcq.js","sources":["../../src/services/indicators.js"],"sourcesContent":["// Kairos Trade — Technical Indicators Engine\n// All calculations are local — no external API needed\n\nexport function calculateEMA(data, period) {\n  const k = 2 / (period + 1);\n  const ema = [data[0]];\n  for (let i = 1; i < data.length; i++) {\n    ema.push(data[i] * k + ema[i - 1] * (1 - k));\n  }\n  return ema;\n}\n\nexport function calculateSMA(data, period) {\n  const sma = [];\n  for (let i = 0; i < data.length; i++) {\n    if (i < period - 1) { sma.push(null); continue; }\n    const slice = data.slice(i - period + 1, i + 1);\n    sma.push(slice.reduce((a, b) => a + b, 0) / period);\n  }\n  return sma;\n}\n\nexport function calculateRSI(closes, period = 14) {\n  const rsi = new Array(period).fill(null);\n  let avgGain = 0, avgLoss = 0;\n\n  for (let i = 1; i <= period; i++) {\n    const change = closes[i] - closes[i - 1];\n    if (change > 0) avgGain += change;\n    else avgLoss += Math.abs(change);\n  }\n  avgGain /= period;\n  avgLoss /= period;\n\n  rsi.push(avgLoss === 0 ? 100 : 100 - (100 / (1 + avgGain / avgLoss)));\n\n  for (let i = period + 1; i < closes.length; i++) {\n    const change = closes[i] - closes[i - 1];\n    avgGain = (avgGain * (period - 1) + (change > 0 ? change : 0)) / period;\n    avgLoss = (avgLoss * (period - 1) + (change < 0 ? Math.abs(change) : 0)) / period;\n    rsi.push(avgLoss === 0 ? 100 : 100 - (100 / (1 + avgGain / avgLoss)));\n  }\n  return rsi;\n}\n\nexport function calculateMACD(closes, fast = 12, slow = 26, signal = 9) {\n  const emaFast = calculateEMA(closes, fast);\n  const emaSlow = calculateEMA(closes, slow);\n  const macdLine = emaFast.map((v, i) => v - emaSlow[i]);\n  const signalLine = calculateEMA(macdLine, signal);\n  const histogram = macdLine.map((v, i) => v - signalLine[i]);\n  return { macd: macdLine, signal: signalLine, histogram };\n}\n\nexport function calculateBollingerBands(closes, period = 20, stdDev = 2) {\n  const sma = calculateSMA(closes, period);\n  const upper = [], lower = [];\n\n  for (let i = 0; i < closes.length; i++) {\n    if (i < period - 1) { upper.push(null); lower.push(null); continue; }\n    const slice = closes.slice(i - period + 1, i + 1);\n    const mean = sma[i];\n    const variance = slice.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / period;\n    const sd = Math.sqrt(variance) * stdDev;\n    upper.push(mean + sd);\n    lower.push(mean - sd);\n  }\n  return { upper, middle: sma, lower };\n}\n\nexport function calculateVWAP(candles) {\n  let cumVol = 0, cumTP = 0;\n  return candles.map(c => {\n    const tp = (c.high + c.low + c.close) / 3;\n    cumTP += tp * c.volume;\n    cumVol += c.volume;\n    return cumVol > 0 ? cumTP / cumVol : tp;\n  });\n}\n\n// ─── Signal detection ───\nexport function detectCrossover(line1, line2, index) {\n  if (index < 1) return null;\n  const prev1 = line1[index - 1], curr1 = line1[index];\n  const prev2 = line2[index - 1], curr2 = line2[index];\n  if (prev1 <= prev2 && curr1 > curr2) return 'bullish_cross';\n  if (prev1 >= prev2 && curr1 < curr2) return 'bearish_cross';\n  return null;\n}\n\nexport function detectDivergence(prices, indicator, lookback = 14) {\n  if (prices.length < lookback * 2) return null;\n  const len = prices.length;\n  const recentPriceHigh = Math.max(...prices.slice(len - lookback));\n  const prevPriceHigh = Math.max(...prices.slice(len - lookback * 2, len - lookback));\n  const recentIndHigh = Math.max(...indicator.slice(len - lookback).filter(v => v !== null));\n  const prevIndHigh = Math.max(...indicator.slice(len - lookback * 2, len - lookback).filter(v => v !== null));\n\n  if (recentPriceHigh > prevPriceHigh && recentIndHigh < prevIndHigh) return 'bearish_divergence';\n  if (recentPriceHigh < prevPriceHigh && recentIndHigh > prevIndHigh) return 'bullish_divergence';\n  return null;\n}\n"],"names":["calculateEMA","data","period","k","ema","i","calculateSMA","sma","slice","a","b","calculateRSI","closes","rsi","avgGain","avgLoss","change","calculateMACD","fast","slow","signal","emaFast","emaSlow","macdLine","v","signalLine","histogram","calculateBollingerBands","stdDev","upper","lower","mean","variance","sum","val","sd","calculateVWAP","candles","cumVol","cumTP","c","tp","detectCrossover","line1","line2","index","prev1","curr1","prev2","curr2","detectDivergence","prices","indicator","lookback","len","recentPriceHigh","prevPriceHigh","recentIndHigh","prevIndHigh"],"mappings":"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"}