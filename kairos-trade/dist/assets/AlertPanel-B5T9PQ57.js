import{j as e,m as h,g as y,a4 as $,k as P,T as b,o as u,A as T,Z as _,t as D,a8 as I,ac as j}from"./ui-BpW-uvdI.js";import{a as m}from"./vendor-CUCP814w.js";import{u as E,c as z}from"./index-CXTbE7Aj.js";import{m as N}from"./marketData-K1zKCjjj.js";import{e as M,g as S,d as k,c as w}from"./indicators-DJQYQkcq.js";const A="kairos_trade_alerts";class R{constructor(){this.alerts=this._load(),this.triggered=[],this.monitoring=!1,this.interval=null,this.callbacks=new Set}_load(){try{return JSON.parse(localStorage.getItem(A))||[]}catch{return[]}}_save(){localStorage.setItem(A,JSON.stringify(this.alerts))}subscribe(n){return this.callbacks.add(n),()=>this.callbacks.delete(n)}_notify(n){this.callbacks.forEach(a=>a(n)),Notification.permission==="granted"&&new Notification(`Kairos Trade â€” ${n.symbol}`,{body:n.message,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%23D4AF37"/><text x="50" y="70" font-size="60" text-anchor="middle" fill="%230A0A0F" font-family="serif" font-weight="bold">K</text></svg>'})}async requestPermission(){Notification.permission!=="granted"&&await Notification.requestPermission()}addPriceAlert(n,a,i,o={}){const l={id:Date.now().toString(36),type:"price",symbol:n,condition:a,targetPrice:parseFloat(i),active:!0,repeat:o.repeat||!1,message:`${n} ${a==="above"?">":"<"} $${i}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}addSignalAlert(n,a,i={}){const o={ema_cross:`EMA ${i.fast||20}/${i.slow||50} Cross`,rsi_oversold:`RSI < ${i.threshold||30}`,rsi_overbought:`RSI > ${i.threshold||70}`,macd_cross:"MACD Signal Cross",volume_spike:`Volume Spike > ${i.multiplier||2}x avg`},l={id:Date.now().toString(36),type:"signal",symbol:n,signalType:a,params:i,active:!0,repeat:i.repeat||!1,message:`${n}: ${o[a]||a}`,createdAt:new Date().toISOString()};return this.alerts.push(l),this._save(),this._ensureMonitoring(),l}removeAlert(n){this.alerts=this.alerts.filter(a=>a.id!==n),this._save()}getAlerts(){return this.alerts}getTriggered(){return this.triggered}_ensureMonitoring(){this.monitoring||(this.monitoring=!0,this.interval=setInterval(()=>this._check(),15e3),this._check())}stop(){this.monitoring=!1,this.interval&&clearInterval(this.interval)}async _check(){const n=this.alerts.filter(i=>i.active);if(n.length===0)return;const a={};n.forEach(i=>{a[i.symbol]||(a[i.symbol]=[]),a[i.symbol].push(i)});for(const[i,o]of Object.entries(a))try{const l=await N.getPrice(i);for(const s of o){let r=!1;s.type==="price"&&(s.condition==="above"&&l>=s.targetPrice&&(r=!0),s.condition==="below"&&l<=s.targetPrice&&(r=!0)),s.type==="signal"&&(r=await this._checkSignal(i,s)),r&&(s.triggeredAt=new Date().toISOString(),s.triggeredPrice=l,this.triggered.push({...s}),this._notify({...s,currentPrice:l,message:`ðŸ”” ${s.message} â€” Precio actual: $${l.toLocaleString()}`}),s.repeat||(s.active=!1))}}catch{}this._save()}async _checkSignal(n,a){try{const i=await N.getCandles(n,"1h",60),o=i.map(s=>s.close),l=o.length;switch(a.signalType){case"ema_cross":{const s=w(o,a.params.fast||20),r=w(o,a.params.slow||50);return S(s,r,l-1)!==null}case"rsi_oversold":return k(o,a.params.period||14)[l-1]<(a.params.threshold||30);case"rsi_overbought":return k(o,a.params.period||14)[l-1]>(a.params.threshold||70);case"macd_cross":{const{macd:s,signal:r}=M(o);return S(s,r,l-1)!==null}case"volume_spike":{const s=i.map(c=>c.volume),r=s.slice(-20).reduce((c,v)=>c+v,0)/20;return s[l-1]>r*(a.params.multiplier||2)}default:return!1}}catch{return!1}}}const d=new R,B=[{id:"ema_cross",label:"EMA Cruce",desc:"EMA 20/50 crossover",icon:T},{id:"rsi_oversold",label:"RSI Sobreventa",desc:"RSI < 30",icon:u},{id:"rsi_overbought",label:"RSI Sobrecompra",desc:"RSI > 70",icon:b},{id:"macd_cross",label:"MACD Cruce",desc:"MACD/Signal crossover",icon:_},{id:"volume_spike",label:"Spike Volumen",desc:"Volumen > 2x promedio",icon:D}];function K(){const{selectedPair:p}=E(),[n,a]=m.useState([]),[i,o]=m.useState([]),[l,s]=m.useState("active"),[r,c]=m.useState({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1});m.useEffect(()=>{a(d.getAlerts()),o(d.getTriggered());const t=d.subscribe(()=>{a([...d.getAlerts()]),o([...d.getTriggered()])});return d.requestPermission(),t},[]);const v=()=>{if(r.type==="price"){if(!r.price)return;d.addPriceAlert(p,r.condition,r.price,{repeat:r.repeat})}else d.addSignalAlert(p,r.signalType,{repeat:r.repeat});a([...d.getAlerts()]),c({type:"price",condition:"above",price:"",signalType:"ema_cross",repeat:!1}),s("active")},C=t=>{d.removeAlert(t),a([...d.getAlerts()])},g=n.filter(t=>t.active);return n.filter(t=>!t.active),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-5 space-y-5",children:[e.jsxs(h.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(y,{size:18,className:"text-[var(--gold)] shrink-0"}),"Alertas"]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-0.5",children:[g.length," alerta",g.length!==1?"s":""," activa",g.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>s("create"),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-semibold text-white transition-all hover:opacity-90 shrink-0",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)"},children:[e.jsx($,{size:14}),"Nueva Alerta"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"rgba(24,26,32,0.8)",border:"1px solid rgba(30,34,45,0.5)"},children:[{id:"active",label:`Activas (${g.length})`},{id:"triggered",label:`Disparadas (${i.length})`},{id:"create",label:"Crear"}].map(t=>e.jsx("button",{onClick:()=>s(t.id),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all duration-200
              ${l===t.id?"text-white":"text-[var(--text-dim)]"}`,style:l===t.id?{background:"linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.08))",border:"1px solid rgba(59,130,246,0.15)"}:{},children:t.label},t.id))}),e.jsx(P,{children:l==="create"&&e.jsxs(h.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-xl p-5 space-y-4",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsxs("h3",{className:"text-sm font-bold",children:["Crear Alerta para ",z(p)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c({...r,type:"price"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${r.type==="price"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"Precio"}),e.jsx("button",{onClick:()=>c({...r,type:"signal"}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all
                  ${r.type==="signal"?"bg-[var(--gold)]/15 text-[var(--gold)] border border-[var(--gold)]/20":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:"SeÃ±al TÃ©cnica"})]}),r.type==="price"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2",children:["above","below"].map(t=>e.jsxs("button",{onClick:()=>c({...r,condition:t}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all flex items-center justify-center gap-1.5
                        ${r.condition===t?t==="above"?"bg-[var(--green)]/10 text-[var(--green)] border border-[var(--green)]/15":"bg-[var(--red)]/10 text-[var(--red)] border border-[var(--red)]/15":"bg-[var(--dark-3)] text-[var(--text-dim)] border border-transparent"}`,children:[t==="above"?e.jsx(b,{size:12}):e.jsx(u,{size:12}),t==="above"?"Sube a":"Baja a"]},t))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] text-[var(--text-dim)] mb-1.5 block font-medium",children:"Precio objetivo (USD)"}),e.jsx("input",{type:"number",value:r.price,onChange:t=>c({...r,price:t.target.value}),placeholder:"Ej: 100000",className:"w-full",step:"any"})]})]}):e.jsx("div",{className:"space-y-2",children:B.map(t=>{const x=t.icon;return e.jsxs("button",{onClick:()=>c({...r,signalType:t.id}),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left
                        ${r.signalType===t.id?"bg-[var(--gold)]/10 border border-[var(--gold)]/15":"bg-[var(--dark-3)] border border-transparent hover:border-[var(--border)]"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${r.signalType===t.id?"bg-[var(--gold)]/15":"bg-[var(--dark-4)]"}`,children:e.jsx(x,{size:14,className:r.signalType===t.id?"text-[var(--gold)]":"text-[var(--text-dim)]"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold",children:t.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:t.desc})]})]},t.id)})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("div",{className:`w-9 h-5 rounded-full transition-colors relative ${r.repeat?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,onClick:()=>c({...r,repeat:!r.repeat}),children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white transition-transform ${r.repeat?"translate-x-4":"translate-x-0.5"}`})}),e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Repetir alerta"})]}),e.jsx("button",{onClick:v,disabled:r.type==="price"&&!r.price,className:"w-full py-3 text-white font-bold rounded-xl text-sm transition-all disabled:opacity-40",style:{background:"linear-gradient(135deg, #3B82F6, #2563EB)",boxShadow:"0 4px 15px rgba(59,130,246,0.25)"},children:"Crear Alerta"})]})}),l==="active"&&e.jsx("div",{className:"space-y-2",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas activas"}),e.jsx("button",{onClick:()=>s("create"),className:"text-xs text-[var(--gold)] mt-2 font-semibold",children:"Crear primera alerta â†’"})]}):g.map((t,x)=>e.jsxs(h.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:x*.04},className:"flex items-center gap-3 p-3 rounded-xl group",style:{background:"linear-gradient(135deg, rgba(17,19,24,0.8), rgba(24,26,32,0.6))",border:"1px solid rgba(30,34,45,0.5)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg flex items-center justify-center shrink-0",style:{background:t.type==="price"?"rgba(59,130,246,0.08)":"rgba(139,92,246,0.08)"},children:t.type==="price"?t.condition==="above"?e.jsx(b,{size:16,className:"text-[var(--green)]"}):e.jsx(u,{size:16,className:"text-[var(--red)]"}):e.jsx(_,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:t.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:t.message})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.repeat&&e.jsx("span",{className:"text-[9px] font-bold text-[var(--gold)] bg-[var(--gold)]/10 px-1.5 py-0.5 rounded",children:"â†»"}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-[var(--green)] animate-pulse"}),e.jsx("button",{onClick:()=>C(t.id),className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/[0.06] transition-all opacity-0 group-hover:opacity-100",children:e.jsx(I,{size:13})})]})]},t.id))}),l==="triggered"&&e.jsx("div",{className:"space-y-2",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{size:40,className:"mx-auto text-[var(--text-dim)]/20 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"No hay alertas disparadas"})]}):[...i].reverse().map((t,x)=>{var f;return e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-3 p-3 rounded-xl",style:{background:"linear-gradient(135deg, rgba(14,203,129,0.04), rgba(17,19,24,0.6))",border:"1px solid rgba(14,203,129,0.08)"},children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-[var(--green)]/[0.08] flex items-center justify-center shrink-0",children:e.jsx(j,{size:16,className:"text-[var(--green)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-semibold truncate",children:t.symbol}),e.jsx("p",{className:"text-[11px] text-[var(--text-dim)] truncate",children:t.message})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono text-[var(--green)]",children:["$",(f=t.triggeredPrice)==null?void 0:f.toLocaleString()]}),e.jsx("p",{className:"text-[9px] text-[var(--text-dim)]",children:new Date(t.triggeredAt).toLocaleTimeString()})]})]},`${t.id}-${x}`)})})]})}export{K as default};
