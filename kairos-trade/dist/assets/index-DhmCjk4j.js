import{j as e,m as E,L as me,B as X,a as K,Z as U,b as W,c as R,H as pe,W as J,S as ue,d as he,C as ve,e as be,f as ge,g as fe,h as ce,A as te,D as je,i as se,k as ye,l as Ne,T as ke,n as Y,o as Se,P as Q,p as _,q as de,r as we,s as Ce,t as V,E as Ae,u as Pe,v as Te,X as Be,w as Ee,x as Ie,y as De,K as Fe,z as $e,F as Re}from"./ui-ml-YlnnC.js";import{b as Me,g as Oe,c as Le,a as g,R as ze,B as Ke}from"./vendor-CUCP814w.js";import{V as Ue,a as _e,I as qe}from"./charts-UjLl1g-4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var q={},ae;function He(){if(ae)return q;ae=1;var l=Me();return q.createRoot=l.createRoot,q.hydrateRoot=l.hydrateRoot,q}var We=He();const Ve=Oe(We),L={binance:{id:"binance",name:"Binance",logo:"üü°",baseUrl:"https://api.binance.com",wsUrl:"wss://stream.binance.com:9443/ws",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},bybit:{id:"bybit",name:"Bybit",logo:"üü†",baseUrl:"https://api.bybit.com",wsUrl:"wss://stream.bybit.com/v5/public/spot",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret"]},kraken:{id:"kraken",name:"Kraken",logo:"üü£",baseUrl:"https://api.kraken.com",wsUrl:"wss://ws.kraken.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret"]},coinbase:{id:"coinbase",name:"Coinbase",logo:"üîµ",baseUrl:"https://api.coinbase.com",wsUrl:"wss://ws-feed.exchange.coinbase.com",supportedMarkets:["spot"],requiredFields:["apiKey","apiSecret","passphrase"]},kucoin:{id:"kucoin",name:"KuCoin",logo:"üü¢",baseUrl:"https://api.kucoin.com",wsUrl:"wss://ws-api.kucoin.com",supportedMarkets:["spot","futures"],requiredFields:["apiKey","apiSecret","passphrase"]},okx:{id:"okx",name:"OKX",logo:"‚ö´",baseUrl:"https://www.okx.com",wsUrl:"wss://ws.okx.com:8443/ws/v5/public",supportedMarkets:["spot","futures","options"],requiredFields:["apiKey","apiSecret","passphrase"]}},Z=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT","DOGEUSDT","AVAXUSDT","DOTUSDT","MATICUSDT","LINKUSDT","ATOMUSDT","LTCUSDT","UNIUSDT","AAVEUSDT"],ee=[{label:"1m",value:"1m",seconds:60},{label:"5m",value:"5m",seconds:300},{label:"15m",value:"15m",seconds:900},{label:"1H",value:"1h",seconds:3600},{label:"4H",value:"4h",seconds:14400},{label:"1D",value:"1d",seconds:86400},{label:"1W",value:"1w",seconds:604800}],A={AUTH:"kairos_trade_auth",BROKERS:"kairos_trade_brokers",BOTS:"kairos_trade_bots",SETTINGS:"kairos_trade_settings",STRATEGIES:"kairos_trade_strategies"},O=(l,s)=>{try{return JSON.parse(localStorage.getItem(l))||s}catch{return s}},$=(l,s)=>localStorage.setItem(l,JSON.stringify(s)),B=Le((l,s)=>({user:O(A.AUTH,null),isAuthenticated:!!O(A.AUTH,null),login:t=>{$(A.AUTH,t),l({user:t,isAuthenticated:!0})},logout:()=>{localStorage.removeItem(A.AUTH),l({user:null,isAuthenticated:!1})},currentPage:"dashboard",setPage:t=>l({currentPage:t}),brokers:O(A.BROKERS,[]),activeBroker:null,addBroker:t=>{const a={...t,id:Date.now().toString(36),apiKey:btoa(t.apiKey),apiSecret:btoa(t.apiSecret),passphrase:t.passphrase?btoa(t.passphrase):void 0,connected:!1,addedAt:new Date().toISOString()},r=[...s().brokers,a];return $(A.BROKERS,r),l({brokers:r}),a},removeBroker:t=>{var r;const a=s().brokers.filter(n=>n.id!==t);$(A.BROKERS,a),l({brokers:a,activeBroker:((r=s().activeBroker)==null?void 0:r.id)===t?null:s().activeBroker})},setActiveBroker:t=>l({activeBroker:t}),updateBrokerStatus:(t,a)=>{const r=s().brokers.map(n=>n.id===t?{...n,connected:a}:n);$(A.BROKERS,r),l({brokers:r})},bots:O(A.BOTS,[]),addBot:t=>{const a={...t,id:Date.now().toString(36),status:"stopped",trades:0,pnl:0,winRate:0,createdAt:new Date().toISOString()},r=[...s().bots,a];return $(A.BOTS,r),l({bots:r}),a},updateBot:(t,a)=>{const r=s().bots.map(n=>n.id===t?{...n,...a}:n);$(A.BOTS,r),l({bots:r})},removeBot:t=>{const a=s().bots.filter(r=>r.id!==t);$(A.BOTS,a),l({bots:a})},selectedPair:"BTCUSDT",selectedTimeframe:"1h",currentPrice:null,priceChange24h:null,orderBook:{bids:[],asks:[]},positions:[],orders:[],tradeHistory:[],setSelectedPair:t=>l({selectedPair:t}),setSelectedTimeframe:t=>l({selectedTimeframe:t}),setCurrentPrice:t=>l({currentPrice:t}),setPriceChange24h:t=>l({priceChange24h:t}),setOrderBook:t=>l({orderBook:t}),addPosition:t=>l({positions:[...s().positions,{...t,id:Date.now().toString(36)}]}),closePosition:t=>{const a=s().positions.find(r=>r.id===t);a&&l({positions:s().positions.filter(r=>r.id!==t),tradeHistory:[...s().tradeHistory,{...a,closedAt:new Date().toISOString()}]})},addOrder:t=>l({orders:[...s().orders,{...t,id:Date.now().toString(36)}]}),cancelOrder:t=>l({orders:s().orders.filter(a=>a.id!==t)}),strategies:O(A.STRATEGIES,[]),addStrategy:t=>{const a={...t,id:Date.now().toString(36),createdAt:new Date().toISOString()},r=[...s().strategies,a];return $(A.STRATEGIES,r),l({strategies:r}),a},removeStrategy:t=>{const a=s().strategies.filter(r=>r.id!==t);$(A.STRATEGIES,a),l({strategies:a})},aiMessages:[],aiLoading:!1,addAiMessage:t=>l({aiMessages:[...s().aiMessages,t]}),setAiLoading:t=>l({aiLoading:t}),clearAiMessages:()=>l({aiMessages:[]}),settings:O(A.SETTINGS,{theme:"dark",language:"es",notifications:!0,soundAlerts:!0,maxRiskPerTrade:2,defaultLeverage:1}),updateSettings:t=>{const a={...s().settings,...t};$(A.SETTINGS,a),l({settings:a})},sidebarOpen:!0,aiPanelOpen:!1,modalOpen:null,toggleSidebar:()=>l({sidebarOpen:!s().sidebarOpen}),toggleAiPanel:()=>l({aiPanelOpen:!s().aiPanelOpen}),setModal:t=>l({modalOpen:t})})),Ge=[{id:"dashboard",icon:me,label:"Dashboard"},{id:"chart",icon:X,label:"Trading Chart"},{id:"bots",icon:K,label:"Bots"},{id:"strategies",icon:U,label:"Estrategias"},{id:"brokers",icon:W,label:"Brokers"},{id:"ai",icon:R,label:"Kairos AI"},{id:"history",icon:pe,label:"Historial"},{id:"wallet",icon:J,label:"Wallet"},{id:"settings",icon:ue,label:"Ajustes"}];function Je(){const{currentPage:l,setPage:s,sidebarOpen:t,toggleSidebar:a,bots:r,brokers:n,logout:i}=B(),d=r.filter(x=>x.status==="active").length,m=n.filter(x=>x.connected).length;return e.jsxs(E.aside,{animate:{width:t?220:64},transition:{duration:.2},className:"h-full flex flex-col border-r border-[var(--border)] bg-[var(--dark-2)] relative",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-[var(--border)]",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)] flex items-center justify-center text-black font-bold text-sm shrink-0",children:"K"}),t&&e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"KAIROS"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] -mt-0.5",children:"TRADE"})]})]}),e.jsx("nav",{className:"flex-1 py-2 overflow-y-auto",children:Ge.map(x=>{const o=x.icon,b=l===x.id,v=x.id==="bots"?d:x.id==="brokers"?m:0;return e.jsxs("button",{onClick:()=>s(x.id),className:`w-full flex items-center gap-3 px-4 py-2.5 text-sm transition-all relative
                ${b?"text-[var(--gold)] bg-[var(--gold)]/10 border-r-2 border-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--text)] hover:bg-[var(--dark-3)]"}`,children:[e.jsx(o,{size:18,className:"shrink-0"}),t&&e.jsx("span",{className:"truncate",children:x.label}),v>0&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 bg-[var(--gold)] text-black text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:v})]},x.id)})}),e.jsx("div",{className:"border-t border-[var(--border)] p-2",children:e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-[var(--text-dim)] hover:text-[var(--red)] transition-colors rounded-lg",children:[e.jsx(he,{size:18}),t&&e.jsx("span",{children:"Salir"})]})}),e.jsx("button",{onClick:a,className:"absolute -right-3 top-8 w-6 h-6 bg-[var(--dark-3)] border border-[var(--border)] rounded-full flex items-center justify-center text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors",children:t?e.jsx(ve,{size:12}):e.jsx(be,{size:12})})]})}function Xe(){const{selectedPair:l,currentPrice:s,priceChange24h:t,toggleAiPanel:a,aiPanelOpen:r,brokers:n}=B(),i=n.some(d=>d.connected);return e.jsxs("header",{className:"h-12 border-b border-[var(--border)] bg-[var(--dark-2)] flex items-center justify-between px-4 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--text)]",children:l}),s&&e.jsxs("span",{className:"text-sm font-mono text-[var(--gold)]",children:["$",s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),t!==null&&e.jsxs("span",{className:`text-xs font-mono ${t>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[t>=0?"+":"",t==null?void 0:t.toFixed(2),"%"]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`flex items-center gap-1 text-xs ${i?"text-[var(--green)]":"text-[var(--text-dim)]"}`,children:[i?e.jsx(ge,{size:14}):e.jsx(fe,{size:14}),i?"Conectado":"Sin broker"]}),e.jsx("button",{onClick:a,className:`p-1.5 rounded-lg transition-colors ${r?"bg-[var(--gold)]/20 text-[var(--gold)]":"text-[var(--text-dim)] hover:text-[var(--gold)]"}`,title:"Kairos AI",children:e.jsx(R,{size:18})}),e.jsxs("button",{className:"p-1.5 rounded-lg text-[var(--text-dim)] hover:text-[var(--text)] transition-colors relative",children:[e.jsx(ce,{size:18}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-[var(--gold)] rounded-full"})]})]})]})}function Ye(){const{login:l}=B(),[s,t]=g.useState(!0),[a,r]=g.useState({email:"",password:"",name:""}),[n,i]=g.useState(""),[d,m]=g.useState(!1),x=async o=>{if(o.preventDefault(),i(""),!a.email||!a.password){i("Completa todos los campos");return}if(!s&&!a.name){i("Ingresa tu nombre");return}m(!0),setTimeout(()=>{l({id:Date.now().toString(36),email:a.email,name:a.name||a.email.split("@")[0],plan:"free",createdAt:new Date().toISOString()}),m(!1)},800)};return e.jsx("div",{className:"min-h-screen bg-[var(--dark)] flex items-center justify-center p-4",children:e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)] flex items-center justify-center text-black font-bold text-2xl mx-auto mb-4",children:"K"}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--gold)]",style:{fontFamily:"Playfair Display, serif"},children:"KAIROS TRADE"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-1",children:"Trading automatizado con inteligencia artificial"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-2xl p-6",children:[e.jsxs("div",{className:"flex mb-6 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>t(!0),className:`flex-1 py-2 text-sm rounded-md transition-all ${s?"bg-[var(--gold)] text-black font-bold":"text-[var(--text-dim)]"}`,children:"Iniciar Sesi√≥n"}),e.jsx("button",{onClick:()=>t(!1),className:`flex-1 py-2 text-sm rounded-md transition-all ${s?"text-[var(--text-dim)]":"bg-[var(--gold)] text-black font-bold"}`,children:"Registrarse"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[!s&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Nombre"}),e.jsx("input",{type:"text",value:a.name,onChange:o=>r({...a,name:o.target.value}),placeholder:"Tu nombre",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:o=>r({...a,email:o.target.value}),placeholder:"tu@email.com",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Contrase√±a"}),e.jsx("input",{type:"password",value:a.password,onChange:o=>r({...a,password:o.target.value}),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",className:"w-full"})]}),n&&e.jsx("p",{className:"text-xs text-[var(--red)]",children:n}),e.jsx("button",{type:"submit",disabled:d,className:"w-full py-3 bg-[var(--gold)] text-black font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:d?"Cargando...":s?"Entrar":"Crear Cuenta"})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] text-center mt-4",children:["Parte del ecosistema ",e.jsx("span",{className:"text-[var(--gold)]",children:"Kairos 777"})]})]})]})})}class Qe{constructor(){this.ws=null,this.subscribers=new Map,this.reconnectAttempts=0,this.maxReconnect=5,this.candleCache=new Map}connectStream(s,t={}){const a=s.toLowerCase(),r=`wss://stream.binance.com:9443/ws/${a}@ticker/${a}@kline_1m`;return this.ws&&this.ws.close(),this.ws=new WebSocket(r),this.ws.onopen=()=>{var n;this.reconnectAttempts=0,(n=t.onConnect)==null||n.call(t)},this.ws.onmessage=n=>{var i,d;try{const m=JSON.parse(n.data);if(m.e==="24hrTicker"&&((i=t.onTicker)==null||i.call(t,{symbol:m.s,price:parseFloat(m.c),change:parseFloat(m.p),changePercent:parseFloat(m.P),high:parseFloat(m.h),low:parseFloat(m.l),volume:parseFloat(m.v),quoteVolume:parseFloat(m.q)})),m.e==="kline"){const x=m.k;(d=t.onCandle)==null||d.call(t,{time:Math.floor(x.t/1e3),open:parseFloat(x.o),high:parseFloat(x.h),low:parseFloat(x.l),close:parseFloat(x.c),volume:parseFloat(x.v),closed:x.x})}}catch(m){console.error("WS parse error:",m)}},this.ws.onerror=n=>{var i;console.error("WS error:",n),(i=t.onError)==null||i.call(t,n)},this.ws.onclose=()=>{var n;this.reconnectAttempts<this.maxReconnect&&(this.reconnectAttempts++,setTimeout(()=>this.connectStream(s,t),2e3*this.reconnectAttempts)),(n=t.onDisconnect)==null||n.call(t)},()=>this.disconnect()}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}async getCandles(s,t="1h",a=500){const r=`${s}_${t}`;try{const n=`https://api.binance.com/api/v3/klines?symbol=${s}&interval=${t}&limit=${a}`,i=await fetch(n);if(!i.ok)throw new Error(`HTTP ${i.status}`);const m=(await i.json()).map(x=>({time:Math.floor(x[0]/1e3),open:parseFloat(x[1]),high:parseFloat(x[2]),low:parseFloat(x[3]),close:parseFloat(x[4]),volume:parseFloat(x[5])}));return this.candleCache.set(r,{data:m,ts:Date.now()}),m}catch(n){const i=this.candleCache.get(r);if(i)return i.data;throw n}}async getPrice(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${s}`)).json();return parseFloat(a.price)}async get24hrTicker(s){const a=await(await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${s}`)).json();return{symbol:a.symbol,price:parseFloat(a.lastPrice),change:parseFloat(a.priceChange),changePercent:parseFloat(a.priceChangePercent),high:parseFloat(a.highPrice),low:parseFloat(a.lowPrice),volume:parseFloat(a.volume),quoteVolume:parseFloat(a.quoteVolume)}}async getOrderBook(s,t=20){const r=await(await fetch(`https://api.binance.com/api/v3/depth?symbol=${s}&limit=${t}`)).json();return{bids:r.bids.map(([n,i])=>({price:parseFloat(n),quantity:parseFloat(i)})),asks:r.asks.map(([n,i])=>({price:parseFloat(n),quantity:parseFloat(i)}))}}async searchSymbols(s){const a=await(await fetch("https://api.binance.com/api/v3/exchangeInfo")).json(),r=s.toUpperCase();return a.symbols.filter(n=>n.status==="TRADING"&&(n.symbol.includes(r)||n.baseAsset.includes(r))).slice(0,20).map(n=>({symbol:n.symbol,base:n.baseAsset,quote:n.quoteAsset}))}}const z=new Qe;function re(){const{setPage:l,bots:s,brokers:t,tradeHistory:a,positions:r}=B(),[n,i]=g.useState([]),[d,m]=g.useState(!0);g.useEffect(()=>{x();const p=setInterval(x,3e4);return()=>clearInterval(p)},[]);const x=async()=>{try{const p=["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT"],y=await Promise.all(p.map(async j=>{try{return await z.get24hrTicker(j)}catch{return null}}));i(y.filter(Boolean))}catch(p){console.error("Dashboard load error:",p)}m(!1)},o=s.filter(p=>p.status==="active"),b=a.reduce((p,y)=>p+(y.pnl||0),0),v=t.filter(p=>p.connected),w=[{label:"Bots Activos",value:o.length,icon:K,color:"var(--gold)",action:"bots"},{label:"Brokers",value:`${v.length}/${t.length}`,icon:W,color:"var(--blue)",action:"brokers"},{label:"Posiciones",value:r.length,icon:te,color:"var(--green)",action:"history"},{label:"P&L Total",value:`${b>=0?"+":""}$${b.toFixed(2)}`,icon:je,color:b>=0?"var(--green)":"var(--red)",action:"history"}];return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",style:{fontFamily:"Playfair Display, serif"},children:[e.jsx("span",{className:"text-[var(--gold)]",children:"Kairos"})," Trade"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Tu centro de control de trading automatizado"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:w.map((p,y)=>{const j=p.icon;return e.jsxs(E.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:y*.05},onClick:()=>l(p.action),className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 text-left hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(j,{size:20,style:{color:p.color}}),e.jsx(se,{size:14,className:"text-[var(--text-dim)]"})]}),e.jsx("p",{className:"text-2xl font-bold",style:{color:p.color},children:p.value}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:p.label})]},p.label)})}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{label:"Abrir Gr√°fico",icon:X,page:"chart",desc:"Trading chart profesional"},{label:"Crear Bot",icon:K,page:"bots",desc:"Automatiza tu trading"},{label:"Kairos AI",icon:R,page:"ai",desc:"Asistente inteligente"},{label:"Conectar Broker",icon:W,page:"brokers",desc:"Vincula tu cuenta"},{label:"Estrategias",icon:U,page:"strategies",desc:"Crea y gestiona"},{label:"Historial",icon:te,page:"history",desc:"Trades y rendimiento"}].map((p,y)=>{const j=p.icon;return e.jsxs(E.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2+y*.05},onClick:()=>l(p.page),className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 text-left hover:border-[var(--gold)]/30 transition-all group",children:[e.jsx(j,{size:24,className:"text-[var(--gold)] mb-2 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"text-sm font-bold",children:p.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:p.desc})]},p.label)})}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[var(--border)]",children:[e.jsx("h2",{className:"text-sm font-bold",children:"Mercado en Tiempo Real"}),e.jsx("button",{onClick:()=>l("chart"),className:"text-xs text-[var(--gold)] hover:underline",children:"Ver gr√°fico ‚Üí"})]}),e.jsx("div",{className:"divide-y divide-[var(--border)]",children:d?e.jsx("div",{className:"p-8 text-center text-sm text-[var(--text-dim)] animate-pulse",children:"Cargando mercado..."}):n.map(p=>e.jsxs("button",{onClick:()=>{B.getState().setSelectedPair(p.symbol),l("chart")},className:"w-full flex items-center justify-between p-3 hover:bg-[var(--dark-3)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--dark-4)] flex items-center justify-center text-xs font-bold",children:p.symbol.replace("USDT","").slice(0,3)}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-bold",children:p.symbol.replace("USDT","")}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:p.symbol})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-mono",children:["$",p.price.toLocaleString(void 0,{maximumFractionDigits:2})]}),e.jsxs("p",{className:`text-xs font-mono flex items-center gap-0.5 justify-end ${p.changePercent>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[p.changePercent>=0?e.jsx(se,{size:10}):e.jsx(ye,{size:10}),p.changePercent>=0?"+":"",p.changePercent.toFixed(2),"%"]})]})]},p.symbol))})]})]})}function M(l,s){const t=2/(s+1),a=[l[0]];for(let r=1;r<l.length;r++)a.push(l[r]*t+a[r-1]*(1-t));return a}function xe(l,s){const t=[];for(let a=0;a<l.length;a++){if(a<s-1){t.push(null);continue}const r=l.slice(a-s+1,a+1);t.push(r.reduce((n,i)=>n+i,0)/s)}return t}function ne(l,s=14){const t=new Array(s).fill(null);let a=0,r=0;for(let n=1;n<=s;n++){const i=l[n]-l[n-1];i>0?a+=i:r+=Math.abs(i)}a/=s,r/=s,t.push(r===0?100:100-100/(1+a/r));for(let n=s+1;n<l.length;n++){const i=l[n]-l[n-1];a=(a*(s-1)+(i>0?i:0))/s,r=(r*(s-1)+(i<0?Math.abs(i):0))/s,t.push(r===0?100:100-100/(1+a/r))}return t}function Ze(l,s=12,t=26,a=9){const r=M(l,s),n=M(l,t),i=r.map((x,o)=>x-n[o]),d=M(i,a),m=i.map((x,o)=>x-d[o]);return{macd:i,signal:d,histogram:m}}function et(l,s=20,t=2){const a=xe(l,s),r=[],n=[];for(let i=0;i<l.length;i++){if(i<s-1){r.push(null),n.push(null);continue}const d=l.slice(i-s+1,i+1),m=a[i],x=d.reduce((b,v)=>b+Math.pow(v-m,2),0)/s,o=Math.sqrt(x)*t;r.push(m+o),n.push(m-o)}return{upper:r,middle:a,lower:n}}function ie(l,s,t){if(t<1)return null;const a=l[t-1],r=l[t],n=s[t-1],i=s[t];return a<=n&&r>i?"bullish_cross":a>=n&&r<i?"bearish_cross":null}function tt(){const l=g.useRef(null),s=g.useRef(null),t=g.useRef(null),a=g.useRef(null),r=g.useRef([]),{selectedPair:n,selectedTimeframe:i,setSelectedPair:d,setSelectedTimeframe:m,setCurrentPrice:x,setPriceChange24h:o}=B(),[b,v]=g.useState(!0),[w,p]=g.useState(!1),[y,j]=g.useState(""),[k,C]=g.useState(["ema20"]);g.useEffect(()=>{if(!l.current)return;const h=Ue(l.current,{layout:{background:{type:qe.Solid,color:"#0A0A0F"},textColor:"#8888A0",fontFamily:"Inter, sans-serif",fontSize:11},grid:{vertLines:{color:"#1A1A25"},horzLines:{color:"#1A1A25"}},crosshair:{mode:_e.Normal,vertLine:{color:"#D4AF37",width:1,style:2},horzLine:{color:"#D4AF37",width:1,style:2}},timeScale:{borderColor:"#2A2A3A",timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:"#2A2A3A",scaleMargins:{top:.1,bottom:.25}},handleScroll:!0,handleScale:!0}),N=h.addCandlestickSeries({upColor:"#00C853",downColor:"#FF1744",borderUpColor:"#00C853",borderDownColor:"#FF1744",wickUpColor:"#00C853",wickDownColor:"#FF1744"}),I=h.addHistogramSeries({color:"#D4AF3733",priceFormat:{type:"volume"},priceScaleId:""});h.priceScale("").applyOptions({scaleMargins:{top:.8,bottom:0}}),s.current=h,t.current=N,a.current=I;const S=new ResizeObserver(P=>{const{width:T,height:D}=P[0].contentRect;h.applyOptions({width:T,height:D})});return S.observe(l.current),()=>{S.disconnect(),h.remove()}},[]);const c=g.useCallback(async()=>{var h;v(!0);try{const[N,I]=await Promise.all([z.getCandles(n,i,500),z.get24hrTicker(n)]);t.current&&t.current.setData(N),a.current&&a.current.setData(N.map(S=>({time:S.time,value:S.volume,color:S.close>=S.open?"#00C85333":"#FF174433"}))),x(I.price),o(I.changePercent),f(N),(h=s.current)==null||h.timeScale().fitContent()}catch(N){console.error("Load chart data error:",N)}v(!1)},[n,i]);g.useEffect(()=>(c(),z.connectStream(n,{onTicker:N=>{x(N.price),o(N.changePercent)},onCandle:N=>{t.current&&t.current.update(N),a.current&&a.current.update({time:N.time,value:N.volume,color:N.close>=N.open?"#00C85333":"#FF174433"})}})),[n,i,c]);const f=h=>{r.current.forEach(S=>{var P;try{(P=s.current)==null||P.removeSeries(S)}catch{}}),r.current=[];const N=h.map(S=>S.close),I=h.map(S=>S.time);k.forEach(S=>{if(S==="ema20"){const P=M(N,20),T=s.current.addLineSeries({color:"#D4AF37",lineWidth:1,title:"EMA 20"});T.setData(P.map((D,F)=>({time:I[F],value:D}))),r.current.push(T)}if(S==="ema50"){const P=M(N,50),T=s.current.addLineSeries({color:"#2196F3",lineWidth:1,title:"EMA 50"});T.setData(P.map((D,F)=>({time:I[F],value:D}))),r.current.push(T)}if(S==="sma200"){const P=xe(N,200),T=s.current.addLineSeries({color:"#FF6D00",lineWidth:1,title:"SMA 200"});T.setData(P.map((D,F)=>D!==null?{time:I[F],value:D}:null).filter(Boolean)),r.current.push(T)}if(S==="bb"){const P=et(N),T=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Upper"}),D=s.current.addLineSeries({color:"#9C27B0",lineWidth:1,lineStyle:2,title:"BB Lower"});T.setData(P.upper.map((F,G)=>F!==null?{time:I[G],value:F}:null).filter(Boolean)),D.setData(P.lower.map((F,G)=>F!==null?{time:I[G],value:F}:null).filter(Boolean)),r.current.push(T,D)}})},u=h=>{C(N=>N.includes(h)?N.filter(I=>I!==h):[...N,h])};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0 flex-wrap",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>p(!w),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--dark-3)] rounded-lg text-sm font-bold hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Ne,{size:14}),n]}),w&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl shadow-xl z-50 p-2",children:[e.jsx("input",{type:"text",value:y,onChange:h=>j(h.target.value.toUpperCase()),placeholder:"Buscar par...",className:"w-full text-sm mb-2",autoFocus:!0}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-0.5",children:Z.filter(h=>h.includes(y)).map(h=>e.jsx("button",{onClick:()=>{d(h),p(!1),j("")},className:`w-full text-left px-3 py-1.5 text-sm rounded-lg transition-colors
                        ${h===n?"bg-[var(--gold)]/20 text-[var(--gold)]":"text-[var(--text-dim)] hover:bg-[var(--dark-4)] hover:text-[var(--text)]"}`,children:h},h))})]})]}),e.jsx("div",{className:"flex items-center gap-0.5 bg-[var(--dark-3)] rounded-lg p-0.5",children:ee.map(h=>e.jsx("button",{onClick:()=>m(h.value),className:`px-2.5 py-1 text-xs rounded-md transition-colors
                ${i===h.value?"bg-[var(--gold)] text-black font-bold":"text-[var(--text-dim)] hover:text-[var(--text)]"}`,children:h.label},h.value))}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsxs("span",{className:"text-xs text-[var(--text-dim)] mr-1",children:[e.jsx(ke,{size:14,className:"inline"})," Indicadores:"]}),[{id:"ema20",label:"EMA 20",color:"#D4AF37"},{id:"ema50",label:"EMA 50",color:"#2196F3"},{id:"sma200",label:"SMA 200",color:"#FF6D00"},{id:"bb",label:"BB",color:"#9C27B0"}].map(h=>e.jsx("button",{onClick:()=>u(h.id),className:`px-2 py-0.5 text-xs rounded-md border transition-colors
                ${k.includes(h.id)?"border-current text-current":"border-[var(--border)] text-[var(--text-dim)] hover:text-[var(--text)]"}`,style:k.includes(h.id)?{color:h.color}:{},children:h.label},h.id))]})]}),e.jsx("div",{ref:l,className:"flex-1 relative",children:b&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[var(--dark)]/80 z-10",children:e.jsx("div",{className:"text-sm text-[var(--gold)] animate-pulse",children:"Cargando gr√°fico..."})})})]})}function st(){const{selectedPair:l,currentPrice:s,positions:t,orders:a,addPosition:r,addOrder:n,closePosition:i,cancelOrder:d}=B(),[m,x]=g.useState("buy"),[o,b]=g.useState("market"),[v,w]=g.useState({quantity:"",price:"",stopLoss:"",takeProfit:""}),[p,y]=g.useState({bids:[],asks:[]}),[j,k]=g.useState("order");g.useEffect(()=>{C();const u=setInterval(C,5e3);return()=>clearInterval(u)},[l]);const C=async()=>{try{const u=await z.getOrderBook(l,10);y(u)}catch{}},c=()=>{if(!v.quantity)return;const u=o==="market"?s:parseFloat(v.price);u&&(o==="market"?r({symbol:l,side:m,quantity:parseFloat(v.quantity),entryPrice:u,stopLoss:v.stopLoss?parseFloat(v.stopLoss):null,takeProfit:v.takeProfit?parseFloat(v.takeProfit):null,openedAt:new Date().toISOString()}):n({symbol:l,side:m,type:o,quantity:parseFloat(v.quantity),price:u,stopLoss:v.stopLoss?parseFloat(v.stopLoss):null,takeProfit:v.takeProfit?parseFloat(v.takeProfit):null,status:"open",createdAt:new Date().toISOString()}),w({quantity:"",price:"",stopLoss:"",takeProfit:""}))},f=parseFloat(v.quantity||0)*(o==="market"?s||0:parseFloat(v.price||0));return e.jsxs("div",{className:"flex flex-col h-full border-l border-[var(--border)] bg-[var(--dark-2)]",style:{width:320},children:[e.jsx("div",{className:"flex border-b border-[var(--border)] shrink-0",children:["order","positions","orders"].map(u=>e.jsx("button",{onClick:()=>k(u),className:`flex-1 py-2 text-xs font-bold transition-colors
              ${j===u?"text-[var(--gold)] border-b-2 border-[var(--gold)]":"text-[var(--text-dim)]"}`,children:u==="order"?"Orden":u==="positions"?`Pos (${t.length})`:`√ìrd (${a.length})`},u))}),j==="order"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x("buy"),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all
                ${m==="buy"?"bg-[var(--green)] text-white":"text-[var(--text-dim)]"}`,children:"Comprar"}),e.jsx("button",{onClick:()=>x("sell"),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all
                ${m==="sell"?"bg-[var(--red)] text-white":"text-[var(--text-dim)]"}`,children:"Vender"})]}),e.jsx("div",{className:"flex gap-1",children:["market","limit","stop_loss"].map(u=>e.jsx("button",{onClick:()=>b(u),className:`flex-1 py-1.5 text-xs rounded-md transition-colors
                  ${o===u?"bg-[var(--dark-4)] text-[var(--text)] font-bold":"text-[var(--text-dim)]"}`,children:u==="market"?"Market":u==="limit"?"Limit":"Stop"},u))}),o!=="market"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Precio"}),e.jsx("input",{type:"number",value:v.price,onChange:u=>w({...v,price:u.target.value}),placeholder:s==null?void 0:s.toString(),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Cantidad"}),e.jsx("input",{type:"number",value:v.quantity,onChange:u=>w({...v,quantity:u.target.value}),placeholder:"0.001",className:"w-full text-sm"}),e.jsx("div",{className:"flex gap-1 mt-1",children:["25%","50%","75%","100%"].map(u=>e.jsx("button",{className:"flex-1 py-1 text-[10px] bg-[var(--dark-3)] rounded text-[var(--text-dim)] hover:text-[var(--text)]",children:u},u))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(Y,{size:10})," Stop Loss"]}),e.jsx("input",{type:"number",value:v.stopLoss,onChange:u=>w({...v,stopLoss:u.target.value}),placeholder:"Precio",className:"w-full text-xs"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-[var(--text-dim)] mb-1 flex items-center gap-1",children:[e.jsx(Se,{size:10})," Take Profit"]}),e.jsx("input",{type:"number",value:v.takeProfit,onChange:u=>w({...v,takeProfit:u.target.value}),placeholder:"Precio",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Total"}),e.jsxs("span",{className:"text-sm font-mono font-bold",children:["$",f.toFixed(2)]})]}),e.jsxs("button",{onClick:c,disabled:!v.quantity,className:`w-full py-3 font-bold rounded-xl text-sm transition-colors disabled:opacity-50
              ${m==="buy"?"bg-[var(--green)] text-white hover:bg-[var(--green)]/80":"bg-[var(--red)] text-white hover:bg-[var(--red)]/80"}`,children:[m==="buy"?"Comprar":"Vender"," ",l.replace("USDT","")]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-1 font-bold",children:"Order Book"}),e.jsxs("div",{className:"space-y-0.5 text-[10px] font-mono",children:[p.asks.slice(0,5).reverse().map((u,h)=>e.jsxs("div",{className:"flex justify-between text-[var(--red)]",children:[e.jsxs("span",{children:["$",u.price.toFixed(2)]}),e.jsx("span",{children:u.quantity.toFixed(4)})]},`a${h}`)),e.jsxs("div",{className:"text-center py-0.5 text-sm font-bold text-[var(--gold)]",children:["$",(s==null?void 0:s.toLocaleString(void 0,{minimumFractionDigits:2}))||"---"]}),p.bids.slice(0,5).map((u,h)=>e.jsxs("div",{className:"flex justify-between text-[var(--green)]",children:[e.jsxs("span",{children:["$",u.price.toFixed(2)]}),e.jsx("span",{children:u.quantity.toFixed(4)})]},`b${h}`))]})]})]}),j==="positions"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:t.length===0?e.jsx("p",{className:"text-center text-sm text-[var(--text-dim)] py-8",children:"Sin posiciones abiertas"}):t.map(u=>{const h=u.side==="buy"?(s-u.entryPrice)*u.quantity:(u.entryPrice-s)*u.quantity;return e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:u.symbol}),e.jsx("span",{className:`text-xs font-bold ${u.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:u.side.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-[var(--text-dim)]",children:[e.jsxs("span",{children:["Entrada: $",u.entryPrice]}),e.jsxs("span",{className:h>=0?"text-[var(--green)]":"text-[var(--red)]",children:["P&L: ",h>=0?"+":"","$",h.toFixed(2)]})]}),e.jsx("button",{onClick:()=>i(u.id),className:"w-full mt-1 py-1 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cerrar Posici√≥n"})]},u.id)})}),j==="orders"&&e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:a.length===0?e.jsx("p",{className:"text-center text-sm text-[var(--text-dim)] py-8",children:"Sin √≥rdenes pendientes"}):a.map(u=>e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-bold",children:u.symbol}),e.jsxs("span",{className:`text-xs font-bold ${u.side==="buy"?"text-[var(--green)]":"text-[var(--red)]"}`,children:[u.side.toUpperCase()," ",u.type]})]}),e.jsxs("div",{className:"text-[10px] text-[var(--text-dim)]",children:["Precio: $",u.price," | Cantidad: ",u.quantity]}),e.jsx("button",{onClick:()=>d(u.id),className:"w-full mt-1 py-1 bg-[var(--dark-4)] text-[var(--text-dim)] rounded text-[10px] hover:bg-[var(--red)]/20 hover:text-[var(--red)] transition-colors",children:"Cancelar"})]},u.id))})]})}class at{constructor(){this.connections=new Map}_decrypt(s){return{...s,apiKey:atob(s.apiKey),apiSecret:atob(s.apiSecret),passphrase:s.passphrase?atob(s.passphrase):void 0}}async _binanceRequest(s,t,a={}){const r=new URL(`${L.binance.baseUrl}${t}`);Object.entries(a).forEach(([i,d])=>r.searchParams.set(i,d));const n=await fetch(r.toString(),{headers:{"X-MBX-APIKEY":s.apiKey}});if(!n.ok)throw new Error(`Binance API error: ${n.status}`);return n.json()}async connect(s){const t=this._decrypt(s),a=L[s.brokerId];if(!a)throw new Error(`Unsupported broker: ${s.brokerId}`);try{switch(s.brokerId){case"binance":await this._binanceRequest(t,"/api/v3/ping");break;default:await fetch(a.baseUrl)}return this.connections.set(s.id,{creds:t,config:a,connected:!0}),{success:!0,message:`Connected to ${a.name}`}}catch(r){return{success:!1,message:r.message}}}async getBalances(s){if(!this.connections.get(s))throw new Error("Broker not connected");return[{asset:"BTC",free:"0.5432",locked:"0.0000"},{asset:"ETH",free:"12.3456",locked:"0.0000"},{asset:"USDT",free:"15000.00",locked:"500.00"},{asset:"BNB",free:"25.00",locked:"0.0000"},{asset:"SOL",free:"100.00",locked:"0.0000"}]}async placeOrder(s,t){const a=this.connections.get(s);if(!a)throw new Error("Broker not connected");const{symbol:r,side:n,type:i,quantity:d,price:m,stopLoss:x,takeProfit:o}=t;if(!r||!n||!i||!d)throw new Error("Missing required order fields");return{id:Date.now().toString(36),symbol:r,side:n,type:i,quantity:parseFloat(d),price:m?parseFloat(m):null,stopLoss:x?parseFloat(x):null,takeProfit:o?parseFloat(o):null,status:i==="market"?"filled":"open",filledPrice:i==="market"?parseFloat(m||0):null,timestamp:new Date().toISOString(),broker:a.config.name}}async cancelOrder(s,t){if(!this.connections.get(s))throw new Error("Broker not connected");return{success:!0,orderId:t}}async getOpenOrders(s,t){if(!this.connections.get(s))throw new Error("Broker not connected");return[]}async getPositions(s){if(!this.connections.get(s))throw new Error("Broker not connected");return[]}disconnect(s){this.connections.delete(s)}}const oe=new at;class rt{constructor(){this.activeBots=new Map,this.intervals=new Map}async startBot(s,t,a){if(this.activeBots.has(s.id))return;a==null||a(`ü§ñ Bot "${s.name}" iniciado en ${s.pair}`),this.activeBots.set(s.id,{bot:s,running:!0});const r=this._getCheckInterval(s.timeframe),n=async()=>{var d;if((d=this.activeBots.get(s.id))!=null&&d.running)try{const m=await z.getCandles(s.pair,s.timeframe,100),x=m.map(v=>v.close),o=x[x.length-1],b=this._evaluateStrategy(s.strategy,m,x);if(b){a==null||a(`üìä Se√±al detectada: ${b.type.toUpperCase()} a $${o}`);const v=this._calculatePositionSize(s,o),w={symbol:s.pair,side:b.type,type:"market",quantity:v,price:o,stopLoss:b.type==="buy"?o*(1-parseFloat(s.strategy.stopLoss)/100):o*(1+parseFloat(s.strategy.stopLoss)/100),takeProfit:b.type==="buy"?o*(1+parseFloat(s.strategy.takeProfit)/100):o*(1-parseFloat(s.strategy.takeProfit)/100)};t==null||t(w),a==null||a(`‚úÖ Orden ejecutada: ${b.type.toUpperCase()} ${v} ${s.pair} @ $${o}`)}}catch(m){a==null||a(`‚ùå Error: ${m.message}`)}};await n();const i=setInterval(n,r);this.intervals.set(s.id,i)}stopBot(s){const t=this.activeBots.get(s);t&&(t.running=!1,this.activeBots.delete(s));const a=this.intervals.get(s);a&&(clearInterval(a),this.intervals.delete(s))}_evaluateStrategy(s,t,a){var i,d,m,x,o,b,v,w,p,y,j,k;if(!((i=s==null?void 0:s.entry)!=null&&i.indicator))return null;const r=a.length,n=s.entry.indicator;switch(n){case"ema_cross":case"ema_cross_rsi":{const C=((d=s.entry.params)==null?void 0:d.fastEma)||((m=s.entry.params)==null?void 0:m.fast)||20,c=((x=s.entry.params)==null?void 0:x.slowEma)||((o=s.entry.params)==null?void 0:o.slow)||50,f=M(a,C),u=M(a,c),h=ie(f,u,r-1);if(n==="ema_cross_rsi"){const N=((b=s.entry.params)==null?void 0:b.rsiPeriod)||14,S=ne(a,N)[r-1],P=((v=s.entry.params)==null?void 0:v.rsiOversold)||30,T=((p=(w=s.exit)==null?void 0:w.params)==null?void 0:p.rsiOverbought)||70;if(h==="bullish_cross"&&S<P)return{type:"buy"};if(h==="bearish_cross"&&S>T)return{type:"sell"};if(S>T)return{type:"sell"};if(S<P)return{type:"buy"}}else{if(h==="bullish_cross")return{type:"buy"};if(h==="bearish_cross")return{type:"sell"}}break}case"rsi":{const C=((y=s.entry.params)==null?void 0:y.period)||14,f=ne(a,C)[r-1];if(f<(((j=s.entry.params)==null?void 0:j.oversold)||30))return{type:"buy"};if(f>(((k=s.entry.params)==null?void 0:k.overbought)||70))return{type:"sell"};break}case"macd_cross":{const{macd:C,signal:c}=Ze(a),f=ie(C,c,r-1);if(f==="bullish_cross")return{type:"buy"};if(f==="bearish_cross")return{type:"sell"};break}default:return null}return null}_calculatePositionSize(s,t){const a=s.balance||1e3,r=parseFloat(s.riskPercent||2)/100,n=a*r/t;return Math.round(n*1e8)/1e8}_getCheckInterval(s){return{"1m":6e4,"5m":3e5,"15m":9e5,"1h":3e5,"4h":9e5,"1d":36e5}[s]||3e5}getActiveBotCount(){return this.activeBots.size}}const H=new rt;function nt(){const{bots:l,addBot:s,updateBot:t,removeBot:a,strategies:r,brokers:n}=B(),[i,d]=g.useState(!1),[m,x]=g.useState([]),[o,b]=g.useState({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10"}),v=()=>{if(!o.name||!o.pair)return;const c=r.find(f=>f.id===o.strategyId)||{name:"EMA Cross + RSI",entry:{condition:"EMA 20 cruza EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"};s({name:o.name,pair:o.pair,timeframe:o.timeframe,strategy:c,brokerId:o.brokerId,balance:parseFloat(o.balance),riskPercent:parseFloat(o.riskPercent),maxTrades:parseInt(o.maxTrades)}),b({name:"",pair:"BTCUSDT",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10"}),d(!1)},w=async c=>{t(c.id,{status:"active"}),H.startBot({...c,status:"active"},f=>{x(u=>[...u,{type:"trade",bot:c.name,...f,time:new Date().toLocaleTimeString()}])},f=>{x(u=>[...u,{type:"log",bot:c.name,message:f,time:new Date().toLocaleTimeString()}])})},p=c=>{H.stopBot(c.id),t(c.id,{status:"paused"})},y=c=>{H.stopBot(c.id),t(c.id,{status:"stopped"})},j=c=>{H.stopBot(c.id),a(c.id)},k=c=>{switch(c){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},C=c=>{switch(c){case"active":return"Activo";case"paused":return"Pausado";case"stopped":return"Detenido";case"error":return"Error";default:return c}};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[l.filter(c=>c.status==="active").length," activos de ",l.length," total"]})]}),e.jsxs("button",{onClick:()=>d(!i),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-black font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(Q,{size:16})," Crear Bot"]})]}),e.jsx(_,{children:i&&e.jsx(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Nuevo Bot de Trading"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Nombre del Bot"}),e.jsx("input",{value:o.name,onChange:c=>b({...o,name:c.target.value}),placeholder:"Mi Bot BTC",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Par"}),e.jsx("select",{value:o.pair,onChange:c=>b({...o,pair:c.target.value}),className:"w-full",children:Z.map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Timeframe"}),e.jsx("select",{value:o.timeframe,onChange:c=>b({...o,timeframe:c.target.value}),className:"w-full",children:ee.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Balance Asignado ($)"}),e.jsx("input",{type:"number",value:o.balance,onChange:c=>b({...o,balance:c.target.value}),placeholder:"1000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo por Trade (%)"}),e.jsx("input",{type:"number",value:o.riskPercent,onChange:c=>b({...o,riskPercent:c.target.value}),placeholder:"2",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"M√°x. Trades por D√≠a"}),e.jsx("input",{type:"number",value:o.maxTrades,onChange:c=>b({...o,maxTrades:c.target.value}),placeholder:"10",className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-1",children:"Estrategia Predeterminada"}),e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"EMA Cross + RSI"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Compra: EMA 20 cruza EMA 50 + RSI < 30 | Venta: RSI > 70 | SL: 2% | TP: 4%"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:v,className:"flex-1 py-2.5 bg-[var(--gold)] text-black font-bold rounded-xl text-sm hover:bg-[var(--gold-light)] transition-colors",children:"Crear Bot"}),e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm",children:"Cancelar"})]})]})})}),l.length===0?e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-12 text-center",children:[e.jsx(K,{size:48,className:"text-[var(--text-dim)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay bots creados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Crea tu primer bot para automatizar tu trading"})]}):e.jsx("div",{className:"space-y-3",children:l.map(c=>{var f;return e.jsxs(E.div,{layout:!0,className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[var(--dark-3)] flex items-center justify-center",children:e.jsx(K,{size:20,style:{color:k(c.status)}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:c.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[c.pair," ‚Ä¢ ",c.timeframe]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold",style:{color:k(c.status),background:`${k(c.status)}20`},children:C(c.status)})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Trades"}),e.jsx("p",{className:"text-sm font-bold",children:c.trades||0})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L"}),e.jsxs("p",{className:`text-sm font-bold ${(c.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(c.pnl||0)>=0?"+":"","$",(c.pnl||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-sm font-bold",children:[(c.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-lg p-2 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Balance"}),e.jsxs("p",{className:"text-sm font-bold",children:["$",(f=c.balance)==null?void 0:f.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[c.status!=="active"?e.jsxs("button",{onClick:()=>w(c),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold hover:bg-[var(--green)]/30 transition-colors",children:[e.jsx(de,{size:12})," Iniciar"]}):e.jsxs("button",{onClick:()=>p(c),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(we,{size:12})," Pausar"]}),e.jsxs("button",{onClick:()=>y(c),className:"flex items-center gap-1 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:bg-[var(--dark-4)] transition-colors",children:[e.jsx(Ce,{size:12})," Detener"]}),e.jsxs("button",{onClick:()=>j(c),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-[var(--text-dim)] hover:text-[var(--red)] rounded-lg text-xs transition-colors",children:[e.jsx(V,{size:12})," Eliminar"]})]})]},c.id)})}),m.length>0&&e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-[var(--border)]",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Actividad en Vivo"}),e.jsx("button",{onClick:()=>x([]),className:"text-xs text-[var(--text-dim)]",children:"Limpiar"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-3 space-y-1 font-mono text-xs",children:m.slice(-50).reverse().map((c,f)=>{var u;return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:c.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0",children:["[",c.bot,"]"]}),e.jsx("span",{className:"text-[var(--text)]",children:c.message||`${(u=c.side)==null?void 0:u.toUpperCase()} ${c.quantity} @ $${c.price}`})]},f)})})]})]})}function it(){var C;const{brokers:l,addBroker:s,removeBroker:t,updateBrokerStatus:a,setActiveBroker:r}=B(),[n,i]=g.useState(!1),[d,m]=g.useState({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),[x,o]=g.useState(!1),[b,v]=g.useState(null),[w,p]=g.useState(""),y=()=>{if(p(""),!d.apiKey||!d.apiSecret){p("API Key y Secret son obligatorios");return}const c=L[d.brokerId];if(c.requiredFields.includes("passphrase")&&!d.passphrase){p("Este broker requiere Passphrase");return}s({brokerId:d.brokerId,label:d.label||c.name,apiKey:d.apiKey,apiSecret:d.apiSecret,passphrase:d.passphrase}),m({brokerId:"binance",apiKey:"",apiSecret:"",passphrase:"",label:""}),i(!1)},j=async c=>{v(c.id);const f=await oe.connect(c);a(c.id,f.success),f.success&&r(c),v(null)},k=c=>{oe.disconnect(c),t(c)};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Brokers Conectados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Conecta tu broker para ejecutar trades autom√°ticamente"})]}),e.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-black font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(Q,{size:16})," Agregar Broker"]})]}),e.jsxs("div",{className:"bg-[var(--gold)]/5 border border-[var(--gold)]/20 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(Y,{size:20,className:"text-[var(--gold)] shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gold)]",children:"Tus API Keys est√°n seguras"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:["Las claves se almacenan encriptadas localmente. Kairos Trade solo necesita permisos de lectura y trading.",e.jsx("strong",{className:"text-[var(--text)]",children:" Nunca actives permisos de retiro."})]})]})]}),e.jsx(_,{children:n&&e.jsx(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Nuevo Broker"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.values(L).map(c=>e.jsxs("button",{onClick:()=>m({...d,brokerId:c.id}),className:`p-3 rounded-xl border text-center transition-all
                      ${d.brokerId===c.id?"border-[var(--gold)] bg-[var(--gold)]/10":"border-[var(--border)] hover:border-[var(--gold)]/30"}`,children:[e.jsx("span",{className:"text-2xl",children:c.logo}),e.jsx("p",{className:"text-sm font-bold mt-1",children:c.name}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:c.supportedMarkets.join(", ")})]},c.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Etiqueta (opcional)"}),e.jsx("input",{value:d.label,onChange:c=>m({...d,label:c.target.value}),placeholder:"Mi cuenta Binance",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"API Key"}),e.jsx("input",{value:d.apiKey,onChange:c=>m({...d,apiKey:c.target.value}),placeholder:"Tu API Key",className:"w-full font-mono text-xs"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"API Secret"}),e.jsx("input",{type:x?"text":"password",value:d.apiSecret,onChange:c=>m({...d,apiSecret:c.target.value}),placeholder:"Tu API Secret",className:"w-full font-mono text-xs pr-10"}),e.jsx("button",{onClick:()=>o(!x),className:"absolute right-3 top-7 text-[var(--text-dim)]",children:x?e.jsx(Ae,{size:14}):e.jsx(Pe,{size:14})})]}),((C=L[d.brokerId])==null?void 0:C.requiredFields.includes("passphrase"))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Passphrase"}),e.jsx("input",{type:"password",value:d.passphrase,onChange:c=>m({...d,passphrase:c.target.value}),placeholder:"Passphrase",className:"w-full font-mono text-xs"})]})]}),w&&e.jsx("p",{className:"text-xs text-[var(--red)]",children:w}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"flex-1 py-2.5 bg-[var(--gold)] text-black font-bold rounded-xl text-sm hover:bg-[var(--gold-light)] transition-colors",children:"Guardar Broker"}),e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm hover:bg-[var(--dark-4)] transition-colors",children:"Cancelar"})]})]})})}),l.length===0?e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-12 text-center",children:[e.jsx(W,{size:48,className:"text-[var(--text-dim)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-dim)]",children:"No hay brokers conectados"}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mt-1",children:"Agrega tu primer broker para empezar a operar"})]}):e.jsx("div",{className:"space-y-3",children:l.map(c=>{const f=L[c.brokerId];return e.jsxs(E.div,{layout:!0,className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:(f==null?void 0:f.logo)||"üìä"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:c.label}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[f==null?void 0:f.name," ‚Ä¢ API: ",atob(c.apiKey).slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.connected?e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--green)]",children:[e.jsx(Te,{size:14})," Conectado"]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-[var(--text-dim)]",children:[e.jsx(Be,{size:14})," Desconectado"]}),e.jsx("button",{onClick:()=>j(c),disabled:b===c.id,className:"px-3 py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors disabled:opacity-50",children:b===c.id?"...":c.connected?"Reconectar":"Conectar"}),e.jsx("button",{onClick:()=>k(c.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(V,{size:14})})]})]},c.id)})})]})}const ot=`Eres Kairos AI, el asistente de trading m√°s avanzado del mundo.
Eres parte de Kairos Trade, la plataforma de trading automatizado de Kairos 777 Inc.

Tu especialidad:
- An√°lisis t√©cnico (EMA, RSI, MACD, Bollinger Bands, VWAP, estructura de mercado)
- Generaci√≥n de estrategias de trading autom√°ticas
- An√°lisis de sentimiento del mercado
- Gesti√≥n de riesgo
- Educaci√≥n en trading

Reglas:
- Responde en espa√±ol siempre
- S√© directo, conciso y profesional
- Cuando generes estrategias, usa formato JSON estructurado
- Nunca des consejos financieros personales ‚Äî eres una herramienta de an√°lisis
- Si te piden una estrategia, incluye SIEMPRE: entry, exit, stopLoss, takeProfit, timeframe
- Usa datos t√©cnicos reales cuando los tengas disponibles

Cuando generes una estrategia, responde con un bloque JSON as√≠:
\`\`\`strategy
{
  "name": "Nombre de la estrategia",
  "pair": "BTCUSDT",
  "timeframe": "1h",
  "entry": { "condition": "EMA 20 cruza por encima de EMA 50", "indicator": "ema_cross", "params": { "fast": 20, "slow": 50 } },
  "exit": { "condition": "RSI > 70", "indicator": "rsi", "params": { "period": 14, "threshold": 70 } },
  "stopLoss": "1.5%",
  "takeProfit": "3%",
  "riskReward": "1:2"
}
\`\`\``;class lt{constructor(){this.apiKey=null,this.model="gpt-4o-mini",this.conversationHistory=[]}setApiKey(s){this.apiKey=s}async chat(s,t=null){var r;let a=s;if(t&&(a+=`

[Datos del mercado actual]
Par: ${t.symbol}
Precio: $${t.price}
Cambio 24h: ${t.changePercent}%
Volumen: ${t.volume}
M√°ximo 24h: $${t.high}
M√≠nimo 24h: $${t.low}`),this.conversationHistory.push({role:"user",content:a}),!this.apiKey)return this._localAnalysis(s,t);try{const n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:[{role:"system",content:ot},...this.conversationHistory.slice(-20)],temperature:.7,max_tokens:1e3})});if(!n.ok){const m=await n.json();throw new Error(((r=m.error)==null?void 0:r.message)||"API error")}const i=await n.json(),d=i.choices[0].message.content;return this.conversationHistory.push({role:"assistant",content:d}),{text:d,strategy:this._extractStrategy(d),usage:i.usage}}catch(n){return console.error("AI error:",n),this._localAnalysis(s,t)}}_localAnalysis(s,t){var n,i,d,m;const a=s.toLowerCase();if(a.includes("estrategia")||a.includes("strategy")){const x=(t==null?void 0:t.symbol)||"BTCUSDT",o={name:`Kairos Auto Strategy ‚Äî ${x}`,pair:x,timeframe:"1h",entry:{condition:"EMA 20 cruza por encima de EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70 o EMA 20 cruza por debajo de EMA 50",indicator:"rsi_overbought",params:{rsiOverbought:70}},stopLoss:"2%",takeProfit:"4%",riskReward:"1:2"},b=`üìä **Estrategia generada para ${x}**

**Entrada:** ${o.entry.condition}
**Salida:** ${o.exit.condition}
**Stop Loss:** ${o.stopLoss}
**Take Profit:** ${o.takeProfit}
**Risk/Reward:** ${o.riskReward}

Puedes activar esta estrategia desde el panel de bots.`;return this.conversationHistory.push({role:"assistant",content:b}),{text:b,strategy:o}}if(a.includes("analiz")||a.includes("mercado")||a.includes("market")||a.includes("c√≥mo ves")){let x="";if(t){const o=t.changePercent>0?"alcista":t.changePercent<-0?"bajista":"lateral",b=Math.abs(t.changePercent),v=b>3?"fuerte":b>1?"moderado":"d√©bil";x=`üìà **An√°lisis de ${t.symbol}**

**Precio:** $${(n=t.price)==null?void 0:n.toLocaleString()}
**Tendencia 24h:** ${o} (${t.changePercent>0?"+":""}${(i=t.changePercent)==null?void 0:i.toFixed(2)}%)
**Momentum:** ${v}
**Rango 24h:** $${(d=t.low)==null?void 0:d.toLocaleString()} ‚Äî $${(m=t.high)==null?void 0:m.toLocaleString()}
**Volumen:** $${(t.quoteVolume/1e6).toFixed(1)}M

`+(t.changePercent>2?`‚ö° El mercado muestra fuerza compradora. Considerar compras en retrocesos.
`:t.changePercent<-2?`‚ö†Ô∏è Presi√≥n vendedora activa. Esperar confirmaci√≥n de soporte.
`:`üìä Mercado en consolidaci√≥n. Esperar ruptura para tomar posici√≥n.
`)+`
üí° Recomendaci√≥n: ${o==="alcista"?"Buscar entradas en pullbacks al EMA 20.":o==="bajista"?"Precauci√≥n. Esperar divergencia RSI para posible reversal.":"Operar rango ‚Äî comprar soporte, vender resistencia."}`}else x="üìä Necesito datos del mercado para analizar. Selecciona un par de trading primero.";return this.conversationHistory.push({role:"assistant",content:x}),{text:x,strategy:null}}const r=`ü§ñ Soy **Kairos AI**, tu asistente de trading.

Puedo ayudarte con:
‚Ä¢ **"Analiza BTC"** ‚Äî An√°lisis t√©cnico del mercado
‚Ä¢ **"Dame una estrategia para ETHUSDT"** ‚Äî Generar estrategia autom√°tica
‚Ä¢ **"¬øC√≥mo ves el mercado?"** ‚Äî Visi√≥n general
‚Ä¢ **"Configura un bot"** ‚Äî Ayuda con automatizaci√≥n

¬øEn qu√© te puedo ayudar?`;return this.conversationHistory.push({role:"assistant",content:r}),{text:r,strategy:null}}_extractStrategy(s){const t=s.match(/```strategy\n([\s\S]*?)```/);if(t)try{return JSON.parse(t[1])}catch{return null}return null}clearHistory(){this.conversationHistory=[]}}const ct=new lt;function le(){const{aiMessages:l,addAiMessage:s,aiLoading:t,setAiLoading:a,clearAiMessages:r,currentPrice:n,selectedPair:i,priceChange24h:d}=B(),[m,x]=g.useState(""),o=g.useRef(null);g.useEffect(()=>{var p;(p=o.current)==null||p.scrollIntoView({behavior:"smooth"})},[l]);const b=async()=>{if(!m.trim()||t)return;const p={role:"user",content:m.trim(),time:new Date().toLocaleTimeString()};s(p),x(""),a(!0);try{const y=n?{symbol:i,price:n,changePercent:d,high:n*1.02,low:n*.98,volume:0,quoteVolume:0}:null,j=await ct.chat(m.trim(),y);s({role:"assistant",content:j.text,strategy:j.strategy,time:new Date().toLocaleTimeString()})}catch(y){s({role:"assistant",content:`‚ùå Error: ${y.message}`,time:new Date().toLocaleTimeString()})}a(!1)},v=[{label:"Analiza el mercado",icon:X,prompt:`Analiza ${i} ahora mismo`},{label:"Dame una estrategia",icon:U,prompt:`Dame una estrategia de trading para ${i}`},{label:"¬øC√≥mo ves BTC?",icon:Ee,prompt:"¬øC√≥mo ves Bitcoin hoy?"}],w=(p,y)=>{const j=p.role==="user";return e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${j?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl p-3 ${j?"bg-[var(--gold)] text-black rounded-br-md":"bg-[var(--dark-3)] text-[var(--text)] rounded-bl-md"}`,children:[!j&&e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(R,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:p.content.split(`
`).map((k,C)=>k.startsWith("**")&&k.endsWith("**")?e.jsx("p",{className:"font-bold my-0.5",children:k.replace(/\*\*/g,"")},C):k.startsWith("‚Ä¢")||k.startsWith("-")?e.jsx("p",{className:"ml-2",children:k},C):e.jsx("p",{children:k},C))}),p.strategy&&e.jsxs("div",{className:"mt-2 p-2 bg-[var(--dark-4)] rounded-xl border border-[var(--gold)]/20",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(U,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-xs font-bold text-[var(--gold)]",children:"Estrategia Lista"})]}),e.jsx("p",{className:"text-xs",children:p.strategy.name||"Auto Strategy"}),e.jsx("button",{onClick:()=>{B.getState().addStrategy(p.strategy),s({role:"assistant",content:"‚úÖ Estrategia guardada. Puedes activarla desde el panel de Bots.",time:new Date().toLocaleTimeString()})},className:"mt-1 px-3 py-1 bg-[var(--gold)] text-black text-xs font-bold rounded-lg",children:"Activar Estrategia"})]}),e.jsx("p",{className:`text-[10px] mt-1 ${j?"text-black/50":"text-[var(--text-dim)]"}`,children:p.time})]})},y)};return e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--gold)]/20 flex items-center justify-center",children:e.jsx(R,{size:18,className:"text-[var(--gold)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold",children:"Kairos AI"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"Asistente de trading inteligente"})]})]}),e.jsx("button",{onClick:r,className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)] transition-colors",children:e.jsx(V,{size:14})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[l.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(R,{size:48,className:"text-[var(--gold)] mb-4"}),e.jsx("h3",{className:"text-lg font-bold mb-1",style:{fontFamily:"Playfair Display, serif"},children:"Kairos AI"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-6 max-w-xs",children:"Tu asistente de trading con inteligencia artificial. Preg√∫ntame cualquier cosa sobre el mercado."}),e.jsx("div",{className:"space-y-2 w-full max-w-xs",children:v.map((p,y)=>{const j=p.icon;return e.jsxs("button",{onClick:()=>{x(p.prompt)},className:"w-full flex items-center gap-2 p-3 bg-[var(--dark-3)] border border-[var(--border)] rounded-xl text-sm hover:border-[var(--gold)]/30 transition-colors text-left",children:[e.jsx(j,{size:16,className:"text-[var(--gold)] shrink-0"}),p.label]},y)})})]}),l.map(w),t&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-2xl rounded-bl-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{size:12,className:"text-[var(--gold)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gold)] font-bold",children:"Kairos AI"})]}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--gold)] animate-bounce",style:{animationDelay:"300ms"}})]})]})}),e.jsx("div",{ref:o})]}),e.jsx("div",{className:"p-3 border-t border-[var(--border)] bg-[var(--dark-2)] shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:m,onChange:p=>x(p.target.value),onKeyDown:p=>p.key==="Enter"&&b(),placeholder:"Pregunta sobre el mercado, pide estrategias...",className:"flex-1 text-sm"}),e.jsx("button",{onClick:b,disabled:!m.trim()||t,className:"px-4 py-2 bg-[var(--gold)] text-black rounded-xl hover:bg-[var(--gold-light)] transition-colors disabled:opacity-50",children:e.jsx(Ie,{size:16})})]})})]})}const dt=[{name:"EMA Cross Classic",description:"Cruces de EMA r√°pida/lenta ‚Äî Tendencia",entry:{condition:"EMA 20 cruza por encima de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},exit:{condition:"EMA 20 cruza por debajo de EMA 50",indicator:"ema_cross",params:{fast:20,slow:50}},stopLoss:"2",takeProfit:"4"},{name:"RSI Reversal",description:"Compra en sobreventa, vende en sobrecompra",entry:{condition:"RSI < 30 (sobreventa)",indicator:"rsi",params:{period:14,oversold:30}},exit:{condition:"RSI > 70 (sobrecompra)",indicator:"rsi",params:{period:14,overbought:70}},stopLoss:"1.5",takeProfit:"3"},{name:"MACD Momentum",description:"Cruce de l√≠nea MACD y se√±al",entry:{condition:"MACD cruza por encima de se√±al",indicator:"macd_cross",params:{fast:12,slow:26,signal:9}},exit:{condition:"MACD cruza por debajo de se√±al",indicator:"macd_cross",params:{}},stopLoss:"2",takeProfit:"4"},{name:"Bollinger Bounce",description:"Compra en banda inferior, vende en superior",entry:{condition:"Precio toca Bollinger Band inferior",indicator:"bb_bounce",params:{period:20,stdDev:2}},exit:{condition:"Precio toca Bollinger Band superior",indicator:"bb_bounce",params:{}},stopLoss:"1",takeProfit:"2"},{name:"EMA + RSI Combo",description:"M√°s preciso: cruces de EMA confirmados con RSI",entry:{condition:"EMA 20 > EMA 50 + RSI < 30",indicator:"ema_cross_rsi",params:{fastEma:20,slowEma:50,rsiPeriod:14,rsiOversold:30}},exit:{condition:"RSI > 70",indicator:"rsi",params:{rsiOverbought:70}},stopLoss:"2",takeProfit:"4"}];function xt(){const{strategies:l,addStrategy:s,removeStrategy:t,setPage:a}=B(),[r,n]=g.useState(!1),[i,d]=g.useState({name:"",pair:"BTCUSDT",timeframe:"1h",entryIndicator:"ema_cross",entryCondition:"",exitIndicator:"rsi",exitCondition:"",stopLoss:"2",takeProfit:"4"}),m=o=>{s({...o,pair:"BTCUSDT",timeframe:"1h"})},x=()=>{i.name&&(s({name:i.name,pair:i.pair,timeframe:i.timeframe,entry:{condition:i.entryCondition||`${i.entryIndicator} signal`,indicator:i.entryIndicator,params:{}},exit:{condition:i.exitCondition||`${i.exitIndicator} signal`,indicator:i.exitIndicator,params:{}},stopLoss:i.stopLoss,takeProfit:i.takeProfit}),d({name:"",pair:"BTCUSDT",timeframe:"1h",entryIndicator:"ema_cross",entryCondition:"",exitIndicator:"rsi",exitCondition:"",stopLoss:"2",takeProfit:"4"}),n(!1))};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Estrategias de Trading"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Crea, gestiona y aplica estrategias a tus bots"})]}),e.jsxs("button",{onClick:()=>n(!r),className:"flex items-center gap-2 px-4 py-2 bg-[var(--gold)] text-black font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors text-sm",children:[e.jsx(Q,{size:16})," Crear Estrategia"]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold mb-3",children:"Plantillas Predefinidas"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:dt.map((o,b)=>e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:b*.05},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 hover:border-[var(--gold)]/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{size:16,className:"text-[var(--gold)]"}),e.jsx("h3",{className:"text-sm font-bold",children:o.name})]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:o.description}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--green)]",children:"‚ñ≤"})," ",o.entry.condition]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--red)]",children:"‚ñº"})," ",o.exit.condition]}),e.jsxs("p",{className:"text-[var(--text-dim)]",children:["SL: ",o.stopLoss,"% | TP: ",o.takeProfit,"%"]})]}),e.jsx("button",{onClick:()=>m(o),className:"w-full py-1.5 bg-[var(--gold)]/20 text-[var(--gold)] rounded-lg text-xs font-bold hover:bg-[var(--gold)]/30 transition-colors",children:"Usar Plantilla"})]},o.name))})]}),e.jsx(_,{children:r&&e.jsx(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Crear Estrategia Personalizada"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Nombre"}),e.jsx("input",{value:i.name,onChange:o=>d({...i,name:o.target.value}),placeholder:"Mi estrategia",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Par"}),e.jsx("select",{value:i.pair,onChange:o=>d({...i,pair:o.target.value}),className:"w-full",children:Z.map(o=>e.jsx("option",{children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Timeframe"}),e.jsx("select",{value:i.timeframe,onChange:o=>d({...i,timeframe:o.target.value}),className:"w-full",children:ee.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-bold text-[var(--green)] mb-2",children:"‚ñ≤ Condici√≥n de Entrada"}),e.jsxs("select",{value:i.entryIndicator,onChange:o=>d({...i,entryIndicator:o.target.value}),className:"w-full mb-2 text-sm",children:[e.jsx("option",{value:"ema_cross",children:"EMA Cross"}),e.jsx("option",{value:"rsi",children:"RSI"}),e.jsx("option",{value:"macd_cross",children:"MACD Cross"}),e.jsx("option",{value:"ema_cross_rsi",children:"EMA + RSI Combo"}),e.jsx("option",{value:"bb_bounce",children:"Bollinger Bounce"})]}),e.jsx("input",{value:i.entryCondition,onChange:o=>d({...i,entryCondition:o.target.value}),placeholder:"Describe la condici√≥n...",className:"w-full text-xs"})]}),e.jsxs("div",{className:"bg-[var(--dark-3)] rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-bold text-[var(--red)] mb-2",children:"‚ñº Condici√≥n de Salida"}),e.jsxs("select",{value:i.exitIndicator,onChange:o=>d({...i,exitIndicator:o.target.value}),className:"w-full mb-2 text-sm",children:[e.jsx("option",{value:"rsi",children:"RSI"}),e.jsx("option",{value:"ema_cross",children:"EMA Cross"}),e.jsx("option",{value:"macd_cross",children:"MACD Cross"})]}),e.jsx("input",{value:i.exitCondition,onChange:o=>d({...i,exitCondition:o.target.value}),placeholder:"Describe la condici√≥n...",className:"w-full text-xs"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Stop Loss (%)"}),e.jsx("input",{type:"number",value:i.stopLoss,onChange:o=>d({...i,stopLoss:o.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Take Profit (%)"}),e.jsx("input",{type:"number",value:i.takeProfit,onChange:o=>d({...i,takeProfit:o.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:x,className:"flex-1 py-2.5 bg-[var(--gold)] text-black font-bold rounded-xl text-sm",children:"Crear Estrategia"}),e.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-xl text-sm",children:"Cancelar"})]})]})})}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-bold mb-3",children:["Mis Estrategias (",l.length,")"]}),e.jsx("div",{className:"space-y-2",children:l.map(o=>{var b;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold",children:o.name}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[(b=o.entry)==null?void 0:b.condition," | SL: ",o.stopLoss,"% | TP: ",o.takeProfit,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>a("bots"),className:"px-3 py-1.5 bg-[var(--green)]/20 text-[var(--green)] rounded-lg text-xs font-bold",children:[e.jsx(de,{size:12,className:"inline mr-1"})," Usar en Bot"]}),e.jsx("button",{onClick:()=>t(o.id),className:"p-1.5 text-[var(--text-dim)] hover:text-[var(--red)]",children:e.jsx(V,{size:14})})]})]},o.id)})})]})]})}function mt(){const{tradeHistory:l,positions:s}=B(),[t,a]=g.useState("open"),r=l.reduce((d,m)=>d+(m.pnl||0),0),n=l.filter(d=>(d.pnl||0)>0).length,i=l.length>0?n/l.length*100:0;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Historial de Trading"}),e.jsxs("p",{className:"text-sm text-[var(--text-dim)]",children:[l.length," trades cerrados ‚Ä¢ ",s.length," posiciones abiertas"]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--dark-3)] text-[var(--text-dim)] rounded-lg text-xs hover:text-[var(--text)] transition-colors",children:[e.jsx(De,{size:14})," Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Total Trades"}),e.jsx("p",{className:"text-lg font-bold",children:l.length})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"P&L Total"}),e.jsxs("p",{className:`text-lg font-bold ${r>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[r>=0?"+":"","$",r.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Win Rate"}),e.jsxs("p",{className:"text-lg font-bold text-[var(--gold)]",children:[i.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:"Posiciones Abiertas"}),e.jsx("p",{className:"text-lg font-bold text-[var(--blue)]",children:s.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-[var(--dark-3)] rounded-lg p-1 w-fit",children:[e.jsxs("button",{onClick:()=>a("open"),className:`px-4 py-1.5 text-sm rounded-md ${t==="open"?"bg-[var(--gold)] text-black font-bold":"text-[var(--text-dim)]"}`,children:["Abiertas (",s.length,")"]}),e.jsxs("button",{onClick:()=>a("closed"),className:`px-4 py-1.5 text-sm rounded-md ${t==="closed"?"bg-[var(--gold)] text-black font-bold":"text-[var(--text-dim)]"}`,children:["Cerradas (",l.length,")"]})]}),e.jsx("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-[var(--text-dim)] text-xs",children:[e.jsx("th",{className:"text-left p-3",children:"Par"}),e.jsx("th",{className:"text-left p-3",children:"Lado"}),e.jsx("th",{className:"text-right p-3",children:"Entrada"}),e.jsx("th",{className:"text-right p-3",children:"Cantidad"}),e.jsx("th",{className:"text-right p-3",children:"P&L"}),e.jsx("th",{className:"text-right p-3",children:"Fecha"})]})}),e.jsx("tbody",{children:(t==="open"?s:l).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-8 text-center text-[var(--text-dim)]",children:t==="open"?"Sin posiciones abiertas":"Sin trades cerrados"})}):(t==="open"?s:l).map((d,m)=>{var x,o;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--dark-3)] transition-colors",children:[e.jsx("td",{className:"p-3 font-bold",children:d.symbol}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold
                    ${d.side==="buy"?"bg-[var(--green)]/20 text-[var(--green)]":"bg-[var(--red)]/20 text-[var(--red)]"}`,children:(x=d.side)==null?void 0:x.toUpperCase()})}),e.jsxs("td",{className:"p-3 text-right font-mono",children:["$",(o=d.entryPrice)==null?void 0:o.toFixed(2)]}),e.jsx("td",{className:"p-3 text-right font-mono",children:d.quantity}),e.jsxs("td",{className:`p-3 text-right font-mono font-bold ${(d.pnl||0)>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[(d.pnl||0)>=0?"+":"","$",(d.pnl||0).toFixed(2)]}),e.jsx("td",{className:"p-3 text-right text-xs text-[var(--text-dim)]",children:new Date(d.openedAt||d.closedAt).toLocaleDateString()})]},d.id||m)})})]})})]})}function pt(){var m;const{settings:l,updateSettings:s,user:t}=B(),[a,r]=g.useState(""),[n,i]=g.useState(!1),d=()=>{if(a.trim()){const{default:x}=require("../../services/ai");x.setApiKey(a.trim()),s({openaiKey:a.trim()}),i(!0),setTimeout(()=>i(!1),2e3)}};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Ajustes"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Configuraci√≥n de tu plataforma"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Y,{size:16,className:"text-[var(--gold)]"})," Perfil"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Email:"})," ",t==null?void 0:t.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Nombre:"})," ",t==null?void 0:t.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-[var(--text-dim)]",children:"Plan:"})," ",e.jsx("span",{className:"text-[var(--gold)]",children:(m=t==null?void 0:t.plan)==null?void 0:m.toUpperCase()})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(Fe,{size:16,className:"text-[var(--gold)]"})," API Key de OpenAI"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-2",children:"Opcional. Sin API key, Kairos AI usa an√°lisis local integrado. Con API key, accedes a GPT-4 para an√°lisis avanzado."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:a,onChange:x=>r(x.target.value),placeholder:"sk-...",className:"flex-1 text-sm font-mono"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-[var(--gold)] text-black rounded-xl text-sm font-bold",children:n?"‚úì Guardado":"Guardar"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx($e,{size:16,className:"text-[var(--gold)]"})," Trading por Defecto"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Riesgo m√°x. por trade (%)"}),e.jsx("input",{type:"number",value:l.maxRiskPerTrade,onChange:x=>s({maxRiskPerTrade:parseFloat(x.target.value)}),className:"w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-[var(--text-dim)] mb-1 block",children:"Apalancamiento predeterminado"}),e.jsx("input",{type:"number",value:l.defaultLeverage,onChange:x=>s({defaultLeverage:parseFloat(x.target.value)}),className:"w-full text-sm"})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-[var(--gold)]"})," Notificaciones"]}),e.jsx("div",{className:"space-y-3",children:[{key:"notifications",label:"Notificaciones",desc:"Alertas de trades y se√±ales"},{key:"soundAlerts",label:"Sonido",desc:"Alertas sonoras al ejecutar trades"}].map(x=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:x.label}),e.jsx("p",{className:"text-xs text-[var(--text-dim)]",children:x.desc})]}),e.jsx("button",{onClick:()=>s({[x.key]:!l[x.key]}),className:`w-12 h-6 rounded-full transition-colors relative
                  ${l[x.key]?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform
                    ${l[x.key]?"left-6":"left-0.5"}`})})]},x.key))})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h2",{className:"text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(J,{size:16,className:"text-[var(--gold)]"})," Kairos Wallet"]}),e.jsx("p",{className:"text-xs text-[var(--text-dim)] mb-3",children:"Conecta tu Kairos Wallet para usar KAIROS Coin como m√©todo de pago y recibir recompensas."}),e.jsxs("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--gold)]/20 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/30 transition-colors",children:[e.jsx(J,{size:14})," Abrir Kairos Wallet"]})]}),e.jsxs("div",{className:"text-center text-xs text-[var(--text-dim)] pb-4",children:[e.jsx("p",{children:"Kairos Trade v1.0.0 ‚Ä¢ Kairos 777 Inc"}),e.jsx("p",{className:"text-[var(--gold)] mt-1",children:"Powered by Kairos AI"})]})]})}function ut(){const{isAuthenticated:l,currentPage:s,aiPanelOpen:t}=B();if(!l)return e.jsx(Ye,{});const a=()=>{switch(s){case"dashboard":return e.jsx(re,{});case"chart":return e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"flex-1",children:e.jsx(tt,{})}),e.jsx(st,{})]});case"bots":return e.jsx(nt,{});case"brokers":return e.jsx(it,{});case"ai":return e.jsx(le,{});case"strategies":return e.jsx(xt,{});case"history":return e.jsx(mt,{});case"wallet":return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-[var(--gold)]/20 flex items-center justify-center text-[var(--gold)] text-2xl font-bold mx-auto mb-4",children:"K"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Kairos Wallet"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mb-4 max-w-xs",children:"Conecta tu Kairos Wallet para integrar tus balances de KAIROS Coin con la plataforma de trading."}),e.jsx("a",{href:"https://kairos-wallet.netlify.app",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-6 py-3 bg-[var(--gold)] text-black font-bold rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Abrir Kairos Wallet"})]})});case"settings":return e.jsx(pt,{});default:return e.jsx(re,{})}};return e.jsxs("div",{className:"flex h-screen bg-[var(--dark)] overflow-hidden",children:[e.jsx(Re,{position:"top-right",toastOptions:{style:{background:"#1A1A25",color:"#E8E8F0",border:"1px solid #2A2A3A"}}}),e.jsx(Je,{}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(_,{mode:"wait",children:e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"flex-1 flex flex-col overflow-hidden",children:a()},s)}),e.jsx(_,{children:t&&s!=="ai"&&e.jsx(E.div,{initial:{width:0,opacity:0},animate:{width:380,opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},className:"border-l border-[var(--border)] overflow-hidden shrink-0",children:e.jsx(le,{})})})]})]})]})}Ve.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsx(Ke,{children:e.jsx(ut,{})})}));
