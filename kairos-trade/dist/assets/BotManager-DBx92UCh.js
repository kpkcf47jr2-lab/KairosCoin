import{a as N,j as e,a8 as Q,o as U,m as T,Z as ye,a9 as D,G as Ne,a0 as ne,d as ke,D as Pe,h as we,P as Se,aa as Ce,ab as Fe,B as Be,ac as $e,F as Ie,ad as Oe}from"./ui-C9JhL7YV.js";import{f as J,u as W,P as Te,c as ie,T as le}from"./index-CiLxWItl.js";import{t as $}from"./tradingEngine-DAIzVBPG.js";import{m as X}from"./marketData-K1zKCjjj.js";import{d as Ae}from"./indicators-DJQYQkcq.js";import{b as Y}from"./broker-DOgZFvIR.js";import{S as Ee}from"./StrategyEditor-VmXght27.js";import"./vendor-09nSF2_j.js";import"./kairosScript-qrD4GZ5z.js";class De{constructor(){this.activeBots=new Map}start(a){if(this.activeBots.has(a.id))return;const{pair:s,upperPrice:g,lowerPrice:v,gridLines:P,investment:b,onLog:o,onTrade:k}=a,c=(g-v)/(P-1),d=[];for(let f=0;f<P;f++)d.push(+(v+c*f).toFixed(2));const m=b/(P-1),h={id:a.id,pair:s,levels:d,priceStep:c,investmentPerGrid:m,activeOrders:new Map,filledBuys:[],totalProfit:0,trades:0,running:!0,lastPrice:null};this.activeBots.set(a.id,h),o==null||o(`ðŸ“Š Grid Bot started: ${P} levels from $${v} to $${g}`),o==null||o(`ðŸ’° Investment per grid: $${m.toFixed(2)}`),this._startMonitor(h,o,k)}async _startMonitor(a,s,g){const v=async()=>{if(a.running)try{const o=(await X.get24hrTicker(a.pair)).price,k=a.lastPrice;if(a.lastPrice=o,!k){s==null||s(`ðŸ“ˆ Current price: $${o.toFixed(2)}`);for(const d of a.levels)d<o?a.activeOrders.set(d,{side:"buy",price:d,status:"pending"}):d>o;const c=a.activeOrders.size;s==null||s(`ðŸŸ¢ ${c} buy orders placed below current price`);return}for(const c of a.levels){const d=a.activeOrders.get(c);if((d==null?void 0:d.side)==="buy"&&d.status==="pending"&&o<=c){const m=a.investmentPerGrid/c;J.applyVolumeFee(c,m),d.status="filled",a.filledBuys.push(c),a.trades++,g==null||g({symbol:a.pair,side:"buy",type:"grid",quantity:+m.toFixed(6),price:c,gridLevel:c}),s==null||s(`âœ… BUY filled at $${c} (qty: ${m.toFixed(6)})`);const h=c+a.priceStep;h<=a.levels[a.levels.length-1]&&(a.activeOrders.set(h,{side:"sell",price:h,status:"pending",buyLevel:c,quantity:m}),s==null||s(`ðŸ“¤ SELL order placed at $${h.toFixed(2)}`))}if((d==null?void 0:d.side)==="sell"&&d.status==="pending"&&o>=c){d.status="filled";const m=(c-d.buyLevel)*d.quantity,h=J.applyVolumeFee(c,d.quantity),f=m-h;a.totalProfit+=f,a.trades++,g==null||g({symbol:a.pair,side:"sell",type:"grid",quantity:+d.quantity.toFixed(6),price:c,profit:+f.toFixed(2),gridLevel:c}),s==null||s(`âœ… SELL filled at $${c.toFixed(2)} â€” Profit: +$${f.toFixed(2)}`);const w=c-a.priceStep;w>=a.levels[0]&&(a.activeOrders.set(w,{side:"buy",price:w,status:"pending"}),s==null||s(`ðŸ“¥ BUY order re-placed at $${w.toFixed(2)}`))}}}catch(b){s==null||s(`âŒ Error: ${b.message}`)}};await v();const P=setInterval(v,1e4);a._interval=P}stop(a){const s=this.activeBots.get(a);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(a))}getStats(a){const s=this.activeBots.get(a);return s?{levels:s.levels.length,activeOrders:[...s.activeOrders.values()].filter(g=>g.status==="pending").length,filledBuys:s.filledBuys.length,totalProfit:s.totalProfit,trades:s.trades,lastPrice:s.lastPrice}:null}isRunning(a){return this.activeBots.has(a)}}const Z=new De;class Re{constructor(){this.activeBots=new Map}start(a){if(this.activeBots.has(a.id))return;const{pair:s,investmentPerOrder:g,intervalMinutes:v,maxOrders:P=100,useRsiFilter:b=!1,rsiPeriod:o=14,rsiThreshold:k=40,usePriceDipFilter:c=!1,dipPercent:d=3,onLog:m,onTrade:h}=a,f={id:a.id,pair:s,investmentPerOrder:g,intervalMinutes:v,maxOrders:P,useRsiFilter:b,rsiPeriod:o,rsiThreshold:k,usePriceDipFilter:c,dipPercent:d,executedOrders:0,totalInvested:0,totalQuantity:0,avgPrice:0,prices:[],running:!0,lastBuyPrice:null,startTime:Date.now()};this.activeBots.set(a.id,f),m==null||m(`ðŸ“Š DCA Bot started: $${g} every ${v}min on ${s}`),b&&(m==null||m(`ðŸ“‰ RSI filter enabled: buy when RSI < ${k}`)),c&&(m==null||m(`ðŸ“‰ Dip filter enabled: buy when price drops ${d}%`)),this._startMonitor(f,m,h)}async _startMonitor(a,s,g){const v=async()=>{if(a.running){if(a.executedOrders>=a.maxOrders){s==null||s(`ðŸ Max orders reached (${a.maxOrders}). DCA Bot stopped.`),this.stop(a.id);return}try{const o=(await X.get24hrTicker(a.pair)).price;if(a.useRsiFilter)try{const d=(await X.getCandles(a.pair,"1h",100)).map(f=>f.close),m=Ae(d,a.rsiPeriod),h=m[m.length-1];if(h>a.rsiThreshold){s==null||s(`â¸ï¸ RSI ${h.toFixed(1)} > ${a.rsiThreshold} â€” skipping buy`);return}s==null||s(`ðŸ“‰ RSI ${h.toFixed(1)} < ${a.rsiThreshold} â€” proceeding with buy`)}catch(c){s==null||s(`âš ï¸ RSI check failed, proceeding anyway: ${c.message}`)}if(a.usePriceDipFilter&&a.lastBuyPrice){const c=(a.lastBuyPrice-o)/a.lastBuyPrice*100;if(c<a.dipPercent){s==null||s(`â¸ï¸ Price drop ${c.toFixed(2)}% < ${a.dipPercent}% â€” skipping buy`);return}s==null||s(`ðŸ“‰ Price dropped ${c.toFixed(2)}% â€” proceeding with buy`)}const k=a.investmentPerOrder/o;J.applyVolumeFee(o,k),a.executedOrders++,a.totalInvested+=a.investmentPerOrder,a.totalQuantity+=k,a.avgPrice=a.totalInvested/a.totalQuantity,a.lastBuyPrice=o,a.prices.push(o),g==null||g({symbol:a.pair,side:"buy",type:"dca",quantity:+k.toFixed(8),price:o,dcaOrder:a.executedOrders,avgPrice:+a.avgPrice.toFixed(2)}),s==null||s(`âœ… DCA Buy #${a.executedOrders}: ${k.toFixed(6)} ${a.pair.replace("USDT","")} @ $${o.toFixed(2)}`),s==null||s(`ðŸ“Š Avg price: $${a.avgPrice.toFixed(2)} | Total invested: $${a.totalInvested.toFixed(2)}`)}catch(b){s==null||s(`âŒ Error: ${b.message}`)}}};await v();const P=setInterval(v,a.intervalMinutes*60*1e3);a._interval=P}stop(a){const s=this.activeBots.get(a);s&&(s.running=!1,s._interval&&clearInterval(s._interval),this.activeBots.delete(a))}getStats(a){const s=this.activeBots.get(a);if(!s)return null;const v=s.totalQuantity*(s.lastBuyPrice||0)-s.totalInvested;return{executedOrders:s.executedOrders,maxOrders:s.maxOrders,totalInvested:s.totalInvested,totalQuantity:s.totalQuantity,avgPrice:s.avgPrice,currentPrice:s.lastBuyPrice,unrealizedPnl:v,unrealizedPnlPercent:s.totalInvested>0?v/s.totalInvested*100:0,runningTime:Date.now()-s.startTime}}isRunning(a){return this.activeBots.has(a)}}const K=new Re,H=[{id:"signal",label:"Signal Bot",icon:ye,desc:"Indicadores tÃ©cnicos predefinidos",color:"#3B82F6"},{id:"script",label:"Script Bot",icon:D,desc:"Estrategia personalizada con cÃ³digo",color:"#A855F7"},{id:"grid",label:"Grid Bot",icon:Ne,desc:"Compra y vende en niveles de precio",color:"#00DC82"},{id:"dca",label:"DCA Bot",icon:ne,desc:"InversiÃ³n a intervalos regulares",color:"#22D3EE"}];function Ye(){const{bots:S,addBot:a,updateBot:s,removeBot:g,strategies:v,addStrategy:P,brokers:b,setPage:o,setSelectedPair:k}=W(),[c,d]=N.useState(!1),[m,h]=N.useState(!1),[f,w]=N.useState(null),[y,ce]=N.useState("signal"),[R,I]=N.useState([]),[A,de]=N.useState(!1),[L,C]=N.useState(""),[oe,ee]=N.useState({}),[xe,pe]=N.useState({}),[r,x]=N.useState({name:"",pair:"BTCKAIROS",timeframe:"1h",strategyId:"",brokerId:"",balance:"1000",riskPercent:"2",maxTrades:"10",trailingStop:!1,trailingStopPct:"1.5",trailingActivation:"0.5",upperPrice:"",lowerPrice:"",gridLines:"10",investmentPerOrder:"100",intervalMinutes:"60",maxOrders:"50",useRsiFilter:!1,rsiThreshold:"40",usePriceDipFilter:!1,dipPercent:"3",scriptCode:"",scriptStrategyId:""}),M=N.useCallback(async()=>{var t;for(const l of b.filter(n=>n.connected))try{(t=Y.connections)!=null&&t.has(l.id)||await Y.connect(l);const n=await Y.getBalances(l.id),i=Array.isArray(n)?n:(n==null?void 0:n.balances)||[];ee(u=>({...u,[l.id]:{balances:i,loading:!1,error:!1}}))}catch(n){console.warn("Balance fetch failed for",l.id,n.message),ee(i=>({...i,[l.id]:{balances:[],loading:!1,error:!0}}))}},[b]);N.useEffect(()=>{M();const t=setInterval(M,3e4);return()=>clearInterval(t)},[M]),N.useEffect(()=>{const t=setInterval(()=>{const l=S.filter(i=>i.status==="active");if(l.length===0)return;const n={};l.forEach(i=>{const u=$.getLiveData(i.id);u&&(n[i.id]=u)}),Object.keys(n).length>0&&pe(i=>({...i,...n}))},1e3);return()=>clearInterval(t)},[S]),N.useEffect(()=>{const l=W.getState().bots.filter(i=>i.status==="active");for(const i of l)if($.activeBots.has(i.id))$.setCallbacks(i.id,u=>B(i,u),u=>F(i,u));else{const u=i.botType||"signal";u==="signal"||u==="script"?$.startBot({...i,status:"active"},j=>B(i,j),j=>F(i,j)):u==="grid"?Z.start({id:i.id,pair:i.pair,upperPrice:i.upperPrice,lowerPrice:i.lowerPrice,gridLines:i.gridLines,investment:i.balance,onLog:j=>F(i,j),onTrade:j=>B(i,j)}):u==="dca"&&K.start({id:i.id,pair:i.pair,investmentPerOrder:i.investmentPerOrder,intervalMinutes:i.intervalMinutes,maxOrders:i.maxOrders,onLog:j=>F(i,j),onTrade:j=>B(i,j)})}const n=$.getAllLogs();n.length>0&&I(i=>i.length>0?i:n.map(u=>({type:"log",bot:u.botName,message:u.message,time:new Date(u.time).toLocaleTimeString()})))},[]);const me=t=>b.find(l=>l.id===t.brokerId),ue=t=>oe[t]||null,te=t=>{k(t.pair),o("chart")},ve=()=>{C("");const t=r.name.trim()||`Bot ${new Date().toLocaleTimeString("es",{hour:"2-digit",minute:"2-digit"})}`;if(!r.pair){C("Selecciona un par de trading");return}const l={name:t,pair:r.pair,botType:y,brokerId:r.brokerId};if(y==="signal"){const n=v.find(i=>i.id===r.strategyId)||{name:"EMA Cross 9/21",entry:{condition:"EMA 9 cruza EMA 21",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},exit:{condition:"Cruce opuesto",indicator:"ema_cross",params:{fastEma:9,slowEma:21}},stopLoss:"2",takeProfit:"4"};Object.assign(l,{timeframe:r.timeframe,strategy:n,balance:parseFloat(r.balance),riskPercent:parseFloat(r.riskPercent),maxTrades:parseInt(r.maxTrades),trailingStop:r.trailingStop,trailingStopPct:r.trailingStop?parseFloat(r.trailingStopPct):void 0,trailingActivation:r.trailingStop?parseFloat(r.trailingActivation):void 0})}else if(y==="script"){if(!r.scriptStrategyId){C("Selecciona una estrategia o crea una nueva");return}const n=v.find(i=>i.id===r.scriptStrategyId);if(!(n!=null&&n.code)){C("La estrategia seleccionada no tiene cÃ³digo. EdÃ­tala y guarda el cÃ³digo primero.");return}Object.assign(l,{timeframe:r.timeframe,strategy:{type:"custom_script",code:n.code,name:n.name},balance:parseFloat(r.balance),riskPercent:parseFloat(r.riskPercent),maxTrades:parseInt(r.maxTrades),scriptName:n.name,trailingStop:r.trailingStop,trailingStopPct:r.trailingStop?parseFloat(r.trailingStopPct):void 0,trailingActivation:r.trailingStop?parseFloat(r.trailingActivation):void 0})}else if(y==="grid"){if(!r.upperPrice||!r.lowerPrice){C("Ingresa el precio superior e inferior para el grid");return}Object.assign(l,{upperPrice:parseFloat(r.upperPrice),lowerPrice:parseFloat(r.lowerPrice),gridLines:parseInt(r.gridLines),balance:parseFloat(r.balance)})}else y==="dca"&&Object.assign(l,{investmentPerOrder:parseFloat(r.investmentPerOrder),intervalMinutes:parseInt(r.intervalMinutes),maxOrders:parseInt(r.maxOrders),useRsiFilter:r.useRsiFilter,rsiThreshold:parseInt(r.rsiThreshold),usePriceDipFilter:r.usePriceDipFilter,dipPercent:parseFloat(r.dipPercent),balance:parseFloat(r.investmentPerOrder)*parseInt(r.maxOrders)});a(l),d(!1),C("")},F=(t,l)=>{I(n=>[...n.slice(-100),{type:"log",bot:t.name,message:l,time:new Date().toLocaleTimeString()}])},B=(t,l)=>{if(l.status==="error"){I(i=>[...i.slice(-100),{type:"error",bot:t.name,message:`Error: ${l.error}`,time:new Date().toLocaleTimeString()}]);return}I(i=>[...i.slice(-100),{type:"trade",bot:t.name,...l,time:new Date().toLocaleTimeString()}]);const n=W.getState().bots.find(i=>i.id===t.id);if(n){const i=(n.trades||0)+1,u=parseFloat(l.profit)||0,j=(n.pnl||0)+u;let O=n.winRate||0;if(l.action==="close"&&u!==0){const p=(n._closedTrades||0)+1,E=(n._wins||0)+(u>0?1:0);O=p>0?E/p*100:0,s(t.id,{trades:i,pnl:j,winRate:O,_closedTrades:p,_wins:E})}else s(t.id,{trades:i,pnl:j})}},he=async t=>{s(t.id,{status:"active"});const l=t.botType||"signal";l==="signal"||l==="script"?$.startBot({...t,status:"active"},n=>B(t,n),n=>F(t,n)):l==="grid"?Z.start({id:t.id,pair:t.pair,upperPrice:t.upperPrice,lowerPrice:t.lowerPrice,gridLines:t.gridLines,investment:t.balance,onLog:n=>F(t,n),onTrade:n=>B(t,n)}):l==="dca"&&K.start({id:t.id,pair:t.pair,investmentPerOrder:t.investmentPerOrder,intervalMinutes:t.intervalMinutes,maxOrders:t.maxOrders,useRsiFilter:t.useRsiFilter,rsiThreshold:t.rsiThreshold,usePriceDipFilter:t.usePriceDipFilter,dipPercent:t.dipPercent,onLog:n=>F(t,n),onTrade:n=>B(t,n)})},z=t=>{const l=t.botType||"signal";l==="signal"||l==="script"?$.stopBot(t.id):l==="grid"?Z.stop(t.id):l==="dca"&&K.stop(t.id),s(t.id,{status:"stopped"})},ge=t=>{z(t),s(t.id,{status:"paused"})},fe=t=>{z(t),g(t.id)},_=t=>{switch(t){case"active":return"var(--green)";case"paused":return"var(--gold)";case"error":return"var(--red)";default:return"var(--text-dim)"}},be=t=>H.find(l=>l.id===t)||H[0];return e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-3 md:px-5 py-4 md:py-5 space-y-4 md:space-y-5 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Trading Bots"}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)]",children:[S.filter(t=>t.status==="active").length," activos de ",S.length," total"]})]}),e.jsxs("button",{onClick:()=>d(!c),className:"flex items-center gap-2 px-4 py-2 btn-gold rounded-xl text-xs font-semibold shrink-0",children:[e.jsx(Q,{size:14})," Crear Bot"]})]}),e.jsx(U,{children:c&&e.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"rounded-xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--text)]",children:"Nuevo Bot de Trading"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:H.map(t=>{const l=t.icon;return e.jsxs("button",{onClick:()=>ce(t.id),className:`p-3 rounded-xl text-center transition-all flex flex-col items-center justify-center min-w-0 ${y===t.id?"ring-1":"hover:bg-[var(--surface-2)]"}`,style:{background:y===t.id?`${t.color}10`:"var(--surface-2)",borderColor:y===t.id?`${t.color}40`:"var(--border)",border:`1px solid ${y===t.id?t.color+"30":"var(--border)"}`},children:[e.jsx(l,{size:20,style:{color:t.color},className:"mb-1.5 shrink-0"}),e.jsx("p",{className:"text-xs font-bold truncate w-full",style:{color:y===t.id?t.color:"var(--text)"},children:t.label}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mt-0.5 truncate w-full",children:t.desc})]},t.id)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Nombre"}),e.jsx("input",{value:r.name,onChange:t=>x({...r,name:t.target.value}),placeholder:"Mi Bot",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Par"}),e.jsx("select",{value:r.pair,onChange:t=>x({...r,pair:t.target.value}),className:"w-full",children:Te.map(t=>e.jsx("option",{value:t,children:ie(t)},t))})]})]}),y==="signal"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:r.timeframe,onChange:t=>x({...r,timeframe:t.target.value}),className:"w-full",children:le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:r.balance,onChange:t=>x({...r,balance:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:r.riskPercent,onChange:t=>x({...r,riskPercent:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"ðŸ“ Trailing Stop"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"SL que se mueve protegiendo ganancias"})]}),e.jsx("button",{onClick:()=>x({...r,trailingStop:!r.trailingStop}),className:`w-10 h-5 rounded-full transition-colors relative ${r.trailingStop?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full absolute top-0.5 transition-transform ${r.trailingStop?"left-5":"left-0.5"}`})})]}),r.trailingStop&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Trail Distance (%)"}),e.jsx("input",{type:"number",step:"0.1",value:r.trailingStopPct,onChange:t=>x({...r,trailingStopPct:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"ActivaciÃ³n (%)"}),e.jsx("input",{type:"number",step:"0.1",value:r.trailingActivation,onChange:t=>x({...r,trailingActivation:t.target.value}),className:"w-full"})]})]})]})]}),y==="script"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Timeframe"}),e.jsx("select",{value:r.timeframe,onChange:t=>x({...r,timeframe:t.target.value}),className:"w-full",children:le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Balance ($)"}),e.jsx("input",{type:"number",value:r.balance,onChange:t=>x({...r,balance:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Riesgo (%)"}),e.jsx("input",{type:"number",value:r.riskPercent,onChange:t=>x({...r,riskPercent:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3 border border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold flex items-center gap-1",children:"ðŸ“ Trailing Stop"}),e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:"SL que se mueve protegiendo ganancias"})]}),e.jsx("button",{onClick:()=>x({...r,trailingStop:!r.trailingStop}),className:`w-10 h-5 rounded-full transition-colors relative ${r.trailingStop?"bg-[var(--gold)]":"bg-[var(--dark-4)]"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full absolute top-0.5 transition-transform ${r.trailingStop?"left-5":"left-0.5"}`})})]}),r.trailingStop&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"Trail Distance (%)"}),e.jsx("input",{type:"number",step:"0.1",value:r.trailingStopPct,onChange:t=>x({...r,trailingStopPct:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block",children:"ActivaciÃ³n (%)"}),e.jsx("input",{type:"number",step:"0.1",value:r.trailingActivation,onChange:t=>x({...r,trailingActivation:t.target.value}),className:"w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Estrategia"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.scriptStrategyId,onChange:t=>x({...r,scriptStrategyId:t.target.value}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Seleccionar estrategia..."}),v.filter(t=>t.type==="custom_script").map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold shrink-0",style:{background:"rgba(168,85,247,0.1)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},children:[e.jsx(D,{size:13})," ",v.filter(t=>t.type==="custom_script").length>0?"Crear Nueva":"Crear Estrategia"]})]})]})]}),y==="grid"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Superior ($)"}),e.jsx("input",{type:"number",value:r.upperPrice,onChange:t=>x({...r,upperPrice:t.target.value}),placeholder:"100000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Precio Inferior ($)"}),e.jsx("input",{type:"number",value:r.lowerPrice,onChange:t=>x({...r,lowerPrice:t.target.value}),placeholder:"90000",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Niveles de Grid"}),e.jsx("input",{type:"number",value:r.gridLines,onChange:t=>x({...r,gridLines:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"InversiÃ³n Total ($)"}),e.jsx("input",{type:"number",value:r.balance,onChange:t=>x({...r,balance:t.target.value}),className:"w-full"})]})]}),y==="dca"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"$ por Compra"}),e.jsx("input",{type:"number",value:r.investmentPerOrder,onChange:t=>x({...r,investmentPerOrder:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Intervalo (min)"}),e.jsx("input",{type:"number",value:r.intervalMinutes,onChange:t=>x({...r,intervalMinutes:t.target.value}),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"MÃ¡x. Compras"}),e.jsx("input",{type:"number",value:r.maxOrders,onChange:t=>x({...r,maxOrders:t.target.value}),className:"w-full"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.useRsiFilter,onChange:t=>x({...r,useRsiFilter:t.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro RSI (comprar solo si RSI < ",r.rsiThreshold,")"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.usePriceDipFilter,onChange:t=>x({...r,usePriceDipFilter:t.target.checked}),className:"w-4 h-4 rounded accent-[var(--gold)]"}),"Filtro de CaÃ­da (comprar cuando baje ",r.dipPercent,"%)"]})]})]}),b.filter(t=>t.connected).length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] mb-1 block font-semibold uppercase tracking-wider",children:"Broker (ejecuciÃ³n real)"}),e.jsxs("select",{value:r.brokerId,onChange:t=>x({...r,brokerId:t.target.value}),className:"w-full",children:[e.jsx("option",{value:"",children:"Demo (sin broker)"}),b.filter(t=>t.connected).map(t=>e.jsxs("option",{value:t.id,children:["ðŸŸ¢ ",t.name||t.broker," â€” Real"]},t.id))]}),r.brokerId&&e.jsx("p",{className:"text-[10px] text-[var(--red)] mt-1 font-semibold",children:"âš ï¸ Este bot ejecutarÃ¡ Ã³rdenes REALES con dinero real"})]}),L&&e.jsxs("p",{className:"text-xs text-[var(--red)] font-semibold px-1",children:["âš ï¸ ",L]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ve,className:"flex-1 py-2.5 btn-gold rounded-xl text-sm font-bold text-center justify-center",children:"Crear Bot"}),e.jsx("button",{onClick:()=>{d(!1),C("")},className:"px-4 py-2.5 bg-[var(--surface-2)] text-[var(--text-dim)] rounded-xl text-sm border border-[var(--border)] text-center shrink-0",children:"Cancelar"})]})]})})}),S.length===0?e.jsxs("div",{className:"rounded-2xl p-16 text-center",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsx(ke,{size:56,className:"text-[var(--text-dim)]/20 mx-auto mb-5"}),e.jsx("p",{className:"text-lg text-[var(--text-dim)] font-semibold",children:"No hay bots creados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] mt-2",children:"Crea tu primer bot para automatizar tu trading"}),e.jsxs("button",{onClick:()=>d(!0),className:"mt-5 px-6 py-3 btn-gold rounded-xl text-sm font-bold inline-flex items-center gap-2",children:[e.jsx(Q,{size:16})," Crear Bot"]})]}):e.jsx("div",{className:"space-y-4",children:S.map(t=>{var O;const l=be(t.botType||"signal"),n=l.icon,i=me(t),u=t.brokerId?ue(t.brokerId):null,j=t.scriptName||((O=t.strategy)==null?void 0:O.name)||"Default";return e.jsxs(T.div,{layout:!0,className:"rounded-2xl overflow-hidden min-w-0",style:{background:"var(--surface)",border:`1px solid ${t.status==="active"?"rgba(0,220,130,0.2)":"var(--border)"}`},children:[e.jsxs("div",{className:"p-5 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:()=>te(t),children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{background:`${l.color}12`,border:`1px solid ${l.color}25`},children:e.jsx(n,{size:24,style:{color:l.color}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-wrap",children:[e.jsx("p",{className:"text-base font-bold truncate",children:t.name}),e.jsx("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-lg uppercase tracking-wider shrink-0",style:{background:`${l.color}15`,color:l.color},children:l.label})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-[var(--text-dim)] flex-wrap",children:[e.jsx("span",{className:"font-semibold text-[var(--text-secondary)]",children:ie(t.pair)}),t.timeframe&&e.jsxs("span",{children:["â€¢ ",t.timeframe]}),e.jsxs("span",{children:["â€¢ ",j]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("span",{className:"px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap",style:{color:_(t.status),background:`${_(t.status)}15`,border:`1px solid ${_(t.status)}20`},children:t.status==="active"?"â— Activo":t.status==="paused"?"âšâš Pausado":"â–  Detenido"}),e.jsx(Pe,{size:16,className:"text-[var(--text-dim)]"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[i?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(we,{size:13,className:"text-[var(--green)] shrink-0"}),e.jsx("span",{className:"font-semibold text-[var(--text)]",children:i.label||i.name||i.broker}),e.jsx("span",{className:"text-[var(--green)] font-bold",children:"â€¢ Conectado"})]}):e.jsx("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:e.jsx("span",{className:"text-[var(--text-dim)]",children:"ðŸ“‹ Modo Demo"})}),u&&u.balances.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(ne,{size:13,className:"text-[var(--gold)] shrink-0"}),e.jsxs("span",{className:"font-semibold text-[var(--text)]",children:["Saldo: ",u.balances.slice(0,3).map(p=>`${parseFloat(p.free).toFixed(4)} ${p.asset}`).join(" â€¢ ")]})]})]})]}),(()=>{const p=xe[t.id],E=parseFloat(t.pnl)||0,je=(p==null?void 0:p.unrealizedPnl)||0,q=E+je,G=(p==null?void 0:p.pnlPercent)||0,V=parseFloat(t.balance)||0,re=V+q,se=q>=0,ae=!!(p!=null&&p.position);return e.jsxs("div",{className:"grid grid-cols-2 gap-px",style:{background:"var(--border)",borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Trades"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:t.trades||0})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:ae?"ðŸ“Š P&L Vivo":"P&L"}),e.jsxs("p",{className:`text-base sm:text-lg font-bold ${se?"text-[var(--green)]":"text-[var(--red)]"}`,children:[se?"+":"","$",q.toFixed(2)]}),ae&&e.jsxs("p",{className:`text-[10px] font-bold ${G>=0?"text-[var(--green)]":"text-[var(--red)]"}`,children:[G>=0?"+":"",G.toFixed(2),"%"]})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Win Rate"}),e.jsxs("p",{className:"text-base sm:text-lg font-bold text-[var(--gold)]",children:[(t.winRate||0).toFixed(0),"%"]})]}),e.jsxs("div",{className:"p-3 sm:p-3.5 text-center",style:{background:"var(--surface)"},children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-[var(--text-dim)] mb-1",children:"Balance"}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-base sm:text-lg font-bold ${re>=V?"text-[var(--green)]":"text-[var(--red)]"}`,children:["$",re.toFixed(2)]}),e.jsxs("p",{className:"text-[10px] text-[var(--text-dim)]",children:["Inicio: $",V.toFixed(2)]})]})]})]})})(),e.jsxs("div",{className:"flex gap-2 sm:gap-3 p-3 sm:p-4 flex-wrap items-center",style:{borderTop:"1px solid var(--border)"},children:[t.status!=="active"?e.jsxs("button",{onClick:p=>{p.stopPropagation(),he(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--green)]/10 text-[var(--green)] rounded-xl text-sm font-bold hover:bg-[var(--green)]/20 transition-colors border border-[var(--green)]/20",children:[e.jsx(Se,{size:15,className:"shrink-0"})," Iniciar"]}):e.jsxs("button",{onClick:p=>{p.stopPropagation(),ge(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-[var(--gold)]/10 text-[var(--gold)] rounded-xl text-sm font-bold hover:bg-[var(--gold)]/20 transition-colors border border-[var(--gold)]/20",children:[e.jsx(Ce,{size:15,className:"shrink-0"})," Pausar"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),z(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--text-dim)] rounded-xl text-sm hover:text-[var(--text)] transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[e.jsx(Fe,{size:15,className:"shrink-0"})," Detener"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),te(t)},className:"inline-flex items-center justify-center gap-2 px-5 py-2.5 text-[var(--gold)] rounded-xl text-sm font-semibold hover:bg-[var(--gold)]/10 transition-colors",style:{background:"var(--surface-2)",border:"1px solid var(--gold)/20"},children:[e.jsx(Be,{size:15,className:"shrink-0"})," Ver GrÃ¡fico"]}),e.jsxs("button",{onClick:p=>{p.stopPropagation(),fe(t)},className:"ml-auto inline-flex items-center justify-center gap-1.5 px-4 py-2.5 text-[var(--text-dim)] hover:text-[var(--red)] hover:bg-[var(--red)]/10 rounded-xl text-sm transition-colors",children:[e.jsx($e,{size:14,className:"shrink-0"})," Eliminar"]})]})]},t.id)})}),R.length>0&&e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("button",{onClick:()=>de(t=>!t),className:"w-full flex items-center justify-between p-4 cursor-pointer hover:bg-[var(--gold)]/5 transition-colors",style:{borderBottom:A?"1px solid var(--border)":"none"},children:[e.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[var(--green)] animate-pulse"}),"Actividad en Vivo",e.jsxs("span",{className:"text-xs font-normal text-[var(--text-dim)] ml-1",children:["(",R.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[A&&e.jsx("span",{onClick:t=>{t.stopPropagation(),I([])},className:"text-sm text-[var(--text-dim)] hover:text-[var(--gold)] transition-colors px-3 py-1 rounded-lg hover:bg-[var(--gold)]/10",children:"Limpiar"}),e.jsx(Ie,{size:18,className:"text-[var(--text-dim)] transition-transform duration-300",style:{transform:A?"rotate(180deg)":"rotate(0deg)"}})]})]}),e.jsx(U,{initial:!1,children:A&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"overflow-hidden",children:e.jsx("div",{className:"max-h-56 overflow-y-auto p-4 space-y-1.5 font-mono text-xs",children:R.slice(-50).reverse().map((t,l)=>{var n;return e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:"text-[var(--text-dim)] shrink-0",children:t.time}),e.jsxs("span",{className:"text-[var(--gold)] shrink-0 font-semibold",children:["[",t.bot,"]"]}),e.jsx("span",{className:"text-[var(--text-secondary)]",children:t.message||`${(n=t.side)==null?void 0:n.toUpperCase()} ${t.quantity} @ $${t.price}`})]},l)})})})})]}),v.filter(t=>t.type==="custom_script").length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("h2",{className:"text-base font-bold flex items-center gap-2.5 min-w-0",children:[e.jsx(D,{size:18,className:"text-[#A855F7] shrink-0"})," Mis Estrategias"]}),e.jsxs("button",{onClick:()=>h(!0),className:"text-sm text-[var(--text-dim)] hover:text-[#A855F7] transition-colors flex items-center gap-1.5 shrink-0 px-3 py-1.5 rounded-xl hover:bg-[#A855F7]/10",children:[e.jsx(Q,{size:14})," Nueva"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:v.filter(t=>t.type==="custom_script").map(t=>{var l;return e.jsxs("div",{className:"rounded-xl p-4 transition-colors hover:bg-[var(--dark-3)] min-w-0",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-[var(--text)] flex items-center gap-2 min-w-0 truncate",children:[e.jsx(D,{size:14,className:"text-[#A855F7] shrink-0"})," ",e.jsx("span",{className:"truncate",children:t.name})]}),e.jsx("button",{onClick:()=>{w(t),h(!0)},className:"text-[var(--text-dim)] hover:text-[#A855F7] transition-colors shrink-0 p-1.5 rounded-lg hover:bg-[#A855F7]/10",children:e.jsx(Oe,{size:14})})]}),e.jsxs("p",{className:"text-xs text-[var(--text-dim)] truncate",children:[((l=t.code)==null?void 0:l.split(`
`).filter(n=>n.trim()&&!n.trim().startsWith("//")).length)||0," lÃ­neas de lÃ³gica"]}),e.jsxs("p",{className:"text-[11px] text-[var(--text-dim)] mt-1.5 truncate",children:["Creada: ",new Date(t.createdAt).toLocaleDateString("es")]})]},t.id)})})]}),e.jsx(U,{children:m&&e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(8px)"},onClick:()=>{h(!1),w(null)},children:e.jsx(T.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsx(Ee,{initialCode:f==null?void 0:f.code,initialName:f==null?void 0:f.name,editMode:!!f,onClose:()=>{h(!1),w(null)},onSave:t=>{const l=P(t);x(n=>({...n,scriptStrategyId:l.id})),h(!1),w(null)}})})})})]})}export{Ye as default};
//# sourceMappingURL=BotManager-DBx92UCh.js.map
