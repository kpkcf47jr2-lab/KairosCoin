{"version":3,"file":"MultiChart-Bjbn2zfo.js","sources":["../../src/components/Chart/MultiChart.jsx"],"sourcesContent":["// Kairos Trade — Multi-Chart Layout (Elite Feature)\n// Display 2x2 or 1x2 charts with different timeframes simultaneously\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { createChart, ColorType, CrosshairMode } from 'lightweight-charts';\nimport { TIMEFRAMES, POPULAR_PAIRS } from '../../constants';\nimport { calculateEMA, calculateSMA } from '../../services/indicators';\nimport marketData from '../../services/marketData';\nimport { toApiPair, formatPair, QUOTE } from '../../utils/pairUtils';\nimport useStore from '../../store/useStore';\nimport { Grid3x3, Columns, Rows, Maximize2, Minimize2, RefreshCw } from 'lucide-react';\n\n// Single mini chart component\nfunction MiniChart({ pair, timeframe, height = 300, onPriceUpdate }) {\n  const containerRef = useRef(null);\n  const chartRef = useRef(null);\n  const candleRef = useRef(null);\n  const emaRef = useRef(null);\n  const wsRef = useRef(null);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const rect = container.getBoundingClientRect();\n    const chart = createChart(container, {\n      width: rect.width || 400,\n      height: height - 30,\n      layout: {\n        background: { type: ColorType.Solid, color: '#0B0E11' },\n        textColor: '#848E9C',\n        fontFamily: 'Inter, sans-serif',\n        fontSize: 10,\n      },\n      grid: {\n        vertLines: { color: '#1E222D' },\n        horzLines: { color: '#1E222D' },\n      },\n      crosshair: { mode: CrosshairMode.Normal },\n      timeScale: {\n        borderColor: '#1E222D',\n        timeVisible: true,\n        secondsVisible: false,\n      },\n      rightPriceScale: { borderColor: '#1E222D' },\n    });\n\n    const candleSeries = chart.addCandlestickSeries({\n      upColor: '#0ECB81',\n      downColor: '#F6465D',\n      borderDownColor: '#F6465D',\n      borderUpColor: '#0ECB81',\n      wickDownColor: '#F6465D',\n      wickUpColor: '#0ECB81',\n    });\n\n    const emaSeries = chart.addLineSeries({\n      color: '#D4AF37',\n      lineWidth: 1,\n      priceLineVisible: false,\n      lastValueVisible: false,\n    });\n\n    chartRef.current = chart;\n    candleRef.current = candleSeries;\n    emaRef.current = emaSeries;\n\n    // Load data\n    const apiPair = toApiPair(pair);\n    marketData.getCandles(apiPair, timeframe, 200).then(candles => {\n      if (candles && candles.length > 0) {\n        const chartData = candles.map(c => ({\n          time: Math.floor(c.time / 1000),\n          open: c.open,\n          high: c.high,\n          low: c.low,\n          close: c.close,\n        }));\n        candleSeries.setData(chartData);\n\n        // EMA 20\n        const closes = candles.map(c => c.close);\n        const ema20 = calculateEMA(closes, 20);\n        const emaData = ema20\n          .map((v, i) => v ? { time: chartData[i]?.time, value: v } : null)\n          .filter(Boolean);\n        emaSeries.setData(emaData);\n\n        chart.timeScale().fitContent();\n\n        // Update price\n        const last = candles[candles.length - 1];\n        if (last && onPriceUpdate) {\n          onPriceUpdate(last.close);\n        }\n      }\n    }).catch(() => {});\n\n    // WebSocket for live updates\n    const wsSymbol = apiPair.toLowerCase();\n    const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${wsSymbol}@kline_${timeframe}`);\n    ws.onmessage = (evt) => {\n      try {\n        const data = JSON.parse(evt.data);\n        if (data.k) {\n          const candle = {\n            time: Math.floor(data.k.t / 1000),\n            open: parseFloat(data.k.o),\n            high: parseFloat(data.k.h),\n            low: parseFloat(data.k.l),\n            close: parseFloat(data.k.c),\n          };\n          candleSeries.update(candle);\n          if (onPriceUpdate) onPriceUpdate(candle.close);\n        }\n      } catch {}\n    };\n    wsRef.current = ws;\n\n    // Resize\n    const ro = new ResizeObserver(() => {\n      const r = container.getBoundingClientRect();\n      if (r.width > 0 && r.height > 0) {\n        try { chart.applyOptions({ width: r.width, height: r.height - 30 }); } catch (e) { /* disposed */ }\n      }\n    });\n    ro.observe(container);\n\n    return () => {\n      ro.disconnect();\n      ws.close();\n      chart.remove();\n    };\n  }, [pair, timeframe, height]);\n\n  return (\n    <div className=\"flex-1 min-w-0 min-h-0 flex flex-col bg-[var(--dark)] border border-[var(--border)] rounded-lg overflow-hidden\">\n      {/* Mini header */}\n      <div className=\"flex items-center justify-between px-2 py-1 bg-[var(--dark-2)] border-b border-[var(--border)]\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xs font-bold text-[var(--gold)]\">{formatPair(pair)}</span>\n          <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-white/5 text-[var(--text-dim)] font-mono\">{timeframe}</span>\n        </div>\n      </div>\n      <div ref={containerRef} className=\"flex-1 min-h-0\" />\n    </div>\n  );\n}\n\n// Layout presets\nconst LAYOUTS = {\n  '2x2': { cols: 2, rows: 2, label: '2×2', icon: Grid3x3 },\n  '1x2': { cols: 2, rows: 1, label: '1×2', icon: Columns },\n  '2x1': { cols: 1, rows: 2, label: '2×1', icon: Rows },\n  '1x3': { cols: 3, rows: 1, label: '1×3', icon: Columns },\n};\n\nconst DEFAULT_CHARTS = [\n  { pair: 'BTCKAIROS', timeframe: '1m' },\n  { pair: 'BTCKAIROS', timeframe: '5m' },\n  { pair: 'BTCKAIROS', timeframe: '15m' },\n  { pair: 'BTCKAIROS', timeframe: '1h' },\n];\n\nexport default function MultiChart() {\n  const { selectedPair } = useStore();\n  const [layout, setLayout] = useState('2x2');\n  const [charts, setCharts] = useState(() => {\n    const pair = selectedPair || 'BTCKAIROS';\n    return [\n      { pair, timeframe: '1m' },\n      { pair, timeframe: '5m' },\n      { pair, timeframe: '15m' },\n      { pair, timeframe: '1h' },\n    ];\n  });\n  const [prices, setPrices] = useState({});\n\n  const layoutConfig = LAYOUTS[layout];\n  const visibleCharts = charts.slice(0, layoutConfig.cols * layoutConfig.rows);\n\n  const updateTimeframe = (index, tf) => {\n    setCharts(prev => prev.map((c, i) => i === index ? { ...c, timeframe: tf } : c));\n  };\n\n  const updatePair = (index, pair) => {\n    setCharts(prev => prev.map((c, i) => i === index ? { ...c, pair } : c));\n  };\n\n  const syncAllPairs = () => {\n    const pair = selectedPair || 'BTCKAIROS';\n    setCharts(prev => prev.map(c => ({ ...c, pair })));\n  };\n\n  return (\n    <div className=\"flex-1 flex flex-col overflow-hidden\">\n      {/* Toolbar */}\n      <div className=\"flex items-center gap-2 px-3 py-2 bg-[var(--dark-2)] border-b border-[var(--border)] shrink-0\">\n        <span className=\"text-xs font-bold text-[var(--gold)] mr-2\">Multi-Chart</span>\n        \n        {/* Layout buttons */}\n        <div className=\"flex gap-1 bg-[var(--dark)] rounded-lg p-0.5\">\n          {Object.entries(LAYOUTS).map(([key, cfg]) => {\n            const Icon = cfg.icon;\n            return (\n              <button\n                key={key}\n                onClick={() => setLayout(key)}\n                className={`px-2 py-1 text-[10px] font-bold rounded-md flex items-center gap-1 transition-colors\n                  ${layout === key ? 'bg-[var(--gold)]/20 text-[var(--gold)]' : 'text-[var(--text-dim)] hover:text-[var(--text)]'}`}\n              >\n                <Icon size={12} /> {cfg.label}\n              </button>\n            );\n          })}\n        </div>\n\n        <div className=\"flex-1\" />\n\n        {/* Sync button */}\n        <button\n          onClick={syncAllPairs}\n          className=\"flex items-center gap-1 px-2 py-1 text-[10px] font-bold rounded-lg bg-[var(--gold)]/10 text-[var(--gold)] hover:bg-[var(--gold)]/20 transition-colors\"\n        >\n          <RefreshCw size={11} /> Sync Par\n        </button>\n\n        {/* Per-chart timeframe selectors */}\n        {visibleCharts.map((chart, i) => (\n          <select\n            key={i}\n            value={chart.timeframe}\n            onChange={(e) => updateTimeframe(i, e.target.value)}\n            className=\"text-[10px] bg-[var(--dark)] border border-[var(--border)] rounded px-1 py-0.5 text-[var(--text-dim)]\"\n            title={`Chart ${i + 1}`}\n          >\n            {TIMEFRAMES.map(tf => (\n              <option key={tf.value} value={tf.value}>{tf.label}</option>\n            ))}\n          </select>\n        ))}\n      </div>\n\n      {/* Chart Grid */}\n      <div\n        className=\"flex-1 min-h-0 p-1 gap-1\"\n        style={{\n          display: 'grid',\n          gridTemplateColumns: `repeat(${layoutConfig.cols}, 1fr)`,\n          gridTemplateRows: `repeat(${layoutConfig.rows}, 1fr)`,\n        }}\n      >\n        {visibleCharts.map((chart, i) => (\n          <MiniChart\n            key={`${chart.pair}-${chart.timeframe}-${i}-${layout}`}\n            pair={chart.pair}\n            timeframe={chart.timeframe}\n            onPriceUpdate={(price) => setPrices(p => ({ ...p, [i]: price }))}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":["MiniChart","pair","timeframe","height","onPriceUpdate","containerRef","useRef","chartRef","candleRef","emaRef","wsRef","useEffect","container","rect","chart","createChart","ColorType","CrosshairMode","candleSeries","emaSeries","apiPair","toApiPair","marketData","candles","chartData","c","closes","emaData","calculateEMA","v","i","_a","last","wsSymbol","ws","evt","data","candle","ro","r","jsxs","jsx","formatPair","LAYOUTS","Grid3x3","Columns","Rows","MultiChart","selectedPair","useStore","layout","setLayout","useState","charts","setCharts","prices","setPrices","layoutConfig","visibleCharts","updateTimeframe","index","tf","prev","syncAllPairs","key","cfg","Icon","RefreshCw","e","TIMEFRAMES","price","p"],"mappings":"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"}