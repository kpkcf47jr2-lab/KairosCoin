import{j as e,e as f,a3 as O,a1 as B,a2 as I,az as J,av as Q,x as U,k as _,m as q,aA as G,aB as H,aC as W,X,a4 as K}from"./ui-BpW-uvdI.js";import{a as i}from"./vendor-CUCP814w.js";import{u as V}from"./index-CXTbE7Aj.js";const Y=["ðŸ˜Ž Confiado","ðŸ˜° Nervioso","ðŸ¤” Dudoso","ðŸ˜¤ Impulsivo","ðŸ§˜ Disciplinado","ðŸŽ¯ Enfocado"],w=["Breakout","Pullback","Reversal","Scalp","Swing","Trend Following","Mean Reversion","News"];function re(){const{tradeHistory:b}=V(),[c,y]=i.useState(""),[Z,ee]=i.useState(null),[o,S]=i.useState(()=>{try{return JSON.parse(localStorage.getItem("kairos_journal")||"{}")}catch{return{}}}),[x,k]=i.useState("all"),[m,C]=i.useState("date"),[T,z]=i.useState(null),L=(t,s)=>{const r={...o,[t]:{...o[t],...s,updatedAt:Date.now()}};S(r),localStorage.setItem("kairos_journal",JSON.stringify(r))},d=i.useMemo(()=>{let t=[...b||[]];if(c){const s=c.toLowerCase();t=t.filter(r=>{var l,n;return(r.pair||r.symbol||"").toLowerCase().includes(s)||(r.botName||"").toLowerCase().includes(s)||(((l=o[r.id])==null?void 0:l.note)||"").toLowerCase().includes(s)||(((n=o[r.id])==null?void 0:n.tags)||[]).some(p=>p.toLowerCase().includes(s))})}return x!=="all"&&(t=t.filter(s=>{var r;return(((r=o[s.id])==null?void 0:r.tags)||[]).includes(x)})),t.sort((s,r)=>{var l,n;return m==="pnl"?Math.abs(r.pnl||0)-Math.abs(s.pnl||0):m==="rating"?(((l=o[r.id])==null?void 0:l.rating)||0)-(((n=o[s.id])==null?void 0:n.rating)||0):new Date(r.closedAt||r.time||0)-new Date(s.closedAt||s.time||0)}),t},[b,c,x,m,o]),$=i.useMemo(()=>{const t=new Set;return Object.values(o).forEach(s=>(s.tags||[]).forEach(r=>t.add(r))),Array.from(t)},[o]),A=({trade:t})=>{const s=o[t.id]||{},[r,l]=i.useState(s.note||""),[n,p]=i.useState(s.tags||[]),[u,D]=i.useState(s.emotion||""),[h,E]=i.useState(s.setup||""),[g,M]=i.useState(s.rating||0),[j,P]=i.useState(s.lesson||""),F=()=>{L(t.id,{note:r,tags:n,emotion:u,setup:h,rating:g,lesson:j})},N=a=>{p(v=>v.includes(a)?v.filter(R=>R!==a):[...v,a])};return e.jsx(q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"p-4 bg-[var(--dark)] border-t border-[var(--border)] space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[var(--text-dim)]",children:"Entrada"}),e.jsxs("p",{className:"font-mono font-bold",children:["$",(t.entryPrice||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[var(--text-dim)]",children:"Salida"}),e.jsxs("p",{className:"font-mono font-bold",children:["$",(t.exitPrice||0).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[var(--text-dim)]",children:"DuraciÃ³n"}),e.jsx("p",{className:"font-bold",children:t.closedAt&&t.time?(()=>{const a=new Date(t.closedAt)-new Date(t.time);return a<6e4?`${Math.round(a/1e3)}s`:a<36e5?`${Math.round(a/6e4)}m`:`${(a/36e5).toFixed(1)}h`})():"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[var(--text-dim)]",children:"Bot"}),e.jsx("p",{className:"font-bold",children:t.botName||"â€”"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"CalificaciÃ³n del Trade"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("button",{onClick:()=>M(a),className:"transition-colors",children:a<=g?e.jsx(G,{size:16,className:"text-[var(--gold)] fill-[var(--gold)]"}):e.jsx(H,{size:16,className:"text-[var(--text-dim)]"})},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"Estado Emocional"}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Y.map(a=>e.jsx("button",{onClick:()=>D(u===a?"":a),className:`px-2 py-1 text-[10px] rounded-full transition-colors ${u===a?"bg-[var(--gold)]/20 text-[var(--gold)] border border-[var(--gold)]/30":"bg-white/5 text-[var(--text-dim)] border border-[var(--border)]"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"Tipo de Setup"}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:w.map(a=>e.jsx("button",{onClick:()=>E(h===a?"":a),className:`px-2 py-1 text-[10px] rounded-full transition-colors ${h===a?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-white/5 text-[var(--text-dim)] border border-[var(--border)]"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"Tags Personalizados"}),e.jsxs("div",{className:"flex gap-1.5 flex-wrap",children:[n.map(a=>e.jsxs("span",{className:"px-2 py-0.5 text-[10px] bg-purple-500/20 text-purple-400 rounded-full flex items-center gap-1",children:[e.jsx(W,{size:8})," ",a,e.jsx("button",{onClick:()=>N(a),className:"hover:text-white",children:e.jsx(X,{size:10})})]},a)),e.jsxs("button",{onClick:()=>{const a=prompt("Nombre del tag:");a!=null&&a.trim()&&N(a.trim())},className:"px-2 py-0.5 text-[10px] bg-white/5 text-[var(--text-dim)] rounded-full flex items-center gap-1 hover:bg-white/10",children:[e.jsx(K,{size:10})," Tag"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"Notas del Trade"}),e.jsx("textarea",{value:r,onChange:a=>l(a.target.value),placeholder:"Â¿Por quÃ© tomaste este trade? Â¿QuÃ© observaste?",className:"w-full bg-[var(--dark-2)] border border-[var(--border)] rounded-lg p-2 text-xs h-20 resize-none focus:border-[var(--gold)]/50 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-dim)] block mb-1",children:"ðŸ“š LecciÃ³n Aprendida"}),e.jsx("textarea",{value:j,onChange:a=>P(a.target.value),placeholder:"Â¿QuÃ© harÃ­as diferente la prÃ³xima vez?",className:"w-full bg-[var(--dark-2)] border border-[var(--border)] rounded-lg p-2 text-xs h-16 resize-none focus:border-[var(--gold)]/50 outline-none"})]}),e.jsx("button",{onClick:F,className:"w-full py-2 bg-[var(--gold)] text-white font-bold text-sm rounded-xl hover:bg-[var(--gold-light)] transition-colors",children:"Guardar Notas"})]})})};return e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(f,{size:22,className:"text-[var(--gold)]"})," Trade Journal"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Documenta, analiza y mejora tu trading"})]}),e.jsxs("div",{className:"text-sm text-[var(--text-dim)]",children:[d.length," trades"]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-[var(--dark-2)] border border-[var(--border)] rounded-lg px-2 py-1.5 flex-1 min-w-[200px] max-w-[300px]",children:[e.jsx(O,{size:14,className:"text-[var(--text-dim)]"}),e.jsx("input",{type:"text",value:c,onChange:t=>y(t.target.value),placeholder:"Buscar por par, bot, nota...",className:"bg-transparent text-xs outline-none flex-1"})]}),e.jsxs("select",{value:m,onChange:t=>C(t.target.value),className:"text-xs bg-[var(--dark-2)] border border-[var(--border)] rounded-lg px-2 py-1.5",children:[e.jsx("option",{value:"date",children:"MÃ¡s reciente"}),e.jsx("option",{value:"pnl",children:"Mayor P&L"}),e.jsx("option",{value:"rating",children:"Mejor valorado"})]}),e.jsxs("select",{value:x,onChange:t=>k(t.target.value),className:"text-xs bg-[var(--dark-2)] border border-[var(--border)] rounded-lg px-2 py-1.5",children:[e.jsx("option",{value:"all",children:"Todos los tags"}),$.map(t=>e.jsx("option",{value:t,children:t},t)),w.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),d.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"Win Rate",value:`${(d.filter(t=>t.pnl>0).length/d.length*100).toFixed(0)}%`,color:"text-emerald-400"},{label:"Con Notas",value:`${d.filter(t=>{var s;return(s=o[t.id])==null?void 0:s.note}).length}`,color:"text-[var(--gold)]"},{label:"Avg Rating",value:(()=>{const t=d.filter(s=>{var r;return((r=o[s.id])==null?void 0:r.rating)>0});return t.length>0?`${(t.reduce((s,r)=>s+o[r.id].rating,0)/t.length).toFixed(1)} â˜…`:"â€”"})(),color:"text-yellow-400"},{label:"Top Setup",value:(()=>{const t={};d.forEach(r=>{var n;const l=(n=o[r.id])==null?void 0:n.setup;l&&(t[l]=(t[l]||0)+1)});const s=Object.entries(t).sort((r,l)=>l[1]-r[1])[0];return s?s[0]:"â€”"})(),color:"text-blue-400"}].map((t,s)=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 text-center",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:t.label}),e.jsx("p",{className:`text-sm font-bold ${t.color}`,children:t.value})]},s))}),d.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center py-20 text-center",children:[e.jsx(f,{size:48,className:"text-[var(--text-dim)] mb-4"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Sin trades registrados"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Los trades se registran automÃ¡ticamente cuando tus bots ejecutan operaciones."})]}):e.jsx("div",{className:"space-y-1",children:d.map(t=>{const s=o[t.id]||{},r=T===t.id,l=t.pnl||0,n=l>0;return e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>z(r?null:t.id),className:"w-full flex items-center gap-3 p-3 text-left hover:bg-white/[0.02] transition-colors",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${n?"bg-emerald-500/15":"bg-red-500/15"}`,children:n?e.jsx(B,{size:16,className:"text-emerald-400"}):e.jsx(I,{size:16,className:"text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold font-mono",children:t.pair||t.symbol||"â€”"}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-bold ${t.side==="buy"?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:(t.side||"â€”").toUpperCase()}),s.rating>0&&e.jsx("span",{className:"text-[10px] text-yellow-400",children:"â˜…".repeat(s.rating)}),s.emotion&&e.jsx("span",{className:"text-[10px]",children:s.emotion.split(" ")[0]}),s.setup&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-500/10 text-blue-400",children:s.setup})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-[var(--text-dim)] mt-0.5",children:[e.jsx("span",{children:new Date(t.closedAt||t.time||Date.now()).toLocaleDateString("es",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}),e.jsxs("span",{children:["$",(t.entryPrice||0).toFixed(2)," â†’ $",(t.exitPrice||0).toFixed(2)]}),t.botName&&e.jsxs("span",{children:["ðŸ¤– ",t.botName]}),s.note&&e.jsx(J,{size:10,className:"text-[var(--gold)]"})]})]}),e.jsx("div",{className:"text-right shrink-0",children:e.jsxs("p",{className:`text-sm font-bold ${n?"text-emerald-400":"text-red-400"}`,children:[l>=0?"+":"","$",l.toFixed(2)]})}),r?e.jsx(Q,{size:14,className:"text-[var(--text-dim)]"}):e.jsx(U,{size:14,className:"text-[var(--text-dim)]"})]}),e.jsx(_,{children:r&&e.jsx(A,{trade:t})})]},t.id)})})]})}export{re as default};
