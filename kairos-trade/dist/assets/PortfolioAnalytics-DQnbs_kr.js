import{a as $,j as e,A as Q,B as z,a0 as V,a1 as X,T as H,w as _,Z as ee,a2 as te,S as se,aA as ae,a3 as le}from"./ui-BLPgSWIB.js";import{u as re}from"./index-DPT9_U4D.js";import"./vendor-4OCfwR-l.js";function oe({trades:g,height:w=280}){const M=$.useRef(null);return $.useEffect(()=>{const h=M.current;if(!h||g.length<1)return;const a=h.getContext("2d"),v=window.devicePixelRatio||1,D=h.getBoundingClientRect();h.width=D.width*v,h.height=D.height*v,a.scale(v,v);const P=D.width,p=D.height,s=1e3;let b=s;const f=[{x:0,y:s}];let y=s;const N=[0];g.forEach((n,x)=>{b+=n.pnl||0,y=Math.max(y,b);const c=y>0?(y-b)/y*100:0;N.push(c),f.push({x:x+1,y:b})});const t=Math.min(...f.map(n=>n.y)),o=Math.max(...f.map(n=>n.y)),i=o-t||1,l={top:20,bottom:40,left:60,right:20},m=P-l.left-l.right,u=p-l.top-l.bottom;a.clearRect(0,0,P,p),a.strokeStyle="rgba(255,255,255,0.04)",a.lineWidth=1;for(let n=0;n<=4;n++){const x=l.top+u/4*n;a.beginPath(),a.moveTo(l.left,x),a.lineTo(P-l.right,x),a.stroke(),a.fillStyle="rgba(255,255,255,0.3)",a.font="10px Inter, sans-serif",a.textAlign="right";const c=o-i/4*n;a.fillText(`$${c.toFixed(0)}`,l.left-8,x+3)}if(N.length>1){const n=Math.max(...N)||1;a.fillStyle="rgba(234,57,67,0.08)",a.beginPath(),a.moveTo(l.left,p-l.bottom),N.forEach((x,c)=>{const j=l.left+c/Math.max(N.length-1,1)*m,k=p-l.bottom-x/Math.max(n,1)*(u*.3);a.lineTo(j,k)}),a.lineTo(l.left+m,p-l.bottom),a.closePath(),a.fill()}a.strokeStyle="#D4AF37",a.lineWidth=2,a.beginPath(),f.forEach((n,x)=>{const c=l.left+n.x/Math.max(f.length-1,1)*m,j=l.top+(1-(n.y-t)/i)*u;x===0?a.moveTo(c,j):a.lineTo(c,j)}),a.stroke();const F=a.createLinearGradient(0,l.top,0,p-l.bottom);F.addColorStop(0,"rgba(212,175,55,0.15)"),F.addColorStop(1,"rgba(212,175,55,0)"),a.fillStyle=F,a.beginPath(),f.forEach((n,x)=>{const c=l.left+n.x/Math.max(f.length-1,1)*m,j=l.top+(1-(n.y-t)/i)*u;x===0?a.moveTo(c,j):a.lineTo(c,j)}),a.lineTo(l.left+m,p-l.bottom),a.lineTo(l.left,p-l.bottom),a.closePath(),a.fill();const T=f[f.length-1],R=l.left+T.x/Math.max(f.length-1,1)*m,A=l.top+(1-(T.y-t)/i)*u;a.fillStyle="#D4AF37",a.beginPath(),a.arc(R,A,4,0,Math.PI*2),a.fill(),a.fillStyle="rgba(255,255,255,0.3)",a.font="10px Inter, sans-serif",a.textAlign="center";const E=Math.max(1,Math.floor(g.length/6));for(let n=0;n<g.length;n+=E){const x=l.left+(n+1)/Math.max(f.length-1,1)*m,c=new Date(g[n].closedAt||g[n].time);a.fillText(c.toLocaleDateString("es",{day:"2-digit",month:"short"}),x,p-l.bottom+16)}},[g,w]),e.jsx("canvas",{ref:M,style:{width:"100%",height:w},className:"rounded-xl"})}function ne({wins:g,losses:w,neutral:M}){const h=g+w+M||1;return e.jsxs("div",{className:"flex h-2 rounded-full overflow-hidden bg-[var(--dark-4)]",children:[e.jsx("div",{style:{width:`${g/h*100}%`},className:"bg-emerald-500"}),e.jsx("div",{style:{width:`${M/h*100}%`},className:"bg-yellow-500/50"}),e.jsx("div",{style:{width:`${w/h*100}%`},className:"bg-red-500"})]})}function xe(){var y,N;const{tradeHistory:g,bots:w,brokers:M}=re(),[h,a]=$.useState("all"),[v,D]=$.useState("all"),P=$.useMemo(()=>[...g||[]].sort((o,i)=>{const l=new Date(o.closedAt||o.time||0).getTime(),m=new Date(i.closedAt||i.time||0).getTime();return l-m}),[g]),p=$.useMemo(()=>{let t=P;if(v!=="all"&&(t=t.filter(o=>o.botId===v||o.botName===v)),h==="today"){const o=new Date().setHours(0,0,0,0);t=t.filter(i=>new Date(i.closedAt||i.time).getTime()>=o)}else if(h==="7d"){const o=Date.now()-6048e5;t=t.filter(i=>new Date(i.closedAt||i.time).getTime()>=o)}else if(h==="30d"){const o=Date.now()-2592e6;t=t.filter(i=>new Date(i.closedAt||i.time).getTime()>=o)}return t},[P,h,v]),s=$.useMemo(()=>{const t=p;if(t.length===0)return null;const o=t.filter(r=>(r.pnl||0)>0),i=t.filter(r=>(r.pnl||0)<0),l=t.filter(r=>(r.pnl||0)===0),m=t.reduce((r,d)=>r+(d.pnl||0),0),u=o.reduce((r,d)=>r+d.pnl,0),F=i.reduce((r,d)=>r+Math.abs(d.pnl),0),T=o.length>0?u/o.length:0,R=i.length>0?F/i.length:0,A=o.length/t.length*100,E=F>0?u/F:u>0?1/0:0;let n=0,x=0,c=0;const j=[];t.forEach(r=>{c+=r.pnl||0,j.push(c),n=Math.max(n,c);const d=n>0?(n-c)/n*100:0;x=Math.max(x,d)});const k=t.map(r=>r.pnl||0),q=k.reduce((r,d)=>r+d,0)/k.length,Y=k.reduce((r,d)=>r+(d-q)**2,0)/k.length,I=Math.sqrt(Y),G=I>0?q/I*Math.sqrt(252):0,O=t.reduce((r,d)=>(d.pnl||0)>(r.pnl||0)?d:r,t[0]),U=t.reduce((r,d)=>(d.pnl||0)<(r.pnl||0)?d:r,t[0]);let S=0,C=0,L=0,B=0;t.forEach(r=>{r.pnl>0?(L++,B=0,S=Math.max(S,L)):r.pnl<0&&(B++,L=0,C=Math.max(C,B))});const Z=t.reduce((r,d)=>d.closedAt&&d.time?r+(new Date(d.closedAt).getTime()-new Date(d.time).getTime()):r,0)/Math.max(t.length,1),W={};t.forEach(r=>{const d=new Date(r.closedAt||r.time).toLocaleDateString();W[d]=(W[d]||0)+(r.pnl||0)});const J=R>0?T/R:T>0?1/0:0,K=A/100*T-(1-A/100)*R;return{totalTrades:t.length,wins:o.length,losses:i.length,neutral:l.length,totalPnl:m,winRate:A,avgWin:T,avgLoss:R,profitFactor:E,maxDrawdown:x,sharpeRatio:G,bestTrade:O,worstTrade:U,maxConsecWins:S,maxConsecLosses:C,equityCurve:j,avgHoldTime:Z,dailyPnl:W,riskReward:J,expectancy:K}},[p]),b=({icon:t,label:o,value:i,subtitle:l,color:m="var(--gold)",small:u=!1})=>e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-3 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[var(--text-dim)]",children:[e.jsx(t,{size:14,style:{color:m}}),e.jsx("span",{className:"text-xs",children:o})]}),e.jsx("p",{className:`font-bold ${u?"text-base":"text-lg"}`,style:{color:m},children:i}),l&&e.jsx("p",{className:"text-[10px] text-[var(--text-dim)]",children:l})]}),f=t=>t<6e4?`${Math.round(t/1e3)}s`:t<36e5?`${Math.round(t/6e4)}m`:t<864e5?`${(t/36e5).toFixed(1)}h`:`${(t/864e5).toFixed(1)}d`;return e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Q,{size:22,className:"text-[var(--gold)]"})," Portfolio Analytics"]}),e.jsx("p",{className:"text-sm text-[var(--text-dim)]",children:"Rendimiento detallado de tu trading"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:h,onChange:t=>a(t.target.value),className:"text-xs bg-[var(--dark-2)] border border-[var(--border)] rounded-lg px-2 py-1.5 text-[var(--text)]",children:[e.jsx("option",{value:"all",children:"Todo"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"7d",children:"7 días"}),e.jsx("option",{value:"30d",children:"30 días"})]}),e.jsxs("select",{value:v,onChange:t=>D(t.target.value),className:"text-xs bg-[var(--dark-2)] border border-[var(--border)] rounded-lg px-2 py-1.5 text-[var(--text)]",children:[e.jsx("option",{value:"all",children:"Todos los Bots"}),w.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[e.jsx(b,{icon:V,label:"P&L Total",value:`${s.totalPnl>=0?"+":""}$${s.totalPnl.toFixed(2)}`,color:s.totalPnl>=0?"#10B981":"#EF4444",subtitle:`${s.totalTrades} trades`}),e.jsx(b,{icon:X,label:"Win Rate",value:`${s.winRate.toFixed(1)}%`,color:s.winRate>=50?"#10B981":"#EF4444",subtitle:`${s.wins}W / ${s.losses}L`}),e.jsx(b,{icon:H,label:"Profit Factor",value:s.profitFactor===1/0?"∞":s.profitFactor.toFixed(2),color:s.profitFactor>=1?"#10B981":"#EF4444",subtitle:"Win$ / Loss$"}),e.jsx(b,{icon:_,label:"Max Drawdown",value:`${s.maxDrawdown.toFixed(1)}%`,color:s.maxDrawdown<10?"#10B981":s.maxDrawdown<25?"#F59E0B":"#EF4444",subtitle:"Caída máxima"}),e.jsx(b,{icon:ee,label:"Sharpe Ratio",value:s.sharpeRatio.toFixed(2),color:s.sharpeRatio>=1?"#10B981":s.sharpeRatio>=0?"#F59E0B":"#EF4444",subtitle:s.sharpeRatio>=2?"Excelente":s.sharpeRatio>=1?"Bueno":"Mejorable"}),e.jsx(b,{icon:te,label:"Expectancy",value:`$${s.expectancy.toFixed(2)}`,color:s.expectancy>=0?"#10B981":"#EF4444",subtitle:"$ esperado/trade"})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-[var(--gold)]"})," Curva de Equity"]}),e.jsxs("div",{className:"text-xs text-[var(--text-dim)]",children:[p.length," trades • Drawdown en rojo"]})]}),e.jsx(oe,{trades:p})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(z,{size:14,className:"text-[var(--gold)]"})," Distribución"]}),e.jsx(ne,{wins:s.wins,losses:s.losses,neutral:s.neutral}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-emerald-400",children:[s.wins," wins (",s.winRate.toFixed(0),"%)"]}),s.neutral>0&&e.jsxs("span",{className:"text-yellow-400",children:[s.neutral," neutral"]}),e.jsxs("span",{className:"text-red-400",children:[s.losses," losses (",(100-s.winRate).toFixed(0),"%)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-1",children:"Avg Win"}),e.jsxs("p",{className:"text-emerald-400 font-bold",children:["+$",s.avgWin.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-1",children:"Avg Loss"}),e.jsxs("p",{className:"text-red-400 font-bold",children:["-$",s.avgLoss.toFixed(2)]})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-1",children:"Max Wins Seguidos"}),e.jsx("p",{className:"text-emerald-400 font-bold",children:s.maxConsecWins})]}),e.jsxs("div",{className:"bg-[var(--dark)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-[var(--text-dim)] mb-1",children:"Max Losses Seguidos"}),e.jsx("p",{className:"text-red-400 font-bold",children:s.maxConsecLosses})]})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[e.jsx(se,{size:14,className:"text-[var(--gold)]"})," Métricas Clave"]}),[{label:"Risk/Reward Ratio",value:s.riskReward===1/0?"∞":`1:${s.riskReward.toFixed(2)}`,good:s.riskReward>=1.5},{label:"Profit Factor",value:s.profitFactor===1/0?"∞":s.profitFactor.toFixed(2),good:s.profitFactor>=1.5},{label:"Tiempo Prom. en Trade",value:f(s.avgHoldTime),neutral:!0},{label:"Mejor Trade",value:`+$${(((y=s.bestTrade)==null?void 0:y.pnl)||0).toFixed(2)}`,good:!0},{label:"Peor Trade",value:`-$${Math.abs(((N=s.worstTrade)==null?void 0:N.pnl)||0).toFixed(2)}`,good:!1},{label:"Expectancy por Trade",value:`$${s.expectancy.toFixed(2)}`,good:s.expectancy>0}].map((t,o)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-[var(--border)] last:border-0",children:[e.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:t.label}),e.jsx("span",{className:`text-sm font-bold ${t.neutral?"text-[var(--text)]":t.good?"text-emerald-400":"text-red-400"}`,children:t.value})]},o))]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2 mb-3",children:[e.jsx(ae,{size:14,className:"text-[var(--gold)]"})," P&L Diario"]}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:Object.entries(s.dailyPnl).slice(-60).map(([t,o],i)=>{const l=Math.min(Math.abs(o)/(Math.max(...Object.values(s.dailyPnl).map(Math.abs))||1),1),m=o>=0?`rgba(16,185,129,${.15+l*.6})`:`rgba(239,68,68,${.15+l*.6})`;return e.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center text-[8px] font-bold cursor-default group relative",style:{background:m},title:`${t}: ${o>=0?"+":""}$${o.toFixed(2)}`,children:new Date(t).getDate()},i)})}),e.jsxs("div",{className:"flex gap-4 mt-2 text-[10px] text-[var(--text-dim)]",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-emerald-500/30"})," Ganancia"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500/30"})," Pérdida"]}),e.jsx("span",{children:"Más intenso = mayor monto"})]})]}),e.jsxs("div",{className:"bg-[var(--dark-2)] border border-[var(--border)] rounded-xl p-4",children:[e.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2 mb-3",children:[e.jsx(le,{size:14,className:"text-[var(--gold)]"})," Últimos Trades"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[var(--text-dim)] border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Par"}),e.jsx("th",{className:"text-left py-2 px-2",children:"Lado"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entrada"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Salida"}),e.jsx("th",{className:"text-right py-2 px-2",children:"P&L"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Fecha"})]})}),e.jsx("tbody",{children:p.slice(-20).reverse().map((t,o)=>e.jsxs("tr",{className:"border-b border-[var(--border)]/50 hover:bg-white/[0.02]",children:[e.jsx("td",{className:"py-2 px-2 font-mono",children:t.pair||t.symbol||"—"}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${t.side==="buy"?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:(t.side||"—").toUpperCase()})}),e.jsxs("td",{className:"py-2 px-2 text-right font-mono",children:["$",(t.entryPrice||0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-2 text-right font-mono",children:["$",(t.exitPrice||0).toFixed(2)]}),e.jsxs("td",{className:`py-2 px-2 text-right font-bold ${(t.pnl||0)>=0?"text-emerald-400":"text-red-400"}`,children:[(t.pnl||0)>=0?"+":"","$",(t.pnl||0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-2 text-right text-[var(--text-dim)]",children:new Date(t.closedAt||t.time||Date.now()).toLocaleDateString("es",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]},o))})]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center py-20 text-center",children:[e.jsx(z,{size:48,className:"text-[var(--text-dim)] mb-4"}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Sin datos de trading aún"}),e.jsx("p",{className:"text-sm text-[var(--text-dim)] max-w-md",children:"Activa tus bots o ejecuta trades manuales para ver analytics detallados aquí."})]})]})}export{xe as default};
//# sourceMappingURL=PortfolioAnalytics-DQnbs_kr.js.map
