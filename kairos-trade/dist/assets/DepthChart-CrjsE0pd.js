import{j as a,m as J,B as K}from"./ui-CebUoxKF.js";import{a as h}from"./vendor-CUCP814w.js";import{a as O}from"./index-GzHEPH3k.js";import{m as Q}from"./marketData-K1zKCjjj.js";function st({pair:w="BTCUSDT",height:C=260}){const v=h.useRef(null),[u,X]=h.useState(null),[x,B]=h.useState(null),A=h.useRef(null),y=h.useCallback(async()=>{try{const n=O(w),t=await Q._getAPI(),c=await fetch(`${t}/depth?symbol=${n}&limit=100`);if(!c.ok)return;const m=await c.json();X(m)}catch{}},[w]);h.useEffect(()=>{y();const n=setInterval(y,3e3);return()=>clearInterval(n)},[y]);const D=h.useCallback(()=>{var W,E;const n=v.current;if(!n||!u)return;const t=n.getContext("2d"),c=window.devicePixelRatio||1,m=n.clientWidth,d=n.clientHeight;n.width=m*c,n.height=d*c,t.scale(c,c),t.clearRect(0,0,m,d);const T=u.bids.map(([e,o])=>[parseFloat(e),parseFloat(o)]),k=u.asks.map(([e,o])=>[parseFloat(e),parseFloat(o)]);if(!T.length||!k.length)return;const l=[];let N=0;for(const[e,o]of T)N+=o,l.push([e,N]);const i=[];let M=0;for(const[e,o]of k)M+=o,i.push([e,M]);const j=(T[0][0]+k[0][0])/2,U=Math.max(((W=l[l.length-1])==null?void 0:W[1])||0,((E=i[i.length-1])==null?void 0:E[1])||0),$=[...l.map(e=>e[0]),...i.map(e=>e[0])],g=Math.min(...$),R=Math.max(...$),L=R-g||1,s={top:10,bottom:25,left:0,right:0},Y=m-s.left-s.right,I=d-s.top-s.bottom,r=e=>s.left+(e-g)/L*Y,f=e=>s.top+I-e/U*I;t.beginPath(),t.moveTo(r(l[0][0]),f(0));for(const[e,o]of l)t.lineTo(r(e),f(o));t.lineTo(r(l[l.length-1][0]),f(0)),t.closePath();const P=t.createLinearGradient(0,0,0,d);P.addColorStop(0,"rgba(0,220,130,0.25)"),P.addColorStop(1,"rgba(0,220,130,0.02)"),t.fillStyle=P,t.fill(),t.beginPath();for(let e=0;e<l.length;e++){const[o,p]=l[e];e===0?t.moveTo(r(o),f(p)):t.lineTo(r(o),f(p))}t.strokeStyle="#00DC82",t.lineWidth=1.5,t.stroke(),t.beginPath(),t.moveTo(r(i[0][0]),f(0));for(const[e,o]of i)t.lineTo(r(e),f(o));t.lineTo(r(i[i.length-1][0]),f(0)),t.closePath();const S=t.createLinearGradient(0,0,0,d);S.addColorStop(0,"rgba(255,59,48,0.25)"),S.addColorStop(1,"rgba(255,59,48,0.02)"),t.fillStyle=S,t.fill(),t.beginPath();for(let e=0;e<i.length;e++){const[o,p]=i[e];e===0?t.moveTo(r(o),f(p)):t.lineTo(r(o),f(p))}t.strokeStyle="#FF3B30",t.lineWidth=1.5,t.stroke();const F=r(j);if(t.beginPath(),t.setLineDash([4,4]),t.moveTo(F,s.top),t.lineTo(F,d-s.bottom),t.strokeStyle="#3B82F680",t.lineWidth=1,t.stroke(),t.setLineDash([]),t.fillStyle="#3B82F6",t.font="600 10px Inter, sans-serif",t.textAlign="center",t.fillText(`$${j.toFixed(2)}`,F,d-s.bottom+14),t.fillStyle="#555",t.font="9px Inter, sans-serif",t.textAlign="left",t.fillText(`$${g.toFixed(0)}`,s.left+4,d-s.bottom+14),t.textAlign="right",t.fillText(`$${R.toFixed(0)}`,m-s.right-4,d-s.bottom+14),x&&x.x>=0&&x.x<=m){const e=g+x.x/m*L,o=e<j,p=o?l:i;let G=0;for(const[H,_]of p)(o?H>=e:H<=e)&&(G=_);t.beginPath(),t.setLineDash([2,2]),t.moveTo(x.x,s.top),t.lineTo(x.x,d-s.bottom),t.strokeStyle="rgba(255,255,255,0.15)",t.lineWidth=1,t.stroke(),t.setLineDash([]);const q=`$${e.toFixed(2)} — Vol: ${G.toFixed(4)}`,b=t.measureText(q).width+16,V=Math.min(x.x-b/2,m-b-4);t.fillStyle="#1A1B1E",t.strokeStyle="rgba(59,130,246,0.3)",t.lineWidth=1,t.beginPath(),t.roundRect(Math.max(V,4),s.top,b,22,4),t.fill(),t.stroke(),t.fillStyle="#fff",t.font="10px Inter, sans-serif",t.textAlign="center",t.fillText(q,Math.max(V,4)+b/2,s.top+15)}},[u,x]);h.useEffect(()=>(A.current=requestAnimationFrame(D),()=>cancelAnimationFrame(A.current)),[D]);const z=n=>{var c;const t=(c=v.current)==null?void 0:c.getBoundingClientRect();t&&B({x:n.clientX-t.left,y:n.clientY-t.top})};return a.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-xl overflow-hidden relative",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5",style:{borderBottom:"1px solid var(--border)"},children:[a.jsxs("h3",{className:"text-xs font-bold flex items-center gap-2 text-[var(--text-secondary)]",children:[a.jsx(K,{size:14,className:"text-[var(--gold)]"})," Depth Chart"]}),a.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00DC82]"})," Bids"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-[#FF3B30]"})," Asks"]})]})]}),u?a.jsx("canvas",{ref:v,style:{width:"100%",height:C},onMouseMove:z,onMouseLeave:()=>B(null),className:"cursor-crosshair"}):a.jsx("div",{className:"flex items-center justify-center",style:{height:C},children:a.jsx("span",{className:"text-xs text-[var(--text-dim)]",children:"Cargando profundidad…"})})]})}export{st as default};
