{"version":3,"file":"KairosBroker-PkX7snla.js","sources":["../../src/components/Kairos/KairosBroker.jsx"],"sourcesContent":["// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n//  Kairos Trade â€” Kairos Broker (DEX Perpetual Trading)\n//  Dual execution: DEX mode (Kairos Exchange) or Internal margin engine\n//  KAIROS locked as collateral â†’ Orders routed to Kairos Exchange â†’ Real P&L\n//  Smart contract: KairosPerps â€¢ Liquidation on-chain\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nimport { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  TrendingUp, TrendingDown, Shield, Zap, DollarSign, Loader2,\n  AlertTriangle, CheckCircle2, ArrowUpRight, ArrowDownRight,\n  Wallet, Lock, BarChart3, Target, Activity, History,\n  RefreshCw, Plus, Minus, X, Eye, ChevronDown,\n  ChevronUp, Settings\n} from 'lucide-react';\nimport { createChart, ColorType, CrosshairMode } from 'lightweight-charts';\nimport { ethers } from 'ethers';\nimport useStore from '../../store/useStore';\nimport { API_HOST } from '../../constants';\n\n// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nconst API_MARGIN = `${API_HOST}/api/margin`;  // Internal margin engine\nconst API_PERPS  = `${API_HOST}/api/perps`;   // DEX route â†’ Kairos Exchange\nconst PRICE_POLL_MS = 3000;\nconst ACCOUNT_POLL_MS = 5000;\nconst LEVERAGE_INTERNAL = [2, 3, 5, 10];\nconst LEVERAGE_DEX = [2, 3, 5, 10, 20, 50];\n\nconst PAIR_ICONS = {\n  'BTC/KAIROS': 'â‚¿', 'ETH/KAIROS': 'Î', 'BNB/KAIROS': 'â—†', 'SOL/KAIROS': 'â—',\n  'XRP/KAIROS': 'âœ•', 'DOGE/KAIROS': 'Ã', 'ADA/KAIROS': 'â‚³', 'AVAX/KAIROS': 'A',\n  'DOT/KAIROS': 'â—', 'LINK/KAIROS': 'â¬¡', 'UNI/KAIROS': 'ğŸ¦„', 'LTC/KAIROS': 'Å',\n  'ATOM/KAIROS': 'âš›', 'NEAR/KAIROS': 'N', 'APT/KAIROS': 'A', 'ARB/KAIROS': 'â—‡',\n  'SUI/KAIROS': 'ğŸ’§', 'SEI/KAIROS': 'S', 'AAVE/KAIROS': 'ğŸ‘»', 'OP/KAIROS': 'ğŸ”´',\n  'FIL/KAIROS': 'F', 'ALGO/KAIROS': 'A', 'ICP/KAIROS': 'âˆ', 'XLM/KAIROS': 'âœ¦',\n  'ETC/KAIROS': 'Îc', 'HBAR/KAIROS': 'â„', 'TIA/KAIROS': 'T', 'PEPE/KAIROS': 'ğŸ¸',\n  'SHIB/KAIROS': 'ğŸ•', 'BONK/KAIROS': 'ğŸ¶', 'RENDER/KAIROS': 'R', 'ENA/KAIROS': 'E',\n  'KAIROS/USDT': 'K',\n};\n\n// â”€â”€ API Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction createApi(base) {\n  return async function api(endpoint, options = {}) {\n    const url = `${base}${endpoint}`;\n    const res = await fetch(url, {\n      headers: { 'Content-Type': 'application/json', ...options.headers },\n      ...options,\n    });\n    const data = await res.json();\n    if (!res.ok || data.error) throw new Error(data.error || data.details?.join(', ') || `API error ${res.status}`);\n    return data;\n  };\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n//  MAIN COMPONENT\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nexport default function KairosBroker() {\n  const { showToast, user, login } = useStore();\n\n  // â”€â”€ Wallet from Kairos account (auto-connected) â”€â”€\n  const walletAddress = user?.walletAddress || '';\n  const isConnected = !!walletAddress;\n\n  // â”€â”€ Execution mode: 'dex' = Kairos Exchange, 'internal' = Kairos margin engine â”€â”€\n  const [execMode, setExecMode] = useState('dex');\n  const API_BASE = execMode === 'dex' ? API_PERPS : API_MARGIN;\n  const api = useMemo(() => createApi(API_BASE), [API_BASE]);\n  const LEVERAGE_OPTIONS = execMode === 'dex' ? LEVERAGE_DEX : LEVERAGE_INTERNAL;\n\n  // â”€â”€ Account state (from backend) â”€â”€\n  const [account, setAccount] = useState(null);\n  const [positions, setPositions] = useState([]);\n  const [tradeHistory, setTradeHistory] = useState([]);\n\n  // â”€â”€ Market data (from backend) â”€â”€\n  const [pairs, setPairs] = useState([]);\n  const [prices, setPrices] = useState({});\n  const [leverageTiers, setLeverageTiers] = useState({});\n\n  // â”€â”€ Trading form â”€â”€\n  const [selectedPair, setSelectedPair] = useState('BTC/KAIROS');\n  const [side, setSide] = useState('LONG');\n  const [leverage, setLeverage] = useState(2);\n  const [collateralInput, setCollateralInput] = useState('');\n  const [stopLoss, setStopLoss] = useState('');\n  const [takeProfit, setTakeProfit] = useState('');\n  const [showAdvanced, setShowAdvanced] = useState(false);\n\n  // â”€â”€ Deposit/Withdraw â”€â”€\n  const [depositAmount, setDepositAmount] = useState('');\n  const [withdrawAmount, setWithdrawAmount] = useState('');\n  const [showDeposit, setShowDeposit] = useState(false);\n\n  // â”€â”€ UI state â”€â”€\n  const [activeTab, setActiveTab] = useState('prices'); // 'prices' | 'trade' | 'history'\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLoadingAccount, setIsLoadingAccount] = useState(false);\n  const [closingPositionId, setClosingPositionId] = useState(null);\n\n  const priceIntervalRef = useRef(null);\n  const accountIntervalRef = useRef(null);\n\n  const numCollateral = parseFloat(collateralInput) || 0;\n  const currentPrice = prices[selectedPair.replace('/', '')]?.price || 0;\n  const positionSizeUsd = numCollateral * leverage;\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  DATA FETCHING â€” Real backend API calls\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  // Fetch prices (no auth needed)\n  const fetchPrices = useCallback(async () => {\n    try {\n      const data = await api('/prices');\n      setPrices(data.data || {});\n    } catch { /* silent â€” prices may not be ready yet */ }\n  }, []);\n\n  // Fetch pairs + tier info\n  const fetchPairs = useCallback(async () => {\n    try {\n      const data = await api('/pairs');\n      setPairs(data.data?.pairs || []);\n      if (data.data?.leverageTiers) setLeverageTiers(data.data.leverageTiers);\n    } catch { /* silent */ }\n  }, []);\n\n  // Fetch account (requires wallet)\n  const fetchAccount = useCallback(async () => {\n    if (!walletAddress) return;\n    try {\n      const data = await api(`/account?wallet=${walletAddress}`);\n      setAccount(data.data);\n    } catch { /* Account may not exist yet â€” that's OK */ }\n  }, [walletAddress]);\n\n  // Fetch open positions\n  const fetchPositions = useCallback(async () => {\n    if (!walletAddress) return;\n    try {\n      const data = await api(`/positions?wallet=${walletAddress}`);\n      setPositions(data.data || []);\n    } catch { /* silent */ }\n  }, [walletAddress]);\n\n  // Fetch trade history\n  const fetchHistory = useCallback(async () => {\n    if (!walletAddress) return;\n    try {\n      const data = await api(`/history?wallet=${walletAddress}&limit=30`);\n      setTradeHistory(data.data || []);\n    } catch { /* silent */ }\n  }, [walletAddress]);\n\n  // â”€â”€ Polling setup â”€â”€\n  useEffect(() => {\n    fetchPrices();\n    fetchPairs();\n    priceIntervalRef.current = setInterval(fetchPrices, PRICE_POLL_MS);\n    return () => clearInterval(priceIntervalRef.current);\n  }, [fetchPrices, fetchPairs]);\n\n  useEffect(() => {\n    if (!walletAddress) return;\n    setIsLoadingAccount(true);\n    Promise.all([fetchAccount(), fetchPositions(), fetchHistory()]).finally(() => setIsLoadingAccount(false));\n    accountIntervalRef.current = setInterval(() => {\n      fetchAccount();\n      fetchPositions();\n    }, ACCOUNT_POLL_MS);\n    return () => clearInterval(accountIntervalRef.current);\n  }, [walletAddress, fetchAccount, fetchPositions, fetchHistory]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  TRADING ACTIONS â€” All hit real backend endpoints\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  const handleDeposit = useCallback(async () => {\n    const amount = parseFloat(depositAmount);\n    if (!amount || amount <= 0) { showToast('Ingresa una cantidad vÃ¡lida', 'error'); return; }\n    setIsSubmitting(true);\n    try {\n      await api('/deposit', { method: 'POST', body: JSON.stringify({ wallet: walletAddress, amount }) });\n      showToast(`${amount} KAIROS depositados como colateral`, 'success');\n      setDepositAmount('');\n      fetchAccount();\n    } catch (err) {\n      showToast('Error: ' + err.message, 'error');\n    } finally {\n      setIsSubmitting(false);\n    }\n  }, [depositAmount, walletAddress, showToast, fetchAccount]);\n\n  const handleWithdraw = useCallback(async () => {\n    const amount = parseFloat(withdrawAmount);\n    if (!amount || amount <= 0) { showToast('Ingresa una cantidad vÃ¡lida', 'error'); return; }\n    setIsSubmitting(true);\n    try {\n      await api('/withdraw', { method: 'POST', body: JSON.stringify({ wallet: walletAddress, amount }) });\n      showToast(`${amount} KAIROS retirados del colateral`, 'success');\n      setWithdrawAmount('');\n      fetchAccount();\n    } catch (err) {\n      showToast('Error: ' + err.message, 'error');\n    } finally {\n      setIsSubmitting(false);\n    }\n  }, [withdrawAmount, walletAddress, showToast, fetchAccount]);\n\n  const handleOpenPosition = useCallback(async () => {\n    if (!numCollateral || numCollateral <= 0) { showToast('Ingresa colateral', 'error'); return; }\n    if (!currentPrice) { showToast('Esperando precios...', 'error'); return; }\n\n    setIsSubmitting(true);\n    try {\n      const body = {\n        wallet: walletAddress,\n        pair: selectedPair,\n        side,\n        leverage,\n        collateral: numCollateral,\n        orderType: 'MARKET',\n        stopLoss: stopLoss ? parseFloat(stopLoss) : null,\n        takeProfit: takeProfit ? parseFloat(takeProfit) : null,\n      };\n      const res = await api('/open', { method: 'POST', body: JSON.stringify(body) });\n      showToast(\n        `${side} ${selectedPair} abierta â€” ${leverage}x â€” $${positionSizeUsd.toLocaleString()} posiciÃ³n`,\n        'success'\n      );\n      setCollateralInput('');\n      setStopLoss('');\n      setTakeProfit('');\n      fetchAccount();\n      fetchPositions();\n    } catch (err) {\n      showToast('Error abriendo posiciÃ³n: ' + err.message, 'error');\n    } finally {\n      setIsSubmitting(false);\n    }\n  }, [walletAddress, selectedPair, side, leverage, numCollateral, currentPrice, stopLoss, takeProfit, positionSizeUsd, showToast, fetchAccount, fetchPositions]);\n\n  const handleClosePosition = useCallback(async (positionId) => {\n    setClosingPositionId(positionId);\n    try {\n      const res = await api('/close', { method: 'POST', body: JSON.stringify({ wallet: walletAddress, positionId }) });\n      const pnl = res.data?.realizedPnl || res.data?.pnl || 0;\n      showToast(\n        `PosiciÃ³n cerrada â€” P&L: ${pnl >= 0 ? '+' : ''}$${parseFloat(pnl).toFixed(2)}`,\n        pnl >= 0 ? 'success' : 'error'\n      );\n      fetchAccount();\n      fetchPositions();\n      fetchHistory();\n    } catch (err) {\n      showToast('Error cerrando posiciÃ³n: ' + err.message, 'error');\n    } finally {\n      setClosingPositionId(null);\n    }\n  }, [walletAddress, showToast, fetchAccount, fetchPositions, fetchHistory]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  COMPUTED VALUES\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  const totalUnrealizedPnl = useMemo(\n    () => positions.reduce((sum, p) => sum + (parseFloat(p.unrealizedPnl) || 0), 0),\n    [positions]\n  );\n\n  const liquidationPrice = useMemo(() => {\n    if (!numCollateral || !currentPrice) return null;\n    const maintenancePct = (leverageTiers[leverage]?.maintenanceMarginPct || 25) / 100;\n    if (side === 'LONG') {\n      return currentPrice * (1 - (1 / leverage) + maintenancePct / leverage);\n    }\n    return currentPrice * (1 + (1 / leverage) - maintenancePct / leverage);\n  }, [numCollateral, currentPrice, leverage, side, leverageTiers]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  RENDER\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-blue-900/40 to-blue-800/20 border border-blue-500/30 rounded-xl p-5\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-lg flex items-center justify-center overflow-hidden\">\n              <img src=\"/kairos-logo.png\" alt=\"Kairos\" className=\"w-10 h-10 object-contain\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                Kairos Broker\n                {execMode === 'dex' ? (\n                  <span className=\"text-xs bg-green-600 text-white px-2 py-0.5 rounded-full flex items-center gap-1\">\n                    <span className=\"w-1.5 h-1.5 bg-green-300 rounded-full animate-pulse\" /> Kairos Exchange\n                  </span>\n                ) : (\n                  <span className=\"text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full\">INTERNO</span>\n                )}\n              </h1>\n              <p className=\"text-sm text-blue-300\">\n                {execMode === 'dex' ? 'Perpetuales â€” Precios reales Binance, P&L en KAIROS' : 'Leverage Trading con Reserva Kairos 777'}\n              </p>\n            </div>\n          </div>\n\n          {/* Wallet auto-connected from Kairos account */}\n          {isConnected && (\n            <div className=\"flex items-center gap-3\">\n              {/* Execution Mode Toggle */}\n              <div className=\"flex items-center bg-zinc-800 rounded-lg p-0.5\">\n                <button\n                  onClick={() => setExecMode('dex')}\n                  className={`px-3 py-1 rounded-md text-xs font-medium transition-all ${execMode === 'dex' ? 'bg-green-600 text-white shadow-sm' : 'text-zinc-400 hover:text-white'}`}\n                >\n                  ğŸŒ DEX\n                </button>\n                <button\n                  onClick={() => setExecMode('internal')}\n                  className={`px-3 py-1 rounded-md text-xs font-medium transition-all ${execMode === 'internal' ? 'bg-blue-600 text-white shadow-sm' : 'text-zinc-400 hover:text-white'}`}\n                >\n                  ğŸ›ï¸ Interno\n                </button>\n              </div>\n\n              <div className=\"bg-green-900/30 border border-green-500/30 rounded-lg px-3 py-1.5 flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\" />\n                <span className=\"text-xs text-green-300 font-mono\">\n                  {walletAddress.slice(0, 6)}...{walletAddress.slice(-4)}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* No wallet â€” auto-generate for legacy accounts */}\n      {!isConnected && (\n        <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl p-12 text-center\">\n          <div className=\"w-16 h-16 rounded-2xl bg-blue-500/10 flex items-center justify-center mx-auto mb-4\">\n            <Wallet className=\"w-8 h-8 text-blue-400\" />\n          </div>\n          <h2 className=\"text-lg font-bold text-white mb-2\">Wallet Requerida</h2>\n          <p className=\"text-zinc-400 text-sm mb-6 max-w-md mx-auto\">\n            Necesitas tu Kairos Wallet activa para operar en el DEX con apalancamiento.\n          </p>\n          <button\n            onClick={() => useStore.getState().setPage('wallet')}\n            className=\"px-6 py-3 rounded-xl text-sm font-bold text-black transition-all hover:brightness-110\"\n            style={{ background: 'linear-gradient(135deg, #D4AF37, #B8972E)' }}\n          >\n            <span className=\"flex items-center gap-2 justify-center\"><Wallet size={16} /> Ir a Mi Wallet</span>\n          </button>\n        </div>\n      )}\n\n      {/* Connected â€” Main interface */}\n      {isConnected && (\n        <div className=\"flex flex-col gap-3\">\n\n          {/* DEX Mode Banner */}\n          {execMode === 'dex' && (\n            <div className=\"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/20 rounded-lg px-4 py-2 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-green-400 text-sm\">ğŸ”—</span>\n                <span className=\"text-green-300 text-xs font-medium\">Kairos Exchange â€” Precios reales de Binance en tiempo real</span>\n              </div>\n              <div className=\"flex items-center gap-3 text-[10px] text-green-400/60\">\n                <span>Motor: Kairos Exchange</span>\n                <span>â€¢</span>\n                <span>Colateral: KAIROS</span>\n                <span>â€¢</span>\n                <span>Precios: Binance Live</span>\n              </div>\n            </div>\n          )}\n\n          {/* â”€â”€ TOP: Chart + Order Panel â”€â”€ */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-3\">\n            {/* â”€â”€ Chart â”€â”€ */}\n            <div className=\"lg:col-span-7\">\n              <BrokerChart pair={selectedPair} height={520} />\n            </div>\n            {/* â”€â”€ Order Entry + Account â”€â”€ */}\n            <div className=\"lg:col-span-5 flex flex-col gap-3 overflow-y-auto\" style={{ maxHeight: '540px', scrollbarWidth: 'thin', scrollbarColor: '#3f3f46 transparent' }}>\n              <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl p-4\">\n              {/* Pair + Price header */}\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-2xl\">{PAIR_ICONS[selectedPair] || 'â€¢'}</span>\n                  <div>\n                    <h3 className=\"text-white font-bold\">{selectedPair}</h3>\n                    <span className=\"text-xs text-zinc-500\">Mercado</span>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-xl font-bold text-white font-mono\">\n                    ${currentPrice ? currentPrice.toLocaleString(undefined, { maximumFractionDigits: 2 }) : 'â€”'}\n                  </div>\n                  {prices[selectedPair.replace('/', '')]?.change24h != null && (\n                    <span className={`text-xs font-mono ${prices[selectedPair.replace('/', '')].change24h >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                      {prices[selectedPair.replace('/', '')].change24h >= 0 ? '+' : ''}\n                      {prices[selectedPair.replace('/', '')].change24h.toFixed(2)}%\n                    </span>\n                  )}\n                </div>\n              </div>\n\n              {/* Side selector */}\n              <div className=\"grid grid-cols-2 gap-2 mb-4\">\n                <button onClick={() => setSide('LONG')}\n                  className={`py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-all ${\n                    side === 'LONG'\n                      ? 'bg-green-600 text-white shadow-lg shadow-green-600/20'\n                      : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700'\n                  }`}>\n                  <ArrowUpRight className=\"w-4 h-4\" /> LONG\n                </button>\n                <button onClick={() => setSide('SHORT')}\n                  className={`py-2.5 rounded-lg font-medium text-sm flex items-center justify-center gap-2 transition-all ${\n                    side === 'SHORT'\n                      ? 'bg-red-600 text-white shadow-lg shadow-red-600/20'\n                      : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700'\n                  }`}>\n                  <ArrowDownRight className=\"w-4 h-4\" /> SHORT\n                </button>\n              </div>\n\n              {/* Leverage selector */}\n              <div className=\"mb-4\">\n                <label className=\"text-xs text-zinc-500 mb-1.5 block flex items-center gap-1\">\n                  <Zap className=\"w-3 h-3\" /> Apalancamiento\n                </label>\n                <div className=\"grid grid-cols-4 gap-2\">\n                  {LEVERAGE_OPTIONS.map(lev => (\n                    <button key={lev} onClick={() => setLeverage(lev)}\n                      className={`py-2 rounded-lg text-sm font-bold transition-all ${\n                        leverage === lev\n                          ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/20'\n                          : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700'\n                      }`}>\n                      {lev}x\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Collateral input */}\n              <div className=\"mb-4\">\n                <label className=\"text-xs text-zinc-500 mb-1.5 block flex items-center justify-between\">\n                  <span className=\"flex items-center gap-1\"><Lock className=\"w-3 h-3\" /> Colateral (KAIROS)</span>\n                  {account && (\n                    <button onClick={() => setCollateralInput(String(Math.floor(account.freeMargin || 0)))}\n                      className=\"text-blue-400 hover:text-blue-300 text-[10px]\">\n                      Max: {(account.freeMargin || 0).toFixed(0)}\n                    </button>\n                  )}\n                </label>\n                <input type=\"number\" value={collateralInput} onChange={e => setCollateralInput(e.target.value)}\n                  placeholder=\"Ej: 100\" min=\"1\" step=\"1\"\n                  className=\"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2.5 text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none text-sm\" />\n\n                {/* Position info */}\n                {numCollateral > 0 && currentPrice > 0 && (\n                  <div className=\"mt-2 space-y-1 text-xs\">\n                    <div className=\"flex justify-between text-zinc-400\">\n                      <span>TamaÃ±o posiciÃ³n</span>\n                      <span className=\"text-white font-mono\">${positionSizeUsd.toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex justify-between text-zinc-400\">\n                      <span>Precio entrada</span>\n                      <span className=\"text-white font-mono\">${currentPrice.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n                    </div>\n                    {liquidationPrice && (\n                      <div className=\"flex justify-between text-zinc-400\">\n                        <span>Precio liquidaciÃ³n (est.)</span>\n                        <span className=\"text-red-400 font-mono\">${liquidationPrice.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* Advanced: SL / TP */}\n              <div className=\"mb-4\">\n                <button onClick={() => setShowAdvanced(!showAdvanced)}\n                  className=\"flex items-center gap-1 text-xs text-zinc-500 hover:text-zinc-300 transition-colors\">\n                  <Settings className=\"w-3 h-3\" /> Avanzado\n                  {showAdvanced ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n                </button>\n                <AnimatePresence>\n                  {showAdvanced && (\n                    <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }}\n                      exit={{ height: 0, opacity: 0 }} className=\"overflow-hidden\">\n                      <div className=\"pt-2 grid grid-cols-2 gap-2\">\n                        <div>\n                          <label className=\"text-[10px] text-zinc-500 block mb-1\">Stop Loss ($)</label>\n                          <input type=\"number\" value={stopLoss} onChange={e => setStopLoss(e.target.value)}\n                            placeholder=\"Precio SL\"\n                            className=\"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-2 text-xs text-white placeholder-zinc-600 focus:border-red-500 focus:outline-none\" />\n                        </div>\n                        <div>\n                          <label className=\"text-[10px] text-zinc-500 block mb-1\">Take Profit ($)</label>\n                          <input type=\"number\" value={takeProfit} onChange={e => setTakeProfit(e.target.value)}\n                            placeholder=\"Precio TP\"\n                            className=\"w-full bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-2 text-xs text-white placeholder-zinc-600 focus:border-green-500 focus:outline-none\" />\n                        </div>\n                      </div>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              {/* Submit button */}\n              <button\n                onClick={handleOpenPosition}\n                disabled={isSubmitting || !numCollateral || !currentPrice}\n                className={`w-full py-3 rounded-lg font-bold text-sm flex items-center justify-center gap-2 transition-all disabled:opacity-40 ${\n                  side === 'LONG'\n                    ? 'bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-600/20'\n                    : 'bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-600/20'\n                }`}>\n                {isSubmitting ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ) : side === 'LONG' ? (\n                  <ArrowUpRight className=\"w-4 h-4\" />\n                ) : (\n                  <ArrowDownRight className=\"w-4 h-4\" />\n                )}\n                {isSubmitting ? 'Abriendo...' : `Abrir ${side} ${leverage}x`}\n              </button>\n\n              {/* Risk warning */}\n              <div className=\"mt-3 bg-yellow-900/10 border border-yellow-500/20 rounded-lg px-3 py-2 text-[10px] text-yellow-500/80 flex items-start gap-1.5\">\n                <AlertTriangle className=\"w-3 h-3 mt-0.5 shrink-0\" />\n                <span>Trading apalancado = riesgo de pÃ©rdida total. LiquidaciÃ³n automÃ¡tica.</span>\n              </div>\n            </div>\n\n            {/* Cuenta Margin */}\n            <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl p-3\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <h3 className=\"text-xs font-medium text-zinc-300 flex items-center gap-1.5\">\n                  <Shield className=\"w-3.5 h-3.5 text-blue-400\" /> Cuenta Margin\n                </h3>\n                <button onClick={() => { fetchAccount(); fetchPositions(); }} className=\"text-zinc-500 hover:text-blue-400 transition-colors\">\n                  <RefreshCw className=\"w-3 h-3\" />\n                </button>\n              </div>\n              {isLoadingAccount && !account ? (\n                <div className=\"flex items-center justify-center py-3 text-zinc-500\">\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  <AccountRow label=\"Colateral\" value={`${(account?.totalCollateral || 0).toFixed(2)} KAIROS`} icon={<Lock className=\"w-3 h-3\" />} />\n                  <AccountRow label=\"Equity\" value={`$${(account?.equity || 0).toFixed(2)}`} icon={<DollarSign className=\"w-3 h-3\" />} />\n                  <AccountRow label=\"Margen libre\" value={`$${(account?.freeMargin || 0).toFixed(2)}`} icon={<Activity className=\"w-3 h-3\" />}\n                    color={(account?.freeMargin || 0) > 0 ? 'text-green-400' : 'text-zinc-400'} />\n                  <AccountRow label=\"P&L no realizado\"\n                    value={`${totalUnrealizedPnl >= 0 ? '+' : ''}$${totalUnrealizedPnl.toFixed(2)}`}\n                    icon={totalUnrealizedPnl >= 0 ? <TrendingUp className=\"w-3 h-3\" /> : <TrendingDown className=\"w-3 h-3\" />}\n                    color={totalUnrealizedPnl >= 0 ? 'text-green-400' : 'text-red-400'} />\n                </div>\n              )}\n            </div>\n\n            {/* Depositar / Retirar */}\n            <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl p-3\">\n              <button onClick={() => setShowDeposit(!showDeposit)}\n                className=\"w-full flex items-center justify-between text-xs font-medium text-zinc-300\">\n                <span className=\"flex items-center gap-1.5\">\n                  <Wallet className=\"w-3.5 h-3.5 text-blue-400\" /> Depositar / Retirar\n                </span>\n                {showDeposit ? <ChevronUp className=\"w-3.5 h-3.5\" /> : <ChevronDown className=\"w-3.5 h-3.5\" />}\n              </button>\n              <AnimatePresence>\n                {showDeposit && (\n                  <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }}\n                    exit={{ height: 0, opacity: 0 }} className=\"overflow-hidden\">\n                    <div className=\"pt-2 space-y-2\">\n                      <div className=\"flex gap-2\">\n                        <input type=\"number\" value={depositAmount} onChange={e => setDepositAmount(e.target.value)}\n                          placeholder=\"Depositar KAIROS\" min=\"1\" step=\"1\"\n                          className=\"flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-1.5 text-xs text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none\" />\n                        <button onClick={handleDeposit} disabled={isSubmitting || !depositAmount}\n                          className=\"bg-green-600 hover:bg-green-700 disabled:opacity-50 text-white px-2.5 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1 transition-colors\">\n                          {isSubmitting ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <Plus className=\"w-3 h-3\" />} Dep\n                        </button>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <input type=\"number\" value={withdrawAmount} onChange={e => setWithdrawAmount(e.target.value)}\n                          placeholder=\"Retirar KAIROS\" min=\"1\" step=\"1\"\n                          className=\"flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-2.5 py-1.5 text-xs text-white placeholder-zinc-500 focus:border-blue-500 focus:outline-none\" />\n                        <button onClick={handleWithdraw} disabled={isSubmitting || !withdrawAmount}\n                          className=\"bg-red-600/80 hover:bg-red-700 disabled:opacity-50 text-white px-2.5 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1 transition-colors\">\n                          {isSubmitting ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <Minus className=\"w-3 h-3\" />} Ret\n                        </button>\n                      </div>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n\n            </div>{/* close col-span-5 */}\n          </div>{/* close grid-cols-12 */}\n\n          {/* â”€â”€ BOTTOM: Prices / Positions / History â”€â”€ */}\n          <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden\">\n            {/* Tab bar */}\n            <div className=\"flex border-b border-zinc-800\">\n              {[\n                { id: 'prices', label: 'Precios en Vivo', icon: Activity },\n                { id: 'trade', label: 'Posiciones', icon: TrendingUp, count: positions.length },\n                { id: 'history', label: 'Historial', icon: History },\n              ].map(tab => (\n                <button key={tab.id} onClick={() => setActiveTab(tab.id)}\n                  className={`flex-1 py-2.5 text-xs font-medium flex items-center justify-center gap-1.5 transition-colors border-b-2 ${\n                    activeTab === tab.id\n                      ? 'border-blue-500 text-blue-400'\n                      : 'border-transparent text-zinc-500 hover:text-zinc-300'\n                  }`}>\n                  <tab.icon className=\"w-3.5 h-3.5\" />\n                  {tab.label}\n                  {tab.count > 0 && (\n                    <span className=\"bg-blue-500/20 text-blue-400 text-[10px] px-1.5 py-0.5 rounded-full\">{tab.count}</span>\n                  )}\n                </button>\n              ))}\n            </div>\n\n            {/* Tab content */}\n            <div className=\"overflow-y-auto p-3\" style={{ maxHeight: '280px', scrollbarWidth: 'thin', scrollbarColor: '#3f3f46 transparent' }}>\n              {/* Prices tab */}\n              {activeTab === 'prices' && (\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2\">\n                  {Object.entries(prices).map(([symbol, data]) => (\n                    <button key={symbol}\n                      onClick={() => setSelectedPair(symbol.replace('USDT', '/KAIROS'))}\n                      className={`flex flex-col items-center gap-1 px-2 py-2.5 rounded-lg text-xs transition-colors ${\n                        selectedPair === symbol.replace('USDT', '/KAIROS')\n                          ? 'bg-blue-900/30 border border-blue-500/30'\n                          : 'bg-zinc-800/50 hover:bg-zinc-800 border border-transparent'\n                      }`}>\n                      <span className=\"text-lg\">{PAIR_ICONS[symbol.replace('USDT', '/KAIROS')] || 'â€¢'}</span>\n                      <span className=\"text-zinc-300 font-medium truncate w-full text-center\">{symbol.replace('USDT', '/KAIROS')}</span>\n                      <span className=\"text-white font-mono text-[11px]\">${data.price?.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n                      <span className={`text-[10px] font-mono ${(data.change24h || 0) >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n                        {(data.change24h || 0) >= 0 ? '+' : ''}{(data.change24h || 0).toFixed(2)}%\n                      </span>\n                    </button>\n                  ))}\n                  {Object.keys(prices).length === 0 && (\n                    <div className=\"col-span-full text-center py-6 text-zinc-500 text-xs flex items-center justify-center gap-2\">\n                      <Loader2 className=\"w-3.5 h-3.5 animate-spin\" /> Cargando precios...\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Positions tab */}\n              {activeTab === 'trade' && (\n                <div>\n                  {positions.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <Eye className=\"w-8 h-8 text-zinc-600 mx-auto mb-2\" />\n                      <p className=\"text-zinc-500 text-sm\">Sin posiciones abiertas</p>\n                      <p className=\"text-zinc-600 text-xs mt-1\">Deposita colateral y abre tu primera operaciÃ³n</p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2\">\n                      {positions.map(pos => (\n                        <PositionCard key={pos.id} position={pos}\n                          onClose={handleClosePosition}\n                          isClosing={closingPositionId === pos.id}\n                          prices={prices} />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* History tab */}\n              {activeTab === 'history' && (\n                <div>\n                  {tradeHistory.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <History className=\"w-8 h-8 text-zinc-600 mx-auto mb-2\" />\n                      <p className=\"text-zinc-500 text-sm\">Sin historial</p>\n                    </div>\n                  ) : (\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2\">\n                      {tradeHistory.map(trade => (\n                        <HistoryCard key={trade.id} trade={trade} />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n\n        </div>\n      )}\n    </div>\n  );\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n//  BROKER CHART â€” Mini TradingView chart using lightweight-charts + Binance data\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nconst CHART_TIMEFRAMES = ['1m', '5m', '15m', '1h', '4h', '1d'];\nconst BINANCE_KLINES = [\n  'https://api.binance.us/api/v3/klines',\n  'https://api.binance.com/api/v3/klines',\n];\n\nfunction BrokerChart({ pair, height = 280 }) {\n  const containerRef = useRef(null);\n  const chartRef = useRef(null);\n  const candleRef = useRef(null);\n  const volRef = useRef(null);\n  const wsRef = useRef(null);\n  const [tf, setTf] = useState('15m');\n  const [chartLoading, setChartLoading] = useState(true);\n\n  const symbol = pair.replace('/', '');\n\n  // Fetch klines from Binance (with fallback)\n  const fetchKlines = useCallback(async (sym, interval) => {\n    for (const base of BINANCE_KLINES) {\n      try {\n        const ctrl = new AbortController();\n        const timer = setTimeout(() => ctrl.abort(), 8000);\n        const res = await fetch(`${base}?symbol=${sym}&interval=${interval}&limit=300`, { signal: ctrl.signal });\n        clearTimeout(timer);\n        if (!res.ok) continue;\n        const raw = await res.json();\n        if (!Array.isArray(raw)) continue;\n        return raw.map(k => ({\n          time: Math.floor(k[0] / 1000),\n          open: +k[1], high: +k[2], low: +k[3], close: +k[4], volume: +k[5],\n        }));\n      } catch { continue; }\n    }\n    return [];\n  }, []);\n\n  // Initialize chart once\n  useEffect(() => {\n    if (!containerRef.current) return;\n    const chart = createChart(containerRef.current, {\n      width: containerRef.current.clientWidth,\n      height: height,\n      layout: { background: { type: ColorType.Solid, color: '#09090b' }, textColor: '#71717a', fontFamily: 'Inter, monospace', fontSize: 10 },\n      grid: { vertLines: { color: '#18181b' }, horzLines: { color: '#18181b' } },\n      crosshair: { mode: CrosshairMode.Normal, vertLine: { color: '#3b82f6', width: 1, style: 2 }, horzLine: { color: '#3b82f6', width: 1, style: 2 } },\n      timeScale: { borderColor: '#27272a', timeVisible: true, secondsVisible: false, rightOffset: 3, barSpacing: 6 },\n      rightPriceScale: { borderColor: '#27272a', scaleMargins: { top: 0.1, bottom: 0.25 } },\n    });\n    const candle = chart.addCandlestickSeries({\n      upColor: '#22c55e', downColor: '#ef4444', borderUpColor: '#22c55e', borderDownColor: '#ef4444',\n      wickUpColor: '#22c55e80', wickDownColor: '#ef444480',\n    });\n    const vol = chart.addHistogramSeries({\n      color: '#3b82f650', priceFormat: { type: 'volume' },\n      priceScaleId: '', scaleMargins: { top: 0.8, bottom: 0 },\n    });\n    chartRef.current = chart;\n    candleRef.current = candle;\n    volRef.current = vol;\n\n    const ro = new ResizeObserver(([e]) => { try { chart.applyOptions({ width: e.contentRect.width }); } catch {} });\n    ro.observe(containerRef.current);\n    return () => { ro.disconnect(); chart.remove(); chartRef.current = null; };\n  }, []);\n\n  // Load data on pair/tf change\n  useEffect(() => {\n    let cancelled = false;\n    setChartLoading(true);\n\n    (async () => {\n      const candles = await fetchKlines(symbol, tf);\n      if (cancelled || !candleRef.current) return;\n      candleRef.current.setData(candles);\n      volRef.current.setData(candles.map(c => ({ time: c.time, value: c.volume, color: c.close >= c.open ? '#22c55e30' : '#ef444430' })));\n      chartRef.current?.timeScale().fitContent();\n      setChartLoading(false);\n    })();\n\n    // WebSocket for live candle updates\n    if (wsRef.current) { wsRef.current.close(); wsRef.current = null; }\n    const wsUrls = ['wss://stream.binance.us:9443/ws', 'wss://stream.binance.com:9443/ws'];\n    function tryWs(idx) {\n      if (idx >= wsUrls.length || cancelled) return;\n      try {\n        const ws = new WebSocket(`${wsUrls[idx]}/${symbol.toLowerCase()}@kline_${tf}`);\n        ws.onopen = () => { wsRef.current = ws; };\n        ws.onmessage = (e) => {\n          try {\n            const { k } = JSON.parse(e.data);\n            if (!k || !candleRef.current) return;\n            candleRef.current.update({ time: Math.floor(k.t / 1000), open: +k.o, high: +k.h, low: +k.l, close: +k.c });\n            volRef.current?.update({ time: Math.floor(k.t / 1000), value: +k.v, color: +k.c >= +k.o ? '#22c55e30' : '#ef444430' });\n          } catch {}\n        };\n        ws.onerror = () => { ws.close(); tryWs(idx + 1); };\n      } catch { tryWs(idx + 1); }\n    }\n    tryWs(0);\n\n    return () => { cancelled = true; if (wsRef.current) { wsRef.current.close(); wsRef.current = null; } };\n  }, [symbol, tf, fetchKlines]);\n\n  return (\n    <div className=\"bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden\">\n      {/* Timeframe tabs */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b border-zinc-800\">\n        <span className=\"text-xs font-bold text-white flex items-center gap-1.5\">\n          <BarChart3 className=\"w-3.5 h-3.5 text-blue-400\" /> {pair}\n        </span>\n        <div className=\"flex gap-1\">\n          {CHART_TIMEFRAMES.map(t => (\n            <button key={t} onClick={() => setTf(t)}\n              className={`px-2 py-0.5 rounded text-[10px] font-bold transition-colors ${tf === t ? 'bg-blue-600 text-white' : 'text-zinc-500 hover:text-zinc-300'}`}>\n              {t}\n            </button>\n          ))}\n        </div>\n      </div>\n      {/* Chart container */}\n      <div className=\"relative\">\n        <div ref={containerRef} style={{ width: '100%', height: height }} />\n        {chartLoading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-zinc-900/80\">\n            <Loader2 className=\"w-5 h-5 text-blue-400 animate-spin\" />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n//  SUB-COMPONENTS\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nfunction AccountRow({ label, value, icon, color = 'text-white' }) {\n  return (\n    <div className=\"flex items-center justify-between py-1\">\n      <span className=\"text-xs text-zinc-500 flex items-center gap-1.5\">{icon} {label}</span>\n      <span className={`text-xs font-mono font-medium ${color}`}>{value}</span>\n    </div>\n  );\n}\n\nfunction PositionCard({ position, onClose, isClosing, prices }) {\n  const pos = position;\n  const pnl = parseFloat(pos.unrealizedPnl) || 0;\n  const pnlPct = parseFloat(pos.pnlPercent) || (pos.collateral ? (pnl / parseFloat(pos.collateral)) * 100 : 0);\n  const isLong = (pos.side || pos.direction || '').toUpperCase() === 'LONG';\n  const pair = pos.pair || pos.symbol || '';\n  const currentPriceData = prices[pair.replace('/', '')] || {};\n\n  return (\n    <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }}\n      className=\"bg-zinc-900 border border-zinc-800 rounded-xl p-3\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-base\">{PAIR_ICONS[pair] || 'â€¢'}</span>\n          <span className=\"text-sm font-bold text-white\">{pair}</span>\n          <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded ${\n            isLong ? 'bg-green-900/50 text-green-400' : 'bg-red-900/50 text-red-400'\n          }`}>\n            {isLong ? 'LONG' : 'SHORT'} {pos.leverage}x\n          </span>\n        </div>\n        <button onClick={() => onClose(pos.id)} disabled={isClosing}\n          className=\"text-xs bg-zinc-800 hover:bg-red-600/80 text-zinc-400 hover:text-white px-2.5 py-1 rounded-lg transition-all disabled:opacity-50 flex items-center gap-1\">\n          {isClosing ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <X className=\"w-3 h-3\" />}\n          Cerrar\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1 text-xs\">\n        <div className=\"flex justify-between text-zinc-400\">\n          <span>Entrada</span>\n          <span className=\"text-white font-mono\">${parseFloat(pos.entryPrice || 0).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n        </div>\n        <div className=\"flex justify-between text-zinc-400\">\n          <span>Actual</span>\n          <span className=\"text-white font-mono\">${(currentPriceData.price || parseFloat(pos.currentPrice || 0)).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n        </div>\n        <div className=\"flex justify-between text-zinc-400\">\n          <span>Colateral</span>\n          <span className=\"text-white font-mono\">{parseFloat(pos.collateral || 0).toFixed(2)} K</span>\n        </div>\n        <div className=\"flex justify-between text-zinc-400\">\n          <span>TamaÃ±o</span>\n          <span className=\"text-white font-mono\">${parseFloat(pos.positionSizeUsd || 0).toLocaleString()}</span>\n        </div>\n      </div>\n\n      {/* P&L bar */}\n      <div className={`mt-2 px-2.5 py-1.5 rounded-lg flex items-center justify-between ${\n        pnl >= 0 ? 'bg-green-900/20 border border-green-500/20' : 'bg-red-900/20 border border-red-500/20'\n      }`}>\n        <span className=\"text-[10px] text-zinc-400\">P&L</span>\n        <div className=\"flex items-center gap-2\">\n          <span className={`text-xs font-bold font-mono ${pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n            {pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}\n          </span>\n          <span className={`text-[10px] font-mono ${pnlPct >= 0 ? 'text-green-400/70' : 'text-red-400/70'}`}>\n            ({pnlPct >= 0 ? '+' : ''}{pnlPct.toFixed(2)}%)\n          </span>\n        </div>\n      </div>\n\n      {/* SL/TP indicators */}\n      {(pos.stopLoss || pos.takeProfit) && (\n        <div className=\"flex gap-2 mt-1.5 text-[10px]\">\n          {pos.stopLoss && (\n            <span className=\"text-red-400/60\">SL: ${parseFloat(pos.stopLoss).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n          )}\n          {pos.takeProfit && (\n            <span className=\"text-green-400/60\">TP: ${parseFloat(pos.takeProfit).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n          )}\n        </div>\n      )}\n    </motion.div>\n  );\n}\n\nfunction HistoryCard({ trade }) {\n  const pnl = parseFloat(trade.realizedPnl || trade.pnl || 0);\n  const isLong = (trade.side || trade.direction || '').toUpperCase() === 'LONG';\n  const pair = trade.pair || trade.symbol || '';\n  const status = (trade.status || trade.closeReason || '').toUpperCase();\n  const isLiquidated = status.includes('LIQUIDAT');\n\n  return (\n    <div className={`bg-zinc-900 border rounded-xl p-3 ${isLiquidated ? 'border-red-500/30' : 'border-zinc-800'}`}>\n      <div className=\"flex items-center justify-between mb-1.5\">\n        <div className=\"flex items-center gap-2\">\n          <span>{PAIR_ICONS[pair] || 'â€¢'}</span>\n          <span className=\"text-sm font-medium text-white\">{pair}</span>\n          <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded ${\n            isLong ? 'bg-green-900/30 text-green-400/70' : 'bg-red-900/30 text-red-400/70'\n          }`}>\n            {isLong ? 'LONG' : 'SHORT'} {trade.leverage}x\n          </span>\n          {isLiquidated && (\n            <span className=\"text-[10px] bg-red-900/50 text-red-400 px-1.5 py-0.5 rounded font-bold\">LIQUIDADO</span>\n          )}\n        </div>\n        <span className={`text-xs font-bold font-mono ${pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>\n          {pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}\n        </span>\n      </div>\n\n      <div className=\"flex gap-4 text-[10px] text-zinc-500\">\n        <span>Entrada: ${parseFloat(trade.entryPrice || 0).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n        <span>Salida: ${parseFloat(trade.exitPrice || trade.closePrice || 0).toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>\n        <span>Colateral: {parseFloat(trade.collateral || 0).toFixed(2)}</span>\n      </div>\n\n      {trade.closedAt && (\n        <div className=\"text-[10px] text-zinc-600 mt-1\">\n          {new Date(trade.closedAt || trade.closed_at).toLocaleString()}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["API_MARGIN","API_HOST","API_PERPS","PRICE_POLL_MS","ACCOUNT_POLL_MS","LEVERAGE_INTERNAL","LEVERAGE_DEX","PAIR_ICONS","createApi","base","endpoint","options","url","res","data","_a","KairosBroker","showToast","user","login","useStore","walletAddress","isConnected","execMode","setExecMode","useState","API_BASE","api","useMemo","LEVERAGE_OPTIONS","account","setAccount","positions","setPositions","tradeHistory","setTradeHistory","pairs","setPairs","prices","setPrices","leverageTiers","setLeverageTiers","selectedPair","setSelectedPair","side","setSide","leverage","setLeverage","collateralInput","setCollateralInput","stopLoss","setStopLoss","takeProfit","setTakeProfit","showAdvanced","setShowAdvanced","depositAmount","setDepositAmount","withdrawAmount","setWithdrawAmount","showDeposit","setShowDeposit","activeTab","setActiveTab","isSubmitting","setIsSubmitting","isLoadingAccount","setIsLoadingAccount","closingPositionId","setClosingPositionId","priceIntervalRef","useRef","accountIntervalRef","numCollateral","currentPrice","positionSizeUsd","fetchPrices","useCallback","fetchPairs","_b","fetchAccount","fetchPositions","fetchHistory","useEffect","handleDeposit","amount","err","handleWithdraw","handleOpenPosition","body","handleClosePosition","positionId","pnl","totalUnrealizedPnl","sum","p","liquidationPrice","maintenancePct","jsxs","jsx","Wallet","BrokerChart","ArrowUpRight","ArrowDownRight","Zap","lev","Lock","e","Settings","ChevronUp","ChevronDown","AnimatePresence","motion","Loader2","AlertTriangle","Shield","RefreshCw","AccountRow","DollarSign","Activity","TrendingUp","TrendingDown","Plus","Minus","History","tab","symbol","Eye","pos","PositionCard","trade","HistoryCard","CHART_TIMEFRAMES","BINANCE_KLINES","pair","height","containerRef","chartRef","candleRef","volRef","wsRef","tf","setTf","chartLoading","setChartLoading","fetchKlines","sym","interval","ctrl","timer","raw","k","chart","createChart","ColorType","CrosshairMode","candle","vol","ro","cancelled","candles","c","wsUrls","tryWs","idx","ws","BarChart3","t","label","value","icon","color","position","onClose","isClosing","pnlPct","isLong","currentPriceData","X","isLiquidated"],"mappings":"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"}